<UserControl
    x:Class="MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_POEntry"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:MTM_Receiving_Application.Converters"
    mc:Ignorable="d"
    Loaded="UserControl_Loaded">

    <UserControl.Resources>
        <converters:Converter_BooleanToVisibility x:Key="BooleanToVisibilityConverter"/>
        <converters:Converter_DecimalToInt x:Key="DecimalToIntConverter"/>
    </UserControl.Resources>

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Content Section -->
        <ScrollViewer Grid.Row="1">
            <StackPanel Spacing="20" MaxWidth="800">
                
                <!-- PO Entry Mode -->
                <StackPanel Visibility="{x:Bind ViewModel.IsNonPOItem, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}" 
                           Spacing="16">
                    
                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20">
                        <StackPanel Spacing="16">
                            <!-- PO Number Input with Icon -->
                            <StackPanel Spacing="8">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE8A5;" 
                                             FontSize="16"
                                             Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                    <TextBlock Text="Purchase Order Number" 
                                              Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                                
                                <TextBox x:Name="FirstTextBox"
                                        Text="{x:Bind ViewModel.PoNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                        PlaceholderText="{x:Bind ViewModel.GetPlaceholder('Field.PONumber'), Mode=OneWay}"
                                        MaxWidth="400"
                                        HorizontalAlignment="Stretch"
                                        TabIndex="0"
                                        LostFocus="POTextBox_LostFocus"
                                        AutomationProperties.Name="Purchase Order Number"/>
                                
                                <!-- Validation Message -->
                                <TextBlock Text="{x:Bind ViewModel.PoValidationMessage, Mode=OneWay}" 
                                          Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                          FontSize="12"
                                          Visibility="{x:Bind ViewModel.IsLoadPOEnabled, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}"/>
                                
                                <!-- PO Status Display -->
                                <Border BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8,4"
                                        Margin="0,8,0,0"
                                        Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <FontIcon Glyph="&#xE8C9;" FontSize="14"/>
                                        <TextBlock Text="Status:" FontWeight="SemiBold" FontSize="12"/>
                                        <TextBlock Text="{x:Bind ViewModel.PoStatusDescription, Mode=OneWay}" 
                                                  FontSize="12"
                                                  FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- Action Buttons -->
                            <Grid ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <Button Grid.Column="0"
                                       Command="{x:Bind ViewModel.LoadPOCommand}" 
                                       IsEnabled="{x:Bind ViewModel.IsLoadPOEnabled, Mode=OneWay}"
                                       Style="{StaticResource AccentButtonStyle}"
                                       AutomationProperties.Name="Load Purchase Order"
                                       ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.LoadPO'), Mode=OneWay}">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <FontIcon Glyph="&#xE896;" FontSize="16"/>
                                        <TextBlock Text="Load PO"/>
                                    </StackPanel>
                                </Button>
                                
                                <Button Grid.Column="1"
                                       Content="Switch to Non-PO" 
                                       Command="{x:Bind ViewModel.ToggleNonPOCommand}"
                                       ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.SwitchToNonPO'), Mode=OneWay}"/>
                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Non-PO Entry Mode -->
                <StackPanel Visibility="{x:Bind ViewModel.IsNonPOItem, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" 
                           Spacing="16">
                    
                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20">
                        <StackPanel Spacing="16">
                            <!-- Part ID Input with Icon -->
                            <StackPanel Spacing="8">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE8B7;" 
                                             FontSize="16"
                                             Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                    <TextBlock Text="Part Identifier" 
                                              Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                                
                                <TextBox x:Name="PartIDTextBox"
                                        Text="{x:Bind ViewModel.PartID, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                        PlaceholderText="{x:Bind ViewModel.GetPlaceholder('Field.PartID'), Mode=OneWay}"
                                        MaxWidth="400"
                                        HorizontalAlignment="Stretch"
                                        AutomationProperties.Name="Part Identifier"/>
                            </StackPanel>

                            <!-- Package Type Display (Auto-detected) -->
                            <StackPanel Spacing="8">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE7B8;" 
                                             FontSize="16"
                                             Foreground="{ThemeResource AccentTextFillColorSecondaryBrush}"/>
                                    <TextBlock Text="Package Type (Auto-detected)" 
                                              Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                                
                                <TextBlock Text="{x:Bind ViewModel.PackageType, Mode=OneWay}"
                                          Style="{ThemeResource SubtitleTextBlockStyle}"
                                          Foreground="{ThemeResource SystemAccentColor}"/>
                            </StackPanel>

                            <!-- Action Buttons -->
                            <Grid ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <Button Grid.Column="0"
                                       Command="{x:Bind ViewModel.LookupPartCommand}" 
                                       Style="{StaticResource AccentButtonStyle}"
                                       AutomationProperties.Name="Look Up Part"
                                       ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.LookupPart'), Mode=OneWay}">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <FontIcon Glyph="&#xE721;" FontSize="16"/>
                                        <TextBlock Text="Look Up Part"/>
                                    </StackPanel>
                                </Button>
                                
                                <Button Grid.Column="1"
                                       Content="Switch to PO Entry" 
                                       Command="{x:Bind ViewModel.ToggleNonPOCommand}"
                                       ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.SwitchToPO'), Mode=OneWay}"/>
                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Loading Indicator -->
                <ProgressBar IsIndeterminate="True" 
                            Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                            Margin="0,8,0,0"/>

                <!-- Parts Grid with Modern Styling -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                       BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                       BorderThickness="1"
                       CornerRadius="8"
                       Padding="16">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE8FD;" 
                                     FontSize="16"
                                     Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                            <TextBlock Text="Available Parts" 
                                      Style="{ThemeResource SubtitleTextBlockStyle}"/>
                        </StackPanel>
                        
                        <controls:DataGrid ItemsSource="{x:Bind ViewModel.Parts, Mode=OneWay}"
                                          SelectedItem="{x:Bind ViewModel.SelectedPart, Mode=TwoWay}"
                                          AutoGenerateColumns="False"
                                          IsReadOnly="True"
                                          GridLinesVisibility="Horizontal"
                                          HeadersVisibility="Column"
                                          SelectionMode="Single"
                                          Height="300"
                                          AutomationProperties.Name="Parts List">
                            <controls:DataGrid.Columns>
                                <controls:DataGridTextColumn Header="Part ID" 
                                                            Binding="{Binding PartID}" 
                                                            Width="150"/>
                                <controls:DataGridTextColumn Header="Description" 
                                                            Binding="{Binding Description}" 
                                                            Width="*"/>
                                <controls:DataGridTextColumn Header="Remaining Qty" 
                                                            Binding="{Binding RemainingQuantity}" 
                                                            Width="120"/>
                                <controls:DataGridTextColumn Header="Qty Ordered" 
                                                            Binding="{Binding QtyOrdered, Converter={StaticResource DecimalToIntConverter}}" 
                                                            Width="120"/>
                                <controls:DataGridTextColumn Header="Line #" 
                                                            Binding="{Binding POLineNumber}" 
                                                            Width="80"/>
                            </controls:DataGrid.Columns>
                        </controls:DataGrid>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
