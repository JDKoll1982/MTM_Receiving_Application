<UserControl
    x:Class="MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_POEntry"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:Converter_BooleanToVisibility x:Key="BooleanToVisibilityConverter"/>
        <converters:Converter_DecimalToInt x:Key="DecimalToIntConverter"/>
    </UserControl.Resources>

    <Grid Padding="24" RowSpacing="20" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" >
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Input Section (Row 0) -->
        <Grid Grid.Row="0">
            <!-- PO Entry Mode -->
            <StackPanel Visibility="{x:Bind ViewModel.IsNonPOItem, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}">

                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20">
                    
                    <StackPanel Spacing="16">
                        <!-- PO Number Input with Icon -->
                        <StackPanel Spacing="8">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE8A5;" 
                                         FontSize="16"
                                         Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                <TextBlock Text="{x:Bind ViewModel.PoNumberHeaderText, Mode=OneWay}" 
                                          Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                            </StackPanel>
                            
                            <TextBox x:Name="PoNumberTextBox"
                                    Text="{x:Bind ViewModel.PoNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                    PlaceholderText="{x:Bind ViewModel.GetPlaceholder('Field.PONumber'), Mode=OneWay}"
                                    MinWidth="320"
                                    HorizontalAlignment="Stretch"
                                    TabIndex="0"
                                    LostFocus="POTextBox_LostFocus"
                                    AutomationProperties.Name="{x:Bind ViewModel.PoNumberAccessibilityName, Mode=OneWay}"/>
                            
                            <!-- Validation Message -->
                            <TextBlock Text="{x:Bind ViewModel.PoValidationMessage, Mode=OneWay}" 
                                      Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                      FontSize="12"
                                      Visibility="{x:Bind ViewModel.IsLoadPOEnabled, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}"/>
                            
                            <!-- PO Status Display -->
                            <Border BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="8,4"
                                    Margin="0,8,0,0"
                                    Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE8C9;" FontSize="14"/>
                                    <TextBlock Text="{x:Bind ViewModel.PoStatusLabelText, Mode=OneWay}" FontWeight="SemiBold" FontSize="12"/>
                                    <TextBlock Text="{x:Bind ViewModel.PoStatusDescription, Mode=OneWay}" 
                                              FontSize="12"
                                              FontWeight="SemiBold"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Action Buttons -->
                        <Grid ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <Button Grid.Column="0"
                                   Command="{x:Bind ViewModel.LoadPOCommand}" 
                                   IsEnabled="{x:Bind ViewModel.IsLoadPOEnabled, Mode=OneWay}"
                                   Style="{StaticResource AccentButtonStyle}"
                                   AutomationProperties.Name="{x:Bind ViewModel.LoadPoAccessibilityName, Mode=OneWay}"
                                   ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.LoadPO'), Mode=OneWay}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE896;" FontSize="16"/>
                                    <TextBlock Text="{x:Bind ViewModel.LoadPoButtonText, Mode=OneWay}"/>
                                </StackPanel>
                            </Button>
                            
                            <Button Grid.Column="1"
                                Content="{x:Bind ViewModel.SwitchToNonPoButtonText, Mode=OneWay}" 
                                   Command="{x:Bind ViewModel.ToggleNonPOCommand}"
                                   ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.SwitchToNonPO'), Mode=OneWay}"/>
                        </Grid>
                    </StackPanel>                    
                </Border>
            </StackPanel>

            <!-- Non-PO Entry Mode -->
            <StackPanel Visibility="{x:Bind ViewModel.IsNonPOItem, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20">
                    <StackPanel Spacing="16">
                        <!-- Part ID Input with Icon -->
                        <StackPanel Spacing="8">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE8B7;" 
                                         FontSize="16"
                                         Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                <TextBlock Text="{x:Bind ViewModel.PartIdentifierHeaderText, Mode=OneWay}" 
                                          Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                            </StackPanel>
                            
                            <TextBox x:Name="PartIDTextBox"
                                    Text="{x:Bind ViewModel.PartID, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                    PlaceholderText="{x:Bind ViewModel.GetPlaceholder('Field.PartID'), Mode=OneWay}"
                                    MinWidth="320"
                                    HorizontalAlignment="Stretch"
                                    AutomationProperties.Name="{x:Bind ViewModel.PartIdAccessibilityName, Mode=OneWay}"/>
                        </StackPanel>

                        <!-- Package Type Display (Auto-detected) -->
                        <StackPanel Spacing="8">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE7B8;" 
                                         FontSize="16"
                                         Foreground="{ThemeResource AccentTextFillColorSecondaryBrush}"/>
                                <TextBlock Text="{x:Bind ViewModel.PackageTypeAutoHeaderText, Mode=OneWay}" 
                                          Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                            </StackPanel>
                            
                            <TextBlock Text="{x:Bind ViewModel.PackageType, Mode=OneWay}"
                                      Style="{ThemeResource SubtitleTextBlockStyle}"
                                      Foreground="{ThemeResource SystemAccentColor}"/>
                        </StackPanel>

                        <!-- Action Buttons -->
                        <Grid ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <Button Grid.Column="0"
                                   Command="{x:Bind ViewModel.LookupPartCommand}" 
                                   Style="{StaticResource AccentButtonStyle}"
                                   AutomationProperties.Name="{x:Bind ViewModel.LookupPartAccessibilityName, Mode=OneWay}"
                                   ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.LookupPart'), Mode=OneWay}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE721;" FontSize="16"/>
                                    <TextBlock Text="{x:Bind ViewModel.LookupPartButtonText, Mode=OneWay}"/>
                                </StackPanel>
                            </Button>
                            
                            <Button Grid.Column="1"
                                Content="{x:Bind ViewModel.SwitchToPoButtonText, Mode=OneWay}" 
                                   Command="{x:Bind ViewModel.ToggleNonPOCommand}"
                                   ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.SwitchToPO'), Mode=OneWay}"/>
                        </Grid>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>

        <!-- Loading Indicator -->
        <ProgressBar Grid.Row="0" 
                    IsIndeterminate="True" 
                    VerticalAlignment="Bottom"
                    Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                    Margin="0,0,0,-10"/>

        <!-- Parts Grid Section (Row 1) -->
        <Border Grid.Row="1" 
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="16"
                Visibility="{x:Bind ViewModel.IsPartsListVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" Margin="0,0,0,12">
                    <FontIcon Glyph="&#xE8FD;" 
                             FontSize="16"
                             Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                    <TextBlock Text="{x:Bind ViewModel.AvailablePartsHeaderText, Mode=OneWay}" 
                              Style="{ThemeResource SubtitleTextBlockStyle}"/>
                </StackPanel>
                
                <controls:DataGrid Grid.Row="1"
                                  ItemsSource="{x:Bind ViewModel.Parts, Mode=OneWay}"
                                  SelectedItem="{x:Bind ViewModel.SelectedPart, Mode=TwoWay}"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column"
                                  SelectionMode="Single"
                                  AutomationProperties.Name="{x:Bind ViewModel.PartsListAccessibilityName, Mode=OneWay}">
                    <controls:DataGrid.Columns>
                        <controls:DataGridTextColumn Header="{x:Bind ViewModel.ColumnPartIdHeaderText, Mode=OneWay}" 
                                                    Binding="{Binding PartID}" 
                                                    Width="2*"/>
                        <controls:DataGridTextColumn Header="{x:Bind ViewModel.ColumnDescriptionHeaderText, Mode=OneWay}" 
                                                    Binding="{Binding Description}" 
                                                    Width="4*"/>
                        <controls:DataGridTextColumn Header="{x:Bind ViewModel.ColumnRemainingQtyHeaderText, Mode=OneWay}" 
                                                    Binding="{Binding RemainingQuantity}" 
                                                    Width="*"/>
                        <controls:DataGridTextColumn Header="{x:Bind ViewModel.ColumnQtyOrderedHeaderText, Mode=OneWay}" 
                                                    Binding="{Binding QtyOrdered, Converter={StaticResource DecimalToIntConverter}}" 
                                                    Width="*"/>
                        <controls:DataGridTextColumn Header="{x:Bind ViewModel.ColumnLineNumberHeaderText, Mode=OneWay}" 
                                                    Binding="{Binding POLineNumber}" 
                                                    Width="*"/>
                    </controls:DataGrid.Columns>
                </controls:DataGrid>
            </Grid>
        </Border>
    </Grid>
</UserControl>

