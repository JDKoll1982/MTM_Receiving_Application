<repomix><file_summary>This file is a merged representation of a subset of the codebase, containing specifically included files and files not matching ignore patterns, combined into a single document by Repomix.
The content has been processed where content has been formatted for parsing in xml style.<purpose>This file contains a packed representation of a subset of the repository&apos;s contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.</purpose><file_format>The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Repository files, each consisting of:
  - File path as an attribute
  - Full contents of the file</file_format><usage_guidelines>- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
- Pay special attention to the Repository Description. These contain important context and guidelines specific to this project.</usage_guidelines><notes>- Some files may have been excluded based on .gitignore rules and Repomix&apos;s configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Only files matching these patterns are included: **/*.cs, **/*.xaml, App.xaml.cs, MainWindow.xaml.cs, **/*.cs, **/*.xaml, App.xaml.cs, MainWindow.xaml.cs
- Files matching these patterns are excluded: **/bin/**, **/obj/**, **/.vs/**, **/node_modules/**, **/*.md, docs/**, Documentation/**, Assets/**, Database/**, specs/**, _bmad-output/**, **/*REPORT.md, **/bin/**, **/obj/**, **/.vs/**, **/node_modules/**, **/*.md, docs/**, Documentation/**, Assets/**, Database/**, specs/**, _bmad-output/**, **/*REPORT.md
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Content has been formatted for parsing in xml style
- Files are sorted by Git change count (files with more changes are at the bottom)</notes></file_summary><user_provided_header>MTM Receiving Application - Core Project Code (Architecture &amp; Implementation)</user_provided_header><directory_structure>App.xaml
App.xaml.cs
MainWindow.xaml
MainWindow.xaml.cs
Module_Core/Behaviors/AuditBehavior.cs
Module_Core/Behaviors/LoggingBehavior.cs
Module_Core/Behaviors/ValidationBehavior.cs
Module_Core/Contracts/Services/IService_Authentication.cs
Module_Core/Contracts/Services/IService_CSVWriter.cs
Module_Core/Contracts/Services/IService_Dispatcher.cs
Module_Core/Contracts/Services/IService_ErrorHandler.cs
Module_Core/Contracts/Services/IService_Focus.cs
Module_Core/Contracts/Services/IService_Help.cs
Module_Core/Contracts/Services/IService_InforVisual.cs
Module_Core/Contracts/Services/IService_LoggingUtility.cs
Module_Core/Contracts/Services/IService_Notification.cs
Module_Core/Contracts/Services/IService_OnStartup_AppLifecycle.cs
Module_Core/Contracts/Services/IService_Pagination.cs
Module_Core/Contracts/Services/IService_SessionManager.cs
Module_Core/Contracts/Services/IService_UserSessionManager.cs
Module_Core/Contracts/Services/IService_ViewModelRegistry.cs
Module_Core/Contracts/Services/ITimer.cs
Module_Core/Contracts/Services/IWindowService.cs
Module_Core/Contracts/Services/Navigation/IService_Navigation.cs
Module_Core/Contracts/ViewModels/IResettableViewModel.cs
Module_Core/Converters/Converter_BooleanToVisibility.cs
Module_Core/Converters/Converter_BoolToString.cs
Module_Core/Converters/Converter_DecimalToInt.cs
Module_Core/Converters/Converter_DecimalToString.cs
Module_Core/Converters/Converter_DoubleToDecimal.cs
Module_Core/Converters/Converter_EmptyStringToVisibility.cs
Module_Core/Converters/Converter_EnumToVisibility.cs
Module_Core/Converters/Converter_IconCodeToGlyph.cs
Module_Core/Converters/Converter_IntToVisibility.cs
Module_Core/Converters/Converter_LoadNumberToOneBased.cs
Module_Core/Converters/Converter_StringFormat.cs
Module_Core/Converters/NullableDoubleToDoubleConverter.cs
Module_Core/Data/Authentication/Dao_User.cs
Module_Core/Data/InforVisual/Dao_InforVisualConnection.cs
Module_Core/Data/InforVisual/Dao_InforVisualPart.cs
Module_Core/Data/InforVisual/Dao_InforVisualPO.cs
Module_Core/Defaults/InforVisualDefaults.cs
Module_Core/Defaults/WorkstationDefaults.cs
Module_Core/Helpers/Database/Helper_Database_StoredProcedure.cs
Module_Core/Helpers/Database/Helper_Database_Variables.cs
Module_Core/Helpers/Database/Helper_SqlQueryLoader.cs
Module_Core/Helpers/UI/Helper_MaterialIcons.cs
Module_Core/Helpers/UI/Helper_WindowExtensions.cs
Module_Core/Helpers/UI/Helper_WorkflowHelpContentGenerator.cs
Module_Core/Models/Core/Model_Dao_Result_Factory.cs
Module_Core/Models/Core/Model_Dao_Result_Generic.cs
Module_Core/Models/Core/Model_Dao_Result.cs
Module_Core/Models/Core/Model_HelpContent.cs
Module_Core/Models/Enums/Enum_DataSourceType.cs
Module_Core/Models/Enums/Enum_ErrorSeverity.cs
Module_Core/Models/Enums/Enum_HelpSeverity.cs
Module_Core/Models/Enums/Enum_HelpType.cs
Module_Core/Models/Enums/Enum_InfoBarSeverity.cs
Module_Core/Models/Enums/Enum_LabelType.cs
Module_Core/Models/Enums/Enum_PackageType.cs
Module_Core/Models/Enums/Enum_ReceivingWorkflowStep.cs
Module_Core/Models/Enums/Enum_ValidationSeverity.cs
Module_Core/Models/InforVisual/Model_InforVisualConnection.cs
Module_Core/Models/InforVisual/Model_InforVisualPart.cs
Module_Core/Models/InforVisual/Model_InforVisualPO.cs
Module_Core/Models/Reporting/Model_ReportRow.cs
Module_Core/Models/Systems/Model_AppSettings.cs
Module_Core/Models/Systems/Model_AuthenticationResult.cs
Module_Core/Models/Systems/Model_CreateUserResult.cs
Module_Core/Models/Systems/Model_SessionTimedOutEventArgs.cs
Module_Core/Models/Systems/Model_User.cs
Module_Core/Models/Systems/Model_UserSession.cs
Module_Core/Models/Systems/Model_ValidationResult.cs
Module_Core/Models/Systems/Model_WorkstationConfig.cs
Module_Core/Services/Authentication/Service_Authentication.cs
Module_Core/Services/Authentication/Service_UserSessionManager.cs
Module_Core/Services/Database/Service_ErrorHandler.cs
Module_Core/Services/Database/Service_InforVisualConnect.cs
Module_Core/Services/Database/Service_LoggingUtility.cs
Module_Core/Services/Help/Service_Help.cs
Module_Core/Services/Navigation/Service_Navigation.cs
Module_Core/Services/Service_Dispatcher.cs
Module_Core/Services/Service_DispatcherTimerWrapper.cs
Module_Core/Services/Service_Focus.cs
Module_Core/Services/Service_Notification.cs
Module_Core/Services/Service_Pagination.cs
Module_Core/Services/Service_Window.cs
Module_Core/Services/Startup/Service_OnStartup_AppLifecycle.cs
Module_Core/Services/UI/Service_ViewModelRegistry.cs
Module_Core/Themes/MaterialIcons.xaml
Module_Dunnage/Contracts/IService_DunnageAdminWorkflow.cs
Module_Dunnage/Contracts/IService_DunnageCSVWriter.cs
Module_Dunnage/Contracts/IService_DunnageWorkflow.cs
Module_Dunnage/Contracts/IService_MySQL_Dunnage.cs
Module_Dunnage/Data/Dao_DunnageCustomField.cs
Module_Dunnage/Data/Dao_DunnageLine.cs
Module_Dunnage/Data/Dao_DunnageLoad.cs
Module_Dunnage/Data/Dao_DunnagePart.cs
Module_Dunnage/Data/Dao_DunnageSpec.cs
Module_Dunnage/Data/Dao_DunnageType.cs
Module_Dunnage/Data/Dao_DunnageUserPreference.cs
Module_Dunnage/Data/Dao_InventoriedDunnage.cs
Module_Dunnage/Enums/Enum_DunnageAdminSection.cs
Module_Dunnage/Enums/Enum_DunnageWorkflowStep.cs
Module_Dunnage/Models/Model_CustomFieldDefinition.cs
Module_Dunnage/Models/Model_DunnageLine.cs
Module_Dunnage/Models/Model_DunnageLoad.cs
Module_Dunnage/Models/Model_DunnagePart.cs
Module_Dunnage/Models/Model_DunnageSession.cs
Module_Dunnage/Models/Model_DunnageSpec.cs
Module_Dunnage/Models/Model_DunnageType.cs
Module_Dunnage/Models/Model_IconDefinition.cs
Module_Dunnage/Models/Model_InventoriedDunnage.cs
Module_Dunnage/Models/Model_SpecInput.cs
Module_Dunnage/Models/Model_SpecItem.cs
Module_Dunnage/Models/SpecDefinition.cs
Module_Dunnage/Services/Service_DunnageAdminWorkflow.cs
Module_Dunnage/Services/Service_DunnageCSVWriter.cs
Module_Dunnage/Services/Service_DunnageWorkflow.cs
Module_Dunnage/Services/Service_MySQL_Dunnage.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_AddTypeDialogViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_AdminInventoryViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_AdminMainViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_AdminPartsViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_AdminTypesViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_DetailsEntryViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_EditModeViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_ManualEntryViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_ModeSelectionViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_PartSelectionViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_QuantityEntryViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_ReviewViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_TypeSelectionViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_WorkFlowViewModel.cs
Module_Dunnage/Views/View_Dunnage_AdminInventoryView.xaml
Module_Dunnage/Views/View_Dunnage_AdminInventoryView.xaml.cs
Module_Dunnage/Views/View_Dunnage_AdminMainView.xaml
Module_Dunnage/Views/View_Dunnage_AdminMainView.xaml.cs
Module_Dunnage/Views/View_Dunnage_AdminPartsView.xaml
Module_Dunnage/Views/View_Dunnage_AdminPartsView.xaml.cs
Module_Dunnage/Views/View_Dunnage_AdminTypesView.xaml
Module_Dunnage/Views/View_Dunnage_AdminTypesView.xaml.cs
Module_Dunnage/Views/View_Dunnage_Control_IconPickerControl.xaml
Module_Dunnage/Views/View_Dunnage_Control_IconPickerControl.xaml.cs
Module_Dunnage/Views/View_Dunnage_DetailsEntryView.xaml
Module_Dunnage/Views/View_Dunnage_DetailsEntryView.xaml.cs
Module_Dunnage/Views/View_Dunnage_Dialog_AddMultipleRowsDialog.xaml
Module_Dunnage/Views/View_Dunnage_Dialog_AddMultipleRowsDialog.xaml.cs
Module_Dunnage/Views/View_Dunnage_Dialog_AddToInventoriedListDialog.xaml
Module_Dunnage/Views/View_Dunnage_Dialog_AddToInventoriedListDialog.xaml.cs
Module_Dunnage/Views/View_Dunnage_Dialog_Dunnage_AddTypeDialog.xaml
Module_Dunnage/Views/View_Dunnage_Dialog_Dunnage_AddTypeDialog.xaml.cs
Module_Dunnage/Views/View_Dunnage_EditModeView.xaml
Module_Dunnage/Views/View_Dunnage_EditModeView.xaml.cs
Module_Dunnage/Views/View_Dunnage_ManualEntryView.xaml
Module_Dunnage/Views/View_Dunnage_ManualEntryView.xaml.cs
Module_Dunnage/Views/View_Dunnage_ModeSelectionView.xaml
Module_Dunnage/Views/View_Dunnage_ModeSelectionView.xaml.cs
Module_Dunnage/Views/View_Dunnage_PartSelectionView.xaml
Module_Dunnage/Views/View_Dunnage_PartSelectionView.xaml.cs
Module_Dunnage/Views/View_Dunnage_QuantityEntryView.xaml
Module_Dunnage/Views/View_Dunnage_QuantityEntryView.xaml.cs
Module_Dunnage/Views/View_Dunnage_QuickAddPartDialog.xaml
Module_Dunnage/Views/View_Dunnage_QuickAddPartDialog.xaml.cs
Module_Dunnage/Views/View_Dunnage_QuickAddTypeDialog.xaml
Module_Dunnage/Views/View_Dunnage_QuickAddTypeDialog.xaml.cs
Module_Dunnage/Views/View_Dunnage_ReviewView.xaml
Module_Dunnage/Views/View_Dunnage_ReviewView.xaml.cs
Module_Dunnage/Views/View_Dunnage_TypeSelectionView.xaml
Module_Dunnage/Views/View_Dunnage_TypeSelectionView.xaml.cs
Module_Dunnage/Views/View_Dunnage_WorkflowView.xaml
Module_Dunnage/Views/View_Dunnage_WorkflowView.xaml.cs
Module_Receiving/Contracts/IService_MySQL_PackagePreferences.cs
Module_Receiving/Contracts/IService_MySQL_Receiving.cs
Module_Receiving/Contracts/IService_MySQL_ReceivingLine.cs
Module_Receiving/Contracts/IService_ReceivingValidation.cs
Module_Receiving/Contracts/IService_ReceivingWorkflow.cs
Module_Receiving/Data/Dao_PackageTypePreference.cs
Module_Receiving/Data/Dao_ReceivingLine.cs
Module_Receiving/Data/Dao_ReceivingLoad.cs
Module_Receiving/Models/Model_Application_Variables.cs
Module_Receiving/Models/Model_CSVDeleteResult.cs
Module_Receiving/Models/Model_CSVExistenceResult.cs
Module_Receiving/Models/Model_CSVWriteResult.cs
Module_Receiving/Models/Model_InforVisualPart.cs
Module_Receiving/Models/Model_InforVisualPO.cs
Module_Receiving/Models/Model_PackageTypePreference.cs
Module_Receiving/Models/Model_ReceivingLine.cs
Module_Receiving/Models/Model_ReceivingLoad.cs
Module_Receiving/Models/Model_ReceivingSession.cs
Module_Receiving/Models/Model_ReceivingValidationResult.cs
Module_Receiving/Models/Model_ReceivingWorkflowStepResult.cs
Module_Receiving/Models/Model_SaveResult.cs
Module_Receiving/Models/Model_UserPreference.cs
Module_Receiving/Models/Model_WorkflowStepResult.cs
Module_Receiving/Services/Service_CSVWriter.cs
Module_Receiving/Services/Service_MySQL_PackagePreferences.cs
Module_Receiving/Services/Service_MySQL_Receiving.cs
Module_Receiving/Services/Service_MySQL_ReceivingLine.cs
Module_Receiving/Services/Service_ReceivingValidation.cs
Module_Receiving/Services/Service_ReceivingWorkflow.cs
Module_Receiving/Services/Service_SessionManager.cs
Module_Receiving/ViewModels/ViewModel_Receiving_EditMode.cs
Module_Receiving/ViewModels/ViewModel_Receiving_HeatLot.cs
Module_Receiving/ViewModels/ViewModel_Receiving_LoadEntry.cs
Module_Receiving/ViewModels/ViewModel_Receiving_ManualEntry.cs
Module_Receiving/ViewModels/ViewModel_Receiving_ModeSelection.cs
Module_Receiving/ViewModels/ViewModel_Receiving_PackageType.cs
Module_Receiving/ViewModels/ViewModel_Receiving_POEntry.cs
Module_Receiving/ViewModels/ViewModel_Receiving_Review.cs
Module_Receiving/ViewModels/ViewModel_Receiving_WeightQuantity.cs
Module_Receiving/ViewModels/ViewModel_Receiving_Workflow.cs
Module_Receiving/Views/View_Receiving_EditMode.xaml
Module_Receiving/Views/View_Receiving_EditMode.xaml.cs
Module_Receiving/Views/View_Receiving_HeatLot.xaml
Module_Receiving/Views/View_Receiving_HeatLot.xaml.cs
Module_Receiving/Views/View_Receiving_LoadEntry.xaml
Module_Receiving/Views/View_Receiving_LoadEntry.xaml.cs
Module_Receiving/Views/View_Receiving_ManualEntry.xaml
Module_Receiving/Views/View_Receiving_ManualEntry.xaml.cs
Module_Receiving/Views/View_Receiving_ModeSelection.xaml
Module_Receiving/Views/View_Receiving_ModeSelection.xaml.cs
Module_Receiving/Views/View_Receiving_PackageType.xaml
Module_Receiving/Views/View_Receiving_PackageType.xaml.cs
Module_Receiving/Views/View_Receiving_POEntry.xaml
Module_Receiving/Views/View_Receiving_POEntry.xaml.cs
Module_Receiving/Views/View_Receiving_Review.xaml
Module_Receiving/Views/View_Receiving_Review.xaml.cs
Module_Receiving/Views/View_Receiving_WeightQuantity.xaml
Module_Receiving/Views/View_Receiving_WeightQuantity.xaml.cs
Module_Receiving/Views/View_Receiving_Workflow.xaml
Module_Receiving/Views/View_Receiving_Workflow.xaml.cs
Module_Reporting/Contracts/IService_Reporting.cs
Module_Reporting/Data/Dao_Reporting.cs
Module_Reporting/Services/Service_Reporting.cs
Module_Reporting/ViewModels/ViewModel_Reporting_Main.cs
Module_Reporting/Views/View_Reporting_Main.xaml
Module_Reporting/Views/View_Reporting_Main.xaml.cs
Module_Routing/Constants/Constant_Routing.cs
Module_Routing/Constants/Constant_RoutingConfiguration.cs
Module_Routing/Converters/IntToFontWeightConverter.cs
Module_Routing/Converters/IntToProgressBrushConverter.cs
Module_Routing/Converters/NullToBooleanConverter.cs
Module_Routing/Data/Dao_InforVisualPO.cs
Module_Routing/Data/Dao_RoutingLabel.cs
Module_Routing/Data/Dao_RoutingLabelHistory.cs
Module_Routing/Data/Dao_RoutingOtherReason.cs
Module_Routing/Data/Dao_RoutingRecipient.cs
Module_Routing/Data/Dao_RoutingUsageTracking.cs
Module_Routing/Data/Dao_RoutingUserPreference.cs
Module_Routing/Enums/Enum_Routing_WorkflowStep.cs
Module_Routing/Enums/Enum_RoutingMode.cs
Module_Routing/Interfaces/IDao_RoutingLabel.cs
Module_Routing/Interfaces/IDao_RoutingLabelHistory.cs
Module_Routing/Interfaces/IDao_RoutingRecipient.cs
Module_Routing/Interfaces/IDao_RoutingUsageTracking.cs
Module_Routing/Models/Model_InforVisualPOLine.cs
Module_Routing/Models/Model_RoutingLabel.cs
Module_Routing/Models/Model_RoutingLabelHistory.cs
Module_Routing/Models/Model_RoutingOtherReason.cs
Module_Routing/Models/Model_RoutingRecipient.cs
Module_Routing/Models/Model_RoutingUsageTracking.cs
Module_Routing/Models/Model_RoutingUserPreference.cs
Module_Routing/Services/IRoutingInforVisualService.cs
Module_Routing/Services/IRoutingRecipientService.cs
Module_Routing/Services/IRoutingService.cs
Module_Routing/Services/IRoutingUsageTrackingService.cs
Module_Routing/Services/IRoutingUserPreferenceService.cs
Module_Routing/Services/RoutingInforVisualService.cs
Module_Routing/Services/RoutingRecipientService.cs
Module_Routing/Services/RoutingService.cs
Module_Routing/Services/RoutingUsageTrackingService.cs
Module_Routing/Services/RoutingUserPreferenceService.cs
Module_Routing/ViewModels/RoutingEditModeViewModel.cs
Module_Routing/ViewModels/RoutingManualEntryViewModel.cs
Module_Routing/ViewModels/RoutingModeSelectionViewModel.cs
Module_Routing/ViewModels/RoutingWizardContainerViewModel.cs
Module_Routing/ViewModels/RoutingWizardStep1ViewModel.cs
Module_Routing/ViewModels/RoutingWizardStep2ViewModel.cs
Module_Routing/ViewModels/RoutingWizardStep3ViewModel.cs
Module_Routing/Views/RoutingEditModeView.xaml
Module_Routing/Views/RoutingEditModeView.xaml.cs
Module_Routing/Views/RoutingManualEntryView.xaml
Module_Routing/Views/RoutingManualEntryView.xaml.cs
Module_Routing/Views/RoutingModeSelectionView.xaml
Module_Routing/Views/RoutingModeSelectionView.xaml.cs
Module_Routing/Views/RoutingWizardContainerView.xaml
Module_Routing/Views/RoutingWizardContainerView.xaml.cs
Module_Routing/Views/RoutingWizardStep1View.xaml
Module_Routing/Views/RoutingWizardStep1View.xaml.cs
Module_Routing/Views/RoutingWizardStep2View.xaml
Module_Routing/Views/RoutingWizardStep2View.xaml.cs
Module_Routing/Views/RoutingWizardStep3View.xaml
Module_Routing/Views/RoutingWizardStep3View.xaml.cs
Module_Settings/Data/Dao_PackageType.cs
Module_Settings/Data/Dao_PackageTypeMappings.cs
Module_Settings/Data/Dao_RoutingRule.cs
Module_Settings/Data/Dao_ScheduledReport.cs
Module_Settings/Data/Dao_SettingsAuditLog.cs
Module_Settings/Data/Dao_SystemSettings.cs
Module_Settings/Data/Dao_UserSettings.cs
Module_Settings/Enums/Enum_SettingsWorkflowStep.cs
Module_Settings/Interfaces/IService_SettingsWorkflow.cs
Module_Settings/Interfaces/IService_UserPreferences.cs
Module_Settings/Models/Model_ConnectionTestResult.cs
Module_Settings/Models/Model_DaoTestResult.cs
Module_Settings/Models/Model_PackageType.cs
Module_Settings/Models/Model_PackageTypeMapping.cs
Module_Settings/Models/Model_RoutingRule.cs
Module_Settings/Models/Model_ScheduledReport.cs
Module_Settings/Models/Model_SettingsAuditLog.cs
Module_Settings/Models/Model_SettingValue.cs
Module_Settings/Models/Model_StoredProcedureTestResult.cs
Module_Settings/Models/Model_SystemSetting.cs
Module_Settings/Models/Model_TableTestResult.cs
Module_Settings/Models/Model_UserSetting.cs
Module_Settings/Services/Service_SettingsWorkflow.cs
Module_Settings/Services/Service_UserPreferences.cs
Module_Settings/ViewModels/ViewModel_Settings_DatabaseTest.cs
Module_Settings/Views/View_Settings_DatabaseTest.xaml
Module_Settings/Views/View_Settings_DatabaseTest.xaml.cs
Module_Shared/ViewModels/ViewModel_Shared_Base.cs
Module_Shared/ViewModels/ViewModel_Shared_HelpDialog.cs
Module_Shared/ViewModels/ViewModel_Shared_MainWindow.cs
Module_Shared/ViewModels/ViewModel_Shared_NewUserSetup.cs
Module_Shared/ViewModels/ViewModel_Shared_SharedTerminalLogin.cs
Module_Shared/ViewModels/ViewModel_Shared_SplashScreen.cs
Module_Shared/Views/View_Shared_HelpDialog.xaml
Module_Shared/Views/View_Shared_HelpDialog.xaml.cs
Module_Shared/Views/View_Shared_IconSelectorWindow.xaml
Module_Shared/Views/View_Shared_IconSelectorWindow.xaml.cs
Module_Shared/Views/View_Shared_NewUserSetupDialog.xaml
Module_Shared/Views/View_Shared_NewUserSetupDialog.xaml.cs
Module_Shared/Views/View_Shared_SharedTerminalLoginDialog.xaml
Module_Shared/Views/View_Shared_SharedTerminalLoginDialog.xaml.cs
Module_Shared/Views/View_Shared_SplashScreenWindow.xaml
Module_Shared/Views/View_Shared_SplashScreenWindow.xaml.cs
Module_Volvo/Contracts/IService_Volvo.cs
Module_Volvo/Contracts/IService_VolvoMasterData.cs
Module_Volvo/Data/Dao_VolvoPart.cs
Module_Volvo/Data/Dao_VolvoPartComponent.cs
Module_Volvo/Data/Dao_VolvoSettings.cs
Module_Volvo/Data/Dao_VolvoShipment.cs
Module_Volvo/Data/Dao_VolvoShipmentLine.cs
Module_Volvo/Interfaces/IDao_VolvoPart.cs
Module_Volvo/Interfaces/IDao_VolvoShipment.cs
Module_Volvo/Interfaces/IDao_VolvoShipmentLine.cs
Module_Volvo/Models/Model_EmailRecipient.cs
Module_Volvo/Models/Model_VolvoEmailData.cs
Module_Volvo/Models/Model_VolvoPart.cs
Module_Volvo/Models/Model_VolvoPartComponent.cs
Module_Volvo/Models/Model_VolvoSetting.cs
Module_Volvo/Models/Model_VolvoShipment.cs
Module_Volvo/Models/Model_VolvoShipmentLine.cs
Module_Volvo/Models/VolvoShipmentStatus.cs
Module_Volvo/Services/IService_VolvoAuthorization.cs
Module_Volvo/Services/Service_Volvo.cs
Module_Volvo/Services/Service_VolvoAuthorization.cs
Module_Volvo/Services/Service_VolvoMasterData.cs
Module_Volvo/ViewModels/ViewModel_Volvo_History.cs
Module_Volvo/ViewModels/ViewModel_Volvo_Settings.cs
Module_Volvo/ViewModels/ViewModel_Volvo_ShipmentEntry.cs
Module_Volvo/Views/View_Volvo_History.xaml
Module_Volvo/Views/View_Volvo_History.xaml.cs
Module_Volvo/Views/View_Volvo_Settings.xaml
Module_Volvo/Views/View_Volvo_Settings.xaml.cs
Module_Volvo/Views/View_Volvo_ShipmentEntry.xaml
Module_Volvo/Views/View_Volvo_ShipmentEntry.xaml.cs
Module_Volvo/Views/VolvoPartAddEditDialog.xaml
Module_Volvo/Views/VolvoPartAddEditDialog.xaml.cs
Module_Volvo/Views/VolvoShipmentEditDialog.xaml
Module_Volvo/Views/VolvoShipmentEditDialog.xaml.cs
MTM_Receiving_Application.Tests/Fixtures/DatabaseFixture.cs
MTM_Receiving_Application.Tests/Fixtures/ServiceCollectionFixture.cs
MTM_Receiving_Application.Tests/GlobalUsings.cs
MTM_Receiving_Application.Tests/Helpers/TestHelper.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_BooleanToVisibility_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_BoolToString_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_DecimalToInt_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_DecimalToString_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_DoubleToDecimal_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_EmptyStringToVisibility_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_EnumToVisibility_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_IconCodeToGlyph_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_IntToVisibility_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_LoadNumberToOneBased_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_StringFormat_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/NullableDoubleToDoubleConverter_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Data/Authentication/Dao_User_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Defaults/InforVisualDefaults_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Defaults/WorkstationDefaults_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Helpers/Database/Helper_Database_StoredProcedure_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Helpers/Database/Helper_Database_Variables_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Models/Core/Model_Dao_Result_Factory_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_AuthenticationResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_User_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_UserSession_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_ValidationResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_WorkstationConfig_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Services/Authentication/Service_Authentication_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Services/Authentication/Service_UserSessionManager_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Services/Database/Service_ErrorHandler_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Services/Help/Service_Help_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Services/UI/Service_ViewModelRegistry_Tests.cs
MTM_Receiving_Application.Tests/Module_Dunnage/Data/Dao_DunnageLoad_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Data/Dao_ReceivingLine_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Data/Dao_ReceivingLoad_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_Application_Variables_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_CSVDeleteResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_CSVExistenceResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_CSVWriteResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_InforVisualPart_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_InforVisualPO_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_PackageTypePreference_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingLine_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingLoad_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingSession_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingValidationResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingWorkflowStepResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_SaveResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_UserPreference_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_WorkflowStepResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Routing/Data/Dao_RoutingLabel_Tests.cs
MTM_Receiving_Application.Tests/Module_Settings/Data/Dao_PackageType_Tests.cs
MTM_Receiving_Application.Tests/UnitTest1.cs</directory_structure><files>This section contains the contents of the repository&apos;s files.<file path="App.xaml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;Application
    x:Class=&quot;MTM_Receiving_Application.App&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:local=&quot;using:MTM_Receiving_Application&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Converters&quot;&gt;
    &lt;Application.Resources&gt;
        &lt;ResourceDictionary&gt;
            &lt;ResourceDictionary.MergedDictionaries&gt;
                &lt;XamlControlsResources xmlns=&quot;using:Microsoft.UI.Xaml.Controls&quot; /&gt;
                &lt;ResourceDictionary Source=&quot;ms-appx:///Module_Core/Themes/MaterialIcons.xaml&quot;/&gt;
                &lt;!-- Other merged dictionaries here --&gt;
            &lt;/ResourceDictionary.MergedDictionaries&gt;
            &lt;!-- Other app resources here --&gt;
        &lt;/ResourceDictionary&gt;
    &lt;/Application.Resources&gt;
&lt;/Application&gt;</file><file path="Module_Core/Contracts/Services/IService_CSVWriter.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;

namespace MTM_Receiving_Application.Module_Core.Contracts.Services
{
    /// &lt;summary&gt;
    /// Service for writing receiving data to CSV files.
    /// Handles both local (%APPDATA%) and network paths with graceful fallback.
    /// &lt;/summary&gt;
    public interface IService_CSVWriter
    {
        /// &lt;summary&gt;
        /// Writes receiving loads to both local and network CSV files.
        /// Network failure does not prevent local write (graceful degradation).
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;loads&quot;&gt;List of loads to write&lt;/param&gt;
        /// &lt;returns&gt;Result object indicating success/failure for each destination&lt;/returns&gt;
        /// &lt;exception cref=&quot;ArgumentException&quot;&gt;If loads list is null or empty&lt;/exception&gt;
        /// &lt;exception cref=&quot;InvalidOperationException&quot;&gt;If local write fails (critical error)&lt;/exception&gt;
        public Task&lt;Model_CSVWriteResult&gt; WriteToCSVAsync(List&lt;Model_ReceivingLoad&gt; loads);

        /// &lt;summary&gt;
        /// Writes loads to a specific CSV file path.
        /// Used internally but exposed for testing.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;filePath&quot;&gt;Absolute path to CSV file&lt;/param&gt;
        /// &lt;param name=&quot;loads&quot;&gt;Loads to write&lt;/param&gt;
        /// &lt;param name=&quot;append&quot;&gt;Whether to append to existing file (default true)&lt;/param&gt;
        /// &lt;exception cref=&quot;InvalidOperationException&quot;&gt;If write fails&lt;/exception&gt;
        public Task WriteToFileAsync(string filePath, List&lt;Model_ReceivingLoad&gt; loads, bool append = true);

        /// &lt;summary&gt;
        /// Reads receiving loads from a CSV file.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;filePath&quot;&gt;Absolute path to CSV file&lt;/param&gt;
        /// &lt;returns&gt;List of receiving loads&lt;/returns&gt;
        /// &lt;exception cref=&quot;FileNotFoundException&quot;&gt;If file does not exist&lt;/exception&gt;
        /// &lt;exception cref=&quot;InvalidOperationException&quot;&gt;If read fails&lt;/exception&gt;
        public Task&lt;List&lt;Model_ReceivingLoad&gt;&gt; ReadFromCSVAsync(string filePath);

        /// &lt;summary&gt;
        /// Clears CSV files (used for reset on startup).
        /// &lt;/summary&gt;
        /// &lt;returns&gt;Result indicating which files were cleared&lt;/returns&gt;
        public Task&lt;Model_CSVDeleteResult&gt; ClearCSVFilesAsync();

        /// &lt;summary&gt;
        /// Checks if CSV files exist.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;Result indicating existence of local and network files&lt;/returns&gt;
        public Task&lt;Model_CSVExistenceResult&gt; CheckCSVFilesExistAsync();

        /// &lt;summary&gt;
        /// Gets the configured local CSV file path.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;Absolute path to local CSV&lt;/returns&gt;
        public string GetLocalCSVPath();

        /// &lt;summary&gt;
        /// Gets the configured network CSV file path.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;UNC path to network CSV&lt;/returns&gt;
        public string GetNetworkCSVPath();
    }
}</file><file path="Module_Core/Contracts/Services/IService_Dispatcher.cs">using System;

namespace MTM_Receiving_Application.Module_Core.Contracts.Services
{
    /// &lt;summary&gt;
    /// Interface for dispatcher operations.
    /// Wraps DispatcherQueue to allow mocking in unit tests.
    /// &lt;/summary&gt;
    public interface IService_Dispatcher
    {
        /// &lt;summary&gt;
        /// Creates a new timer on the dispatcher thread.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;A new IDispatcherTimer instance&lt;/returns&gt;
        public IService_DispatcherTimer CreateTimer();

        /// &lt;summary&gt;
        /// Enqueues a function for execution on the dispatcher thread.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;callback&quot;&gt;The function to execute&lt;/param&gt;
        /// &lt;returns&gt;True if the function was enqueued; otherwise, false.&lt;/returns&gt;
        public bool TryEnqueue(Action callback);
    }
}</file><file path="Module_Core/Contracts/Services/IService_ErrorHandler.cs">using System;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;

namespace MTM_Receiving_Application.Module_Core.Contracts.Services;

/// &lt;summary&gt;
/// Service contract for centralized error handling and user notification.
/// Implementations must log errors to file system and display user-friendly dialogs.
/// &lt;/summary&gt;
public interface IService_ErrorHandler
{
    /// &lt;summary&gt;
    /// Handles an error by logging it and optionally displaying a dialog.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;errorMessage&quot;&gt;The error message to log and display&lt;/param&gt;
    /// &lt;param name=&quot;severity&quot;&gt;The severity level of the error&lt;/param&gt;
    /// &lt;param name=&quot;exception&quot;&gt;Optional exception that caused the error&lt;/param&gt;
    /// &lt;param name=&quot;showDialog&quot;&gt;Whether to show a user-facing dialog&lt;/param&gt;
    /// &lt;returns&gt;Task for async operation&lt;/returns&gt;
    public Task HandleErrorAsync(
        string errorMessage,
        Enum_ErrorSeverity severity,
        Exception? exception = null,
        bool showDialog = true
    );

    /// &lt;summary&gt;
    /// Logs an error without displaying a dialog.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;errorMessage&quot;&gt;The error message to log&lt;/param&gt;
    /// &lt;param name=&quot;severity&quot;&gt;The severity level of the error&lt;/param&gt;
    /// &lt;param name=&quot;exception&quot;&gt;Optional exception that caused the error&lt;/param&gt;
    /// &lt;returns&gt;Task for async operation&lt;/returns&gt;
    public Task LogErrorAsync(
        string errorMessage,
        Enum_ErrorSeverity severity,
        Exception? exception = null
    );

    /// &lt;summary&gt;
    /// Displays a user-friendly error dialog.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;title&quot;&gt;Dialog title&lt;/param&gt;
    /// &lt;param name=&quot;message&quot;&gt;Error message to display&lt;/param&gt;
    /// &lt;param name=&quot;severity&quot;&gt;Severity level (affects icon/styling)&lt;/param&gt;
    /// &lt;returns&gt;Task for async operation&lt;/returns&gt;
    public Task ShowErrorDialogAsync(
        string title,
        string message,
        Enum_ErrorSeverity severity
    );

    /// &lt;summary&gt;
    /// Handles a Model_Dao_Result error by logging and optionally displaying.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;result&quot;&gt;The DAO result containing error information&lt;/param&gt;
    /// &lt;param name=&quot;operationName&quot;&gt;Name of the operation that failed&lt;/param&gt;
    /// &lt;param name=&quot;showDialog&quot;&gt;Whether to show a user-facing dialog&lt;/param&gt;
    /// &lt;returns&gt;Task for async operation&lt;/returns&gt;
    public Task HandleDaoErrorAsync(
        Model_Dao_Result result,
        string operationName,
        bool showDialog = true
    );

    // Aliases for compatibility (spec 010-dunnage-complete)

    public Task ShowUserErrorAsync(string message, string title, string method);

    public void HandleException(Exception ex, Enum_ErrorSeverity severity, string method, string className);
}</file><file path="Module_Core/Contracts/Services/IService_Help.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Receiving.Models; // For Model_WorkflowStepResult if needed
using MTM_Receiving_Application.Module_Core.Models.Enums; // For other enums if needed
namespace MTM_Receiving_Application.Module_Core.Contracts.Services;

/// &lt;summary&gt;
/// Service for providing contextual help content throughout the application
/// &lt;/summary&gt;
public interface IService_Help
{
    /// &lt;summary&gt;
    /// Displays help dialog with content for the specified key
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;helpKey&quot;&gt;The unique key for the help content&lt;/param&gt;
    public Task ShowHelpAsync(string helpKey);

    /// &lt;summary&gt;
    /// Shows help for specific dunnage workflow step
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;step&quot;&gt;The workflow step enum&lt;/param&gt;
    public Task ShowContextualHelpAsync(Enum_DunnageWorkflowStep step);

    /// &lt;summary&gt;
    /// Shows help for specific receiving workflow step
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;step&quot;&gt;The workflow step enum&lt;/param&gt;
    public Task ShowContextualHelpAsync(Enum_ReceivingWorkflowStep step);

    /// &lt;summary&gt;
    /// Retrieves help content by key without showing dialog
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;The unique help key&lt;/param&gt;
    /// &lt;returns&gt;Model_HelpContent if found, null otherwise&lt;/returns&gt;
    public Model_HelpContent? GetHelpContent(string key);

    /// &lt;summary&gt;
    /// Gets all help content for a category
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;category&quot;&gt;Category name&lt;/param&gt;
    /// &lt;returns&gt;List of help content items&lt;/returns&gt;
    public List&lt;Model_HelpContent&gt; GetHelpByCategory(string category);

    /// &lt;summary&gt;
    /// Searches help content by title or content
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;searchTerm&quot;&gt;Search string&lt;/param&gt;
    /// &lt;returns&gt;List of matching help content items&lt;/returns&gt;
    public List&lt;Model_HelpContent&gt; SearchHelp(string searchTerm);

    /// &lt;summary&gt;
    /// Checks if user has dismissed a tip/help permanently
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;helpKey&quot;&gt;The help key to check&lt;/param&gt;
    /// &lt;returns&gt;true if dismissed, false otherwise&lt;/returns&gt;
    public Task&lt;bool&gt; IsDismissedAsync(string helpKey);

    /// &lt;summary&gt;
    /// Sets whether a tip/help is dismissed
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;helpKey&quot;&gt;The help key&lt;/param&gt;
    /// &lt;param name=&quot;isDismissed&quot;&gt;Whether it should be dismissed&lt;/param&gt;
    public Task SetDismissedAsync(string helpKey, bool isDismissed);

    /// &lt;summary&gt;
    /// Gets help content for a dunnage workflow step
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;step&quot;&gt;The workflow step&lt;/param&gt;
    public string GetDunnageWorkflowHelp(Enum_DunnageWorkflowStep step);

    /// &lt;summary&gt;
    /// Gets help content for a receiving workflow step
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;step&quot;&gt;The workflow step&lt;/param&gt;
    public string GetReceivingWorkflowHelp(Enum_ReceivingWorkflowStep step);

    /// &lt;summary&gt;
    /// Gets tip content for a specific view or feature
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;viewName&quot;&gt;The view name&lt;/param&gt;
    public string GetTip(string viewName);

    /// &lt;summary&gt;
    /// Gets placeholder text for a specific input field
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;fieldName&quot;&gt;The field name&lt;/param&gt;
    public string GetPlaceholder(string fieldName);

    /// &lt;summary&gt;
    /// Gets tooltip content for a specific UI element
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;elementName&quot;&gt;The element name&lt;/param&gt;
    public string GetTooltip(string elementName);

    /// &lt;summary&gt;
    /// Gets InfoBar message content
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;messageKey&quot;&gt;The message key&lt;/param&gt;
    public string GetInfoBarMessage(string messageKey);
}</file><file path="Module_Core/Contracts/Services/IService_InforVisual.cs">using System;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;

namespace MTM_Receiving_Application.Module_Core.Contracts.Services
{
    /// &lt;summary&gt;
    /// Service for querying Infor Visual database (SQL Server) for PO and Part information.
    /// Read-only operations only - no writes to Infor Visual.
    /// &lt;/summary&gt;
    public interface IService_InforVisual
    {
        /// &lt;summary&gt;
        /// Retrieves a purchase order with all associated parts from Infor Visual.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;poNumber&quot;&gt;6-digit PO number&lt;/param&gt;
        /// &lt;returns&gt;Result containing InforVisualPO with Parts collection, or null if not found&lt;/returns&gt;
        public Task&lt;Model_Dao_Result&lt;Model_InforVisualPO?&gt;&gt; GetPOWithPartsAsync(string poNumber);

        /// &lt;summary&gt;
        /// Retrieves part information by Part ID for non-PO items.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;partID&quot;&gt;Part identifier&lt;/param&gt;
        /// &lt;returns&gt;Result containing InforVisualPart with details, or null if not found&lt;/returns&gt;
        public Task&lt;Model_Dao_Result&lt;Model_InforVisualPart?&gt;&gt; GetPartByIDAsync(string partID);

        /// &lt;summary&gt;
        /// Queries same-day receiving transactions for a specific PO and Part.
        /// Used to warn users if part was already received today.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;poNumber&quot;&gt;PO number&lt;/param&gt;
        /// &lt;param name=&quot;partID&quot;&gt;Part identifier&lt;/param&gt;
        /// &lt;param name=&quot;date&quot;&gt;Date to query (typically DateTime.Today)&lt;/param&gt;
        /// &lt;returns&gt;Result containing Total quantity received, or 0 if no receipts found&lt;/returns&gt;
        public Task&lt;Model_Dao_Result&lt;decimal&gt;&gt; GetSameDayReceivingQuantityAsync(string poNumber, string partID, DateTime date);

        /// &lt;summary&gt;
        /// Calculates remaining quantity for a specific PO and Part.
        /// Remaining Quantity = Quantity Ordered - Quantity Received.
        /// Returns whole number only (no decimals).
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;poNumber&quot;&gt;PO number&lt;/param&gt;
        /// &lt;param name=&quot;partID&quot;&gt;Part identifier&lt;/param&gt;
        /// &lt;returns&gt;Result containing remaining quantity as integer&lt;/returns&gt;
        public Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetRemainingQuantityAsync(string poNumber, string partID);

        /// &lt;summary&gt;
        /// Validates that the Infor Visual database connection is available.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;True if connection successful, false otherwise&lt;/returns&gt;
        public Task&lt;bool&gt; TestConnectionAsync();
    }
}</file><file path="Module_Core/Contracts/Services/IService_LoggingUtility.cs">using System;
using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Core.Contracts.Services;

/// &lt;summary&gt;
/// Service contract for application logging functionality.
/// Implementations must write to file system with daily rotation.
/// &lt;/summary&gt;
public interface IService_LoggingUtility
{
    /// &lt;summary&gt;
    /// Logs an informational message.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;message&quot;&gt;The message to log&lt;/param&gt;
    /// &lt;param name=&quot;context&quot;&gt;Optional context information&lt;/param&gt;
    public void LogInfo(string message, string? context = null);

    /// &lt;summary&gt;
    /// Logs a warning message.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;message&quot;&gt;The warning message to log&lt;/param&gt;
    /// &lt;param name=&quot;context&quot;&gt;Optional context information&lt;/param&gt;
    public void LogWarning(string message, string? context = null);

    /// &lt;summary&gt;
    /// Logs an error message with optional exception.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;message&quot;&gt;The error message to log&lt;/param&gt;
    /// &lt;param name=&quot;exception&quot;&gt;Optional exception that caused the error&lt;/param&gt;
    /// &lt;param name=&quot;context&quot;&gt;Optional context information&lt;/param&gt;
    public void LogError(string message, Exception? exception = null, string? context = null);

    /// &lt;summary&gt;
    /// Logs a critical error message with optional exception.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;message&quot;&gt;The critical error message to log&lt;/param&gt;
    /// &lt;param name=&quot;exception&quot;&gt;Optional exception that caused the error&lt;/param&gt;
    /// &lt;param name=&quot;context&quot;&gt;Optional context information&lt;/param&gt;
    public void LogCritical(string message, Exception? exception = null, string? context = null);

    /// &lt;summary&gt;
    /// Logs a fatal error message with optional exception.
    /// Fatal errors indicate the application should terminate.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;message&quot;&gt;The fatal error message to log&lt;/param&gt;
    /// &lt;param name=&quot;exception&quot;&gt;Optional exception that caused the error&lt;/param&gt;
    /// &lt;param name=&quot;context&quot;&gt;Optional context information&lt;/param&gt;
    public void LogFatal(string message, Exception? exception = null, string? context = null);

    /// &lt;summary&gt;
    /// Logs an informational message asynchronously.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;
    public Task LogInfoAsync(string message, string? context = null);

    /// &lt;summary&gt;
    /// Logs a warning message asynchronously.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;
    public Task LogWarningAsync(string message, string? context = null);

    /// &lt;summary&gt;
    /// Logs an error message asynchronously.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;exception&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;
    public Task LogErrorAsync(string message, Exception? exception = null, string? context = null);

    /// &lt;summary&gt;
    /// Gets the path to the current log file.
    /// &lt;/summary&gt;
    /// &lt;returns&gt;Full path to today&apos;s log file&lt;/returns&gt;
    public string GetCurrentLogFilePath();

    /// &lt;summary&gt;
    /// Ensures the log directory exists and is writable.
    /// &lt;/summary&gt;
    /// &lt;returns&gt;True if log directory is accessible, false otherwise&lt;/returns&gt;
    public bool EnsureLogDirectoryExists();

    /// &lt;summary&gt;
    /// Archives old log files (older than specified days).
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;daysToKeep&quot;&gt;Number of days of logs to keep&lt;/param&gt;
    /// &lt;returns&gt;Number of log files archived&lt;/returns&gt;
    public int ArchiveOldLogs(int daysToKeep = 30);
}</file><file path="Module_Core/Contracts/Services/IService_Notification.cs">using System.ComponentModel;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Core.Contracts.Services;

public interface IService_Notification : INotifyPropertyChanged
{
    public string StatusMessage { get; }
    public InfoBarSeverity StatusSeverity { get; }
    public bool IsStatusOpen { get; set; }

    public void ShowStatus(string message, InfoBarSeverity severity = InfoBarSeverity.Informational);
}</file><file path="Module_Core/Contracts/Services/IService_OnStartup_AppLifecycle.cs">using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Core.Contracts.Services
{
    public interface IService_OnStartup_AppLifecycle
    {
        public Task StartAsync();
    }
}</file><file path="Module_Core/Contracts/Services/IService_Pagination.cs">using System;
using System.Collections.Generic;

namespace MTM_Receiving_Application.Module_Core.Contracts.Services
{
    public interface IService_Pagination
    {
        /// &lt;summary&gt;
        /// Gets the current page number (1-based).
        /// &lt;/summary&gt;
        public int CurrentPage { get; }

        /// &lt;summary&gt;
        /// Gets the total number of pages.
        /// &lt;/summary&gt;
        public int TotalPages { get; }

        /// &lt;summary&gt;
        /// Gets the number of items per page.
        /// &lt;/summary&gt;
        public int PageSize { get; set; }

        /// &lt;summary&gt;
        /// Gets the total number of items in the source collection.
        /// &lt;/summary&gt;
        public int TotalItems { get; }

        /// &lt;summary&gt;
        /// Gets a value indicating whether there is a next page.
        /// &lt;/summary&gt;
        public bool HasNextPage { get; }

        /// &lt;summary&gt;
        /// Gets a value indicating whether there is a previous page.
        /// &lt;/summary&gt;
        public bool HasPreviousPage { get; }

        /// &lt;summary&gt;
        /// Event raised when the current page data changes.
        /// &lt;/summary&gt;
        public event EventHandler PageChanged;

        /// &lt;summary&gt;
        /// Sets the source collection to be paginated.
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;The type of items in the collection.&lt;/typeparam&gt;
        /// &lt;param name=&quot;source&quot;&gt;The source collection.&lt;/param&gt;
        public void SetSource&lt;T&gt;(IEnumerable&lt;T&gt; source);

        /// &lt;summary&gt;
        /// Gets the items for the current page.
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;The type of items in the collection.&lt;/typeparam&gt;
        /// &lt;returns&gt;A list of items for the current page.&lt;/returns&gt;
        public IEnumerable&lt;T&gt; GetCurrentPageItems&lt;T&gt;();

        /// &lt;summary&gt;
        /// Moves to the next page.
        /// &lt;/summary&gt;
        public bool NextPage();

        /// &lt;summary&gt;
        /// Moves to the previous page.
        /// &lt;/summary&gt;
        public bool PreviousPage();

        /// &lt;summary&gt;
        /// Moves to the first page.
        /// &lt;/summary&gt;
        public bool FirstPage();

        /// &lt;summary&gt;
        /// Moves to the last page.
        /// &lt;/summary&gt;
        public bool LastPage();

        /// &lt;summary&gt;
        /// Moves to a specific page.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;pageNumber&quot;&gt;The page number to move to.&lt;/param&gt;
        public bool GoToPage(int pageNumber);
    }
}</file><file path="Module_Core/Contracts/Services/IService_SessionManager.cs">using System;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;

namespace MTM_Receiving_Application.Module_Core.Contracts.Services
{
    /// &lt;summary&gt;
    /// Service for persisting and restoring session state to/from JSON file.
    /// Session file location: %APPDATA%\MTM_Receiving_Application\session.json
    /// &lt;/summary&gt;
    public interface IService_SessionManager
    {
        /// &lt;summary&gt;
        /// Saves the current session to JSON file.
        /// Automatically creates directory if it doesn&apos;t exist.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;session&quot;&gt;Session to persist&lt;/param&gt;
        /// &lt;exception cref=&quot;ArgumentNullException&quot;&gt;If session is null&lt;/exception&gt;
        /// &lt;exception cref=&quot;InvalidOperationException&quot;&gt;If file write fails&lt;/exception&gt;
        public Task SaveSessionAsync(Model_ReceivingSession session);

        /// &lt;summary&gt;
        /// Loads the persisted session from JSON file.
        /// Returns null if no session file exists or if file is corrupted.
        /// Corrupted files are automatically deleted.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;Restored session or null&lt;/returns&gt;
        public Task&lt;Model_ReceivingSession?&gt; LoadSessionAsync();

        /// &lt;summary&gt;
        /// Deletes the persisted session file.
        /// Called after successful save to prevent stale data.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;True if deleted, false if file didn&apos;t exist&lt;/returns&gt;
        public Task&lt;bool&gt; ClearSessionAsync();

        /// &lt;summary&gt;
        /// Checks if a persisted session file exists.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;True if session file exists, false otherwise&lt;/returns&gt;
        public bool SessionExists();

        /// &lt;summary&gt;
        /// Gets the full path to the session JSON file.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;Absolute file path&lt;/returns&gt;
        public string GetSessionFilePath();
    }
}</file><file path="Module_Core/Contracts/Services/IService_UserSessionManager.cs">using System;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Systems;

namespace MTM_Receiving_Application.Module_Core.Contracts.Services
{
    /// &lt;summary&gt;
    /// Service contract for user session management and timeout monitoring.
    /// &lt;/summary&gt;
    public interface IService_UserSessionManager
    {
        /// &lt;summary&gt;
        /// Gets the current active user session.
        /// &lt;/summary&gt;
        public Model_UserSession? CurrentSession { get; }

        /// &lt;summary&gt;
        /// Creates a new user session.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;user&quot;&gt;Authenticated user&lt;/param&gt;
        /// &lt;param name=&quot;workstationConfig&quot;&gt;Workstation configuration&lt;/param&gt;
        /// &lt;param name=&quot;authenticationMethod&quot;&gt;Method used for authentication&lt;/param&gt;
        /// &lt;returns&gt;The created session&lt;/returns&gt;
        public Model_UserSession CreateSession(
            Model_User user,
            Model_WorkstationConfig workstationConfig,
            string authenticationMethod);

        /// &lt;summary&gt;
        /// Updates the last activity timestamp to prevent timeout.
        /// &lt;/summary&gt;
        public void UpdateLastActivity();

        /// &lt;summary&gt;
        /// Starts the session timeout monitoring timer.
        /// &lt;/summary&gt;
        public void StartTimeoutMonitoring();

        /// &lt;summary&gt;
        /// Stops the session timeout monitoring timer.
        /// &lt;/summary&gt;
        public void StopTimeoutMonitoring();

        /// &lt;summary&gt;
        /// Checks if the current session has timed out.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;True if timed out, false otherwise&lt;/returns&gt;
        public bool IsSessionTimedOut();

        /// &lt;summary&gt;
        /// Ends the current session and logs the reason.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;reason&quot;&gt;Reason for ending session&lt;/param&gt;
        public Task EndSessionAsync(string reason);

        /// &lt;summary&gt;
        /// Event raised when the session times out.
        /// &lt;/summary&gt;
        public event EventHandler&lt;Model_SessionTimedOutEventArgs&gt; SessionTimedOut;
    }
}</file><file path="Module_Core/Contracts/Services/IService_ViewModelRegistry.cs">using System.Collections.Generic;

namespace MTM_Receiving_Application.Module_Core.Contracts.Services
{
    public interface IService_ViewModelRegistry
    {
        public void Register(object viewModel);
        public IEnumerable&lt;T&gt; GetViewModels&lt;T&gt;();
        public void ClearAllInputs();
    }
}</file><file path="Module_Core/Contracts/Services/ITimer.cs">using System;

namespace MTM_Receiving_Application.Module_Core.Contracts.Services
{
    /// &lt;summary&gt;
    /// Interface for a timer that can be used for scheduling tasks.
    /// Wraps DispatcherQueueTimer to allow mocking in unit tests.
    /// &lt;/summary&gt;
    public interface IService_DispatcherTimer
    {
        /// &lt;summary&gt;
        /// Gets or sets the amount of time between timer ticks.
        /// &lt;/summary&gt;
        public TimeSpan Interval { get; set; }

        /// &lt;summary&gt;
        /// Gets or sets a value that indicates whether the timer repeats.
        /// &lt;/summary&gt;
        public bool IsRepeating { get; set; }

        /// &lt;summary&gt;
        /// Gets a value that indicates whether the timer is running.
        /// &lt;/summary&gt;
        public bool IsRunning { get; }

        /// &lt;summary&gt;
        /// Occurs when the timer interval has elapsed.
        /// &lt;/summary&gt;
        public event EventHandler&lt;object&gt; Tick;

        /// &lt;summary&gt;
        /// Starts the timer.
        /// &lt;/summary&gt;
        public void Start();

        /// &lt;summary&gt;
        /// Stops the timer.
        /// &lt;/summary&gt;
        public void Stop();
    }
}</file><file path="Module_Core/Contracts/Services/IWindowService.cs">using Microsoft.UI.Xaml;

namespace MTM_Receiving_Application.Module_Core.Contracts.Services;

public interface IService_Window
{
    public XamlRoot? GetXamlRoot();
}</file><file path="Module_Core/Contracts/Services/Navigation/IService_Navigation.cs">using Microsoft.UI.Xaml.Controls;
using System;

namespace MTM_Receiving_Application.Module_Core.Contracts.Services.Navigation;

/// &lt;summary&gt;
/// Service for handling page navigation
/// &lt;/summary&gt;
public interface IService_Navigation
{
    /// &lt;summary&gt;
    /// Navigate to a page type
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;frame&quot;&gt;The frame to navigate in&lt;/param&gt;
    /// &lt;param name=&quot;pageType&quot;&gt;The type of page to navigate to&lt;/param&gt;
    /// &lt;param name=&quot;parameter&quot;&gt;Optional navigation parameter&lt;/param&gt;
    /// &lt;returns&gt;True if navigation succeeded&lt;/returns&gt;
    public bool NavigateTo(Frame frame, Type pageType, object? parameter = null);

    /// &lt;summary&gt;
    /// Navigate to a page type by name
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;frame&quot;&gt;The frame to navigate in&lt;/param&gt;
    /// &lt;param name=&quot;pageTypeName&quot;&gt;Full name of the page type&lt;/param&gt;
    /// &lt;param name=&quot;parameter&quot;&gt;Optional navigation parameter&lt;/param&gt;
    /// &lt;returns&gt;True if navigation succeeded&lt;/returns&gt;
    public bool NavigateTo(Frame frame, string pageTypeName, object? parameter = null);

    /// &lt;summary&gt;
    /// Clear the navigation frame
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;frame&quot;&gt;The frame to clear&lt;/param&gt;
    public void ClearNavigation(Frame frame);

    /// &lt;summary&gt;
    /// Check if navigation can go back
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;frame&quot;&gt;&lt;/param&gt;
    public bool CanGoBack(Frame frame);

    /// &lt;summary&gt;
    /// Navigate back
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;frame&quot;&gt;&lt;/param&gt;
    public void GoBack(Frame frame);
}</file><file path="Module_Core/Data/InforVisual/Dao_InforVisualConnection.cs">using Microsoft.Data.SqlClient;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.InforVisual;
using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Core.Data.InforVisual;

/// &lt;summary&gt;
/// Data Access Object for Infor Visual database connections and queries
/// WARNING: READ-ONLY ACCESS ONLY - NO WRITES PERMITTED
/// &lt;/summary&gt;
public class Dao_InforVisualConnection
{
    private readonly string _connectionString;
    private readonly string _siteId;
    private readonly IService_LoggingUtility? _logger;

    public Dao_InforVisualConnection(string connectionString, IService_LoggingUtility? logger = null, string siteId = &quot;002&quot;)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
        _siteId = siteId;
        _logger = logger;
    }

    #region Connection Management

    /// &lt;summary&gt;
    /// Tests connection to Infor Visual database
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&lt;bool&gt;&gt; TestConnectionAsync()
    {
        try
        {
            _logger?.LogInfo(&quot;Testing Infor Visual connection...&quot;);
            await using var connection = new SqlConnection(_connectionString);
            await connection.OpenAsync();
            bool isConnected = connection.State == ConnectionState.Open;
            _logger?.LogInfo($&quot;Infor Visual connection test result: {isConnected}&quot;);
            return Model_Dao_Result_Factory.Success(isConnected);
        }
        catch (Exception ex)
        {
            _logger?.LogError($&quot;Connection test failed: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;bool&gt;(
                $&quot;Connection test failed: {ex.Message}&quot;, ex);
        }
    }

    #endregion

    #region Purchase Order Queries

    /// &lt;summary&gt;
    /// Retrieves PO with all line items and parts
    /// Uses: 01_GetPOWithParts.sql
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_InforVisualPO&gt;&gt;&gt; GetPOWithPartsAsync(string poNumber)
    {
        try
        {
            _logger?.LogInfo($&quot;Retrieving PO with parts: {poNumber}&quot;);
            var query = Helper_SqlQueryLoader.LoadAndPrepareQuery(&quot;01_GetPOWithParts.sql&quot;);

            await using var connection = new SqlConnection(_connectionString);
            await connection.OpenAsync();

            await using var command = new SqlCommand(query, connection);
            command.Parameters.AddWithValue(&quot;@PoNumber&quot;, poNumber);

            var poLines = new List&lt;Model_InforVisualPO&gt;();
            await using var reader = await command.ExecuteReaderAsync();

            while (await reader.ReadAsync())
            {
                poLines.Add(new Model_InforVisualPO
                {
                    PoNumber = reader[&quot;PoNumber&quot;].ToString() ?? string.Empty,
                    PoLine = Convert.ToInt32(reader[&quot;PoLine&quot;]),
                    PartNumber = reader[&quot;PartNumber&quot;].ToString() ?? string.Empty,
                    PartDescription = reader[&quot;PartDescription&quot;].ToString() ?? string.Empty,
                    OrderedQty = Convert.ToDecimal(reader[&quot;OrderedQty&quot;]),
                    ReceivedQty = Convert.ToDecimal(reader[&quot;ReceivedQty&quot;]),
                    RemainingQty = Convert.ToDecimal(reader[&quot;RemainingQty&quot;]),
                    UnitOfMeasure = reader[&quot;UnitOfMeasure&quot;].ToString() ?? &quot;EA&quot;,
                    DueDate = reader[&quot;DueDate&quot;] as DateTime?,
                    VendorCode = reader[&quot;VendorCode&quot;].ToString() ?? string.Empty,
                    VendorName = reader[&quot;VendorName&quot;].ToString() ?? string.Empty,
                    PoStatus = reader[&quot;PoStatus&quot;].ToString() ?? string.Empty,
                    SiteId = reader[&quot;SiteId&quot;].ToString() ?? &quot;002&quot;
                });
            }

            _logger?.LogInfo($&quot;Retrieved {poLines.Count} lines for PO {poNumber}&quot;);
            return Model_Dao_Result_Factory.Success(poLines);
        }
        catch (Exception ex)
        {
            _logger?.LogError($&quot;Error retrieving PO {poNumber}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_InforVisualPO&gt;&gt;(
                $&quot;Error retrieving PO {poNumber}: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Validates if a PO number exists
    /// Uses: 02_ValidatePONumber.sql
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;bool&gt;&gt; ValidatePoNumberAsync(string poNumber)
    {
        try
        {
            _logger?.LogInfo($&quot;Validating PO number: {poNumber}&quot;);
            var query = Helper_SqlQueryLoader.LoadAndPrepareQuery(&quot;02_ValidatePONumber.sql&quot;);

            await using var connection = new SqlConnection(_connectionString);
            await connection.OpenAsync();

            await using var command = new SqlCommand(query, connection);
            command.Parameters.AddWithValue(&quot;@PoNumber&quot;, poNumber);

            var count = (int?)await command.ExecuteScalarAsync() ?? 0;
            bool isValid = count &gt; 0;
            _logger?.LogInfo($&quot;PO validation result for {poNumber}: {isValid}&quot;);
            return Model_Dao_Result_Factory.Success(isValid);
        }
        catch (Exception ex)
        {
            _logger?.LogError($&quot;Error validating PO {poNumber}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;bool&gt;(
                $&quot;Error validating PO {poNumber}: {ex.Message}&quot;, ex);
        }
    }

    #endregion

    #region Part Queries

    /// &lt;summary&gt;
    /// Retrieves part details by part number
    /// Uses: 03_GetPartByNumber.sql
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;partNumber&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_InforVisualPart?&gt;&gt; GetPartByNumberAsync(string partNumber)
    {
        try
        {
            _logger?.LogInfo($&quot;Retrieving part by number: {partNumber}&quot;);
            var query = Helper_SqlQueryLoader.LoadAndPrepareQuery(&quot;03_GetPartByNumber.sql&quot;);

            await using var connection = new SqlConnection(_connectionString);
            await connection.OpenAsync();

            await using var command = new SqlCommand(query, connection);
            command.Parameters.AddWithValue(&quot;@PartNumber&quot;, partNumber);

            await using var reader = await command.ExecuteReaderAsync();

            if (await reader.ReadAsync())
            {
                var part = new Model_InforVisualPart
                {
                    PartNumber = reader[&quot;PartNumber&quot;].ToString() ?? string.Empty,
                    Description = reader[&quot;Description&quot;].ToString() ?? string.Empty,
                    UnitCost = reader[&quot;UnitCost&quot;] != DBNull.Value ? Convert.ToDecimal(reader[&quot;UnitCost&quot;]) : 0,
                    PrimaryUom = reader[&quot;PrimaryUom&quot;].ToString() ?? &quot;EA&quot;,
                    OnHandQty = Convert.ToDecimal(reader[&quot;OnHandQty&quot;]),
                    AllocatedQty = Convert.ToDecimal(reader[&quot;AllocatedQty&quot;]),
                    AvailableQty = Convert.ToDecimal(reader[&quot;AvailableQty&quot;]),
                    DefaultSite = reader[&quot;DefaultSite&quot;].ToString() ?? string.Empty,
                    PartStatus = reader[&quot;PartStatus&quot;].ToString() ?? string.Empty,
                    ProductLine = reader[&quot;ProductLine&quot;].ToString() ?? string.Empty
                };
                _logger?.LogInfo($&quot;Found part: {partNumber}&quot;);
                return Model_Dao_Result_Factory.Success&lt;Model_InforVisualPart?&gt;(part);
            }

            _logger?.LogWarning($&quot;Part not found: {partNumber}&quot;);
            return Model_Dao_Result_Factory.Success&lt;Model_InforVisualPart?&gt;(null);
        }
        catch (Exception ex)
        {
            _logger?.LogError($&quot;Error retrieving part {partNumber}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;Model_InforVisualPart?&gt;(
                $&quot;Error retrieving part {partNumber}: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Searches for parts by description pattern
    /// Uses: 04_SearchPartsByDescription.sql
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;searchTerm&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;maxResults&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_InforVisualPart&gt;&gt;&gt; SearchPartsByDescriptionAsync(
        string searchTerm,
        int maxResults = 50)
    {
        try
        {
            _logger?.LogInfo($&quot;Searching parts by description: &apos;{searchTerm}&apos; (Max: {maxResults})&quot;);
            var query = Helper_SqlQueryLoader.LoadAndPrepareQuery(&quot;04_SearchPartsByDescription.sql&quot;);

            await using var connection = new SqlConnection(_connectionString);
            await connection.OpenAsync();

            await using var command = new SqlCommand(query, connection);
            command.Parameters.AddWithValue(&quot;@SearchTerm&quot;, searchTerm);
            command.Parameters.AddWithValue(&quot;@MaxResults&quot;, maxResults);

            var parts = new List&lt;Model_InforVisualPart&gt;();
            await using var reader = await command.ExecuteReaderAsync();

            while (await reader.ReadAsync())
            {
                parts.Add(new Model_InforVisualPart
                {
                    PartNumber = reader[&quot;PartNumber&quot;].ToString() ?? string.Empty,
                    Description = reader[&quot;Description&quot;].ToString() ?? string.Empty,
                    UnitCost = reader[&quot;UnitCost&quot;] != DBNull.Value ? Convert.ToDecimal(reader[&quot;UnitCost&quot;]) : 0,
                    PrimaryUom = reader[&quot;PrimaryUom&quot;].ToString() ?? &quot;EA&quot;,
                    OnHandQty = Convert.ToDecimal(reader[&quot;OnHandQty&quot;]),
                    AllocatedQty = Convert.ToDecimal(reader[&quot;AllocatedQty&quot;]),
                    AvailableQty = Convert.ToDecimal(reader[&quot;AvailableQty&quot;]),
                    DefaultSite = reader[&quot;DefaultSite&quot;].ToString() ?? string.Empty,
                    PartStatus = reader[&quot;PartStatus&quot;].ToString() ?? string.Empty,
                    ProductLine = reader[&quot;ProductLine&quot;].ToString() ?? string.Empty
                });
            }

            _logger?.LogInfo($&quot;Found {parts.Count} parts matching &apos;{searchTerm}&apos;&quot;);
            return Model_Dao_Result_Factory.Success(parts);
        }
        catch (Exception ex)
        {
            _logger?.LogError($&quot;Error searching parts: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_InforVisualPart&gt;&gt;(
                $&quot;Error searching parts: {ex.Message}&quot;, ex);
        }
    }

    #endregion
}</file><file path="Module_Core/Data/InforVisual/Dao_InforVisualPart.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using Microsoft.Data.SqlClient;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.InforVisual;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Contracts.Services;

namespace MTM_Receiving_Application.Module_Core.Data.InforVisual;

public class Dao_InforVisualPart
{
    private readonly string _connectionString;
    private readonly IService_LoggingUtility? _logger;

    public Dao_InforVisualPart(string inforVisualConnectionString, IService_LoggingUtility? logger = null)
    {
        ValidateReadOnlyConnection(inforVisualConnectionString);
        _connectionString = inforVisualConnectionString;
        _logger = logger;
    }

    private static void ValidateReadOnlyConnection(string connectionString)
    {
        if (string.IsNullOrWhiteSpace(connectionString))
        {
            throw new ArgumentNullException(nameof(connectionString));
        }

        try
        {
            var builder = new SqlConnectionStringBuilder(connectionString);

            if (builder.ApplicationIntent != ApplicationIntent.ReadOnly)
            {
                throw new InvalidOperationException(
                    $&quot;CONSTITUTIONAL VIOLATION: Infor Visual DAO requires ApplicationIntent=ReadOnly. &quot; +
                    $&quot;Current ApplicationIntent: {builder.ApplicationIntent}. &quot; +
                    $&quot;Writing to Infor Visual ERP database is STRICTLY PROHIBITED. &quot; +
                    &quot;See Constitution Principle X: Infor Visual DAO Architecture.&quot;);
            }
        }
        catch (ArgumentException ex)
        {
            throw new InvalidOperationException(
                $&quot;Invalid Infor Visual connection string format: {ex.Message}&quot;, ex);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;Model_InforVisualPart&gt;&gt; GetByPartNumberAsync(string partNumber)
    {
        try
        {
            _logger?.LogInfo($&quot;Retrieving part by number: {partNumber}&quot;);
            await using var connection = new SqlConnection(_connectionString);
            await connection.OpenAsync();

            var query = Helper_SqlQueryLoader.LoadAndPrepareQuery(&quot;03_GetPartByNumber.sql&quot;);

            await using var command = new SqlCommand(query, connection);
            command.Parameters.AddWithValue(&quot;@PartNumber&quot;, partNumber);

            await using var reader = await command.ExecuteReaderAsync();
            if (await reader.ReadAsync())
            {
                var part = new Model_InforVisualPart
                {
                    PartNumber = reader[&quot;PartNumber&quot;].ToString() ?? string.Empty,
                    Description = reader[&quot;Description&quot;].ToString() ?? string.Empty,
                    PartType = reader[&quot;PartType&quot;].ToString() ?? string.Empty,
                    UnitCost = Convert.ToDecimal(reader[&quot;UnitCost&quot;]),
                    PrimaryUom = reader[&quot;PrimaryUom&quot;].ToString() ?? &quot;EA&quot;,
                    OnHandQty = Convert.ToDecimal(reader[&quot;OnHandQty&quot;]),
                    AllocatedQty = Convert.ToDecimal(reader[&quot;AllocatedQty&quot;]),
                    AvailableQty = Convert.ToDecimal(reader[&quot;AvailableQty&quot;]),
                    DefaultSite = reader[&quot;DefaultSite&quot;].ToString() ?? &quot;002&quot;,
                    PartStatus = reader[&quot;PartStatus&quot;].ToString() ?? &quot;ACTIVE&quot;,
                    ProductLine = reader[&quot;ProductLine&quot;].ToString() ?? string.Empty
                };
                _logger?.LogInfo($&quot;Found part: {partNumber}&quot;);
                return Model_Dao_Result_Factory.Success(part);
            }

            _logger?.LogWarning($&quot;Part not found: {partNumber}&quot;);
            return Model_Dao_Result_Factory.Failure&lt;Model_InforVisualPart&gt;(&quot;Part not found&quot;);
        }
        catch (Exception ex)
        {
            _logger?.LogError($&quot;Error retrieving part {partNumber}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;Model_InforVisualPart&gt;(
                $&quot;Error retrieving part {partNumber}: {ex.Message}&quot;,
                ex);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_InforVisualPart&gt;&gt;&gt; SearchPartsByDescriptionAsync(
        string searchTerm,
        int maxResults = 50)
    {
        try
        {
            _logger?.LogInfo($&quot;Searching parts by description: &apos;{searchTerm}&apos; (Max: {maxResults})&quot;);
            await using var connection = new SqlConnection(_connectionString);
            await connection.OpenAsync();

            var query = Helper_SqlQueryLoader.LoadAndPrepareQuery(&quot;04_SearchPartsByDescription.sql&quot;);

            await using var command = new SqlCommand(query, connection);
            command.Parameters.AddWithValue(&quot;@SearchTerm&quot;, searchTerm);
            command.Parameters.AddWithValue(&quot;@MaxResults&quot;, maxResults);

            var list = new List&lt;Model_InforVisualPart&gt;();
            await using var reader = await command.ExecuteReaderAsync();
            while (await reader.ReadAsync())
            {
                list.Add(new Model_InforVisualPart
                {
                    PartNumber = reader[&quot;PartNumber&quot;].ToString() ?? string.Empty,
                    Description = reader[&quot;Description&quot;].ToString() ?? string.Empty,
                    PartType = reader[&quot;PartType&quot;].ToString() ?? string.Empty,
                    UnitCost = Convert.ToDecimal(reader[&quot;UnitCost&quot;]),
                    PrimaryUom = reader[&quot;PrimaryUom&quot;].ToString() ?? &quot;EA&quot;,
                    OnHandQty = Convert.ToDecimal(reader[&quot;OnHandQty&quot;]),
                    AllocatedQty = Convert.ToDecimal(reader[&quot;AllocatedQty&quot;]),
                    AvailableQty = Convert.ToDecimal(reader[&quot;AvailableQty&quot;]),
                    DefaultSite = reader[&quot;DefaultSite&quot;].ToString() ?? &quot;002&quot;,
                    PartStatus = reader[&quot;PartStatus&quot;].ToString() ?? &quot;ACTIVE&quot;,
                    ProductLine = reader[&quot;ProductLine&quot;].ToString() ?? string.Empty
                });
            }

            _logger?.LogInfo($&quot;Found {list.Count} parts matching &apos;{searchTerm}&apos;&quot;);
            return Model_Dao_Result_Factory.Success(list);
        }
        catch (Exception ex)
        {
            _logger?.LogError($&quot;Error searching parts: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_InforVisualPart&gt;&gt;(
                $&quot;Error searching parts: {ex.Message}&quot;,
                ex);
        }
    }
}</file><file path="Module_Core/Data/InforVisual/Dao_InforVisualPO.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using Microsoft.Data.SqlClient;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.InforVisual;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Contracts.Services;

namespace MTM_Receiving_Application.Module_Core.Data.InforVisual;

public class Dao_InforVisualPO
{
    private readonly string _connectionString;
    private readonly IService_LoggingUtility? _logger;

    public Dao_InforVisualPO(string inforVisualConnectionString, IService_LoggingUtility? logger = null)
    {
        ValidateReadOnlyConnection(inforVisualConnectionString);
        _connectionString = inforVisualConnectionString;
        _logger = logger;
    }

    private static void ValidateReadOnlyConnection(string connectionString)
    {
        if (string.IsNullOrWhiteSpace(connectionString))
        {
            throw new ArgumentNullException(nameof(connectionString));
        }

        try
        {
            var builder = new SqlConnectionStringBuilder(connectionString);

            if (builder.ApplicationIntent != ApplicationIntent.ReadOnly)
            {
                throw new InvalidOperationException(
                    $&quot;CONSTITUTIONAL VIOLATION: Infor Visual DAO requires ApplicationIntent=ReadOnly. &quot; +
                    $&quot;Current ApplicationIntent: {builder.ApplicationIntent}. &quot; +
                    $&quot;Writing to Infor Visual ERP database is STRICTLY PROHIBITED. &quot; +
                    &quot;See Constitution Principle X: Infor Visual DAO Architecture.&quot;);
            }
        }
        catch (ArgumentException ex)
        {
            throw new InvalidOperationException(
                $&quot;Invalid Infor Visual connection string format: {ex.Message}&quot;, ex);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_InforVisualPO&gt;&gt;&gt; GetByPoNumberAsync(string poNumber)
    {
        try
        {
            _logger?.LogInfo($&quot;Retrieving PO by number: {poNumber}&quot;);
            await using var connection = new SqlConnection(_connectionString);
            await connection.OpenAsync();

            var query = Helper_SqlQueryLoader.LoadAndPrepareQuery(&quot;01_GetPOWithParts.sql&quot;);

            await using var command = new SqlCommand(query, connection);
            command.Parameters.AddWithValue(&quot;@PoNumber&quot;, poNumber);

            var list = new List&lt;Model_InforVisualPO&gt;();
            await using var reader = await command.ExecuteReaderAsync();
            while (await reader.ReadAsync())
            {
                list.Add(new Model_InforVisualPO
                {
                    PoNumber = reader[&quot;PoNumber&quot;].ToString() ?? string.Empty,
                    PoLine = Convert.ToInt32(reader[&quot;PoLine&quot;]),
                    PartNumber = reader[&quot;PartNumber&quot;].ToString() ?? string.Empty,
                    PartDescription = reader[&quot;PartDescription&quot;].ToString() ?? string.Empty,
                    OrderedQty = Convert.ToDecimal(reader[&quot;OrderedQty&quot;]),
                    ReceivedQty = Convert.ToDecimal(reader[&quot;ReceivedQty&quot;]),
                    RemainingQty = Convert.ToDecimal(reader[&quot;RemainingQty&quot;]),
                    UnitOfMeasure = reader[&quot;UnitOfMeasure&quot;].ToString() ?? &quot;EA&quot;,
                    DueDate = reader[&quot;DueDate&quot;] == DBNull.Value ? null : Convert.ToDateTime(reader[&quot;DueDate&quot;]),
                    VendorCode = reader[&quot;VendorCode&quot;].ToString() ?? string.Empty,
                    VendorName = reader[&quot;VendorName&quot;].ToString() ?? string.Empty,
                    PoStatus = reader[&quot;PoStatus&quot;].ToString() ?? string.Empty,
                    SiteId = reader[&quot;SiteId&quot;].ToString() ?? &quot;002&quot;
                });
            }

            _logger?.LogInfo($&quot;Retrieved {list.Count} lines for PO {poNumber}&quot;);
            return Model_Dao_Result_Factory.Success(list);
        }
        catch (Exception ex)
        {
            _logger?.LogError($&quot;Error retrieving PO {poNumber}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_InforVisualPO&gt;&gt;(
                $&quot;Error retrieving PO {poNumber}: {ex.Message}&quot;,
                ex);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;bool&gt;&gt; ValidatePoNumberAsync(string poNumber)
    {
        try
        {
            _logger?.LogInfo($&quot;Validating PO number: {poNumber}&quot;);
            await using var connection = new SqlConnection(_connectionString);
            await connection.OpenAsync();

            var query = Helper_SqlQueryLoader.LoadAndPrepareQuery(&quot;02_ValidatePONumber.sql&quot;);
            await using var command = new SqlCommand(query, connection);
            command.Parameters.AddWithValue(&quot;@PoNumber&quot;, poNumber);

            var count = Convert.ToInt32(await command.ExecuteScalarAsync());
            bool isValid = count &gt; 0;
            _logger?.LogInfo($&quot;PO validation result for {poNumber}: {isValid}&quot;);
            return Model_Dao_Result_Factory.Success(isValid);
        }
        catch (Exception ex)
        {
            _logger?.LogError($&quot;Error validating PO {poNumber}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;bool&gt;(
                $&quot;Error validating PO {poNumber}: {ex.Message}&quot;,
                ex);
        }
    }
}</file><file path="Module_Core/Helpers/Database/Helper_SqlQueryLoader.cs">using System;
using System.IO;
using System.Reflection;

namespace MTM_Receiving_Application.Module_Core.Helpers.Database
{
    /// &lt;summary&gt;
    /// Helper class to load SQL queries from embedded resource files
    /// &lt;/summary&gt;
    public static class Helper_SqlQueryLoader
    {
        /// &lt;summary&gt;
        /// Loads a SQL query from an embedded resource file
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;resourcePath&quot;&gt;Path to the SQL file relative to Database/InforVisual (e.g., &quot;01_GetPOWithParts.sql&quot;)&lt;/param&gt;
        /// &lt;returns&gt;The SQL query text&lt;/returns&gt;
        public static string LoadInforVisualQuery(string resourcePath)
        {
            try
            {
                // Get the executing assembly
                var assembly = Assembly.GetExecutingAssembly();
                var resourceName = $&quot;MTM_Receiving_Application.Database.InforVisualScripts.Queries.{resourcePath}&quot;;

                using var stream = assembly.GetManifestResourceStream(resourceName);
                if (stream == null)
                {
                    // Fallback: Try to load from file system during development
                    var baseDir = AppDomain.CurrentDomain.BaseDirectory;
                    var filePath = Path.Combine(baseDir, &quot;Database&quot;, &quot;InforVisualScripts&quot;, &quot;Queries&quot;, resourcePath);

                    if (File.Exists(filePath))
                    {
                        return File.ReadAllText(filePath);
                    }

                    // Try relative to solution root
                    var solutionRoot = Directory.GetParent(baseDir)?.Parent?.Parent?.Parent?.FullName;
                    if (solutionRoot != null)
                    {
                        filePath = Path.Combine(solutionRoot, &quot;Database&quot;, &quot;InforVisualScripts&quot;, &quot;Queries&quot;, resourcePath);
                        if (File.Exists(filePath))
                        {
                            return File.ReadAllText(filePath);
                        }
                    }

                    throw new FileNotFoundException($&quot;SQL query file not found: {resourcePath}. Resource name attempted: {resourceName}&quot;);
                }

                using var reader = new StreamReader(stream);
                return reader.ReadToEnd();
            }
            catch (Exception ex)
            {
                throw new InvalidOperationException($&quot;Failed to load SQL query from {resourcePath}: {ex.Message}&quot;, ex);
            }
        }

        /// &lt;summary&gt;
        /// Cleans a SQL query by removing comments and normalizing whitespace
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sql&quot;&gt;Raw SQL text&lt;/param&gt;
        /// &lt;returns&gt;Cleaned SQL query ready for execution&lt;/returns&gt;
        public static string CleanQuery(string sql)
        {
            if (string.IsNullOrWhiteSpace(sql))
            {
                return string.Empty;
            }

            // Remove single-line comments (-- comments)
            var lines = sql.Split(new[] { &quot;\r\n&quot;, &quot;\r&quot;, &quot;\n&quot; }, StringSplitOptions.None);
            var cleanedLines = new System.Collections.Generic.List&lt;string&gt;();

            foreach (var line in lines)
            {
                var trimmedLine = line.Trim();

                // Skip comment-only lines
                if (trimmedLine.StartsWith(&quot;--&quot;))
                {
                    continue;
                }

                // Remove inline comments
                var commentIndex = line.IndexOf(&quot;--&quot;);
                if (commentIndex &gt;= 0)
                {
                    var lineWithoutComment = line.Substring(0, commentIndex).TrimEnd();
                    if (!string.IsNullOrWhiteSpace(lineWithoutComment))
                    {
                        cleanedLines.Add(lineWithoutComment);
                    }
                }
                else if (!string.IsNullOrWhiteSpace(line))
                {
                    cleanedLines.Add(line);
                }
            }

            return string.Join(Environment.NewLine, cleanedLines);
        }

        /// &lt;summary&gt;
        /// Extracts the actual query from a SQL file that includes DECLARE statements for testing
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sqlFileContent&quot;&gt;Full SQL file content with DECLAREs&lt;/param&gt;
        /// &lt;returns&gt;Just the SELECT/query portion without DECLARE statements&lt;/returns&gt;
        public static string ExtractQueryFromFile(string sqlFileContent)
        {
            if (string.IsNullOrWhiteSpace(sqlFileContent))
            {
                return string.Empty;
            }

            // Find the start of the actual query (after DECLARE statements)
            var lines = sqlFileContent.Split(new[] { &quot;\r\n&quot;, &quot;\r&quot;, &quot;\n&quot; }, StringSplitOptions.None);
            var queryLines = new System.Collections.Generic.List&lt;string&gt;();
            bool foundQueryStart = false;

            foreach (var line in lines)
            {
                var trimmedLine = line.Trim();

                // Skip comments
                if (trimmedLine.StartsWith(&quot;--&quot;))
                {
                    continue;
                }

                // Skip DECLARE statements
                if (trimmedLine.StartsWith(&quot;DECLARE&quot;, StringComparison.OrdinalIgnoreCase))
                {
                    continue;
                }

                // Look for SELECT, WITH, INSERT, UPDATE, DELETE as query start
                if (!foundQueryStart &amp;&amp;
                    (trimmedLine.StartsWith(&quot;SELECT&quot;, StringComparison.OrdinalIgnoreCase) ||
                     trimmedLine.StartsWith(&quot;WITH&quot;, StringComparison.OrdinalIgnoreCase) ||
                     trimmedLine.StartsWith(&quot;INSERT&quot;, StringComparison.OrdinalIgnoreCase) ||
                     trimmedLine.StartsWith(&quot;UPDATE&quot;, StringComparison.OrdinalIgnoreCase) ||
                     trimmedLine.StartsWith(&quot;DELETE&quot;, StringComparison.OrdinalIgnoreCase)))
                {
                    foundQueryStart = true;
                }

                if (foundQueryStart &amp;&amp; !string.IsNullOrWhiteSpace(line))
                {
                    queryLines.Add(line);
                }
            }

            return string.Join(Environment.NewLine, queryLines);
        }

        /// &lt;summary&gt;
        /// Loads and prepares a SQL query for execution (removes test DECLAREs and comments)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;resourcePath&quot;&gt;SQL file name&lt;/param&gt;
        /// &lt;returns&gt;Clean, executable SQL query&lt;/returns&gt;
        public static string LoadAndPrepareQuery(string resourcePath)
        {
            var rawSql = LoadInforVisualQuery(resourcePath);
            var extractedQuery = ExtractQueryFromFile(rawSql);
            return extractedQuery.Trim();
        }
    }
}</file><file path="Module_Core/Helpers/UI/Helper_MaterialIcons.cs">using System;
using System.Collections.Generic;
using System.Linq;
using Material.Icons;

namespace MTM_Receiving_Application.Module_Core.Helpers.UI;

public static class Helper_MaterialIcons
{
    private static List&lt;MaterialIconKind&gt;? _allIcons;

    public static List&lt;MaterialIconKind&gt; GetAllIcons()
    {
        if (_allIcons == null)
        {
            _allIcons = Enum.GetValues&lt;MaterialIconKind&gt;().ToList();
        }
        return _allIcons;
    }

    public static IEnumerable&lt;MaterialIconKind&gt; SearchIcons(string searchText)
    {
        var all = GetAllIcons();
        if (string.IsNullOrWhiteSpace(searchText))
        {
            return all;
        }

        searchText = searchText.ToLower().Trim();
        return all.Where(k =&gt; k.ToString().ToLower().Contains(searchText));
    }
}</file><file path="Module_Core/Helpers/UI/Helper_WindowExtensions.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Windowing;
using WinRT.Interop;

namespace MTM_Receiving_Application.Module_Core.Helpers.UI;

/// &lt;summary&gt;
/// Extension methods for WinUI 3 Window configuration
/// Provides simplified window sizing, positioning, and presenter configuration
/// &lt;/summary&gt;
public static class Helper_WindowExtensions
{
    /// &lt;summary&gt;
    /// Sets the window size
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;window&quot;&gt;The window to resize&lt;/param&gt;
    /// &lt;param name=&quot;width&quot;&gt;Desired width in pixels&lt;/param&gt;
    /// &lt;param name=&quot;height&quot;&gt;Desired height in pixels&lt;/param&gt;
    public static void SetWindowSize(this Window window, int width, int height)
    {
        var appWindow = window.GetAppWindow();
        appWindow.Resize(new Windows.Graphics.SizeInt32(width, height));
    }

    /// &lt;summary&gt;
    /// Centers the window on the primary display
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;window&quot;&gt;The window to center&lt;/param&gt;
    public static void CenterOnScreen(this Window window)
    {
        var appWindow = window.GetAppWindow();
        var displayArea = DisplayArea.Primary;
        var workArea = displayArea.WorkArea;

        var x = (workArea.Width - appWindow.Size.Width) / 2;
        var y = (workArea.Height - appWindow.Size.Height) / 2;

        appWindow.Move(new Windows.Graphics.PointInt32(x, y));
    }

    /// &lt;summary&gt;
    /// Configures the window as non-resizable (fixed size)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;window&quot;&gt;The window to configure&lt;/param&gt;
    /// &lt;param name=&quot;disableMaximize&quot;&gt;Whether to disable maximize button&lt;/param&gt;
    /// &lt;param name=&quot;disableMinimize&quot;&gt;Whether to disable minimize button&lt;/param&gt;
    public static void SetFixedSize(this Window window, bool disableMaximize = true, bool disableMinimize = true)
    {
        var appWindow = window.GetAppWindow();

        if (appWindow.Presenter is OverlappedPresenter presenter)
        {
            presenter.IsResizable = false;
            presenter.IsMaximizable = !disableMaximize;
            presenter.IsMinimizable = !disableMinimize;
        }
    }

    /// &lt;summary&gt;
    /// Hides the title bar icon and system menu
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;window&quot;&gt;The window to configure&lt;/param&gt;
    public static void HideTitleBarIcon(this Window window)
    {
        var appWindow = window.GetAppWindow();
        var titleBar = appWindow.TitleBar;
        titleBar.IconShowOptions = IconShowOptions.HideIconAndSystemMenu;
    }

    /// &lt;summary&gt;
    /// Extends content into the title bar area (custom title bar)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;window&quot;&gt;The window to configure&lt;/param&gt;
    /// &lt;param name=&quot;customTitleBarElement&quot;&gt;Optional custom title bar element&lt;/param&gt;
    public static void UseCustomTitleBar(this Window window, UIElement? customTitleBarElement = null)
    {
        window.ExtendsContentIntoTitleBar = true;
        window.SetTitleBar(customTitleBarElement);
    }

    /// &lt;summary&gt;
    /// Makes the title bar transparent (for splash screens)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;window&quot;&gt;The window to configure&lt;/param&gt;
    public static void MakeTitleBarTransparent(this Window window)
    {
        var appWindow = window.GetAppWindow();
        var titleBar = appWindow.TitleBar;

        titleBar.ButtonBackgroundColor = Microsoft.UI.Colors.Transparent;
        titleBar.ButtonInactiveBackgroundColor = Microsoft.UI.Colors.Transparent;
        titleBar.ButtonForegroundColor = Microsoft.UI.Colors.Transparent;
        titleBar.ButtonInactiveForegroundColor = Microsoft.UI.Colors.Transparent;
        titleBar.ButtonHoverBackgroundColor = Microsoft.UI.Colors.Transparent;
        titleBar.ButtonHoverForegroundColor = Microsoft.UI.Colors.Transparent;
        titleBar.ButtonPressedBackgroundColor = Microsoft.UI.Colors.Transparent;
        titleBar.ButtonPressedForegroundColor = Microsoft.UI.Colors.Transparent;
    }

    /// &lt;summary&gt;
    /// Gets the AppWindow from a WinUI 3 Window
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;window&quot;&gt;&lt;/param&gt;
    private static AppWindow GetAppWindow(this Window window)
    {
        var hWnd = WindowNative.GetWindowHandle(window);
        var windowId = Microsoft.UI.Win32Interop.GetWindowIdFromWindow(hWnd);
        return AppWindow.GetFromWindowId(windowId);
    }
}</file><file path="Module_Core/Helpers/UI/Helper_WorkflowHelpContentGenerator.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using Microsoft.UI.Xaml.Media;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Core.Helpers.UI
{
    public static class Helper_WorkflowHelpContentGenerator
    {
        public static UIElement GenerateHelpContent(Enum_ReceivingWorkflowStep step)
        {
            return step switch
            {
                Enum_ReceivingWorkflowStep.ModeSelection =&gt; CreateModeSelectionHelp(),
                Enum_ReceivingWorkflowStep.ManualEntry =&gt; CreateManualEntryHelp(),
                Enum_ReceivingWorkflowStep.POEntry =&gt; CreatePOEntryHelp(),
                Enum_ReceivingWorkflowStep.LoadEntry =&gt; CreateLoadEntryHelp(),
                Enum_ReceivingWorkflowStep.WeightQuantityEntry =&gt; CreateWeightQuantityHelp(),
                Enum_ReceivingWorkflowStep.HeatLotEntry =&gt; CreateHeatLotHelp(),
                Enum_ReceivingWorkflowStep.PackageTypeEntry =&gt; CreatePackageTypeHelp(),
                Enum_ReceivingWorkflowStep.Review =&gt; CreateReviewHelp(),
                _ =&gt; CreateDefaultHelp()
            };
        }

        private static UIElement CreateModeSelectionHelp()
        {
            return CreateHelpPanel(
                &quot;Entry Mode Selection&quot;,
                &quot;Choose how you want to enter receiving data.&quot;,
                new (string header, string content)[]
                {
                    (&quot;Guided Wizard&quot;, &quot;Step-by-step process for standard receiving. Ideal for one PO or part at a time. Validates data at each step. Best for beginners or infrequent users.&quot;),
                    (&quot;Manual Entry&quot;, &quot;Grid-based bulk data entry. Enter multiple loads at once. Best for experienced users. Faster for large shipments.&quot;)
                });
        }

        private static UIElement CreateManualEntryHelp()
        {
            return CreateHelpPanel(
                &quot;Manual Entry Mode&quot;,
                &quot;Bulk data entry grid for experienced users. Enter multiple loads quickly.&quot;,
                new (string header, string content)[]
                {
                    (&quot;Grid Columns&quot;, &quot;PO Number (6 digits)  Part ID (material part number)  Weight/Qty (pounds or piece count)  Heat/Lot (traceability)  Package Type (Coils, Sheets, Skids)&quot;),
                    (&quot;Quick Actions&quot;, &quot;Add Row (insert new blank row)  Remove Row (delete selected row)  Click cells to edit directly&quot;),
                    (&quot;Important&quot;, &quot;Data is validated when you click Save. Errors will be highlighted. Best for users familiar with receiving workflow.&quot;)
                });
        }

        private static UIElement CreatePOEntryHelp()
        {
            return CreateHelpPanel(
                &quot;Purchase Order Entry&quot;,
                &quot;Enter the PO number from your vendor shipment.&quot;,
                new (string header, string content)[]
                {
                    (&quot;Accepted Formats&quot;, &quot;6 digits (e.g., 66868) or with prefix (e.g., PO-066868). Auto-formats on tab/enter.&quot;),
                    (&quot;What Happens&quot;, &quot;System validates PO exists in Infor Visual, shows all parts on the PO, displays remaining quantities. Select a part to receive.&quot;),
                    (&quot;Non-PO Entry&quot;, &quot;Use for items without a PO. Enter part number manually (e.g., MMC0000123 or MMF0000456).&quot;)
                });
        }

        private static UIElement CreateLoadEntryHelp()
        {
            return CreateHelpPanel(
                &quot;Number of Loads&quot;,
                &quot;How many skids/loads are you receiving for this part?&quot;,
                new (string header, string content)[]
                {
                    (&quot;Examples&quot;, &quot; Coils: Each coil = 1 load\n Sheets: Each skid of sheets = 1 load\n Bars: Each bundle = 1 load&quot;),
                    (&quot;Valid Range&quot;, &quot;Enter between 1 and 99 loads.&quot;),
                    (&quot;Note&quot;, &quot;Each load will be labeled separately for tracking.&quot;)
                });
        }

        private static UIElement CreateWeightQuantityHelp()
        {
            return CreateHelpPanel(
                &quot;Weight/Quantity Entry&quot;,
                &quot;Enter the weight or quantity for each load.&quot;,
                new (string header, string content)[]
                {
                    (&quot;For Coils/Sheets (by weight)&quot;, &quot;Enter weight in pounds (lbs). Example: 2500 for 2,500 lbs. Whole numbers only - decimals NOT allowed.&quot;),
                    (&quot;For Bars/Pieces (by count)&quot;, &quot;Enter piece count. Example: 48 for 48 pieces. Whole numbers only.&quot;),
                    (&quot;Warning&quot;, &quot;Total entered should not exceed PO quantity. System will alert if over.&quot;)
                });
        }

        private static UIElement CreateHeatLotHelp()
        {
            return CreateHelpPanel(
                &quot;Heat/Lot Numbers&quot;,
                &quot;Enter heat or lot numbers for traceability.&quot;,
                new (string header, string content)[]
                {
                    (&quot;Heat Number (for coils/sheets)&quot;, &quot;Mill-assigned identifier. Usually found on coil tag. Example: H123456789&quot;),
                    (&quot;Lot Number (for bars/parts)&quot;, &quot;Batch identifier from vendor. Found on packing slip or bundle tag. Example: LOT-2024-1234&quot;),
                    (&quot;Optional Field&quot;, &quot;If blank, will be recorded as &apos;Not Entered&apos;.&quot;)
                });
        }

        private static UIElement CreatePackageTypeHelp()
        {
            return CreateHelpPanel(
                &quot;Package Details&quot;,
                &quot;Define how material is packaged for accurate tracking and inventory.&quot;,
                new (string header, string content)[]
                {
                    (&quot;Package Types&quot;, &quot; Coils: Single coils on eye-to-sky skids\n Sheets: Stacked flat sheets on skids\n Skids: Mixed or bundled material\n Custom: Enter your own description&quot;),
                    (&quot;Packages per Load&quot;, &quot;How many packages on each load? Examples: 1 coil per skid = 1, or 5 bundles per skid = 5&quot;),
                    (&quot;Weight per Package&quot;, &quot;Automatically calculated by dividing total load weight by package count.&quot;)
                });
        }

        private static UIElement CreateReviewHelp()
        {
            return CreateHelpPanel(
                &quot;Review &amp; Save&quot;,
                &quot;Review all entries before saving to the system.&quot;,
                new (string header, string content)[]
                {
                    (&quot;Single Entry View&quot;, &quot;Review one load at a time. Use Previous/Next to navigate. All fields displayed clearly.&quot;),
                    (&quot;Table View&quot;, &quot;See all loads at once. Quick overview of all data. Switch views with Table View button.&quot;),
                    (&quot;What Gets Saved&quot;, &quot; Database record (permanent)\n Local CSV backup\n Network CSV (if accessible)\n Printable receiving labels&quot;)
                });
        }

        private static UIElement CreateDefaultHelp()
        {
            var stack = new StackPanel { Spacing = 12, Padding = new Thickness(4), MaxWidth = 450 };

            var title = new TextBlock
            {
                Text = &quot;Receiving Workflow Help&quot;,
                Style = Application.Current.Resources[&quot;SubtitleTextBlockStyle&quot;] as Style
            };

            var description = new TextBlock
            {
                Text = &quot;Navigate through the workflow using the Next and Back buttons. Help is available at each step.&quot;,
                TextWrapping = TextWrapping.Wrap
            };

            stack.Children.Add(title);
            stack.Children.Add(description);

            return stack;
        }

        private static UIElement CreateHelpPanel(string title, string description, (string header, string content)[] sections)
        {
            var mainStack = new StackPanel { Spacing = 20, Padding = new Thickness(4), MaxWidth = 450 };

            // Title Section
            var titleStack = new StackPanel { Spacing = 8 };
            var titleText = new TextBlock
            {
                Text = title,
                Style = Application.Current.Resources[&quot;SubtitleTextBlockStyle&quot;] as Style,
                Foreground = Application.Current.Resources[&quot;AccentTextFillColorPrimaryBrush&quot;] as SolidColorBrush
            };

            var underline = new Border
            {
                Height = 2,
                Background = Application.Current.Resources[&quot;AccentFillColorDefaultBrush&quot;] as SolidColorBrush,
                CornerRadius = new CornerRadius(1),
                HorizontalAlignment = HorizontalAlignment.Left,
                Width = 60
            };

            var descText = new TextBlock
            {
                Text = description,
                TextWrapping = TextWrapping.Wrap,
                Foreground = Application.Current.Resources[&quot;TextFillColorSecondaryBrush&quot;] as SolidColorBrush
            };

            titleStack.Children.Add(titleText);
            titleStack.Children.Add(underline);
            titleStack.Children.Add(descText);
            mainStack.Children.Add(titleStack);

            // Content Sections
            foreach (var section in sections)
            {
                var border = new Border
                {
                    Background = Application.Current.Resources[&quot;LayerFillColorDefaultBrush&quot;] as SolidColorBrush,
                    Padding = new Thickness(16),
                    CornerRadius = new CornerRadius(8),
                    BorderThickness = new Thickness(1),
                    BorderBrush = Application.Current.Resources[&quot;CardStrokeColorDefaultBrush&quot;] as SolidColorBrush
                };

                var sectionStack = new StackPanel { Spacing = 8 };

                var headerText = new TextBlock
                {
                    Text = section.header,
                    FontWeight = Microsoft.UI.Text.FontWeights.SemiBold,
                    FontSize = 14
                };

                var contentText = new TextBlock
                {
                    Text = section.content,
                    TextWrapping = TextWrapping.Wrap,
                    FontSize = 12,
                    Foreground = Application.Current.Resources[&quot;TextFillColorSecondaryBrush&quot;] as SolidColorBrush
                };

                sectionStack.Children.Add(headerText);
                sectionStack.Children.Add(contentText);
                border.Child = sectionStack;
                mainStack.Children.Add(border);
            }

            return mainStack;
        }
    }
}</file><file path="Module_Core/Models/Core/Model_Dao_Result_Generic.cs">namespace MTM_Receiving_Application.Module_Core.Models.Core
{
    /// &lt;summary&gt;
    /// Generic version of Model_Dao_Result for returning data
    /// &lt;/summary&gt;
    /// &lt;typeparam name=&quot;T&quot;&gt;Type of data returned&lt;/typeparam&gt;
    public class Model_Dao_Result&lt;T&gt; : Model_Dao_Result
    {
        /// &lt;summary&gt;
        /// Data returned by the operation
        /// &lt;/summary&gt;
        public T? Data { get; set; }
    }
}</file><file path="Module_Core/Models/Core/Model_Dao_Result.cs">using MTM_Receiving_Application.Module_Core.Models.Enums;
using System;

namespace MTM_Receiving_Application.Module_Core.Models.Core;

/// &lt;summary&gt;
/// Standardized response object for all database operations
/// Provides success/failure status, error messages, and performance metrics
/// &lt;/summary&gt;
public class Model_Dao_Result
{
    /// &lt;summary&gt;
    /// Indicates whether the database operation succeeded
    /// &lt;/summary&gt;
    public bool Success { get; set; } = false;

    /// &lt;summary&gt;
    /// Alias for Success to match some usage patterns
    /// &lt;/summary&gt;
    public bool IsSuccess =&gt; Success;

    /// &lt;summary&gt;
    /// Error message if operation failed, empty string if successful
    /// &lt;/summary&gt;
    public string ErrorMessage { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Severity level of any error that occurred
    /// &lt;/summary&gt;
    public Enum_ErrorSeverity Severity { get; set; } = Enum_ErrorSeverity.Info;

    /// &lt;summary&gt;
    /// Number of rows affected by the database operation
    /// &lt;/summary&gt;
    public int AffectedRows { get; set; } = 0;

    /// &lt;summary&gt;
    /// Execution time in milliseconds for performance monitoring
    /// &lt;/summary&gt;
    public long ExecutionTimeMs { get; set; } = 0;

    /// &lt;summary&gt;
    /// Optional return value from the database operation (e.g., generated ID)
    /// &lt;/summary&gt;
    public object? ReturnValue { get; set; } = null;

    /// &lt;summary&gt;
    /// Exception that caused the failure, if any
    /// &lt;/summary&gt;
    public Exception? Exception { get; set; }

    // Static factory methods moved to DaoResultFactory to avoid circular dependencies
}</file><file path="Module_Core/Models/Core/Model_HelpContent.cs">using System;
using System.Collections.Generic;
using CommunityToolkit.Mvvm.ComponentModel;
using Material.Icons;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Core.Models.Core;

/// &lt;summary&gt;
/// Model representing help content for the application
/// Used by IService_Help to provide contextual help, tips, tooltips, and tutorials
/// &lt;/summary&gt;
public partial class Model_HelpContent : ObservableObject
{
    [ObservableProperty]
    private string _key = string.Empty;

    [ObservableProperty]
    private string _title = string.Empty;

    [ObservableProperty]
    private string _content = string.Empty;

    [ObservableProperty]
    private string _category = string.Empty;

    [ObservableProperty]
    private Enum_HelpType _helpType = Enum_HelpType.Info;

    [ObservableProperty]
    private string _icon = &quot;HelpCircle&quot;;

    [ObservableProperty]
    private Enum_HelpSeverity _severity = Enum_HelpSeverity.Info;

    [ObservableProperty]
    private List&lt;string&gt; _relatedKeys = new();

    [ObservableProperty]
    private DateTime _lastUpdated = DateTime.Now;

    /// &lt;summary&gt;
    /// Gets the MaterialIconKind enum for displaying the icon
    /// &lt;/summary&gt;
    public MaterialIconKind IconKind
    {
        get
        {
            if (!string.IsNullOrEmpty(Icon) &amp;&amp; Enum.TryParse&lt;MaterialIconKind&gt;(Icon, true, out var kind))
            {
                return kind;
            }
            return MaterialIconKind.HelpCircle;
        }
    }
}</file><file path="Module_Core/Models/Enums/Enum_DataSourceType.cs">namespace MTM_Receiving_Application.Module_Core.Models.Enums
{
    public enum Enum_DataSourceType
    {
        Memory,
        CurrentLabels,
        History
    }
}</file><file path="Module_Core/Models/Enums/Enum_ErrorSeverity.cs">namespace MTM_Receiving_Application.Module_Core.Models.Enums;

/// &lt;summary&gt;
/// Categorizes error severity levels for logging and error handling
/// &lt;/summary&gt;
public enum Enum_ErrorSeverity
{
    /// &lt;summary&gt;
    /// Informational message - no action required
    /// &lt;/summary&gt;
    Info = 0,

    /// &lt;summary&gt;
    /// Low severity - minor issue
    /// &lt;/summary&gt;
    Low = 1,

    /// &lt;summary&gt;
    /// Warning - potential issue but operation continues
    /// &lt;/summary&gt;
    Warning = 2,

    /// &lt;summary&gt;
    /// Medium severity - significant issue but application continues
    /// &lt;/summary&gt;
    Medium = 3,

    /// &lt;summary&gt;
    /// Error - operation failed but application continues
    /// &lt;/summary&gt;
    Error = 4,

    /// &lt;summary&gt;
    /// Critical - serious issue requiring immediate attention
    /// &lt;/summary&gt;
    Critical = 5,

    /// &lt;summary&gt;
    /// Fatal - application cannot continue
    /// &lt;/summary&gt;
    Fatal = 6
}</file><file path="Module_Core/Models/Enums/Enum_HelpSeverity.cs">namespace MTM_Receiving_Application.Module_Core.Models.Enums;

/// &lt;summary&gt;
/// Defines the severity level of help content
/// &lt;/summary&gt;
public enum Enum_HelpSeverity
{
    /// &lt;summary&gt;
    /// General information
    /// &lt;/summary&gt;
    Info = 0,

    /// &lt;summary&gt;
    /// Important to know
    /// &lt;/summary&gt;
    Warning = 1,

    /// &lt;summary&gt;
    /// Critical information, must read
    /// &lt;/summary&gt;
    Critical = 2
}</file><file path="Module_Core/Models/Enums/Enum_HelpType.cs">namespace MTM_Receiving_Application.Module_Core.Models.Enums;

/// &lt;summary&gt;
/// Defines the type of help content
/// &lt;/summary&gt;
public enum Enum_HelpType
{
    /// &lt;summary&gt;
    /// Quick tips and best practices
    /// &lt;/summary&gt;
    Tip = 0,

    /// &lt;summary&gt;
    /// Informational content
    /// &lt;/summary&gt;
    Info = 1,

    /// &lt;summary&gt;
    /// Important warnings and cautions
    /// &lt;/summary&gt;
    Warning = 2,

    /// &lt;summary&gt;
    /// Step-by-step instructions
    /// &lt;/summary&gt;
    Tutorial = 3,

    /// &lt;summary&gt;
    /// Detailed reference material
    /// &lt;/summary&gt;
    Reference = 4
}</file><file path="Module_Core/Models/Enums/Enum_InfoBarSeverity.cs">namespace MTM_Receiving_Application.Module_Core.Models.Enums;

public enum InfoBarSeverity
{
    Informational = 0,
    Success = 1,
    Warning = 2,
    Error = 3
}</file><file path="Module_Core/Models/Enums/Enum_LabelType.cs">namespace MTM_Receiving_Application.Module_Core.Models.Enums;

/// &lt;summary&gt;
/// Identifies the type of label being generated
/// &lt;/summary&gt;
public enum Enum_LabelType
{
    /// &lt;summary&gt;
    /// Standard receiving label
    /// &lt;/summary&gt;
    Receiving = 1,

    /// &lt;summary&gt;
    /// Dunnage/packing material label
    /// &lt;/summary&gt;
    Dunnage = 2,

    /// &lt;summary&gt;
    /// UPS or FedEx shipping label
    /// &lt;/summary&gt;
    UPSFedEx = 3,

    /// &lt;summary&gt;
    /// Mini receiving label variant
    /// &lt;/summary&gt;
    MiniReceiving = 4,

    /// &lt;summary&gt;
    /// Mini coil label variant
    /// &lt;/summary&gt;
    MiniCoil = 5
}</file><file path="Module_Core/Models/Enums/Enum_PackageType.cs">namespace MTM_Receiving_Application.Module_Core.Models.Enums
{
    public enum Enum_PackageType
    {
        Skid,
        Box,
        Crate,
        Bundle,
        Roll,
        Piece,
        Pallet,
        Coil,
        Sheet
    }
}</file><file path="Module_Core/Models/Enums/Enum_ReceivingWorkflowStep.cs">namespace MTM_Receiving_Application.Module_Core.Models.Enums
{
    /// &lt;summary&gt;
    /// Workflow steps enumeration for Receiving.
    /// &lt;/summary&gt;
    public enum Enum_ReceivingWorkflowStep
    {
        ModeSelection = 0,
        ManualEntry = 1,
        EditMode = 2,
        POEntry = 3,
        PartSelection = 4,
        LoadEntry = 5,
        WeightQuantityEntry = 6,
        HeatLotEntry = 7,
        PackageTypeEntry = 8,
        Review = 9,
        Saving = 10,
        Complete = 11
    }
}</file><file path="Module_Core/Models/Enums/Enum_ValidationSeverity.cs">namespace MTM_Receiving_Application.Module_Core.Models.Enums
{
    /// &lt;summary&gt;
    /// Severity level for validation results.
    /// &lt;/summary&gt;
    public enum Enum_ValidationSeverity
    {
        Info,
        Warning,
        Error
    }
}</file><file path="Module_Core/Models/Systems/Model_AppSettings.cs">namespace MTM_Receiving_Application.Module_Core.Models.Systems;

/// &lt;summary&gt;
/// Application settings loaded from appsettings.json
/// &lt;/summary&gt;
public class Model_AppSettings
{
    /// &lt;summary&gt;
    /// If true, uses mock data instead of querying Infor Visual database
    /// Useful for development/testing when Infor Visual server is unavailable
    /// &lt;/summary&gt;
    public bool UseInforVisualMockData { get; set; } = true;

    /// &lt;summary&gt;
    /// Environment name (Development, Production, etc.)
    /// &lt;/summary&gt;
    public string Environment { get; set; } = &quot;Development&quot;;
}</file><file path="Module_Core/Models/Systems/Model_CreateUserResult.cs">namespace MTM_Receiving_Application.Module_Core.Models.Systems
{
    /// &lt;summary&gt;
    /// Result of a user creation attempt.
    /// &lt;/summary&gt;
    public class Model_CreateUserResult
    {
        public bool Success { get; set; }
        public int EmployeeNumber { get; set; }
        public string ErrorMessage { get; set; } = string.Empty;

        public static Model_CreateUserResult SuccessResult(int employeeNumber) =&gt; new()
        {
            Success = true,
            EmployeeNumber = employeeNumber
        };

        public static Model_CreateUserResult ErrorResult(string message) =&gt; new()
        {
            Success = false,
            ErrorMessage = message
        };
    }
}</file><file path="Module_Core/Models/Systems/Model_SessionTimedOutEventArgs.cs">using System;
using MTM_Receiving_Application.Module_Core.Models.Systems;

namespace MTM_Receiving_Application.Module_Core.Models.Systems
{
    public class Model_SessionTimedOutEventArgs : EventArgs
    {
        public Model_UserSession Session { get; set; } = null!;
        public TimeSpan IdleDuration { get; set; }
    }
}</file><file path="Module_Core/Services/Database/Service_ErrorHandler.cs">using System;
using System.Threading.Tasks;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;

namespace MTM_Receiving_Application.Module_Core.Services.Database;

/// &lt;summary&gt;
/// Centralized error handling service
/// Logs errors and displays user-friendly WinUI 3 dialogs
/// &lt;/summary&gt;
public class Service_ErrorHandler : IService_ErrorHandler
{
    private readonly IService_LoggingUtility _loggingService;
    private readonly IService_Window _windowService;

    public Service_ErrorHandler(IService_LoggingUtility loggingService, IService_Window windowService)
    {
        _loggingService = loggingService ?? throw new ArgumentNullException(nameof(loggingService));
        _windowService = windowService ?? throw new ArgumentNullException(nameof(windowService));
    }

    /// &lt;summary&gt;
    /// Handles an error by logging it and optionally displaying a dialog
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;errorMessage&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;severity&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;exception&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;showDialog&quot;&gt;&lt;/param&gt;
    public async Task HandleErrorAsync(
        string errorMessage,
        Enum_ErrorSeverity severity,
        Exception? exception = null,
        bool showDialog = true)
    {
        // Log the error
        await LogErrorAsync(errorMessage, severity, exception);

        // Show dialog if requested
        if (showDialog)
        {
            string title = GetDialogTitle(severity);
            await ShowErrorDialogAsync(title, errorMessage, severity);
        }
    }

    /// &lt;summary&gt;
    /// Logs an error without displaying a dialog
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;errorMessage&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;severity&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;exception&quot;&gt;&lt;/param&gt;
    public Task LogErrorAsync(
        string errorMessage,
        Enum_ErrorSeverity severity,
        Exception? exception = null)
    {
        return Task.Run(() =&gt;
        {
            switch (severity)
            {
                case Enum_ErrorSeverity.Info:
                    _loggingService.LogInfo(errorMessage);
                    break;
                case Enum_ErrorSeverity.Warning:
                    _loggingService.LogWarning(errorMessage);
                    break;
                case Enum_ErrorSeverity.Error:
                    _loggingService.LogError(errorMessage, exception);
                    break;
                case Enum_ErrorSeverity.Critical:
                    _loggingService.LogCritical(errorMessage, exception);
                    break;
                case Enum_ErrorSeverity.Fatal:
                    _loggingService.LogFatal(errorMessage, exception);
                    break;
            }
        });
    }

    /// &lt;summary&gt;
    /// Displays a user-friendly error dialog using WinUI 3 ContentDialog
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;title&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;severity&quot;&gt;&lt;/param&gt;
    public async Task ShowErrorDialogAsync(
        string title,
        string message,
        Enum_ErrorSeverity severity)
    {
        try
        {
            // Get the main window&apos;s XamlRoot for dialog display
            // Note: App.MainWindow is static but might not be accessible in all contexts (e.g. tests)
            // We use a safe access pattern or dependency injection for window provider in a real app
            // For now, we assume App.MainWindow is available as it&apos;s a static property of the App class
            // However, since &apos;App&apos; is in the root namespace, we might need to qualify it or ensure it&apos;s accessible.
            // If &apos;App&apos; is not found, it might be because we are in a library or test context where App is not defined or accessible.
            // In WinUI 3, (Application.Current as App)?.MainWindow is a common pattern.

            // Using dynamic to avoid direct dependency on App class which might not be visible here
            // or simply checking Application.Current

            // Use IWindowService to get the XamlRoot
            var xamlRoot = _windowService.GetXamlRoot();

            if (xamlRoot == null)
            {
                // Fallback: Just log if we can&apos;t show dialog
                _loggingService.LogWarning(&quot;Cannot show dialog - XamlRoot is null&quot;);
                return;
            }

            var dialog = new ContentDialog
            {
                Title = title,
                Content = message,
                CloseButtonText = &quot;OK&quot;,
                XamlRoot = xamlRoot
            };

            // Set dialog style based on severity (could be enhanced with custom styles)
            // For now, just show the dialog
            await dialog.ShowAsync();
        }
        catch (Exception ex)
        {
            // If dialog fails, at least log it
            _loggingService.LogError($&quot;Failed to show error dialog: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Handles a Model_Dao_Result error by logging and optionally displaying
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;result&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;operationName&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;showDialog&quot;&gt;&lt;/param&gt;
    public async Task HandleDaoErrorAsync(
        Model_Dao_Result result,
        string operationName,
        bool showDialog = true)
    {
        if (result.Success)
        {
            // Not an error
            return;
        }

        string errorMessage = $&quot;Database operation &apos;{operationName}&apos; failed: {result.ErrorMessage}&quot;;

        await HandleErrorAsync(
            errorMessage,
            result.Severity,
            exception: null,
            showDialog: showDialog
        );
    }

    public Task ShowUserErrorAsync(string message, string title, string method)
    {
        return ShowErrorDialogAsync(title, message, Enum_ErrorSeverity.Error);
    }

    public void HandleException(Exception ex, Enum_ErrorSeverity severity, string method, string className)
    {
        _ = HandleErrorAsync($&quot;Exception in {className}.{method}: {ex.Message}&quot;, severity, ex, true);
    }

    /// &lt;summary&gt;
    /// Gets appropriate dialog title based on severity
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;severity&quot;&gt;&lt;/param&gt;
    private static string GetDialogTitle(Enum_ErrorSeverity severity)
    {
        return severity switch
        {
            Enum_ErrorSeverity.Info =&gt; &quot;Information&quot;,
            Enum_ErrorSeverity.Warning =&gt; &quot;Warning&quot;,
            Enum_ErrorSeverity.Error =&gt; &quot;Error&quot;,
            Enum_ErrorSeverity.Critical =&gt; &quot;Critical Error&quot;,
            Enum_ErrorSeverity.Fatal =&gt; &quot;Fatal Error&quot;,
            _ =&gt; &quot;Error&quot;
        };
    }
}</file><file path="Module_Core/Services/Database/Service_InforVisualConnect.cs">using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Data.InforVisual;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Core.Services.Database;

/// &lt;summary&gt;
/// Service for connecting to and querying Infor Visual database (SQL Server)
///  STRICTLY READ ONLY - NO WRITES ALLOWED TO INFOR VISUAL 
/// Server: VISUAL, Database: MTMFG, Warehouse: 002
/// &lt;/summary&gt;
public class Service_InforVisualConnect : IService_InforVisual
{
    private readonly Dao_InforVisualConnection _dao;
    private readonly IService_LoggingUtility? _logger;
    private readonly bool _useMockData;

    public Service_InforVisualConnect(
        Dao_InforVisualConnection dao,
        bool useMockData = false,
        IService_LoggingUtility? logger = null)
    {
        _dao = dao ?? throw new ArgumentNullException(nameof(dao));
        _useMockData = useMockData;
        _logger = logger;
    }

    #region Connection Testing

    public async Task&lt;bool&gt; TestConnectionAsync()
    {
        if (_useMockData)
        {
            _logger?.LogInfo(&quot;[MOCK DATA MODE] Simulating successful Infor Visual connection test&quot;);
            return true;
        }

        try
        {
            _logger?.LogInfo(&quot;Testing Infor Visual connection...&quot;);
            var result = await _dao.TestConnectionAsync();

            if (result.IsSuccess)
            {
                _logger?.LogInfo($&quot;Infor Visual connection test: {(result.Data ? &quot;SUCCESS&quot; : &quot;FAILED&quot;)}&quot;);
                return result.Data;
            }

            _logger?.LogError($&quot;Connection test failed: {result.ErrorMessage}&quot;);
            return false;
        }
        catch (Exception ex)
        {
            _logger?.LogError($&quot;Connection test exception: {ex.Message}&quot;, ex);
            return false;
        }
    }

    #endregion

    #region Purchase Order Operations

    public async Task&lt;Model_Dao_Result&lt;Model_InforVisualPO?&gt;&gt; GetPOWithPartsAsync(string poNumber)
    {
        if (string.IsNullOrWhiteSpace(poNumber))
        {
            return Model_Dao_Result_Factory.Failure&lt;Model_InforVisualPO?&gt;(
                &quot;PO number cannot be null or empty&quot;);
        }

        // Use the PO number as provided - Infor Visual IDs include the prefix (e.g. &quot;PO-123456&quot;)
        string cleanPoNumber = poNumber;

        if (_useMockData)
        {
            _logger?.LogInfo($&quot;[MOCK DATA MODE] Returning mock data for PO: {cleanPoNumber}&quot;);
            return CreateMockPO(cleanPoNumber);
        }

        try
        {
            _logger?.LogInfo($&quot;Querying Infor Visual for PO: {cleanPoNumber}&quot;);

            var result = await _dao.GetPOWithPartsAsync(cleanPoNumber);

            if (!result.IsSuccess)
            {
                _logger?.LogError($&quot;Failed to retrieve PO {cleanPoNumber}: {result.ErrorMessage}&quot;);
                return Model_Dao_Result_Factory.Failure&lt;Model_InforVisualPO?&gt;(result.ErrorMessage);
            }

            if (result.Data == null || result.Data.Count == 0)
            {
                _logger?.LogWarning($&quot;PO {cleanPoNumber} not found&quot;);
                return Model_Dao_Result_Factory.Success&lt;Model_InforVisualPO?&gt;(null);
            }

            // Convert flat DAO model to hierarchical service model
            var po = ConvertToServiceModel(result.Data);
            _logger?.LogInfo($&quot;Successfully retrieved PO {cleanPoNumber} with {po.Parts.Count} line items&quot;);

            return Model_Dao_Result_Factory.Success&lt;Model_InforVisualPO?&gt;(po);
        }
        catch (Exception ex)
        {
            _logger?.LogError($&quot;Unexpected error querying PO {cleanPoNumber}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;Model_InforVisualPO?&gt;(
                $&quot;Unexpected error: {ex.Message}&quot;, ex);
        }
    }

    #endregion

    #region Part Operations

    public async Task&lt;Model_Dao_Result&lt;Model_InforVisualPart?&gt;&gt; GetPartByIDAsync(string partID)
    {
        if (string.IsNullOrWhiteSpace(partID))
        {
            return Model_Dao_Result_Factory.Failure&lt;Model_InforVisualPart?&gt;(
                &quot;Part ID cannot be null or empty&quot;);
        }

        if (_useMockData)
        {
            _logger?.LogInfo($&quot;[MOCK DATA MODE] Returning mock data for Part: {partID}&quot;);
            return CreateMockPart(partID);
        }

        try
        {
            _logger?.LogInfo($&quot;Querying Infor Visual for Part: {partID}&quot;);

            var result = await _dao.GetPartByNumberAsync(partID);

            if (!result.IsSuccess)
            {
                _logger?.LogError($&quot;Failed to retrieve Part {partID}: {result.ErrorMessage}&quot;);
                return Model_Dao_Result_Factory.Failure&lt;Model_InforVisualPart?&gt;(result.ErrorMessage);
            }

            if (result.Data == null)
            {
                _logger?.LogWarning($&quot;Part {partID} not found&quot;);
                return Model_Dao_Result_Factory.Success&lt;Model_InforVisualPart?&gt;(null);
            }

            // Convert DAO model to service model
            var part = ConvertPartToServiceModel(result.Data);
            _logger?.LogInfo($&quot;Successfully retrieved Part {partID}&quot;);

            return Model_Dao_Result_Factory.Success&lt;Model_InforVisualPart?&gt;(part);
        }
        catch (Exception ex)
        {
            _logger?.LogError($&quot;Unexpected error querying Part {partID}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;Model_InforVisualPart?&gt;(
                $&quot;Unexpected error: {ex.Message}&quot;, ex);
        }
    }

    #endregion

    #region Quantity Calculations

    public async Task&lt;Model_Dao_Result&lt;decimal&gt;&gt; GetSameDayReceivingQuantityAsync(
        string poNumber,
        string partID,
        DateTime date)
    {
        if (_useMockData)
        {
            _logger?.LogInfo($&quot;[MOCK DATA MODE] Returning 0 for same-day receiving&quot;);
            return Model_Dao_Result_Factory.Success&lt;decimal&gt;(0);
        }

        // This functionality requires custom query/stored procedure in Infor Visual
        // Not implemented in current SQL files
        _logger?.LogWarning(&quot;Same-day receiving quantity not implemented - returning 0&quot;);
        return Model_Dao_Result_Factory.Success&lt;decimal&gt;(0);
    }

    public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetRemainingQuantityAsync(string poNumber, string partID)
    {
        if (string.IsNullOrWhiteSpace(poNumber))
        {
            return Model_Dao_Result_Factory.Failure&lt;int&gt;(&quot;PO number cannot be null or empty&quot;);
        }

        if (string.IsNullOrWhiteSpace(partID))
        {
            return Model_Dao_Result_Factory.Failure&lt;int&gt;(&quot;Part ID cannot be null or empty&quot;);
        }

        if (_useMockData)
        {
            _logger?.LogInfo($&quot;[MOCK DATA MODE] Returning mock remaining quantity: 100&quot;);
            return Model_Dao_Result_Factory.Success&lt;int&gt;(100);
        }

        try
        {
            _logger?.LogInfo($&quot;Calculating remaining quantity for PO: {poNumber}, Part: {partID}&quot;);

            var result = await _dao.GetPOWithPartsAsync(poNumber);

            if (!result.IsSuccess || result.Data == null || result.Data.Count == 0)
            {
                _logger?.LogWarning($&quot;Failed to retrieve PO {poNumber}&quot;);
                return Model_Dao_Result_Factory.Failure&lt;int&gt;(&quot;PO not found&quot;);
            }

            var matchingLine = result.Data.FirstOrDefault(line =&gt;
                line.PartNumber.Equals(partID, StringComparison.OrdinalIgnoreCase));

            if (matchingLine == null)
            {
                _logger?.LogWarning($&quot;Part {partID} not found on PO {poNumber}&quot;);
                return Model_Dao_Result_Factory.Failure&lt;int&gt;(&quot;Part not found on PO&quot;);
            }

            int remaining = (int)matchingLine.RemainingQty;
            _logger?.LogInfo($&quot;Remaining quantity: {remaining}&quot;);

            return Model_Dao_Result_Factory.Success&lt;int&gt;(remaining);
        }
        catch (Exception ex)
        {
            _logger?.LogError($&quot;Unexpected error calculating remaining quantity: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;int&gt;($&quot;Unexpected error: {ex.Message}&quot;, ex);
        }
    }

    #endregion

    #region Helper Methods - Model Conversion

    /// &lt;summary&gt;
    /// Converts flat DAO PO lines to hierarchical service model
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;poLines&quot;&gt;&lt;/param&gt;
    private Model_InforVisualPO ConvertToServiceModel(List&lt;Models.InforVisual.Model_InforVisualPO&gt; poLines)
    {
        var firstLine = poLines[0];

        return new Model_InforVisualPO
        {
            PONumber = firstLine.PoNumber,
            Vendor = firstLine.VendorName,
            Status = firstLine.PoStatus,
            Parts = poLines.ConvertAll(line =&gt; new Model_InforVisualPart
            {
                PartID = line.PartNumber,
                Description = line.PartDescription,
                POLineNumber = line.PoLine.ToString(),
                PartType = &quot;FG&quot;, // Default - could be enhanced with additional query
                QtyOrdered = (int)line.OrderedQty,
                RemainingQuantity = (int)line.RemainingQty,
                UnitOfMeasure = line.UnitOfMeasure
            })
        };
    }

    /// &lt;summary&gt;
    /// Converts DAO part model to service model
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;daoPart&quot;&gt;&lt;/param&gt;
    private Model_InforVisualPart ConvertPartToServiceModel(Models.InforVisual.Model_InforVisualPart daoPart)
    {
        return new Model_InforVisualPart
        {
            PartID = daoPart.PartNumber,
            Description = daoPart.Description,
            POLineNumber = &quot;N/A&quot;,
            PartType = &quot;FG&quot;, // Default
            QtyOrdered = 0,
            RemainingQuantity = (int)daoPart.AvailableQty,
            UnitOfMeasure = daoPart.PrimaryUom
        };
    }

    #endregion

    #region Mock Data Generation

    private Model_Dao_Result&lt;Model_InforVisualPO?&gt; CreateMockPO(string poNumber)
    {
        var mockPO = new Model_InforVisualPO
        {
            PONumber = poNumber,
            Vendor = &quot;MOCK_VENDOR&quot;,
            Status = &quot;O&quot;,
            Parts = new List&lt;Model_InforVisualPart&gt;
            {
                new Model_InforVisualPart
                {
                    PartID = &quot;MOCK-PART-001&quot;,
                    POLineNumber = &quot;1&quot;,
                    PartType = &quot;RAW&quot;,
                    QtyOrdered = 100,
                    Description = &quot;Mock Part 1 Description&quot;,
                    RemainingQuantity = 50,
                    UnitOfMeasure = &quot;EA&quot;
                },
                new Model_InforVisualPart
                {
                    PartID = &quot;MOCK-PART-002&quot;,
                    POLineNumber = &quot;2&quot;,
                    PartType = &quot;FG&quot;,
                    QtyOrdered = 50,
                    Description = &quot;Mock Part 2 Description&quot;,
                    RemainingQuantity = 10,
                    UnitOfMeasure = &quot;EA&quot;
                }
            }
        };

        return Model_Dao_Result_Factory.Success&lt;Model_InforVisualPO?&gt;(mockPO);
    }

    private Model_Dao_Result&lt;Model_InforVisualPart?&gt; CreateMockPart(string partID)
    {
        var mockPart = new Model_InforVisualPart
        {
            PartID = partID,
            PartType = &quot;MOCK_TYPE&quot;,
            Description = &quot;Mock Part Description&quot;,
            POLineNumber = &quot;N/A&quot;,
            QtyOrdered = 0,
            RemainingQuantity = 100,
            UnitOfMeasure = &quot;EA&quot;
        };

        return Model_Dao_Result_Factory.Success&lt;Model_InforVisualPart?&gt;(mockPart);
    }

    #endregion
}</file><file path="Module_Core/Services/Help/Service_Help.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using System.Linq;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Dunnage.Data;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Shared.Views;

namespace MTM_Receiving_Application.Module_Core.Services.Help;

/// &lt;summary&gt;
/// Service for providing contextual help content throughout the application
/// &lt;/summary&gt;
public class Service_Help : IService_Help
{
    private readonly IService_Window _windowService;
    private readonly IService_LoggingUtility _logger;
    private readonly IService_Dispatcher _dispatcher;
    private readonly Dictionary&lt;string, Model_HelpContent&gt; _helpContentCache;
    private readonly HashSet&lt;string&gt; _dismissedTips;

    public Service_Help(
        IService_Window windowService,
        IService_LoggingUtility logger,
        IService_Dispatcher dispatcher)
    {
        _windowService = windowService;
        _logger = logger;
        _dispatcher = dispatcher;
        _helpContentCache = new Dictionary&lt;string, Model_HelpContent&gt;();
        _dismissedTips = new HashSet&lt;string&gt;();

        InitializeHelpContent();
    }

    #region Show Help Methods

    public async Task ShowHelpAsync(string helpKey)
    {
        try
        {
            var content = GetHelpContent(helpKey);
            if (content == null)
            {
                await _logger.LogWarningAsync($&quot;Help content not found for key: {helpKey}&quot;);
                return;
            }

            // Must execute on UI thread since we&apos;re showing a dialog
            var tcs = new TaskCompletionSource&lt;bool&gt;();

            _dispatcher.TryEnqueue(async () =&gt;
            {
                try
                {
                    var dialog = App.GetService&lt;View_Shared_HelpDialog&gt;();
                    if (dialog == null)
                    {
                        await _logger.LogErrorAsync(&quot;Failed to retrieve HelpDialog from DI container&quot;);
                        tcs.SetResult(false);
                        return;
                    }

                    dialog.SetHelpContent(content);
                    dialog.XamlRoot = _windowService.GetXamlRoot();

                    if (dialog.XamlRoot == null)
                    {
                        await _logger.LogErrorAsync(&quot;XamlRoot is null, cannot show help dialog&quot;);
                        tcs.SetResult(false);
                        return;
                    }

                    await dialog.ShowAsync();
                    await _logger.LogInfoAsync($&quot;Displayed help for: {helpKey}&quot;);
                    tcs.SetResult(true);
                }
                catch (Exception ex)
                {
                    await _logger.LogErrorAsync($&quot;Error in UI thread: {ex.Message}&quot;);
                    tcs.SetException(ex);
                }
            });

            await tcs.Task;
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error showing help for key {helpKey}: {ex.Message}&quot;);
        }
    }

    public async Task ShowContextualHelpAsync(Enum_DunnageWorkflowStep step)
    {
        var key = step switch
        {
            Enum_DunnageWorkflowStep.ModeSelection =&gt; &quot;Dunnage.ModeSelection&quot;,
            Enum_DunnageWorkflowStep.TypeSelection =&gt; &quot;Dunnage.TypeSelection&quot;,
            Enum_DunnageWorkflowStep.PartSelection =&gt; &quot;Dunnage.PartSelection&quot;,
            Enum_DunnageWorkflowStep.QuantityEntry =&gt; &quot;Dunnage.QuantityEntry&quot;,
            Enum_DunnageWorkflowStep.DetailsEntry =&gt; &quot;Dunnage.DetailsEntry&quot;,
            Enum_DunnageWorkflowStep.Review =&gt; &quot;Dunnage.Review&quot;,
            Enum_DunnageWorkflowStep.ManualEntry =&gt; &quot;Dunnage.ManualEntry&quot;,
            Enum_DunnageWorkflowStep.EditMode =&gt; &quot;Dunnage.EditMode&quot;,
            _ =&gt; &quot;Dunnage.ModeSelection&quot;
        };

        await ShowHelpAsync(key);
    }

    public async Task ShowContextualHelpAsync(Enum_ReceivingWorkflowStep step)
    {
        var key = step switch
        {
            Enum_ReceivingWorkflowStep.ModeSelection =&gt; &quot;Receiving.ModeSelection&quot;,
            Enum_ReceivingWorkflowStep.POEntry =&gt; &quot;Receiving.POEntry&quot;,
            Enum_ReceivingWorkflowStep.PartSelection =&gt; &quot;Receiving.PartSelection&quot;,
            Enum_ReceivingWorkflowStep.LoadEntry =&gt; &quot;Receiving.LoadEntry&quot;,
            Enum_ReceivingWorkflowStep.WeightQuantityEntry =&gt; &quot;Receiving.WeightQuantity&quot;,
            Enum_ReceivingWorkflowStep.HeatLotEntry =&gt; &quot;Receiving.HeatLot&quot;,
            Enum_ReceivingWorkflowStep.PackageTypeEntry =&gt; &quot;Receiving.PackageType&quot;,
            Enum_ReceivingWorkflowStep.Review =&gt; &quot;Receiving.Review&quot;,
            Enum_ReceivingWorkflowStep.ManualEntry =&gt; &quot;Receiving.ManualEntry&quot;,
            Enum_ReceivingWorkflowStep.EditMode =&gt; &quot;Receiving.EditMode&quot;,
            _ =&gt; &quot;Receiving.ModeSelection&quot;
        };

        await ShowHelpAsync(key);
    }

    #endregion

    #region Content Retrieval Methods

    public Model_HelpContent? GetHelpContent(string key)
    {
        return _helpContentCache.TryGetValue(key, out var content) ? content : null;
    }

    public List&lt;Model_HelpContent&gt; GetHelpByCategory(string category)
    {
        return _helpContentCache.Values
            .Where(c =&gt; c.Category.Equals(category, StringComparison.OrdinalIgnoreCase))
            .OrderBy(c =&gt; c.Title)
            .ToList();
    }

    public List&lt;Model_HelpContent&gt; SearchHelp(string searchTerm)
    {
        if (string.IsNullOrWhiteSpace(searchTerm))
        {
            return new List&lt;Model_HelpContent&gt;();
        }

        var term = searchTerm.ToLower();
        return _helpContentCache.Values
            .Where(c =&gt; c.Title.ToLower().Contains(term) || c.Content.ToLower().Contains(term))
            .OrderByDescending(c =&gt; c.Title.ToLower().Contains(term))
            .ThenBy(c =&gt; c.Title)
            .Take(20)
            .ToList();
    }

    public async Task&lt;bool&gt; IsDismissedAsync(string helpKey)
    {
        await Task.CompletedTask;
        return _dismissedTips.Contains(helpKey);
    }

    public async Task SetDismissedAsync(string helpKey, bool isDismissed)
    {
        await Task.CompletedTask;
        if (isDismissed)
        {
            _dismissedTips.Add(helpKey);
        }
        else
        {
            _dismissedTips.Remove(helpKey);
        }
    }

    #endregion

    #region Legacy Methods (for backwards compatibility)

    public string GetDunnageWorkflowHelp(Enum_DunnageWorkflowStep step)
    {
        var key = step switch
        {
            Enum_DunnageWorkflowStep.ModeSelection =&gt; &quot;Dunnage.ModeSelection&quot;,
            Enum_DunnageWorkflowStep.TypeSelection =&gt; &quot;Dunnage.TypeSelection&quot;,
            Enum_DunnageWorkflowStep.PartSelection =&gt; &quot;Dunnage.PartSelection&quot;,
            Enum_DunnageWorkflowStep.QuantityEntry =&gt; &quot;Dunnage.QuantityEntry&quot;,
            Enum_DunnageWorkflowStep.DetailsEntry =&gt; &quot;Dunnage.DetailsEntry&quot;,
            Enum_DunnageWorkflowStep.Review =&gt; &quot;Dunnage.Review&quot;,
            Enum_DunnageWorkflowStep.ManualEntry =&gt; &quot;Dunnage.ManualEntry&quot;,
            Enum_DunnageWorkflowStep.EditMode =&gt; &quot;Dunnage.EditMode&quot;,
            _ =&gt; &quot;&quot;
        };

        var content = GetHelpContent(key);
        return content?.Content ?? string.Empty;
    }

    public string GetReceivingWorkflowHelp(Enum_ReceivingWorkflowStep step)
    {
        var key = step switch
        {
            Enum_ReceivingWorkflowStep.ModeSelection =&gt; &quot;Receiving.ModeSelection&quot;,
            Enum_ReceivingWorkflowStep.ManualEntry =&gt; &quot;Receiving.ManualEntry&quot;,
            Enum_ReceivingWorkflowStep.EditMode =&gt; &quot;Receiving.EditMode&quot;,
            Enum_ReceivingWorkflowStep.POEntry =&gt; &quot;Receiving.POEntry&quot;,
            Enum_ReceivingWorkflowStep.PartSelection =&gt; &quot;Receiving.PartSelection&quot;,
            Enum_ReceivingWorkflowStep.LoadEntry =&gt; &quot;Receiving.LoadEntry&quot;,
            Enum_ReceivingWorkflowStep.WeightQuantityEntry =&gt; &quot;Receiving.WeightQuantity&quot;,
            Enum_ReceivingWorkflowStep.HeatLotEntry =&gt; &quot;Receiving.HeatLot&quot;,
            Enum_ReceivingWorkflowStep.PackageTypeEntry =&gt; &quot;Receiving.PackageType&quot;,
            Enum_ReceivingWorkflowStep.Review =&gt; &quot;Receiving.Review&quot;,
            _ =&gt; &quot;&quot;
        };

        var content = GetHelpContent(key);
        return content?.Content ?? string.Empty;
    }

    public string GetTip(string viewName)
    {
        var content = GetHelpContent($&quot;Tip.{viewName}&quot;);
        return content?.Content ?? string.Empty;
    }

    public string GetPlaceholder(string fieldName)
    {
        var content = GetHelpContent($&quot;Placeholder.{fieldName}&quot;);
        return content?.Content ?? string.Empty;
    }

    public string GetTooltip(string elementName)
    {
        var content = GetHelpContent($&quot;Tooltip.{elementName}&quot;);
        return content?.Content ?? string.Empty;
    }

    public string GetInfoBarMessage(string messageKey)
    {
        var content = GetHelpContent($&quot;InfoBar.{messageKey}&quot;);
        return content?.Content ?? string.Empty;
    }

    #endregion

    #region Content Initialization

    private void InitializeHelpContent()
    {
        // Dunnage Workflow Help Content
        InitializeDunnageHelp();

        // Receiving Workflow Help Content
        InitializeReceivingHelp();

        // Admin Help Content
        InitializeAdminHelp();

        // Tooltips
        InitializeTooltips();

        // Placeholders
        InitializePlaceholders();

        // Tips
        InitializeTips();

        // InfoBar Messages
        InitializeInfoBarMessages();
    }

    private void InitializeDunnageHelp()
    {
        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Dunnage.ModeSelection&quot;,
            Title = &quot;Select Entry Mode&quot;,
            Content = &quot;Choose how you want to enter dunnage receiving data:\n\n&quot; +
                      &quot; Guided Wizard - Step-by-step process for single transactions. Best for occasional entries or when you need guidance.\n\n&quot; +
                      &quot; Manual Entry - Bulk grid entry for multiple transactions. Ideal for processing many items at once.\n\n&quot; +
                      &quot; Edit Mode - Review and edit historical data. Use to correct past entries or view receiving history.&quot;,
            Category = &quot;Dunnage Workflow&quot;,
            HelpType = Enum_HelpType.Info,
            Icon = &quot;ViewDashboard&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Dunnage.TypeSelection&quot;, &quot;Dunnage.ManualEntry&quot;, &quot;Dunnage.EditMode&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Dunnage.TypeSelection&quot;,
            Title = &quot;Select Dunnage Type&quot;,
            Content = &quot;Choose the type of dunnage material you are receiving:\n\n&quot; +
                      &quot; Each type has specific specifications and requirements\n&quot; +
                      &quot; Use the search function to quickly find types\n&quot; +
                      &quot; Navigate with pagination controls or quick access buttons\n\n&quot; +
                      &quot;If you don&apos;t see the type you need, contact your administrator to add new types through the Admin section.&quot;,
            Category = &quot;Dunnage Workflow&quot;,
            HelpType = Enum_HelpType.Info,
            Icon = &quot;PackageVariant&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Dunnage.PartSelection&quot;, &quot;Admin.Types&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Dunnage.PartSelection&quot;,
            Title = &quot;Select Part/Specification&quot;,
            Content = &quot;Select the specific part or specification for the dunnage type:\n\n&quot; +
                      &quot; Parts are organized by dunnage type\n&quot; +
                      &quot; Use filters to find specific parts quickly\n&quot; +
                      &quot; Parts marked with inventory status are tracked in the inventory system\n\n&quot; +
                      &quot;**Inventory Status:**\n&quot; +
                      &quot; Green badge - Part is in inventory management system\n&quot; +
                      &quot; No badge - Part is not tracked in inventory\n\n&quot; +
                      &quot;If you don&apos;t see the part you need, use the Quick Add button to create it.&quot;,
            Category = &quot;Dunnage Workflow&quot;,
            HelpType = Enum_HelpType.Info,
            Icon = &quot;ShapeOutline&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Dunnage.QuantityEntry&quot;, &quot;Admin.Parts&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Dunnage.QuantityEntry&quot;,
            Title = &quot;Enter Quantity&quot;,
            Content = &quot;Specify the quantity of dunnage items received:\n\n&quot; +
                      &quot; Enter whole numbers only\n&quot; +
                      &quot; The system will generate individual labels for each item\n&quot; +
                      &quot; You can adjust the quantity later if needed\n\n&quot; +
                      &quot;**Label Generation:**\n&quot; +
                      &quot;Each item will receive a unique label with sequential numbering (e.g., 1 of 10, 2 of 10, etc.)&quot;,
            Category = &quot;Dunnage Workflow&quot;,
            HelpType = Enum_HelpType.Info,
            Icon = &quot;Numeric&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Dunnage.DetailsEntry&quot;, &quot;Dunnage.Review&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Dunnage.DetailsEntry&quot;,
            Title = &quot;Enter Additional Details&quot;,
            Content = &quot;Provide additional information for the dunnage receiving:\n\n&quot; +
                      &quot;**PO Number (Optional):**\n&quot; +
                      &quot; Enter the purchase order number if applicable\n&quot; +
                      &quot; Format: Any alphanumeric format accepted\n\n&quot; +
                      &quot;**Location (Required):**\n&quot; +
                      &quot; Specify where the dunnage is stored\n&quot; +
                      &quot; Use standard warehouse location codes\n&quot; +
                      &quot; Example: A-12-B, DOCK-2, etc.\n\n&quot; +
                      &quot;**Specifications:**\n&quot; +
                      &quot; Additional spec fields may appear based on the dunnage type\n&quot; +
                      &quot; Required fields are marked with an asterisk (*)\n&quot; +
                      &quot; Values must be within specified min/max ranges&quot;,
            Category = &quot;Dunnage Workflow&quot;,
            HelpType = Enum_HelpType.Info,
            Icon = &quot;TextBox&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Dunnage.Review&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Dunnage.Review&quot;,
            Title = &quot;Review &amp; Save&quot;,
            Content = &quot;Review your entries before saving:\n\n&quot; +
                      &quot;**Single View:**\n&quot; +
                      &quot; Review details in card format\n&quot; +
                      &quot; Navigate through entries individually\n\n&quot; +
                      &quot;**Table View:**\n&quot; +
                      &quot; See all entries in a grid\n&quot; +
                      &quot; Quickly spot any errors or inconsistencies\n\n&quot; +
                      &quot;**Actions:**\n&quot; +
                      &quot; Remove - Delete an entry from the session\n&quot; +
                      &quot; Edit - Return to previous steps to modify\n&quot; +
                      &quot; Save - Commit all entries to database and generate labels\n\n&quot; +
                      &quot;After saving, labels will be generated automatically and ready for printing.&quot;,
            Category = &quot;Dunnage Workflow&quot;,
            HelpType = Enum_HelpType.Tutorial,
            Icon = &quot;CheckCircle&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Dunnage.ModeSelection&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Dunnage.ManualEntry&quot;,
            Title = &quot;Manual Entry Mode&quot;,
            Content = &quot;Bulk entry mode for processing multiple dunnage items:\n\n&quot; +
                      &quot;**Features:**\n&quot; +
                      &quot; Add multiple rows at once (up to 100)\n&quot; +
                      &quot; Auto-fill from last entry for the same part\n&quot; +
                      &quot; Fill blank spaces with data from previous row\n&quot; +
                      &quot; Sort entries for optimal label printing\n\n&quot; +
                      &quot;**Tips:**\n&quot; +
                      &quot; Use Tab key to move between cells quickly\n&quot; +
                      &quot; Copy/paste values between cells\n&quot; +
                      &quot; Use bulk operations to speed up data entry\n&quot; +
                      &quot; Sort by Part ID before saving for sequential label numbers&quot;,
            Category = &quot;Dunnage Workflow&quot;,
            HelpType = Enum_HelpType.Tutorial,
            Icon = &quot;Table&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Dunnage.ModeSelection&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Dunnage.EditMode&quot;,
            Title = &quot;Edit Historical Data&quot;,
            Content = &quot;Review and edit past dunnage receiving entries:\n\n&quot; +
                      &quot;**Data Sources:**\n&quot; +
                      &quot; Session Memory - Unsaved work from current session\n&quot; +
                      &quot; Recent Labels - From most recent CSV export\n&quot; +
                      &quot; Historical Loads - From database by date range\n\n&quot; +
                      &quot;**Date Filtering:**\n&quot; +
                      &quot; Quick filters: Today, Last 7 days, This week/month/quarter/year\n&quot; +
                      &quot; Custom date range with start and end dates\n\n&quot; +
                      &quot;**Editing:**\n&quot; +
                      &quot; Select entries to modify\n&quot; +
                      &quot; Make changes directly in the grid\n&quot; +
                      &quot; Save updates back to database\n\n&quot; +
                      &quot; Changes to historical data may affect inventory counts and reports.&quot;,
            Category = &quot;Dunnage Workflow&quot;,
            HelpType = Enum_HelpType.Tutorial,
            Icon = &quot;PencilBox&quot;,
            Severity = Enum_HelpSeverity.Warning,
            RelatedKeys = new List&lt;string&gt; { &quot;Dunnage.ModeSelection&quot; }
        });
    }

    private void InitializeReceivingHelp()
    {
        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Receiving.ManualEntry&quot;,
            Title = &quot;Manual Entry Mode&quot;,
            Content = &quot;Bulk entry mode for processing multiple receiving items:\n\n&quot; +
                      &quot;**Features:**\n&quot; +
                      &quot; Add multiple rows at once\n&quot; +
                      &quot; Auto-fill from last entry\n&quot; +
                      &quot; Sort entries for optimal label printing\n\n&quot; +
                      &quot;**Tips:**\n&quot; +
                      &quot; Use Tab key to move between cells\n&quot; +
                      &quot; Copy/paste values between cells\n&quot; +
                      &quot; Sort by Part ID before saving&quot;,
            Category = &quot;Receiving Workflow&quot;,
            HelpType = Enum_HelpType.Tutorial,
            Icon = &quot;Table&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Receiving.ModeSelection&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Receiving.EditMode&quot;,
            Title = &quot;Edit Historical Data&quot;,
            Content = &quot;Review and edit past receiving entries:\n\n&quot; +
                      &quot;**Data Sources:**\n&quot; +
                      &quot; Session Memory - Unsaved work\n&quot; +
                      &quot; Recent Labels - From most recent CSV export\n&quot; +
                      &quot; Historical Loads - From database by date range\n\n&quot; +
                      &quot;**Editing:**\n&quot; +
                      &quot; Select entries to modify\n&quot; +
                      &quot; Make changes directly in the grid\n&quot; +
                      &quot; Save updates back to database&quot;,
            Category = &quot;Receiving Workflow&quot;,
            HelpType = Enum_HelpType.Tutorial,
            Icon = &quot;PencilBox&quot;,
            Severity = Enum_HelpSeverity.Warning,
            RelatedKeys = new List&lt;string&gt; { &quot;Receiving.ModeSelection&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Receiving.ModeSelection&quot;,
            Title = &quot;Select Entry Mode&quot;,
            Content = &quot;Choose how you want to enter material receiving data:\n\n&quot; +
                      &quot; Guided Wizard - Step-by-step process with PO integration\n&quot; +
                      &quot; Manual Entry - Bulk grid entry for multiple line items\n&quot; +
                      &quot; Edit Mode - Review and modify historical receiving data&quot;,
            Category = &quot;Receiving Workflow&quot;,
            HelpType = Enum_HelpType.Info,
            Icon = &quot;ViewDashboard&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Receiving.POEntry&quot;, &quot;Receiving.ManualEntry&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Receiving.POEntry&quot;,
            Title = &quot;Enter Purchase Order&quot;,
            Content = &quot;Enter the PO number to receive material:\n\n&quot; +
                      &quot;**PO Number Format:**\n&quot; +
                      &quot; With prefix: PO-066868\n&quot; +
                      &quot; Without prefix: 66868\n&quot; +
                      &quot; System accepts both formats\n\n&quot; +
                      &quot;**Infor Visual Integration:**\n&quot; +
                      &quot;The system connects to the Infor Visual ERP system (VISUAL database) to:\n&quot; +
                      &quot; Validate PO exists and is open\n&quot; +
                      &quot; Retrieve available line items\n&quot; +
                      &quot; Populate part IDs and descriptions\n&quot; +
                      &quot; Check ordered quantities\n\n&quot; +
                      &quot;**Part ID Search:**\n&quot; +
                      &quot;Alternatively, search by Part ID (e.g., MMC-001, MMF-456) to find associated POs.&quot;,
            Category = &quot;Receiving Workflow&quot;,
            HelpType = Enum_HelpType.Info,
            Icon = &quot;FileDocument&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Receiving.PartSelection&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Receiving.WeightQuantity&quot;,
            Title = &quot;Weight vs. Quantity&quot;,
            Content = &quot;Choose whether to enter by weight or piece count:\n\n&quot; +
                      &quot;**Use Weight When:**\n&quot; +
                      &quot; Material is sold/received by weight\n&quot; +
                      &quot; Dealing with raw materials, bars, sheets\n&quot; +
                      &quot; Unit of measure is LBS, KG, etc.\n\n&quot; +
                      &quot;**Use Quantity When:**\n&quot; +
                      &quot; Material is counted by pieces\n&quot; +
                      &quot; Dealing with discrete items\n&quot; +
                      &quot; Unit of measure is EA (each), PCS (pieces)\n\n&quot; +
                      &quot;**Important:**\n&quot; +
                      &quot;The selection should match the PO line item&apos;s unit of measure from Infor Visual.&quot;,
            Category = &quot;Receiving Workflow&quot;,
            HelpType = Enum_HelpType.Info,
            Icon = &quot;Scale&quot;,
            Severity = Enum_HelpSeverity.Warning,
            RelatedKeys = new List&lt;string&gt; { &quot;Receiving.HeatLot&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Receiving.HeatLot&quot;,
            Title = &quot;Heat/Lot Numbers&quot;,
            Content = &quot;Enter heat or lot number for material traceability:\n\n&quot; +
                      &quot;**What is a Heat/Lot Number?**\n&quot; +
                      &quot; Unique identifier from the manufacturer\n&quot; +
                      &quot; Tracks material batch or production run\n&quot; +
                      &quot; Required for quality control and traceability\n\n&quot; +
                      &quot;**Format:**\n&quot; +
                      &quot; Alphanumeric, varies by supplier\n&quot; +
                      &quot; Example: H123456, LOT-2024-001\n\n&quot; +
                      &quot;**When Required:**\n&quot; +
                      &quot; Metals and alloys\n&quot; +
                      &quot; Materials with certification requirements\n&quot; +
                      &quot; Quality-critical components\n\n&quot; +
                      &quot;Leave blank if not applicable to the material.&quot;,
            Category = &quot;Receiving Workflow&quot;,
            HelpType = Enum_HelpType.Info,
            Icon = &quot;Barcode&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Receiving.PackageType&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Receiving.Review&quot;,
            Title = &quot;Review &amp; Generate Labels&quot;,
            Content = &quot;Final review before saving and printing labels:\n\n&quot; +
                      &quot;**Review Process:**\n&quot; +
                      &quot; Verify all details are correct\n&quot; +
                      &quot; Check quantities and weights\n&quot; +
                      &quot; Confirm heat/lot numbers\n\n&quot; +
                      &quot;**Saving:**\n&quot; +
                      &quot; Data is saved to MySQL database\n&quot; +
                      &quot; CSV file is exported for records\n&quot; +
                      &quot; Labels are generated automatically\n\n&quot; +
                      &quot;**Label Printing:**\n&quot; +
                      &quot; Labels display all receiving information\n&quot; +
                      &quot; Include barcodes for scanning\n&quot; +
                      &quot; Print directly from the review screen\n\n&quot; +
                      &quot;After saving, you can reprint labels from the Edit Mode if needed.&quot;,
            Category = &quot;Receiving Workflow&quot;,
            HelpType = Enum_HelpType.Tutorial,
            Icon = &quot;CheckCircle&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Receiving.ModeSelection&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Receiving.PartSelection&quot;,
            Title = &quot;Select Part&quot;,
            Content = &quot;Select the part number from the list of items on the Purchase Order:\n\n&quot; +
                      &quot; List shows all open lines on the PO\n&quot; +
                      &quot; Verify part description matches material\n&quot; +
                      &quot; Check ordered quantity vs. received quantity\n\n&quot; +
                      &quot;If the part is not listed, verify the PO number or check with purchasing.&quot;,
            Category = &quot;Receiving Workflow&quot;,
            HelpType = Enum_HelpType.Info,
            Icon = &quot;ShapeOutline&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Receiving.LoadEntry&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Receiving.LoadEntry&quot;,
            Title = &quot;Enter Load Details&quot;,
            Content = &quot;Enter the number of loads (pallets/containers) being received:\n\n&quot; +
                      &quot; Enter total number of identical loads\n&quot; +
                      &quot; System will generate one label per load\n&quot; +
                      &quot; If loads have different quantities/weights, enter them separately\n\n&quot; +
                      &quot;Example: Receiving 3 pallets of 1000 lbs each -&gt; Enter 3 loads.&quot;,
            Category = &quot;Receiving Workflow&quot;,
            HelpType = Enum_HelpType.Info,
            Icon = &quot;Pallet&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Receiving.WeightQuantity&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Receiving.PackageType&quot;,
            Title = &quot;Select Package Type&quot;,
            Content = &quot;Choose the type of packaging for this load:\n\n&quot; +
                      &quot; Standard types: Box, Pallet, Crate, Bundle, etc.\n&quot; +
                      &quot; Custom types: Select &apos;Custom&apos; to enter a new type\n&quot; +
                      &quot; Preferences: System remembers your last choice for this part\n\n&quot; +
                      &quot;Correct package type helps with inventory identification and storage.&quot;,
            Category = &quot;Receiving Workflow&quot;,
            HelpType = Enum_HelpType.Info,
            Icon = &quot;PackageVariant&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Receiving.Review&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Receiving.ManualEntry&quot;,
            Title = &quot;Manual Entry Mode&quot;,
            Content = &quot;Bulk entry mode for processing multiple receiving items:\n\n&quot; +
                      &quot; Add multiple rows for different parts/POs\n&quot; +
                      &quot; Copy/paste functionality supported\n&quot; +
                      &quot; Ideal for mixed loads or high-volume receiving\n\n&quot; +
                      &quot;Ensure all required fields (PO, Part, Qty) are filled before saving.&quot;,
            Category = &quot;Receiving Workflow&quot;,
            HelpType = Enum_HelpType.Tutorial,
            Icon = &quot;Table&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Receiving.ModeSelection&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Receiving.EditMode&quot;,
            Title = &quot;Edit Historical Data&quot;,
            Content = &quot;Review and edit past receiving entries:\n\n&quot; +
                      &quot; Filter by date range or search by PO/Part\n&quot; +
                      &quot; Modify quantities, weights, or heat/lot numbers\n&quot; +
                      &quot; Reprint labels for past receipts\n\n&quot; +
                      &quot;Changes are logged and updated in the database.&quot;,
            Category = &quot;Receiving Workflow&quot;,
            HelpType = Enum_HelpType.Tutorial,
            Icon = &quot;PencilBox&quot;,
            Severity = Enum_HelpSeverity.Warning,
            RelatedKeys = new List&lt;string&gt; { &quot;Receiving.ModeSelection&quot; }
        });
    }

    private void InitializeAdminHelp()
    {
        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Admin.Types&quot;,
            Title = &quot;Manage Dunnage Types&quot;,
            Content = &quot;Create, edit, and delete dunnage types:\n\n&quot; +
                      &quot;**Creating Types:**\n&quot; +
                      &quot; Choose a descriptive, unique name\n&quot; +
                      &quot; Select an appropriate icon for visual identification\n&quot; +
                      &quot; Define specification fields (dimensions, materials, etc.)\n\n&quot; +
                      &quot;**Specification Fields:**\n&quot; +
                      &quot; Text fields - For descriptions, notes\n&quot; +
                      &quot; Number fields - For measurements, quantities\n&quot; +
                      &quot; Set min/max ranges for validation\n&quot; +
                      &quot; Mark fields as required or optional\n\n&quot; +
                      &quot;**Deleting Types:**\n&quot; +
                      &quot; Warning: Deleting a type will affect:\n&quot; +
                      &quot; All associated parts\n&quot; +
                      &quot; Historical receiving records\n&quot; +
                      &quot; Inventory counts\n\n&quot; +
                      &quot;System will show impact analysis before allowing deletion.&quot;,
            Category = &quot;Admin&quot;,
            HelpType = Enum_HelpType.Tutorial,
            Icon = &quot;Cog&quot;,
            Severity = Enum_HelpSeverity.Warning,
            RelatedKeys = new List&lt;string&gt; { &quot;Admin.Parts&quot; }
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Admin.Parts&quot;,
            Title = &quot;Manage Dunnage Parts&quot;,
            Content = &quot;Create and manage dunnage part specifications:\n\n&quot; +
                      &quot;**Part Information:**\n&quot; +
                      &quot; Part must be associated with a dunnage type\n&quot; +
                      &quot; Enter dimensions and specifications as required\n&quot; +
                      &quot; Add descriptive notes for identification\n\n&quot; +
                      &quot;**Inventory Management:**\n&quot; +
                      &quot; Mark parts for inventory tracking\n&quot; +
                      &quot; Set reorder points and quantities\n&quot; +
                      &quot; Track current stock levels\n\n&quot; +
                      &quot;**Search &amp; Filtering:**\n&quot; +
                      &quot; Search by part name or description\n&quot; +
                      &quot; Filter by dunnage type\n&quot; +
                      &quot; Sort by any column\n\n&quot; +
                      &quot;Parts can be created during receiving using Quick Add feature.&quot;,
            Category = &quot;Admin&quot;,
            HelpType = Enum_HelpType.Info,
            Icon = &quot;Shape&quot;,
            Severity = Enum_HelpSeverity.Info,
            RelatedKeys = new List&lt;string&gt; { &quot;Admin.Types&quot;, &quot;Dunnage.PartSelection&quot; }
        });
    }

    private void InitializeTooltips()
    {
        // Navigation tooltips
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.FirstPage&quot;, Content = &quot;First Page&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.PreviousPage&quot;, Content = &quot;Previous Page&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.NextPage&quot;, Content = &quot;Next Page&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.LastPage&quot;, Content = &quot;Last Page&quot;, HelpType = Enum_HelpType.Tip });

        // Mode selection quick access
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.QuickGuidedWizard&quot;, Content = &quot;Skip mode selection and go directly to Guided Wizard&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.QuickManualEntry&quot;, Content = &quot;Skip mode selection and go directly to Manual Entry&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.QuickEditMode&quot;, Content = &quot;Skip mode selection and go directly to Edit Mode&quot;, HelpType = Enum_HelpType.Tip });

        // Workflow actions
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.ReturnToModeSelection&quot;, Content = &quot;Return to mode selection (clears current work)&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.ShowHelp&quot;, Content = &quot;Click for help about current step&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.Refresh&quot;, Content = &quot;Refresh parts list&quot;, HelpType = Enum_HelpType.Tip });

        // Manual entry operations
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.AddMultipleRows&quot;, Content = &quot;Add multiple rows at once (up to 100)&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.AutoFill&quot;, Content = &quot;Auto-fill from last entry for this Part ID&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.FillBlanks&quot;, Content = &quot;Copy PO, Location, and specs from last row to empty fields&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.SortForPrinting&quot;, Content = &quot;Sort by Part ID  PO  Type&quot;, HelpType = Enum_HelpType.Tip });

        // Edit mode data sources
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.LoadSessionMemory&quot;, Content = &quot;Load unsaved loads from current session&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.LoadRecentCSV&quot;, Content = &quot;Load from most recent CSV export&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.LoadHistoricalData&quot;, Content = &quot;Load historical loads from database&quot;, HelpType = Enum_HelpType.Tip });

        // Admin operations
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.CreateType&quot;, Content = &quot;Create a new dunnage type&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.EditType&quot;, Content = &quot;Edit selected type&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.DeleteType&quot;, Content = &quot;Delete selected type with impact analysis&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.ReturnToAdmin&quot;, Content = &quot;Return to admin main navigation&quot;, HelpType = Enum_HelpType.Tip });

        // Admin Parts
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.CreatePart&quot;, Content = &quot;Create a new dunnage part&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.EditPart&quot;, Content = &quot;Edit selected part&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.DeletePart&quot;, Content = &quot;Delete selected part&quot;, HelpType = Enum_HelpType.Tip });

        // Edit Mode
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.RemoveSelectedRows&quot;, Content = &quot;Remove all selected rows&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.FilterLastWeek&quot;, Content = &quot;Show loads from last 7 days&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.FilterToday&quot;, Content = &quot;Show loads from today only&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.FilterThisWeek&quot;, Content = &quot;Show loads from this week (Mon-Sun)&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.FilterThisMonth&quot;, Content = &quot;Show loads from this month&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.FilterThisQuarter&quot;, Content = &quot;Show loads from this quarter&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.FilterShowAll&quot;, Content = &quot;Show all loads from last year&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.SaveChanges&quot;, Content = &quot;Save all changes to database&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.SelectAll&quot;, Content = &quot;Select or deselect all rows&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.RemoveRow&quot;, Content = &quot;Remove selected rows&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.ClearFilters&quot;, Content = &quot;Remove all date filters&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.GoToPage&quot;, Content = &quot;Go to specified page&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.SaveAndFinish&quot;, Content = &quot;Save all changes and finish&quot;, HelpType = Enum_HelpType.Tip });

        // Manual Entry
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.AddRow&quot;, Content = &quot;Add a new row to the grid&quot;, HelpType = Enum_HelpType.Tip });

        // Quick Add Dialog
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.HelpDunnageTypes&quot;, Content = &quot;Click for help about dunnage types&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Field.TypeName&quot;, Content = &quot;Enter a unique descriptive name for this dunnage type&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.SelectIcon&quot;, Content = &quot;Click to browse and select an icon from the icon library&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Field.SpecName&quot;, Content = &quot;Enter a unique name for this specification field&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Field.SpecType&quot;, Content = &quot;Select the data type for this field&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Field.MinValue&quot;, Content = &quot;Minimum allowed value (optional)&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Field.MaxValue&quot;, Content = &quot;Maximum allowed value (optional)&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Field.Unit&quot;, Content = &quot;Unit of measurement to display (optional)&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Field.Required&quot;, Content = &quot;Check if this field must be filled when creating parts&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.AddSpec&quot;, Content = &quot;Add this specification to the list below&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.List.Specs&quot;, Content = &quot;List of specifications defined for this type&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.RemoveSpec&quot;, Content = &quot;Remove this specification&quot;, HelpType = Enum_HelpType.Tip });

        // Review View
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.AddAnother&quot;, Content = &quot;Add another load to the current batch&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.SaveAndGenerate&quot;, Content = &quot;Save all entries to database and generate labels&quot;, HelpType = Enum_HelpType.Tip });

        // Workflow View
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.ModeSelection&quot;, Content = &quot;Return to mode selection (clears current work)&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.StepHelp&quot;, Content = &quot;Click for help about the current step&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.BackStep&quot;, Content = &quot;Go back to previous step&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.NextStep&quot;, Content = &quot;Proceed to next step&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.SaveAndReview&quot;, Content = &quot;Save entry and proceed to review&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.StartNew&quot;, Content = &quot;Start a new receiving entry&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.ResetCSV&quot;, Content = &quot;Clear the CSV data and start over&quot;, HelpType = Enum_HelpType.Tip });

        // Receiving PO Entry
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.LoadPO&quot;, Content = &quot;Load purchase order details from Infor Visual&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.SwitchToNonPO&quot;, Content = &quot;Switch to non-PO entry mode for items without purchase orders&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.LookupPart&quot;, Content = &quot;Look up part details in the system&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Tooltip.Button.SwitchToPO&quot;, Content = &quot;Switch to PO entry mode&quot;, HelpType = Enum_HelpType.Tip });
    }

    private void InitializePlaceholders()
    {
        // Dunnage placeholders
        AddHelpContent(new Model_HelpContent { Key = &quot;Placeholder.Field.Quantity&quot;, Content = &quot;Enter quantity...&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Placeholder.Field.PONumber&quot;, Content = &quot;Enter PO number (optional)...&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Placeholder.Field.Location&quot;, Content = &quot;Enter location...&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Placeholder.Field.PartSelection&quot;, Content = &quot;Choose a part...&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Placeholder.Field.HeatLotNumber&quot;, Content = &quot;Enter heat/lot number or leave blank&quot;, HelpType = Enum_HelpType.Tip });

        // Receiving placeholders
        AddHelpContent(new Model_HelpContent { Key = &quot;Placeholder.Field.PONumberReceiving&quot;, Content = &quot;Enter PO (e.g., 66868 or PO-066868)&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Placeholder.Field.PartID&quot;, Content = &quot;Enter Part ID (e.g., MMC-001, MMF-456)&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Placeholder.Field.Weight&quot;, Content = &quot;Enter weight...&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Placeholder.Field.QuantityNumber&quot;, Content = &quot;Enter whole number&quot;, HelpType = Enum_HelpType.Tip });

        // Date placeholders
        AddHelpContent(new Model_HelpContent { Key = &quot;Placeholder.Field.StartDate&quot;, Content = &quot;Start Date&quot;, HelpType = Enum_HelpType.Tip });
        AddHelpContent(new Model_HelpContent { Key = &quot;Placeholder.Field.EndDate&quot;, Content = &quot;End Date&quot;, HelpType = Enum_HelpType.Tip });
    }

    private void InitializeTips()
    {
        // Dunnage Tips
        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Tip.Dunnage.QuantityEntry&quot;,
            Content = &quot;You can adjust the quantity later if needed. The system will generate individual labels for each item.&quot;,
            HelpType = Enum_HelpType.Tip,
            Icon = &quot;Lightbulb&quot;
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Tip.Dunnage.PartSelection&quot;,
            Content = &quot;Use the search function to quickly find parts. Parts with a green badge are tracked in inventory.&quot;,
            HelpType = Enum_HelpType.Tip,
            Icon = &quot;Lightbulb&quot;
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Tip.Dunnage.ManualEntry&quot;,
            Content = &quot;Use Tab key to navigate between cells quickly. Sort entries by Part ID before saving for sequential labels.&quot;,
            HelpType = Enum_HelpType.Tip,
            Icon = &quot;Lightbulb&quot;
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Tip.Dunnage.TypeSelection&quot;,
            Content = &quot;Choose a dunnage type from the available options below.&quot;,
            HelpType = Enum_HelpType.Tip,
            Icon = &quot;Lightbulb&quot;
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Tip.Dunnage.DetailsEntry&quot;,
            Content = &quot;Provide additional information such as PO number and location for this dunnage receiving.&quot;,
            HelpType = Enum_HelpType.Tip,
            Icon = &quot;Lightbulb&quot;
        });

        // Receiving Tips
        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Tip.Receiving.POEntry&quot;,
            Content = &quot;Enter the purchase order number to load part details from Infor Visual ERP.&quot;,
            HelpType = Enum_HelpType.Tip,
            Icon = &quot;Lightbulb&quot;
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Tip.Receiving.ManualEntry&quot;,
            Content = &quot;Use the manual entry grid for bulk data entry. You can paste from Excel or use Auto-Fill for common data.&quot;,
            HelpType = Enum_HelpType.Tip,
            Icon = &quot;Lightbulb&quot;
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;Tip.Receiving.PartSelection&quot;,
            Content = &quot;Select the part from the list or search by Part ID. The package type is auto-detected based on part specifications.&quot;,
            HelpType = Enum_HelpType.Tip,
            Icon = &quot;Lightbulb&quot;
        });
    }

    private void InitializeInfoBarMessages()
    {
        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;InfoBar.InventoryWarning&quot;,
            Content = &quot;This part is not in the inventoried dunnage list. Add it to inventory for better tracking.&quot;,
            HelpType = Enum_HelpType.Warning,
            Severity = Enum_HelpSeverity.Warning
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;InfoBar.LocationRequired&quot;,
            Content = &quot;Location is required before proceeding to the next step.&quot;,
            HelpType = Enum_HelpType.Warning,
            Severity = Enum_HelpSeverity.Warning
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;InfoBar.SaveSuccess&quot;,
            Content = &quot;Successfully saved all entries. Labels are ready for printing.&quot;,
            HelpType = Enum_HelpType.Info,
            Severity = Enum_HelpSeverity.Info
        });

        AddHelpContent(new Model_HelpContent
        {
            Key = &quot;InfoBar.WeightQuantitySelection&quot;,
            Content = &quot;Choose whether to enter by weight or piece count based on the PO line item unit of measure.&quot;,
            HelpType = Enum_HelpType.Info,
            Severity = Enum_HelpSeverity.Info
        });
    }

    private void AddHelpContent(Model_HelpContent content)
    {
        if (!string.IsNullOrEmpty(content.Key))
        {
            _helpContentCache[content.Key] = content;
        }
    }

    #endregion
}</file><file path="Module_Core/Services/Navigation/Service_Navigation.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Contracts.Services.Navigation;
using System;

namespace MTM_Receiving_Application.Module_Core.Services.Navigation;

/// &lt;summary&gt;
/// Service for handling page navigation
/// &lt;/summary&gt;
public class Service_Navigation : IService_Navigation
{
    private readonly IService_LoggingUtility _logger;

    public Service_Navigation(IService_LoggingUtility logger)
    {
        _logger = logger;
    }

    public bool NavigateTo(Frame frame, Type pageType, object? parameter = null)
    {
        if (frame == null)
        {
            _logger.LogError(&quot;Navigation frame is null&quot;, null, &quot;Service_Navigation&quot;);
            return false;
        }

        if (pageType == null)
        {
            _logger.LogError(&quot;Page type is null&quot;, null, &quot;Service_Navigation&quot;);
            return false;
        }

        try
        {
            var result = frame.Navigate(pageType, parameter);
            if (result)
            {
                _logger.LogInfo($&quot;Navigated to {pageType.Name}&quot;, &quot;Service_Navigation&quot;);
            }
            else
            {
                _logger.LogWarning($&quot;Failed to navigate to {pageType.Name}&quot;, &quot;Service_Navigation&quot;);
            }
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Navigation error: {ex.Message}&quot;, ex, &quot;Service_Navigation&quot;);
            return false;
        }
    }

    public bool NavigateTo(Frame frame, string pageTypeName, object? parameter = null)
    {
        try
        {
            var pageType = Type.GetType(pageTypeName);
            if (pageType == null)
            {
                _logger.LogError($&quot;Could not find type: {pageTypeName}&quot;, null, &quot;Service_Navigation&quot;);
                return false;
            }
            return NavigateTo(frame, pageType, parameter);
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Navigation error: {ex.Message}&quot;, ex, &quot;Service_Navigation&quot;);
            return false;
        }
    }

    public void ClearNavigation(Frame frame)
    {
        if (frame?.Content != null)
        {
            frame.Content = null;
            _logger.LogInfo(&quot;Navigation cleared&quot;, &quot;Service_Navigation&quot;);
        }
    }

    public bool CanGoBack(Frame frame)
    {
        return frame?.CanGoBack ?? false;
    }

    public void GoBack(Frame frame)
    {
        if (frame?.CanGoBack == true)
        {
            frame.GoBack();
            _logger.LogInfo(&quot;Navigated back&quot;, &quot;Service_Navigation&quot;);
        }
    }
}</file><file path="Module_Core/Services/Service_Dispatcher.cs">using System;
using Microsoft.UI.Dispatching;
using MTM_Receiving_Application.Module_Core.Contracts.Services;

namespace MTM_Receiving_Application.Module_Core.Services
{
    /// &lt;summary&gt;
    /// Implementation of IDispatcherService using WinUI DispatcherQueue.
    /// &lt;/summary&gt;
    public class Service_Dispatcher : IService_Dispatcher
    {
        private readonly DispatcherQueue _dispatcherQueue;

        public Service_Dispatcher(DispatcherQueue dispatcherQueue)
        {
            _dispatcherQueue = dispatcherQueue ?? throw new ArgumentNullException(nameof(dispatcherQueue));
        }

        public IService_DispatcherTimer CreateTimer()
        {
            return new Service_DispatcherTimerWrapper(_dispatcherQueue.CreateTimer());
        }

        public bool TryEnqueue(Action callback)
        {
            return _dispatcherQueue.TryEnqueue(() =&gt; callback());
        }
    }
}</file><file path="Module_Core/Services/Service_DispatcherTimerWrapper.cs">using System;
using Microsoft.UI.Dispatching;
using MTM_Receiving_Application.Module_Core.Contracts.Services;

namespace MTM_Receiving_Application.Module_Core.Services
{
    /// &lt;summary&gt;
    /// Wrapper for DispatcherQueueTimer.
    /// &lt;/summary&gt;
    public class Service_DispatcherTimerWrapper : IService_DispatcherTimer
    {
        private readonly DispatcherQueueTimer _timer;

        public Service_DispatcherTimerWrapper(DispatcherQueueTimer timer)
        {
            _timer = timer ?? throw new ArgumentNullException(nameof(timer));
            _timer.Tick += (_, e) =&gt; Tick?.Invoke(this, e);
        }

        public TimeSpan Interval
        {
            get =&gt; _timer.Interval;
            set =&gt; _timer.Interval = value;
        }

        public bool IsRepeating
        {
            get =&gt; _timer.IsRepeating;
            set =&gt; _timer.IsRepeating = value;
        }

        public bool IsRunning =&gt; _timer.IsRunning;

        public event EventHandler&lt;object&gt;? Tick;

        public void Start() =&gt; _timer.Start();

        public void Stop() =&gt; _timer.Stop();
    }
}</file><file path="Module_Core/Services/Service_Notification.cs">using CommunityToolkit.Mvvm.ComponentModel;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Core.Services;

public partial class Service_Notification : ObservableObject, IService_Notification
{
    private readonly IService_Dispatcher _dispatcher;

    [ObservableProperty]
    private string _statusMessage = string.Empty;

    [ObservableProperty]
    private InfoBarSeverity _statusSeverity = InfoBarSeverity.Informational;

    [ObservableProperty]
    private bool _isStatusOpen;

    public Service_Notification(IService_Dispatcher dispatcher)
    {
        _dispatcher = dispatcher;
    }

    public void ShowStatus(string message, InfoBarSeverity severity = InfoBarSeverity.Informational)
    {
        StatusMessage = message;
        StatusSeverity = severity;
        IsStatusOpen = true;

        // Auto-dismiss after 5 seconds if informational or success
        if (severity == InfoBarSeverity.Informational || severity == InfoBarSeverity.Success)
        {
            Task.Delay(5000).ContinueWith(_ =&gt;
            {
                _dispatcher.TryEnqueue(() =&gt;
                {
                    IsStatusOpen = false;
                });
            });
        }
    }
}</file><file path="Module_Core/Services/Service_Pagination.cs">using MTM_Receiving_Application.Module_Core.Contracts.Services;
using System;
using System.Collections.Generic;
using System.Linq;

namespace MTM_Receiving_Application.Module_Core.Services
{
    public class Service_Pagination : IService_Pagination
    {
        private IEnumerable&lt;object&gt;? _source;

        /// &lt;summary&gt;
        /// Default page size
        /// &lt;/summary&gt;
        private int _pageSize = 20;

        public int CurrentPage { get; private set; } = 1;

        public int TotalPages
        {
            get
            {
                if (_source?.Any() != true)
                {
                    return 1;
                }

                return (int)Math.Ceiling((double)TotalItems / PageSize);
            }
        }

        public int PageSize
        {
            get =&gt; _pageSize;
            set
            {
                if (_pageSize != value)
                {
                    _pageSize = value;
                    CurrentPage = 1; // Reset to first page on size change
                    OnPageChanged();
                }
            }
        }

        public int TotalItems =&gt; _source?.Count() ?? 0;

        public bool HasNextPage =&gt; CurrentPage &lt; TotalPages;

        public bool HasPreviousPage =&gt; CurrentPage &gt; 1;

        public event EventHandler? PageChanged;

        public void SetSource&lt;T&gt;(IEnumerable&lt;T&gt; source)
        {
            _source = source?.Cast&lt;object&gt;() ?? Enumerable.Empty&lt;object&gt;();
            CurrentPage = 1;
            OnPageChanged();
        }

        public IEnumerable&lt;T&gt; GetCurrentPageItems&lt;T&gt;()
        {
            if (_source == null)
            {
                return Enumerable.Empty&lt;T&gt;();
            }

            return _source
                .Skip((CurrentPage - 1) * PageSize)
                .Take(PageSize)
                .Cast&lt;T&gt;();
        }

        public bool NextPage()
        {
            if (HasNextPage)
            {
                CurrentPage++;
                OnPageChanged();
                return true;
            }
            return false;
        }

        public bool PreviousPage()
        {
            if (HasPreviousPage)
            {
                CurrentPage--;
                OnPageChanged();
                return true;
            }
            return false;
        }

        public bool FirstPage()
        {
            if (CurrentPage != 1)
            {
                CurrentPage = 1;
                OnPageChanged();
                return true;
            }
            return false;
        }

        public bool LastPage()
        {
            if (CurrentPage != TotalPages)
            {
                CurrentPage = TotalPages;
                OnPageChanged();
                return true;
            }
            return false;
        }

        public bool GoToPage(int pageNumber)
        {
            if (pageNumber &lt; 1)
            {
                pageNumber = 1;
            }

            if (pageNumber &gt; TotalPages)
            {
                pageNumber = TotalPages;
            }

            if (CurrentPage != pageNumber)
            {
                CurrentPage = pageNumber;
                OnPageChanged();
                return true;
            }
            return false;
        }

        private void OnPageChanged()
        {
            PageChanged?.Invoke(this, EventArgs.Empty);
        }
    }
}</file><file path="Module_Core/Services/Service_Window.cs">using Microsoft.UI.Xaml;
using MTM_Receiving_Application.Module_Core.Contracts.Services;

namespace MTM_Receiving_Application.Module_Core.Services;

public class Service_Window : IService_Window
{
    public XamlRoot? GetXamlRoot()
    {
        return App.MainWindow?.Content?.XamlRoot;
    }
}</file><file path="Module_Core/Services/UI/Service_ViewModelRegistry.cs">using System;
using System.Collections.Generic;
using System.Linq;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Contracts.ViewModels;

namespace MTM_Receiving_Application.Module_Core.Services.UI
{
    public class Service_ViewModelRegistry : IService_ViewModelRegistry
    {
        private readonly List&lt;WeakReference&lt;object&gt;&gt; _viewModels = new();

        public void Register(object viewModel)
        {
            _viewModels.Add(new WeakReference&lt;object&gt;(viewModel));
            Cleanup();
        }

        public IEnumerable&lt;T&gt; GetViewModels&lt;T&gt;()
        {
            Cleanup();
            return _viewModels
                .Select(r =&gt; r.TryGetTarget(out var target) ? target : null)
                .Where(t =&gt; t != null &amp;&amp; t is T)
                .Cast&lt;T&gt;();
        }

        public void ClearAllInputs()
        {
            Cleanup();
            foreach (var vmRef in _viewModels)
            {
                if (vmRef.TryGetTarget(out var vm))
                {
                    if (vm is IResettableViewModel resettable)
                    {
                        resettable.ResetToDefaults();
                    }
                }
            }
        }

        private void Cleanup()
        {
            _viewModels.RemoveAll(r =&gt; !r.TryGetTarget(out _));
        }
    }
}</file><file path="Module_Core/Themes/MaterialIcons.xaml">&lt;ResourceDictionary xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
                    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
                    xmlns:local=&quot;using:Material.Icons.WinUI3&quot;&gt;

  &lt;Style TargetType=&quot;local:MaterialIcon&quot;&gt;
    &lt;Setter Property=&quot;IsTabStop&quot; Value=&quot;False&quot; /&gt;
    &lt;Setter Property=&quot;FlowDirection&quot; Value=&quot;LeftToRight&quot; /&gt;
    &lt;Setter Property=&quot;Template&quot;&gt;
      &lt;Setter.Value&gt;
        &lt;ControlTemplate TargetType=&quot;local:MaterialIcon&quot;&gt;
          &lt;Border Background=&quot;{TemplateBinding Background}&quot;
                  BorderBrush=&quot;{TemplateBinding BorderBrush}&quot;
                  BorderThickness=&quot;{TemplateBinding BorderThickness}&quot;&gt;
            &lt;Viewbox FlowDirection=&quot;{TemplateBinding FlowDirection}&quot;&gt;
              &lt;Canvas Width=&quot;24&quot;
                      Height=&quot;24&quot;&gt;
                &lt;Path Data=&quot;{Binding Data, RelativeSource={RelativeSource TemplatedParent}}&quot;
                      Fill=&quot;{TemplateBinding Foreground}&quot; /&gt;
              &lt;/Canvas&gt;
            &lt;/Viewbox&gt;
          &lt;/Border&gt;
        &lt;/ControlTemplate&gt;
      &lt;/Setter.Value&gt;
    &lt;/Setter&gt;
  &lt;/Style&gt;

  &lt;Style TargetType=&quot;local:MaterialIconText&quot;&gt;
    &lt;Setter Property=&quot;IsTabStop&quot; Value=&quot;False&quot; /&gt;
    &lt;Setter Property=&quot;FlowDirection&quot; Value=&quot;LeftToRight&quot; /&gt;
    &lt;Setter Property=&quot;Spacing&quot; Value=&quot;5&quot; /&gt;
    &lt;Setter Property=&quot;Template&quot;&gt;
      &lt;Setter.Value&gt;
        &lt;ControlTemplate TargetType=&quot;local:MaterialIconText&quot;&gt;
          &lt;StackPanel Orientation=&quot;{TemplateBinding Orientation}&quot;
                      Spacing=&quot;{TemplateBinding Spacing}&quot;&gt;
            &lt;local:MaterialIcon Width=&quot;{TemplateBinding IconSize}&quot;
                                Height=&quot;{TemplateBinding IconSize}&quot;
                                Animation=&quot;{TemplateBinding Animation}&quot;
                                Kind=&quot;{TemplateBinding Kind}&quot; /&gt;
            &lt;TextBlock Text=&quot;{TemplateBinding Text}&quot; /&gt;
          &lt;/StackPanel&gt;
        &lt;/ControlTemplate&gt;
      &lt;/Setter.Value&gt;
    &lt;/Setter&gt;
  &lt;/Style&gt;
&lt;/ResourceDictionary&gt;</file><file path="Module_Dunnage/Enums/Enum_DunnageWorkflowStep.cs">namespace MTM_Receiving_Application.Module_Dunnage.Enums
{
    public enum Enum_DunnageWorkflowStep
    {
        ModeSelection = 0,    // Initial step: choose Guided, Manual Entry, or Edit mode
        TypeSelection = 1,    // Select dunnage type (Pallet, Divider, etc.)
        PartSelection = 2,    // Select specific part/spec
        QuantityEntry = 3,    // Enter quantity received
        DetailsEntry = 4,     // Enter additional details (PO number, notes, etc.)
        Review = 5,           // Review session before saving
        ManualEntry = 6,      // Bulk grid entry mode
        EditMode = 7          // Historical data editing mode
    }
}</file><file path="Module_Dunnage/Models/Model_DunnageLine.cs">using System;

namespace MTM_Receiving_Application.Module_Dunnage.Models;

/// &lt;summary&gt;
/// Represents a dunnage/packing material label entry
/// Maps to label_table_dunnage database table
/// &lt;/summary&gt;
public class Model_DunnageLine
{
    /// &lt;summary&gt;
    /// Auto-increment primary key
    /// &lt;/summary&gt;
    public int Id { get; set; }

    /// &lt;summary&gt;
    /// First line of dunnage label text
    /// &lt;/summary&gt;
    public string Line1 { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Second line of dunnage label text
    /// &lt;/summary&gt;
    public string Line2 { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Purchase order number
    /// &lt;/summary&gt;
    public int PONumber { get; set; }

    /// &lt;summary&gt;
    /// Transaction date
    /// &lt;/summary&gt;
    public DateTime Date { get; set; } = DateTime.Now;

    /// &lt;summary&gt;
    /// Employee number who created the label
    /// &lt;/summary&gt;
    public int EmployeeNumber { get; set; }

    /// &lt;summary&gt;
    /// Supplier/vendor name
    /// &lt;/summary&gt;
    public string VendorName { get; set; } = &quot;Unknown&quot;;

    /// &lt;summary&gt;
    /// Storage or destination location
    /// &lt;/summary&gt;
    public string Location { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Label number for multiple labels
    /// &lt;/summary&gt;
    public int LabelNumber { get; set; } = 1;

    /// &lt;summary&gt;
    /// Record creation timestamp
    /// &lt;/summary&gt;
    public DateTime CreatedAt { get; set; }
}</file><file path="Module_Dunnage/Models/Model_DunnagePart.cs">using System;
using System.ComponentModel;
using System.Runtime.CompilerServices;
using System.Collections.Generic;
using System.Text.Json;

namespace MTM_Receiving_Application.Module_Dunnage.Models;

public class Model_DunnagePart : INotifyPropertyChanged
{
    private int _id;
    private string _partId = string.Empty;
    private int _typeId;
    private string _specValues = string.Empty; // JSON string
    private Dictionary&lt;string, object&gt; _specValuesDict = new();
    private string _dunnageTypeName = string.Empty;
    private string _createdBy = string.Empty;
    private DateTime _createdDate = DateTime.Now;
    private string? _modifiedBy;
    private DateTime? _modifiedDate;

    public int Id
    {
        get =&gt; _id;
        set =&gt; SetField(ref _id, value);
    }

    public string PartId
    {
        get =&gt; _partId;
        set =&gt; SetField(ref _partId, value);
    }

    public int TypeId
    {
        get =&gt; _typeId;
        set =&gt; SetField(ref _typeId, value);
    }

    public string SpecValues
    {
        get =&gt; _specValues;
        set
        {
            if (SetField(ref _specValues, value))
            {
                DeserializeSpecValues();
            }
        }
    }

    public Dictionary&lt;string, object&gt; SpecValuesDict
    {
        get =&gt; _specValuesDict;
        set =&gt; SetField(ref _specValuesDict, value);
    }

    private string _homeLocation = string.Empty;

    public string HomeLocation
    {
        get =&gt; _homeLocation;
        set =&gt; SetField(ref _homeLocation, value);
    }

    public string DunnageTypeName
    {
        get =&gt; _dunnageTypeName;
        set =&gt; SetField(ref _dunnageTypeName, value);
    }

    public string CreatedBy
    {
        get =&gt; _createdBy;
        set =&gt; SetField(ref _createdBy, value);
    }

    public DateTime CreatedDate
    {
        get =&gt; _createdDate;
        set =&gt; SetField(ref _createdDate, value);
    }

    public string? ModifiedBy
    {
        get =&gt; _modifiedBy;
        set =&gt; SetField(ref _modifiedBy, value);
    }

    public DateTime? ModifiedDate
    {
        get =&gt; _modifiedDate;
        set =&gt; SetField(ref _modifiedDate, value);
    }

    public event PropertyChangedEventHandler? PropertyChanged;

    protected virtual void OnPropertyChanged([CallerMemberName] string? propertyName = null)
    {
        PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
    }

    protected bool SetField&lt;T&gt;(ref T field, T value, [CallerMemberName] string? propertyName = null)
    {
        if (EqualityComparer&lt;T&gt;.Default.Equals(field, value))
        {
            return false;
        }

        field = value;
        OnPropertyChanged(propertyName);
        return true;
    }

    private void DeserializeSpecValues()
    {
        try
        {
            if (string.IsNullOrWhiteSpace(SpecValues))
            {
                SpecValuesDict = new Dictionary&lt;string, object&gt;();
                return;
            }

            var dict = JsonSerializer.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(SpecValues);
            SpecValuesDict = dict ?? new Dictionary&lt;string, object&gt;();
        }
        catch
        {
            SpecValuesDict = new Dictionary&lt;string, object&gt;();
        }
    }
}</file><file path="Module_Dunnage/Models/Model_DunnageSession.cs">using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Runtime.CompilerServices;

namespace MTM_Receiving_Application.Module_Dunnage.Models;

public class Model_DunnageSession : INotifyPropertyChanged
{
    private int _selectedTypeId;
    private string _selectedTypeName = string.Empty;
    private Model_DunnagePart? _selectedPart;
    private decimal _quantity;
    private string _poNumber = string.Empty;
    private string _location = string.Empty;
    private ObservableCollection&lt;Model_DunnageLoad&gt; _loads = new();

    private Dictionary&lt;string, object&gt;? _specValues;
    private Model_DunnageType? _selectedType;

    public int SelectedTypeId
    {
        get =&gt; _selectedTypeId;
        set =&gt; SetField(ref _selectedTypeId, value);
    }

    public string SelectedTypeName
    {
        get =&gt; _selectedTypeName;
        set =&gt; SetField(ref _selectedTypeName, value);
    }

    public Model_DunnagePart? SelectedPart
    {
        get =&gt; _selectedPart;
        set =&gt; SetField(ref _selectedPart, value);
    }

    public decimal Quantity
    {
        get =&gt; _quantity;
        set =&gt; SetField(ref _quantity, value);
    }

    public string PONumber
    {
        get =&gt; _poNumber;
        set =&gt; SetField(ref _poNumber, value);
    }

    public string Location
    {
        get =&gt; _location;
        set =&gt; SetField(ref _location, value);
    }

    public ObservableCollection&lt;Model_DunnageLoad&gt; Loads
    {
        get =&gt; _loads;
        set
        {
            if (SetField(ref _loads, value))
            {
                OnPropertyChanged(nameof(HasLoads));
                _loads.CollectionChanged += (s, e) =&gt; OnPropertyChanged(nameof(HasLoads));
            }
        }
    }

    public Dictionary&lt;string, object&gt;? SpecValues
    {
        get =&gt; _specValues;
        set =&gt; SetField(ref _specValues, value);
    }

    public Model_DunnageType? SelectedType
    {
        get =&gt; _selectedType;
        set =&gt; SetField(ref _selectedType, value);
    }

    public bool HasLoads =&gt; Loads.Count &gt; 0;

    public Model_DunnageSession()
    {
        _loads.CollectionChanged += (s, e) =&gt; OnPropertyChanged(nameof(HasLoads));
    }

    public event PropertyChangedEventHandler? PropertyChanged;

    protected virtual void OnPropertyChanged([CallerMemberName] string? propertyName = null)
    {
        PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
    }

    protected bool SetField&lt;T&gt;(ref T field, T value, [CallerMemberName] string? propertyName = null)
    {
        if (EqualityComparer&lt;T&gt;.Default.Equals(field, value))
        {
            return false;
        }

        field = value;
        OnPropertyChanged(propertyName);
        return true;
    }
}</file><file path="Module_Dunnage/Models/Model_DunnageSpec.cs">using System;
using System.ComponentModel;
using System.Runtime.CompilerServices;
using System.Collections.Generic;
using System.Text.Json;

namespace MTM_Receiving_Application.Module_Dunnage.Models;

public class Model_DunnageSpec : INotifyPropertyChanged
{
    private int _id;
    private int _typeId;
    private string _specKey = string.Empty;
    private string _specValue = string.Empty; // JSON string
    private Dictionary&lt;string, object&gt; _specsDefinition = new();
    private string _createdBy = string.Empty;
    private DateTime _createdDate = DateTime.Now;
    private string? _modifiedBy;
    private DateTime? _modifiedDate;

    public int Id
    {
        get =&gt; _id;
        set =&gt; SetField(ref _id, value);
    }

    public int TypeId
    {
        get =&gt; _typeId;
        set =&gt; SetField(ref _typeId, value);
    }

    public string SpecKey
    {
        get =&gt; _specKey;
        set =&gt; SetField(ref _specKey, value);
    }

    public string SpecValue
    {
        get =&gt; _specValue;
        set
        {
            if (SetField(ref _specValue, value))
            {
                DeserializeSpecs();
            }
        }
    }

    public Dictionary&lt;string, object&gt; SpecsDefinition
    {
        get =&gt; _specsDefinition;
        set =&gt; SetField(ref _specsDefinition, value);
    }

    public string CreatedBy
    {
        get =&gt; _createdBy;
        set =&gt; SetField(ref _createdBy, value);
    }

    public DateTime CreatedDate
    {
        get =&gt; _createdDate;
        set =&gt; SetField(ref _createdDate, value);
    }

    public string? ModifiedBy
    {
        get =&gt; _modifiedBy;
        set =&gt; SetField(ref _modifiedBy, value);
    }

    public DateTime? ModifiedDate
    {
        get =&gt; _modifiedDate;
        set =&gt; SetField(ref _modifiedDate, value);
    }

    public event PropertyChangedEventHandler? PropertyChanged;

    protected virtual void OnPropertyChanged([CallerMemberName] string? propertyName = null)
    {
        PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
    }

    protected bool SetField&lt;T&gt;(ref T field, T value, [CallerMemberName] string? propertyName = null)
    {
        if (EqualityComparer&lt;T&gt;.Default.Equals(field, value))
        {
            return false;
        }

        field = value;
        OnPropertyChanged(propertyName);
        return true;
    }

    private void DeserializeSpecs()
    {
        try
        {
            if (string.IsNullOrWhiteSpace(SpecValue))
            {
                SpecsDefinition = new Dictionary&lt;string, object&gt;();
                return;
            }

            var dict = JsonSerializer.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(SpecValue);
            SpecsDefinition = dict ?? new Dictionary&lt;string, object&gt;();
        }
        catch
        {
            SpecsDefinition = new Dictionary&lt;string, object&gt;();
        }
    }
}</file><file path="Module_Dunnage/Models/Model_DunnageType.cs">using System;
using System.Collections.Generic;
using CommunityToolkit.Mvvm.ComponentModel;
using Material.Icons;

namespace MTM_Receiving_Application.Module_Dunnage.Models;

/// &lt;summary&gt;
/// Represents a dunnage type classification.
/// Database Table: dunnage_types
/// &lt;/summary&gt;
public partial class Model_DunnageType : ObservableObject
{
    [ObservableProperty]
    private int _id;

    [ObservableProperty]
    private string _typeName = string.Empty;

    [ObservableProperty]
    private string _icon = &quot;\uDB81\uDF20&quot;; // Default to box icon (Fluent System Icons)

    [ObservableProperty]
    private string _specsJson = string.Empty;

    [ObservableProperty]
    private string _createdBy = string.Empty;

    [ObservableProperty]
    private DateTime _createdDate = DateTime.Now;

    [ObservableProperty]
    private string? _modifiedBy;

    [ObservableProperty]
    private DateTime? _modifiedDate;

    // Aliases for ViewModel compatibility (spec 010-dunnage-complete)

    public string DunnageType
    {
        get =&gt; TypeName;
        set =&gt; TypeName = value;
    }

    public DateTime DateAdded
    {
        get =&gt; CreatedDate;
        set =&gt; CreatedDate = value;
    }

    public string AddedBy
    {
        get =&gt; CreatedBy;
        set =&gt; CreatedBy = value;
    }

    public DateTime? LastModified
    {
        get =&gt; ModifiedDate;
        set =&gt; ModifiedDate = value;
    }

    /// &lt;summary&gt;
    /// Gets the MaterialIconKind enum for displaying the icon
    /// &lt;/summary&gt;
    public MaterialIconKind IconKind
    {
        get
        {
            // Try to parse the Icon string as a MaterialIconKind enum
            if (!string.IsNullOrEmpty(Icon) &amp;&amp; Enum.TryParse&lt;MaterialIconKind&gt;(Icon, true, out var kind))
            {
                return kind;
            }
            // Default to PackageVariantClosed if parsing fails
            return MaterialIconKind.PackageVariantClosed;
        }
    }
}</file><file path="Module_Dunnage/Models/Model_IconDefinition.cs">using System.Collections.Generic;
using CommunityToolkit.Mvvm.ComponentModel;
using Material.Icons;

namespace MTM_Receiving_Application.Module_Dunnage.Models;

/// &lt;summary&gt;
/// Represents an icon definition for the Add Type Dialog icon picker.
/// Contains Material Design Icons metadata.
/// &lt;/summary&gt;
public partial class Model_IconDefinition : ObservableObject
{
    [ObservableProperty]
    private MaterialIconKind _kind;

    [ObservableProperty]
    private string _name = string.Empty;

    [ObservableProperty]
    private string _category = string.Empty;

    [ObservableProperty]
    private int _usageCount;

    [ObservableProperty]
    private bool _isRecentlyUsed;

    private static readonly Dictionary&lt;string, MaterialIconKind&gt; LegacyMapping = new()
    {
        { &quot;Box&quot;, MaterialIconKind.PackageVariantClosed },
        { &quot;Package&quot;, MaterialIconKind.PackageVariant },
        { &quot;Cube&quot;, MaterialIconKind.CubeOutline },
        { &quot;Folder&quot;, MaterialIconKind.Folder },
        { &quot;Calendar&quot;, MaterialIconKind.Calendar },
        { &quot;Mail&quot;, MaterialIconKind.Email },
        { &quot;Flag&quot;, MaterialIconKind.Flag },
        { &quot;Star&quot;, MaterialIconKind.Star },
        { &quot;Heart&quot;, MaterialIconKind.Heart },
        { &quot;Pin&quot;, MaterialIconKind.Pin },
        { &quot;Tag&quot;, MaterialIconKind.Tag },
        { &quot;Important&quot;, MaterialIconKind.AlertCircle },
        { &quot;Warning&quot;, MaterialIconKind.Alert },
        { &quot;Info&quot;, MaterialIconKind.Information },
        { &quot;Document&quot;, MaterialIconKind.FileDocument },
        { &quot;Image&quot;, MaterialIconKind.Image },
        { &quot;Music&quot;, MaterialIconKind.MusicNote },
        { &quot;Video&quot;, MaterialIconKind.Video }
    };

    // Alias for compatibility
    public string IconName
    {
        get =&gt; Kind.ToString();
        set
        {
            if (System.Enum.TryParse&lt;MaterialIconKind&gt;(value, out var result))
            {
                Kind = result;
                Name = value;
            }
            else if (LegacyMapping.TryGetValue(value, out var legacyResult))
            {
                Kind = legacyResult;
                Name = legacyResult.ToString();
            }
            else
            {
                Name = value;
            }
        }
    }
}</file><file path="Module_Dunnage/Models/Model_InventoriedDunnage.cs">using System;
using System.ComponentModel;
using System.Runtime.CompilerServices;
using System.Collections.Generic;

namespace MTM_Receiving_Application.Module_Dunnage.Models;

public class Model_InventoriedDunnage : INotifyPropertyChanged
{
    private int _id;
    private string _partId = string.Empty;
    private string? _inventoryMethod;
    private string? _notes;
    private string _createdBy = string.Empty;
    private DateTime _createdDate = DateTime.Now;
    private string? _modifiedBy;
    private DateTime? _modifiedDate;

    public int Id
    {
        get =&gt; _id;
        set =&gt; SetField(ref _id, value);
    }

    public string PartId
    {
        get =&gt; _partId;
        set =&gt; SetField(ref _partId, value);
    }

    public string? InventoryMethod
    {
        get =&gt; _inventoryMethod;
        set =&gt; SetField(ref _inventoryMethod, value);
    }

    public string? Notes
    {
        get =&gt; _notes;
        set =&gt; SetField(ref _notes, value);
    }

    public string CreatedBy
    {
        get =&gt; _createdBy;
        set =&gt; SetField(ref _createdBy, value);
    }

    public DateTime CreatedDate
    {
        get =&gt; _createdDate;
        set =&gt; SetField(ref _createdDate, value);
    }

    public string? ModifiedBy
    {
        get =&gt; _modifiedBy;
        set =&gt; SetField(ref _modifiedBy, value);
    }

    public DateTime? ModifiedDate
    {
        get =&gt; _modifiedDate;
        set =&gt; SetField(ref _modifiedDate, value);
    }

    public event PropertyChangedEventHandler? PropertyChanged;

    protected virtual void OnPropertyChanged([CallerMemberName] string? propertyName = null)
    {
        PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
    }

    protected bool SetField&lt;T&gt;(ref T field, T value, [CallerMemberName] string? propertyName = null)
    {
        if (EqualityComparer&lt;T&gt;.Default.Equals(field, value))
        {
            return false;
        }

        field = value;
        OnPropertyChanged(propertyName);
        return true;
    }
}</file><file path="Module_Dunnage/Models/Model_SpecInput.cs">using CommunityToolkit.Mvvm.ComponentModel;

namespace MTM_Receiving_Application.Module_Dunnage.Models;

/// &lt;summary&gt;
/// Represents a dynamic spec input field for dunnage label generation
/// &lt;/summary&gt;
public partial class Model_SpecInput : ObservableObject
{
    [ObservableProperty]
    private string _specName = string.Empty;

    [ObservableProperty]
    private string _specType = &quot;text&quot;; // &quot;text&quot;, &quot;number&quot;, &quot;boolean&quot;

    [ObservableProperty]
    private object? _value;

    [ObservableProperty]
    private string? _unit;

    [ObservableProperty]
    private bool _isRequired;
}</file><file path="Module_Dunnage/Models/Model_SpecItem.cs">using Microsoft.UI.Xaml;
using System.Collections.Generic;

namespace MTM_Receiving_Application.Module_Dunnage.Models;

/// &lt;summary&gt;
/// UI model for displaying and editing specification items in dialogs
/// &lt;/summary&gt;
public class Model_SpecItem
{
    public string Name { get; set; } = string.Empty;
    public string DataType { get; set; } = &quot;Text&quot;;
    public bool IsRequired { get; set; }
    public string Unit { get; set; } = string.Empty;
    public double? MinValue { get; set; }
    public double? MaxValue { get; set; }

    public string Description
    {
        get
        {
            var desc = DataType;
            var parts = new List&lt;string&gt;();

            if (MinValue.HasValue)
            {
                parts.Add($&quot;Min: {MinValue.Value}&quot;);
            }

            if (MaxValue.HasValue)
            {
                parts.Add($&quot;Max: {MaxValue.Value}&quot;);
            }

            if (!string.IsNullOrEmpty(Unit))
            {
                parts.Add(Unit);
            }

            if (parts.Count &gt; 0)
            {
                desc += $&quot; ({string.Join(&quot;, &quot;, parts)})&quot;;
            }

            return desc;
        }
    }

    public Visibility IsRequiredVisibility =&gt; IsRequired ? Visibility.Visible : Visibility.Collapsed;
}</file><file path="Module_Dunnage/Models/SpecDefinition.cs">using System.Text.Json.Serialization;

namespace MTM_Receiving_Application.Module_Dunnage.Models;

public class SpecDefinition
{
    [JsonPropertyName(&quot;dataType&quot;)]
    public string DataType { get; set; } = &quot;Text&quot;; // Text, Number, Boolean

    [JsonPropertyName(&quot;type&quot;)]
    public string Type { get =&gt; DataType; set =&gt; DataType = value; }

    [JsonPropertyName(&quot;required&quot;)]
    public bool Required { get; set; } = false;

    [JsonPropertyName(&quot;defaultValue&quot;)]
    public string DefaultValue { get; set; } = string.Empty;

    // Number specific
    [JsonPropertyName(&quot;minValue&quot;)]
    public double? MinValue { get; set; }

    [JsonPropertyName(&quot;maxValue&quot;)]
    public double? MaxValue { get; set; }

    [JsonPropertyName(&quot;unit&quot;)]
    public string Unit { get; set; } = string.Empty;
}</file><file path="Module_Dunnage/Views/View_Dunnage_AdminInventoryView.xaml">&lt;Page
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_AdminInventoryView&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    xmlns:models=&quot;using:MTM_Receiving_Application.Module_Dunnage.Models&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;
    Background=&quot;{ThemeResource ApplicationPageBackgroundThemeBrush}&quot;&gt;

    &lt;Page.Resources&gt;
        &lt;converters:Converter_IntToVisibility x:Key=&quot;IntToVisibilityConverter&quot;/&gt;
        &lt;converters:Converter_StringFormat x:Key=&quot;DateTimeToStringConverter&quot;/&gt;
    &lt;/Page.Resources&gt;

    &lt;Grid Padding=&quot;24&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header --&gt;
        &lt;StackPanel Grid.Row=&quot;0&quot; Margin=&quot;0,0,0,16&quot;&gt;
            &lt;TextBlock 
                Text=&quot;Manage Inventoried Parts&quot; 
                Style=&quot;{StaticResource TitleTextBlockStyle}&quot;/&gt;
            &lt;TextBlock 
                Text=&quot;Configure parts that require inventory tracking&quot; 
                Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;
                Margin=&quot;0,8,0,0&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Toolbar --&gt;
        &lt;CommandBar Grid.Row=&quot;1&quot; DefaultLabelPosition=&quot;Right&quot; Margin=&quot;0,0,0,16&quot;&gt;
            &lt;AppBarButton 
                Icon=&quot;Add&quot; 
                Label=&quot;Add Part to List&quot;
                Command=&quot;{x:Bind ViewModel.ShowAddToListCommand}&quot;
                ToolTipService.ToolTip=&quot;Add a part to the inventory tracking list&quot;/&gt;
            &lt;AppBarSeparator/&gt;
            &lt;AppBarButton 
                Icon=&quot;Edit&quot; 
                Label=&quot;Edit Entry&quot;
                Command=&quot;{x:Bind ViewModel.ShowEditEntryCommand}&quot;
                IsEnabled=&quot;{x:Bind ViewModel.HasSelection, Mode=OneWay}&quot;
                ToolTipService.ToolTip=&quot;Edit the selected inventory entry&quot;/&gt;
            &lt;AppBarButton 
                Icon=&quot;Delete&quot; 
                Label=&quot;Remove from List&quot;
                Command=&quot;{x:Bind ViewModel.ShowRemoveConfirmationCommand}&quot;
                IsEnabled=&quot;{x:Bind ViewModel.HasSelection, Mode=OneWay}&quot;
                ToolTipService.ToolTip=&quot;Remove the selected part from inventory tracking&quot;/&gt;
            &lt;AppBarSeparator/&gt;
            &lt;AppBarButton 
                Icon=&quot;Back&quot; 
                Label=&quot;Back to Admin Hub&quot;
                Command=&quot;{x:Bind ViewModel.BackToHubCommand}&quot;
                ToolTipService.ToolTip=&quot;Return to the admin hub&quot;/&gt;
        &lt;/CommandBar&gt;

        &lt;!-- DataGrid --&gt;
        &lt;Border 
            Grid.Row=&quot;2&quot; 
            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
            BorderThickness=&quot;1&quot;
            CornerRadius=&quot;8&quot;
            Padding=&quot;1&quot;&gt;
            &lt;Grid&gt;
                &lt;controls:DataGrid
                    ItemsSource=&quot;{x:Bind ViewModel.InventoriedParts, Mode=OneWay}&quot;
                    SelectedItem=&quot;{x:Bind ViewModel.SelectedInventoriedPart, Mode=TwoWay}&quot;
                    AutoGenerateColumns=&quot;False&quot;
                    IsReadOnly=&quot;True&quot;
                    GridLinesVisibility=&quot;Horizontal&quot;
                    HeadersVisibility=&quot;Column&quot;
                    SelectionMode=&quot;Single&quot;
                    CanUserReorderColumns=&quot;False&quot;
                    CanUserSortColumns=&quot;True&quot;
                    VerticalScrollBarVisibility=&quot;Auto&quot;
                    HorizontalScrollBarVisibility=&quot;Auto&quot;
                    AlternatingRowBackground=&quot;{ThemeResource SubtleFillColorSecondaryBrush}&quot;&gt;

                    &lt;controls:DataGrid.Columns&gt;
                        &lt;!-- Part ID Column --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Part ID&quot; 
                            Binding=&quot;{Binding PartId}&quot;
                            Width=&quot;2*&quot;
                            CanUserResize=&quot;True&quot;/&gt;

                        &lt;!-- Inventory Method Column --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Inventory Method&quot; 
                            Binding=&quot;{Binding InventoryMethod}&quot;
                            Width=&quot;*&quot;
                            CanUserResize=&quot;True&quot;/&gt;

                        &lt;!-- Notes Column --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Notes&quot; 
                            Binding=&quot;{Binding Notes}&quot;
                            Width=&quot;3*&quot;
                            CanUserResize=&quot;True&quot;/&gt;

                        &lt;!-- Date Added Column --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Date Added&quot; 
                            Binding=&quot;{Binding CreatedDate, Converter={StaticResource DateTimeToStringConverter}}&quot;
                            Width=&quot;*&quot;
                            CanUserResize=&quot;True&quot;/&gt;

                        &lt;!-- Added By Column --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Added By&quot; 
                            Binding=&quot;{Binding CreatedBy}&quot;
                            Width=&quot;*&quot;
                            CanUserResize=&quot;True&quot;/&gt;

                        &lt;!-- Last Modified Column --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Last Modified&quot; 
                            Binding=&quot;{Binding ModifiedDate, Converter={StaticResource DateTimeToStringConverter}}&quot;
                            Width=&quot;*&quot;
                            CanUserResize=&quot;True&quot;/&gt;

                        &lt;!-- Modified By Column --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Modified By&quot; 
                            Binding=&quot;{Binding ModifiedBy}&quot;
                            Width=&quot;*&quot;
                            CanUserResize=&quot;True&quot;/&gt;
                    &lt;/controls:DataGrid.Columns&gt;
                &lt;/controls:DataGrid&gt;

                &lt;!-- Empty State --&gt;
                &lt;StackPanel 
                    VerticalAlignment=&quot;Center&quot; 
                    HorizontalAlignment=&quot;Center&quot;
                    Spacing=&quot;16&quot;
                    Visibility=&quot;{x:Bind ViewModel.InventoriedParts.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=Inverse}&quot;&gt;
                    &lt;FontIcon 
                        Glyph=&quot;&amp;#xE7C3;&quot; 
                        FontSize=&quot;72&quot;
                        Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;/&gt;
                    &lt;TextBlock 
                        Text=&quot;No inventoried parts found&quot; 
                        Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;
                        Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;/&gt;
                    &lt;TextBlock 
                        Text=&quot;Click &apos;Add Part to List&apos; to configure parts that require inventory tracking&quot;
                        Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                        Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/Grid&gt;
        &lt;/Border&gt;

        &lt;!-- Status Bar --&gt;
        &lt;StackPanel Grid.Row=&quot;3&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot; Margin=&quot;0,16,0,0&quot;&gt;
            &lt;ProgressRing 
                IsActive=&quot;{x:Bind ViewModel.IsBusy, Mode=OneWay}&quot;
                Width=&quot;20&quot; 
                Height=&quot;20&quot;/&gt;
            &lt;TextBlock Text=&quot;{x:Bind ViewModel.StatusMessage, Mode=OneWay}&quot;/&gt;
            &lt;TextBlock 
                Text=&quot;|&quot;
                Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;
                Margin=&quot;8,0,8,0&quot;/&gt;
            &lt;TextBlock&gt;
                &lt;Run Text=&quot;Total Parts:&quot;/&gt;
                &lt;Run Text=&quot;{x:Bind ViewModel.InventoriedParts.Count, Mode=OneWay}&quot; FontWeight=&quot;SemiBold&quot;/&gt;
            &lt;/TextBlock&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_AdminMainView.xaml">&lt;Page
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_AdminMainView&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:local=&quot;using:MTM_Receiving_Application.Module_Dunnage.Views&quot;
    mc:Ignorable=&quot;d&quot;
    Background=&quot;{ThemeResource ApplicationPageBackgroundThemeBrush}&quot;&gt;

    &lt;Grid Padding=&quot;24&quot;&gt;
        &lt;!-- Main Navigation Hub (4-card view) --&gt;
        &lt;Grid Visibility=&quot;{x:Bind ViewModel.IsMainNavigationVisible, Mode=OneWay}&quot;&gt;
            &lt;Grid.RowDefinitions&gt;
                &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                &lt;RowDefinition Height=&quot;*&quot;/&gt;
                &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;/Grid.RowDefinitions&gt;

            &lt;!-- Header --&gt;
            &lt;StackPanel Grid.Row=&quot;0&quot; Margin=&quot;0,0,0,24&quot;&gt;
                &lt;TextBlock 
                    Text=&quot;Dunnage Management&quot; 
                    Style=&quot;{StaticResource TitleTextBlockStyle}&quot;/&gt;
                &lt;TextBlock 
                    Text=&quot;Manage types, parts, specifications, and inventory&quot; 
                    Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                    Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;
                    Margin=&quot;0,8,0,0&quot;/&gt;
            &lt;/StackPanel&gt;

            &lt;!-- 4 Navigation Cards (2x2 Grid) --&gt;
            &lt;Grid Grid.Row=&quot;1&quot; VerticalAlignment=&quot;Center&quot;&gt;
                &lt;Grid.RowDefinitions&gt;
                    &lt;RowDefinition Height=&quot;*&quot;/&gt;
                    &lt;RowDefinition Height=&quot;*&quot;/&gt;
                &lt;/Grid.RowDefinitions&gt;
                &lt;Grid.ColumnDefinitions&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;/Grid.ColumnDefinitions&gt;

                &lt;!-- Type Management Card --&gt;
                &lt;Button 
                    Grid.Row=&quot;0&quot; 
                    Grid.Column=&quot;0&quot;
                    Command=&quot;{x:Bind ViewModel.NavigateToManageTypesCommand}&quot;
                    HorizontalAlignment=&quot;Stretch&quot;
                    VerticalAlignment=&quot;Stretch&quot;
                    Margin=&quot;0,0,12,12&quot;
                    Padding=&quot;24&quot;
                    Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                    BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                    BorderThickness=&quot;1&quot;
                    CornerRadius=&quot;8&quot;&gt;
                    &lt;StackPanel Spacing=&quot;12&quot;&gt;
                        &lt;FontIcon 
                            Glyph=&quot;&amp;#xE7C3;&quot; 
                            FontSize=&quot;48&quot;
                            Foreground=&quot;{ThemeResource SystemAccentColor}&quot;/&gt;
                        &lt;TextBlock 
                            Text=&quot;Manage Types&quot; 
                            Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;
                            HorizontalAlignment=&quot;Center&quot;/&gt;
                        &lt;TextBlock 
                            Text=&quot;Add, edit, and delete dunnage types&quot;
                            Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                            Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;
                            TextWrapping=&quot;Wrap&quot;
                            HorizontalAlignment=&quot;Center&quot;
                            TextAlignment=&quot;Center&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;

                &lt;!-- Spec Management Card --&gt;
                &lt;Button 
                    Grid.Row=&quot;0&quot; 
                    Grid.Column=&quot;1&quot;
                    Command=&quot;{x:Bind ViewModel.NavigateToManageSpecsCommand}&quot;
                    HorizontalAlignment=&quot;Stretch&quot;
                    VerticalAlignment=&quot;Stretch&quot;
                    Margin=&quot;12,0,0,12&quot;
                    Padding=&quot;24&quot;
                    Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                    BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                    BorderThickness=&quot;1&quot;
                    CornerRadius=&quot;8&quot;&gt;
                    &lt;StackPanel Spacing=&quot;12&quot;&gt;
                        &lt;FontIcon 
                            Glyph=&quot;&amp;#xE8FD;&quot; 
                            FontSize=&quot;48&quot;
                            Foreground=&quot;{ThemeResource SystemAccentColor}&quot;/&gt;
                        &lt;TextBlock 
                            Text=&quot;Manage Specs&quot; 
                            Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;
                            HorizontalAlignment=&quot;Center&quot;/&gt;
                        &lt;TextBlock 
                            Text=&quot;Define specifications for each type&quot;
                            Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                            Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;
                            TextWrapping=&quot;Wrap&quot;
                            HorizontalAlignment=&quot;Center&quot;
                            TextAlignment=&quot;Center&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;

                &lt;!-- Part Management Card --&gt;
                &lt;Button 
                    Grid.Row=&quot;1&quot; 
                    Grid.Column=&quot;0&quot;
                    Command=&quot;{x:Bind ViewModel.NavigateToManagePartsCommand}&quot;
                    HorizontalAlignment=&quot;Stretch&quot;
                    VerticalAlignment=&quot;Stretch&quot;
                    Margin=&quot;0,12,12,0&quot;
                    Padding=&quot;24&quot;
                    Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                    BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                    BorderThickness=&quot;1&quot;
                    CornerRadius=&quot;8&quot;&gt;
                    &lt;StackPanel Spacing=&quot;12&quot;&gt;
                        &lt;FontIcon 
                            Glyph=&quot;&amp;#xE8F1;&quot; 
                            FontSize=&quot;48&quot;
                            Foreground=&quot;{ThemeResource SystemAccentColor}&quot;/&gt;
                        &lt;TextBlock 
                            Text=&quot;Manage Parts&quot; 
                            Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;
                            HorizontalAlignment=&quot;Center&quot;/&gt;
                        &lt;TextBlock 
                            Text=&quot;Add and edit dunnage part numbers&quot;
                            Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                            Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;
                            TextWrapping=&quot;Wrap&quot;
                            HorizontalAlignment=&quot;Center&quot;
                            TextAlignment=&quot;Center&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;

                &lt;!-- Inventoried List Card --&gt;
                &lt;Button 
                    Grid.Row=&quot;1&quot; 
                    Grid.Column=&quot;1&quot;
                    Command=&quot;{x:Bind ViewModel.NavigateToInventoriedListCommand}&quot;
                    HorizontalAlignment=&quot;Stretch&quot;
                    VerticalAlignment=&quot;Stretch&quot;
                    Margin=&quot;12,12,0,0&quot;
                    Padding=&quot;24&quot;
                    Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                    BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                    BorderThickness=&quot;1&quot;
                    CornerRadius=&quot;8&quot;&gt;
                    &lt;StackPanel Spacing=&quot;12&quot;&gt;
                        &lt;FontIcon 
                            Glyph=&quot;&amp;#xE8EF;&quot; 
                            FontSize=&quot;48&quot;
                            Foreground=&quot;{ThemeResource SystemAccentColor}&quot;/&gt;
                        &lt;TextBlock 
                            Text=&quot;Inventoried List&quot; 
                            Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;
                            HorizontalAlignment=&quot;Center&quot;/&gt;
                        &lt;TextBlock 
                            Text=&quot;Manage inventory tracking settings&quot;
                            Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                            Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;
                            TextWrapping=&quot;Wrap&quot;
                            HorizontalAlignment=&quot;Center&quot;
                            TextAlignment=&quot;Center&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
            &lt;/Grid&gt;

            &lt;!-- Status Bar --&gt;
            &lt;StackPanel Grid.Row=&quot;2&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot; Margin=&quot;0,24,0,0&quot;&gt;
                &lt;ProgressRing 
                    IsActive=&quot;{x:Bind ViewModel.IsBusy, Mode=OneWay}&quot;
                    Width=&quot;20&quot; 
                    Height=&quot;20&quot;/&gt;
                &lt;TextBlock Text=&quot;{x:Bind ViewModel.StatusMessage, Mode=OneWay}&quot;/&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;

        &lt;!-- Type Management Section --&gt;
        &lt;Grid Visibility=&quot;{x:Bind ViewModel.IsManageTypesVisible, Mode=OneWay}&quot;&gt;
            &lt;local:View_Dunnage_AdminTypesView/&gt;
        &lt;/Grid&gt;

        &lt;!-- Spec Management Section (placeholder) --&gt;
        &lt;Grid Visibility=&quot;{x:Bind ViewModel.IsManageSpecsVisible, Mode=OneWay}&quot;&gt;
            &lt;StackPanel VerticalAlignment=&quot;Center&quot; HorizontalAlignment=&quot;Center&quot; Spacing=&quot;16&quot;&gt;
                &lt;FontIcon Glyph=&quot;&amp;#xE8FD;&quot; FontSize=&quot;72&quot; Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;/&gt;
                &lt;TextBlock 
                    Text=&quot;Spec Management&quot; 
                    Style=&quot;{StaticResource TitleTextBlockStyle}&quot;
                    HorizontalAlignment=&quot;Center&quot;/&gt;
                &lt;TextBlock 
                    Text=&quot;This view will be implemented in a future phase&quot;
                    Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                    Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;
                    HorizontalAlignment=&quot;Center&quot;/&gt;
                &lt;Button 
                    Content=&quot;Back to Main Menu&quot;
                    Command=&quot;{x:Bind ViewModel.ReturnToMainNavigationCommand}&quot;
                    Style=&quot;{StaticResource AccentButtonStyle}&quot;
                    HorizontalAlignment=&quot;Center&quot;
                    Margin=&quot;0,16,0,0&quot;/&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;

        &lt;!-- Part Management Section --&gt;
        &lt;Grid Visibility=&quot;{x:Bind ViewModel.IsManagePartsVisible, Mode=OneWay}&quot;&gt;
            &lt;local:View_Dunnage_AdminPartsView/&gt;
        &lt;/Grid&gt;

        &lt;!-- Inventoried List Section (placeholder) --&gt;
        &lt;Grid Visibility=&quot;{x:Bind ViewModel.IsInventoriedListVisible, Mode=OneWay}&quot;&gt;
            &lt;StackPanel VerticalAlignment=&quot;Center&quot; HorizontalAlignment=&quot;Center&quot; Spacing=&quot;16&quot;&gt;
                &lt;FontIcon Glyph=&quot;&amp;#xE8EF;&quot; FontSize=&quot;72&quot; Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;/&gt;
                &lt;TextBlock 
                    Text=&quot;Inventoried List&quot; 
                    Style=&quot;{StaticResource TitleTextBlockStyle}&quot;
                    HorizontalAlignment=&quot;Center&quot;/&gt;
                &lt;TextBlock 
                    Text=&quot;This view will be implemented in a future phase&quot;
                    Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                    Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;
                    HorizontalAlignment=&quot;Center&quot;/&gt;
                &lt;Button 
                    Content=&quot;Back to Main Menu&quot;
                    Command=&quot;{x:Bind ViewModel.ReturnToMainNavigationCommand}&quot;
                    Style=&quot;{StaticResource AccentButtonStyle}&quot;
                    HorizontalAlignment=&quot;Center&quot;
                    Margin=&quot;0,16,0,0&quot;/&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_AdminMainView.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.Views;

public sealed partial class View_Dunnage_AdminMainView : Page
{
    public ViewModel_Dunnage_AdminMain ViewModel { get; }
    private readonly IService_Focus _focusService;

    public View_Dunnage_AdminMainView()
    {
        ViewModel = App.GetService&lt;ViewModel_Dunnage_AdminMain&gt;();
        _focusService = App.GetService&lt;IService_Focus&gt;();
        InitializeComponent();

        _focusService.AttachFocusOnVisibility(this);
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_AdminPartsView.xaml">&lt;Page
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_AdminPartsView&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    mc:Ignorable=&quot;d&quot;
    Background=&quot;{ThemeResource ApplicationPageBackgroundThemeBrush}&quot;
    Loaded=&quot;OnPageLoaded&quot;&gt;

    &lt;Grid Padding=&quot;24&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header --&gt;
        &lt;StackPanel Grid.Row=&quot;0&quot; Margin=&quot;0,0,0,16&quot;&gt;
            &lt;TextBlock 
                Text=&quot;Manage Dunnage Parts&quot; 
                Style=&quot;{StaticResource TitleTextBlockStyle}&quot;/&gt;
            &lt;TextBlock 
                Text=&quot;Add, edit, and search dunnage parts with spec values&quot; 
                Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;
                Margin=&quot;0,8,0,0&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Toolbar --&gt;
        &lt;CommandBar Grid.Row=&quot;1&quot; DefaultLabelPosition=&quot;Right&quot; Margin=&quot;0,0,0,16&quot;&gt;
            &lt;AppBarButton 
                Icon=&quot;Add&quot; 
                Label=&quot;Add New Part&quot;
                ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.CreatePart&apos;), Mode=OneWay}&quot;/&gt;
            &lt;AppBarSeparator/&gt;
            &lt;AppBarButton 
                Icon=&quot;Edit&quot; 
                Label=&quot;Edit Part&quot;
                IsEnabled=&quot;{x:Bind ViewModel.CanEdit, Mode=OneWay}&quot;
                ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.EditPart&apos;), Mode=OneWay}&quot;/&gt;
            &lt;AppBarButton 
                Icon=&quot;Delete&quot; 
                Label=&quot;Delete Part&quot;
                Command=&quot;{x:Bind ViewModel.ShowDeleteConfirmationCommand}&quot;
                IsEnabled=&quot;{x:Bind ViewModel.CanDelete, Mode=OneWay}&quot;
                ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.DeletePart&apos;), Mode=OneWay}&quot;/&gt;
            &lt;AppBarSeparator/&gt;
            &lt;AppBarButton 
                Icon=&quot;Back&quot; 
                Label=&quot;Back to Admin Hub&quot;
                Command=&quot;{x:Bind ViewModel.ReturnToAdminHubCommand}&quot;
                ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.ReturnToAdmin&apos;), Mode=OneWay}&quot;/&gt;
        &lt;/CommandBar&gt;

        &lt;!-- Search and Filter Bar --&gt;
        &lt;Grid Grid.Row=&quot;2&quot; Margin=&quot;0,0,0,16&quot;&gt;
            &lt;Grid.ColumnDefinitions&gt;
                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
            &lt;/Grid.ColumnDefinitions&gt;

            &lt;!-- Search Box --&gt;
            &lt;TextBox 
                Grid.Column=&quot;0&quot;
                Text=&quot;{x:Bind ViewModel.SearchText, Mode=TwoWay}&quot;
                PlaceholderText=&quot;Search by Part ID...&quot;
                Margin=&quot;0,0,12,0&quot;&gt;
                &lt;TextBox.KeyboardAccelerators&gt;
                    &lt;KeyboardAccelerator Key=&quot;Enter&quot; Invoked=&quot;OnSearchKeyboardAccelerator&quot;/&gt;
                &lt;/TextBox.KeyboardAccelerators&gt;
            &lt;/TextBox&gt;

            &lt;!-- Type Filter --&gt;
            &lt;ComboBox 
                Grid.Column=&quot;1&quot;
                ItemsSource=&quot;{x:Bind ViewModel.AvailableTypes, Mode=OneWay}&quot;
                SelectedItem=&quot;{x:Bind ViewModel.SelectedFilterType, Mode=TwoWay}&quot;
                PlaceholderText=&quot;Filter by Type&quot;
                DisplayMemberPath=&quot;DunnageType&quot;
                MinWidth=&quot;200&quot;
                Margin=&quot;0,0,12,0&quot;/&gt;

            &lt;!-- Filter Buttons --&gt;
            &lt;StackPanel Grid.Column=&quot;2&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                &lt;Button 
                    Content=&quot;Search&quot;
                    Command=&quot;{x:Bind ViewModel.SearchPartsCommand}&quot;
                    Style=&quot;{StaticResource AccentButtonStyle}&quot;/&gt;
                &lt;Button 
                    Content=&quot;Filter by Type&quot;
                    Command=&quot;{x:Bind ViewModel.FilterByTypeCommand}&quot;/&gt;
                &lt;Button 
                    Content=&quot;Clear&quot;
                    Command=&quot;{x:Bind ViewModel.ClearFiltersCommand}&quot;/&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;

        &lt;!-- DataGrid --&gt;
        &lt;Border 
            Grid.Row=&quot;3&quot; 
            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
            BorderThickness=&quot;1&quot;
            CornerRadius=&quot;8&quot;
            Padding=&quot;1&quot;&gt;
            &lt;Grid&gt;
                &lt;controls:DataGrid
                    ItemsSource=&quot;{x:Bind ViewModel.Parts, Mode=OneWay}&quot;
                    SelectedItem=&quot;{x:Bind ViewModel.SelectedPart, Mode=TwoWay}&quot;
                    AutoGenerateColumns=&quot;False&quot;
                    IsReadOnly=&quot;True&quot;
                    GridLinesVisibility=&quot;Horizontal&quot;
                    HeadersVisibility=&quot;Column&quot;
                    SelectionMode=&quot;Single&quot;
                    CanUserReorderColumns=&quot;False&quot;
                    CanUserSortColumns=&quot;True&quot;
                    VerticalScrollBarVisibility=&quot;Auto&quot;
                    HorizontalScrollBarVisibility=&quot;Auto&quot;
                    AlternatingRowBackground=&quot;{ThemeResource SubtleFillColorSecondaryBrush}&quot;&gt;

                    &lt;controls:DataGrid.Columns&gt;
                        &lt;!-- Part ID Column --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Part ID&quot; 
                            Binding=&quot;{Binding PartId}&quot;
                            Width=&quot;2*&quot;
                            CanUserResize=&quot;True&quot;/&gt;

                        &lt;!-- Type Column --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Type&quot; 
                            Binding=&quot;{Binding DunnageTypeName}&quot;
                            Width=&quot;*&quot;
                            CanUserResize=&quot;True&quot;/&gt;

                        &lt;!-- Spec Values Column (Note: Dynamic spec columns would require code-behind) --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Specifications&quot; 
                            Binding=&quot;{Binding DunnageSpecValuesJson}&quot;
                            Width=&quot;2*&quot;
                            CanUserResize=&quot;True&quot;/&gt;

                        &lt;!-- Date Added Column --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Date Added&quot; 
                            Binding=&quot;{Binding CreatedDate, Converter={StaticResource DateTimeToStringConverter}}&quot;
                            Width=&quot;*&quot;
                            CanUserResize=&quot;True&quot;/&gt;

                        &lt;!-- Added By Column --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Added By&quot; 
                            Binding=&quot;{Binding CreatedBy}&quot;
                            Width=&quot;*&quot;
                            CanUserResize=&quot;True&quot;/&gt;
                    &lt;/controls:DataGrid.Columns&gt;
                &lt;/controls:DataGrid&gt;

                &lt;!-- Empty State --&gt;
                &lt;StackPanel 
                    VerticalAlignment=&quot;Center&quot; 
                    HorizontalAlignment=&quot;Center&quot;
                    Spacing=&quot;16&quot;
                    Visibility=&quot;{x:Bind ViewModel.Parts.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=Inverse}&quot;&gt;
                    &lt;FontIcon 
                        Glyph=&quot;&amp;#xE8F1;&quot; 
                        FontSize=&quot;72&quot;
                        Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;/&gt;
                    &lt;TextBlock 
                        Text=&quot;No parts found&quot; 
                        Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;
                        Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;/&gt;
                    &lt;TextBlock 
                        Text=&quot;Try adjusting your filters or add a new part&quot;
                        Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                        Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/Grid&gt;
        &lt;/Border&gt;

        &lt;!-- Pagination Controls --&gt;
        &lt;Grid Grid.Row=&quot;4&quot; Margin=&quot;0,16,0,0&quot;&gt;
            &lt;Grid.ColumnDefinitions&gt;
                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
            &lt;/Grid.ColumnDefinitions&gt;

            &lt;!-- Record Count --&gt;
            &lt;TextBlock Grid.Column=&quot;0&quot; VerticalAlignment=&quot;Center&quot;&gt;
                &lt;Run Text=&quot;Showing&quot;/&gt;
                &lt;Run Text=&quot;{x:Bind ViewModel.Parts.Count, Mode=OneWay}&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                &lt;Run Text=&quot;of&quot;/&gt;
                &lt;Run Text=&quot;{x:Bind ViewModel.TotalRecords, Mode=OneWay}&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                &lt;Run Text=&quot;parts&quot;/&gt;
            &lt;/TextBlock&gt;

            &lt;!-- Pagination Buttons --&gt;
            &lt;StackPanel Grid.Column=&quot;1&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                &lt;Button 
                    Content=&quot;First&quot;
                    Command=&quot;{x:Bind ViewModel.FirstPageCommand}&quot;
                    IsEnabled=&quot;{x:Bind ViewModel.CanNavigatePrevious, Mode=OneWay}&quot;
                    MinWidth=&quot;80&quot;/&gt;
                &lt;Button 
                    Content=&quot;Previous&quot;
                    Command=&quot;{x:Bind ViewModel.PreviousPageCommand}&quot;
                    IsEnabled=&quot;{x:Bind ViewModel.CanNavigatePrevious, Mode=OneWay}&quot;
                    MinWidth=&quot;80&quot;/&gt;
                &lt;TextBlock 
                    VerticalAlignment=&quot;Center&quot;
                    Margin=&quot;12,0,12,0&quot;&gt;
                    &lt;Run Text=&quot;Page&quot;/&gt;
                    &lt;Run Text=&quot;{x:Bind ViewModel.CurrentPage, Mode=OneWay}&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                    &lt;Run Text=&quot;of&quot;/&gt;
                    &lt;Run Text=&quot;{x:Bind ViewModel.TotalPages, Mode=OneWay}&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                &lt;/TextBlock&gt;
                &lt;Button 
                    Content=&quot;Next&quot;
                    Command=&quot;{x:Bind ViewModel.NextPageCommand}&quot;
                    IsEnabled=&quot;{x:Bind ViewModel.CanNavigateNext, Mode=OneWay}&quot;
                    MinWidth=&quot;80&quot;/&gt;
                &lt;Button 
                    Content=&quot;Last&quot;
                    Command=&quot;{x:Bind ViewModel.LastPageCommand}&quot;
                    IsEnabled=&quot;{x:Bind ViewModel.CanNavigateNext, Mode=OneWay}&quot;
                    MinWidth=&quot;80&quot;/&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;

        &lt;!-- Status Bar --&gt;
        &lt;StackPanel Grid.Row=&quot;5&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot; Margin=&quot;0,16,0,0&quot;&gt;
            &lt;ProgressRing 
                IsActive=&quot;{x:Bind ViewModel.IsBusy, Mode=OneWay}&quot;
                Width=&quot;20&quot; 
                Height=&quot;20&quot;/&gt;
            &lt;TextBlock Text=&quot;{x:Bind ViewModel.StatusMessage, Mode=OneWay}&quot;/&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_AdminPartsView.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using Microsoft.UI.Xaml.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.Views;

public sealed partial class View_Dunnage_AdminPartsView : Page
{
    public ViewModel_Dunnage_AdminParts ViewModel { get; }
    private readonly IService_Focus _focusService;

    public View_Dunnage_AdminPartsView()
    {
        ViewModel = App.GetService&lt;ViewModel_Dunnage_AdminParts&gt;();
        _focusService = App.GetService&lt;IService_Focus&gt;();
        InitializeComponent();

        _focusService.AttachFocusOnVisibility(this);
    }

    private async void OnPageLoaded(object sender, RoutedEventArgs e)
    {
        await ViewModel.LoadPartsCommand.ExecuteAsync(null);
    }

    private async void OnSearchKeyboardAccelerator(KeyboardAccelerator sender, KeyboardAcceleratorInvokedEventArgs args)
    {
        await ViewModel.SearchPartsCommand.ExecuteAsync(null);
        args.Handled = true;
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_AdminTypesView.xaml">&lt;Page
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_AdminTypesView&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    xmlns:materialIcons=&quot;using:Material.Icons.WinUI3&quot;
    mc:Ignorable=&quot;d&quot;
    Background=&quot;{ThemeResource ApplicationPageBackgroundThemeBrush}&quot;
    Loaded=&quot;OnPageLoaded&quot;&gt;

    &lt;Page.Resources&gt;
        &lt;converters:Converter_IconCodeToGlyph x:Key=&quot;IconCodeToGlyphConverter&quot;/&gt;
        &lt;converters:Converter_IntToVisibility x:Key=&quot;IntToVisibilityConverter&quot;/&gt;
        &lt;converters:Converter_StringFormat x:Key=&quot;DateTimeToStringConverter&quot;/&gt;
    &lt;/Page.Resources&gt;

    &lt;Grid Padding=&quot;24&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header --&gt;
        &lt;StackPanel Grid.Row=&quot;0&quot; Margin=&quot;0,0,0,16&quot;&gt;
            &lt;TextBlock 
                Text=&quot;Manage Dunnage Types&quot; 
                Style=&quot;{StaticResource TitleTextBlockStyle}&quot;/&gt;
            &lt;TextBlock 
                Text=&quot;Add, edit, and delete dunnage types with impact analysis&quot; 
                Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;
                Margin=&quot;0,8,0,0&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Toolbar --&gt;
        &lt;CommandBar Grid.Row=&quot;1&quot; DefaultLabelPosition=&quot;Right&quot; Margin=&quot;0,0,0,16&quot;&gt;
            &lt;AppBarButton 
                Icon=&quot;Add&quot; 
                Label=&quot;Add New Type&quot;
                ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.CreateType&apos;), Mode=OneWay}&quot;/&gt;
            &lt;AppBarSeparator/&gt;
            &lt;AppBarButton 
                Icon=&quot;Edit&quot; 
                Label=&quot;Edit Type&quot;
                Command=&quot;{x:Bind ViewModel.ShowEditTypeCommand}&quot;
                IsEnabled=&quot;{x:Bind ViewModel.CanEdit, Mode=OneWay}&quot;
                ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.EditType&apos;), Mode=OneWay}&quot;/&gt;
            &lt;AppBarButton 
                Icon=&quot;Delete&quot; 
                Label=&quot;Delete Type&quot;
                Command=&quot;{x:Bind ViewModel.ShowDeleteConfirmationCommand}&quot;
                IsEnabled=&quot;{x:Bind ViewModel.CanDelete, Mode=OneWay}&quot;
                ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.DeleteType&apos;), Mode=OneWay}&quot;/&gt;
            &lt;AppBarSeparator/&gt;
            &lt;AppBarButton 
                Icon=&quot;Back&quot; 
                Label=&quot;Back to Admin Hub&quot;
                Command=&quot;{x:Bind ViewModel.ReturnToAdminHubCommand}&quot;
                ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.ReturnToAdmin&apos;), Mode=OneWay}&quot;/&gt;
        &lt;/CommandBar&gt;

        &lt;!-- DataGrid --&gt;
        &lt;Border 
            Grid.Row=&quot;2&quot; 
            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
            BorderThickness=&quot;1&quot;
            CornerRadius=&quot;8&quot;
            Padding=&quot;1&quot;&gt;
            &lt;Grid&gt;
                &lt;controls:DataGrid
                    ItemsSource=&quot;{x:Bind ViewModel.Types, Mode=OneWay}&quot;
                    SelectedItem=&quot;{x:Bind ViewModel.SelectedType, Mode=TwoWay}&quot;
                    AutoGenerateColumns=&quot;False&quot;
                    IsReadOnly=&quot;True&quot;
                    GridLinesVisibility=&quot;Horizontal&quot;
                    HeadersVisibility=&quot;Column&quot;
                    SelectionMode=&quot;Single&quot;
                    CanUserReorderColumns=&quot;False&quot;
                    CanUserSortColumns=&quot;True&quot;
                    VerticalScrollBarVisibility=&quot;Auto&quot;
                    HorizontalScrollBarVisibility=&quot;Auto&quot;
                    AlternatingRowBackground=&quot;{ThemeResource SubtleFillColorSecondaryBrush}&quot;&gt;

                    &lt;controls:DataGrid.Columns&gt;
                        &lt;!-- Icon Column --&gt;
                        &lt;controls:DataGridTemplateColumn Header=&quot;Icon&quot; Width=&quot;60&quot;&gt;
                            &lt;controls:DataGridTemplateColumn.CellTemplate&gt;
                                &lt;DataTemplate&gt;
                                    &lt;materialIcons:MaterialIcon 
                                        Kind=&quot;{Binding IconKind}&quot; 
                                        Width=&quot;24&quot; 
                                        Height=&quot;24&quot;
                                        Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;
                                        HorizontalAlignment=&quot;Center&quot;
                                        VerticalAlignment=&quot;Center&quot;/&gt;
                                &lt;/DataTemplate&gt;
                            &lt;/controls:DataGridTemplateColumn.CellTemplate&gt;
                        &lt;/controls:DataGridTemplateColumn&gt;

                        &lt;!-- Type Name Column --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Type Name&quot; 
                            Binding=&quot;{Binding DunnageType}&quot;
                            Width=&quot;2*&quot;
                            CanUserResize=&quot;True&quot;/&gt;

                        &lt;!-- Date Added Column --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Date Added&quot; 
                            Binding=&quot;{Binding DateAdded, Converter={StaticResource DateTimeToStringConverter}}&quot;
                            Width=&quot;*&quot;
                            CanUserResize=&quot;True&quot;/&gt;

                        &lt;!-- Added By Column --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Added By&quot; 
                            Binding=&quot;{Binding AddedBy}&quot;
                            Width=&quot;*&quot;
                            CanUserResize=&quot;True&quot;/&gt;

                        &lt;!-- Last Modified Column --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Last Modified&quot; 
                            Binding=&quot;{Binding LastModified, Converter={StaticResource DateTimeToStringConverter}}&quot;
                            Width=&quot;*&quot;
                            CanUserResize=&quot;True&quot;/&gt;

                        &lt;!-- Modified By Column --&gt;
                        &lt;controls:DataGridTextColumn 
                            Header=&quot;Modified By&quot; 
                            Binding=&quot;{Binding ModifiedBy}&quot;
                            Width=&quot;*&quot;
                            CanUserResize=&quot;True&quot;/&gt;
                    &lt;/controls:DataGrid.Columns&gt;
                &lt;/controls:DataGrid&gt;

                &lt;!-- Empty State --&gt;
                &lt;StackPanel 
                    VerticalAlignment=&quot;Center&quot; 
                    HorizontalAlignment=&quot;Center&quot;
                    Spacing=&quot;16&quot;
                    Visibility=&quot;{x:Bind ViewModel.Types.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=Inverse}&quot;&gt;
                    &lt;FontIcon 
                        Glyph=&quot;&amp;#xE7C3;&quot; 
                        FontSize=&quot;72&quot;
                        Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;/&gt;
                    &lt;TextBlock 
                        Text=&quot;No types found&quot; 
                        Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;
                        Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;/&gt;
                    &lt;TextBlock 
                        Text=&quot;Click &apos;Add New Type&apos; to create your first dunnage type&quot;
                        Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                        Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/Grid&gt;
        &lt;/Border&gt;

        &lt;!-- Status Bar --&gt;
        &lt;StackPanel Grid.Row=&quot;3&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot; Margin=&quot;0,16,0,0&quot;&gt;
            &lt;ProgressRing 
                IsActive=&quot;{x:Bind ViewModel.IsBusy, Mode=OneWay}&quot;
                Width=&quot;20&quot; 
                Height=&quot;20&quot;/&gt;
            &lt;TextBlock Text=&quot;{x:Bind ViewModel.StatusMessage, Mode=OneWay}&quot;/&gt;
            &lt;TextBlock 
                Text=&quot;|&quot;
                Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;
                Margin=&quot;8,0,8,0&quot;/&gt;
            &lt;TextBlock&gt;
                &lt;Run Text=&quot;Total Types:&quot;/&gt;
                &lt;Run Text=&quot;{x:Bind ViewModel.Types.Count, Mode=OneWay}&quot; FontWeight=&quot;SemiBold&quot;/&gt;
            &lt;/TextBlock&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_Control_IconPickerControl.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_Control_IconPickerControl&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:materialIcons=&quot;using:Material.Icons.WinUI3&quot;
    xmlns:icons=&quot;using:Material.Icons&quot;
    xmlns:models=&quot;using:MTM_Receiving_Application.Module_Dunnage.Models&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;&gt;

    &lt;UserControl.Resources&gt;
        &lt;converters:Converter_IntToVisibility x:Key=&quot;IntToVisibilityConverter&quot; /&gt;
        
        &lt;Style x:Key=&quot;IconGridViewItemStyle&quot; TargetType=&quot;GridViewItem&quot;&gt;
            &lt;Setter Property=&quot;HorizontalContentAlignment&quot; Value=&quot;Stretch&quot; /&gt;
            &lt;Setter Property=&quot;VerticalContentAlignment&quot; Value=&quot;Stretch&quot; /&gt;
            &lt;Setter Property=&quot;Margin&quot; Value=&quot;2&quot; /&gt;
            &lt;Setter Property=&quot;Padding&quot; Value=&quot;0&quot; /&gt;
            &lt;Setter Property=&quot;CornerRadius&quot; Value=&quot;4&quot; /&gt;
            &lt;Setter Property=&quot;MinWidth&quot; Value=&quot;40&quot; /&gt;
            &lt;Setter Property=&quot;MinHeight&quot; Value=&quot;40&quot; /&gt;
        &lt;/Style&gt;

        &lt;DataTemplate x:Key=&quot;IconTemplate&quot; x:DataType=&quot;icons:MaterialIconKind&quot;&gt;
            &lt;Border Width=&quot;40&quot; Height=&quot;40&quot; 
                    BorderThickness=&quot;1&quot; 
                    BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot; 
                    Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                    CornerRadius=&quot;4&quot; 
                    Padding=&quot;4&quot; 
                    ToolTipService.ToolTip=&quot;{x:Bind ToString()}&quot;&gt;
                &lt;materialIcons:MaterialIcon Kind=&quot;{x:Bind}&quot; Width=&quot;24&quot; Height=&quot;24&quot; Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot; /&gt;
            &lt;/Border&gt;
        &lt;/DataTemplate&gt;
        
        &lt;DataTemplate x:Key=&quot;RecentIconTemplate&quot; x:DataType=&quot;models:Model_IconDefinition&quot;&gt;
             &lt;Border Width=&quot;40&quot; Height=&quot;40&quot; 
                    BorderThickness=&quot;1&quot; 
                    BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot; 
                    Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                    CornerRadius=&quot;4&quot; 
                    Padding=&quot;4&quot; 
                    ToolTipService.ToolTip=&quot;{x:Bind Name}&quot;&gt;
                &lt;materialIcons:MaterialIcon Kind=&quot;{x:Bind Kind}&quot; Width=&quot;24&quot; Height=&quot;24&quot; Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot; /&gt;
            &lt;/Border&gt;
        &lt;/DataTemplate&gt;
    &lt;/UserControl.Resources&gt;

    &lt;StackPanel Spacing=&quot;12&quot;&gt;

        &lt;!-- Recently Used Section --&gt;
        &lt;StackPanel Spacing=&quot;8&quot; Visibility=&quot;{x:Bind RecentlyUsedIcons.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}}&quot;&gt;
            &lt;TextBlock Text=&quot;Recently Used&quot; FontWeight=&quot;SemiBold&quot; FontSize=&quot;12&quot; /&gt;
            &lt;GridView
                x:Name=&quot;RecentIconsGrid&quot;
                SelectionMode=&quot;Single&quot;
                MaxHeight=&quot;60&quot;
                ItemsSource=&quot;{x:Bind RecentlyUsedIcons, Mode=OneWay}&quot;
                ItemTemplate=&quot;{StaticResource RecentIconTemplate}&quot;
                ItemContainerStyle=&quot;{StaticResource IconGridViewItemStyle}&quot;
                SelectionChanged=&quot;OnRecentIconSelectionChanged&quot;&gt;
                &lt;GridView.ItemsPanel&gt;
                    &lt;ItemsPanelTemplate&gt;
                        &lt;ItemsWrapGrid Orientation=&quot;Horizontal&quot; MaximumRowsOrColumns=&quot;6&quot; /&gt;
                    &lt;/ItemsPanelTemplate&gt;
                &lt;/GridView.ItemsPanel&gt;
            &lt;/GridView&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Search Box --&gt;
        &lt;TextBox
            x:Name=&quot;SearchBox&quot;
            PlaceholderText=&quot;Search icons...&quot;
            TextChanged=&quot;OnSearchTextChanged&quot; /&gt;

        &lt;!-- All Icons Grid --&gt;
        &lt;GridView
            x:Name=&quot;AllIconsGrid&quot;
            SelectionMode=&quot;Single&quot;
            SelectedItem=&quot;{x:Bind SelectedIcon, Mode=TwoWay}&quot;
            ItemTemplate=&quot;{StaticResource IconTemplate}&quot;
            ItemContainerStyle=&quot;{StaticResource IconGridViewItemStyle}&quot;
            MaxHeight=&quot;300&quot;&gt;
            &lt;GridView.ItemsPanel&gt;
                &lt;ItemsPanelTemplate&gt;
                    &lt;ItemsWrapGrid Orientation=&quot;Horizontal&quot; MaximumRowsOrColumns=&quot;6&quot; /&gt;
                &lt;/ItemsPanelTemplate&gt;
            &lt;/GridView.ItemsPanel&gt;
        &lt;/GridView&gt;
    &lt;/StackPanel&gt;
&lt;/UserControl&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_DetailsEntryView.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_DetailsEntryView&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:views=&quot;using:MTM_Receiving_Application.Module_Dunnage.Views&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;
    x:DataType=&quot;views:View_Dunnage_DetailsEntryView&quot;
    Loaded=&quot;OnLoaded&quot;&gt;

    &lt;UserControl.Resources&gt;
        &lt;converters:Converter_IntToVisibility x:Key=&quot;IntToVisibilityConverter&quot;/&gt;
        &lt;converters:Converter_BooleanToVisibility x:Key=&quot;BooleanToVisibilityConverter&quot;/&gt;
    &lt;/UserControl.Resources&gt;

    &lt;Grid Padding=&quot;16&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header --&gt;
        &lt;StackPanel Grid.Row=&quot;0&quot; Spacing=&quot;8&quot; Margin=&quot;0,0,0,16&quot;&gt;
            &lt;TextBlock Text=&quot;Enter Details&quot;
                       Style=&quot;{StaticResource TitleTextBlockStyle}&quot;/&gt;
            &lt;TextBlock Text=&quot;{x:Bind ViewModel.GetTip(&apos;Dunnage.DetailsEntry&apos;), Mode=OneWay}&quot;
                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Inventory Notification --&gt;
        &lt;InfoBar Grid.Row=&quot;1&quot;
                 IsOpen=&quot;{x:Bind ViewModel.IsInventoryNotificationVisible, Mode=OneWay}&quot;
                 Severity=&quot;Informational&quot;
                 Title=&quot;Inventory Action Required&quot;
                 Message=&quot;{x:Bind ViewModel.InventoryNotificationMessage, Mode=OneWay}&quot;
                 IsClosable=&quot;False&quot;
                 Margin=&quot;0,0,0,12&quot;/&gt;

        &lt;!-- Details Form --&gt;
        &lt;ScrollViewer Grid.Row=&quot;2&quot; VerticalScrollBarVisibility=&quot;Auto&quot;&gt;
            &lt;StackPanel Spacing=&quot;12&quot;&gt;
                
                &lt;!-- PO Number and Location Card --&gt;
                &lt;Border Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                        BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                        BorderThickness=&quot;1&quot;
                        CornerRadius=&quot;8&quot;
                        Padding=&quot;16&quot;&gt;
                    &lt;Grid ColumnSpacing=&quot;12&quot;&gt;
                        &lt;Grid.ColumnDefinitions&gt;
                            &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                            &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                        &lt;/Grid.ColumnDefinitions&gt;

                        &lt;!-- PO Number --&gt;
                        &lt;StackPanel Grid.Column=&quot;0&quot; Spacing=&quot;6&quot;&gt;
                            &lt;TextBlock Text=&quot;PO Number&quot;
                                       Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;/&gt;
                            &lt;TextBox x:Name=&quot;PoNumberTextBox&quot;
                                     Text=&quot;{x:Bind ViewModel.PoNumber, Mode=TwoWay}&quot;
                                     PlaceholderText=&quot;{x:Bind ViewModel.GetPlaceholder(&apos;Field.PONumber&apos;), Mode=OneWay}&quot;
                                     HorizontalAlignment=&quot;Stretch&quot;/&gt;
                            &lt;TextBlock Text=&quot;Leave blank for non-PO dunnage&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;/&gt;
                        &lt;/StackPanel&gt;

                        &lt;!-- Location --&gt;
                        &lt;StackPanel Grid.Column=&quot;1&quot; Spacing=&quot;6&quot;&gt;
                            &lt;TextBlock Text=&quot;Location&quot;
                                       Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;/&gt;
                            &lt;TextBox Text=&quot;{x:Bind ViewModel.Location, Mode=TwoWay}&quot;
                                     PlaceholderText=&quot;{x:Bind ViewModel.GetPlaceholder(&apos;Field.Location&apos;), Mode=OneWay}&quot;
                                     HorizontalAlignment=&quot;Stretch&quot;/&gt;
                            &lt;TextBlock Text=&quot;Where this dunnage is located&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Grid&gt;
                &lt;/Border&gt;

                &lt;!-- Specifications Card (Read-Only) --&gt;
                &lt;Border Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                        BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                        BorderThickness=&quot;1&quot;
                        CornerRadius=&quot;8&quot;
                        Padding=&quot;16&quot;&gt;
                    &lt;StackPanel Spacing=&quot;8&quot;&gt;
                        &lt;TextBlock Text=&quot;Specifications (from selected part)&quot;
                                   Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;/&gt;
                        
                        &lt;Grid ColumnSpacing=&quot;12&quot;&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            
                            &lt;!-- Column 1: Text Specs --&gt;
                            &lt;StackPanel Grid.Column=&quot;0&quot; Spacing=&quot;4&quot; 
                                        Visibility=&quot;{x:Bind ViewModel.HasTextSpecs, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;&gt;
                                &lt;ItemsRepeater ItemsSource=&quot;{x:Bind ViewModel.TextSpecs, Mode=OneWay}&quot;&gt;
                                    &lt;ItemsRepeater.ItemTemplate&gt;
                                        &lt;DataTemplate&gt;
                                            &lt;StackPanel Spacing=&quot;2&quot; Margin=&quot;0,0,0,6&quot;&gt;
                                                &lt;TextBlock Text=&quot;{Binding SpecName}&quot; FontWeight=&quot;SemiBold&quot; FontSize=&quot;12&quot;/&gt;
                                                &lt;TextBox Text=&quot;{Binding Value, Mode=OneWay}&quot; 
                                                         IsReadOnly=&quot;True&quot;
                                                         Width=&quot;180&quot;/&gt;
                                            &lt;/StackPanel&gt;
                                        &lt;/DataTemplate&gt;
                                    &lt;/ItemsRepeater.ItemTemplate&gt;
                                &lt;/ItemsRepeater&gt;
                            &lt;/StackPanel&gt;
                            
                            &lt;!-- Column 2: Number Specs --&gt;
                            &lt;StackPanel Grid.Column=&quot;1&quot; Spacing=&quot;4&quot;
                                        Visibility=&quot;{x:Bind ViewModel.HasNumberSpecs, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;&gt;
                                &lt;ItemsRepeater ItemsSource=&quot;{x:Bind ViewModel.NumberSpecs, Mode=OneWay}&quot;&gt;
                                    &lt;ItemsRepeater.ItemTemplate&gt;
                                        &lt;DataTemplate&gt;
                                            &lt;StackPanel Spacing=&quot;2&quot; Margin=&quot;0,0,0,6&quot;&gt;
                                                &lt;TextBlock Text=&quot;{Binding SpecName}&quot; FontWeight=&quot;SemiBold&quot; FontSize=&quot;12&quot;/&gt;
                                                &lt;TextBox Text=&quot;{Binding Value, Mode=OneWay}&quot; 
                                                         IsReadOnly=&quot;True&quot;
                                                         Width=&quot;180&quot;/&gt;
                                            &lt;/StackPanel&gt;
                                        &lt;/DataTemplate&gt;
                                    &lt;/ItemsRepeater.ItemTemplate&gt;
                                &lt;/ItemsRepeater&gt;
                            &lt;/StackPanel&gt;
                            
                            &lt;!-- Column 3: Boolean Specs --&gt;
                            &lt;StackPanel Grid.Column=&quot;2&quot; Spacing=&quot;4&quot;
                                        Visibility=&quot;{x:Bind ViewModel.HasBooleanSpecs, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;&gt;
                                &lt;ItemsRepeater ItemsSource=&quot;{x:Bind ViewModel.BooleanSpecs, Mode=OneWay}&quot;&gt;
                                    &lt;ItemsRepeater.ItemTemplate&gt;
                                        &lt;DataTemplate&gt;
                                            &lt;CheckBox Content=&quot;{Binding SpecName}&quot; 
                                                      IsChecked=&quot;{Binding Value, Mode=OneWay}&quot; 
                                                      IsEnabled=&quot;False&quot;
                                                      Margin=&quot;0,0,0,6&quot;/&gt;
                                        &lt;/DataTemplate&gt;
                                    &lt;/ItemsRepeater.ItemTemplate&gt;
                                &lt;/ItemsRepeater&gt;
                            &lt;/StackPanel&gt;
                        &lt;/Grid&gt;

                        &lt;!-- Placeholder when no specs --&gt;
                        &lt;TextBlock Text=&quot;No specifications configured for this type.&quot;
                                   Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                                   Visibility=&quot;{x:Bind ViewModel.SpecInputs.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=&apos;Inverse&apos;}&quot;
                                   Style=&quot;{StaticResource BodyTextBlockStyle}&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Border&gt;

                &lt;!-- Info Panel Card --&gt;
                &lt;Border Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                        BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                        BorderThickness=&quot;1&quot;
                        CornerRadius=&quot;8&quot;
                        Padding=&quot;16&quot;&gt;
                    &lt;StackPanel Spacing=&quot;6&quot;&gt;
                        &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE946;&quot; FontSize=&quot;16&quot; Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                            &lt;TextBlock Text=&quot;Note&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                        &lt;/StackPanel&gt;
                        &lt;TextBlock TextWrapping=&quot;Wrap&quot; FontSize=&quot;12&quot;
                                   Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;&gt;
                            &lt;Run Text=&quot; PO Number: Use if receiving against a purchase order&quot;/&gt;
                            &lt;LineBreak/&gt;
                            &lt;Run Text=&quot; Location: Physical location of the dunnage&quot;/&gt;
                            &lt;LineBreak/&gt;
                            &lt;Run Text=&quot; Specifications: Pre-filled from the selected part&quot;/&gt;
                        &lt;/TextBlock&gt;
                    &lt;/StackPanel&gt;
                &lt;/Border&gt;
            &lt;/StackPanel&gt;
        &lt;/ScrollViewer&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_DetailsEntryView.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.Views;

public sealed partial class View_Dunnage_DetailsEntryView : UserControl
{
    public ViewModel_Dunnage_DetailsEntry ViewModel { get; }
    private readonly IService_Focus _focusService;

    public View_Dunnage_DetailsEntryView()
    {
        ViewModel = App.GetService&lt;ViewModel_Dunnage_DetailsEntry&gt;();
        _focusService = App.GetService&lt;IService_Focus&gt;();
        InitializeComponent();

        _focusService.AttachFocusOnVisibility(this, PoNumberTextBox);
    }

    private async void OnLoaded(object sender, RoutedEventArgs e)
    {
        await ViewModel.LoadSpecsForSelectedPartAsync();
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_Dialog_AddMultipleRowsDialog.xaml">&lt;ContentDialog
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_Dialog_AddMultipleRowsDialog&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    mc:Ignorable=&quot;d&quot;
    Title=&quot;Add Multiple Rows&quot;
    PrimaryButtonText=&quot;Add&quot;
    CloseButtonText=&quot;Cancel&quot;
    DefaultButton=&quot;Primary&quot;
    PrimaryButtonClick=&quot;ContentDialog_PrimaryButtonClick&quot;&gt;

    &lt;StackPanel Spacing=&quot;16&quot; Padding=&quot;24&quot;&gt;
        &lt;TextBlock 
            Text=&quot;How many rows would you like to add?&quot; 
            Style=&quot;{StaticResource BodyTextBlockStyle}&quot;/&gt;
        
        &lt;NumberBox 
            x:Name=&quot;RowCountNumberBox&quot;
            Header=&quot;Number of Rows&quot;
            Minimum=&quot;1&quot;
            Maximum=&quot;100&quot;
            Value=&quot;10&quot;
            SpinButtonPlacementMode=&quot;Inline&quot;
            ValidationMode=&quot;InvalidInputOverwritten&quot;
            AcceptsExpression=&quot;False&quot;/&gt;
        
        &lt;InfoBar 
            IsOpen=&quot;True&quot;
            Severity=&quot;Informational&quot;
            IsClosable=&quot;False&quot;
            Message=&quot;Maximum 100 rows can be added at once. Each row will be initialized with default values (Quantity = 1).&quot;/&gt;
    &lt;/StackPanel&gt;
&lt;/ContentDialog&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_Dialog_AddMultipleRowsDialog.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;

namespace MTM_Receiving_Application.Module_Dunnage.Views
{
    /// &lt;summary&gt;
    /// Dialog for adding multiple rows at once
    /// &lt;/summary&gt;
    public sealed partial class View_Dunnage_Dialog_AddMultipleRowsDialog : ContentDialog
    {
        public int RowCount { get; private set; }
        private readonly IService_Focus _focusService;

        public View_Dunnage_Dialog_AddMultipleRowsDialog()
        {
            InitializeComponent();
            _focusService = App.GetService&lt;IService_Focus&gt;();
            _focusService.AttachFocusOnVisibility(this, RowCountNumberBox);
        }

        private void ContentDialog_PrimaryButtonClick(ContentDialog sender, ContentDialogButtonClickEventArgs args)
        {
            RowCount = (int)RowCountNumberBox.Value;
        }
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_Dialog_AddToInventoriedListDialog.xaml">&lt;ContentDialog
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_Dialog_AddToInventoriedListDialog&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    mc:Ignorable=&quot;d&quot;
    Title=&quot;Add Part to Inventoried List&quot;
    PrimaryButtonText=&quot;Add to List&quot;
    CloseButtonText=&quot;Cancel&quot;
    DefaultButton=&quot;Primary&quot;
    PrimaryButtonClick=&quot;OnPrimaryButtonClick&quot;&gt;

    &lt;ScrollViewer MaxHeight=&quot;500&quot;&gt;
        &lt;StackPanel Spacing=&quot;12&quot; Padding=&quot;24&quot;&gt;
            
            &lt;!-- Part ID Selection --&gt;
            &lt;TextBlock Text=&quot;Part ID&quot; FontWeight=&quot;SemiBold&quot;/&gt;
            &lt;ComboBox x:Name=&quot;PartIdComboBox&quot;
                      PlaceholderText=&quot;Select a part...&quot;
                      HorizontalAlignment=&quot;Stretch&quot;
                      IsEditable=&quot;True&quot;
                      TextSubmitted=&quot;PartIdComboBox_TextSubmitted&quot;/&gt;
            &lt;TextBlock x:Name=&quot;PartIdError&quot;
                       Text=&quot;Part ID is required&quot;
                       Foreground=&quot;{ThemeResource SystemErrorTextColor}&quot;
                       Visibility=&quot;Collapsed&quot;
                       Margin=&quot;0,-8,0,0&quot;/&gt;

            &lt;!-- Inventory Method --&gt;
            &lt;TextBlock Text=&quot;Inventory Method&quot; FontWeight=&quot;SemiBold&quot; Margin=&quot;0,12,0,0&quot;/&gt;
            &lt;ComboBox x:Name=&quot;InventoryMethodComboBox&quot;
                      HorizontalAlignment=&quot;Stretch&quot;
                      SelectedIndex=&quot;2&quot;&gt;
                &lt;ComboBoxItem Content=&quot;Adjust In&quot;/&gt;
                &lt;ComboBoxItem Content=&quot;Receive In&quot;/&gt;
                &lt;ComboBoxItem Content=&quot;Both&quot;/&gt;
            &lt;/ComboBox&gt;
            &lt;TextBlock Text=&quot;Adjust In: Only triggers during inventory adjustments&quot;
                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                       Foreground=&quot;{ThemeResource SystemControlDisabledBaseMediumLowBrush}&quot;
                       TextWrapping=&quot;Wrap&quot;
                       Margin=&quot;0,-8,0,0&quot;/&gt;
            &lt;TextBlock Text=&quot;Receive In: Only triggers during receiving transactions&quot;
                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                       Foreground=&quot;{ThemeResource SystemControlDisabledBaseMediumLowBrush}&quot;
                       TextWrapping=&quot;Wrap&quot;/&gt;
            &lt;TextBlock Text=&quot;Both: Triggers for both adjust and receive operations&quot;
                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                       Foreground=&quot;{ThemeResource SystemControlDisabledBaseMediumLowBrush}&quot;
                       TextWrapping=&quot;Wrap&quot;/&gt;

            &lt;!-- Notes --&gt;
            &lt;TextBlock Text=&quot;Notes (optional)&quot; FontWeight=&quot;SemiBold&quot; Margin=&quot;0,12,0,0&quot;/&gt;
            &lt;TextBox x:Name=&quot;NotesTextBox&quot;
                     PlaceholderText=&quot;Add any notes or special instructions...&quot;
                     AcceptsReturn=&quot;True&quot;
                     TextWrapping=&quot;Wrap&quot;
                     Height=&quot;80&quot;/&gt;

        &lt;/StackPanel&gt;
    &lt;/ScrollViewer&gt;
&lt;/ContentDialog&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_Dialog_AddToInventoriedListDialog.xaml.cs">using System;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Data;

namespace MTM_Receiving_Application.Module_Dunnage.Views;

public sealed partial class View_Dunnage_Dialog_AddToInventoriedListDialog : ContentDialog
{
    private readonly Dao_DunnagePart _daoPart;
    private readonly Dao_InventoriedDunnage _daoInventory;
    private readonly IService_Focus _focusService;

    public View_Dunnage_Dialog_AddToInventoriedListDialog()
    {
        _daoPart = App.GetService&lt;Dao_DunnagePart&gt;();
        _daoInventory = App.GetService&lt;Dao_InventoriedDunnage&gt;();
        _focusService = App.GetService&lt;IService_Focus&gt;();

        InitializeComponent();
        _focusService.AttachFocusOnVisibility(this);
        _ = LoadPartsAsync();
    }

    private async Task LoadPartsAsync()
    {
        try
        {
            var result = await _daoPart.GetAllAsync();

            if (result.IsSuccess &amp;&amp; result.Data != null)
            {
                PartIdComboBox.ItemsSource = result.Data.ConvertAll(p =&gt; p.PartId);
            }
        }
        catch
        {
            // Silent fail - user can still type part ID
        }
    }

    private void PartIdComboBox_TextSubmitted(ComboBox sender, ComboBoxTextSubmittedEventArgs args)
    {
        // Validate part ID exists when user types and presses enter
        if (!string.IsNullOrWhiteSpace(args.Text))
        {
            PartIdError.Visibility = Visibility.Collapsed;
        }
    }

    private async void OnPrimaryButtonClick(ContentDialog sender, ContentDialogButtonClickEventArgs args)
    {
        // Get deferral to perform async validation
        var deferral = args.GetDeferral();

        try
        {
            // Validate Part ID
            var partId = PartIdComboBox.Text?.Trim();
            if (string.IsNullOrWhiteSpace(partId))
            {
                PartIdError.Visibility = Visibility.Visible;
                args.Cancel = true;
                return;
            }

            // Check if part already in inventoried list
            var checkResult = await _daoInventory.GetByPartAsync(partId);
            if (checkResult.IsSuccess &amp;&amp; checkResult.Data != null)
            {
                // Show error - part already in list
                var errorDialog = new ContentDialog
                {
                    Title = &quot;Part Already in List&quot;,
                    Content = $&quot;Part &apos;{partId}&apos; is already in the inventoried list.&quot;,
                    CloseButtonText = &quot;OK&quot;,
                    XamlRoot = this.XamlRoot
                };
                await errorDialog.ShowAsync();
                args.Cancel = true;
                return;
            }

            // Get selected inventory method
            var methodItem = InventoryMethodComboBox.SelectedItem as ComboBoxItem;
            var inventoryMethod = methodItem?.Content?.ToString() ?? &quot;Both&quot;;

            // Get notes
            var notes = NotesTextBox.Text?.Trim();

            // Insert into database
            var insertResult = await _daoInventory.InsertAsync(
                partId,
                inventoryMethod,
                notes ?? string.Empty,
                Environment.UserName);

            if (!insertResult.IsSuccess)
            {
                // Show error
                var errorDialog = new ContentDialog
                {
                    Title = &quot;Insert Failed&quot;,
                    Content = insertResult.ErrorMessage ?? &quot;Failed to add part to inventoried list&quot;,
                    CloseButtonText = &quot;OK&quot;,
                    XamlRoot = this.XamlRoot
                };
                await errorDialog.ShowAsync();
                args.Cancel = true;
            }
        }
        finally
        {
            deferral.Complete();
        }
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_Dialog_Dunnage_AddTypeDialog.xaml">&lt;ContentDialog
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_Dialog_Dunnage_AddTypeDialog&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:controls=&quot;using:MTM_Receiving_Application.Module_Dunnage.Views.Controls&quot;
    xmlns:models=&quot;using:MTM_Receiving_Application.Module_Dunnage.Models&quot;
    xmlns:viewmodels=&quot;using:MTM_Receiving_Application.Module_Dunnage.ViewModels&quot;
    xmlns:materialIcons=&quot;using:Material.Icons.WinUI3&quot;
    x:Name=&quot;Root&quot;
    Title=&quot;Add New Dunnage Type&quot;
    PrimaryButtonText=&quot;Save Type&quot;
    CloseButtonText=&quot;Cancel&quot;
    DefaultButton=&quot;Primary&quot;
    MaxHeight=&quot;750&quot;
    PrimaryButtonCommand=&quot;{x:Bind ViewModel.SaveTypeCommand}&quot;
    IsPrimaryButtonEnabled=&quot;{x:Bind ViewModel.CanSave, Mode=OneWay}&quot;&gt;

    &lt;ScrollViewer VerticalScrollBarVisibility=&quot;Auto&quot;&gt;
        &lt;StackPanel Spacing=&quot;16&quot; Padding=&quot;24&quot;&gt;

            &lt;!-- Duplicate Warning InfoBar --&gt;
            &lt;InfoBar
                Severity=&quot;Warning&quot;
                IsOpen=&quot;{x:Bind ViewModel.ShowDuplicateWarning, Mode=OneWay}&quot;
                Title=&quot;Duplicate Type Name&quot;
                Message=&quot;A type with this name already exists.&quot;&gt;
                &lt;InfoBar.ActionButton&gt;
                    &lt;HyperlinkButton Content=&quot;View Existing Type&quot; /&gt;
                &lt;/InfoBar.ActionButton&gt;
            &lt;/InfoBar&gt;

            &lt;!-- Field Limit Warning InfoBar --&gt;
            &lt;InfoBar
                Severity=&quot;Informational&quot;
                IsOpen=&quot;{x:Bind ViewModel.ShowFieldLimitWarning, Mode=OneWay}&quot;
                Title=&quot;Many Custom Fields&quot;
                Message=&quot;You have added 10+ custom fields. Consider grouping similar fields for better usability.&quot; /&gt;

            &lt;!-- Basic Information Section --&gt;
            &lt;StackPanel Spacing=&quot;12&quot;&gt;
                &lt;TextBlock Text=&quot;Basic Information&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; /&gt;

                &lt;!-- Type Name --&gt;
                &lt;TextBox
                    Header=&quot;Type Name&quot;
                    PlaceholderText=&quot;Enter dunnage type name (e.g., Pallet - 48x40)&quot;
                    Text=&quot;{x:Bind ViewModel.TypeName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}&quot;
                    BorderBrush=&quot;{x:Bind ViewModel.TypeNameError, Mode=OneWay, Converter={StaticResource ErrorToBrushConverter}}&quot;
                    MaxLength=&quot;100&quot; /&gt;

                &lt;TextBlock
                    Text=&quot;{x:Bind ViewModel.TypeNameError, Mode=OneWay}&quot;
                    Foreground=&quot;Red&quot;
                    Visibility=&quot;{x:Bind ViewModel.TypeNameError, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}&quot;
                    Margin=&quot;0,-8,0,0&quot; /&gt;

                &lt;!-- Icon Picker Button --&gt;
                &lt;TextBlock Text=&quot;Icon&quot; Margin=&quot;0,8,0,0&quot; FontWeight=&quot;SemiBold&quot; /&gt;
                &lt;Button x:Name=&quot;SelectIconButton&quot;
                        Click=&quot;OnSelectIconClick&quot;
                        HorizontalAlignment=&quot;Stretch&quot;
                        Padding=&quot;16,12&quot;
                        ToolTipService.ToolTip=&quot;Click to browse and select an icon from the icon library&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot;&gt;
                        &lt;materialIcons:MaterialIcon 
                            Kind=&quot;{x:Bind ViewModel.SelectedIcon, Mode=OneWay}&quot; 
                            Width=&quot;32&quot; 
                            Height=&quot;32&quot;
                            Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                        &lt;StackPanel VerticalAlignment=&quot;Center&quot;&gt;
                            &lt;TextBlock Text=&quot;Click to select icon&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                            &lt;TextBlock 
                                Text=&quot;{x:Bind ViewModel.SelectedIcon, Mode=OneWay}&quot;
                                FontSize=&quot;12&quot;
                                Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
            &lt;/StackPanel&gt;

            &lt;!-- Custom Specifications Section --&gt;
            &lt;StackPanel Spacing=&quot;12&quot; Margin=&quot;0,16,0,0&quot;&gt;
                &lt;TextBlock Text=&quot;Custom Specifications&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; /&gt;

                &lt;!-- Add New Field Form --&gt;
                &lt;Border
                    BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                    BorderThickness=&quot;1&quot;
                    CornerRadius=&quot;8&quot;
                    Padding=&quot;16&quot;
                    Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;&gt;
                    &lt;StackPanel Spacing=&quot;12&quot;&gt;
                        &lt;TextBlock Text=&quot;Add Custom Field&quot; FontWeight=&quot;SemiBold&quot; /&gt;

                        &lt;TextBox
                            Header=&quot;Field Name&quot;
                            PlaceholderText=&quot;Enter field name (e.g., Width, Material)&quot;
                            Text=&quot;{x:Bind ViewModel.FieldName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}&quot;
                            BorderBrush=&quot;{x:Bind ViewModel.FieldNameError, Mode=OneWay, Converter={StaticResource ErrorToBrushConverter}}&quot;
                            MaxLength=&quot;100&quot; /&gt;

                        &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot; Margin=&quot;0,-8,0,0&quot;&gt;
                            &lt;TextBlock
                                Text=&quot;{x:Bind ViewModel.FieldNameError, Mode=OneWay}&quot;
                                Foreground=&quot;Red&quot;
                                Visibility=&quot;{x:Bind ViewModel.FieldNameError, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}&quot; /&gt;
                            &lt;TextBlock
                                Text=&quot;{x:Bind ViewModel.FieldCharacterCount, Mode=OneWay}&quot;
                                Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                                HorizontalAlignment=&quot;Right&quot; /&gt;
                            &lt;TextBlock Text=&quot;/100 characters&quot; Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                        &lt;/StackPanel&gt;

                        &lt;ComboBox
                            Header=&quot;Field Type&quot;
                            SelectedItem=&quot;{x:Bind ViewModel.FieldType, Mode=TwoWay}&quot;
                            HorizontalAlignment=&quot;Stretch&quot;&gt;
                            &lt;x:String&gt;Text&lt;/x:String&gt;
                            &lt;x:String&gt;Number&lt;/x:String&gt;
                            &lt;x:String&gt;Dropdown&lt;/x:String&gt;
                            &lt;x:String&gt;Yes/No&lt;/x:String&gt;
                        &lt;/ComboBox&gt;

                        &lt;CheckBox
                            Content=&quot;Required field&quot;
                            IsChecked=&quot;{x:Bind ViewModel.IsFieldRequired, Mode=TwoWay}&quot; /&gt;

                        &lt;Button
                            Content=&quot;{x:Bind ViewModel.EditingField, Mode=OneWay, Converter={StaticResource EditingFieldToTextConverter}}&quot;
                            Command=&quot;{x:Bind ViewModel.AddFieldCommand}&quot;
                            IsEnabled=&quot;{x:Bind ViewModel.CanAddField, Mode=OneWay}&quot;
                            Style=&quot;{StaticResource AccentButtonStyle}&quot;
                            HorizontalAlignment=&quot;Right&quot; /&gt;
                    &lt;/StackPanel&gt;
                &lt;/Border&gt;

                &lt;!-- Field Preview List --&gt;
                &lt;TextBlock
                    Text=&quot;Custom Fields Preview&quot;
                    FontWeight=&quot;SemiBold&quot;
                    Visibility=&quot;{x:Bind ViewModel.CustomFields.Count, Mode=OneWay, Converter={StaticResource CountToVisibilityConverter}}&quot;
                    Margin=&quot;0,8,0,0&quot; /&gt;

                &lt;ItemsRepeater
                    ItemsSource=&quot;{x:Bind ViewModel.CustomFields, Mode=OneWay}&quot;&gt;
                    &lt;ItemsRepeater.ItemTemplate&gt;
                        &lt;DataTemplate x:DataType=&quot;models:Model_CustomFieldDefinition&quot;&gt;
                            &lt;Border
                                BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                                BorderThickness=&quot;1&quot;
                                CornerRadius=&quot;8&quot;
                                Padding=&quot;12&quot;
                                Margin=&quot;0,4&quot;
                                Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;&gt;
                                &lt;Grid ColumnSpacing=&quot;8&quot;&gt;
                                    &lt;Grid.ColumnDefinitions&gt;
                                        &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                                        &lt;ColumnDefinition Width=&quot;*&quot; /&gt;
                                        &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                                    &lt;/Grid.ColumnDefinitions&gt;

                                    &lt;!-- Drag Handle --&gt;
                                    &lt;FontIcon Grid.Column=&quot;0&quot; Glyph=&quot;&amp;#xE76F;&quot; FontSize=&quot;16&quot; VerticalAlignment=&quot;Center&quot; /&gt;

                                    &lt;!-- Field Info --&gt;
                                    &lt;StackPanel Grid.Column=&quot;1&quot; Spacing=&quot;4&quot;&gt;
                                        &lt;TextBlock Text=&quot;{x:Bind FieldName}&quot; FontWeight=&quot;SemiBold&quot; /&gt;
                                        &lt;TextBlock
                                            Text=&quot;{x:Bind GetSummary()}&quot;
                                            Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                                            FontSize=&quot;12&quot; /&gt;
                                    &lt;/StackPanel&gt;

                                    &lt;!-- Edit/Delete Buttons --&gt;
                                    &lt;StackPanel Grid.Column=&quot;2&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;4&quot;&gt;
                                        &lt;Button
                                            Content=&quot;Edit&quot;
                                            Command=&quot;{Binding EditFieldCommand}&quot;
                                            CommandParameter=&quot;{x:Bind}&quot;
                                            Style=&quot;{StaticResource TextBlockButtonStyle}&quot; /&gt;
                                        &lt;Button
                                            Content=&quot;Delete&quot;
                                            Command=&quot;{Binding DeleteFieldCommand}&quot;
                                            CommandParameter=&quot;{x:Bind}&quot;
                                            Style=&quot;{StaticResource TextBlockButtonStyle}&quot;
                                            Foreground=&quot;Red&quot; /&gt;
                                    &lt;/StackPanel&gt;
                                &lt;/Grid&gt;
                            &lt;/Border&gt;
                        &lt;/DataTemplate&gt;
                    &lt;/ItemsRepeater.ItemTemplate&gt;
                &lt;/ItemsRepeater&gt;

                &lt;TextBlock
                    Text=&quot;No custom fields added yet. Click &apos;Add Field&apos; to create one.&quot;
                    Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                    Visibility=&quot;{x:Bind ViewModel.CustomFields.Count, Mode=OneWay, Converter={StaticResource InverseCountToVisibilityConverter}}&quot;
                    HorizontalAlignment=&quot;Center&quot;
                    Margin=&quot;0,16&quot; /&gt;
            &lt;/StackPanel&gt;

        &lt;/StackPanel&gt;
    &lt;/ScrollViewer&gt;
&lt;/ContentDialog&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_Dialog_Dunnage_AddTypeDialog.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.ViewModels;
using MTM_Receiving_Application.Module_Shared.Views;

namespace MTM_Receiving_Application.Module_Dunnage.Views;

public sealed partial class View_Dunnage_Dialog_Dunnage_AddTypeDialog : ContentDialog
{
    public ViewModel_Dunnage_AddTypeDialog ViewModel { get; }
    private readonly IService_Focus _focusService;

    public View_Dunnage_Dialog_Dunnage_AddTypeDialog()
    {
        ViewModel = App.GetService&lt;ViewModel_Dunnage_AddTypeDialog&gt;();
        _focusService = App.GetService&lt;IService_Focus&gt;();
        DataContext = ViewModel;
        InitializeComponent();

        _focusService.AttachFocusOnVisibility(this);
    }

    private async void OnSelectIconClick(object sender, RoutedEventArgs e)
    {
        var iconSelector = new View_Shared_IconSelectorWindow();

        // Set initial selection to current icon
        iconSelector.SetInitialSelection(ViewModel.SelectedIcon);

        iconSelector.Activate();

        // Wait for the window to close and get the result
        var selectedIcon = await iconSelector.WaitForSelectionAsync();

        if (selectedIcon.HasValue)
        {
            ViewModel.SelectedIcon = selectedIcon.Value;
        }
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_EditModeView.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_EditModeView&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    xmlns:viewmodels=&quot;using:MTM_Receiving_Application.Module_Dunnage.ViewModels&quot;
    xmlns:enums=&quot;using:MTM_Receiving_Application.Module_Core.Models.Enums&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;
    x:Name=&quot;Root&quot;&gt;

    &lt;UserControl.Resources&gt;
        &lt;converters:Converter_DecimalToString x:Key=&quot;DecimalToStringConverter&quot;/&gt;
    &lt;/UserControl.Resources&gt;

    &lt;Grid&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Toolbar - T154: 3 data source buttons --&gt;
        &lt;Grid Grid.Row=&quot;0&quot; Margin=&quot;0,0,0,12&quot;&gt;
            &lt;!-- Main Toolbar Area --&gt;
            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot; VerticalAlignment=&quot;Center&quot;&gt;
                &lt;!-- Load Data Section - T154 --&gt;
                &lt;TextBlock Text=&quot;Load Data From:&quot; VerticalAlignment=&quot;Center&quot; FontWeight=&quot;SemiBold&quot; Margin=&quot;0,0,4,0&quot;/&gt;
                
                &lt;Button Command=&quot;{x:Bind ViewModel.LoadFromCurrentMemoryCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.LoadSessionMemory&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE81D;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Current Memory&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;

                &lt;Button Command=&quot;{x:Bind ViewModel.LoadFromCurrentLabelsCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.LoadRecentCSV&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE8E5;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Current Labels&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
                
                &lt;Button Command=&quot;{x:Bind ViewModel.LoadFromHistoryCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.LoadHistoricalData&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE74C;&quot;/&gt;
                        &lt;TextBlock Text=&quot;History&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;

                &lt;!-- Separator --&gt;
                &lt;Rectangle Width=&quot;1&quot; Height=&quot;24&quot; Fill=&quot;{ThemeResource SystemControlForegroundBaseLowBrush}&quot; Margin=&quot;8,0&quot;/&gt;

                &lt;!-- Edit Actions Section --&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.SelectAllCommand}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE8B3;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Select All&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.RemoveSelectedRowsCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.RemoveSelectedRows&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE74D;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Remove Selected&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;

        &lt;!-- Date Filter Toolbar - T164: Dynamic button text --&gt;
        &lt;Grid Grid.Row=&quot;1&quot; Margin=&quot;0,0,0,12&quot;&gt;
            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot; VerticalAlignment=&quot;Center&quot;&gt;
                &lt;TextBlock Text=&quot;Filter Date:&quot; VerticalAlignment=&quot;Center&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                
                &lt;CalendarDatePicker Date=&quot;{x:Bind ViewModel.FromDate, Mode=TwoWay}&quot; 
                                   PlaceholderText=&quot;{x:Bind ViewModel.GetPlaceholder(&apos;Field.StartDate&apos;), Mode=OneWay}&quot;
                                   Width=&quot;140&quot;/&gt;
                &lt;TextBlock Text=&quot;to&quot; VerticalAlignment=&quot;Center&quot;/&gt;
                &lt;CalendarDatePicker Date=&quot;{x:Bind ViewModel.ToDate, Mode=TwoWay}&quot; 
                                   PlaceholderText=&quot;{x:Bind ViewModel.GetPlaceholder(&apos;Field.EndDate&apos;), Mode=OneWay}&quot;
                                   Width=&quot;140&quot;/&gt;
                
                &lt;Rectangle Width=&quot;1&quot; Height=&quot;24&quot; Fill=&quot;{ThemeResource SystemControlForegroundBaseLowBrush}&quot; Margin=&quot;8,0&quot;/&gt;
                
                &lt;!-- T158, T159, T160, T161, T162, T163, T164: Date filter buttons with dynamic text --&gt;
                &lt;Button Content=&quot;{x:Bind ViewModel.LastWeekButtonText, Mode=OneTime}&quot; 
                        Command=&quot;{x:Bind ViewModel.SetFilterLastWeekCommand}&quot;
                        ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.FilterLastWeek&apos;), Mode=OneWay}&quot;/&gt;
                &lt;Button Content=&quot;{x:Bind ViewModel.TodayButtonText, Mode=OneTime}&quot; 
                        Command=&quot;{x:Bind ViewModel.SetFilterTodayCommand}&quot;
                        ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.FilterToday&apos;), Mode=OneWay}&quot;/&gt;
                &lt;Button Content=&quot;{x:Bind ViewModel.ThisWeekButtonText, Mode=OneTime}&quot; 
                        Command=&quot;{x:Bind ViewModel.SetFilterThisWeekCommand}&quot;
                        ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.FilterThisWeek&apos;), Mode=OneWay}&quot;/&gt;
                &lt;Button Content=&quot;{x:Bind ViewModel.ThisMonthButtonText, Mode=OneTime}&quot; 
                        Command=&quot;{x:Bind ViewModel.SetFilterThisMonthCommand}&quot;
                        ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.FilterThisMonth&apos;), Mode=OneWay}&quot;/&gt;
                &lt;Button Content=&quot;{x:Bind ViewModel.ThisQuarterButtonText, Mode=OneTime}&quot; 
                        Command=&quot;{x:Bind ViewModel.SetFilterThisQuarterCommand}&quot;
                        ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.FilterThisQuarter&apos;), Mode=OneWay}&quot;/&gt;
                &lt;Button Content=&quot;Show All&quot; 
                        Command=&quot;{x:Bind ViewModel.SetFilterShowAllCommand}&quot;
                        ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.FilterShowAll&apos;), Mode=OneWay}&quot;/&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;

        &lt;!-- Data Grid --&gt;
        &lt;controls:DataGrid Grid.Row=&quot;2&quot;
                          x:Name=&quot;EditModeDataGrid&quot;
                          ItemsSource=&quot;{x:Bind ViewModel.FilteredLoads, Mode=OneWay}&quot;
                          AutoGenerateColumns=&quot;False&quot;
                          IsReadOnly=&quot;False&quot;
                          CanUserSortColumns=&quot;True&quot;
                          GridLinesVisibility=&quot;All&quot;
                          HeadersVisibility=&quot;Column&quot;
                          SelectionMode=&quot;Single&quot;
                          KeyDown=&quot;EditModeDataGrid_KeyDown&quot;
                          CurrentCellChanged=&quot;EditModeDataGrid_CurrentCellChanged&quot;
                          Tapped=&quot;EditModeDataGrid_Tapped&quot;&gt;
            &lt;controls:DataGrid.Columns&gt;
                &lt;controls:DataGridTemplateColumn Header=&quot;&quot; Width=&quot;50&quot; CanUserResize=&quot;False&quot;&gt;
                    &lt;controls:DataGridTemplateColumn.CellTemplate&gt;
                        &lt;DataTemplate&gt;
                            &lt;CheckBox IsChecked=&quot;{Binding IsSelected, Mode=TwoWay}&quot; 
                                      HorizontalAlignment=&quot;Center&quot; 
                                      VerticalAlignment=&quot;Center&quot;
                                      MinWidth=&quot;0&quot;
                                      Margin=&quot;0&quot;/&gt;
                        &lt;/DataTemplate&gt;
                    &lt;/controls:DataGridTemplateColumn.CellTemplate&gt;
                &lt;/controls:DataGridTemplateColumn&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Load #&quot; Binding=&quot;{Binding LoadNumber}&quot; IsReadOnly=&quot;True&quot; Width=&quot;Auto&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Type&quot; Binding=&quot;{Binding TypeName}&quot; Width=&quot;*&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Part ID&quot; Binding=&quot;{Binding PartId}&quot; Width=&quot;*&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Quantity&quot; Binding=&quot;{Binding Quantity}&quot; Width=&quot;Auto&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;PO Number&quot; Binding=&quot;{Binding PoNumber}&quot; Width=&quot;Auto&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Location&quot; Binding=&quot;{Binding Location}&quot; Width=&quot;Auto&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Created Date&quot; Binding=&quot;{Binding CreatedDate}&quot; IsReadOnly=&quot;True&quot; Width=&quot;Auto&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Created By&quot; Binding=&quot;{Binding CreatedBy}&quot; IsReadOnly=&quot;True&quot; Width=&quot;Auto&quot;/&gt;
            &lt;/controls:DataGrid.Columns&gt;
        &lt;/controls:DataGrid&gt;

        &lt;!-- Footer: Pagination and Save --&gt;
        &lt;Grid Grid.Row=&quot;3&quot; Margin=&quot;0,12,0,0&quot;&gt;
            &lt;Grid.ColumnDefinitions&gt;
                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
            &lt;/Grid.ColumnDefinitions&gt;

            &lt;!-- Pagination Controls --&gt;
            &lt;StackPanel Grid.Column=&quot;0&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot; VerticalAlignment=&quot;Center&quot;&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.FirstPageCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.FirstPage&apos;), Mode=OneWay}&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE892;&quot;/&gt;
                &lt;/Button&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.PreviousPageCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.PreviousPage&apos;), Mode=OneWay}&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE76B;&quot;/&gt;
                &lt;/Button&gt;
                
                &lt;Rectangle Width=&quot;1&quot; Height=&quot;24&quot; Fill=&quot;{ThemeResource SystemControlForegroundBaseLowBrush}&quot; Margin=&quot;8,0&quot;/&gt;
                
                &lt;TextBlock Text=&quot;Page&quot; VerticalAlignment=&quot;Center&quot;/&gt;
                &lt;TextBlock Text=&quot;{x:Bind ViewModel.CurrentPage, Mode=OneWay}&quot; VerticalAlignment=&quot;Center&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                &lt;TextBlock Text=&quot;of&quot; VerticalAlignment=&quot;Center&quot;/&gt;
                &lt;TextBlock Text=&quot;{x:Bind ViewModel.TotalPages, Mode=OneWay}&quot; VerticalAlignment=&quot;Center&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                
                &lt;Rectangle Width=&quot;1&quot; Height=&quot;24&quot; Fill=&quot;{ThemeResource SystemControlForegroundBaseLowBrush}&quot; Margin=&quot;8,0&quot;/&gt;
                
                &lt;Button Command=&quot;{x:Bind ViewModel.NextPageCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.NextPage&apos;), Mode=OneWay}&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE76C;&quot;/&gt;
                &lt;/Button&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.LastPageCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.LastPage&apos;), Mode=OneWay}&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE893;&quot;/&gt;
                &lt;/Button&gt;
            &lt;/StackPanel&gt;

            &lt;!-- Save Button --&gt;
            &lt;StackPanel Grid.Column=&quot;1&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot;&gt;
                &lt;Button Content=&quot;Save Changes&quot; Command=&quot;{x:Bind ViewModel.SaveAllCommand}&quot; Style=&quot;{StaticResource AccentButtonStyle}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.SaveChanges&apos;), Mode=OneWay}&quot;/&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_EditModeView.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Dunnage.ViewModels;
using Microsoft.UI.Xaml.Input;
using Microsoft.UI.Input;
using Windows.System;
using Windows.UI.Core;
using CommunityToolkit.WinUI.UI.Controls;
using System.Linq;
using System.Collections;
using System;
using System.Diagnostics;
using MTM_Receiving_Application.Module_Dunnage.Models;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Contracts.Services;

namespace MTM_Receiving_Application.Module_Dunnage.Views
{
    public sealed partial class View_Dunnage_EditModeView : UserControl
    {
        public ViewModel_Dunnage_EditMode ViewModel { get; }
        private readonly IService_Focus _focusService;

        public View_Dunnage_EditModeView()
        {
            ViewModel = App.GetService&lt;ViewModel_Dunnage_EditMode&gt;();
            _focusService = App.GetService&lt;IService_Focus&gt;();
            this.DataContext = ViewModel;
            this.InitializeComponent();

            _focusService.AttachFocusOnVisibility(this);
        }

        private void EditModeDataGrid_CurrentCellChanged(object? sender, EventArgs e)
        {
            var grid = sender as DataGrid;
            // Wait for the move to complete then activate edit mode
            grid?.DispatcherQueue.TryEnqueue(() =&gt;
            {
                if (grid.CurrentColumn?.IsReadOnly == false)
                {
                    Debug.WriteLine($&quot;[Dunnage_EditModeView] CurrentCellChanged: BeginEdit for Row={grid.SelectedIndex}, Col={grid.CurrentColumn.Header}&quot;);
                    grid.BeginEdit();
                }
            });
        }

        private void EditModeDataGrid_KeyDown(object sender, KeyRoutedEventArgs e)
        {
            if (sender is not DataGrid grid)
            {
                return;
            }

            var shiftState = InputKeyboardSource.GetKeyStateForCurrentThread(VirtualKey.Shift);
            bool isShiftDown = (shiftState &amp; CoreVirtualKeyStates.Down) == CoreVirtualKeyStates.Down;

            Debug.WriteLine($&quot;[Dunnage_EditModeView] KeyDown: Key={e.Key}, Shift={isShiftDown}, OriginalSource={e.OriginalSource}, CurrentColumn={grid.CurrentColumn?.Header}&quot;);
        }

        private void EditModeDataGrid_Tapped(object sender, TappedRoutedEventArgs e)
        {
            if (sender is not DataGrid grid)
            {
                return;
            }

            Debug.WriteLine($&quot;[Dunnage_EditModeView] Tapped: OriginalSource={e.OriginalSource}&quot;);

            // Handle empty grid or header clicks
            if (grid.ItemsSource is IList items &amp;&amp; items.Count == 0)
            {
                Debug.WriteLine(&quot;[Dunnage_EditModeView] Tapped: Grid empty&quot;);
                return;
            }
            else if (grid.SelectedItem == null)
            {
                Debug.WriteLine(&quot;[Dunnage_EditModeView] Tapped: SelectedItem is null (Header or empty space). Selecting first editable cell.&quot;);
                // Header clicked or empty space
                if (grid.ItemsSource is IList list &amp;&amp; list.Count &gt; 0)
                {
                    grid.SelectedIndex = 0;
                    SelectFirstEditableCell(grid);
                }
            }
            else
            {
                // Cell clicked - CurrentCellChanged handles the edit mode if cell changes.
                // But if we tap the SAME cell, CurrentCellChanged might not fire.
                // So we ensure edit mode here too.
                Debug.WriteLine(&quot;[Dunnage_EditModeView] Tapped: Cell clicked. Enqueuing BeginEdit.&quot;);
                grid.DispatcherQueue.TryEnqueue(() =&gt;
                {
                    if (grid.CurrentColumn?.IsReadOnly == false)
                    {
                        Debug.WriteLine($&quot;[Dunnage_EditModeView] Tapped: BeginEdit for Row={grid.SelectedIndex}, Col={grid.CurrentColumn.Header}&quot;);
                        grid.BeginEdit();
                    }
                });
            }
        }

        private void SelectFirstEditableCell(DataGrid grid)
        {
            Debug.WriteLine(&quot;[Dunnage_EditModeView] SelectFirstEditableCell: Starting&quot;);
            if (grid.ItemsSource is IList items &amp;&amp; items.Count &gt; 0)
            {
                // Find first non-readonly column
                var firstEditable = grid.Columns.OrderBy(c =&gt; c.DisplayIndex).FirstOrDefault(c =&gt; !c.IsReadOnly);
                if (firstEditable != null)
                {
                    Debug.WriteLine($&quot;[Dunnage_EditModeView] SelectFirstEditableCell: Found editable column {firstEditable.Header}. Setting CurrentColumn and calling BeginEdit.&quot;);
                    grid.CurrentColumn = firstEditable;
                    grid.Focus(Microsoft.UI.Xaml.FocusState.Programmatic);
                    grid.BeginEdit();
                    Debug.WriteLine($&quot;[Dunnage_EditModeView] SelectFirstEditableCell: BeginEdit called for column {firstEditable.Header}&quot;);
                }
                else
                {
                    Debug.WriteLine(&quot;[Dunnage_EditModeView] SelectFirstEditableCell: No editable column found.&quot;);
                }
            }
            else
            {
                var itemCount = (grid.ItemsSource as IList)?.Count ?? 0;
                Debug.WriteLine($&quot;[Dunnage_EditModeView] SelectFirstEditableCell: Grid has no items (Count={itemCount})&quot;);
            }
        }
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_ManualEntryView.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_ManualEntryView&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    xmlns:viewmodels=&quot;using:MTM_Receiving_Application.Module_Dunnage.ViewModels&quot;
    xmlns:enums=&quot;using:MTM_Receiving_Application.Module_Core.Models.Enums&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;
    x:Name=&quot;Root&quot;&gt;

    &lt;UserControl.Resources&gt;
        &lt;converters:Converter_DecimalToString x:Key=&quot;DecimalToStringConverter&quot;/&gt;
        &lt;converters:Converter_LoadNumberToOneBased x:Key=&quot;LoadNumberConverter&quot;/&gt;
    &lt;/UserControl.Resources&gt;

    &lt;Grid&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Toolbar --&gt;
        &lt;Grid Grid.Row=&quot;0&quot; Margin=&quot;0,0,0,12&quot;&gt;
            &lt;ScrollViewer HorizontalScrollBarVisibility=&quot;Auto&quot; VerticalScrollBarVisibility=&quot;Disabled&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot; Padding=&quot;0,0,12,0&quot;&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.AddRowCommand}&quot; Style=&quot;{StaticResource AccentButtonStyle}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.AddRow&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE710;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Add Row&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.AddMultipleRowsCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.AddMultipleRows&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE710;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Add Multiple&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.RemoveRowCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.RemoveRow&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE74D;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Remove Row&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
                
                &lt;Rectangle Width=&quot;1&quot; Height=&quot;24&quot; Fill=&quot;{ThemeResource SystemControlForegroundBaseLowBrush}&quot; Margin=&quot;8,0&quot;/&gt;
                
                &lt;Button Command=&quot;{x:Bind ViewModel.AutoFillCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.AutoFill&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE74E;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Auto-Fill&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.FillBlankSpacesCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.FillBlanks&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE8B7;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Fill Blank Spaces&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.SortForPrintingCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.SortForPrinting&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE8CB;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Sort&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
                
                &lt;Rectangle Width=&quot;1&quot; Height=&quot;24&quot; Fill=&quot;{ThemeResource SystemControlForegroundBaseLowBrush}&quot; Margin=&quot;8,0&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/ScrollViewer&gt;
        &lt;/Grid&gt;

        &lt;!-- Data Grid --&gt;
        &lt;controls:DataGrid Grid.Row=&quot;1&quot;
                          x:Name=&quot;ManualEntryDataGrid&quot;
                          ItemsSource=&quot;{x:Bind ViewModel.Loads, Mode=OneWay}&quot;
                          SelectedItem=&quot;{x:Bind ViewModel.SelectedLoad, Mode=TwoWay}&quot;
                          AutoGenerateColumns=&quot;False&quot;
                          IsReadOnly=&quot;False&quot;
                          CanUserSortColumns=&quot;True&quot;
                          GridLinesVisibility=&quot;All&quot;
                          HeadersVisibility=&quot;Column&quot;
                          SelectionMode=&quot;Single&quot;
                          KeyDown=&quot;ManualEntryDataGrid_KeyDown&quot;
                          CurrentCellChanged=&quot;ManualEntryDataGrid_CurrentCellChanged&quot;
                          Tapped=&quot;ManualEntryDataGrid_Tapped&quot;&gt;
            &lt;controls:DataGrid.Columns&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Load #&quot; 
                                           Binding=&quot;{Binding LoadNumber, Converter={StaticResource LoadNumberConverter}}&quot; 
                                           IsReadOnly=&quot;True&quot; 
                                           Width=&quot;Auto&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Type&quot; 
                                           Binding=&quot;{Binding TypeName}&quot; 
                                           Width=&quot;*&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Part ID&quot; 
                                           Binding=&quot;{Binding PartId}&quot; 
                                           Width=&quot;*&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Quantity&quot; 
                                           Binding=&quot;{Binding Quantity}&quot; 
                                           Width=&quot;Auto&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;PO Number&quot; 
                                           Binding=&quot;{Binding PoNumber}&quot; 
                                           Width=&quot;Auto&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Location&quot; 
                                           Binding=&quot;{Binding Location}&quot; 
                                           Width=&quot;Auto&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Home Location&quot; 
                                           Binding=&quot;{Binding HomeLocation}&quot; 
                                           Width=&quot;Auto&quot;/&gt;
            &lt;/controls:DataGrid.Columns&gt;
        &lt;/controls:DataGrid&gt;

        &lt;!-- Navigation --&gt;
        &lt;StackPanel Grid.Row=&quot;2&quot; Orientation=&quot;Horizontal&quot; HorizontalAlignment=&quot;Right&quot; Margin=&quot;0,12,0,0&quot; Spacing=&quot;12&quot;&gt;
            &lt;Button Content=&quot;Save &amp;amp; Finish&quot; Command=&quot;{x:Bind ViewModel.SaveAllCommand}&quot; Style=&quot;{StaticResource AccentButtonStyle}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.SaveAndFinish&apos;), Mode=OneWay}&quot;/&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_ManualEntryView.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Dunnage.ViewModels;
using Microsoft.UI.Xaml.Input;
using Microsoft.UI.Input;
using Windows.System;
using Windows.UI.Core;
using CommunityToolkit.WinUI.UI.Controls;
using System.Linq;
using System.Collections;
using System;
using System.Diagnostics;
using MTM_Receiving_Application.Module_Dunnage.Models;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Contracts.Services;

namespace MTM_Receiving_Application.Module_Dunnage.Views
{
    public sealed partial class View_Dunnage_ManualEntryView : UserControl
    {
        public ViewModel_Dunnage_ManualEntry ViewModel { get; }
        private readonly IService_Focus _focusService;

        public View_Dunnage_ManualEntryView()
        {
            ViewModel = App.GetService&lt;ViewModel_Dunnage_ManualEntry&gt;();
            _focusService = App.GetService&lt;IService_Focus&gt;();
            this.DataContext = ViewModel;
            this.InitializeComponent();

            // Listen for collection changes to handle &quot;Add Row&quot; focus
            ViewModel.Loads.CollectionChanged += Loads_CollectionChanged;

            _focusService.AttachFocusOnVisibility(this);
        }

        private void Loads_CollectionChanged(object? sender, System.Collections.Specialized.NotifyCollectionChangedEventArgs e)
        {
            if (e.Action == System.Collections.Specialized.NotifyCollectionChangedAction.Add)
            {
                Debug.WriteLine(&quot;[Dunnage_ManualEntryView] Loads_CollectionChanged: New row added&quot;);
                // When a new row is added, ensure we focus and edit the first cell
                ManualEntryDataGrid.DispatcherQueue.TryEnqueue(() =&gt;
                {
                    if (ViewModel.Loads.Count &gt; 0)
                    {
                        // Select the last added item (assuming add to bottom)
                        if (e.NewItems?[0] is Model_DunnageLoad newItem)
                        {
                            Debug.WriteLine($&quot;[Dunnage_ManualEntryView] Loads_CollectionChanged: Selecting new item LoadNumber={newItem.LoadNumber}&quot;);
                            ManualEntryDataGrid.SelectedItem = newItem;
                            ManualEntryDataGrid.ScrollIntoView(newItem, ManualEntryDataGrid.Columns.FirstOrDefault());

                            // Use async delay to ensure grid is fully ready before entering edit mode
                            _ = Task.Run(async () =&gt;
                            {
                                await Task.Delay(100); // Give grid time to complete selection and render
                                ManualEntryDataGrid.DispatcherQueue.TryEnqueue(() =&gt;
                                {
                                    SelectFirstEditableCell(ManualEntryDataGrid);
                                });
                            });
                        }
                    }
                });
            }
        }

        private void ManualEntryDataGrid_CurrentCellChanged(object? sender, EventArgs e)
        {
            var grid = sender as DataGrid;
            // Wait for the move to complete then activate edit mode
            grid?.DispatcherQueue.TryEnqueue(() =&gt;
            {
                if (grid.CurrentColumn?.IsReadOnly == false)
                {
                    Debug.WriteLine($&quot;[Dunnage_ManualEntryView] CurrentCellChanged: BeginEdit for Row={grid.SelectedIndex}, Col={grid.CurrentColumn.Header}&quot;);
                    grid.BeginEdit();
                }
            });
        }

        private void ManualEntryDataGrid_KeyDown(object sender, KeyRoutedEventArgs e)
        {
            if (sender is not DataGrid grid)
            {
                return;
            }

            var shiftState = InputKeyboardSource.GetKeyStateForCurrentThread(VirtualKey.Shift);
            bool isShiftDown = (shiftState &amp; CoreVirtualKeyStates.Down) == CoreVirtualKeyStates.Down;

            Debug.WriteLine($&quot;[Dunnage_ManualEntryView] KeyDown: Key={e.Key}, Shift={isShiftDown}, OriginalSource={e.OriginalSource}, CurrentColumn={grid.CurrentColumn?.Header}&quot;);
        }

        private void ManualEntryDataGrid_Tapped(object sender, TappedRoutedEventArgs e)
        {
            if (sender is not DataGrid grid)
            {
                return;
            }

            Debug.WriteLine($&quot;[Dunnage_ManualEntryView] Tapped: OriginalSource={e.OriginalSource}&quot;);

            // Handle empty grid or header clicks
            if (grid.ItemsSource is IList items &amp;&amp; items.Count == 0)
            {
                Debug.WriteLine(&quot;[Dunnage_ManualEntryView] Tapped: Grid empty, triggering AddRow command.&quot;);
                if (ViewModel.AddRowCommand.CanExecute(null))
                {
                    ViewModel.AddRowCommand.Execute(null);
                }
                // Focus handled by Loads_CollectionChanged
            }
            else if (grid.SelectedItem == null)
            {
                Debug.WriteLine(&quot;[Dunnage_ManualEntryView] Tapped: SelectedItem is null (Header or empty space). Selecting first editable cell.&quot;);
                // Header clicked or empty space
                if (grid.ItemsSource is IList list &amp;&amp; list.Count &gt; 0)
                {
                    grid.SelectedIndex = 0;
                    SelectFirstEditableCell(grid);
                }
            }
            else
            {
                // Cell clicked - CurrentCellChanged handles the edit mode if cell changes.
                // But if we tap the SAME cell, CurrentCellChanged might not fire.
                // So we ensure edit mode here too.
                Debug.WriteLine(&quot;[Dunnage_ManualEntryView] Tapped: Cell clicked. Enqueuing BeginEdit.&quot;);
                grid.DispatcherQueue.TryEnqueue(() =&gt;
                {
                    if (grid.CurrentColumn?.IsReadOnly == false)
                    {
                        Debug.WriteLine($&quot;[Dunnage_ManualEntryView] Tapped: BeginEdit for Row={grid.SelectedIndex}, Col={grid.CurrentColumn.Header}&quot;);
                        grid.BeginEdit();
                    }
                });
            }
        }

        private void SelectFirstEditableCell(DataGrid grid)
        {
            Debug.WriteLine(&quot;[Dunnage_ManualEntryView] SelectFirstEditableCell: Starting&quot;);
            if (grid.ItemsSource is IList items &amp;&amp; items.Count &gt; 0)
            {
                // Find first non-readonly column
                var firstEditable = grid.Columns.OrderBy(c =&gt; c.DisplayIndex).FirstOrDefault(c =&gt; !c.IsReadOnly);
                if (firstEditable != null)
                {
                    Debug.WriteLine($&quot;[Dunnage_ManualEntryView] SelectFirstEditableCell: Found editable column {firstEditable.Header}. Setting CurrentColumn and calling BeginEdit.&quot;);
                    grid.CurrentColumn = firstEditable;
                    grid.Focus(Microsoft.UI.Xaml.FocusState.Programmatic);
                    grid.BeginEdit();
                    Debug.WriteLine($&quot;[Dunnage_ManualEntryView] SelectFirstEditableCell: BeginEdit called for column {firstEditable.Header}&quot;);
                }
                else
                {
                    Debug.WriteLine(&quot;[Dunnage_ManualEntryView] SelectFirstEditableCell: No editable column found.&quot;);
                }
            }
            else
            {
                var itemCount = (grid.ItemsSource as IList)?.Count ?? 0;
                Debug.WriteLine($&quot;[Dunnage_ManualEntryView] SelectFirstEditableCell: Grid has no items (Count={itemCount})&quot;);
            }
        }
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_ModeSelectionView.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_ModeSelectionView&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:viewmodels=&quot;using:MTM_Receiving_Application.Module_Dunnage.ViewModels&quot;
    mc:Ignorable=&quot;d&quot;&gt;

    &lt;Grid&gt;
        &lt;StackPanel Spacing=&quot;32&quot; HorizontalAlignment=&quot;Center&quot; VerticalAlignment=&quot;Center&quot;&gt;
            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;24&quot;&gt;
                &lt;!-- Guided Wizard Column --&gt;
                &lt;StackPanel Spacing=&quot;12&quot;&gt;
                    &lt;Button Command=&quot;{x:Bind ViewModel.SelectGuidedModeCommand}&quot;
                            Width=&quot;280&quot; Height=&quot;180&quot;
                            Padding=&quot;20&quot;
                            Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                            BorderThickness=&quot;1&quot;
                            CornerRadius=&quot;8&quot;
                            AutomationProperties.Name=&quot;Guided Wizard Mode&quot;&gt;
                        &lt;StackPanel Spacing=&quot;12&quot;&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE771;&quot; 
                                      FontSize=&quot;48&quot; 
                                      Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                            &lt;TextBlock Text=&quot;Guided Wizard&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; HorizontalAlignment=&quot;Center&quot;/&gt;
                            &lt;TextBlock Text=&quot;Step-by-step workflow for dunnage receiving with validation at each stage.&quot; 
                                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot; 
                                       TextWrapping=&quot;Wrap&quot; 
                                       TextAlignment=&quot;Center&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Button&gt;
                    
                    &lt;!-- Guided Mode Checkbox --&gt;
                    &lt;CheckBox Content=&quot;Set as default mode&quot;
                              IsChecked=&quot;{x:Bind ViewModel.IsGuidedModeDefault, Mode=TwoWay}&quot;
                              Command=&quot;{x:Bind ViewModel.SetGuidedAsDefaultCommand}&quot;
                              CommandParameter=&quot;{Binding IsChecked, RelativeSource={RelativeSource Self}}&quot;
                              HorizontalAlignment=&quot;Center&quot;
                              ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Tooltip.Button.QuickGuidedWizard&apos;), Mode=OneWay}&quot;/&gt;
                &lt;/StackPanel&gt;

                &lt;!-- Manual Entry Column --&gt;
                &lt;StackPanel Spacing=&quot;12&quot;&gt;
                    &lt;Button Command=&quot;{x:Bind ViewModel.SelectManualModeCommand}&quot;
                            Width=&quot;280&quot; Height=&quot;180&quot;
                            Padding=&quot;20&quot;
                            Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                            BorderThickness=&quot;1&quot;
                            CornerRadius=&quot;8&quot;
                            AutomationProperties.Name=&quot;Manual Entry Mode&quot;&gt;
                        &lt;StackPanel Spacing=&quot;12&quot;&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE7F0;&quot; 
                                      FontSize=&quot;48&quot; 
                                      Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                            &lt;TextBlock Text=&quot;Manual Entry&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; HorizontalAlignment=&quot;Center&quot;/&gt;
                            &lt;TextBlock Text=&quot;Bulk grid entry for receiving multiple dunnage items simultaneously.&quot; 
                                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot; 
                                       TextWrapping=&quot;Wrap&quot; 
                                       TextAlignment=&quot;Center&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Button&gt;
                    
                    &lt;!-- Manual Mode Checkbox --&gt;
                    &lt;CheckBox Content=&quot;Set as default mode&quot;
                              IsChecked=&quot;{x:Bind ViewModel.IsManualModeDefault, Mode=TwoWay}&quot;
                              Command=&quot;{x:Bind ViewModel.SetManualAsDefaultCommand}&quot;
                              CommandParameter=&quot;{Binding IsChecked, RelativeSource={RelativeSource Self}}&quot;
                              HorizontalAlignment=&quot;Center&quot;
                              ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Tooltip.Button.QuickManualEntry&apos;), Mode=OneWay}&quot;/&gt;
                &lt;/StackPanel&gt;

                &lt;!-- Edit Mode Column --&gt;
                &lt;StackPanel Spacing=&quot;12&quot;&gt;
                    &lt;Button Command=&quot;{x:Bind ViewModel.SelectEditModeCommand}&quot;
                            Width=&quot;280&quot; Height=&quot;180&quot;
                            Padding=&quot;20&quot;
                            Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                            BorderThickness=&quot;1&quot;
                            CornerRadius=&quot;8&quot;
                            AutomationProperties.Name=&quot;Edit Mode&quot;&gt;
                        &lt;StackPanel Spacing=&quot;12&quot;&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE70F;&quot; 
                                      FontSize=&quot;48&quot; 
                                      Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                            &lt;TextBlock Text=&quot;Edit Mode&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; HorizontalAlignment=&quot;Center&quot;/&gt;
                            &lt;TextBlock Text=&quot;Load historical dunnage records for editing and correction.&quot; 
                                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot; 
                                       TextWrapping=&quot;Wrap&quot; 
                                       TextAlignment=&quot;Center&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Button&gt;
                    
                    &lt;!-- Edit Mode Checkbox --&gt;
                    &lt;CheckBox Content=&quot;Set as default mode&quot;
                              IsChecked=&quot;{x:Bind ViewModel.IsEditModeDefault, Mode=TwoWay}&quot;
                              Command=&quot;{x:Bind ViewModel.SetEditAsDefaultCommand}&quot;
                              CommandParameter=&quot;{Binding IsChecked, RelativeSource={RelativeSource Self}}&quot;
                              HorizontalAlignment=&quot;Center&quot;
                              ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.QuickEditMode&apos;), Mode=OneWay}&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/StackPanel&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_ModeSelectionView.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Dunnage.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.Views;

/// &lt;summary&gt;
/// UserControl for Dunnage Mode Selection view
/// &lt;/summary&gt;
public sealed partial class View_Dunnage_ModeSelectionView : UserControl
{
    public ViewModel_Dunnage_ModeSelection ViewModel { get; }

    public View_Dunnage_ModeSelectionView()
    {
        ViewModel = App.GetService&lt;ViewModel_Dunnage_ModeSelection&gt;();
        InitializeComponent();
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_PartSelectionView.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_PartSelectionView&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:mi=&quot;using:Material.Icons.WinUI3&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:models=&quot;using:MTM_Receiving_Application.Module_Dunnage.Models&quot;
    xmlns:views=&quot;using:MTM_Receiving_Application.Module_Dunnage.Views&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;
    x:DataType=&quot;views:View_Dunnage_PartSelectionView&quot;
    Loaded=&quot;OnLoaded&quot;&gt;

    &lt;UserControl.Resources&gt;
        &lt;converters:Converter_BooleanToVisibility x:Key=&quot;BooleanToVisibilityConverter&quot;/&gt;
        &lt;converters:Converter_EmptyStringToVisibility x:Key=&quot;EmptyStringToVisibilityConverter&quot;/&gt;
    &lt;/UserControl.Resources&gt;

    &lt;Grid Padding=&quot;24&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header --&gt;
        &lt;StackPanel Grid.Row=&quot;0&quot; Spacing=&quot;8&quot; Margin=&quot;0,0,0,24&quot;&gt;
            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                &lt;TextBlock Style=&quot;{StaticResource TitleTextBlockStyle}&quot; Text=&quot;Select Part - &quot;/&gt;
                &lt;mi:MaterialIcon Kind=&quot;{x:Bind ViewModel.SelectedTypeIconKind, Mode=OneWay}&quot; 
                                 Width=&quot;24&quot; Height=&quot;24&quot;
                                 Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;
                                 VerticalAlignment=&quot;Center&quot;/&gt;
                &lt;TextBlock Text=&quot;{x:Bind ViewModel.SelectedTypeName, Mode=OneWay}&quot; 
                           Style=&quot;{StaticResource TitleTextBlockStyle}&quot;/&gt;
            &lt;/StackPanel&gt;
            &lt;TextBlock Text=&quot;{x:Bind ViewModel.GetTip(&apos;Dunnage.PartSelection&apos;), Mode=OneWay}&quot;
                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Inventory Notification --&gt;
        &lt;InfoBar Grid.Row=&quot;1&quot;
                 IsOpen=&quot;{x:Bind ViewModel.IsInventoryNotificationVisible, Mode=OneWay}&quot;
                 Severity=&quot;Warning&quot;
                 Message=&quot;{x:Bind ViewModel.InventoryNotificationMessage, Mode=OneWay}&quot;
                 Margin=&quot;0,0,0,16&quot;/&gt;

        &lt;!-- Part Selection Form --&gt;
        &lt;ScrollViewer Grid.Row=&quot;2&quot;&gt;
            &lt;StackPanel Spacing=&quot;24&quot;&gt;
                
                &lt;!-- Part Dropdown --&gt;
                &lt;StackPanel Spacing=&quot;12&quot;&gt;
                    &lt;TextBlock Text=&quot;Select Part&quot; Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                    &lt;ComboBox x:Name=&quot;PartNumberComboBox&quot;
                              ItemsSource=&quot;{x:Bind ViewModel.AvailableParts, Mode=OneWay}&quot;
                              SelectedItem=&quot;{x:Bind ViewModel.SelectedPart, Mode=TwoWay}&quot;
                              DisplayMemberPath=&quot;PartId&quot;
                              PlaceholderText=&quot;{x:Bind ViewModel.GetPlaceholder(&apos;Field.PartSelection&apos;), Mode=OneWay}&quot;
                              HorizontalAlignment=&quot;Stretch&quot;
                              MinWidth=&quot;300&quot;/&gt;
                &lt;/StackPanel&gt;

                &lt;!-- Part Details Card --&gt;
                &lt;Border Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                        BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                        BorderThickness=&quot;1&quot;
                        CornerRadius=&quot;8&quot;
                        Padding=&quot;20&quot;
                        Visibility=&quot;{x:Bind ViewModel.IsPartSelected, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;&gt;
                    &lt;Grid RowSpacing=&quot;12&quot;&gt;
                        &lt;Grid.RowDefinitions&gt;
                            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                        &lt;/Grid.RowDefinitions&gt;

                        &lt;!-- Header --&gt;
                        &lt;TextBlock Grid.Row=&quot;0&quot; 
                                   Text=&quot;Part Details&quot; 
                                   Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;/&gt;

                        &lt;!-- Details Grid --&gt;
                        &lt;Grid Grid.Row=&quot;1&quot; ColumnSpacing=&quot;24&quot; RowSpacing=&quot;12&quot;&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            &lt;Grid.RowDefinitions&gt;
                                &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                                &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                            &lt;/Grid.RowDefinitions&gt;

                            &lt;!-- Part ID --&gt;
                            &lt;TextBlock Grid.Row=&quot;0&quot; Grid.Column=&quot;0&quot; 
                                       Text=&quot;Part ID:&quot; 
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                            &lt;TextBlock Grid.Row=&quot;0&quot; Grid.Column=&quot;1&quot; 
                                       Text=&quot;{x:Bind ViewModel.SelectedPart.PartId, Mode=OneWay}&quot; 
                                       FontWeight=&quot;SemiBold&quot;/&gt;

                            &lt;!-- Type --&gt;
                            &lt;TextBlock Grid.Row=&quot;1&quot; Grid.Column=&quot;0&quot; 
                                       Text=&quot;Type:&quot; 
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                            &lt;StackPanel Grid.Row=&quot;1&quot; Grid.Column=&quot;1&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;6&quot;&gt;
                                &lt;mi:MaterialIcon Kind=&quot;{x:Bind ViewModel.SelectedTypeIconKind, Mode=OneWay}&quot; 
                                                 Width=&quot;16&quot; Height=&quot;16&quot;
                                                 Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                                &lt;TextBlock Text=&quot;{x:Bind ViewModel.SelectedTypeName, Mode=OneWay}&quot;/&gt;
                            &lt;/StackPanel&gt;
                        &lt;/Grid&gt;

                        &lt;!-- Inventory Method (if applicable) --&gt;
                        &lt;StackPanel Grid.Row=&quot;2&quot; 
                                    Orientation=&quot;Horizontal&quot; 
                                    Spacing=&quot;8&quot;
                                    Visibility=&quot;{x:Bind ViewModel.IsInventoryNotificationVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE946;&quot; 
                                      FontSize=&quot;16&quot; 
                                      Foreground=&quot;{ThemeResource SystemFillColorCautionBrush}&quot;/&gt;
                            &lt;TextBlock Text=&quot;Inventory Method:&quot; 
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                            &lt;TextBlock Text=&quot;{x:Bind ViewModel.InventoryMethod, Mode=OneWay}&quot; 
                                       FontWeight=&quot;SemiBold&quot;
                                       Foreground=&quot;{ThemeResource SystemFillColorCautionBrush}&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Grid&gt;
                &lt;/Border&gt;

                &lt;!-- Action Buttons --&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot;&gt;
                    &lt;Button Command=&quot;{x:Bind ViewModel.QuickAddPartCommand}&quot;
                            HorizontalAlignment=&quot;Left&quot;&gt;
                        &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE710;&quot; FontSize=&quot;16&quot;/&gt;
                            &lt;TextBlock Text=&quot;Add New Part&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Button&gt;
                    
                    &lt;Button Command=&quot;{x:Bind ViewModel.LoadPartsCommand}&quot;
                            HorizontalAlignment=&quot;Left&quot;
                            ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.Refresh&apos;), Mode=OneWay}&quot;&gt;
                        &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE72C;&quot; FontSize=&quot;16&quot;/&gt;
                            &lt;TextBlock Text=&quot;Refresh Parts&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Button&gt;
                &lt;/StackPanel&gt;

            &lt;/StackPanel&gt;
        &lt;/ScrollViewer&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_PartSelectionView.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.Views;

public sealed partial class View_Dunnage_PartSelectionView : UserControl
{
    public ViewModel_Dunnage_PartSelection ViewModel { get; }
    private readonly IService_Focus _focusService;

    public View_Dunnage_PartSelectionView()
    {
        ViewModel = App.GetService&lt;ViewModel_Dunnage_PartSelection&gt;();
        _focusService = App.GetService&lt;IService_Focus&gt;();
        InitializeComponent();

        _focusService.AttachFocusOnVisibility(this, PartNumberComboBox);
    }

    private async void OnLoaded(object sender, RoutedEventArgs e)
    {
        System.Diagnostics.Debug.WriteLine(&quot;Dunnage_PartSelectionView: OnLoaded called&quot;);
        await ViewModel.InitializeAsync();
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_QuantityEntryView.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_QuantityEntryView&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:mi=&quot;using:Material.Icons.WinUI3&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:views=&quot;using:MTM_Receiving_Application.Module_Dunnage.Views&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;
    x:DataType=&quot;views:View_Dunnage_QuantityEntryView&quot;
    Loaded=&quot;OnLoaded&quot;&gt;

    &lt;UserControl.Resources&gt;
        &lt;converters:Converter_EmptyStringToVisibility x:Key=&quot;EmptyStringToVisibilityConverter&quot;/&gt;
    &lt;/UserControl.Resources&gt;

    &lt;Grid Padding=&quot;16&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header --&gt;
        &lt;StackPanel Grid.Row=&quot;0&quot; Spacing=&quot;8&quot; Margin=&quot;0,0,0,16&quot;&gt;
            &lt;TextBlock Text=&quot;Enter Quantity&quot;
                       Style=&quot;{StaticResource TitleTextBlockStyle}&quot;/&gt;
            &lt;TextBlock Text=&quot;Specify how many labels you need to generate.&quot;
                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Context Banner --&gt;
        &lt;Border Grid.Row=&quot;1&quot;
                Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                BorderThickness=&quot;1&quot;
                CornerRadius=&quot;8&quot;
                Padding=&quot;12&quot;
                Margin=&quot;0,0,0,12&quot;&gt;
            &lt;StackPanel Spacing=&quot;6&quot;&gt;
                &lt;TextBlock Text=&quot;Selection Summary&quot;
                           FontWeight=&quot;SemiBold&quot;
                           FontSize=&quot;13&quot;/&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;TextBlock Text=&quot;Type:&quot; Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; FontSize=&quot;12&quot;/&gt;
                    &lt;mi:MaterialIcon Kind=&quot;{x:Bind ViewModel.SelectedTypeIconKind, Mode=OneWay}&quot; 
                                     Width=&quot;16&quot; Height=&quot;16&quot;
                                     Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                    &lt;TextBlock Text=&quot;{x:Bind ViewModel.SelectedTypeName, Mode=OneWay}&quot;
                               FontWeight=&quot;SemiBold&quot;
                               FontSize=&quot;12&quot;/&gt;
                &lt;/StackPanel&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;TextBlock Text=&quot;Part:&quot; Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; FontSize=&quot;12&quot;/&gt;
                    &lt;TextBlock Text=&quot;{x:Bind ViewModel.SelectedPartName, Mode=OneWay}&quot;
                               FontWeight=&quot;SemiBold&quot;
                               FontSize=&quot;12&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/StackPanel&gt;
        &lt;/Border&gt;

        &lt;!-- Quantity Input --&gt;
        &lt;ScrollViewer Grid.Row=&quot;2&quot; VerticalScrollBarVisibility=&quot;Auto&quot;&gt;
            &lt;StackPanel Spacing=&quot;12&quot;&gt;
                &lt;!-- Quantity Card --&gt;
                &lt;Border Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                        BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                        BorderThickness=&quot;1&quot;
                        CornerRadius=&quot;8&quot;
                        Padding=&quot;16&quot;&gt;
                    &lt;StackPanel Spacing=&quot;6&quot;&gt;
                        &lt;TextBlock Text=&quot;Quantity&quot;
                                   Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;/&gt;
                        &lt;NumberBox x:Name=&quot;QuantityNumberBox&quot;
                                   Value=&quot;{x:Bind ViewModel.Quantity, Mode=TwoWay}&quot;
                                   Minimum=&quot;1&quot;
                                   Maximum=&quot;9999&quot;
                                   SpinButtonPlacementMode=&quot;Inline&quot;
                                   HorizontalAlignment=&quot;Stretch&quot;
                                   PlaceholderText=&quot;{x:Bind ViewModel.GetPlaceholder(&apos;Field.Quantity&apos;), Mode=OneWay}&quot;/&gt;
                        
                        &lt;!-- Validation Message --&gt;
                        &lt;TextBlock Text=&quot;{x:Bind ViewModel.ValidationMessage, Mode=OneWay}&quot;
                                   Foreground=&quot;{ThemeResource SystemFillColorCriticalBrush}&quot;
                                   Visibility=&quot;{x:Bind ViewModel.ValidationMessage, Mode=OneWay, Converter={StaticResource EmptyStringToVisibilityConverter}}&quot;
                                   TextWrapping=&quot;Wrap&quot;
                                   FontSize=&quot;12&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Border&gt;

                &lt;!-- Info Panel Card --&gt;
                &lt;Border Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                        BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                        BorderThickness=&quot;1&quot;
                        CornerRadius=&quot;8&quot;
                        Padding=&quot;16&quot;&gt;
                    &lt;StackPanel Spacing=&quot;6&quot;&gt;
                        &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE946;&quot; 
                                      FontSize=&quot;16&quot; 
                                      Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                            &lt;TextBlock Text=&quot;Tip&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                        &lt;/StackPanel&gt;
                        &lt;TextBlock Text=&quot;{x:Bind ViewModel.GetTip(&apos;Dunnage.QuantityEntry&apos;), Mode=OneWay}&quot;
                                   TextWrapping=&quot;Wrap&quot;
                                   FontSize=&quot;12&quot;
                                   Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Border&gt;
            &lt;/StackPanel&gt;
        &lt;/ScrollViewer&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_QuantityEntryView.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.Views;

public sealed partial class View_Dunnage_QuantityEntryView : UserControl
{
    public ViewModel_Dunnage_QuantityEntry ViewModel { get; }
    private readonly IService_Focus _focusService;

    public View_Dunnage_QuantityEntryView()
    {
        ViewModel = App.GetService&lt;ViewModel_Dunnage_QuantityEntry&gt;();
        _focusService = App.GetService&lt;IService_Focus&gt;();
        InitializeComponent();

        _focusService.AttachFocusOnVisibility(this, QuantityNumberBox);
    }

    private void OnLoaded(object sender, RoutedEventArgs e)
    {
        ViewModel.LoadContextData();
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_QuickAddPartDialog.xaml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;ContentDialog
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_QuickAddPartDialog&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    Title=&quot;Add New Dunnage Part&quot;
    PrimaryButtonText=&quot;Add Part&quot;
    CloseButtonText=&quot;Cancel&quot;
    DefaultButton=&quot;Primary&quot;
    PrimaryButtonClick=&quot;OnPrimaryButtonClick&quot;
    PrimaryButtonStyle=&quot;{StaticResource AccentButtonStyle}&quot;
    Width=&quot;500&quot;&gt;

    &lt;ScrollViewer MaxHeight=&quot;500&quot;&gt;
        &lt;StackPanel Spacing=&quot;20&quot; Padding=&quot;8&quot;&gt;
            &lt;!-- Instructions --&gt;
            &lt;TextBlock 
                Text=&quot;Enter details for the new dunnage part&quot;
                TextWrapping=&quot;Wrap&quot;
                Style=&quot;{StaticResource BodyTextBlockStyle}&quot;/&gt;

            &lt;!-- Type Display (Read-only) --&gt;
            &lt;Border Background=&quot;{ThemeResource LayerFillColorDefaultBrush}&quot;
                    Padding=&quot;12&quot;
                    CornerRadius=&quot;4&quot;&gt;
                &lt;StackPanel Spacing=&quot;4&quot;&gt;
                    &lt;TextBlock Text=&quot;Dunnage Type&quot; 
                               Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                               Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                    &lt;TextBlock x:Name=&quot;TypeNameTextBlock&quot;
                               FontWeight=&quot;SemiBold&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/Border&gt;

            &lt;!-- Part ID Field --&gt;
            &lt;StackPanel Spacing=&quot;8&quot;&gt;
                &lt;TextBlock Text=&quot;Part ID (Auto-generated)&quot; Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                &lt;TextBox 
                    x:Name=&quot;PartIdTextBox&quot;
                    IsReadOnly=&quot;True&quot;
                    PlaceholderText=&quot;Auto-generated based on dimensions&quot;
                    MaxLength=&quot;100&quot;/&gt;
                &lt;TextBlock 
                    Text=&quot;Part ID is generated from Type and Dimensions&quot;
                    Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                    Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;/&gt;
            &lt;/StackPanel&gt;

            &lt;!-- Specifications Section --&gt;
            &lt;StackPanel Spacing=&quot;12&quot;&gt;
                &lt;TextBlock Text=&quot;Specifications&quot; 
                           Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                &lt;TextBlock 
                    Text=&quot;Enter dimensions to generate the Part ID&quot;
                    Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                    Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;/&gt;

                &lt;Grid ColumnSpacing=&quot;12&quot; RowSpacing=&quot;12&quot;&gt;
                    &lt;Grid.ColumnDefinitions&gt;
                        &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                        &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                        &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;/Grid.ColumnDefinitions&gt;

                    &lt;!-- Width --&gt;
                    &lt;StackPanel Grid.Column=&quot;0&quot; Spacing=&quot;4&quot;&gt;
                        &lt;TextBlock Text=&quot;Width (in)&quot; Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                        &lt;NumberBox x:Name=&quot;WidthNumberBox&quot; 
                                   PlaceholderText=&quot;0&quot;
                                   SpinButtonPlacementMode=&quot;Hidden&quot;
                                   Minimum=&quot;0&quot;
                                   Maximum=&quot;999&quot;
                                   SmallChange=&quot;1&quot;
                                   LargeChange=&quot;10&quot;
                                   ValueChanged=&quot;OnDimensionChanged&quot;/&gt;
                    &lt;/StackPanel&gt;

                    &lt;!-- Height --&gt;
                    &lt;StackPanel Grid.Column=&quot;1&quot; Spacing=&quot;4&quot;&gt;
                        &lt;TextBlock Text=&quot;Height (in)&quot; Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                        &lt;NumberBox x:Name=&quot;HeightNumberBox&quot; 
                                   PlaceholderText=&quot;0&quot;
                                   SpinButtonPlacementMode=&quot;Hidden&quot;
                                   Minimum=&quot;0&quot;
                                   Maximum=&quot;999&quot;
                                   SmallChange=&quot;1&quot;
                                   LargeChange=&quot;10&quot;
                                   ValueChanged=&quot;OnDimensionChanged&quot;/&gt;
                    &lt;/StackPanel&gt;

                    &lt;!-- Depth --&gt;
                    &lt;StackPanel Grid.Column=&quot;2&quot; Spacing=&quot;4&quot;&gt;
                        &lt;TextBlock Text=&quot;Depth (in)&quot; Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                        &lt;NumberBox x:Name=&quot;DepthNumberBox&quot; 
                                   PlaceholderText=&quot;0&quot;
                                   SpinButtonPlacementMode=&quot;Hidden&quot;
                                   Minimum=&quot;0&quot;
                                   Maximum=&quot;999&quot;
                                   SmallChange=&quot;1&quot;
                                   LargeChange=&quot;10&quot;
                                   ValueChanged=&quot;OnDimensionChanged&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Grid&gt;
            &lt;/StackPanel&gt;

            &lt;!-- Dynamic Specs Container --&gt;
            &lt;StackPanel x:Name=&quot;DynamicSpecsPanel&quot; Spacing=&quot;12&quot;/&gt;

            &lt;!-- Additional Notes --&gt;
            &lt;StackPanel Spacing=&quot;8&quot;&gt;
                &lt;TextBlock Text=&quot;Additional Notes (Optional)&quot; Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                &lt;TextBox 
                    x:Name=&quot;NotesTextBox&quot;
                    PlaceholderText=&quot;Any additional specifications or notes&quot;
                    TextWrapping=&quot;Wrap&quot;
                    AcceptsReturn=&quot;True&quot;
                    MaxLength=&quot;500&quot;
                    Height=&quot;80&quot;/&gt;
            &lt;/StackPanel&gt;

        &lt;/StackPanel&gt;
    &lt;/ScrollViewer&gt;
&lt;/ContentDialog&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_QuickAddTypeDialog.xaml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;ContentDialog
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_QuickAddTypeDialog&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:materialIcons=&quot;using:Material.Icons.WinUI3&quot;
    xmlns:local=&quot;using:MTM_Receiving_Application.Module_Dunnage.Views&quot;
    xmlns:models=&quot;using:MTM_Receiving_Application.Module_Dunnage.Models&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    Title=&quot;Add New Dunnage Type&quot;
    PrimaryButtonText=&quot;Add Type&quot;
    CloseButtonText=&quot;Cancel&quot;
    DefaultButton=&quot;Primary&quot;
    PrimaryButtonClick=&quot;OnPrimaryButtonClick&quot;
    PrimaryButtonStyle=&quot;{StaticResource AccentButtonStyle}&quot;
    Width=&quot;900&quot;&gt;

    &lt;ContentDialog.Resources&gt;
        &lt;converters:Converter_IconCodeToGlyph x:Key=&quot;IconCodeToGlyphConverter&quot;/&gt;
        &lt;!-- Help Button Style --&gt;
        &lt;Style x:Key=&quot;HelpButtonStyle&quot; TargetType=&quot;Button&quot;&gt;
            &lt;Setter Property=&quot;Background&quot; Value=&quot;Transparent&quot;/&gt;
            &lt;Setter Property=&quot;Padding&quot; Value=&quot;8&quot;/&gt;
            &lt;Setter Property=&quot;CornerRadius&quot; Value=&quot;4&quot;/&gt;
        &lt;/Style&gt;
    &lt;/ContentDialog.Resources&gt;

    &lt;ScrollViewer VerticalScrollBarVisibility=&quot;Auto&quot; MaxHeight=&quot;600&quot;&gt;
        &lt;StackPanel Spacing=&quot;24&quot; Padding=&quot;12&quot;&gt;
            &lt;!-- Header with Help Button --&gt;
            &lt;Grid&gt;
                &lt;TextBlock 
                    Text=&quot;Enter details for the new dunnage type&quot;
                    TextWrapping=&quot;Wrap&quot;
                    VerticalAlignment=&quot;Center&quot;
                    Style=&quot;{StaticResource BodyTextBlockStyle}&quot;/&gt;
                
                &lt;Button x:Name=&quot;HelpButton&quot;
                        HorizontalAlignment=&quot;Right&quot;
                        VerticalAlignment=&quot;Top&quot;
                        Style=&quot;{StaticResource HelpButtonStyle}&quot;
                        ToolTipService.ToolTip=&quot;Click for help about dunnage types&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;6&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE946;&quot; FontSize=&quot;14&quot; Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                        &lt;TextBlock Text=&quot;Help&quot; FontSize=&quot;12&quot; Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                    &lt;/StackPanel&gt;
                    &lt;Button.Flyout&gt;
                        &lt;Flyout&gt;
                            &lt;StackPanel Spacing=&quot;16&quot; MaxWidth=&quot;400&quot; Padding=&quot;4&quot;&gt;
                                &lt;StackPanel Spacing=&quot;8&quot;&gt;
                                    &lt;TextBlock Text=&quot;Dunnage Types&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                                    &lt;Border Height=&quot;2&quot; Background=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot; CornerRadius=&quot;1&quot; HorizontalAlignment=&quot;Left&quot; Width=&quot;60&quot;/&gt;
                                    &lt;TextBlock TextWrapping=&quot;Wrap&quot; Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;&gt;Define categories of dunnage materials for receiving classification.&lt;/TextBlock&gt;
                                &lt;/StackPanel&gt;
                                
                                &lt;Border Background=&quot;{ThemeResource LayerFillColorDefaultBrush}&quot; Padding=&quot;12&quot; CornerRadius=&quot;6&quot; BorderThickness=&quot;1&quot; BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;&gt;
                                    &lt;StackPanel Spacing=&quot;8&quot;&gt;
                                        &lt;TextBlock Text=&quot;Type Name&quot; FontWeight=&quot;SemiBold&quot; FontSize=&quot;13&quot;/&gt;
                                        &lt;TextBlock TextWrapping=&quot;Wrap&quot; FontSize=&quot;12&quot; Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;&gt;Choose a descriptive name like &apos;Pallet&apos;, &apos;Crate&apos;, or &apos;Foam Insert&apos;. This will be displayed in selection lists.&lt;/TextBlock&gt;
                                    &lt;/StackPanel&gt;
                                &lt;/Border&gt;
                                
                                &lt;Border Background=&quot;{ThemeResource LayerFillColorDefaultBrush}&quot; Padding=&quot;12&quot; CornerRadius=&quot;6&quot; BorderThickness=&quot;1&quot; BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;&gt;
                                    &lt;StackPanel Spacing=&quot;8&quot;&gt;
                                        &lt;TextBlock Text=&quot;Specifications&quot; FontWeight=&quot;SemiBold&quot; FontSize=&quot;13&quot;/&gt;
                                        &lt;TextBlock TextWrapping=&quot;Wrap&quot; FontSize=&quot;12&quot; Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;&gt;Add custom fields to capture specific data for this type. For example, &apos;Material&apos; (Text), &apos;Weight Capacity&apos; (Number with unit &apos;lbs&apos;), or &apos;Recyclable&apos; (Boolean).&lt;/TextBlock&gt;
                                    &lt;/StackPanel&gt;
                                &lt;/Border&gt;
                                
                                &lt;Border Background=&quot;{ThemeResource SystemFillColorAttentionBackgroundBrush}&quot; Padding=&quot;12&quot; CornerRadius=&quot;6&quot; BorderThickness=&quot;1&quot; BorderBrush=&quot;{ThemeResource SystemFillColorAttentionBrush}&quot;&gt;
                                    &lt;StackPanel Spacing=&quot;6&quot;&gt;
                                        &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;6&quot;&gt;
                                            &lt;FontIcon Glyph=&quot;&amp;#xE946;&quot; FontSize=&quot;12&quot; Foreground=&quot;{ThemeResource SystemFillColorAttentionBrush}&quot;/&gt;
                                            &lt;TextBlock Text=&quot;Tip&quot; FontWeight=&quot;SemiBold&quot; FontSize=&quot;12&quot; Foreground=&quot;{ThemeResource SystemFillColorAttentionBrush}&quot;/&gt;
                                        &lt;/StackPanel&gt;
                                        &lt;TextBlock TextWrapping=&quot;Wrap&quot; FontSize=&quot;11&quot;&gt;Required specs must be filled when creating new parts. Use Number type for measurements and validation.&lt;/TextBlock&gt;
                                    &lt;/StackPanel&gt;
                                &lt;/Border&gt;
                            &lt;/StackPanel&gt;
                        &lt;/Flyout&gt;
                    &lt;/Button.Flyout&gt;
                &lt;/Button&gt;
            &lt;/Grid&gt;

            &lt;!-- Type Name Field --&gt;
            &lt;StackPanel Spacing=&quot;12&quot;&gt;
                &lt;TextBlock Text=&quot;Type Name&quot; Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                &lt;TextBox 
                    x:Name=&quot;TypeNameTextBox&quot;
                    PlaceholderText=&quot;e.g., Pallet, Crate, Blocking&quot;
                    MaxLength=&quot;100&quot;
                    TextChanged=&quot;OnTypeNameChanged&quot;
                    ToolTipService.ToolTip=&quot;Enter a unique descriptive name for this dunnage type&quot;/&gt;
                &lt;TextBlock 
                    x:Name=&quot;ValidationTextBlock&quot;
                    Text=&quot;Type name is required&quot;
                    Foreground=&quot;{ThemeResource SystemFillColorCriticalBrush}&quot;
                    Visibility=&quot;Collapsed&quot;
                    Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;/&gt;
            &lt;/StackPanel&gt;

            &lt;!-- Icon Selection --&gt;
            &lt;StackPanel Spacing=&quot;12&quot;&gt;
                &lt;TextBlock Text=&quot;Select Icon&quot; Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                &lt;TextBlock 
                    Text=&quot;Choose an icon to represent this type&quot;
                    Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                    Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;/&gt;
                
                &lt;Button x:Name=&quot;SelectIconButton&quot;
                        Click=&quot;OnSelectIconClick&quot;
                        HorizontalAlignment=&quot;Stretch&quot;
                        Padding=&quot;16,12&quot;
                        ToolTipService.ToolTip=&quot;Click to browse and select an icon from the icon library&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot;&gt;
                        &lt;materialIcons:MaterialIcon x:Name=&quot;SelectedIconDisplay&quot; 
                                  Kind=&quot;{x:Bind SelectedIconKind, Mode=OneWay}&quot; 
                                  Width=&quot;24&quot; Height=&quot;24&quot;
                                  Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                        &lt;StackPanel VerticalAlignment=&quot;Center&quot;&gt;
                            &lt;TextBlock Text=&quot;Click to select icon&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                            &lt;TextBlock x:Name=&quot;SelectedIconNameText&quot;
                                       Text=&quot;Box&quot;
                                       FontSize=&quot;12&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
            &lt;/StackPanel&gt;

            &lt;!-- Specifications --&gt;
            &lt;StackPanel Spacing=&quot;12&quot;&gt;
                &lt;StackPanel Spacing=&quot;4&quot;&gt;
                    &lt;TextBlock Text=&quot;Specifications&quot; Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                    &lt;TextBlock 
                        Text=&quot;Define custom fields to capture specific data for this dunnage type&quot;
                        Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                        Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;/&gt;
                &lt;/StackPanel&gt;
            
                &lt;!-- Add Spec Form --&gt;
                &lt;Border Background=&quot;{ThemeResource LayerFillColorDefaultBrush}&quot; 
                        CornerRadius=&quot;6&quot; 
                        Padding=&quot;16&quot;
                        BorderThickness=&quot;1&quot;
                        BorderBrush=&quot;{ThemeResource SurfaceStrokeColorDefaultBrush}&quot;&gt;
                    &lt;StackPanel Spacing=&quot;12&quot;&gt;
                        &lt;Grid ColumnSpacing=&quot;12&quot;&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;2*&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            &lt;TextBox x:Name=&quot;NewSpecNameBox&quot; 
                                     PlaceholderText=&quot;Field Name (e.g. Material, Weight)&quot;
                                     ToolTipService.ToolTip=&quot;Enter a unique name for this specification field&quot;/&gt;
                            &lt;ComboBox x:Name=&quot;NewSpecTypeCombo&quot; 
                                      Grid.Column=&quot;1&quot;
                                      SelectedIndex=&quot;0&quot; 
                                      HorizontalAlignment=&quot;Stretch&quot;
                                      ToolTipService.ToolTip=&quot;Select the data type for this field&quot;&gt;
                                &lt;ComboBoxItem Content=&quot;Text&quot;/&gt;
                                &lt;ComboBoxItem Content=&quot;Number&quot;/&gt;
                                &lt;ComboBoxItem Content=&quot;Boolean&quot;/&gt;
                            &lt;/ComboBox&gt;
                        &lt;/Grid&gt;
                        
                        &lt;!-- Number Type Options --&gt;
                        &lt;StackPanel x:Name=&quot;NumberOptionsPanel&quot; Spacing=&quot;8&quot; Visibility=&quot;Collapsed&quot;&gt;
                            &lt;TextBlock Text=&quot;Number Validation&quot; FontSize=&quot;12&quot; FontWeight=&quot;SemiBold&quot; Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                            &lt;Grid ColumnSpacing=&quot;12&quot;&gt;
                                &lt;Grid.ColumnDefinitions&gt;
                                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                                &lt;/Grid.ColumnDefinitions&gt;
                                &lt;NumberBox x:Name=&quot;NewSpecMinValueBox&quot; 
                                           Header=&quot;Min Value&quot; 
                                           PlaceholderText=&quot;Optional&quot;
                                           SpinButtonPlacementMode=&quot;Compact&quot;
                                           ToolTipService.ToolTip=&quot;Minimum allowed value (optional)&quot;/&gt;
                                &lt;NumberBox x:Name=&quot;NewSpecMaxValueBox&quot; 
                                           Grid.Column=&quot;1&quot;
                                           Header=&quot;Max Value&quot; 
                                           PlaceholderText=&quot;Optional&quot;
                                           SpinButtonPlacementMode=&quot;Compact&quot;
                                           ToolTipService.ToolTip=&quot;Maximum allowed value (optional)&quot;/&gt;
                                &lt;TextBox x:Name=&quot;NewSpecUnitBox&quot; 
                                         Grid.Column=&quot;2&quot;
                                         Header=&quot;Unit&quot; 
                                         PlaceholderText=&quot;e.g. inches, lbs&quot;
                                         ToolTipService.ToolTip=&quot;Unit of measurement (optional)&quot;/&gt;
                            &lt;/Grid&gt;
                        &lt;/StackPanel&gt;
                        
                        &lt;Grid ColumnSpacing=&quot;12&quot;&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;16&quot; VerticalAlignment=&quot;Center&quot;&gt;
                                &lt;CheckBox x:Name=&quot;NewSpecRequiredCheck&quot; 
                                          Content=&quot;Required Field&quot;
                                          ToolTipService.ToolTip=&quot;Check if this field is required&quot;/&gt;
                            &lt;/StackPanel&gt;
                            &lt;Button Grid.Column=&quot;1&quot; 
                                    Content=&quot;Add Field&quot; 
                                    Click=&quot;OnAddSpecClick&quot; 
                                    Style=&quot;{StaticResource AccentButtonStyle}&quot;
                                    ToolTipService.ToolTip=&quot;Add this specification to the list below&quot;/&gt;
                        &lt;/Grid&gt;
                    &lt;/StackPanel&gt;
                &lt;/Border&gt;

                &lt;ListView x:Name=&quot;SpecsListView&quot; 
                          Height=&quot;130&quot;
                          BorderThickness=&quot;1&quot;
                          BorderBrush=&quot;{ThemeResource SurfaceStrokeColorDefaultBrush}&quot;
                          CornerRadius=&quot;6&quot;
                          Padding=&quot;4&quot;
                          ToolTipService.ToolTip=&quot;List of specifications defined for this type&quot;&gt;
                &lt;ListView.ItemTemplate&gt;
                    &lt;DataTemplate x:DataType=&quot;models:Model_SpecItem&quot;&gt;
                        &lt;Grid Padding=&quot;0,4&quot;&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            &lt;StackPanel Spacing=&quot;2&quot;&gt;
                                &lt;TextBlock Text=&quot;{x:Bind Name}&quot; FontWeight=&quot;SemiBold&quot; FontSize=&quot;13&quot;/&gt;
                                &lt;TextBlock Text=&quot;{x:Bind Description}&quot; 
                                           FontSize=&quot;11&quot; 
                                           Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                            &lt;/StackPanel&gt;
                            &lt;Border Grid.Column=&quot;1&quot; 
                                    Background=&quot;{ThemeResource SystemFillColorAttentionBackgroundBrush}&quot;
                                    CornerRadius=&quot;3&quot;
                                    Padding=&quot;6,2&quot;
                                    Margin=&quot;8,0&quot;
                                    Visibility=&quot;{x:Bind IsRequiredVisibility}&quot;&gt;
                                &lt;TextBlock Text=&quot;Required&quot; FontSize=&quot;10&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                            &lt;/Border&gt;
                            &lt;Button Grid.Column=&quot;2&quot; 
                                    Content=&quot;&amp;#xE74D;&quot;
                                    FontFamily=&quot;Segoe MDL2 Assets&quot;
                                    ToolTipService.ToolTip=&quot;Remove this specification&quot;
                                    Click=&quot;OnRemoveSpecClick&quot; 
                                    Style=&quot;{StaticResource SubtleButtonStyle}&quot;/&gt;
                        &lt;/Grid&gt;
                    &lt;/DataTemplate&gt;
                &lt;/ListView.ItemTemplate&gt;
            &lt;/ListView&gt;
            &lt;/StackPanel&gt;
        &lt;/StackPanel&gt;
    &lt;/ScrollViewer&gt;
&lt;/ContentDialog&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_QuickAddTypeDialog.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Runtime.CompilerServices;
using MTM_Receiving_Application.Module_Dunnage.Models;
using System.Linq;
using System.Net;
using Material.Icons;

namespace MTM_Receiving_Application.Module_Dunnage.Views;

public sealed partial class View_Dunnage_QuickAddTypeDialog : ContentDialog, INotifyPropertyChanged
{
    private bool _isIconSelected;
    private MaterialIconKind _selectedIcon = MaterialIconKind.PackageVariantClosed; // Default box icon
    private string _selectedIconName = &quot;Box&quot;; // Default icon name

    public string TypeName { get; private set; } = string.Empty;
    public MaterialIconKind SelectedIconKind { get; private set; } = MaterialIconKind.PackageVariantClosed;
    public ObservableCollection&lt;Model_SpecItem&gt; Specs { get; } = new();

    public bool IsIconSelected
    {
        get =&gt; _isIconSelected;
        set
        {
            _isIconSelected = value;
            OnPropertyChanged();
        }
    }

    public event PropertyChangedEventHandler? PropertyChanged;

    public View_Dunnage_QuickAddTypeDialog()
    {
        InitializeComponent();
        IsIconSelected = true;
        SpecsListView.ItemsSource = Specs;
        NewSpecTypeCombo.SelectionChanged += OnSpecTypeChanged;
    }

    private void OnSpecTypeChanged(object sender, SelectionChangedEventArgs e)
    {
        if (NewSpecTypeCombo.SelectedItem is ComboBoxItem item)
        {
            var type = item.Content.ToString();
            NumberOptionsPanel.Visibility = type == &quot;Number&quot; ? Visibility.Visible : Visibility.Collapsed;
        }
    }

    public void InitializeForEdit(string typeName, string iconName, Dictionary&lt;string, SpecDefinition&gt; specs)
    {
        Title = &quot;Edit Dunnage Type&quot;;
        PrimaryButtonText = &quot;Save Changes&quot;;

        // Try parse icon name, fallback to default
        if (!System.Enum.TryParse&lt;MaterialIconKind&gt;(iconName, out var kind))
        {
            kind = MaterialIconKind.PackageVariantClosed;
        }

        TypeNameTextBox.Text = typeName;
        _selectedIcon = kind;
        SelectedIconDisplay.Kind = kind;
        SelectedIconNameText.Text = kind.ToString();
        IsIconSelected = true;

        TypeName = typeName;
        SelectedIconKind = kind;

        Specs.Clear();
        foreach (var kvp in specs)
        {
            Specs.Add(new Model_SpecItem
            {
                Name = kvp.Key,
                DataType = kvp.Value.DataType,
                IsRequired = kvp.Value.Required,
                Unit = kvp.Value.Unit,
                MinValue = kvp.Value.MinValue,
                MaxValue = kvp.Value.MaxValue
            });
        }
    }

    private void OnAddSpecClick(object sender, RoutedEventArgs e)
    {
        AddSpec();
    }

    private void AddSpec()
    {
        var name = NewSpecNameBox.Text.Trim();
        if (string.IsNullOrWhiteSpace(name))
        {
            return;
        }

        if (Specs.Any(s =&gt; s.Name.Equals(name, System.StringComparison.OrdinalIgnoreCase)))
        {
            return;
        }

        var typeItem = NewSpecTypeCombo.SelectedItem as ComboBoxItem;
        var type = typeItem?.Content.ToString() ?? &quot;Text&quot;;
        var required = NewSpecRequiredCheck.IsChecked ?? false;
        var unit = string.Empty;
        double? minValue = null;
        double? maxValue = null;

        if (type == &quot;Number&quot;)
        {
            unit = NewSpecUnitBox.Text.Trim();
            if (!double.IsNaN(NewSpecMinValueBox.Value))
            {
                minValue = NewSpecMinValueBox.Value;
            }

            if (!double.IsNaN(NewSpecMaxValueBox.Value))
            {
                maxValue = NewSpecMaxValueBox.Value;
            }
        }

        Specs.Add(new Model_SpecItem
        {
            Name = name,
            DataType = type,
            IsRequired = required,
            Unit = unit,
            MinValue = minValue,
            MaxValue = maxValue
        });

        // Clear form
        NewSpecNameBox.Text = string.Empty;
        NewSpecUnitBox.Text = string.Empty;
        NewSpecMinValueBox.Value = double.NaN;
        NewSpecMaxValueBox.Value = double.NaN;
        NewSpecRequiredCheck.IsChecked = false;
        NewSpecTypeCombo.SelectedIndex = 0;
    }

    private void OnRemoveSpecClick(object sender, RoutedEventArgs e)
    {
        if (sender is Button button &amp;&amp; button.DataContext is Model_SpecItem spec)
        {
            Specs.Remove(spec);
        }
    }

    private async void OnSelectIconClick(object sender, RoutedEventArgs e)
    {
        var iconWindow = new MTM_Receiving_Application.Module_Shared.Views.View_Shared_IconSelectorWindow();

        // Show window and wait for it to close
        var hwnd = WinRT.Interop.WindowNative.GetWindowHandle(iconWindow);
        var windowId = Microsoft.UI.Win32Interop.GetWindowIdFromWindow(hwnd);
        var appWindow = Microsoft.UI.Windowing.AppWindow.GetFromWindowId(windowId);

        iconWindow.Activate();

        // Wait for window to close (polling approach)
        var tcs = new System.Threading.Tasks.TaskCompletionSource&lt;bool&gt;();
        iconWindow.Closed += (s, args) =&gt; tcs.SetResult(true);
        await tcs.Task;

        // Check if icon was selected
        if (iconWindow.IconWasSelected &amp;&amp; iconWindow.SelectedIconKind.HasValue)
        {
            _selectedIcon = iconWindow.SelectedIconKind.Value;
            _selectedIconName = iconWindow.SelectedIconName ?? &quot;Icon&quot;;

            SelectedIconDisplay.Kind = _selectedIcon;
            SelectedIconNameText.Text = _selectedIconName;
            IsIconSelected = true;
        }
    }

    private void OnTypeNameChanged(object sender, TextChangedEventArgs e)
    {
        var textBox = (TextBox)sender;
        ValidationTextBlock.Visibility = Visibility.Collapsed; // Hide error while typing
    }

    private void OnPrimaryButtonClick(ContentDialog sender, ContentDialogButtonClickEventArgs args)
    {
        var input = TypeNameTextBox.Text.Trim();

        // 1. Required check
        if (string.IsNullOrWhiteSpace(input))
        {
            ShowError(&quot;Type name is required&quot;);
            args.Cancel = true;
            return;
        }

        // 2. Start with Capital Letter check
        if (!char.IsUpper(input[0]))
        {
            ShowError(&quot;Name must start with a capital letter&quot;);
            args.Cancel = true;
            return;
        }

        // 3. No spaces check
        if (input.Contains(&quot; &quot;))
        {
            ShowError(&quot;Name cannot contain spaces&quot;);
            args.Cancel = true;
            return;
        }

        // 4. No special characters check (Alphanumeric only)
        if (!AlphanumericRegex().IsMatch(input))
        {
            ShowError(&quot;Name cannot contain special characters&quot;);
            args.Cancel = true;
            return;
        }

        // Set properties for caller to retrieve
        TypeName = input;
        SelectedIconKind = _selectedIcon;
    }

    [System.Text.RegularExpressions.GeneratedRegex(&quot;^[a-zA-Z0-9]*$&quot;)]
    private static partial System.Text.RegularExpressions.Regex AlphanumericRegex();

    private void ShowError(string message)
    {
        ValidationTextBlock.Text = message;
        ValidationTextBlock.Visibility = Visibility.Visible;
    }

    private void OnPropertyChanged([CallerMemberName] string? propertyName = null)
    {
        PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_ReviewView.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_ReviewView&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:mi=&quot;using:Material.Icons.WinUI3&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    xmlns:views=&quot;using:MTM_Receiving_Application.Module_Dunnage.Views&quot;
    xmlns:models=&quot;using:MTM_Receiving_Application.Module_Dunnage.Models&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;
    x:DataType=&quot;views:View_Dunnage_ReviewView&quot;
    Loaded=&quot;OnLoaded&quot;&gt;

    &lt;UserControl.Resources&gt;
        &lt;converters:Converter_BooleanToVisibility x:Key=&quot;BooleanToVisibilityConverter&quot;/&gt;
        &lt;converters:Converter_EmptyStringToVisibility x:Key=&quot;EmptyStringToVisibilityConverter&quot;/&gt;
    &lt;/UserControl.Resources&gt;

    &lt;Grid Padding=&quot;24&quot; RowSpacing=&quot;16&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Success Message --&gt;
        &lt;InfoBar Grid.Row=&quot;0&quot;
                 IsOpen=&quot;{x:Bind ViewModel.IsSuccessMessageVisible, Mode=OneWay}&quot;
                 Severity=&quot;Success&quot;
                 Message=&quot;{x:Bind ViewModel.SuccessMessage, Mode=OneWay}&quot;
                 IsClosable=&quot;False&quot;&gt;
            &lt;InfoBar.ActionButton&gt;
                &lt;Button Content=&quot;Start New Entry&quot; Command=&quot;{x:Bind ViewModel.StartNewEntryCommand}&quot;/&gt;
            &lt;/InfoBar.ActionButton&gt;
        &lt;/InfoBar&gt;

        &lt;!-- Content Section with View Toggle --&gt;
        &lt;Grid Grid.Row=&quot;1&quot;&gt;
            &lt;!-- Single Entry View --&gt;
            &lt;Grid Visibility=&quot;{x:Bind ViewModel.IsSingleView, Mode=OneWay}&quot;&gt;
                &lt;Grid.RowDefinitions&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                &lt;/Grid.RowDefinitions&gt;

                &lt;!-- Entry Counter --&gt;
                &lt;Border Grid.Row=&quot;0&quot; 
                       Background=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;
                       Padding=&quot;12,6&quot;
                       CornerRadius=&quot;8,8,0,0&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot; HorizontalAlignment=&quot;Center&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE8FD;&quot; 
                                 FontSize=&quot;16&quot; 
                                 Foreground=&quot;White&quot;/&gt;
                        &lt;TextBlock Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;
                                   Foreground=&quot;White&quot;&gt;
                            &lt;Run Text=&quot;Entry&quot;/&gt;
                            &lt;Run Text=&quot;{x:Bind ViewModel.CurrentEntryIndex, Mode=OneWay}&quot;/&gt;
                            &lt;Run Text=&quot;of&quot;/&gt;
                            &lt;Run Text=&quot;{x:Bind ViewModel.LoadCount, Mode=OneWay}&quot;/&gt;
                        &lt;/TextBlock&gt;
                    &lt;/StackPanel&gt;
                &lt;/Border&gt;

                &lt;!-- Single Entry Form --&gt;
                &lt;Grid Grid.Row=&quot;1&quot;&gt;
                    &lt;Border Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                           BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                           BorderThickness=&quot;1,0,1,1&quot;
                           CornerRadius=&quot;0,0,8,8&quot;
                           Padding=&quot;20&quot;&gt;
                        &lt;Grid MaxWidth=&quot;900&quot;&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;

                            &lt;!-- Left Column --&gt;
                            &lt;StackPanel Grid.Column=&quot;0&quot; Spacing=&quot;12&quot; Margin=&quot;0,0,12,0&quot;&gt;
                                &lt;TextBlock Text=&quot;Load Details&quot; 
                                          Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;
                                          Margin=&quot;0,0,0,8&quot;/&gt;

                                &lt;StackPanel Spacing=&quot;4&quot;&gt;
                                    &lt;TextBlock Text=&quot;Type&quot; 
                                              Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                              Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;6&quot;&gt;
                                        &lt;mi:MaterialIcon Kind=&quot;{x:Bind ViewModel.CurrentLoad.TypeIconKind, Mode=OneWay}&quot; 
                                                         Width=&quot;18&quot; Height=&quot;18&quot;
                                                         Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                                        &lt;TextBlock Text=&quot;{x:Bind ViewModel.CurrentLoad.TypeName, Mode=OneWay}&quot; 
                                                  Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                                    &lt;/StackPanel&gt;
                                &lt;/StackPanel&gt;

                                &lt;StackPanel Spacing=&quot;4&quot;&gt;
                                    &lt;TextBlock Text=&quot;Part ID&quot; 
                                              Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                              Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                                    &lt;TextBlock Text=&quot;{x:Bind ViewModel.CurrentLoad.PartId, Mode=OneWay}&quot; 
                                              Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                                &lt;/StackPanel&gt;

                                &lt;StackPanel Spacing=&quot;4&quot;&gt;
                                    &lt;TextBlock Text=&quot;Quantity&quot; 
                                              Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                              Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                                    &lt;TextBlock Text=&quot;{x:Bind ViewModel.CurrentLoad.Quantity, Mode=OneWay}&quot; 
                                              Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                                &lt;/StackPanel&gt;
                            &lt;/StackPanel&gt;

                            &lt;!-- Right Column --&gt;
                            &lt;StackPanel Grid.Column=&quot;1&quot; Spacing=&quot;12&quot; Margin=&quot;12,0,0,0&quot;&gt;
                                &lt;TextBlock Text=&quot;Additional Information&quot; 
                                          Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;
                                          Margin=&quot;0,0,0,8&quot;/&gt;

                                &lt;StackPanel Spacing=&quot;4&quot;&gt;
                                    &lt;TextBlock Text=&quot;PO Number&quot; 
                                              Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                              Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                                    &lt;TextBlock Text=&quot;{x:Bind ViewModel.CurrentLoad.PoNumber, Mode=OneWay}&quot; 
                                              Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                                &lt;/StackPanel&gt;

                                &lt;StackPanel Spacing=&quot;4&quot;&gt;
                                    &lt;TextBlock Text=&quot;Location&quot; 
                                              Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                              Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                                    &lt;TextBlock Text=&quot;{x:Bind ViewModel.CurrentLoad.Location, Mode=OneWay}&quot; 
                                              Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                                &lt;/StackPanel&gt;

                                &lt;StackPanel Spacing=&quot;4&quot;&gt;
                                    &lt;TextBlock Text=&quot;Inventory Method&quot; 
                                              Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                              Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                                    &lt;TextBlock Text=&quot;{x:Bind ViewModel.CurrentLoad.InventoryMethod, Mode=OneWay}&quot; 
                                              Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                                &lt;/StackPanel&gt;
                            &lt;/StackPanel&gt;
                        &lt;/Grid&gt;
                    &lt;/Border&gt;
                &lt;/Grid&gt;

                &lt;!-- Navigation Bar for Single View --&gt;
                &lt;CommandBar Grid.Row=&quot;2&quot; DefaultLabelPosition=&quot;Right&quot; Margin=&quot;0,12,0,0&quot;&gt;
                    &lt;AppBarButton Icon=&quot;Back&quot; 
                                 Label=&quot;Previous&quot; 
                                 Command=&quot;{x:Bind ViewModel.PreviousEntryCommand}&quot;
                                 IsEnabled=&quot;{x:Bind ViewModel.CanGoBack, Mode=OneWay}&quot;
                                 AutomationProperties.Name=&quot;Previous Entry&quot;/&gt;
                    
                    &lt;AppBarButton Icon=&quot;Forward&quot; 
                                 Label=&quot;Next&quot; 
                                 Command=&quot;{x:Bind ViewModel.NextEntryCommand}&quot;
                                 IsEnabled=&quot;{x:Bind ViewModel.CanGoNext, Mode=OneWay}&quot;
                                 AutomationProperties.Name=&quot;Next Entry&quot;/&gt;
                    
                    &lt;AppBarSeparator/&gt;
                    
                    &lt;AppBarButton Icon=&quot;ViewAll&quot; 
                                 Label=&quot;Table View&quot; 
                                 Command=&quot;{x:Bind ViewModel.SwitchToTableViewCommand}&quot;
                                 AutomationProperties.Name=&quot;Switch to Table View&quot;/&gt;
                &lt;/CommandBar&gt;
            &lt;/Grid&gt;

            &lt;!-- Table View (DataGrid) --&gt;
            &lt;Grid Visibility=&quot;{x:Bind ViewModel.IsTableView, Mode=OneWay}&quot;&gt;
                &lt;Grid.RowDefinitions&gt;
                    &lt;RowDefinition Height=&quot;*&quot;/&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                &lt;/Grid.RowDefinitions&gt;

                &lt;Border Grid.Row=&quot;0&quot;
                       Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                       BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                       BorderThickness=&quot;1&quot;
                       CornerRadius=&quot;8&quot;
                       Padding=&quot;16&quot;&gt;
                    &lt;controls:DataGrid x:Name=&quot;ReviewDataGrid&quot;
                                      ItemsSource=&quot;{x:Bind ViewModel.SessionLoads, Mode=OneWay}&quot;
                                      AutoGenerateColumns=&quot;False&quot;
                                      CanUserReorderColumns=&quot;False&quot;
                                      CanUserResizeColumns=&quot;True&quot;
                                      CanUserSortColumns=&quot;True&quot;
                                      GridLinesVisibility=&quot;None&quot;
                                      HeadersVisibility=&quot;Column&quot;
                                      SelectionMode=&quot;Single&quot;
                                      IsReadOnly=&quot;True&quot;&gt;
                        &lt;controls:DataGrid.Columns&gt;
                            &lt;controls:DataGridTextColumn Header=&quot;Type&quot; 
                                                        Binding=&quot;{Binding TypeName}&quot; 
                                                        Width=&quot;120&quot;/&gt;
                            &lt;controls:DataGridTextColumn Header=&quot;Part ID&quot; 
                                                        Binding=&quot;{Binding PartId}&quot; 
                                                        Width=&quot;150&quot;/&gt;
                            &lt;controls:DataGridTextColumn Header=&quot;Quantity&quot; 
                                                        Binding=&quot;{Binding Quantity}&quot; 
                                                        Width=&quot;100&quot;/&gt;
                            &lt;controls:DataGridTextColumn Header=&quot;PO Number&quot; 
                                                        Binding=&quot;{Binding PoNumber}&quot; 
                                                        Width=&quot;150&quot;/&gt;
                            &lt;controls:DataGridTextColumn Header=&quot;Location&quot; 
                                                        Binding=&quot;{Binding Location}&quot; 
                                                        Width=&quot;150&quot;/&gt;
                            &lt;controls:DataGridTextColumn Header=&quot;Inventory Method&quot; 
                                                        Binding=&quot;{Binding InventoryMethod}&quot; 
                                                        Width=&quot;*&quot;/&gt;
                        &lt;/controls:DataGrid.Columns&gt;
                    &lt;/controls:DataGrid&gt;
                &lt;/Border&gt;

                &lt;!-- Navigation Bar for Table View --&gt;
                &lt;CommandBar Grid.Row=&quot;1&quot; DefaultLabelPosition=&quot;Right&quot; Margin=&quot;0,16,0,0&quot;&gt;
                    &lt;AppBarButton Label=&quot;Single View&quot; 
                                 Command=&quot;{x:Bind ViewModel.SwitchToSingleViewCommand}&quot;
                                 AutomationProperties.Name=&quot;Switch to Single View&quot;&gt;
                        &lt;AppBarButton.Icon&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE8FD;&quot;/&gt;
                        &lt;/AppBarButton.Icon&gt;
                    &lt;/AppBarButton&gt;
                &lt;/CommandBar&gt;
            &lt;/Grid&gt;
        &lt;/Grid&gt;

        &lt;!-- Action Buttons --&gt;
        &lt;Grid Grid.Row=&quot;2&quot; ColumnSpacing=&quot;12&quot; Margin=&quot;0,16,0,0&quot;&gt;
            &lt;Grid.ColumnDefinitions&gt;
                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
            &lt;/Grid.ColumnDefinitions&gt;

            &lt;Button Grid.Column=&quot;1&quot; 
                   Command=&quot;{x:Bind ViewModel.AddAnotherCommand}&quot;
                   AutomationProperties.Name=&quot;Add Another Load&quot;
                   ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.AddAnother&apos;), Mode=OneWay}&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE710;&quot; FontSize=&quot;16&quot;/&gt;
                    &lt;TextBlock Text=&quot;Add Another&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/Button&gt;
            
            &lt;Button Grid.Column=&quot;2&quot; 
                   Command=&quot;{x:Bind ViewModel.SaveAllCommand}&quot;
                   Style=&quot;{StaticResource AccentButtonStyle}&quot;
                   IsEnabled=&quot;{x:Bind ViewModel.CanSave, Mode=OneWay}&quot;
                   AutomationProperties.Name=&quot;Save to Database&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE74E;&quot; FontSize=&quot;16&quot;/&gt;
                    &lt;TextBlock Text=&quot;Save All&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/Button&gt;
        &lt;/Grid&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_ReviewView.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.Views;

public sealed partial class View_Dunnage_ReviewView : UserControl
{
    public ViewModel_Dunnage_Review ViewModel { get; }
    private readonly IService_Focus _focusService;

    public View_Dunnage_ReviewView()
    {
        ViewModel = App.GetService&lt;ViewModel_Dunnage_Review&gt;();
        _focusService = App.GetService&lt;IService_Focus&gt;();
        InitializeComponent();

        _focusService.AttachFocusOnVisibility(this);
    }

    private void OnLoaded(object sender, RoutedEventArgs e)
    {
        ViewModel.LoadSessionLoads();
    }
}</file><file path="Module_Receiving/Models/Model_Application_Variables.cs">using System;
using System.IO;

namespace MTM_Receiving_Application.Module_Receiving.Models;

/// &lt;summary&gt;
/// Application-wide configuration and constants
/// &lt;/summary&gt;
public class Model_Application_Variables
{
    /// &lt;summary&gt;
    /// Display name of the application
    /// &lt;/summary&gt;
    public string ApplicationName { get; set; } = &quot;MTM Receiving Label Application&quot;;

    /// &lt;summary&gt;
    /// Semantic version of the application (MAJOR.MINOR.PATCH)
    /// &lt;/summary&gt;
    public string Version { get; set; } = &quot;1.0.0&quot;;

    /// &lt;summary&gt;
    /// MySQL connection string (configured from Helper_Database_Variables)
    /// &lt;/summary&gt;
    public string ConnectionString { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Directory path for application log files
    /// &lt;/summary&gt;
    public string LogDirectory { get; set; } = Path.Combine(
        Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
        &quot;MTM_Receiving_Application&quot;,
        &quot;Logs&quot;
    );

    /// &lt;summary&gt;
    /// Current environment (Development, Test, Production)
    /// &lt;/summary&gt;
    public string EnvironmentType { get; set; } = &quot;Development&quot;;
}</file><file path="Module_Receiving/Models/Model_CSVDeleteResult.cs">namespace MTM_Receiving_Application.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Result of CSV delete operation.
    /// &lt;/summary&gt;
    public class Model_CSVDeleteResult
    {
        public bool LocalDeleted { get; set; }
        public bool NetworkDeleted { get; set; }
        public string? LocalError { get; set; }
        public string? NetworkError { get; set; }
    }
}</file><file path="Module_Receiving/Models/Model_CSVExistenceResult.cs">namespace MTM_Receiving_Application.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Result of CSV existence check.
    /// &lt;/summary&gt;
    public class Model_CSVExistenceResult
    {
        public bool LocalExists { get; set; }
        public bool NetworkExists { get; set; }
        public bool NetworkAccessible { get; set; }
    }
}</file><file path="Module_Receiving/Models/Model_CSVWriteResult.cs">namespace MTM_Receiving_Application.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Result of CSV write operation.
    /// &lt;/summary&gt;
    public class Model_CSVWriteResult
    {
        public bool LocalSuccess { get; set; }
        public bool NetworkSuccess { get; set; }

        // Combined properties from both definitions
        public string ErrorMessage { get; set; } = string.Empty;
        public string? LocalError { get; set; }
        public string? NetworkError { get; set; }
        public string LocalFilePath { get; set; } = string.Empty;
        public string NetworkFilePath { get; set; } = string.Empty;
        public int RecordsWritten { get; set; }

        public bool IsFullSuccess =&gt; LocalSuccess &amp;&amp; NetworkSuccess;
        public bool IsPartialSuccess =&gt; LocalSuccess &amp;&amp; !NetworkSuccess;
        public bool IsFailure =&gt; !LocalSuccess;
    }
}</file><file path="Module_Receiving/Models/Model_InforVisualPart.cs">namespace MTM_Receiving_Application.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Represents a part/line item on a purchase order from Infor Visual.
    /// Read-only data from external system.
    /// &lt;/summary&gt;
    public class Model_InforVisualPart
    {
        public string PartID { get; set; } = string.Empty;

        public string POLineNumber { get; set; } = string.Empty;

        public string PartType { get; set; } = string.Empty;

        public decimal QtyOrdered { get; set; }

        public string UnitOfMeasure { get; set; } = &quot;EA&quot;;

        public string Description { get; set; } = string.Empty;

        /// &lt;summary&gt;
        /// Remaining quantity available to receive (Ordered - Received).
        /// Whole number only (no decimals).
        /// &lt;/summary&gt;
        public int RemainingQuantity { get; set; }

        /// &lt;summary&gt;
        /// Display text for UI showing part ID, description, and line number.
        /// &lt;/summary&gt;
        public string DisplayText =&gt;
            $&quot;{PartID} - {Description} (Line {POLineNumber})&quot;;
    }
}</file><file path="Module_Receiving/Models/Model_InforVisualPO.cs">using System.Collections.Generic;

namespace MTM_Receiving_Application.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Represents a purchase order retrieved from Infor Visual (SQL Server).
    /// Read-only data from external system.
    /// &lt;/summary&gt;
    public class Model_InforVisualPO
    {
        public string PONumber { get; set; } = string.Empty;

        public string Vendor { get; set; } = string.Empty;

        public string Status { get; set; } = string.Empty;

        public List&lt;Model_InforVisualPart&gt; Parts { get; set; } = new();

        /// &lt;summary&gt;
        /// Indicates whether this PO has any parts associated with it.
        /// &lt;/summary&gt;
        public bool HasParts =&gt; Parts?.Count &gt; 0;

        /// &lt;summary&gt;
        /// Returns a user-friendly status description.
        /// &lt;/summary&gt;
        public string StatusDescription =&gt; Status switch
        {
            &quot;R&quot; =&gt; &quot;Open&quot;,
            &quot;C&quot; =&gt; &quot;Closed&quot;,
            &quot;O&quot; =&gt; &quot;Open&quot;,
            &quot;P&quot; =&gt; &quot;Partially Received&quot;,
            &quot;X&quot; =&gt; &quot;Cancelled&quot;,
            &quot;F&quot; =&gt; &quot;Firm&quot;,
            &quot;&quot; =&gt; &quot;Unknown&quot;,
            _ =&gt; $&quot;Status: {Status}&quot;
        };

        /// &lt;summary&gt;
        /// Indicates if the PO is closed or cancelled.
        /// &lt;/summary&gt;
        public bool IsClosed =&gt; Status == &quot;C&quot; || Status == &quot;X&quot;;
    }
}</file><file path="Module_Receiving/Models/Model_PackageTypePreference.cs">using System;

namespace MTM_Receiving_Application.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Stores user&apos;s preferred package type for specific part IDs.
    /// Persisted to MySQL database for use across sessions.
    /// &lt;/summary&gt;
    public class Model_PackageTypePreference
    {
        public int PreferenceID { get; set; }

        public string PartID { get; set; } = string.Empty;

        public string PackageTypeName { get; set; } = string.Empty;

        public string? CustomTypeName { get; set; }

        public DateTime LastModified { get; set; } = DateTime.UtcNow;
    }
}</file><file path="Module_Receiving/Models/Model_SaveResult.cs">using System.Collections.Generic;

namespace MTM_Receiving_Application.Module_Receiving.Models
{
    public class Model_SaveResult
    {
        public bool Success { get; set; }
        public int LoadsSaved { get; set; }
        public bool LocalCSVSuccess { get; set; }
        public bool NetworkCSVSuccess { get; set; }
        public bool DatabaseSuccess { get; set; }
        public string? LocalCSVPath { get; set; }
        public string? NetworkCSVPath { get; set; }
        public List&lt;string&gt; Errors { get; set; } = new();
        public List&lt;string&gt; Warnings { get; set; } = new();

        // Legacy property support if needed, or just remove if unused
        public string ErrorMessage { get; set; } = string.Empty;
        public int RecordsSaved { get =&gt; LoadsSaved; set =&gt; LoadsSaved = value; }
        public bool IsSuccess { get =&gt; Success; set =&gt; Success = value; }
        public Model_CSVWriteResult? CSVExportResult { get; set; }

        public bool IsFullSuccess =&gt; LocalCSVSuccess &amp;&amp; NetworkCSVSuccess &amp;&amp; DatabaseSuccess;
        public bool IsPartialSuccess =&gt; (LocalCSVSuccess || DatabaseSuccess) &amp;&amp; !IsFullSuccess;
    }
}</file><file path="Module_Receiving/Models/Model_UserPreference.cs">using System;
using CommunityToolkit.Mvvm.ComponentModel;

namespace MTM_Receiving_Application.Module_Receiving.Models;

public partial class Model_UserPreference : ObservableObject
{
    /// &lt;summary&gt;Unique identifier (auto-increment)&lt;/summary&gt;
    [ObservableProperty]
    private int _preferenceId;

    /// &lt;summary&gt;Username (Windows username or PIN-authenticated user)&lt;/summary&gt;
    [ObservableProperty]
    private string _username = string.Empty;

    /// &lt;summary&gt;Preferred package type: &quot;Package&quot; or &quot;Pallet&quot;&lt;/summary&gt;
    [ObservableProperty]
    private string _preferredPackageType = &quot;Package&quot;;

    /// &lt;summary&gt;Timestamp when preference was last updated&lt;/summary&gt;
    [ObservableProperty]
    private DateTime _lastUpdated;

    /// &lt;summary&gt;Workstation identifier (for shared terminals)&lt;/summary&gt;
    [ObservableProperty]
    private string _workstation = string.Empty;

    /// &lt;summary&gt;Default general mode&lt;/summary&gt;
    [ObservableProperty]
    private string? _defaultMode;

    /// &lt;summary&gt;Default receiving workflow mode&lt;/summary&gt;
    [ObservableProperty]
    private string? _defaultReceivingMode;

    /// &lt;summary&gt;Default dunnage workflow mode&lt;/summary&gt;
    [ObservableProperty]
    private string? _defaultDunnageMode;
}</file><file path="Module_Receiving/Models/Model_WorkflowStepResult.cs">using MTM_Receiving_Application.Module_Dunnage.Enums;

namespace MTM_Receiving_Application.Module_Receiving.Models
{
    public class Model_WorkflowStepResult
    {
        public bool IsSuccess { get; set; }
        public string ErrorMessage { get; set; } = string.Empty;
        public Enum_DunnageWorkflowStep? TargetStep { get; set; }
    }
}</file><file path="Module_Receiving/Views/View_Receiving_EditMode.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_EditMode&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    xmlns:viewmodels=&quot;using:MTM_Receiving_Application.Module_Receiving.ViewModels&quot;
    xmlns:enums=&quot;using:MTM_Receiving_Application.Module_Core.Models.Enums&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;
    x:Name=&quot;Root&quot;&gt;

    &lt;UserControl.Resources&gt;
        &lt;converters:Converter_DecimalToString x:Key=&quot;DecimalToStringConverter&quot;/&gt;
    &lt;/UserControl.Resources&gt;

    &lt;Grid&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Toolbar --&gt;
        &lt;Grid Grid.Row=&quot;0&quot; Margin=&quot;0,0,0,12&quot;&gt;
            &lt;!-- Main Toolbar Area --&gt;
            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot; VerticalAlignment=&quot;Center&quot;&gt;
                &lt;!-- Load Data Section --&gt;
                &lt;TextBlock Text=&quot;Load Data From:&quot; VerticalAlignment=&quot;Center&quot; FontWeight=&quot;SemiBold&quot; Margin=&quot;0,0,4,0&quot;/&gt;
                
                &lt;Button Command=&quot;{x:Bind ViewModel.LoadFromCurrentMemoryCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.LoadSessionMemory&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE8A7;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Current Memory&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.LoadFromCurrentLabelsCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.LoadRecentCSV&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE8E5;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Current Labels&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.LoadFromHistoryCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.LoadHistoricalData&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE74C;&quot;/&gt;
                        &lt;TextBlock Text=&quot;History&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;

                &lt;!-- Separator --&gt;
                &lt;Rectangle Width=&quot;1&quot; Height=&quot;24&quot; Fill=&quot;{ThemeResource SystemControlForegroundBaseLowBrush}&quot; Margin=&quot;8,0&quot;/&gt;

                &lt;!-- Edit Actions Section --&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.SelectAllCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.SelectAll&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE8B3;&quot;/&gt;
                        &lt;TextBlock Text=&quot;{x:Bind ViewModel.SelectAllButtonText, Mode=OneWay}&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.RemoveRowCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.RemoveRow&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE74D;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Remove Row&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;

        &lt;!-- Date Filter Toolbar --&gt;
        &lt;Grid Grid.Row=&quot;1&quot; Margin=&quot;0,0,0,12&quot;&gt;
            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot; VerticalAlignment=&quot;Center&quot;&gt;
                &lt;TextBlock Text=&quot;Filter Date:&quot; VerticalAlignment=&quot;Center&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                
                &lt;CalendarDatePicker Date=&quot;{x:Bind ViewModel.FilterStartDate, Mode=TwoWay}&quot; 
                                   PlaceholderText=&quot;{x:Bind ViewModel.GetPlaceholder(&apos;Field.StartDate&apos;), Mode=OneWay}&quot;
                                   Width=&quot;140&quot;/&gt;
                &lt;TextBlock Text=&quot;to&quot; VerticalAlignment=&quot;Center&quot;/&gt;
                &lt;CalendarDatePicker Date=&quot;{x:Bind ViewModel.FilterEndDate, Mode=TwoWay}&quot; 
                                   PlaceholderText=&quot;{x:Bind ViewModel.GetPlaceholder(&apos;Field.EndDate&apos;), Mode=OneWay}&quot;
                                   Width=&quot;140&quot;/&gt;
                
                &lt;Rectangle Width=&quot;1&quot; Height=&quot;24&quot; Fill=&quot;{ThemeResource SystemControlForegroundBaseLowBrush}&quot; Margin=&quot;8,0&quot;/&gt;
                
                &lt;Button Content=&quot;Last Week&quot; Command=&quot;{x:Bind ViewModel.SetFilterLastWeekCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.FilterLastWeek&apos;), Mode=OneWay}&quot;/&gt;
                &lt;Button Content=&quot;Today&quot; Command=&quot;{x:Bind ViewModel.SetFilterTodayCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.FilterToday&apos;), Mode=OneWay}&quot;/&gt;
                &lt;Button Content=&quot;This Week&quot; Command=&quot;{x:Bind ViewModel.SetFilterThisWeekCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.FilterThisWeek&apos;), Mode=OneWay}&quot;/&gt;
                &lt;Button Content=&quot;{x:Bind ViewModel.ThisMonthButtonText, Mode=OneWay}&quot; Command=&quot;{x:Bind ViewModel.SetFilterThisMonthCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.FilterThisMonth&apos;), Mode=OneWay}&quot;/&gt;
                &lt;Button Content=&quot;{x:Bind ViewModel.ThisQuarterButtonText, Mode=OneWay}&quot; Command=&quot;{x:Bind ViewModel.SetFilterThisQuarterCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.FilterThisQuarter&apos;), Mode=OneWay}&quot;/&gt;
                &lt;Button Content=&quot;Show All&quot; Command=&quot;{x:Bind ViewModel.SetFilterShowAllCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.ClearFilters&apos;), Mode=OneWay}&quot;/&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;

        &lt;!-- Data Grid --&gt;
        &lt;controls:DataGrid Grid.Row=&quot;2&quot;
                          x:Name=&quot;EditModeDataGrid&quot;
                          ItemsSource=&quot;{x:Bind ViewModel.Loads, Mode=OneWay}&quot;
                          SelectedItem=&quot;{x:Bind ViewModel.SelectedLoad, Mode=TwoWay}&quot;
                          AutoGenerateColumns=&quot;False&quot;
                          IsReadOnly=&quot;False&quot;
                          CanUserSortColumns=&quot;True&quot;
                          GridLinesVisibility=&quot;All&quot;
                          HeadersVisibility=&quot;Column&quot;
                          SelectionMode=&quot;Single&quot;
                          KeyDown=&quot;EditModeDataGrid_KeyDown&quot;
                          CurrentCellChanged=&quot;EditModeDataGrid_CurrentCellChanged&quot;
                          Tapped=&quot;EditModeDataGrid_Tapped&quot;&gt;
            &lt;controls:DataGrid.Columns&gt;
                &lt;controls:DataGridTemplateColumn Header=&quot;&quot; Width=&quot;50&quot; CanUserResize=&quot;False&quot;&gt;
                    &lt;controls:DataGridTemplateColumn.CellTemplate&gt;
                        &lt;DataTemplate&gt;
                            &lt;CheckBox IsChecked=&quot;{Binding IsSelected, Mode=TwoWay}&quot; 
                                      HorizontalAlignment=&quot;Center&quot; 
                                      VerticalAlignment=&quot;Center&quot;
                                      MinWidth=&quot;0&quot;
                                      Margin=&quot;0&quot;/&gt;
                        &lt;/DataTemplate&gt;
                    &lt;/controls:DataGridTemplateColumn.CellTemplate&gt;
                &lt;/controls:DataGridTemplateColumn&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Load #&quot; Binding=&quot;{Binding LoadNumber}&quot; IsReadOnly=&quot;True&quot; Width=&quot;Auto&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Part ID&quot; Binding=&quot;{Binding PartID}&quot; Width=&quot;*&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Weight/Qty&quot; Binding=&quot;{Binding WeightQuantity, Converter={StaticResource DecimalToStringConverter}}&quot; Width=&quot;Auto&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Heat/Lot&quot; Binding=&quot;{Binding HeatLotNumber}&quot; Width=&quot;Auto&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Pkg Type&quot; Binding=&quot;{Binding PackageType}&quot; IsReadOnly=&quot;True&quot; Width=&quot;Auto&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Pkgs/Load&quot; Binding=&quot;{Binding PackagesPerLoad}&quot; Width=&quot;Auto&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Wt/Pkg&quot; Binding=&quot;{Binding WeightPerPackage, Converter={StaticResource DecimalToStringConverter}}&quot; IsReadOnly=&quot;True&quot; Width=&quot;Auto&quot;/&gt;
            &lt;/controls:DataGrid.Columns&gt;
        &lt;/controls:DataGrid&gt;

        &lt;!-- Footer: Pagination and Save --&gt;
        &lt;Grid Grid.Row=&quot;3&quot; Margin=&quot;0,12,0,0&quot;&gt;
            &lt;Grid.ColumnDefinitions&gt;
                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
            &lt;/Grid.ColumnDefinitions&gt;

            &lt;!-- Pagination Controls --&gt;
            &lt;StackPanel Grid.Column=&quot;0&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot; VerticalAlignment=&quot;Center&quot;&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.FirstPageCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.FirstPage&apos;), Mode=OneWay}&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE892;&quot;/&gt;
                &lt;/Button&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.PreviousPageCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.PreviousPage&apos;), Mode=OneWay}&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE76B;&quot;/&gt;
                &lt;/Button&gt;
                
                &lt;Rectangle Width=&quot;1&quot; Height=&quot;24&quot; Fill=&quot;{ThemeResource SystemControlForegroundBaseLowBrush}&quot; Margin=&quot;8,0&quot;/&gt;
                
                &lt;TextBlock Text=&quot;Page&quot; VerticalAlignment=&quot;Center&quot;/&gt;
                &lt;TextBox Text=&quot;{x:Bind ViewModel.GotoPageNumber, Mode=TwoWay}&quot; Width=&quot;60&quot; HorizontalContentAlignment=&quot;Center&quot;/&gt;
                &lt;TextBlock Text=&quot;of&quot; VerticalAlignment=&quot;Center&quot;/&gt;
                &lt;TextBlock Text=&quot;{x:Bind ViewModel.TotalPages, Mode=OneWay}&quot; VerticalAlignment=&quot;Center&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                
                &lt;Button Content=&quot;Go&quot; Command=&quot;{x:Bind ViewModel.GoToPageCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.GoToPage&apos;), Mode=OneWay}&quot;/&gt;
                
                &lt;Rectangle Width=&quot;1&quot; Height=&quot;24&quot; Fill=&quot;{ThemeResource SystemControlForegroundBaseLowBrush}&quot; Margin=&quot;8,0&quot;/&gt;
                
                &lt;Button Command=&quot;{x:Bind ViewModel.NextPageCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.NextPage&apos;), Mode=OneWay}&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE76C;&quot;/&gt;
                &lt;/Button&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.LastPageCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.LastPage&apos;), Mode=OneWay}&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE893;&quot;/&gt;
                &lt;/Button&gt;
            &lt;/StackPanel&gt;

            &lt;!-- Save Button --&gt;
            &lt;StackPanel Grid.Column=&quot;1&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot;&gt;
                &lt;Button Content=&quot;Save &amp;amp; Finish&quot; Command=&quot;{x:Bind ViewModel.SaveCommand}&quot; Style=&quot;{StaticResource AccentButtonStyle}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.SaveAndFinish&apos;), Mode=OneWay}&quot;/&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Receiving/Views/View_Receiving_EditMode.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Receiving.ViewModels;
using Microsoft.UI.Xaml.Input;
using Microsoft.UI.Input;
using Windows.System;
using Windows.UI.Core;
using CommunityToolkit.WinUI.UI.Controls;
using System.Linq;
using System.Collections;
using System;
using System.Diagnostics;

namespace MTM_Receiving_Application.Module_Receiving.Views
{
    public sealed partial class View_Receiving_EditMode : UserControl
    {
        public ViewModel_Receiving_EditMode ViewModel { get; }

        public View_Receiving_EditMode()
        {
            ViewModel = App.GetService&lt;ViewModel_Receiving_EditMode&gt;();
            this.DataContext = ViewModel;
            this.InitializeComponent();
        }

        private void EditModeDataGrid_CurrentCellChanged(object? sender, EventArgs e)
        {
            var grid = sender as DataGrid;
            // Wait for the move to complete then activate edit mode
            grid?.DispatcherQueue.TryEnqueue(() =&gt;
            {
                if (grid.CurrentColumn?.IsReadOnly == false)
                {
                    Debug.WriteLine($&quot;[EditModeView] CurrentCellChanged: BeginEdit for Row={grid.SelectedIndex}, Col={grid.CurrentColumn.Header}&quot;);
                    grid.BeginEdit();
                }
            });
        }

        private void EditModeDataGrid_KeyDown(object sender, KeyRoutedEventArgs e)
        {
            if (sender is not DataGrid grid)
            {
                return;
            }

            var shiftState = InputKeyboardSource.GetKeyStateForCurrentThread(VirtualKey.Shift);
            bool isShiftDown = (shiftState &amp; CoreVirtualKeyStates.Down) == CoreVirtualKeyStates.Down;

            Debug.WriteLine($&quot;[EditModeView] KeyDown: Key={e.Key}, Shift={isShiftDown}, OriginalSource={e.OriginalSource}, CurrentColumn={grid.CurrentColumn?.Header}&quot;);
        }

        private void EditModeDataGrid_Tapped(object sender, TappedRoutedEventArgs e)
        {
            if (sender is not DataGrid grid)
            {
                return;
            }

            Debug.WriteLine($&quot;[EditModeView] Tapped: OriginalSource={e.OriginalSource}&quot;);

            // Handle selection
            if (grid.SelectedItem == null)
            {
                Debug.WriteLine(&quot;[EditModeView] Tapped: SelectedItem is null (Header or empty space). Selecting first editable cell.&quot;);
                // Header clicked or empty space
                if (grid.ItemsSource is IList list &amp;&amp; list.Count &gt; 0)
                {
                    grid.SelectedIndex = 0;
                    SelectFirstEditableCell(grid);
                }
            }
            else
            {
                // Cell clicked - CurrentCellChanged handles the edit mode if cell changes.
                // But if we tap the SAME cell, CurrentCellChanged might not fire.
                // So we ensure edit mode here too.
                Debug.WriteLine(&quot;[EditModeView] Tapped: Cell clicked. Enqueuing BeginEdit.&quot;);
                grid.DispatcherQueue.TryEnqueue(() =&gt;
                {
                    if (grid.CurrentColumn?.IsReadOnly == false)
                    {
                        Debug.WriteLine($&quot;[EditModeView] Tapped: BeginEdit for Row={grid.SelectedIndex}, Col={grid.CurrentColumn.Header}&quot;);
                        grid.BeginEdit();
                    }
                });
            }
        }

        private void SelectFirstEditableCell(DataGrid grid)
        {
            Debug.WriteLine(&quot;[EditModeView] SelectFirstEditableCell: Starting&quot;);
            if (grid.ItemsSource is IList items &amp;&amp; items.Count &gt; 0)
            {
                // Find first non-readonly column
                var firstEditable = grid.Columns.OrderBy(c =&gt; c.DisplayIndex).FirstOrDefault(c =&gt; !c.IsReadOnly);
                if (firstEditable != null)
                {
                    Debug.WriteLine($&quot;[EditModeView] SelectFirstEditableCell: Found editable column {firstEditable.Header}. Setting CurrentColumn and calling BeginEdit.&quot;);
                    grid.CurrentColumn = firstEditable;
                    grid.Focus(Microsoft.UI.Xaml.FocusState.Programmatic);
                    grid.BeginEdit();
                    Debug.WriteLine($&quot;[EditModeView] SelectFirstEditableCell: BeginEdit called for column {firstEditable.Header}&quot;);
                }
                else
                {
                    Debug.WriteLine(&quot;[EditModeView] SelectFirstEditableCell: No editable column found.&quot;);
                }
            }
            else
            {
                var itemCount = (grid.ItemsSource as IList)?.Count ?? 0;
                Debug.WriteLine($&quot;[EditModeView] SelectFirstEditableCell: Grid has no items (Count={itemCount})&quot;);
            }
        }
    }
}</file><file path="Module_Receiving/Views/View_Receiving_HeatLot.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_HeatLot&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;&gt;

    &lt;UserControl.Resources&gt;
        &lt;converters:Converter_StringFormat x:Key=&quot;StringFormatConverter&quot;/&gt;
        &lt;converters:Converter_IntToVisibility x:Key=&quot;IntToVisibilityConverter&quot;/&gt;
    &lt;/UserControl.Resources&gt;

    &lt;Grid Padding=&quot;16&quot;&gt;
        &lt;!-- Content Section --&gt;
        &lt;Grid&gt;
            &lt;StackPanel Spacing=&quot;16&quot;&gt;
                &lt;Grid&gt;
                    &lt;Grid.ColumnDefinitions&gt;
                        &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                        &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                    &lt;/Grid.ColumnDefinitions&gt;
                    &lt;TextBlock Text=&quot;Load Entries&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; VerticalAlignment=&quot;Center&quot;/&gt;
                    &lt;Button Grid.Column=&quot;1&quot; 
                            Content=&quot;Auto-Fill&quot; 
                            Command=&quot;{x:Bind ViewModel.AutoFillCommand}&quot;
                            Style=&quot;{StaticResource AccentButtonStyle}&quot;
                            ToolTipService.ToolTip=&quot;Fill blank heat numbers from rows above&quot;/&gt;
                &lt;/Grid&gt;
            
                &lt;ScrollViewer VerticalScrollBarVisibility=&quot;Auto&quot; MaxHeight=&quot;500&quot;&gt;
                    &lt;ItemsControl ItemsSource=&quot;{x:Bind ViewModel.Loads, Mode=OneWay}&quot;&gt;
                        &lt;ItemsControl.ItemTemplate&gt;
                            &lt;DataTemplate&gt;
                                &lt;Border Margin=&quot;0,0,0,12&quot; 
                                       Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot; 
                                       Padding=&quot;16&quot; 
                                       CornerRadius=&quot;8&quot; 
                                       BorderThickness=&quot;1&quot; 
                                       BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;&gt;
                                    &lt;Grid ColumnSpacing=&quot;16&quot;&gt;
                                        &lt;Grid.ColumnDefinitions&gt;
                                            &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                                            &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                                        &lt;/Grid.ColumnDefinitions&gt;
                                        
                                        &lt;StackPanel Grid.Column=&quot;0&quot; VerticalAlignment=&quot;Center&quot; Width=&quot;100&quot;&gt;
                                            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                                &lt;FontIcon Glyph=&quot;&amp;#xE7B8;&quot; 
                                                         FontSize=&quot;16&quot;
                                                         Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                                                &lt;TextBlock Text=&quot;{Binding LoadNumber, Converter={StaticResource StringFormatConverter}, ConverterParameter=&apos;Load #{0}&apos;}&quot; 
                                                          Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                                            &lt;/StackPanel&gt;
                                        &lt;/StackPanel&gt;
                                        
                                        &lt;TextBox Grid.Column=&quot;1&quot;
                                                Header=&quot;Heat/Lot Number (Optional)&quot;
                                                Text=&quot;{Binding HeatLotNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}&quot;
                                                PlaceholderText=&quot;Enter heat/lot number or leave blank&quot;
                                                AutomationProperties.Name=&quot;Heat Lot Number&quot;/&gt;
                                    &lt;/Grid&gt;
                                &lt;/Border&gt;
                            &lt;/DataTemplate&gt;
                        &lt;/ItemsControl.ItemTemplate&gt;
                    &lt;/ItemsControl&gt;
                &lt;/ScrollViewer&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Receiving/Views/View_Receiving_HeatLot.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.ViewModels;

namespace MTM_Receiving_Application.Module_Receiving.Views
{
    public sealed partial class View_Receiving_HeatLot : UserControl
    {
        public ViewModel_Receiving_HeatLot ViewModel { get; }
        private readonly IService_Focus _focusService;

        public View_Receiving_HeatLot()
        {
            ViewModel = App.GetService&lt;ViewModel_Receiving_HeatLot&gt;();
            _focusService = App.GetService&lt;IService_Focus&gt;();
            this.InitializeComponent();

            this.Loaded += HeatLotView_Loaded;
            _focusService.AttachFocusOnVisibility(this);
        }

        private async void HeatLotView_Loaded(object sender, RoutedEventArgs e)
        {
            await ViewModel.OnNavigatedToAsync();
        }
    }
}</file><file path="Module_Receiving/Views/View_Receiving_LoadEntry.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_LoadEntry&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    mc:Ignorable=&quot;d&quot;&gt;

    &lt;Grid HorizontalAlignment=&quot;Center&quot; VerticalAlignment=&quot;Center&quot;&gt;
        &lt;Border Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                BorderThickness=&quot;1&quot;
                CornerRadius=&quot;8&quot;
                Padding=&quot;32&quot;
                MinWidth=&quot;500&quot;&gt;
            &lt;StackPanel Spacing=&quot;24&quot; HorizontalAlignment=&quot;Center&quot;&gt;
                &lt;StackPanel Spacing=&quot;8&quot; HorizontalAlignment=&quot;Center&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE7B8;&quot; 
                             FontSize=&quot;48&quot;
                             Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;
                             HorizontalAlignment=&quot;Center&quot;/&gt;
                    &lt;TextBlock Text=&quot;{x:Bind ViewModel.SelectedPartInfo, Mode=OneWay}&quot; 
                               Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;
                               Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;
                               HorizontalAlignment=&quot;Center&quot;
                               TextAlignment=&quot;Center&quot;/&gt;
                &lt;/StackPanel&gt;

                &lt;NumberBox x:Name=&quot;NumberOfLoadsNumberBox&quot;
                           Header=&quot;Number of Loads (1-99)&quot;
                           Value=&quot;{x:Bind ViewModel.NumberOfLoads, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}&quot;
                           Minimum=&quot;1&quot;
                           Maximum=&quot;99&quot;
                           SmallChange=&quot;1&quot;
                           LargeChange=&quot;10&quot;
                           SpinButtonPlacementMode=&quot;Inline&quot;
                           Width=&quot;250&quot;
                           HorizontalAlignment=&quot;Center&quot;
                           AutomationProperties.Name=&quot;Number of Loads&quot;/&gt;
                       
                &lt;TextBlock Text=&quot;Enter the total number of skids/loads for this part.&quot; 
                           Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                           Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                           HorizontalAlignment=&quot;Center&quot;
                           TextAlignment=&quot;Center&quot;/&gt;
            &lt;/StackPanel&gt;
        &lt;/Border&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Receiving/Views/View_Receiving_LoadEntry.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.ViewModels;
using Microsoft.UI.Xaml;

namespace MTM_Receiving_Application.Module_Receiving.Views
{
    public sealed partial class View_Receiving_LoadEntry : UserControl
    {
        public ViewModel_Receiving_LoadEntry ViewModel { get; }
        private readonly IService_Focus _focusService;

        public View_Receiving_LoadEntry()
        {
            ViewModel = App.GetService&lt;ViewModel_Receiving_LoadEntry&gt;();
            _focusService = App.GetService&lt;IService_Focus&gt;();
            this.InitializeComponent();

            _focusService.AttachFocusOnVisibility(this, NumberOfLoadsNumberBox);
        }
    }
}</file><file path="Module_Receiving/Views/View_Receiving_ManualEntry.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_ManualEntry&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    xmlns:viewmodels=&quot;using:MTM_Receiving_Application.Module_Receiving.ViewModels&quot;
    xmlns:enums=&quot;using:MTM_Receiving_Application.Module_Core.Models.Enums&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;
    x:Name=&quot;Root&quot;&gt;

    &lt;UserControl.Resources&gt;
        &lt;converters:Converter_DecimalToString x:Key=&quot;DecimalToStringConverter&quot;/&gt;
    &lt;/UserControl.Resources&gt;

    &lt;Grid&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Toolbar --&gt;
        &lt;Grid Grid.Row=&quot;0&quot; Margin=&quot;0,0,0,12&quot;&gt;
            &lt;Grid.ColumnDefinitions&gt;
                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
            &lt;/Grid.ColumnDefinitions&gt;
            
            &lt;StackPanel Grid.Column=&quot;0&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot;&gt;
                &lt;Button x:Name=&quot;AddRowButton&quot; Command=&quot;{x:Bind ViewModel.AddRowCommand}&quot; Style=&quot;{StaticResource AccentButtonStyle}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.AddRow&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE710;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Add Row&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.AddMultipleRowsCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.AddMultipleRows&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE710;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Add Multiple&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.RemoveRowCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.RemoveRow&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE74D;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Remove Row&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
                &lt;Button Command=&quot;{x:Bind ViewModel.AutoFillCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.AutoFill&apos;), Mode=OneWay}&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE74E;&quot;/&gt;
                        &lt;TextBlock Text=&quot;Auto-Fill&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/Button&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;

        &lt;!-- Data Grid --&gt;
        &lt;controls:DataGrid Grid.Row=&quot;1&quot;
                          x:Name=&quot;ManualEntryDataGrid&quot;
                          ItemsSource=&quot;{x:Bind ViewModel.Loads, Mode=OneWay}&quot;
                          SelectedItem=&quot;{x:Bind ViewModel.SelectedLoad, Mode=TwoWay}&quot;
                          AutoGenerateColumns=&quot;False&quot;
                          IsReadOnly=&quot;False&quot;
                          CanUserSortColumns=&quot;True&quot;
                          GridLinesVisibility=&quot;All&quot;
                          HeadersVisibility=&quot;Column&quot;
                          SelectionMode=&quot;Single&quot;
                          KeyDown=&quot;ManualEntryDataGrid_KeyDown&quot;
                          CurrentCellChanged=&quot;ManualEntryDataGrid_CurrentCellChanged&quot;
                          Tapped=&quot;ManualEntryDataGrid_Tapped&quot;&gt;
            &lt;controls:DataGrid.Columns&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Load #&quot; Binding=&quot;{Binding LoadNumber}&quot; IsReadOnly=&quot;True&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Part ID&quot; Binding=&quot;{Binding PartID}&quot; Width=&quot;*&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Weight/Qty&quot; Binding=&quot;{Binding WeightQuantity, Converter={StaticResource DecimalToStringConverter}}&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Heat/Lot&quot; Binding=&quot;{Binding HeatLotNumber}&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Pkg Type&quot; Binding=&quot;{Binding PackageType}&quot; IsReadOnly=&quot;True&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Pkgs/Load&quot; Binding=&quot;{Binding PackagesPerLoad}&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Wt/Pkg&quot; Binding=&quot;{Binding WeightPerPackage, Converter={StaticResource DecimalToStringConverter}}&quot; IsReadOnly=&quot;True&quot;/&gt;
            &lt;/controls:DataGrid.Columns&gt;
        &lt;/controls:DataGrid&gt;

        &lt;!-- Navigation --&gt;
        &lt;StackPanel Grid.Row=&quot;2&quot; Orientation=&quot;Horizontal&quot; HorizontalAlignment=&quot;Right&quot; Margin=&quot;0,12,0,0&quot; Spacing=&quot;12&quot;&gt;
            &lt;Button Content=&quot;Save &amp;amp; Finish&quot; Command=&quot;{x:Bind ViewModel.SaveCommand}&quot; Style=&quot;{StaticResource AccentButtonStyle}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.SaveAndFinish&apos;), Mode=OneWay}&quot;/&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Receiving/Views/View_Receiving_ModeSelection.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_ModeSelection&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:viewmodels=&quot;using:MTM_Receiving_Application.Module_Receiving.ViewModels&quot;
    mc:Ignorable=&quot;d&quot;&gt;

    &lt;Grid&gt;
        &lt;StackPanel Spacing=&quot;32&quot; HorizontalAlignment=&quot;Center&quot; VerticalAlignment=&quot;Center&quot;&gt;
            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;24&quot;&gt;
                &lt;!-- Guided Mode Column --&gt;
                &lt;StackPanel Spacing=&quot;12&quot;&gt;
                    &lt;Button Command=&quot;{x:Bind ViewModel.SelectGuidedModeCommand}&quot;
                            Width=&quot;280&quot; Height=&quot;180&quot;
                            Padding=&quot;20&quot;
                            Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                            BorderThickness=&quot;1&quot;
                            CornerRadius=&quot;8&quot;
                            AutomationProperties.Name=&quot;Guided Wizard Mode&quot;&gt;
                        &lt;StackPanel Spacing=&quot;12&quot;&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE771;&quot; FontSize=&quot;48&quot; Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                            &lt;TextBlock Text=&quot;Guided Wizard&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; HorizontalAlignment=&quot;Center&quot;/&gt;
                            &lt;TextBlock Text=&quot;Step-by-step process for standard receiving workflow.&quot; 
                                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot; 
                                       TextWrapping=&quot;Wrap&quot; 
                                       TextAlignment=&quot;Center&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Button&gt;
                    
                    &lt;!-- Guided Mode Checkbox --&gt;
                    &lt;CheckBox Content=&quot;Set as default mode&quot;
                              IsChecked=&quot;{x:Bind ViewModel.IsGuidedModeDefault, Mode=TwoWay}&quot;
                              Command=&quot;{x:Bind ViewModel.SetGuidedAsDefaultCommand}&quot;
                              CommandParameter=&quot;{Binding IsChecked, RelativeSource={RelativeSource Self}}&quot;
                              HorizontalAlignment=&quot;Center&quot;
                              ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.QuickGuidedWizard&apos;), Mode=OneWay}&quot;/&gt;
                &lt;/StackPanel&gt;

                &lt;!-- Manual Mode Column --&gt;
                &lt;StackPanel Spacing=&quot;12&quot;&gt;
                    &lt;Button Command=&quot;{x:Bind ViewModel.SelectManualModeCommand}&quot;
                            Width=&quot;280&quot; Height=&quot;180&quot;
                            Padding=&quot;20&quot;
                            Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                            BorderThickness=&quot;1&quot;
                            CornerRadius=&quot;8&quot;
                            AutomationProperties.Name=&quot;Manual Entry Mode&quot;&gt;
                        &lt;StackPanel Spacing=&quot;12&quot;&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE7F0;&quot; FontSize=&quot;48&quot; Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                            &lt;TextBlock Text=&quot;Manual Entry&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; HorizontalAlignment=&quot;Center&quot;/&gt;
                            &lt;TextBlock Text=&quot;Customizable grid for bulk data entry and editing.&quot; 
                                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot; 
                                       TextWrapping=&quot;Wrap&quot; 
                                       TextAlignment=&quot;Center&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Button&gt;
                    
                    &lt;!-- Manual Mode Checkbox --&gt;
                    &lt;CheckBox Content=&quot;Set as default mode&quot;
                              IsChecked=&quot;{x:Bind ViewModel.IsManualModeDefault, Mode=TwoWay}&quot;
                              Command=&quot;{x:Bind ViewModel.SetManualAsDefaultCommand}&quot;
                              CommandParameter=&quot;{Binding IsChecked, RelativeSource={RelativeSource Self}}&quot;
                              HorizontalAlignment=&quot;Center&quot;
                              ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.QuickManualEntry&apos;), Mode=OneWay}&quot;/&gt;
                &lt;/StackPanel&gt;

                &lt;!-- Edit Mode Column --&gt;
                &lt;StackPanel Spacing=&quot;12&quot;&gt;
                    &lt;Button Command=&quot;{x:Bind ViewModel.SelectEditModeCommand}&quot;
                            Width=&quot;280&quot; Height=&quot;180&quot;
                            Padding=&quot;20&quot;
                            Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                            BorderThickness=&quot;1&quot;
                            CornerRadius=&quot;8&quot;
                            AutomationProperties.Name=&quot;Edit Mode&quot;&gt;
                        &lt;StackPanel Spacing=&quot;12&quot;&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE70F;&quot; FontSize=&quot;48&quot; Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                            &lt;TextBlock Text=&quot;Edit Mode&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; HorizontalAlignment=&quot;Center&quot;/&gt;
                            &lt;TextBlock Text=&quot;Edit existing loads without adding new ones.&quot; 
                                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot; 
                                       TextWrapping=&quot;Wrap&quot; 
                                       TextAlignment=&quot;Center&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Button&gt;
                    
                    &lt;!-- Edit Mode Checkbox --&gt;
                    &lt;CheckBox Content=&quot;Set as default mode&quot;
                              IsChecked=&quot;{x:Bind ViewModel.IsEditModeDefault, Mode=TwoWay}&quot;
                              Command=&quot;{x:Bind ViewModel.SetEditAsDefaultCommand}&quot;
                              CommandParameter=&quot;{Binding IsChecked, RelativeSource={RelativeSource Self}}&quot;
                              HorizontalAlignment=&quot;Center&quot;
                              ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.QuickEditMode&apos;), Mode=OneWay}&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/StackPanel&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Receiving/Views/View_Receiving_ModeSelection.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Receiving.ViewModels;

namespace MTM_Receiving_Application.Module_Receiving.Views
{
    public sealed partial class View_Receiving_ModeSelection : UserControl
    {
        public ViewModel_Receiving_ModeSelection ViewModel { get; }

        public View_Receiving_ModeSelection()
        {
            ViewModel = App.GetService&lt;ViewModel_Receiving_ModeSelection&gt;();
            this.InitializeComponent();
        }
    }
}</file><file path="Module_Receiving/Views/View_Receiving_PackageType.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_PackageType&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;&gt;

    &lt;UserControl.Resources&gt;
        &lt;converters:Converter_StringFormat x:Key=&quot;StringFormatConverter&quot;/&gt;
        &lt;converters:Converter_BooleanToVisibility x:Key=&quot;BooleanToVisibilityConverter&quot;/&gt;
    &lt;/UserControl.Resources&gt;

    &lt;Grid Padding=&quot;20&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;
        
        &lt;!-- Package Type Selection --&gt;
        &lt;Border Grid.Row=&quot;1&quot;
                Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                BorderThickness=&quot;1&quot;
                Padding=&quot;20&quot;
                CornerRadius=&quot;8&quot;
                VerticalAlignment=&quot;Top&quot;
                Margin=&quot;0,0,0,16&quot;&gt;
            &lt;StackPanel Spacing=&quot;16&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE7B8;&quot; FontSize=&quot;16&quot; Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                    &lt;TextBlock Text=&quot;Package Type (Applied to all loads)&quot; Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                &lt;/StackPanel&gt;
                
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;16&quot;&gt;
                    &lt;ComboBox x:Name=&quot;PackageTypeComboBox&quot;
                              Header=&quot;Type&quot;
                              ItemsSource=&quot;{x:Bind ViewModel.PackageTypes, Mode=OneWay}&quot;
                              SelectedItem=&quot;{x:Bind ViewModel.SelectedPackageType, Mode=TwoWay}&quot;
                              Width=&quot;200&quot;
                              AutomationProperties.Name=&quot;Package Type&quot;/&gt;
                    
                    &lt;TextBox Header=&quot;Custom Name&quot;
                             Text=&quot;{x:Bind ViewModel.CustomPackageTypeName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}&quot;
                             Visibility=&quot;{x:Bind ViewModel.IsCustomTypeVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;
                             Width=&quot;200&quot;
                             AutomationProperties.Name=&quot;Custom Package Name&quot;/&gt;
                &lt;/StackPanel&gt;
                
                &lt;CheckBox Content=&quot;Save as default for this part&quot; 
                          IsChecked=&quot;{x:Bind ViewModel.IsSaveAsDefault, Mode=TwoWay}&quot;/&gt;
            &lt;/StackPanel&gt;
        &lt;/Border&gt;

        &lt;!-- Loads List --&gt;
        &lt;ScrollViewer Grid.Row=&quot;2&quot; VerticalScrollBarVisibility=&quot;Auto&quot;&gt;
            &lt;ItemsControl ItemsSource=&quot;{x:Bind ViewModel.Loads, Mode=OneWay}&quot;&gt;
                &lt;ItemsControl.ItemTemplate&gt;
                    &lt;DataTemplate&gt;
                        &lt;Grid Margin=&quot;0,0,0,8&quot; Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot; Padding=&quot;16,12&quot; CornerRadius=&quot;8&quot; BorderThickness=&quot;1&quot; BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;100&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;250&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            
                            &lt;StackPanel Grid.Column=&quot;0&quot; VerticalAlignment=&quot;Center&quot;&gt;
                                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                    &lt;FontIcon Glyph=&quot;&amp;#xE7B8;&quot; FontSize=&quot;14&quot; Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                                    &lt;TextBlock Text=&quot;{Binding LoadNumber, Converter={StaticResource StringFormatConverter}, ConverterParameter=&apos;#{0}&apos;}&quot; 
                                               Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                                &lt;/StackPanel&gt;
                            &lt;/StackPanel&gt;
                            
                            &lt;NumberBox Grid.Column=&quot;1&quot;
                                       Header=&quot;Packages per Load&quot;
                                       Value=&quot;{Binding PackagesPerLoad, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}&quot;
                                       Minimum=&quot;1&quot;
                                       SmallChange=&quot;1&quot;
                                       LargeChange=&quot;5&quot;
                                       SpinButtonPlacementMode=&quot;Inline&quot;
                                       AutomationProperties.Name=&quot;Packages per Load&quot;/&gt;
                                       
                            &lt;StackPanel Grid.Column=&quot;2&quot; VerticalAlignment=&quot;Center&quot; Margin=&quot;16,0,0,0&quot;&gt;
                                &lt;TextBlock Text=&quot;Weight per Package&quot; Style=&quot;{StaticResource CaptionTextBlockStyle}&quot; Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                                &lt;TextBlock Text=&quot;{Binding WeightPerPackage, Converter={StaticResource StringFormatConverter}, ConverterParameter=&apos;{}{0:N2} lbs&apos;}&quot; 
                                           Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                            &lt;/StackPanel&gt;
                        &lt;/Grid&gt;
                    &lt;/DataTemplate&gt;
                &lt;/ItemsControl.ItemTemplate&gt;
            &lt;/ItemsControl&gt;
        &lt;/ScrollViewer&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Receiving/Views/View_Receiving_PackageType.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.ViewModels;

namespace MTM_Receiving_Application.Module_Receiving.Views
{
    public sealed partial class View_Receiving_PackageType : UserControl
    {
        public ViewModel_Receiving_PackageType ViewModel { get; }
        private readonly IService_Focus _focusService;

        public View_Receiving_PackageType()
        {
            ViewModel = App.GetService&lt;ViewModel_Receiving_PackageType&gt;();
            _focusService = App.GetService&lt;IService_Focus&gt;();
            this.InitializeComponent();

            this.Loaded += PackageTypeView_Loaded;
            _focusService.AttachFocusOnVisibility(this, PackageTypeComboBox);
        }

        private async void PackageTypeView_Loaded(object sender, RoutedEventArgs e)
        {
            await ViewModel.OnNavigatedToAsync();
        }
    }
}</file><file path="Module_Receiving/Views/View_Receiving_POEntry.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_POEntry&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;&gt;

    &lt;UserControl.Resources&gt;
        &lt;converters:Converter_BooleanToVisibility x:Key=&quot;BooleanToVisibilityConverter&quot;/&gt;
        &lt;converters:Converter_DecimalToInt x:Key=&quot;DecimalToIntConverter&quot;/&gt;
    &lt;/UserControl.Resources&gt;

    &lt;Grid Padding=&quot;24&quot; RowSpacing=&quot;20&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Input Section (Row 0) --&gt;
        &lt;Grid Grid.Row=&quot;0&quot;&gt;
            &lt;!-- PO Entry Mode --&gt;
            &lt;StackPanel Visibility=&quot;{x:Bind ViewModel.IsNonPOItem, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}&quot;&gt;
                &lt;Border Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                        BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                        BorderThickness=&quot;1&quot;
                        CornerRadius=&quot;8&quot;
                        Padding=&quot;20&quot;&gt;
                    &lt;StackPanel Spacing=&quot;16&quot;&gt;
                        &lt;!-- PO Number Input with Icon --&gt;
                        &lt;StackPanel Spacing=&quot;8&quot;&gt;
                            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                &lt;FontIcon Glyph=&quot;&amp;#xE8A5;&quot; 
                                         FontSize=&quot;16&quot;
                                         Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                                &lt;TextBlock Text=&quot;Purchase Order Number&quot; 
                                          Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot;/&gt;
                            &lt;/StackPanel&gt;
                            
                            &lt;TextBox x:Name=&quot;PoNumberTextBox&quot;
                                    Text=&quot;{x:Bind ViewModel.PoNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}&quot; 
                                    PlaceholderText=&quot;{x:Bind ViewModel.GetPlaceholder(&apos;Field.PONumber&apos;), Mode=OneWay}&quot;
                                    MaxWidth=&quot;400&quot;
                                    HorizontalAlignment=&quot;Stretch&quot;
                                    TabIndex=&quot;0&quot;
                                    LostFocus=&quot;POTextBox_LostFocus&quot;
                                    AutomationProperties.Name=&quot;Purchase Order Number&quot;/&gt;
                            
                            &lt;!-- Validation Message --&gt;
                            &lt;TextBlock Text=&quot;{x:Bind ViewModel.PoValidationMessage, Mode=OneWay}&quot; 
                                      Foreground=&quot;{ThemeResource SystemFillColorCriticalBrush}&quot;
                                      FontSize=&quot;12&quot;
                                      Visibility=&quot;{x:Bind ViewModel.IsLoadPOEnabled, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}&quot;/&gt;
                            
                            &lt;!-- PO Status Display --&gt;
                            &lt;Border BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                                    BorderThickness=&quot;1&quot;
                                    CornerRadius=&quot;4&quot;
                                    Padding=&quot;8,4&quot;
                                    Margin=&quot;0,8,0,0&quot;
                                    Background=&quot;{ThemeResource CardBackgroundFillColorSecondaryBrush}&quot;&gt;
                                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                    &lt;FontIcon Glyph=&quot;&amp;#xE8C9;&quot; FontSize=&quot;14&quot;/&gt;
                                    &lt;TextBlock Text=&quot;Status:&quot; FontWeight=&quot;SemiBold&quot; FontSize=&quot;12&quot;/&gt;
                                    &lt;TextBlock Text=&quot;{x:Bind ViewModel.PoStatusDescription, Mode=OneWay}&quot; 
                                              FontSize=&quot;12&quot;
                                              FontWeight=&quot;SemiBold&quot;/&gt;
                                &lt;/StackPanel&gt;
                            &lt;/Border&gt;
                        &lt;/StackPanel&gt;

                        &lt;!-- Action Buttons --&gt;
                        &lt;Grid ColumnSpacing=&quot;12&quot;&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            
                            &lt;Button Grid.Column=&quot;0&quot;
                                   Command=&quot;{x:Bind ViewModel.LoadPOCommand}&quot; 
                                   IsEnabled=&quot;{x:Bind ViewModel.IsLoadPOEnabled, Mode=OneWay}&quot;
                                   Style=&quot;{StaticResource AccentButtonStyle}&quot;
                                   AutomationProperties.Name=&quot;Load Purchase Order&quot;
                                   ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.LoadPO&apos;), Mode=OneWay}&quot;&gt;
                                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                    &lt;FontIcon Glyph=&quot;&amp;#xE896;&quot; FontSize=&quot;16&quot;/&gt;
                                    &lt;TextBlock Text=&quot;Load PO&quot;/&gt;
                                &lt;/StackPanel&gt;
                            &lt;/Button&gt;
                            
                            &lt;Button Grid.Column=&quot;1&quot;
                                   Content=&quot;Switch to Non-PO&quot; 
                                   Command=&quot;{x:Bind ViewModel.ToggleNonPOCommand}&quot;
                                   ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.SwitchToNonPO&apos;), Mode=OneWay}&quot;/&gt;
                        &lt;/Grid&gt;
                    &lt;/StackPanel&gt;
                &lt;/Border&gt;
            &lt;/StackPanel&gt;

            &lt;!-- Non-PO Entry Mode --&gt;
            &lt;StackPanel Visibility=&quot;{x:Bind ViewModel.IsNonPOItem, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;&gt;
                &lt;Border Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                        BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                        BorderThickness=&quot;1&quot;
                        CornerRadius=&quot;8&quot;
                        Padding=&quot;20&quot;&gt;
                    &lt;StackPanel Spacing=&quot;16&quot;&gt;
                        &lt;!-- Part ID Input with Icon --&gt;
                        &lt;StackPanel Spacing=&quot;8&quot;&gt;
                            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                &lt;FontIcon Glyph=&quot;&amp;#xE8B7;&quot; 
                                         FontSize=&quot;16&quot;
                                         Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                                &lt;TextBlock Text=&quot;Part Identifier&quot; 
                                          Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot;/&gt;
                            &lt;/StackPanel&gt;
                            
                            &lt;TextBox x:Name=&quot;PartIDTextBox&quot;
                                    Text=&quot;{x:Bind ViewModel.PartID, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}&quot; 
                                    PlaceholderText=&quot;{x:Bind ViewModel.GetPlaceholder(&apos;Field.PartID&apos;), Mode=OneWay}&quot;
                                    MaxWidth=&quot;400&quot;
                                    HorizontalAlignment=&quot;Stretch&quot;
                                    AutomationProperties.Name=&quot;Part Identifier&quot;/&gt;
                        &lt;/StackPanel&gt;

                        &lt;!-- Package Type Display (Auto-detected) --&gt;
                        &lt;StackPanel Spacing=&quot;8&quot;&gt;
                            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                &lt;FontIcon Glyph=&quot;&amp;#xE7B8;&quot; 
                                         FontSize=&quot;16&quot;
                                         Foreground=&quot;{ThemeResource AccentTextFillColorSecondaryBrush}&quot;/&gt;
                                &lt;TextBlock Text=&quot;Package Type (Auto-detected)&quot; 
                                          Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot;/&gt;
                            &lt;/StackPanel&gt;
                            
                            &lt;TextBlock Text=&quot;{x:Bind ViewModel.PackageType, Mode=OneWay}&quot;
                                      Style=&quot;{ThemeResource SubtitleTextBlockStyle}&quot;
                                      Foreground=&quot;{ThemeResource SystemAccentColor}&quot;/&gt;
                        &lt;/StackPanel&gt;

                        &lt;!-- Action Buttons --&gt;
                        &lt;Grid ColumnSpacing=&quot;12&quot;&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            
                            &lt;Button Grid.Column=&quot;0&quot;
                                   Command=&quot;{x:Bind ViewModel.LookupPartCommand}&quot; 
                                   Style=&quot;{StaticResource AccentButtonStyle}&quot;
                                   AutomationProperties.Name=&quot;Look Up Part&quot;
                                   ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.LookupPart&apos;), Mode=OneWay}&quot;&gt;
                                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                    &lt;FontIcon Glyph=&quot;&amp;#xE721;&quot; FontSize=&quot;16&quot;/&gt;
                                    &lt;TextBlock Text=&quot;Look Up Part&quot;/&gt;
                                &lt;/StackPanel&gt;
                            &lt;/Button&gt;
                            
                            &lt;Button Grid.Column=&quot;1&quot;
                                   Content=&quot;Switch to PO Entry&quot; 
                                   Command=&quot;{x:Bind ViewModel.ToggleNonPOCommand}&quot;
                                   ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.SwitchToPO&apos;), Mode=OneWay}&quot;/&gt;
                        &lt;/Grid&gt;
                    &lt;/StackPanel&gt;
                &lt;/Border&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;

        &lt;!-- Loading Indicator --&gt;
        &lt;ProgressBar Grid.Row=&quot;0&quot; 
                    IsIndeterminate=&quot;True&quot; 
                    VerticalAlignment=&quot;Bottom&quot;
                    Visibility=&quot;{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;
                    Margin=&quot;0,0,0,-10&quot;/&gt;

        &lt;!-- Parts Grid Section (Row 1) --&gt;
        &lt;Border Grid.Row=&quot;1&quot; 
                Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                BorderThickness=&quot;1&quot;
                CornerRadius=&quot;8&quot;
                Padding=&quot;16&quot;
                Visibility=&quot;{x:Bind ViewModel.IsPartsListVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;&gt;
            &lt;Grid&gt;
                &lt;Grid.RowDefinitions&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                    &lt;RowDefinition Height=&quot;*&quot;/&gt;
                &lt;/Grid.RowDefinitions&gt;

                &lt;StackPanel Grid.Row=&quot;0&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot; Margin=&quot;0,0,0,12&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE8FD;&quot; 
                             FontSize=&quot;16&quot;
                             Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                    &lt;TextBlock Text=&quot;Available Parts&quot; 
                              Style=&quot;{ThemeResource SubtitleTextBlockStyle}&quot;/&gt;
                &lt;/StackPanel&gt;
                
                &lt;controls:DataGrid Grid.Row=&quot;1&quot;
                                  ItemsSource=&quot;{x:Bind ViewModel.Parts, Mode=OneWay}&quot;
                                  SelectedItem=&quot;{x:Bind ViewModel.SelectedPart, Mode=TwoWay}&quot;
                                  AutoGenerateColumns=&quot;False&quot;
                                  IsReadOnly=&quot;True&quot;
                                  GridLinesVisibility=&quot;Horizontal&quot;
                                  HeadersVisibility=&quot;Column&quot;
                                  SelectionMode=&quot;Single&quot;
                                  AutomationProperties.Name=&quot;Parts List&quot;&gt;
                    &lt;controls:DataGrid.Columns&gt;
                        &lt;controls:DataGridTextColumn Header=&quot;Part ID&quot; 
                                                    Binding=&quot;{Binding PartID}&quot; 
                                                    Width=&quot;150&quot;/&gt;
                        &lt;controls:DataGridTextColumn Header=&quot;Description&quot; 
                                                    Binding=&quot;{Binding Description}&quot; 
                                                    Width=&quot;*&quot;/&gt;
                        &lt;controls:DataGridTextColumn Header=&quot;Remaining Qty&quot; 
                                                    Binding=&quot;{Binding RemainingQuantity}&quot; 
                                                    Width=&quot;120&quot;/&gt;
                        &lt;controls:DataGridTextColumn Header=&quot;Qty Ordered&quot; 
                                                    Binding=&quot;{Binding QtyOrdered, Converter={StaticResource DecimalToIntConverter}}&quot; 
                                                    Width=&quot;120&quot;/&gt;
                        &lt;controls:DataGridTextColumn Header=&quot;Line #&quot; 
                                                    Binding=&quot;{Binding POLineNumber}&quot; 
                                                    Width=&quot;80&quot;/&gt;
                    &lt;/controls:DataGrid.Columns&gt;
                &lt;/controls:DataGrid&gt;
            &lt;/Grid&gt;
        &lt;/Border&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Receiving/Views/View_Receiving_POEntry.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.ViewModels;

namespace MTM_Receiving_Application.Module_Receiving.Views
{
    public sealed partial class View_Receiving_POEntry : UserControl
    {
        public ViewModel_Receiving_POEntry ViewModel { get; }
        private readonly IService_Focus _focusService;

        public View_Receiving_POEntry()
        {
            ViewModel = App.GetService&lt;ViewModel_Receiving_POEntry&gt;();
            _focusService = App.GetService&lt;IService_Focus&gt;();
            this.InitializeComponent();

            _focusService.AttachFocusOnVisibility(this, PoNumberTextBox);
        }

        private void POTextBox_LostFocus(object sender, RoutedEventArgs e)
        {
            // Trigger auto-correction command
            ViewModel.PoTextBoxLostFocusCommand.Execute(null);
        }
    }
}</file><file path="Module_Receiving/Views/View_Receiving_Review.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_Review&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;
    Loaded=&quot;UserControl_Loaded&quot;&gt;

    &lt;UserControl.Resources&gt;
        &lt;converters:Converter_BooleanToVisibility x:Key=&quot;BooleanToVisibilityConverter&quot;/&gt;
    &lt;/UserControl.Resources&gt;

    &lt;Grid Padding=&quot;24&quot; RowSpacing=&quot;16&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Content Section with View Toggle --&gt;
        &lt;Grid Grid.Row=&quot;1&quot;&gt;
            &lt;!-- Single Entry View --&gt;
            &lt;Grid Visibility=&quot;{x:Bind ViewModel.IsSingleView, Mode=OneWay}&quot;&gt;
                &lt;Grid.RowDefinitions&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                &lt;/Grid.RowDefinitions&gt;

                &lt;!-- Entry Counter --&gt;
                &lt;Border Grid.Row=&quot;0&quot; 
                       Background=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;
                       Padding=&quot;12,6&quot;
                       CornerRadius=&quot;8,8,0,0&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot; HorizontalAlignment=&quot;Center&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE8FD;&quot; 
                                 FontSize=&quot;16&quot;
                                 Foreground=&quot;White&quot;/&gt;
                        &lt;TextBlock Style=&quot;{ThemeResource SubtitleTextBlockStyle}&quot;
                                  Foreground=&quot;White&quot;&gt;
                            &lt;Run Text=&quot;Entry&quot;/&gt;
                            &lt;Run Text=&quot;{x:Bind ViewModel.DisplayIndex, Mode=OneWay}&quot; 
                                 FontWeight=&quot;Bold&quot;/&gt;
                            &lt;Run Text=&quot;of&quot;/&gt;
                            &lt;Run Text=&quot;{x:Bind ViewModel.Loads.Count, Mode=OneWay}&quot; 
                                 FontWeight=&quot;Bold&quot;/&gt;
                        &lt;/TextBlock&gt;
                    &lt;/StackPanel&gt;
                &lt;/Border&gt;

                &lt;!-- Single Entry Form --&gt;
                &lt;Grid Grid.Row=&quot;1&quot;&gt;
                    &lt;Border Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                           BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                           BorderThickness=&quot;1,0,1,1&quot;
                           CornerRadius=&quot;0,0,8,8&quot;
                           Padding=&quot;20&quot;&gt;
                        &lt;Grid MaxWidth=&quot;900&quot;&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            &lt;StackPanel Grid.Column=&quot;0&quot; Spacing=&quot;12&quot; Margin=&quot;0,0,12,0&quot;&gt;
                            &lt;!-- Load Number (Read-only) --&gt;
                            &lt;StackPanel Spacing=&quot;8&quot;&gt;
                                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                    &lt;FontIcon Glyph=&quot;&amp;#xE7B8;&quot; 
                                             FontSize=&quot;14&quot;
                                             Foreground=&quot;{ThemeResource AccentTextFillColorSecondaryBrush}&quot;/&gt;
                                    &lt;TextBlock Text=&quot;Load Number&quot; 
                                              Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot;/&gt;
                                &lt;/StackPanel&gt;
                                &lt;TextBox Text=&quot;{x:Bind ViewModel.CurrentEntry.LoadNumber, Mode=OneWay}&quot; 
                                        IsReadOnly=&quot;True&quot;
                                        Background=&quot;{ThemeResource ControlFillColorDisabledBrush}&quot;/&gt;
                            &lt;/StackPanel&gt;

                            &lt;!-- PO Number --&gt;
                            &lt;StackPanel Spacing=&quot;8&quot;&gt;
                                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                    &lt;FontIcon Glyph=&quot;&amp;#xE8A5;&quot; 
                                             FontSize=&quot;14&quot;
                                             Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                                    &lt;TextBlock Text=&quot;Purchase Order Number&quot; 
                                              Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot;/&gt;
                                &lt;/StackPanel&gt;
                                &lt;TextBox Text=&quot;{x:Bind ViewModel.CurrentEntry.PoNumber, Mode=OneWay}&quot; 
                                        IsReadOnly=&quot;True&quot;/&gt;
                            &lt;/StackPanel&gt;

                            &lt;!-- Part ID --&gt;
                            &lt;StackPanel Spacing=&quot;8&quot;&gt;
                                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                    &lt;FontIcon Glyph=&quot;&amp;#xE8B7;&quot; 
                                             FontSize=&quot;14&quot;
                                             Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                                    &lt;TextBlock Text=&quot;Part ID&quot; 
                                              Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot;/&gt;
                                &lt;/StackPanel&gt;
                                &lt;TextBox Text=&quot;{x:Bind ViewModel.CurrentEntry.PartID, Mode=OneWay}&quot; 
                                        IsReadOnly=&quot;True&quot;/&gt;
                            &lt;/StackPanel&gt;

                            &lt;!-- Remaining Quantity --&gt;
                            &lt;StackPanel Spacing=&quot;8&quot;&gt;
                                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                    &lt;FontIcon Glyph=&quot;&amp;#xE9F9;&quot; 
                                             FontSize=&quot;14&quot;
                                             Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                                    &lt;TextBlock Text=&quot;Remaining Quantity&quot; 
                                              Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot;/&gt;
                                &lt;/StackPanel&gt;
                                &lt;TextBox Text=&quot;{x:Bind ViewModel.CurrentEntry.RemainingQuantity, Mode=OneWay}&quot; 
                                        IsReadOnly=&quot;True&quot;
                                        Foreground=&quot;{ThemeResource SystemAccentColor}&quot;
                                        FontWeight=&quot;SemiBold&quot;/&gt;
                            &lt;/StackPanel&gt;

                            &lt;!-- Weight/Quantity --&gt;
                            &lt;StackPanel Spacing=&quot;8&quot;&gt;
                                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                    &lt;FontIcon Glyph=&quot;&amp;#xEA8B;&quot; 
                                             FontSize=&quot;14&quot;
                                             Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                                    &lt;TextBlock Text=&quot;Weight/Quantity&quot; 
                                              Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot;/&gt;
                                &lt;/StackPanel&gt;
                                &lt;TextBox Text=&quot;{x:Bind ViewModel.CurrentEntry.WeightQuantity, Mode=OneWay}&quot; 
                                        IsReadOnly=&quot;True&quot;/&gt;
                            &lt;/StackPanel&gt;
                        &lt;/StackPanel&gt;

                        &lt;StackPanel Grid.Column=&quot;1&quot; Spacing=&quot;12&quot; Margin=&quot;12,0,0,0&quot;&gt;
                            &lt;!-- Heat/Lot Number --&gt;
                            &lt;StackPanel Spacing=&quot;8&quot;&gt;
                                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                    &lt;FontIcon Glyph=&quot;&amp;#xE8B4;&quot; 
                                             FontSize=&quot;14&quot;
                                             Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                                    &lt;TextBlock Text=&quot;Heat/Lot Number&quot; 
                                              Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot;/&gt;
                                &lt;/StackPanel&gt;
                                &lt;TextBox Text=&quot;{x:Bind ViewModel.CurrentEntry.HeatLotNumber, Mode=OneWay}&quot; 
                                        IsReadOnly=&quot;True&quot;/&gt;
                            &lt;/StackPanel&gt;

                            &lt;!-- Packages Per Load --&gt;
                            &lt;StackPanel Spacing=&quot;8&quot;&gt;
                                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                    &lt;FontIcon Glyph=&quot;&amp;#xE7B8;&quot; 
                                             FontSize=&quot;14&quot;
                                             Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                                    &lt;TextBlock Text=&quot;Packages Per Load&quot; 
                                              Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot;/&gt;
                                &lt;/StackPanel&gt;
                                &lt;TextBox Text=&quot;{x:Bind ViewModel.CurrentEntry.PackagesPerLoad, Mode=OneWay}&quot; 
                                        IsReadOnly=&quot;True&quot;/&gt;
                            &lt;/StackPanel&gt;

                            &lt;!-- Package Type --&gt;
                            &lt;StackPanel Spacing=&quot;8&quot;&gt;
                                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                    &lt;FontIcon Glyph=&quot;&amp;#xE7B8;&quot; 
                                             FontSize=&quot;14&quot;
                                             Foreground=&quot;{ThemeResource AccentTextFillColorSecondaryBrush}&quot;/&gt;
                                    &lt;TextBlock Text=&quot;Package Type&quot; 
                                              Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot;/&gt;
                                &lt;/StackPanel&gt;
                                &lt;TextBox Text=&quot;{x:Bind ViewModel.CurrentEntry.PackageTypeName, Mode=OneWay}&quot; 
                                        IsReadOnly=&quot;True&quot;/&gt;
                            &lt;/StackPanel&gt;
                        &lt;/StackPanel&gt;
                        &lt;/Grid&gt;
                    &lt;/Border&gt;
                &lt;/Grid&gt;

                &lt;!-- Navigation Bar for Single View --&gt;
                &lt;CommandBar Grid.Row=&quot;2&quot; DefaultLabelPosition=&quot;Right&quot; Margin=&quot;0,12,0,0&quot;&gt;
                    &lt;AppBarButton Icon=&quot;Back&quot; 
                                 Label=&quot;Previous&quot; 
                                 Command=&quot;{x:Bind ViewModel.PreviousEntryCommand}&quot;
                                 IsEnabled=&quot;{x:Bind ViewModel.CanGoBack, Mode=OneWay}&quot;
                                 AutomationProperties.Name=&quot;Previous Entry&quot;/&gt;
                    
                    &lt;AppBarButton Icon=&quot;Forward&quot; 
                                 Label=&quot;Next&quot; 
                                 Command=&quot;{x:Bind ViewModel.NextEntryCommand}&quot;
                                 IsEnabled=&quot;{x:Bind ViewModel.CanGoNext, Mode=OneWay}&quot;
                                 AutomationProperties.Name=&quot;Next Entry&quot;/&gt;
                    
                    &lt;AppBarSeparator/&gt;
                    
                    &lt;AppBarButton Icon=&quot;ViewAll&quot; 
                                 Label=&quot;Table View&quot; 
                                 Command=&quot;{x:Bind ViewModel.SwitchToTableViewCommand}&quot;
                                 AutomationProperties.Name=&quot;Switch to Table View&quot;/&gt;
                &lt;/CommandBar&gt;
            &lt;/Grid&gt;

            &lt;!-- Table View (DataGrid) --&gt;
            &lt;Grid Visibility=&quot;{x:Bind ViewModel.IsTableView, Mode=OneWay}&quot;&gt;
                &lt;Grid.RowDefinitions&gt;
                    &lt;RowDefinition Height=&quot;*&quot;/&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                &lt;/Grid.RowDefinitions&gt;

                &lt;Border Grid.Row=&quot;0&quot;
                       Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                       BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                       BorderThickness=&quot;1&quot;
                       CornerRadius=&quot;8&quot;
                       Padding=&quot;16&quot;&gt;
                    &lt;controls:DataGrid x:Name=&quot;ReviewDataGrid&quot;
                                      ItemsSource=&quot;{x:Bind ViewModel.Loads, Mode=OneWay}&quot;
                                      AutoGenerateColumns=&quot;False&quot;
                                      GridLinesVisibility=&quot;Horizontal&quot;
                                      HeadersVisibility=&quot;Column&quot;
                                      CanUserSortColumns=&quot;False&quot;
                                      SelectionMode=&quot;Single&quot;
                                      AutomationProperties.Name=&quot;Receiving Entries Table&quot;&gt;
                        &lt;controls:DataGrid.Columns&gt;
                            &lt;controls:DataGridTextColumn Header=&quot;Load #&quot; 
                                                        Binding=&quot;{Binding LoadNumber}&quot; 
                                                        IsReadOnly=&quot;True&quot; 
                                                        Width=&quot;80&quot;/&gt;
                            &lt;controls:DataGridTextColumn Header=&quot;PO Number&quot; 
                                                        Binding=&quot;{Binding PoNumber, TargetNullValue=&apos;N/A&apos;}&quot; 
                                                        Width=&quot;120&quot;/&gt;
                            &lt;controls:DataGridTextColumn Header=&quot;Part ID&quot; 
                                                        Binding=&quot;{Binding PartID}&quot; 
                                                        Width=&quot;150&quot;/&gt;
                            &lt;controls:DataGridTextColumn Header=&quot;Remaining Qty&quot; 
                                                        Binding=&quot;{Binding RemainingQuantity}&quot; 
                                                        Width=&quot;120&quot;/&gt;
                            &lt;controls:DataGridTextColumn Header=&quot;Weight/Qty&quot; 
                                                        Binding=&quot;{Binding WeightQuantity}&quot; 
                                                        Width=&quot;120&quot;/&gt;
                            &lt;controls:DataGridTextColumn Header=&quot;Heat/Lot #&quot; 
                                                        Binding=&quot;{Binding HeatLotNumber}&quot; 
                                                        Width=&quot;150&quot;/&gt;
                            &lt;controls:DataGridTextColumn Header=&quot;Pkgs&quot; 
                                                        Binding=&quot;{Binding PackagesPerLoad}&quot; 
                                                        Width=&quot;80&quot;/&gt;
                            &lt;controls:DataGridTextColumn Header=&quot;Pkg Type&quot; 
                                                        Binding=&quot;{Binding PackageTypeName}&quot; 
                                                        Width=&quot;100&quot;/&gt;
                        &lt;/controls:DataGrid.Columns&gt;
                    &lt;/controls:DataGrid&gt;
                &lt;/Border&gt;

                &lt;!-- Navigation Bar for Table View --&gt;
                &lt;CommandBar Grid.Row=&quot;1&quot; DefaultLabelPosition=&quot;Right&quot; Margin=&quot;0,16,0,0&quot;&gt;
                    &lt;AppBarButton Label=&quot;Single View&quot; 
                                 Command=&quot;{x:Bind ViewModel.SwitchToSingleViewCommand}&quot;
                                 AutomationProperties.Name=&quot;Switch to Single View&quot;&gt;
                        &lt;AppBarButton.Icon&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE8A9;&quot;/&gt;
                        &lt;/AppBarButton.Icon&gt;
                    &lt;/AppBarButton&gt;
                &lt;/CommandBar&gt;
            &lt;/Grid&gt;
        &lt;/Grid&gt;

        &lt;!-- Action Buttons --&gt;
        &lt;Grid Grid.Row=&quot;2&quot; ColumnSpacing=&quot;12&quot; Margin=&quot;0,16,0,0&quot;&gt;
            &lt;Grid.ColumnDefinitions&gt;
                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
            &lt;/Grid.ColumnDefinitions&gt;

            &lt;Button Grid.Column=&quot;1&quot; 
                   Command=&quot;{x:Bind ViewModel.AddAnotherPartCommand}&quot;
                   AutomationProperties.Name=&quot;Add Another Part or PO&quot;
                   ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.AddAnother&apos;), Mode=OneWay}&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE710;&quot; FontSize=&quot;16&quot;/&gt;
                    &lt;TextBlock Text=&quot;Add Another Part/PO&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/Button&gt;
            
            &lt;Button Grid.Column=&quot;2&quot; 
                   Command=&quot;{x:Bind ViewModel.SaveCommand}&quot;
                   Style=&quot;{StaticResource AccentButtonStyle}&quot;
                   AutomationProperties.Name=&quot;Save to Database&quot;
                   ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.SaveAndGenerate&apos;), Mode=OneWay}&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE74E;&quot; FontSize=&quot;16&quot;/&gt;
                    &lt;TextBlock Text=&quot;Save to Database&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/Button&gt;
        &lt;/Grid&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Receiving/Views/View_Receiving_Review.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Receiving.ViewModels;

namespace MTM_Receiving_Application.Module_Receiving.Views
{
    public sealed partial class View_Receiving_Review : UserControl
    {
        public ViewModel_Receiving_Review ViewModel { get; }

        public View_Receiving_Review()
        {
            ViewModel = App.GetService&lt;ViewModel_Receiving_Review&gt;();
            this.InitializeComponent();
        }

        private async void UserControl_Loaded(object sender, RoutedEventArgs e)
        {
            await ViewModel.OnNavigatedToAsync();
        }
    }
}</file><file path="Module_Receiving/Views/View_Receiving_WeightQuantity.xaml">&lt;UserControl
    x:Class=&quot;MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_WeightQuantity&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;&gt;

    &lt;UserControl.Resources&gt;
        &lt;converters:Converter_StringFormat x:Key=&quot;StringFormatConverter&quot;/&gt;
        &lt;converters:Converter_IntToVisibility x:Key=&quot;IntToVisibilityConverter&quot;/&gt;
        &lt;converters:Converter_DoubleToDecimal x:Key=&quot;DoubleToDecimalConverter&quot;/&gt;
    &lt;/UserControl.Resources&gt;

    &lt;Grid Padding=&quot;20&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;
        
        &lt;!-- Info Header --&gt;
        &lt;Border Grid.Row=&quot;0&quot; 
                Background=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;
                Padding=&quot;16,12&quot;
                CornerRadius=&quot;8&quot;
                Margin=&quot;0,0,0,12&quot;&gt;
            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot; HorizontalAlignment=&quot;Center&quot;&gt;
                &lt;FontIcon Glyph=&quot;&amp;#xEA8B;&quot; FontSize=&quot;16&quot; Foreground=&quot;White&quot;/&gt;
                &lt;TextBlock Text=&quot;{x:Bind ViewModel.PoQuantityInfo, Mode=OneWay}&quot; 
                           Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;
                           Foreground=&quot;White&quot;/&gt;
            &lt;/StackPanel&gt;
        &lt;/Border&gt;

        &lt;!-- Warning Banner --&gt;
        &lt;InfoBar Grid.Row=&quot;1&quot;
                 IsOpen=&quot;{x:Bind ViewModel.HasWarning, Mode=OneWay}&quot;
                 Severity=&quot;Warning&quot;
                 Message=&quot;{x:Bind ViewModel.WarningMessage, Mode=OneWay}&quot;
                 IsClosable=&quot;False&quot;
                 Margin=&quot;0,0,0,12&quot;/&gt;

        &lt;!-- Loads List with Fixed Height --&gt;
        &lt;ScrollViewer Grid.Row=&quot;2&quot; VerticalScrollBarVisibility=&quot;Auto&quot;&gt;
            &lt;ItemsControl ItemsSource=&quot;{x:Bind ViewModel.Loads, Mode=OneWay}&quot;&gt;
                &lt;ItemsControl.ItemTemplate&gt;
                    &lt;DataTemplate&gt;
                        &lt;Grid Margin=&quot;0,0,0,8&quot; Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot; Padding=&quot;16,12&quot; CornerRadius=&quot;8&quot; BorderThickness=&quot;1&quot; BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;120&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            
                            &lt;StackPanel Grid.Column=&quot;0&quot; VerticalAlignment=&quot;Center&quot;&gt;
                                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                    &lt;FontIcon Glyph=&quot;&amp;#xE7B8;&quot; FontSize=&quot;14&quot; Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                                    &lt;TextBlock Text=&quot;{Binding LoadNumber, Converter={StaticResource StringFormatConverter}, ConverterParameter=&apos;Load #{0}&apos;}&quot; 
                                               Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                                &lt;/StackPanel&gt;
                            &lt;/StackPanel&gt;
                            
                            &lt;NumberBox Grid.Column=&quot;1&quot;
                                       Header=&quot;Weight/Quantity&quot;
                                       Value=&quot;{Binding WeightQuantity, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DoubleToDecimalConverter}}&quot;
                                       Minimum=&quot;0&quot;
                                       SmallChange=&quot;1&quot;
                                       LargeChange=&quot;10&quot;
                                       SpinButtonPlacementMode=&quot;Inline&quot;
                                      PlaceholderText=&quot;Enter whole number&quot;
                                       AutomationProperties.Name=&quot;Weight Quantity&quot;/&gt;
                        &lt;/Grid&gt;
                    &lt;/DataTemplate&gt;
                &lt;/ItemsControl.ItemTemplate&gt;
            &lt;/ItemsControl&gt;
        &lt;/ScrollViewer&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Receiving/Views/View_Receiving_WeightQuantity.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.ViewModels;

namespace MTM_Receiving_Application.Module_Receiving.Views
{
    public sealed partial class View_Receiving_WeightQuantity : UserControl
    {
        public ViewModel_Receiving_WeightQuantity ViewModel { get; }
        private readonly IService_Focus _focusService;

        public View_Receiving_WeightQuantity()
        {
            ViewModel = App.GetService&lt;ViewModel_Receiving_WeightQuantity&gt;();
            _focusService = App.GetService&lt;IService_Focus&gt;();
            this.InitializeComponent();

            this.Loaded += WeightQuantityView_Loaded;
            _focusService.AttachFocusOnVisibility(this);
        }

        private async void WeightQuantityView_Loaded(object sender, RoutedEventArgs e)
        {
            await ViewModel.OnNavigatedToAsync();
        }
    }
}</file><file path="Module_Receiving/Views/View_Receiving_Workflow.xaml">&lt;Page
    x:Class=&quot;MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_Workflow&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:viewmodels=&quot;using:MTM_Receiving_Application.Module_Receiving.ViewModels&quot;
    xmlns:views=&quot;using:MTM_Receiving_Application.Module_Receiving.Views&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;&gt;

    &lt;Page.Resources&gt;
        &lt;converters:Converter_BooleanToVisibility x:Key=&quot;BooleanToVisibilityConverter&quot;/&gt;
        &lt;converters:Converter_BoolToString x:Key=&quot;BoolToStringConverter&quot;/&gt;
        &lt;converters:Converter_StringFormat x:Key=&quot;StringFormatConverter&quot;/&gt;
    &lt;/Page.Resources&gt;

    &lt;Grid&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Content Area --&gt;
        &lt;Grid Grid.Row=&quot;1&quot; Margin=&quot;16,12,16,16&quot;&gt;
            &lt;!-- Mode Selection View --&gt;
            &lt;views:View_Receiving_ModeSelection Visibility=&quot;{x:Bind ViewModel.IsModeSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;
            
            &lt;!-- Manual Entry View --&gt;
            &lt;views:View_Receiving_ManualEntry Visibility=&quot;{x:Bind ViewModel.IsManualEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;

            &lt;!-- Edit Mode View --&gt;
            &lt;views:View_Receiving_EditMode Visibility=&quot;{x:Bind ViewModel.IsEditModeVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;

            &lt;!-- PO Entry View --&gt;
            &lt;views:View_Receiving_POEntry Visibility=&quot;{x:Bind ViewModel.IsPOEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;
            &lt;views:View_Receiving_LoadEntry Visibility=&quot;{x:Bind ViewModel.IsLoadEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;
            &lt;views:View_Receiving_WeightQuantity Visibility=&quot;{x:Bind ViewModel.IsWeightQuantityEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;
            &lt;views:View_Receiving_HeatLot Visibility=&quot;{x:Bind ViewModel.IsHeatLotEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;
            &lt;views:View_Receiving_PackageType Visibility=&quot;{x:Bind ViewModel.IsPackageTypeEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;
            &lt;views:View_Receiving_Review Visibility=&quot;{x:Bind ViewModel.IsReviewVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;
            
            &lt;!-- Saving Progress --&gt;
            &lt;StackPanel Visibility=&quot;{x:Bind ViewModel.IsSavingVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;
                        VerticalAlignment=&quot;Center&quot; HorizontalAlignment=&quot;Center&quot; Spacing=&quot;16&quot;&gt;
                &lt;ProgressRing IsActive=&quot;True&quot; Width=&quot;64&quot; Height=&quot;64&quot;/&gt;
                &lt;TextBlock Text=&quot;{x:Bind ViewModel.SaveProgressMessage, Mode=OneWay}&quot; 
                           Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;
                           HorizontalAlignment=&quot;Center&quot;/&gt;
                &lt;ProgressBar Value=&quot;{x:Bind ViewModel.SaveProgressValue, Mode=OneWay}&quot; Maximum=&quot;100&quot; Width=&quot;300&quot;/&gt;
            &lt;/StackPanel&gt;

            &lt;!-- Completion Summary --&gt;
            &lt;StackPanel Visibility=&quot;{x:Bind ViewModel.IsCompleteVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;
                        VerticalAlignment=&quot;Center&quot; HorizontalAlignment=&quot;Center&quot; Spacing=&quot;24&quot; MaxWidth=&quot;600&quot;&gt;
                
                &lt;FontIcon Glyph=&quot;&amp;#xE930;&quot; FontSize=&quot;64&quot; Foreground=&quot;{ThemeResource SystemFillColorSuccessBrush}&quot; 
                          Visibility=&quot;{x:Bind ViewModel.LastSaveResult.Success, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;
                &lt;FontIcon Glyph=&quot;&amp;#xE783;&quot; FontSize=&quot;64&quot; Foreground=&quot;{ThemeResource SystemFillColorCriticalBrush}&quot; 
                          Visibility=&quot;{x:Bind ViewModel.LastSaveResult.Success, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=&apos;Inverse&apos;}&quot;/&gt;

                &lt;TextBlock Text=&quot;Success!&quot; 
                           Style=&quot;{StaticResource TitleTextBlockStyle}&quot; HorizontalAlignment=&quot;Center&quot;
                           Visibility=&quot;{x:Bind ViewModel.LastSaveResult.Success, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;
                &lt;TextBlock Text=&quot;Save Failed&quot; 
                           Style=&quot;{StaticResource TitleTextBlockStyle}&quot; HorizontalAlignment=&quot;Center&quot;
                           Visibility=&quot;{x:Bind ViewModel.LastSaveResult.Success, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=&apos;Inverse&apos;}&quot;/&gt;

                &lt;TextBlock Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot; HorizontalAlignment=&quot;Center&quot;&gt;
                    &lt;Run Text=&quot;{x:Bind ViewModel.LastSaveResult.LoadsSaved, Mode=OneWay}&quot;/&gt;
                    &lt;Run Text=&quot; loads saved successfully.&quot;/&gt;
                &lt;/TextBlock&gt;

                &lt;StackPanel Spacing=&quot;8&quot; Background=&quot;{ThemeResource LayerFillColorDefaultBrush}&quot; Padding=&quot;16&quot; CornerRadius=&quot;8&quot;&gt;
                    &lt;TextBlock Text=&quot;Save Details:&quot; Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                    
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;TextBlock Text=&quot;Local CSV:&quot;/&gt;
                        &lt;TextBlock Text=&quot;Saved&quot; Foreground=&quot;Green&quot; Visibility=&quot;{x:Bind ViewModel.LastSaveResult.LocalCSVSuccess, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;
                        &lt;TextBlock Text=&quot;Failed&quot; Foreground=&quot;Red&quot; Visibility=&quot;{x:Bind ViewModel.LastSaveResult.LocalCSVSuccess, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=&apos;Inverse&apos;}&quot;/&gt;
                    &lt;/StackPanel&gt;

                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;TextBlock Text=&quot;Network CSV:&quot;/&gt;
                        &lt;TextBlock Text=&quot;Saved&quot; Foreground=&quot;Green&quot; Visibility=&quot;{x:Bind ViewModel.LastSaveResult.NetworkCSVSuccess, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;
                        &lt;TextBlock Text=&quot;Failed&quot; Foreground=&quot;Red&quot; Visibility=&quot;{x:Bind ViewModel.LastSaveResult.NetworkCSVSuccess, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=&apos;Inverse&apos;}&quot;/&gt;
                    &lt;/StackPanel&gt;

                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;TextBlock Text=&quot;Database:&quot;/&gt;
                        &lt;TextBlock Text=&quot;Saved&quot; Foreground=&quot;Green&quot; Visibility=&quot;{x:Bind ViewModel.LastSaveResult.DatabaseSuccess, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;
                        &lt;TextBlock Text=&quot;Failed&quot; Foreground=&quot;Red&quot; Visibility=&quot;{x:Bind ViewModel.LastSaveResult.DatabaseSuccess, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=&apos;Inverse&apos;}&quot;/&gt;
                    &lt;/StackPanel&gt;
                &lt;/StackPanel&gt;
                
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot; HorizontalAlignment=&quot;Center&quot;&gt;
                    &lt;Button Content=&quot;Start New Entry&quot; Command=&quot;{x:Bind ViewModel.StartNewEntryCommand}&quot; Style=&quot;{StaticResource AccentButtonStyle}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.StartNew&apos;), Mode=OneWay}&quot;/&gt;
                    &lt;Button Content=&quot;Reset CSV&quot; Command=&quot;{x:Bind ViewModel.ResetCSVCommand}&quot; ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.ResetCSV&apos;), Mode=OneWay}&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;

        &lt;!-- Navigation Buttons --&gt;
        &lt;Grid Grid.Row=&quot;2&quot; Margin=&quot;24&quot;&gt;
            &lt;Grid.ColumnDefinitions&gt;
                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
            &lt;/Grid.ColumnDefinitions&gt;
            
            &lt;!-- Left-aligned buttons --&gt;
            &lt;StackPanel Grid.Column=&quot;0&quot; Orientation=&quot;Horizontal&quot; HorizontalAlignment=&quot;Left&quot; Spacing=&quot;12&quot;&gt;
                &lt;Button Content=&quot;Mode Selection&quot; 
                        Command=&quot;{x:Bind ViewModel.ReturnToModeSelectionCommand}&quot;
                        Background=&quot;Transparent&quot; 
                        BorderBrush=&quot;{ThemeResource SystemAccentColor}&quot;/&gt;
                &lt;Button Content=&quot;Reset CSV&quot; 
                        Command=&quot;{x:Bind ViewModel.ResetCSVCommand}&quot; 
                        Visibility=&quot;{x:Bind ViewModel.IsModeSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=&apos;Inverse&apos;}&quot;
                        Background=&quot;Transparent&quot; 
                        BorderBrush=&quot;Transparent&quot; 
                        Foreground=&quot;Red&quot;
                        ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.ResetCSV&apos;), Mode=OneWay}&quot;/&gt;
            &lt;/StackPanel&gt;
            
            &lt;!-- Center help button --&gt;
            &lt;Button Grid.Column=&quot;0&quot;
                    Grid.ColumnSpan=&quot;2&quot;
                    Canvas.ZIndex=&quot;1000&quot;
                    HorizontalAlignment=&quot;Center&quot;
                    Click=&quot;HelpButton_Click&quot;
                    Style=&quot;{StaticResource AccentButtonStyle}&quot;
                    Padding=&quot;12,8&quot;
                    ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.StepHelp&apos;), Mode=OneWay}&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE946;&quot; FontSize=&quot;16&quot;/&gt;
                    &lt;TextBlock Text=&quot;Help&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/Button&gt;
            
            &lt;!-- Right-aligned navigation buttons --&gt;
            &lt;StackPanel Grid.Column=&quot;1&quot; Orientation=&quot;Horizontal&quot; HorizontalAlignment=&quot;Right&quot; Spacing=&quot;12&quot;&gt;
                &lt;Button Content=&quot;Back&quot; Command=&quot;{x:Bind ViewModel.PreviousStepCommand}&quot;/&gt;
                &lt;Button Content=&quot;Next&quot; Command=&quot;{x:Bind ViewModel.NextStepCommand}&quot; Style=&quot;{StaticResource AccentButtonStyle}&quot;/&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Reporting/Views/View_Reporting_Main.xaml">&lt;Page
    x:Class=&quot;MTM_Receiving_Application.Module_Reporting.Views.View_Reporting_Main&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    mc:Ignorable=&quot;d&quot;
    Background=&quot;{ThemeResource ApplicationPageBackgroundThemeBrush}&quot;&gt;

    &lt;Grid Padding=&quot;24&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header --&gt;
        &lt;StackPanel Grid.Row=&quot;0&quot; Spacing=&quot;8&quot; Margin=&quot;0,0,0,24&quot;&gt;
            &lt;TextBlock 
                Text=&quot;{x:Bind ViewModel.Title, Mode=OneWay}&quot; 
                Style=&quot;{StaticResource TitleTextBlockStyle}&quot;/&gt;
            &lt;TextBlock 
                Text=&quot;Select date range and modules to generate end-of-day reports&quot; 
                Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Date Range Selection --&gt;
        &lt;StackPanel Grid.Row=&quot;1&quot; Spacing=&quot;12&quot; Margin=&quot;0,0,0,24&quot;&gt;
            &lt;TextBlock Text=&quot;Date Range&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;/&gt;
            &lt;Grid ColumnSpacing=&quot;16&quot;&gt;
                &lt;Grid.ColumnDefinitions&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                &lt;/Grid.ColumnDefinitions&gt;

                &lt;CalendarDatePicker 
                    Grid.Column=&quot;0&quot;
                    Header=&quot;Start Date&quot;
                    Date=&quot;{x:Bind ViewModel.StartDate, Mode=TwoWay}&quot;
                    HorizontalAlignment=&quot;Stretch&quot;/&gt;

                &lt;CalendarDatePicker 
                    Grid.Column=&quot;1&quot;
                    Header=&quot;End Date&quot;
                    Date=&quot;{x:Bind ViewModel.EndDate, Mode=TwoWay}&quot;
                    HorizontalAlignment=&quot;Stretch&quot;/&gt;

                &lt;Button 
                    Grid.Column=&quot;2&quot;
                    Content=&quot;Check Availability&quot;
                    Command=&quot;{x:Bind ViewModel.CheckAvailabilityCommand}&quot;
                    Style=&quot;{StaticResource AccentButtonStyle}&quot;
                    VerticalAlignment=&quot;Bottom&quot;
                    Margin=&quot;0,0,0,4&quot;/&gt;
            &lt;/Grid&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Module Selection --&gt;
        &lt;StackPanel Grid.Row=&quot;2&quot; Spacing=&quot;12&quot; Margin=&quot;0,0,0,24&quot;&gt;
            &lt;TextBlock Text=&quot;Select Modules&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;/&gt;
            &lt;Grid ColumnSpacing=&quot;24&quot;&gt;
                &lt;Grid.ColumnDefinitions&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;/Grid.ColumnDefinitions&gt;

                &lt;StackPanel Grid.Column=&quot;0&quot; Spacing=&quot;4&quot;&gt;
                    &lt;CheckBox 
                        Content=&quot;Receiving&quot;
                        IsChecked=&quot;{x:Bind ViewModel.IsReceivingChecked, Mode=TwoWay}&quot;
                        IsEnabled=&quot;{x:Bind ViewModel.IsReceivingEnabled, Mode=OneWay}&quot;/&gt;
                    &lt;TextBlock 
                        Text=&quot;{x:Bind ViewModel.ReceivingCount, Mode=OneWay}&quot;
                        Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;
                        Margin=&quot;28,0,0,0&quot;
                        FontSize=&quot;12&quot;/&gt;
                    &lt;Button 
                        Content=&quot;Generate Report&quot;
                        Command=&quot;{x:Bind ViewModel.GenerateReceivingReportCommand}&quot;
                        HorizontalAlignment=&quot;Stretch&quot;
                        Margin=&quot;0,4,0,0&quot;/&gt;
                &lt;/StackPanel&gt;

                &lt;StackPanel Grid.Column=&quot;1&quot; Spacing=&quot;4&quot;&gt;
                    &lt;CheckBox 
                        Content=&quot;Dunnage&quot;
                        IsChecked=&quot;{x:Bind ViewModel.IsDunnageChecked, Mode=TwoWay}&quot;
                        IsEnabled=&quot;{x:Bind ViewModel.IsDunnageEnabled, Mode=OneWay}&quot;/&gt;
                    &lt;TextBlock 
                        Text=&quot;{x:Bind ViewModel.DunnageCount, Mode=OneWay}&quot;
                        Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;
                        Margin=&quot;28,0,0,0&quot;
                        FontSize=&quot;12&quot;/&gt;
                    &lt;Button 
                        Content=&quot;Generate Report&quot;
                        Command=&quot;{x:Bind ViewModel.GenerateDunnageReportCommand}&quot;
                        HorizontalAlignment=&quot;Stretch&quot;
                        Margin=&quot;0,4,0,0&quot;/&gt;
                &lt;/StackPanel&gt;

                &lt;StackPanel Grid.Column=&quot;2&quot; Spacing=&quot;4&quot;&gt;
                    &lt;CheckBox 
                        Content=&quot;Routing&quot;
                        IsChecked=&quot;{x:Bind ViewModel.IsRoutingChecked, Mode=TwoWay}&quot;
                        IsEnabled=&quot;{x:Bind ViewModel.IsRoutingEnabled, Mode=OneWay}&quot;/&gt;
                    &lt;TextBlock 
                        Text=&quot;{x:Bind ViewModel.RoutingCount, Mode=OneWay}&quot;
                        Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;
                        Margin=&quot;28,0,0,0&quot;
                        FontSize=&quot;12&quot;/&gt;
                    &lt;Button 
                        Content=&quot;Generate Report&quot;
                        Command=&quot;{x:Bind ViewModel.GenerateRoutingReportCommand}&quot;
                        HorizontalAlignment=&quot;Stretch&quot;
                        Margin=&quot;0,4,0,0&quot;/&gt;
                &lt;/StackPanel&gt;

                &lt;StackPanel Grid.Column=&quot;3&quot; Spacing=&quot;4&quot;&gt;
                    &lt;CheckBox 
                        Content=&quot;Volvo&quot;
                        IsChecked=&quot;{x:Bind ViewModel.IsVolvoChecked, Mode=TwoWay}&quot;
                        IsEnabled=&quot;{x:Bind ViewModel.IsVolvoEnabled, Mode=OneWay}&quot;/&gt;
                    &lt;TextBlock 
                        Text=&quot;{x:Bind ViewModel.VolvoCount, Mode=OneWay}&quot;
                        Foreground=&quot;{ThemeResource SystemControlForegroundBaseMediumBrush}&quot;
                        Margin=&quot;28,0,0,0&quot;
                        FontSize=&quot;12&quot;/&gt;
                    &lt;Button 
                        Content=&quot;Generate Report&quot;
                        Command=&quot;{x:Bind ViewModel.GenerateVolvoReportCommand}&quot;
                        HorizontalAlignment=&quot;Stretch&quot;
                        Margin=&quot;0,4,0,0&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/Grid&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Report Data Grid --&gt;
        &lt;Border 
            Grid.Row=&quot;3&quot; 
            BorderBrush=&quot;{ThemeResource SystemControlForegroundBaseMediumLowBrush}&quot;
            BorderThickness=&quot;1&quot;
            CornerRadius=&quot;4&quot;
            Padding=&quot;12&quot;&gt;
            &lt;ScrollViewer&gt;
                &lt;StackPanel Spacing=&quot;12&quot;&gt;
                    &lt;TextBlock 
                        Text=&quot;{x:Bind ViewModel.CurrentModuleName, Mode=OneWay}&quot; 
                        Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;/&gt;
                    
                    &lt;ListView 
                        ItemsSource=&quot;{x:Bind ViewModel.ReportData, Mode=OneWay}&quot;
                        SelectionMode=&quot;None&quot;&gt;
                        &lt;ListView.ItemTemplate&gt;
                            &lt;DataTemplate&gt;
                                &lt;Grid Padding=&quot;8&quot;&gt;
                                    &lt;StackPanel&gt;
                                        &lt;TextBlock Text=&quot;{Binding CreatedDate, Mode=OneWay}&quot; FontWeight=&quot;Bold&quot;/&gt;
                                        &lt;TextBlock Text=&quot;{Binding PartNumber, Mode=OneWay}&quot;/&gt;
                                        &lt;TextBlock Text=&quot;{Binding PONumber, Mode=OneWay}&quot; Foreground=&quot;Gray&quot;/&gt;
                                    &lt;/StackPanel&gt;
                                &lt;/Grid&gt;
                            &lt;/DataTemplate&gt;
                        &lt;/ListView.ItemTemplate&gt;
                    &lt;/ListView&gt;
                &lt;/StackPanel&gt;
            &lt;/ScrollViewer&gt;
        &lt;/Border&gt;

        &lt;!-- Action Buttons --&gt;
        &lt;CommandBar Grid.Row=&quot;4&quot; DefaultLabelPosition=&quot;Right&quot; Margin=&quot;0,12,0,0&quot;&gt;
            &lt;AppBarButton 
                Icon=&quot;Save&quot; 
                Label=&quot;Export to CSV&quot;
                Command=&quot;{x:Bind ViewModel.ExportToCSVCommand}&quot;/&gt;
            &lt;AppBarButton 
                Icon=&quot;Copy&quot; 
                Label=&quot;Copy Email Format&quot;
                Command=&quot;{x:Bind ViewModel.CopyEmailFormatCommand}&quot;/&gt;
            &lt;AppBarSeparator/&gt;
            &lt;AppBarButton 
                Icon=&quot;Refresh&quot; 
                Label=&quot;Check Availability&quot;
                Command=&quot;{x:Bind ViewModel.CheckAvailabilityCommand}&quot;/&gt;
        &lt;/CommandBar&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Reporting/Views/View_Reporting_Main.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Reporting.ViewModels;

namespace MTM_Receiving_Application.Module_Reporting.Views;

/// &lt;summary&gt;
/// Main page for End-of-Day Reporting module
/// &lt;/summary&gt;
public sealed partial class View_Reporting_Main : Page
{
    public ViewModel_Reporting_Main ViewModel { get; }

    public View_Reporting_Main()
    {
        ViewModel = App.GetService&lt;ViewModel_Reporting_Main&gt;();
        InitializeComponent();
        DataContext = ViewModel;
    }
}</file><file path="Module_Routing/Enums/Enum_RoutingMode.cs">namespace MTM_Receiving_Application.Module_Routing.Enums;

/// &lt;summary&gt;
/// Enumeration of routing module operating modes
/// &lt;/summary&gt;
public enum Enum_RoutingMode
{
    /// &lt;summary&gt;
    /// Wizard mode: Step-by-step guided workflow
    /// &lt;/summary&gt;
    WIZARD,

    /// &lt;summary&gt;
    /// Manual entry mode: Grid-based batch entry
    /// &lt;/summary&gt;
    MANUAL,

    /// &lt;summary&gt;
    /// Edit mode: Search and edit existing labels
    /// &lt;/summary&gt;
    EDIT
}</file><file path="Module_Routing/Views/RoutingWizardContainerView.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Routing.ViewModels;

namespace MTM_Receiving_Application.Module_Routing.Views;

public sealed partial class RoutingWizardContainerView : Page
{
    public RoutingWizardContainerViewModel ViewModel { get; }

    public RoutingWizardContainerView()
    {
        ViewModel = App.GetService&lt;RoutingWizardContainerViewModel&gt;();
        InitializeComponent();
    }
}</file><file path="Module_Routing/Views/RoutingWizardStep1View.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Routing.ViewModels;

namespace MTM_Receiving_Application.Module_Routing.Views;

public sealed partial class RoutingWizardStep1View : Page
{
    public RoutingWizardStep1ViewModel ViewModel { get; }

    public RoutingWizardStep1View()
    {
        ViewModel = App.GetService&lt;RoutingWizardStep1ViewModel&gt;();
        InitializeComponent();
    }
}</file><file path="Module_Routing/Views/RoutingWizardStep3View.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Routing.ViewModels;

namespace MTM_Receiving_Application.Module_Routing.Views;

public sealed partial class RoutingWizardStep3View : Page
{
    public RoutingWizardStep3ViewModel ViewModel { get; }

    public RoutingWizardStep3View()
    {
        ViewModel = App.GetService&lt;RoutingWizardStep3ViewModel&gt;();
        InitializeComponent();
    }

    private void OnPageLoaded(object sender, RoutedEventArgs e)
    {
        // Load review data when page loads
        ViewModel.LoadReviewData();
    }
}</file><file path="Module_Settings/Enums/Enum_SettingsWorkflowStep.cs">namespace MTM_Receiving_Application.Module_Settings.Enums;

/// &lt;summary&gt;
/// Settings workflow navigation steps
/// &lt;/summary&gt;
public enum Enum_SettingsWorkflowStep
{
    ModeSelection,
    ReceivingSettings,
    DunnageSettings,
    ShippingSettings,
    VolvoSettings,
    AdministrativeSettings,
    DunnageTypes,
    DunnageInventory
}</file><file path="Module_Settings/Interfaces/IService_UserPreferences.cs">using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;

namespace MTM_Receiving_Application.Module_Settings.Interfaces;

public interface IService_UserPreferences
{
    /// &lt;summary&gt;Get user&apos;s latest receiving mode preference&lt;/summary&gt;
    /// &lt;param name=&quot;username&quot;&gt;&lt;/param&gt;
    public Task&lt;Model_Dao_Result&lt;Model_UserPreference&gt;&gt; GetLatestUserPreferenceAsync(string username);

    /// &lt;summary&gt;Update user&apos;s default receiving mode&lt;/summary&gt;
    /// &lt;param name=&quot;username&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;defaultMode&quot;&gt;&lt;/param&gt;
    public Task&lt;Model_Dao_Result&gt; UpdateDefaultModeAsync(string username, string defaultMode);

    /// &lt;summary&gt;Update user&apos;s default receiving workflow mode (guided, manual, edit)&lt;/summary&gt;
    /// &lt;param name=&quot;username&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;defaultMode&quot;&gt;&lt;/param&gt;
    public Task&lt;Model_Dao_Result&gt; UpdateDefaultReceivingModeAsync(string username, string defaultMode);

    /// &lt;summary&gt;Update user&apos;s default dunnage mode&lt;/summary&gt;
    /// &lt;param name=&quot;username&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;defaultMode&quot;&gt;&lt;/param&gt;
    public Task&lt;Model_Dao_Result&gt; UpdateDefaultDunnageModeAsync(string username, string defaultMode);
}</file><file path="Module_Settings/Services/Service_SettingsWorkflow.cs">using MTM_Receiving_Application.Module_Settings.Enums;
using MTM_Receiving_Application.Module_Settings.Interfaces;
using System;

namespace MTM_Receiving_Application.Module_Settings.Services;

/// &lt;summary&gt;
/// Service for managing Settings workflow navigation
/// &lt;/summary&gt;
public class Service_SettingsWorkflow : IService_SettingsWorkflow
{
    public event EventHandler&lt;Enum_SettingsWorkflowStep&gt;? StepChanged;

    private Enum_SettingsWorkflowStep _currentStep = Enum_SettingsWorkflowStep.ModeSelection;

    public void GoToStep(Enum_SettingsWorkflowStep step)
    {
        _currentStep = step;
        StepChanged?.Invoke(this, step);
    }

    public void GoBack()
    {
        // Return to mode selection
        GoToStep(Enum_SettingsWorkflowStep.ModeSelection);
    }

    public void Reset()
    {
        GoToStep(Enum_SettingsWorkflowStep.ModeSelection);
    }
}</file><file path="Module_Shared/ViewModels/ViewModel_Shared_Base.cs">using CommunityToolkit.Mvvm.ComponentModel;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Shared.ViewModels;

/// &lt;summary&gt;
/// Base ViewModel providing common functionality for all ViewModels
/// &lt;/summary&gt;
public abstract partial class ViewModel_Shared_Base : ObservableObject
{
    protected readonly IService_ErrorHandler _errorHandler;
    protected readonly IService_LoggingUtility _logger;

    [ObservableProperty]
    private bool _isBusy;

    [ObservableProperty]
    private string _statusMessage = string.Empty;

    [ObservableProperty]
    private InfoBarSeverity _statusSeverity = InfoBarSeverity.Informational;

    [ObservableProperty]
    private bool _isStatusOpen;

    [ObservableProperty]
    private string _title = string.Empty;

    protected ViewModel_Shared_Base(
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger)
    {
        _errorHandler = errorHandler;
        _logger = logger;
    }

    public void ShowStatus(string message, InfoBarSeverity severity = InfoBarSeverity.Informational)
    {
        // Update global notification
        var notificationService = App.GetService&lt;IService_Notification&gt;();
        notificationService?.ShowStatus(message, severity);

        // Update local properties
        StatusMessage = message;
        StatusSeverity = severity;
        IsStatusOpen = true;
    }
}</file><file path="Module_Shared/ViewModels/ViewModel_Shared_HelpDialog.cs">using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Core;
using System;
using System.Collections.ObjectModel;
using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Shared.ViewModels;

/// &lt;summary&gt;
/// ViewModel for the centralized help dialog
/// &lt;/summary&gt;
public partial class ViewModel_Shared_HelpDialog : ViewModel_Shared_Base
{
    private readonly IService_Help _helpService;

    [ObservableProperty]
    private Model_HelpContent? _helpContent;

    [ObservableProperty]
    private bool _isRelatedHelpAvailable;

    [ObservableProperty]
    private ObservableCollection&lt;Model_HelpContent&gt; _relatedTopics = new();

    [ObservableProperty]
    private bool _canDismiss;

    [ObservableProperty]
    private bool _isDismissed;

    public ViewModel_Shared_HelpDialog(
        IService_Help helpService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger) : base(errorHandler, logger)
    {
        _helpService = helpService;
    }

    /// &lt;summary&gt;
    /// Loads help content and related topics
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;content&quot;&gt;The help content to load&lt;/param&gt;
    public async Task LoadHelpContentAsync(Model_HelpContent content)
    {
        try
        {
            HelpContent = content;
            CanDismiss = content.HelpType == Module_Core.Models.Enums.Enum_HelpType.Tip;

            // Check if dismissed
            if (CanDismiss &amp;&amp; content.Key != null)
            {
                IsDismissed = await _helpService.IsDismissedAsync(content.Key);
            }

            // Load related topics
            RelatedTopics.Clear();
            if (content.RelatedKeys?.Count &gt; 0)
            {
                foreach (var relatedKey in content.RelatedKeys)
                {
                    var relatedContent = _helpService.GetHelpContent(relatedKey);
                    if (relatedContent != null)
                    {
                        RelatedTopics.Add(relatedContent);
                    }
                }
                IsRelatedHelpAvailable = RelatedTopics.Count &gt; 0;
            }
            else
            {
                IsRelatedHelpAvailable = false;
            }

            await Task.CompletedTask;
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Module_Core.Models.Enums.Enum_ErrorSeverity.Medium,
                nameof(LoadHelpContentAsync),
                nameof(ViewModel_Shared_HelpDialog)
            );
        }
    }

    [RelayCommand]
    private async Task ViewRelatedTopicAsync()
    {
        // This will be called from the ListView click event
        await Task.CompletedTask;
    }

    public async Task LoadRelatedTopicAsync(Model_HelpContent? relatedContent)
    {
        if (relatedContent != null)
        {
            await LoadHelpContentAsync(relatedContent);
        }
    }

    [RelayCommand]
    private async Task CopyContentAsync()
    {
        try
        {
            if (HelpContent != null &amp;&amp; !string.IsNullOrEmpty(HelpContent.Content))
            {
                var dataPackage = new Windows.ApplicationModel.DataTransfer.DataPackage();
                dataPackage.SetText(HelpContent.Content);
                Windows.ApplicationModel.DataTransfer.Clipboard.SetContent(dataPackage);

                StatusMessage = &quot;Content copied to clipboard&quot;;
                await _logger.LogInfoAsync(&quot;Help content copied to clipboard&quot;);
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Module_Core.Models.Enums.Enum_ErrorSeverity.Low,
                nameof(CopyContentAsync),
                nameof(ViewModel_Shared_HelpDialog)
            );
        }
    }

    partial void OnIsDismissedChanged(bool value)
    {
        if (HelpContent != null &amp;&amp; !string.IsNullOrEmpty(HelpContent.Key))
        {
            _ = _helpService.SetDismissedAsync(HelpContent.Key, value);
        }
    }
}</file><file path="Module_Shared/ViewModels/ViewModel_Shared_NewUserSetup.cs">using System;
using System.Collections.ObjectModel;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Core.Models.Systems;

namespace MTM_Receiving_Application.Module_Shared.ViewModels
{
    /// &lt;summary&gt;
    /// ViewModel for NewUserSetupDialog.
    /// Manages new user account creation workflow.
    /// &lt;/summary&gt;
    public partial class ViewModel_Shared_NewUserSetup : ViewModel_Shared_Base
    {
        private readonly IService_Authentication _authService;

        // ====================================================================
        // Properties
        // ====================================================================

        [ObservableProperty]
        private string _windowsUsername = string.Empty;

        [ObservableProperty]
        private string _employeeNumber = string.Empty;

        [ObservableProperty]
        private string _fullName = string.Empty;

        [ObservableProperty]
        private string _department = string.Empty;

        [ObservableProperty]
        private string _shift = string.Empty;

        [ObservableProperty]
        private string _pin = string.Empty;

        [ObservableProperty]
        private string _errorMessage = string.Empty;

        [ObservableProperty]
        private bool _showCustomDepartment = false;

        [ObservableProperty]
        private bool _configureErpAccess = false;

        [ObservableProperty]
        private string? _visualUsername;

        [ObservableProperty]
        private string? _visualPassword;

        /// &lt;summary&gt;
        /// List of available departments from database
        /// &lt;/summary&gt;
        public ObservableCollection&lt;string&gt; Departments { get; } = new ObservableCollection&lt;string&gt;();

        /// &lt;summary&gt;
        /// The new employee number assigned after successful account creation
        /// &lt;/summary&gt;
        public int NewEmployeeNumber { get; private set; }

        /// &lt;summary&gt;
        /// Indicates if the user cancelled the dialog
        /// &lt;/summary&gt;
        public bool IsCancelled { get; set; } = false;

        /// &lt;summary&gt;
        /// The Windows username of the person creating this account (for audit trail)
        /// &lt;/summary&gt;
        public string CreatedBy { get; set; } = Environment.UserName;

        // ====================================================================
        // Constructor
        // ====================================================================

        /// &lt;summary&gt;
        /// Constructor with dependency injection
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;authService&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;errorHandler&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;logger&quot;&gt;&lt;/param&gt;
        public ViewModel_Shared_NewUserSetup(
            IService_Authentication authService,
            IService_ErrorHandler errorHandler,
            IService_LoggingUtility logger)
            : base(errorHandler, logger)
        {
            _authService = authService ?? throw new ArgumentNullException(nameof(authService));
        }

        // ====================================================================
        // Methods
        // ====================================================================

        /// &lt;summary&gt;
        /// Load active departments from database
        /// &lt;/summary&gt;
        public async Task LoadDepartmentsAsync()
        {
            try
            {
                IsBusy = true;
                StatusMessage = &quot;Loading departments...&quot;;

                var departmentList = await _authService.GetActiveDepartmentsAsync();

                Departments.Clear();
                foreach (var dept in departmentList)
                {
                    Departments.Add(dept);
                }

                StatusMessage = $&quot;Loaded {Departments.Count} departments&quot;;
                _logger.LogInfo($&quot;Loaded {Departments.Count} departments for new user setup&quot;);
            }
            catch (Exception ex)
            {
                ErrorMessage = &quot;Error loading departments.&quot;;
                await _errorHandler.HandleErrorAsync(
                    &quot;Failed to load departments&quot;,
                    Enum_ErrorSeverity.Warning,
                    ex,
                    showDialog: false);
            }
            finally
            {
                IsBusy = false;
            }
        }

        /// &lt;summary&gt;
        /// Create new user account
        /// &lt;/summary&gt;
        public async Task&lt;bool&gt; CreateAccountAsync()
        {
            if (IsBusy)
            {
                return false;
            }

            try
            {
                IsBusy = true;
                StatusMessage = &quot;Creating account...&quot;;
                ErrorMessage = string.Empty;

                // Validate employee number
                if (!int.TryParse(EmployeeNumber, out int empNum) || empNum &lt;= 0)
                {
                    ErrorMessage = &quot;Employee number must be a positive number&quot;;
                    StatusMessage = &quot;Validation failed&quot;;
                    return false;
                }

                // Validate PIN uniqueness via service
                var pinValidation = await _authService.ValidatePinAsync(Pin, empNum);
                if (!pinValidation.IsValid)
                {
                    ErrorMessage = pinValidation.ErrorMessage;
                    StatusMessage = &quot;PIN validation failed&quot;;
                    return false;
                }

                // Construct Model_User object
                var newUser = new Model_User
                {
                    EmployeeNumber = empNum,
                    WindowsUsername = WindowsUsername,
                    FullName = FullName,
                    Department = Department,
                    Shift = Shift,
                    Pin = Pin,
                    IsActive = true,
                    VisualUsername = ConfigureErpAccess ? VisualUsername : null,
                    VisualPassword = ConfigureErpAccess ? VisualPassword : null
                };

                // Call authentication service to create new user
                var progress = new Progress&lt;string&gt;(msg =&gt; StatusMessage = msg);
                var result = await _authService.CreateNewUserAsync(newUser, CreatedBy, progress);

                if (result.Success &amp;&amp; result.EmployeeNumber &gt; 0)
                {
                    // Account created successfully
                    NewEmployeeNumber = result.EmployeeNumber;
                    StatusMessage = $&quot;Account created! Employee #: {NewEmployeeNumber}&quot;;

                    _logger.LogInfo($&quot;New user account created: {FullName} (Emp #{NewEmployeeNumber}) by {CreatedBy}&quot;);

                    return true;
                }
                else
                {
                    // Account creation failed
                    ErrorMessage = result.ErrorMessage ?? &quot;Failed to create account.&quot;;
                    StatusMessage = &quot;Account creation failed&quot;;

                    _logger.LogWarning($&quot;Failed to create account for {WindowsUsername}: {ErrorMessage}&quot;);

                    return false;
                }
            }
            catch (Exception ex)
            {
                ErrorMessage = &quot;An unexpected error occurred while creating the account.&quot;;
                StatusMessage = &quot;Error&quot;;

                await _errorHandler.HandleErrorAsync(
                    $&quot;Account creation error for {WindowsUsername}&quot;,
                    Enum_ErrorSeverity.Error,
                    ex,
                    showDialog: false);

                return false;
            }
            finally
            {
                IsBusy = false;
            }
        }

        /// &lt;summary&gt;
        /// Validate PIN format (4 digits)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;pin&quot;&gt;&lt;/param&gt;
        public bool ValidatePinFormat(string pin)
        {
            if (string.IsNullOrWhiteSpace(pin))
            {
                return false;
            }

            if (pin.Length != 4)
            {
                return false;
            }

            foreach (char c in pin)
            {
                if (!char.IsDigit(c))
                {
                    return false;
                }
            }

            return true;
        }

        /// &lt;summary&gt;
        /// Validate that PINs match
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;pin&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;confirmPin&quot;&gt;&lt;/param&gt;
        public bool ValidatePinMatch(string pin, string confirmPin)
        {
            return !string.IsNullOrWhiteSpace(pin) &amp;&amp; pin == confirmPin;
        }

        /// &lt;summary&gt;
        /// Validate full name (at least 2 characters)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;fullName&quot;&gt;&lt;/param&gt;
        public bool ValidateFullName(string fullName)
        {
            return !string.IsNullOrWhiteSpace(fullName) &amp;&amp; fullName.Trim().Length &gt;= 2;
        }
    }
}</file><file path="Module_Shared/ViewModels/ViewModel_Shared_SharedTerminalLogin.cs">using System;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Systems;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Shared.ViewModels
{
    /// &lt;summary&gt;
    /// ViewModel for SharedTerminalLoginDialog.
    /// Manages PIN-based authentication for shared terminal workstations.
    /// &lt;/summary&gt;
    public partial class ViewModel_Shared_SharedTerminalLogin : ViewModel_Shared_Base
    {
        private readonly IService_Authentication _authService;

        // ====================================================================
        // Properties
        // ====================================================================

        [ObservableProperty]
        private string _username = string.Empty;

        [ObservableProperty]
        private string _pin = string.Empty;

        [ObservableProperty]
        private int _attemptCount = 0;

        [ObservableProperty]
        private string _errorMessage = string.Empty;

        /// &lt;summary&gt;
        /// Indicates if the user was locked out after 3 failed attempts
        /// &lt;/summary&gt;
        public bool IsLockedOut { get; set; } = false;

        /// &lt;summary&gt;
        /// Indicates if the user cancelled the login dialog
        /// &lt;/summary&gt;
        public bool IsCancelled { get; set; } = false;

        /// &lt;summary&gt;
        /// The authenticated user (null if authentication failed)
        /// &lt;/summary&gt;
        public Model_User? AuthenticatedUser { get; private set; }

        // ====================================================================
        // Constructor
        // ====================================================================

        /// &lt;summary&gt;
        /// Constructor with dependency injection
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;authService&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;errorHandler&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;logger&quot;&gt;&lt;/param&gt;
        public ViewModel_Shared_SharedTerminalLogin(
            IService_Authentication authService,
            IService_ErrorHandler errorHandler,
            IService_LoggingUtility logger)
            : base(errorHandler, logger)
        {
            _authService = authService ?? throw new ArgumentNullException(nameof(authService));
        }

        // ====================================================================
        // Commands
        // ====================================================================

        /// &lt;summary&gt;
        /// Attempts to authenticate the user with provided credentials
        /// &lt;/summary&gt;
        /// &lt;returns&gt;True if authentication successful, false otherwise&lt;/returns&gt;
        public async Task&lt;bool&gt; LoginAsync()
        {
            if (IsBusy)
            {
                return false;
            }

            try
            {
                IsBusy = true;
                StatusMessage = &quot;Authenticating...&quot;;
                ErrorMessage = string.Empty;

                // Validate input (basic checks)
                if (string.IsNullOrWhiteSpace(Username))
                {
                    ErrorMessage = &quot;Username is required.&quot;;
                    return false;
                }

                if (string.IsNullOrWhiteSpace(Pin))
                {
                    ErrorMessage = &quot;PIN is required.&quot;;
                    return false;
                }

                // Call authentication service
                var progress = new Progress&lt;string&gt;(msg =&gt; StatusMessage = msg);
                var result = await _authService.AuthenticateByPinAsync(Username, Pin, progress);

                if (result.Success &amp;&amp; result.User != null)
                {
                    // Authentication successful
                    AuthenticatedUser = result.User;
                    StatusMessage = $&quot;Welcome, {result.User.FullName}&quot;;

                    _logger.LogInfo($&quot;PIN authentication successful for user: {Username}&quot;);

                    return true;
                }
                else
                {
                    // Authentication failed
                    ErrorMessage = result.ErrorMessage ?? &quot;Invalid username or PIN.&quot;;
                    StatusMessage = &quot;Authentication failed&quot;;

                    _logger.LogWarning($&quot;PIN authentication failed for user: {Username}. Attempt {AttemptCount}&quot;);

                    return false;
                }
            }
            catch (Exception ex)
            {
                ErrorMessage = &quot;An unexpected error occurred during authentication.&quot;;
                StatusMessage = &quot;Error&quot;;

                await _errorHandler.HandleErrorAsync(
                    $&quot;Login error for user {Username}&quot;,
                    Enum_ErrorSeverity.Error,
                    ex,
                    showDialog: false);

                return false;
            }
            finally
            {
                IsBusy = false;
            }
        }
    }
}</file><file path="Module_Shared/ViewModels/ViewModel_Shared_SplashScreen.cs">using CommunityToolkit.Mvvm.ComponentModel;
using MTM_Receiving_Application.Module_Core.Contracts.Services;

namespace MTM_Receiving_Application.Module_Shared.ViewModels;

/// &lt;summary&gt;
/// ViewModel for the splash screen window.
/// Tracks startup progress and displays status messages.
/// &lt;/summary&gt;
public partial class ViewModel_Shared_SplashScreen : ViewModel_Shared_Base
{
    [ObservableProperty]
    private double _progressPercentage;

    [ObservableProperty]
    private bool _isIndeterminate = false;

    public ViewModel_Shared_SplashScreen(
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger)
        : base(errorHandler, logger)
    {
        StatusMessage = &quot;Initializing...&quot;;
    }

    /// &lt;summary&gt;
    /// Updates progress percentage and status message
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;percentage&quot;&gt;Progress percentage (0-100)&lt;/param&gt;
    /// &lt;param name=&quot;message&quot;&gt;Status message to display&lt;/param&gt;
    public void UpdateProgress(double percentage, string message)
    {
        ProgressPercentage = percentage;
        StatusMessage = message;
        IsIndeterminate = false;
    }

    /// &lt;summary&gt;
    /// Set splash screen to indeterminate/pulsing state
    /// Used when waiting for user input (dialogs)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;message&quot;&gt;Status message to display&lt;/param&gt;
    public void SetIndeterminate(string message)
    {
        StatusMessage = message;
        IsIndeterminate = true;
    }

    /// &lt;summary&gt;
    /// Reset progress to initial state
    /// &lt;/summary&gt;
    public void Reset()
    {
        ProgressPercentage = 0;
        StatusMessage = &quot;Initializing...&quot;;
        IsIndeterminate = false;
    }
}</file><file path="Module_Shared/Views/View_Shared_HelpDialog.xaml">&lt;ContentDialog
    x:Class=&quot;MTM_Receiving_Application.Module_Shared.Views.View_Shared_HelpDialog&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:mi=&quot;using:Material.Icons.WinUI3&quot;
    xmlns:models=&quot;using:MTM_Receiving_Application.Module_Core.Models.Core&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    mc:Ignorable=&quot;d&quot;
    Title=&quot;{x:Bind ViewModel.HelpContent.Title, Mode=OneWay}&quot;
    PrimaryButtonText=&quot;Close&quot;
    DefaultButton=&quot;Primary&quot;
    Width=&quot;700&quot;
    Height=&quot;600&quot;&gt;

    &lt;ContentDialog.Resources&gt;
        &lt;Style x:Key=&quot;HelpHeaderStyle&quot; TargetType=&quot;TextBlock&quot;&gt;
            &lt;Setter Property=&quot;FontSize&quot; Value=&quot;24&quot;/&gt;
            &lt;Setter Property=&quot;FontWeight&quot; Value=&quot;SemiBold&quot;/&gt;
            &lt;Setter Property=&quot;Margin&quot; Value=&quot;12,0,0,0&quot;/&gt;
        &lt;/Style&gt;
        
        &lt;Style x:Key=&quot;HelpContentStyle&quot; TargetType=&quot;TextBlock&quot;&gt;
            &lt;Setter Property=&quot;FontSize&quot; Value=&quot;14&quot;/&gt;
            &lt;Setter Property=&quot;TextWrapping&quot; Value=&quot;Wrap&quot;/&gt;
            &lt;Setter Property=&quot;LineHeight&quot; Value=&quot;22&quot;/&gt;
        &lt;/Style&gt;

        &lt;Style x:Key=&quot;RelatedTopicStyle&quot; TargetType=&quot;TextBlock&quot;&gt;
            &lt;Setter Property=&quot;FontSize&quot; Value=&quot;14&quot;/&gt;
            &lt;Setter Property=&quot;Margin&quot; Value=&quot;8,4&quot;/&gt;
        &lt;/Style&gt;
    &lt;/ContentDialog.Resources&gt;

    &lt;Grid&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header Section --&gt;
        &lt;StackPanel Grid.Row=&quot;0&quot; Orientation=&quot;Horizontal&quot; Margin=&quot;0,0,0,16&quot;&gt;
            &lt;mi:MaterialIcon 
                Kind=&quot;{x:Bind ViewModel.HelpContent.IconKind, Mode=OneWay}&quot;
                Width=&quot;32&quot; 
                Height=&quot;32&quot;
                Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
            &lt;TextBlock 
                Text=&quot;{x:Bind ViewModel.HelpContent.Title, Mode=OneWay}&quot;
                Style=&quot;{StaticResource HelpHeaderStyle}&quot;
                VerticalAlignment=&quot;Center&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Content Section --&gt;
        &lt;ScrollViewer Grid.Row=&quot;1&quot; VerticalScrollBarVisibility=&quot;Auto&quot;&gt;
            &lt;TextBlock 
                Text=&quot;{x:Bind ViewModel.HelpContent.Content, Mode=OneWay}&quot;
                Style=&quot;{StaticResource HelpContentStyle}&quot;/&gt;
        &lt;/ScrollViewer&gt;

        &lt;!-- Related Topics Section --&gt;
        &lt;Expander 
            Grid.Row=&quot;2&quot;
            Header=&quot;Related Topics&quot;
            Margin=&quot;0,16,0,0&quot;
            HorizontalAlignment=&quot;Stretch&quot;
            Visibility=&quot;{x:Bind ViewModel.IsRelatedHelpAvailable, Mode=OneWay}&quot;&gt;
            &lt;ListView 
                ItemsSource=&quot;{x:Bind ViewModel.RelatedTopics, Mode=OneWay}&quot;
                SelectionMode=&quot;None&quot;
                IsItemClickEnabled=&quot;True&quot;
                ItemClick=&quot;RelatedTopics_ItemClick&quot;&gt;
                &lt;ListView.ItemTemplate&gt;
                    &lt;DataTemplate x:DataType=&quot;models:Model_HelpContent&quot;&gt;
                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;
                            &lt;mi:MaterialIcon 
                                Kind=&quot;{x:Bind IconKind}&quot;
                                Width=&quot;20&quot; 
                                Height=&quot;20&quot;
                                Margin=&quot;0,0,8,0&quot;/&gt;
                            &lt;TextBlock 
                                Text=&quot;{x:Bind Title}&quot;
                                Style=&quot;{StaticResource RelatedTopicStyle}&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/DataTemplate&gt;
                &lt;/ListView.ItemTemplate&gt;
                &lt;ListView.ItemContainerStyle&gt;
                    &lt;Style TargetType=&quot;ListViewItem&quot;&gt;
                        &lt;Setter Property=&quot;HorizontalContentAlignment&quot; Value=&quot;Stretch&quot;/&gt;
                    &lt;/Style&gt;
                &lt;/ListView.ItemContainerStyle&gt;
            &lt;/ListView&gt;
        &lt;/Expander&gt;

        &lt;!-- Footer Section --&gt;
        &lt;StackPanel Grid.Row=&quot;3&quot; Orientation=&quot;Horizontal&quot; HorizontalAlignment=&quot;Stretch&quot; Margin=&quot;0,12,0,0&quot;&gt;
            &lt;CheckBox 
                Content=&quot;Don&apos;t show this again&quot;
                IsChecked=&quot;{x:Bind ViewModel.IsDismissed, Mode=TwoWay}&quot;
                Visibility=&quot;{x:Bind ViewModel.CanDismiss, Mode=OneWay}&quot;
                HorizontalAlignment=&quot;Left&quot;/&gt;
            
            &lt;Button 
                Content=&quot;Copy&quot;
                Command=&quot;{x:Bind ViewModel.CopyContentCommand}&quot;
                HorizontalAlignment=&quot;Right&quot;
                Margin=&quot;12,0,0,0&quot;&gt;
                &lt;Button.KeyboardAccelerators&gt;
                    &lt;KeyboardAccelerator Key=&quot;C&quot; Modifiers=&quot;Control&quot;/&gt;
                &lt;/Button.KeyboardAccelerators&gt;
            &lt;/Button&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/ContentDialog&gt;</file><file path="Module_Shared/Views/View_Shared_HelpDialog.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Shared.Views;

/// &lt;summary&gt;
/// Centralized help dialog for displaying contextual help content
/// &lt;/summary&gt;
public sealed partial class View_Shared_HelpDialog : ContentDialog
{
    public ViewModel_Shared_HelpDialog ViewModel { get; }

    public View_Shared_HelpDialog()
    {
        ViewModel = App.GetService&lt;ViewModel_Shared_HelpDialog&gt;();
        InitializeComponent();
    }

    /// &lt;summary&gt;
    /// Sets the help content to display in the dialog
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;content&quot;&gt;&lt;/param&gt;
    public void SetHelpContent(Model_HelpContent content)
    {
        _ = ViewModel.LoadHelpContentAsync(content);
    }

    /// &lt;summary&gt;
    /// Handles clicking on a related topic to navigate to it
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
    private async void RelatedTopics_ItemClick(object sender, Microsoft.UI.Xaml.Controls.ItemClickEventArgs e)
    {
        if (e.ClickedItem is Model_HelpContent relatedContent)
        {
            await ViewModel.LoadRelatedTopicAsync(relatedContent);
        }
    }
}</file><file path="Module_Shared/Views/View_Shared_IconSelectorWindow.xaml">&lt;Window
    x:Class=&quot;MTM_Receiving_Application.Module_Shared.Views.View_Shared_IconSelectorWindow&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:materialIcons=&quot;using:Material.Icons.WinUI3&quot;
    mc:Ignorable=&quot;d&quot;
    Title=&quot;Select Icon&quot;&gt;

    &lt;Grid Background=&quot;{ThemeResource ApplicationPageBackgroundThemeBrush}&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Custom Title Bar --&gt;
        &lt;Grid x:Name=&quot;AppTitleBar&quot; Grid.Row=&quot;0&quot; Height=&quot;32&quot; Background=&quot;Transparent&quot;&gt;
            &lt;TextBlock Text=&quot;Icon Library&quot; 
                       VerticalAlignment=&quot;Center&quot; 
                       Margin=&quot;16,0,0,0&quot;
                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;/&gt;
        &lt;/Grid&gt;

        &lt;!-- Header &amp; Search --&gt;
        &lt;Grid Grid.Row=&quot;1&quot; Padding=&quot;32,16,32,16&quot; Background=&quot;{ThemeResource LayerFillColorDefaultBrush}&quot; BorderBrush=&quot;{ThemeResource DividerStrokeColorDefaultBrush}&quot; BorderThickness=&quot;0,0,0,1&quot;&gt;
            &lt;Grid ColumnSpacing=&quot;16&quot;&gt;
                &lt;Grid.ColumnDefinitions&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                &lt;/Grid.ColumnDefinitions&gt;
                
                &lt;TextBox x:Name=&quot;SearchBox&quot; 
                         Grid.Column=&quot;0&quot;
                         PlaceholderText=&quot;Search icons (e.g. &apos;box&apos;, &apos;truck&apos;)...&quot; 
                         TextChanged=&quot;OnSearchTextChanged&quot;
                         Height=&quot;36&quot;
                         CornerRadius=&quot;4&quot;/&gt;
                         
                &lt;CheckBox x:Name=&quot;ShowAllIconsCheckBox&quot; 
                          Grid.Column=&quot;1&quot;
                          Content=&quot;Show all icons&quot; 
                          Checked=&quot;OnShowAllIconsChanged&quot;
                          Unchecked=&quot;OnShowAllIconsChanged&quot;
                          VerticalAlignment=&quot;Center&quot;/&gt;
            &lt;/Grid&gt;
        &lt;/Grid&gt;

        &lt;!-- Icon Grid --&gt;
        &lt;Viewbox Grid.Row=&quot;2&quot; Stretch=&quot;Uniform&quot;&gt;
            &lt;GridView x:Name=&quot;IconGridView&quot; 
                      Padding=&quot;16&quot;
                      SelectionMode=&quot;Single&quot;
                      IsItemClickEnabled=&quot;True&quot;
                      ItemClick=&quot;OnIconItemClick&quot;
                      ScrollViewer.VerticalScrollBarVisibility=&quot;Disabled&quot;
                      Width=&quot;900&quot; Height=&quot;650&quot;&gt;
                &lt;GridView.ItemsPanel&gt;
                    &lt;ItemsPanelTemplate&gt;
                        &lt;ItemsWrapGrid MaximumRowsOrColumns=&quot;4&quot; Orientation=&quot;Horizontal&quot; HorizontalAlignment=&quot;Center&quot;/&gt;
                    &lt;/ItemsPanelTemplate&gt;
                &lt;/GridView.ItemsPanel&gt;
                &lt;GridView.ItemTemplate&gt;
                    &lt;DataTemplate&gt;
                        &lt;Border Width=&quot;200&quot; Height=&quot;140&quot;
                                Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                                BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                                BorderThickness=&quot;1&quot; 
                                CornerRadius=&quot;8&quot;
                                Margin=&quot;8&quot;
                                ToolTipService.ToolTip=&quot;{Binding Name}&quot;&gt;
                            &lt;VisualStateManager.VisualStateGroups&gt;
                                &lt;VisualStateGroup x:Name=&quot;CommonStates&quot;&gt;
                                    &lt;VisualState x:Name=&quot;Normal&quot; /&gt;
                                    &lt;VisualState x:Name=&quot;PointerOver&quot;&gt;
                                        &lt;Storyboard&gt;
                                            &lt;ObjectAnimationUsingKeyFrames Storyboard.TargetName=&quot;ContentPanel&quot; Storyboard.TargetProperty=&quot;Background&quot;&gt;
                                                &lt;DiscreteObjectKeyFrame KeyTime=&quot;0&quot; Value=&quot;{ThemeResource CardBackgroundFillColorSecondaryBrush}&quot; /&gt;
                                            &lt;/ObjectAnimationUsingKeyFrames&gt;
                                        &lt;/Storyboard&gt;
                                    &lt;/VisualState&gt;
                                &lt;/VisualStateGroup&gt;
                            &lt;/VisualStateManager.VisualStateGroups&gt;
                            
                            &lt;StackPanel x:Name=&quot;ContentPanel&quot; VerticalAlignment=&quot;Center&quot; HorizontalAlignment=&quot;Center&quot; Spacing=&quot;12&quot; Padding=&quot;12&quot;&gt;
                                &lt;materialIcons:MaterialIcon Kind=&quot;{Binding Kind}&quot; 
                                          Width=&quot;40&quot; Height=&quot;40&quot;
                                          Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                                &lt;TextBlock Text=&quot;{Binding Name}&quot; 
                                           FontSize=&quot;14&quot; 
                                           TextWrapping=&quot;Wrap&quot; 
                                           TextAlignment=&quot;Center&quot;
                                           HorizontalAlignment=&quot;Center&quot;
                                           MaxLines=&quot;2&quot;
                                           TextTrimming=&quot;CharacterEllipsis&quot;/&gt;
                            &lt;/StackPanel&gt;
                        &lt;/Border&gt;
                    &lt;/DataTemplate&gt;
                &lt;/GridView.ItemTemplate&gt;
            &lt;/GridView&gt;
        &lt;/Viewbox&gt;

        &lt;!-- Footer --&gt;
        &lt;Grid Grid.Row=&quot;3&quot; Padding=&quot;32,20&quot; Background=&quot;{ThemeResource LayerFillColorDefaultBrush}&quot; BorderBrush=&quot;{ThemeResource DividerStrokeColorDefaultBrush}&quot; BorderThickness=&quot;0,1,0,0&quot;&gt;
            &lt;Grid.ColumnDefinitions&gt;
                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
            &lt;/Grid.ColumnDefinitions&gt;
            
            &lt;Button x:Name=&quot;CancelButton&quot; Grid.Column=&quot;0&quot; Content=&quot;Cancel&quot; Click=&quot;OnCancelClick&quot; Width=&quot;100&quot; Height=&quot;36&quot; CornerRadius=&quot;4&quot; HorizontalAlignment=&quot;Left&quot;/&gt;
            
            &lt;StackPanel Grid.Column=&quot;1&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot; HorizontalAlignment=&quot;Center&quot;&gt;
                &lt;Button x:Name=&quot;FirstPageButton&quot; Click=&quot;OnFirstPageClick&quot; Width=&quot;44&quot; Height=&quot;36&quot; CornerRadius=&quot;4&quot; ToolTipService.ToolTip=&quot;First Page&quot;&gt;
                    &lt;materialIcons:MaterialIcon Kind=&quot;PageFirst&quot; Width=&quot;16&quot; Height=&quot;16&quot;/&gt;
                &lt;/Button&gt;
                &lt;Button x:Name=&quot;PreviousPageButton&quot; Click=&quot;OnPreviousPageClick&quot; Width=&quot;44&quot; Height=&quot;36&quot; CornerRadius=&quot;4&quot; ToolTipService.ToolTip=&quot;Previous Page&quot;&gt;
                    &lt;materialIcons:MaterialIcon Kind=&quot;ChevronLeft&quot; Width=&quot;16&quot; Height=&quot;16&quot;/&gt;
                &lt;/Button&gt;
                
                &lt;Border Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot; CornerRadius=&quot;4&quot; Padding=&quot;16,0&quot; Height=&quot;36&quot; BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot; BorderThickness=&quot;1&quot;&gt;
                    &lt;TextBlock x:Name=&quot;PageInfoTextBlock&quot; VerticalAlignment=&quot;Center&quot; Text=&quot;Page 1 of 1&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                &lt;/Border&gt;
                
                &lt;Button x:Name=&quot;NextPageButton&quot; Click=&quot;OnNextPageClick&quot; Width=&quot;44&quot; Height=&quot;36&quot; CornerRadius=&quot;4&quot; ToolTipService.ToolTip=&quot;Next Page&quot;&gt;
                    &lt;materialIcons:MaterialIcon Kind=&quot;ChevronRight&quot; Width=&quot;16&quot; Height=&quot;16&quot;/&gt;
                &lt;/Button&gt;
                &lt;Button x:Name=&quot;LastPageButton&quot; Click=&quot;OnLastPageClick&quot; Width=&quot;44&quot; Height=&quot;36&quot; CornerRadius=&quot;4&quot; ToolTipService.ToolTip=&quot;Last Page&quot;&gt;
                    &lt;materialIcons:MaterialIcon Kind=&quot;PageLast&quot; Width=&quot;16&quot; Height=&quot;16&quot;/&gt;
                &lt;/Button&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;
    &lt;/Grid&gt;
&lt;/Window&gt;</file><file path="Module_Shared/Views/View_Shared_IconSelectorWindow.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Material.Icons;
using MTM_Receiving_Application.Module_Core.Helpers.UI;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using System.Diagnostics;

namespace MTM_Receiving_Application.Module_Shared.Views;

public sealed partial class View_Shared_IconSelectorWindow : Window
{
    private readonly IService_LoggingUtility? _loggingService;
    private List&lt;IconInfo&gt; _allIcons = new();
    private List&lt;IconInfo&gt; _commonIcons = new();
    private List&lt;IconInfo&gt; _filteredIcons = new();
    private int _currentPage = 1;
    private int _totalPages = 1;
    private const int ICONS_PER_PAGE = 16;

    public MaterialIconKind? SelectedIconKind { get; private set; }
    public string? SelectedIconName { get; private set; }
    public bool IconWasSelected { get; private set; }

    private TaskCompletionSource&lt;MaterialIconKind?&gt;? _selectionTaskCompletionSource;

    public View_Shared_IconSelectorWindow()
    {
        InitializeComponent();

        try
        {
            _loggingService = App.GetService&lt;IService_LoggingUtility&gt;();
        }
        catch (Exception ex)
        {
            Debug.WriteLine($&quot;Failed to get logging service: {ex.Message}&quot;);
        }

        // Custom Title Bar
        ExtendsContentIntoTitleBar = true;
        SetTitleBar(AppTitleBar);

        LoadIcons();

        var hwnd = WinRT.Interop.WindowNative.GetWindowHandle(this);
        var windowId = Microsoft.UI.Win32Interop.GetWindowIdFromWindow(hwnd);
        var appWindow = Microsoft.UI.Windowing.AppWindow.GetFromWindowId(windowId);

        var windowSize = new Windows.Graphics.SizeInt32 { Width = 1000, Height = 850 };
        appWindow.Resize(windowSize);

        var displayArea = Microsoft.UI.Windowing.DisplayArea.GetFromWindowId(windowId, Microsoft.UI.Windowing.DisplayAreaFallback.Primary);
        if (displayArea != null)
        {
            var centerX = (displayArea.WorkArea.Width - windowSize.Width) / 2;
            var centerY = (displayArea.WorkArea.Height - windowSize.Height) / 2;
            appWindow.Move(new Windows.Graphics.PointInt32 { X = centerX, Y = centerY });
        }

        // Handle window closing to complete the task
        this.Closed += (s, e) =&gt;
        {
            _selectionTaskCompletionSource?.TrySetResult(IconWasSelected ? SelectedIconKind : null);
        };
    }

    /// &lt;summary&gt;
    /// Sets the initial icon selection in the grid
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;iconKind&quot;&gt;&lt;/param&gt;
    public void SetInitialSelection(MaterialIconKind iconKind)
    {
        SelectedIconKind = iconKind;

        // Find and select the icon in the grid after it loads
        DispatcherQueue.TryEnqueue(() =&gt;
        {
            var iconInfo = _allIcons.FirstOrDefault(i =&gt; i.Kind == iconKind);
            if (iconInfo != null)
            {
                IconGridView.SelectedItem = iconInfo;
                IconGridView.ScrollIntoView(iconInfo);
            }
        });
    }

    /// &lt;summary&gt;
    /// Waits for the user to select an icon or close the window
    /// &lt;/summary&gt;
    public Task&lt;MaterialIconKind?&gt; WaitForSelectionAsync()
    {
        _selectionTaskCompletionSource = new TaskCompletionSource&lt;MaterialIconKind?&gt;();
        return _selectionTaskCompletionSource.Task;
    }

    private void LoadIcons()
    {
        try
        {
            var icons = Helper_MaterialIcons.GetAllIcons();
            _allIcons = icons.ConvertAll(k =&gt; new IconInfo(k.ToString(), k));

            // Define common/curated icons for dunnage and packaging
            var commonIconNames = new HashSet&lt;string&gt;(StringComparer.OrdinalIgnoreCase)
            {
                &quot;PackageVariantClosed&quot;, &quot;PackageVariant&quot;, &quot;Package&quot;, &quot;CubeOutline&quot;, &quot;Cube&quot;,
                &quot;Archive&quot;, &quot;ArchiveOutline&quot;, &quot;Box&quot;, &quot;BoxShadow&quot;,
                &quot;Pallet&quot;, &quot;ForkliftBox&quot;,
                &quot;TruckDelivery&quot;, &quot;TruckCargo&quot;, &quot;Truck&quot;,
                &quot;ScaleBalance&quot;, &quot;Weight&quot;, &quot;WeightKilogram&quot;, &quot;WeightPound&quot;,
                &quot;RulerSquare&quot;, &quot;Ruler&quot;, &quot;Tape&quot;,
                &quot;Label&quot;, &quot;LabelOutline&quot;, &quot;Barcode&quot;, &quot;QrcodeEdit&quot;, &quot;QrcodeScan&quot;,
                &quot;BubbleSheet&quot;, &quot;Wrap&quot;,
                &quot;Layers&quot;, &quot;LayersTriple&quot;, &quot;StackExchange&quot;, &quot;StackOverflow&quot;,
                &quot;FormatWrap&quot;, &quot;SafetyGoggles&quot;, &quot;HardHat&quot;,
                &quot;Tag&quot;, &quot;TagMultiple&quot;, &quot;TagOutline&quot;,
                &quot;WoodBoard&quot;, &quot;Cardboard&quot;, &quot;CardboardBox&quot;,
                &quot;ShieldCheck&quot;, &quot;Shield&quot;, &quot;Security&quot;,
                &quot;CalendarCheck&quot;, &quot;Calendar&quot;, &quot;ClockOutline&quot;,
                &quot;AlertCircle&quot;, &quot;Alert&quot;, &quot;Information&quot;, &quot;CheckCircle&quot;
            };

            _commonIcons = _allIcons
                .Where(i =&gt; commonIconNames.Contains(i.Name))
                .ToList();

            // Start with common icons (unless &quot;Show all&quot; is checked)
            _filteredIcons = ShowAllIconsCheckBox?.IsChecked == true
                ? new List&lt;IconInfo&gt;(_allIcons)
                : new List&lt;IconInfo&gt;(_commonIcons);

            UpdateGridView();
        }
        catch (Exception ex)
        {
            _loggingService?.LogError(&quot;Error loading icons&quot;, ex);
            Debug.WriteLine($&quot;Error loading icons: {ex}&quot;);
        }
    }

    private void UpdateGridView()
    {
        _totalPages = (int)Math.Ceiling((double)_filteredIcons.Count / ICONS_PER_PAGE);
        if (_totalPages == 0)
        {
            _totalPages = 1;
        }

        if (_currentPage &gt; _totalPages)
        {
            _currentPage = _totalPages;
        }

        if (_currentPage &lt; 1)
        {
            _currentPage = 1;
        }

        var pagedIcons = _filteredIcons
            .Skip((_currentPage - 1) * ICONS_PER_PAGE)
            .Take(ICONS_PER_PAGE)
            .ToList();

        IconGridView.ItemsSource = pagedIcons;

        // Update pagination controls
        if (PageInfoTextBlock != null)
        {
            PageInfoTextBlock.Text = $&quot;Page {_currentPage} of {_totalPages}&quot;;
            PreviousPageButton.IsEnabled = _currentPage &gt; 1;
            NextPageButton.IsEnabled = _currentPage &lt; _totalPages;
            FirstPageButton.IsEnabled = _currentPage &gt; 1;
            LastPageButton.IsEnabled = _currentPage &lt; _totalPages;
        }
    }

    private void OnSearchTextChanged(object sender, TextChangedEventArgs e)
    {
        var searchText = SearchBox.Text.ToLower().Trim();
        var sourceList = ShowAllIconsCheckBox?.IsChecked == true ? _allIcons : _commonIcons;

        if (string.IsNullOrWhiteSpace(searchText))
        {
            _filteredIcons = new List&lt;IconInfo&gt;(sourceList);
        }
        else
        {
            _filteredIcons = sourceList
                .Where(i =&gt; i.Name.ToLower().Contains(searchText))
                .ToList();
        }

        _currentPage = 1;
        UpdateGridView();
    }

    private void OnShowAllIconsChanged(object sender, RoutedEventArgs e)
    {
        var searchText = SearchBox.Text.ToLower().Trim();
        var sourceList = ShowAllIconsCheckBox?.IsChecked == true ? _allIcons : _commonIcons;

        if (string.IsNullOrWhiteSpace(searchText))
        {
            _filteredIcons = new List&lt;IconInfo&gt;(sourceList);
        }
        else
        {
            _filteredIcons = sourceList
                .Where(i =&gt; i.Name.ToLower().Contains(searchText))
                .ToList();
        }

        _currentPage = 1;
        UpdateGridView();
    }

    private void OnIconItemClick(object sender, ItemClickEventArgs e)
    {
        if (e.ClickedItem is IconInfo icon)
        {
            SelectedIconKind = icon.Kind;
            SelectedIconName = icon.Name;
            IconWasSelected = true;
            Close();
        }
    }

    private void OnPreviousPageClick(object sender, RoutedEventArgs e)
    {
        if (_currentPage &gt; 1)
        {
            _currentPage--;
            UpdateGridView();
        }
    }

    private void OnNextPageClick(object sender, RoutedEventArgs e)
    {
        if (_currentPage &lt; _totalPages)
        {
            _currentPage++;
            UpdateGridView();
        }
    }

    private void OnFirstPageClick(object sender, RoutedEventArgs e)
    {
        _currentPage = 1;
        UpdateGridView();
    }

    private void OnLastPageClick(object sender, RoutedEventArgs e)
    {
        _currentPage = _totalPages;
        UpdateGridView();
    }

    private void OnCancelClick(object sender, RoutedEventArgs e)
    {
        IconWasSelected = false;
        Close();
    }

    public class IconInfo
    {
        public string Name { get; set; }
        public MaterialIconKind Kind { get; set; }

        public IconInfo(string name, MaterialIconKind kind)
        {
            Name = name;
            Kind = kind;
        }
    }
}</file><file path="Module_Shared/Views/View_Shared_NewUserSetupDialog.xaml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;ContentDialog
    x:Class=&quot;MTM_Receiving_Application.Module_Shared.Views.View_Shared_NewUserSetupDialog&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    Title=&quot;Create Your Account&quot;
    PrimaryButtonText=&quot;Create Account&quot;
    CloseButtonText=&quot;Cancel&quot;
    DefaultButton=&quot;Primary&quot;
    PrimaryButtonStyle=&quot;{StaticResource AccentButtonStyle}&quot;
    Width=&quot;480&quot;&gt;

    &lt;Grid&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header with Icon and Welcome --&gt;
        &lt;StackPanel Grid.Row=&quot;0&quot; Spacing=&quot;8&quot; Padding=&quot;20,16,20,12&quot; Background=&quot;{ThemeResource LayerFillColorDefaultBrush}&quot;&gt;
            &lt;Grid&gt;
                &lt;Grid.ColumnDefinitions&gt;
                    &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;/Grid.ColumnDefinitions&gt;
                
                &lt;FontIcon Grid.Column=&quot;0&quot; 
                          FontFamily=&quot;{StaticResource SymbolThemeFontFamily}&quot; 
                          Glyph=&quot;&amp;#xE77B;&quot; 
                          FontSize=&quot;32&quot;
                          Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;
                          VerticalAlignment=&quot;Center&quot;
                          Margin=&quot;0,0,16,0&quot;/&gt;
                
                &lt;StackPanel Grid.Column=&quot;1&quot; VerticalAlignment=&quot;Center&quot;&gt;
                    &lt;TextBlock Text=&quot;Welcome to MTM Receiving&quot; 
                               Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;
                               FontWeight=&quot;SemiBold&quot;/&gt;
                    &lt;TextBlock Text=&quot;Let&apos;s set up your account to get started&quot; 
                               Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                               Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/Grid&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Main Content - Using Grid for compact two-column layout with ScrollViewer --&gt;
        &lt;ScrollViewer Grid.Row=&quot;1&quot; 
                      VerticalScrollBarVisibility=&quot;Auto&quot; 
                      HorizontalScrollBarVisibility=&quot;Disabled&quot;
                      MaxHeight=&quot;480&quot;&gt;
            &lt;Grid Padding=&quot;20,12&quot; RowSpacing=&quot;12&quot; ColumnSpacing=&quot;12&quot;&gt;
                &lt;Grid.RowDefinitions&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                &lt;/Grid.RowDefinitions&gt;
                &lt;Grid.ColumnDefinitions&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;/Grid.ColumnDefinitions&gt;

            &lt;!-- Row 0: Full Name (spans both columns) --&gt;
            &lt;StackPanel Grid.Row=&quot;0&quot; Grid.ColumnSpan=&quot;2&quot; Spacing=&quot;6&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;FontIcon FontFamily=&quot;{StaticResource SymbolThemeFontFamily}&quot; 
                              Glyph=&quot;&amp;#xE77B;&quot; 
                              FontSize=&quot;16&quot;
                              Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                    &lt;TextBlock Text=&quot;Full Name *&quot; 
                               Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                &lt;/StackPanel&gt;
                &lt;TextBox x:Name=&quot;FullNameTextBox&quot;
                         PlaceholderText=&quot;Enter your full name&quot;
                         MaxLength=&quot;100&quot;
                         TabIndex=&quot;0&quot;/&gt;
            &lt;/StackPanel&gt;

            &lt;!-- Row 1: Employee Number &amp; Windows Username --&gt;
            &lt;StackPanel Grid.Row=&quot;1&quot; Grid.Column=&quot;0&quot; Spacing=&quot;6&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;FontIcon FontFamily=&quot;{StaticResource SymbolThemeFontFamily}&quot; 
                              Glyph=&quot;&amp;#xE8D4;&quot; 
                              FontSize=&quot;16&quot;
                              Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                    &lt;TextBlock Text=&quot;Employee Number *&quot; 
                               Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                &lt;/StackPanel&gt;
                &lt;TextBox x:Name=&quot;EmployeeNumberTextBox&quot;
                         PlaceholderText=&quot;e.g., 6229&quot;
                         MaxLength=&quot;10&quot;
                         TabIndex=&quot;1&quot;
                         InputScope=&quot;Number&quot;/&gt;
            &lt;/StackPanel&gt;

            &lt;StackPanel Grid.Row=&quot;1&quot; Grid.Column=&quot;1&quot; Spacing=&quot;6&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;FontIcon FontFamily=&quot;{StaticResource SymbolThemeFontFamily}&quot; 
                              Glyph=&quot;&amp;#xE910;&quot; 
                              FontSize=&quot;16&quot;
                              Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                    &lt;TextBlock Text=&quot;Windows Username&quot; 
                               Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;
                               Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                &lt;/StackPanel&gt;
                &lt;TextBox x:Name=&quot;WindowsUsernameTextBox&quot;
                         IsReadOnly=&quot;True&quot;
                         Background=&quot;{ThemeResource ControlAltFillColorSecondaryBrush}&quot;
                         TabIndex=&quot;-1&quot;/&gt;
            &lt;/StackPanel&gt;

            &lt;!-- Row 2: Department &amp; Shift --&gt;
            &lt;StackPanel Grid.Row=&quot;2&quot; Grid.Column=&quot;0&quot; Spacing=&quot;6&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;FontIcon FontFamily=&quot;{StaticResource SymbolThemeFontFamily}&quot; 
                              Glyph=&quot;&amp;#xE716;&quot; 
                              FontSize=&quot;16&quot;
                              Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                    &lt;TextBlock Text=&quot;Department *&quot; 
                               Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                &lt;/StackPanel&gt;
                &lt;ComboBox x:Name=&quot;DepartmentComboBox&quot;
                          PlaceholderText=&quot;Select department&quot;
                          HorizontalAlignment=&quot;Stretch&quot;
                          TabIndex=&quot;2&quot;
                          SelectionChanged=&quot;DepartmentComboBox_SelectionChanged&quot;/&gt;
            &lt;/StackPanel&gt;

            &lt;StackPanel Grid.Row=&quot;2&quot; Grid.Column=&quot;1&quot; Spacing=&quot;6&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;FontIcon FontFamily=&quot;{StaticResource SymbolThemeFontFamily}&quot; 
                              Glyph=&quot;&amp;#xE823;&quot; 
                              FontSize=&quot;16&quot;
                              Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                    &lt;TextBlock Text=&quot;Shift *&quot; 
                               Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                &lt;/StackPanel&gt;
                &lt;ComboBox x:Name=&quot;ShiftComboBox&quot;
                          PlaceholderText=&quot;Select shift&quot;
                          HorizontalAlignment=&quot;Stretch&quot;
                          TabIndex=&quot;4&quot;&gt;
                    &lt;ComboBoxItem Content=&quot;1st Shift&quot;/&gt;
                    &lt;ComboBoxItem Content=&quot;2nd Shift&quot;/&gt;
                    &lt;ComboBoxItem Content=&quot;3rd Shift&quot;/&gt;
                &lt;/ComboBox&gt;
            &lt;/StackPanel&gt;

            &lt;!-- Row 3: Custom Department (Visible when &quot;Other&quot; selected, spans both columns) --&gt;
            &lt;StackPanel x:Name=&quot;CustomDepartmentPanel&quot; 
                        Grid.Row=&quot;3&quot; 
                        Grid.ColumnSpan=&quot;2&quot; 
                        Spacing=&quot;6&quot; 
                        Visibility=&quot;Collapsed&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;FontIcon FontFamily=&quot;{StaticResource SymbolThemeFontFamily}&quot; 
                              Glyph=&quot;&amp;#xE70F;&quot; 
                              FontSize=&quot;16&quot;
                              Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                    &lt;TextBlock Text=&quot;Custom Department Name *&quot; 
                               Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                &lt;/StackPanel&gt;
                &lt;TextBox x:Name=&quot;CustomDepartmentTextBox&quot;
                         PlaceholderText=&quot;Enter department name&quot;
                         MaxLength=&quot;50&quot;
                         TabIndex=&quot;3&quot;/&gt;
            &lt;/StackPanel&gt;

            &lt;!-- Row 4: PIN Fields --&gt;
            &lt;StackPanel Grid.Row=&quot;4&quot; Grid.Column=&quot;0&quot; Spacing=&quot;6&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;FontIcon FontFamily=&quot;{StaticResource SymbolThemeFontFamily}&quot; 
                              Glyph=&quot;&amp;#xE72E;&quot; 
                              FontSize=&quot;16&quot;
                              Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                    &lt;TextBlock Text=&quot;4-Digit PIN *&quot; 
                               Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                &lt;/StackPanel&gt;
                &lt;PasswordBox x:Name=&quot;PinPasswordBox&quot;
                             PlaceholderText=&quot;Create PIN&quot;
                             MaxLength=&quot;4&quot;
                             TabIndex=&quot;5&quot;
                             PasswordRevealMode=&quot;Peek&quot;/&gt;
                &lt;TextBlock Text=&quot;For shared terminal login&quot; 
                           Foreground=&quot;{ThemeResource TextFillColorTertiaryBrush}&quot;
                           Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;/&gt;
            &lt;/StackPanel&gt;

            &lt;StackPanel Grid.Row=&quot;4&quot; Grid.Column=&quot;1&quot; Spacing=&quot;6&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;FontIcon FontFamily=&quot;{StaticResource SymbolThemeFontFamily}&quot; 
                              Glyph=&quot;&amp;#xE8C9;&quot; 
                              FontSize=&quot;16&quot;
                              Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                    &lt;TextBlock Text=&quot;Confirm PIN *&quot; 
                               Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                &lt;/StackPanel&gt;
                &lt;PasswordBox x:Name=&quot;ConfirmPinPasswordBox&quot;
                             PlaceholderText=&quot;Re-enter PIN&quot;
                             MaxLength=&quot;4&quot;
                             TabIndex=&quot;6&quot;
                             PasswordRevealMode=&quot;Peek&quot;/&gt;
            &lt;/StackPanel&gt;

            &lt;!-- Row 5: ERP Credentials Section (Optional) --&gt;
            &lt;Expander x:Name=&quot;ErpExpander&quot;
                      Grid.Row=&quot;5&quot; 
                      Grid.ColumnSpan=&quot;2&quot;
                      Header=&quot;ERP System Access (Optional)&quot;
                      IsExpanded=&quot;False&quot;
                      HorizontalAlignment=&quot;Stretch&quot;
                      HorizontalContentAlignment=&quot;Stretch&quot;
                      VerticalContentAlignment=&quot;Stretch&quot;&gt;
                &lt;Expander.HeaderTemplate&gt;
                    &lt;DataTemplate&gt;
                        &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                            &lt;FontIcon FontFamily=&quot;{StaticResource SymbolThemeFontFamily}&quot; 
                                      Glyph=&quot;&amp;#xE89F;&quot; 
                                      FontSize=&quot;16&quot;/&gt;
                            &lt;TextBlock Text=&quot;{Binding}&quot; Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/DataTemplate&gt;
                &lt;/Expander.HeaderTemplate&gt;
                
                &lt;StackPanel Spacing=&quot;12&quot; Padding=&quot;12,8,0,0&quot;&gt;
                    &lt;CheckBox x:Name=&quot;ConfigureErpCheckBox&quot;
                              Content=&quot;Configure Visual/Infor ERP credentials&quot;
                              Checked=&quot;ConfigureErpCheckBox_Checked&quot;
                              Unchecked=&quot;ConfigureErpCheckBox_Unchecked&quot;
                              TabIndex=&quot;7&quot;/&gt;

                    &lt;StackPanel x:Name=&quot;ErpCredentialsPanel&quot; Spacing=&quot;12&quot; Visibility=&quot;Collapsed&quot;&gt;
                        &lt;InfoBar Severity=&quot;Warning&quot; 
                                 IsOpen=&quot;True&quot; 
                                 IsClosable=&quot;False&quot;
                                 Message=&quot;Credentials are stored in plain text for ERP integration.&quot;/&gt;
                        
                        &lt;StackPanel Spacing=&quot;6&quot;&gt;
                            &lt;TextBlock Text=&quot;Visual/Infor Username&quot; 
                                       Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                            &lt;TextBox x:Name=&quot;VisualUsernameTextBox&quot;
                                     PlaceholderText=&quot;ERP username&quot;
                                     MaxLength=&quot;50&quot;
                                     TabIndex=&quot;8&quot;/&gt;
                        &lt;/StackPanel&gt;

                        &lt;StackPanel Spacing=&quot;6&quot;&gt;
                            &lt;TextBlock Text=&quot;Visual/Infor Password&quot; 
                                       Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                            &lt;PasswordBox x:Name=&quot;VisualPasswordBox&quot;
                                         PlaceholderText=&quot;ERP password&quot;
                                         MaxLength=&quot;100&quot;
                                         TabIndex=&quot;9&quot;
                                         PasswordRevealMode=&quot;Peek&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/StackPanel&gt;
                &lt;/StackPanel&gt;
            &lt;/Expander&gt;
            &lt;/Grid&gt;
        &lt;/ScrollViewer&gt;

        &lt;!-- Footer: Status Bar &amp; Progress --&gt;
        &lt;StackPanel Grid.Row=&quot;2&quot; Spacing=&quot;6&quot; Padding=&quot;20,8,20,16&quot;&gt;
            &lt;ProgressBar x:Name=&quot;LoadingProgressBar&quot; 
                         IsIndeterminate=&quot;True&quot; 
                         Visibility=&quot;Collapsed&quot;
                         Height=&quot;4&quot;/&gt;
            
            &lt;InfoBar x:Name=&quot;StatusInfoBar&quot;
                     IsOpen=&quot;False&quot;
                     IsClosable=&quot;True&quot;/&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/ContentDialog&gt;</file><file path="Module_Shared/Views/View_Shared_NewUserSetupDialog.xaml.cs">using System;
using System.Linq;
using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Shared.Views
{
    /// &lt;summary&gt;
    /// Dialog for creating new user accounts when Windows username is not found in database.
    /// Allows supervisor to create account with full name, department, shift, and PIN.
    /// &lt;/summary&gt;
    public sealed partial class View_Shared_NewUserSetupDialog : ContentDialog
    {
        public ViewModel_Shared_NewUserSetup ViewModel { get; }

        /// &lt;summary&gt;
        /// Constructor with ViewModel injection
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;viewModel&quot;&gt;&lt;/param&gt;
        public View_Shared_NewUserSetupDialog(ViewModel_Shared_NewUserSetup viewModel)
        {
            InitializeComponent();
            ViewModel = viewModel ?? throw new ArgumentNullException(nameof(viewModel));

            // Wire up event handlers
            PrimaryButtonClick += OnCreateAccountButtonClick;
            CloseButtonClick += OnCancelButtonClick;
            Closing += OnDialogClosing;
            Loaded += OnDialogLoaded;
        }

        /// &lt;summary&gt;
        /// Handle dialog closing event (including X button)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;args&quot;&gt;&lt;/param&gt;
        private void OnDialogClosing(ContentDialog sender, ContentDialogClosingEventArgs args)
        {
            // If user closes with X or Cancel button, mark as cancelled
            if (args.Result != ContentDialogResult.Primary)
            {
                ViewModel.IsCancelled = true;
            }
        }

        /// &lt;summary&gt;
        /// Initialize dialog when loaded
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        private async void OnDialogLoaded(object sender, RoutedEventArgs e)
        {
            // Set Windows username (read-only)
            WindowsUsernameTextBox.Text = ViewModel.WindowsUsername;

            // Load departments from database
            await LoadDepartmentsAsync();

            // Set focus to full name field
            FullNameTextBox.Focus(FocusState.Programmatic);
        }

        /// &lt;summary&gt;
        /// Load departments from database and populate ComboBox
        /// &lt;/summary&gt;
        private async System.Threading.Tasks.Task LoadDepartmentsAsync()
        {
            try
            {
                await ViewModel.LoadDepartmentsAsync();

                // Clear and populate ComboBox
                DepartmentComboBox.Items.Clear();

                foreach (var dept in ViewModel.Departments)
                {
                    DepartmentComboBox.Items.Add(dept);
                }

                // Add &quot;Other&quot; option
                DepartmentComboBox.Items.Add(&quot;Other&quot;);
            }
            catch (Exception ex)
            {
                StatusInfoBar.Title = &quot;Error Loading Departments&quot;;
                StatusInfoBar.Message = $&quot;Failed to load departments: {ex.Message}&quot;;
                StatusInfoBar.Severity = InfoBarSeverity.Warning;
                StatusInfoBar.IsOpen = true;
            }
        }

        /// &lt;summary&gt;
        /// Handle Department ComboBox selection change
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        private void DepartmentComboBox_SelectionChanged(object sender, SelectionChangedEventArgs e)
        {
            if (DepartmentComboBox.SelectedItem != null)
            {
                string selectedDept = DepartmentComboBox.SelectedItem.ToString() ?? string.Empty;

                // Show/hide custom department field based on selection
                if (selectedDept == &quot;Other&quot;)
                {
                    CustomDepartmentPanel.Visibility = Visibility.Visible;
                    ViewModel.ShowCustomDepartment = true;
                    CustomDepartmentTextBox.Focus(FocusState.Programmatic);
                }
                else
                {
                    CustomDepartmentPanel.Visibility = Visibility.Collapsed;
                    ViewModel.ShowCustomDepartment = false;
                    ViewModel.Department = selectedDept;
                }
            }
        }

        /// &lt;summary&gt;
        /// Handle ERP configuration checkbox checked
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        private void ConfigureErpCheckBox_Checked(object sender, RoutedEventArgs e)
        {
            ErpCredentialsPanel.Visibility = Visibility.Visible;
            ViewModel.ConfigureErpAccess = true;

            // Ensure expander is expanded to show the content
            if (!ErpExpander.IsExpanded)
            {
                ErpExpander.IsExpanded = true;
            }

            // Set focus to first ERP field after a brief delay to allow UI to render
            _ = DispatcherQueue.TryEnqueue(Microsoft.UI.Dispatching.DispatcherQueuePriority.Normal, () =&gt;
            {
                VisualUsernameTextBox.Focus(FocusState.Programmatic);
            });
        }

        /// &lt;summary&gt;
        /// Handle ERP configuration checkbox unchecked
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        private void ConfigureErpCheckBox_Unchecked(object sender, RoutedEventArgs e)
        {
            ErpCredentialsPanel.Visibility = Visibility.Collapsed;
            ViewModel.ConfigureErpAccess = false;

            // Clear ERP fields when unchecked
            VisualUsernameTextBox.Text = string.Empty;
            VisualPasswordBox.Password = string.Empty;
        }

        /// &lt;summary&gt;
        /// Handle Create Account button click
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;args&quot;&gt;&lt;/param&gt;
        private async void OnCreateAccountButtonClick(ContentDialog sender, ContentDialogButtonClickEventArgs args)
        {
            args.Cancel = true;

            // Clear previous errors
            StatusInfoBar.IsOpen = false;

            // Collect form data
            string employeeNumber = EmployeeNumberTextBox.Text?.Trim() ?? string.Empty;
            string fullName = FullNameTextBox.Text?.Trim() ?? string.Empty;
            string department = DepartmentComboBox.SelectedItem?.ToString() ?? string.Empty;
            string customDepartment = CustomDepartmentTextBox.Text?.Trim() ?? string.Empty;
            string shift = (ShiftComboBox.SelectedItem as ComboBoxItem)?.Content?.ToString() ?? string.Empty;
            string pin = PinPasswordBox.Password?.Trim() ?? string.Empty;
            string confirmPin = ConfirmPinPasswordBox.Password?.Trim() ?? string.Empty;

            // Use custom department if &quot;Other&quot; selected
            if (department == &quot;Other&quot;)
            {
                department = customDepartment;
            }

            // Validate all fields
            if (string.IsNullOrWhiteSpace(employeeNumber))
            {
                ShowValidationError(&quot;Employee Number is required.&quot;);
                EmployeeNumberTextBox.Focus(FocusState.Programmatic);
                return;
            }

            if (!int.TryParse(employeeNumber, out int empNum) || empNum &lt;= 0)
            {
                ShowValidationError(&quot;Employee Number must be a positive number.&quot;);
                EmployeeNumberTextBox.Focus(FocusState.Programmatic);
                return;
            }

            if (string.IsNullOrWhiteSpace(fullName))
            {
                ShowValidationError(&quot;Full Name is required.&quot;);
                FullNameTextBox.Focus(FocusState.Programmatic);
                return;
            }

            if (fullName.Length &lt; 2)
            {
                ShowValidationError(&quot;Full Name must be at least 2 characters.&quot;);
                FullNameTextBox.Focus(FocusState.Programmatic);
                return;
            }

            if (string.IsNullOrWhiteSpace(department))
            {
                ShowValidationError(&quot;Department is required.&quot;);
                DepartmentComboBox.Focus(FocusState.Programmatic);
                return;
            }

            if (string.IsNullOrWhiteSpace(shift))
            {
                ShowValidationError(&quot;Shift is required.&quot;);
                ShiftComboBox.Focus(FocusState.Programmatic);
                return;
            }

            if (string.IsNullOrWhiteSpace(pin))
            {
                ShowValidationError(&quot;PIN is required.&quot;);
                PinPasswordBox.Focus(FocusState.Programmatic);
                return;
            }

            if (pin.Length != 4 || !pin.All(char.IsDigit))
            {
                ShowValidationError(&quot;PIN must be exactly 4 numeric digits.&quot;);
                PinPasswordBox.Password = string.Empty;
                ConfirmPinPasswordBox.Password = string.Empty;
                PinPasswordBox.Focus(FocusState.Programmatic);
                return;
            }

            if (pin != confirmPin)
            {
                ShowValidationError(&quot;PINs do not match. Please try again.&quot;);
                ConfirmPinPasswordBox.Password = string.Empty;
                ConfirmPinPasswordBox.Focus(FocusState.Programmatic);
                return;
            }

            // Set loading state
            SetLoadingState(true);

            // Update ViewModel properties
            ViewModel.EmployeeNumber = employeeNumber;
            ViewModel.FullName = fullName;
            ViewModel.Department = department;
            ViewModel.Shift = shift;
            ViewModel.Pin = pin;

            // Update ERP credentials if configured
            if (ViewModel.ConfigureErpAccess)
            {
                ViewModel.VisualUsername = VisualUsernameTextBox.Text?.Trim();
                ViewModel.VisualPassword = VisualPasswordBox.Password?.Trim();
            }

            // Attempt to create account
            bool success = await ViewModel.CreateAccountAsync();

            // Restore normal state
            SetLoadingState(false);

            if (success)
            {
                // Show success message with employee number
                StatusInfoBar.Title = &quot;Account Created Successfully!&quot;;
                StatusInfoBar.Message = $&quot;Your employee number is: {ViewModel.NewEmployeeNumber}. Welcome to the team!&quot;;
                StatusInfoBar.Severity = InfoBarSeverity.Success;
                StatusInfoBar.IsOpen = true;

                // Wait a moment for user to see success message
                await System.Threading.Tasks.Task.Delay(2000);

                // Close dialog
                Hide();
            }
            else
            {
                // Show error message
                ShowValidationError(ViewModel.ErrorMessage ?? &quot;Failed to create account. Please try again.&quot;);
            }
        }

        /// &lt;summary&gt;
        /// Handle Cancel button click
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;args&quot;&gt;&lt;/param&gt;
        private void OnCancelButtonClick(ContentDialog sender, ContentDialogButtonClickEventArgs args)
        {
            // User cancelled account creation
            ViewModel.IsCancelled = true;
        }

        /// &lt;summary&gt;
        /// Show validation error in InfoBar
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;
        private void ShowValidationError(string message)
        {
            StatusInfoBar.Title = &quot;Validation Error&quot;;
            StatusInfoBar.Message = message;
            StatusInfoBar.Severity = InfoBarSeverity.Error;
            StatusInfoBar.IsOpen = true;
        }

        /// &lt;summary&gt;
        /// Set loading state (disable controls, show progress bar)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;isLoading&quot;&gt;&lt;/param&gt;
        private void SetLoadingState(bool isLoading)
        {
            // Disable/enable input controls
            FullNameTextBox.IsEnabled = !isLoading;
            DepartmentComboBox.IsEnabled = !isLoading;
            CustomDepartmentTextBox.IsEnabled = !isLoading;
            ShiftComboBox.IsEnabled = !isLoading;
            PinPasswordBox.IsEnabled = !isLoading;
            ConfirmPinPasswordBox.IsEnabled = !isLoading;

            // Disable/enable buttons
            IsPrimaryButtonEnabled = !isLoading;
            IsSecondaryButtonEnabled = !isLoading;

            // Show/hide progress bar
            LoadingProgressBar.Visibility = isLoading ? Visibility.Visible : Visibility.Collapsed;

            if (isLoading)
            {
                StatusInfoBar.Title = &quot;Creating Account&quot;;
                StatusInfoBar.Message = &quot;Please wait while we create your account...&quot;;
                StatusInfoBar.Severity = InfoBarSeverity.Informational;
                StatusInfoBar.IsOpen = true;
            }
        }
    }
}</file><file path="Module_Shared/Views/View_Shared_SharedTerminalLoginDialog.xaml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;ContentDialog
    x:Class=&quot;MTM_Receiving_Application.Module_Shared.Views.View_Shared_SharedTerminalLoginDialog&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    Title=&quot;Shared Terminal Login&quot;
    PrimaryButtonText=&quot;Login&quot;
    CloseButtonText=&quot;Cancel&quot;
    DefaultButton=&quot;Primary&quot;
    PrimaryButtonStyle=&quot;{StaticResource AccentButtonStyle}&quot;
    Width=&quot;400&quot;&gt;

    &lt;StackPanel Spacing=&quot;16&quot; Padding=&quot;8&quot;&gt;
        &lt;!-- Instructions --&gt;
        &lt;TextBlock 
            Text=&quot;Please enter your credentials to continue&quot;
            TextWrapping=&quot;Wrap&quot;
            Style=&quot;{StaticResource BodyTextBlockStyle}&quot;/&gt;

        &lt;!-- Username Field --&gt;
        &lt;StackPanel Spacing=&quot;4&quot;&gt;
            &lt;TextBlock Text=&quot;Username&quot; Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;/&gt;
            &lt;TextBox 
                x:Name=&quot;UsernameTextBox&quot;
                PlaceholderText=&quot;Enter your username&quot;
                MaxLength=&quot;50&quot;
                TabIndex=&quot;0&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- PIN Field --&gt;
        &lt;StackPanel Spacing=&quot;4&quot;&gt;
            &lt;TextBlock Text=&quot;4-Digit PIN&quot; Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;/&gt;
            &lt;PasswordBox 
                x:Name=&quot;PinPasswordBox&quot;
                PlaceholderText=&quot;Enter 4-digit PIN&quot;
                MaxLength=&quot;4&quot;
                TabIndex=&quot;1&quot;
                PasswordRevealMode=&quot;Peek&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Attempt Counter (Hidden initially, shown after first failure) --&gt;
        &lt;TextBlock 
            x:Name=&quot;AttemptCounterTextBlock&quot;
            Foreground=&quot;Gold&quot;
            Visibility=&quot;Collapsed&quot;
            TextWrapping=&quot;Wrap&quot;
            Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;/&gt;

        &lt;!-- Error InfoBar --&gt;
        &lt;InfoBar 
            x:Name=&quot;ErrorInfoBar&quot;
            Severity=&quot;Error&quot;
            IsOpen=&quot;False&quot;
            IsClosable=&quot;True&quot;
            Title=&quot;Login Failed&quot;
            Message=&quot;Invalid username or PIN. Please try again.&quot;/&gt;

    &lt;/StackPanel&gt;
&lt;/ContentDialog&gt;</file><file path="Module_Shared/Views/View_Shared_SharedTerminalLoginDialog.xaml.cs">using System;
using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Shared.Views
{
    /// &lt;summary&gt;
    /// Dialog for PIN-based authentication on shared terminals.
    /// Allows username + 4-digit PIN entry with 3-attempt limit.
    /// &lt;/summary&gt;
    public sealed partial class View_Shared_SharedTerminalLoginDialog : ContentDialog
    {
        public ViewModel_Shared_SharedTerminalLogin ViewModel { get; }
        private int _attemptCount = 0;
        private const int MaxAttempts = 3;
        private readonly IService_Focus _focusService;

        /// &lt;summary&gt;
        /// Constructor with ViewModel injection
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;viewModel&quot;&gt;&lt;/param&gt;
        public View_Shared_SharedTerminalLoginDialog(ViewModel_Shared_SharedTerminalLogin viewModel)
        {
            InitializeComponent();
            ViewModel = viewModel ?? throw new ArgumentNullException(nameof(viewModel));
            _focusService = App.GetService&lt;IService_Focus&gt;();

            // Wire up event handlers
            PrimaryButtonClick += OnPrimaryButtonClick;
            CloseButtonClick += OnCloseButtonClick;
            _focusService.AttachFocusOnVisibility(this, UsernameTextBox);
        }

        /// &lt;summary&gt;
        /// Handles the Login button click
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;args&quot;&gt;&lt;/param&gt;
        private async void OnPrimaryButtonClick(ContentDialog sender, ContentDialogButtonClickEventArgs args)
        {
            args.Cancel = true;

            // Clear previous errors
            ErrorInfoBar.IsOpen = false;

            // Validate input
            string username = UsernameTextBox.Text?.Trim() ?? string.Empty;
            string pin = PinPasswordBox.Password?.Trim() ?? string.Empty;

            if (string.IsNullOrWhiteSpace(username))
            {
                ErrorInfoBar.Title = &quot;Validation Error&quot;;
                ErrorInfoBar.Message = &quot;Username is required.&quot;;
                ErrorInfoBar.IsOpen = true;
                UsernameTextBox.Focus(FocusState.Programmatic);
                return;
            }

            if (string.IsNullOrWhiteSpace(pin))
            {
                ErrorInfoBar.Title = &quot;Validation Error&quot;;
                ErrorInfoBar.Message = &quot;PIN is required.&quot;;
                ErrorInfoBar.IsOpen = true;
                PinPasswordBox.Focus(FocusState.Programmatic);
                return;
            }

            if (pin.Length != 4 || !int.TryParse(pin, out _))
            {
                ErrorInfoBar.Title = &quot;Validation Error&quot;;
                ErrorInfoBar.Message = &quot;PIN must be exactly 4 numeric digits.&quot;;
                ErrorInfoBar.IsOpen = true;
                PinPasswordBox.Password = string.Empty;
                PinPasswordBox.Focus(FocusState.Programmatic);
                return;
            }

            // Attempt authentication via ViewModel
            ViewModel.Username = username;
            ViewModel.Pin = pin;

            bool success = await ViewModel.LoginAsync();

            if (success)
            {
                // Authentication successful - close dialog
                Hide();
            }
            else
            {
                // Authentication failed
                _attemptCount++;
                ViewModel.AttemptCount = _attemptCount;

                // Clear PIN field
                PinPasswordBox.Password = string.Empty;
                PinPasswordBox.Focus(FocusState.Programmatic);

                // Show error
                ErrorInfoBar.Title = &quot;Login Failed&quot;;
                ErrorInfoBar.Message = ViewModel.ErrorMessage ?? &quot;Invalid username or PIN. Please try again.&quot;;
                ErrorInfoBar.IsOpen = true;

                // Update attempt counter display
                if (_attemptCount &lt; MaxAttempts)
                {
                    AttemptCounterTextBlock.Text = $&quot;Attempt {_attemptCount} of {MaxAttempts}&quot;;
                    AttemptCounterTextBlock.Visibility = Visibility.Visible;
                }
                else
                {
                    // Maximum attempts reached - show lockout message
                    AttemptCounterTextBlock.Foreground = new Microsoft.UI.Xaml.Media.SolidColorBrush(
                        Microsoft.UI.Colors.Red);
                    AttemptCounterTextBlock.Text = &quot;Maximum login attempts exceeded. Application closing for security.&quot;;
                    AttemptCounterTextBlock.Visibility = Visibility.Visible;

                    ErrorInfoBar.Title = &quot;Account Locked&quot;;
                    ErrorInfoBar.Message = &quot;Too many failed login attempts. The application will close.&quot;;
                    ErrorInfoBar.Severity = InfoBarSeverity.Error;
                    ErrorInfoBar.IsOpen = true;

                    // Disable input controls
                    UsernameTextBox.IsEnabled = false;
                    PinPasswordBox.IsEnabled = false;
                    IsPrimaryButtonEnabled = false;
                    IsSecondaryButtonEnabled = false;

                    // Wait 5 seconds then close dialog with failure result
                    await System.Threading.Tasks.Task.Delay(5000);

                    // Signal to caller that lockout occurred
                    ViewModel.IsLockedOut = true;
                    Hide();
                }
            }
        }

        /// &lt;summary&gt;
        /// Handles the Cancel button click
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;args&quot;&gt;&lt;/param&gt;
        private void OnCloseButtonClick(ContentDialog sender, ContentDialogButtonClickEventArgs args)
        {
            // User cancelled login
            ViewModel.IsCancelled = true;
        }
    }
}</file><file path="Module_Shared/Views/View_Shared_SplashScreenWindow.xaml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;Window
    x:Class=&quot;MTM_Receiving_Application.Module_Shared.Views.View_Shared_SplashScreenWindow&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    Title=&quot;MTM Receiving Application&quot;   
    &gt;

    &lt;Grid Background=&quot;{ThemeResource LayerFillColorDefaultBrush}&quot; Padding=&quot;32&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Logo and Branding --&gt;
        &lt;StackPanel Grid.Row=&quot;1&quot; HorizontalAlignment=&quot;Center&quot; Spacing=&quot;12&quot;&gt;
            &lt;FontIcon FontFamily=&quot;Segoe Fluent Icons&quot; 
                      Glyph=&quot;&amp;#xE8F1;&quot; 
                      FontSize=&quot;64&quot;
                      Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;
                      HorizontalAlignment=&quot;Center&quot;/&gt;
            
            &lt;TextBlock Text=&quot;MTM Receiving Application&quot; 
                       Style=&quot;{StaticResource TitleTextBlockStyle}&quot;
                       HorizontalAlignment=&quot;Center&quot;
                       FontWeight=&quot;SemiBold&quot;/&gt;
            
            &lt;TextBlock Text=&quot;Version 1.0.0&quot;
                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                       HorizontalAlignment=&quot;Center&quot;/&gt;
            
            &lt;TextBlock Text=&quot;MTM Manufacturing&quot;
                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                       Foreground=&quot;{ThemeResource TextFillColorTertiaryBrush}&quot;
                       HorizontalAlignment=&quot;Center&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Progress Section --&gt;
        &lt;StackPanel Grid.Row=&quot;2&quot; Margin=&quot;0,40,0,0&quot; Spacing=&quot;12&quot;&gt;
            &lt;TextBlock x:Name=&quot;StatusMessageTextBlock&quot;
                       Text=&quot;Initializing...&quot;
                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                       HorizontalAlignment=&quot;Center&quot;
                       TextAlignment=&quot;Center&quot;
                       TextWrapping=&quot;Wrap&quot;/&gt;

            &lt;ProgressBar x:Name=&quot;MainProgressBar&quot;
                         Height=&quot;4&quot;
                         Minimum=&quot;0&quot;
                         Maximum=&quot;100&quot;
                         Value=&quot;0&quot;
                         HorizontalAlignment=&quot;Stretch&quot;/&gt;

            &lt;TextBlock x:Name=&quot;ProgressPercentageTextBlock&quot;
                       Text=&quot;0%&quot;
                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                       HorizontalAlignment=&quot;Center&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Copyright --&gt;
        &lt;TextBlock Grid.Row=&quot;3&quot;
                   Text=&quot; 2025 MTM Manufacturing. All rights reserved.&quot;
                   Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                   Foreground=&quot;{ThemeResource TextFillColorTertiaryBrush}&quot;
                   HorizontalAlignment=&quot;Center&quot;
                   Margin=&quot;0,28,0,0&quot;/&gt;
    &lt;/Grid&gt;
&lt;/Window&gt;</file><file path="Module_Shared/Views/View_Shared_SplashScreenWindow.xaml.cs">using Microsoft.UI.Xaml;
using MTM_Receiving_Application.Module_Core.Helpers.UI;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Shared.Views
{
    /// &lt;summary&gt;
    /// Splash screen window displayed during application startup
    /// Shows branding, progress, and status messages during initialization
    /// Window size: 500x450 pixels (optimized for dialog display)
    /// &lt;/summary&gt;
    public sealed partial class View_Shared_SplashScreenWindow : Window
    {
        private const int WindowWidth = 850;
        private const int WindowHeight = 700;

        public ViewModel_Shared_SplashScreen ViewModel { get; }

        /// &lt;summary&gt;
        /// Flag to indicate if the window is being closed programmatically by the application logic.
        /// If false (default), it means the user closed the window manually, which should exit the application.
        /// &lt;/summary&gt;
        public bool IsProgrammaticClose { get; set; } = false;

        public View_Shared_SplashScreenWindow(ViewModel_Shared_SplashScreen viewModel)
        {
            ViewModel = viewModel;
            InitializeComponent();

            // Subscribe to ViewModel property changes
            ViewModel.PropertyChanged += ViewModel_PropertyChanged;

            // Configure window appearance and size
            ConfigureWindow();

            // Handle manual closure
            this.Closed += SplashScreenWindow_Closed;
        }

        private void SplashScreenWindow_Closed(object sender, WindowEventArgs args)
        {
            // If the user manually closes the splash screen (e.g. via Alt+F4 or taskbar),
            // we must ensure the application process terminates.
            if (!IsProgrammaticClose)
            {
                Application.Current.Exit();
            }
        }

        /// &lt;summary&gt;
        /// Configure window appearance, size, and position
        /// &lt;/summary&gt;
        private void ConfigureWindow()
        {
            // Use custom title bar with transparent styling
            this.UseCustomTitleBar();
            this.HideTitleBarIcon();
            this.MakeTitleBarTransparent();

            // Set fixed window size
            this.SetWindowSize(WindowWidth, WindowHeight);
            this.SetFixedSize(disableMaximize: true, disableMinimize: true);

            // Center on screen
            this.CenterOnScreen();
        }

        /// &lt;summary&gt;
        /// Handle ViewModel property changes and update UI
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        private void ViewModel_PropertyChanged(object? sender, System.ComponentModel.PropertyChangedEventArgs e)
        {
            DispatcherQueue.TryEnqueue(Microsoft.UI.Dispatching.DispatcherQueuePriority.Normal, () =&gt;
            {
                StatusMessageTextBlock.Text = ViewModel.StatusMessage;
                MainProgressBar.Value = ViewModel.ProgressPercentage;
                MainProgressBar.IsIndeterminate = ViewModel.IsIndeterminate;
                ProgressPercentageTextBlock.Text = ViewModel.IsIndeterminate ? &quot;&quot; : $&quot;{ViewModel.ProgressPercentage}%&quot;;
            });
        }
    }
}</file><file path="Module_Volvo/Views/View_Volvo_History.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Volvo.ViewModels;

namespace MTM_Receiving_Application.Module_Volvo.Views;

/// &lt;summary&gt;
/// Page for viewing and managing Volvo shipment history
/// &lt;/summary&gt;
public sealed partial class View_Volvo_History : Page
{
    public ViewModel_Volvo_History ViewModel { get; }

    public View_Volvo_History()
    {
        ViewModel = App.GetService&lt;ViewModel_Volvo_History&gt;();
        InitializeComponent();
    }

    private async void OnPageLoaded(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
    {
        // Auto-filter on page load (last 30 days)
        await ViewModel.FilterCommand.ExecuteAsync(null);
    }
}</file><file path="Module_Volvo/Views/View_Volvo_Settings.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Volvo.ViewModels;

namespace MTM_Receiving_Application.Module_Volvo.Views;

/// &lt;summary&gt;
/// Settings view for Volvo parts master data management
/// &lt;/summary&gt;
public sealed partial class View_Volvo_Settings : Page
{
    public ViewModel_Volvo_Settings ViewModel { get; }

    public View_Volvo_Settings()
    {
        ViewModel = App.GetService&lt;ViewModel_Volvo_Settings&gt;();
        InitializeComponent();
    }

    private async void OnPageLoaded(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
    {
        await ViewModel.RefreshCommand.ExecuteAsync(null);
    }
}</file><file path="Module_Core/Behaviors/AuditBehavior.cs">using System;
using System.Threading;
using System.Threading.Tasks;
using MediatR;
using Microsoft.Extensions.Logging;

namespace MTM_Receiving_Application.Module_Core.Behaviors
{
    /// &lt;summary&gt;
    /// Global pipeline behavior that adds audit context to all requests.
    /// Automatically applied to ALL handlers in ALL modules.
    /// Logs user context, machine name, and timestamp for compliance and troubleshooting.
    /// &lt;/summary&gt;
    /// &lt;typeparam name=&quot;TRequest&quot;&gt;The request type.&lt;/typeparam&gt;
    /// &lt;typeparam name=&quot;TResponse&quot;&gt;The response type.&lt;/typeparam&gt;
    public class AuditBehavior&lt;TRequest, TResponse&gt; : IPipelineBehavior&lt;TRequest, TResponse&gt;
        where TRequest : IRequest&lt;TResponse&gt;
    {
        private readonly ILogger&lt;AuditBehavior&lt;TRequest, TResponse&gt;&gt; _logger;

        public AuditBehavior(ILogger&lt;AuditBehavior&lt;TRequest, TResponse&gt;&gt; logger)
        {
            _logger = logger;
        }

        public async Task&lt;TResponse&gt; Handle(
            TRequest request,
            RequestHandlerDelegate&lt;TResponse&gt; next,
            CancellationToken cancellationToken)
        {
            var requestName = typeof(TRequest).Name;

            // Capture audit context
            var userId = Environment.UserName; // TODO: Replace with authenticated user from IService_Authentication
            var timestamp = DateTime.UtcNow;
            var machineName = Environment.MachineName;

            _logger.LogInformation(
                &quot;Audit: User {UserId} executing {RequestName} at {Timestamp} from {MachineName}&quot;,
                userId,
                requestName,
                timestamp,
                machineName);

            // Proceed to next behavior or handler
            return await next();
        }
    }
}</file><file path="Module_Core/Behaviors/LoggingBehavior.cs">using System;
using System.Diagnostics;
using System.Threading;
using System.Threading.Tasks;
using MediatR;
using Microsoft.Extensions.Logging;

namespace MTM_Receiving_Application.Module_Core.Behaviors
{
    /// &lt;summary&gt;
    /// Global pipeline behavior that logs all MediatR requests.
    /// Automatically applied to ALL handlers in ALL modules.
    /// &lt;/summary&gt;
    /// &lt;typeparam name=&quot;TRequest&quot;&gt;The request type.&lt;/typeparam&gt;
    /// &lt;typeparam name=&quot;TResponse&quot;&gt;The response type.&lt;/typeparam&gt;
    public class LoggingBehavior&lt;TRequest, TResponse&gt; : IPipelineBehavior&lt;TRequest, TResponse&gt;
        where TRequest : IRequest&lt;TResponse&gt;
    {
        private readonly ILogger&lt;LoggingBehavior&lt;TRequest, TResponse&gt;&gt; _logger;

        public LoggingBehavior(ILogger&lt;LoggingBehavior&lt;TRequest, TResponse&gt;&gt; logger)
        {
            _logger = logger;
        }

        public async Task&lt;TResponse&gt; Handle(
            TRequest request,
            RequestHandlerDelegate&lt;TResponse&gt; next,
            CancellationToken cancellationToken)
        {
            var requestName = typeof(TRequest).Name;
            var requestGuid = Guid.NewGuid().ToString();

            _logger.LogInformation(
                &quot;[{RequestGuid}] Handling {RequestName}&quot;,
                requestGuid,
                requestName);

            var stopwatch = Stopwatch.StartNew();

            try
            {
                var response = await next();

                stopwatch.Stop();

                _logger.LogInformation(
                    &quot;[{RequestGuid}] Handled {RequestName} in {ElapsedMilliseconds}ms&quot;,
                    requestGuid,
                    requestName,
                    stopwatch.ElapsedMilliseconds);

                return response;
            }
            catch (Exception ex)
            {
                stopwatch.Stop();

                _logger.LogError(
                    ex,
                    &quot;[{RequestGuid}] Error handling {RequestName} after {ElapsedMilliseconds}ms: {ErrorMessage}&quot;,
                    requestGuid,
                    requestName,
                    stopwatch.ElapsedMilliseconds,
                    ex.Message);

                throw;
            }
        }
    }
}</file><file path="Module_Core/Behaviors/ValidationBehavior.cs">using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading;
using System.Threading.Tasks;
using FluentValidation;
using MediatR;

namespace MTM_Receiving_Application.Module_Core.Behaviors
{
    /// &lt;summary&gt;
    /// Global pipeline behavior that validates commands using FluentValidation.
    /// Automatically applied to ALL commands in ALL modules.
    /// Validation occurs BEFORE the handler executes.
    /// &lt;/summary&gt;
    /// &lt;typeparam name=&quot;TRequest&quot;&gt;The request type.&lt;/typeparam&gt;
    /// &lt;typeparam name=&quot;TResponse&quot;&gt;The response type.&lt;/typeparam&gt;
    public class ValidationBehavior&lt;TRequest, TResponse&gt; : IPipelineBehavior&lt;TRequest, TResponse&gt;
        where TRequest : IRequest&lt;TResponse&gt;
    {
        private readonly IEnumerable&lt;IValidator&lt;TRequest&gt;&gt; _validators;

        public ValidationBehavior(IEnumerable&lt;IValidator&lt;TRequest&gt;&gt; validators)
        {
            _validators = validators;
        }

        public async Task&lt;TResponse&gt; Handle(
            TRequest request,
            RequestHandlerDelegate&lt;TResponse&gt; next,
            CancellationToken cancellationToken)
        {
            // If no validators registered for this request type, skip validation
            if (!_validators.Any())
            {
                return await next();
            }

            var context = new ValidationContext&lt;TRequest&gt;(request);

            // Run all validators in parallel
            var validationResults = await Task.WhenAll(
                _validators.Select(v =&gt; v.ValidateAsync(context, cancellationToken)));

            // Collect all validation failures
            var failures = validationResults
                .SelectMany(r =&gt; r.Errors)
                .Where(f =&gt; f != null)
                .ToList();

            // If any validation failures, throw ValidationException (short-circuits handler execution)
            if (failures.Any())
            {
                throw new ValidationException(failures);
            }

            // Validation passed, proceed to handler
            return await next();
        }
    }
}</file><file path="Module_Core/Contracts/Services/IService_Focus.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;

namespace MTM_Receiving_Application.Module_Core.Contracts.Services
{
    public interface IService_Focus
    {
        /// &lt;summary&gt;
        /// Sets focus to the specified control.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;control&quot;&gt;The control to focus.&lt;/param&gt;
        public void SetFocus(Control control);

        /// &lt;summary&gt;
        /// Finds the first focusable input control (TextBox, NumberBox, ComboBox, Button, etc.) 
        /// within the container and sets focus to it.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;container&quot;&gt;The container to search.&lt;/param&gt;
        public void SetFocusFirstInput(DependencyObject container);

        /// &lt;summary&gt;
        /// Attaches a listener to the element&apos;s Visibility property. 
        /// When the element becomes Visible, it sets focus to the target control 
        /// (or the first input if target is null).
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;view&quot;&gt;The view/element to monitor for visibility changes.&lt;/param&gt;
        /// &lt;param name=&quot;targetControl&quot;&gt;Optional specific control to focus. If null, searches for first input.&lt;/param&gt;
        public void AttachFocusOnVisibility(FrameworkElement view, Control? targetControl = null);
    }
}</file><file path="Module_Core/Contracts/ViewModels/IResettableViewModel.cs">namespace MTM_Receiving_Application.Module_Core.Contracts.ViewModels
{
    public interface IResettableViewModel
    {
        public void ResetToDefaults();
    }
}</file><file path="Module_Core/Converters/Converter_BooleanToVisibility.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Data;
using System;

namespace MTM_Receiving_Application.Module_Core.Converters
{
    public class Converter_BooleanToVisibility : IValueConverter
    {
        public object Convert(object? value, Type targetType, object? parameter, string language)
        {
            bool boolValue = value is bool b &amp;&amp; b;
            if (parameter is string s &amp;&amp; s.Equals(&quot;Inverse&quot;, StringComparison.OrdinalIgnoreCase))
            {
                boolValue = !boolValue;
            }
            return boolValue ? Visibility.Visible : Visibility.Collapsed;
        }

        public object ConvertBack(object? value, Type targetType, object? parameter, string language)
        {
            throw new NotImplementedException();
        }
    }
}</file><file path="Module_Core/Converters/Converter_BoolToString.cs">using Microsoft.UI.Xaml.Data;
using System;

namespace MTM_Receiving_Application.Module_Core.Converters
{
    public class Converter_BoolToString : IValueConverter
    {
        public object Convert(object? value, Type targetType, object? parameter, string language)
        {
            if (value is bool boolValue &amp;&amp; parameter is string paramString)
            {
                var parts = paramString.Split(&apos;|&apos;);
                if (parts.Length == 2)
                {
                    return boolValue ? parts[0] : parts[1];
                }
            }
            return value?.ToString() ?? string.Empty;
        }

        public object ConvertBack(object? value, Type targetType, object? parameter, string language)
        {
            throw new NotImplementedException();
        }
    }
}</file><file path="Module_Core/Converters/Converter_DecimalToInt.cs">using Microsoft.UI.Xaml.Data;
using System;

namespace MTM_Receiving_Application.Module_Core.Converters
{
    /// &lt;summary&gt;
    /// Converts decimal values to integer (whole number) for display, removing decimal places.
    /// &lt;/summary&gt;
    public class Converter_DecimalToInt : IValueConverter
    {
        public object Convert(object? value, Type targetType, object? parameter, string language)
        {
            if (value is decimal decimalValue)
            {
                return ((int)decimalValue).ToString(&quot;N0&quot;);
            }
            if (value is double doubleValue)
            {
                return ((int)doubleValue).ToString(&quot;N0&quot;);
            }
            if (value is float floatValue)
            {
                return ((int)floatValue).ToString(&quot;N0&quot;);
            }
            return value?.ToString() ?? string.Empty;
        }

        public object ConvertBack(object? value, Type targetType, object? parameter, string language)
        {
            if (value is string strValue &amp;&amp; decimal.TryParse(strValue, out decimal result))
            {
                return result;
            }
            return 0m;
        }
    }
}</file><file path="Module_Core/Converters/Converter_DecimalToString.cs">using Microsoft.UI.Xaml.Data;
using System;

namespace MTM_Receiving_Application.Module_Core.Converters
{
    public class Converter_DecimalToString : IValueConverter
    {
        public object Convert(object? value, Type targetType, object? parameter, string language)
        {
            if (value is decimal d)
            {
                return d == 0 ? string.Empty : d.ToString(&quot;G29&quot;);
            }
            return string.Empty;
        }

        public object ConvertBack(object? value, Type targetType, object? parameter, string language)
        {
            if (value is string s)
            {
                if (string.IsNullOrWhiteSpace(s))
                {
                    return 0m;
                }
                if (decimal.TryParse(s, out decimal result))
                {
                    return result;
                }
            }
            return 0m;
        }
    }
}</file><file path="Module_Core/Converters/Converter_DoubleToDecimal.cs">using Microsoft.UI.Xaml.Data;
using System;

namespace MTM_Receiving_Application.Module_Core.Converters
{
    public class Converter_DoubleToDecimal : IValueConverter
    {
        public object Convert(object? value, Type targetType, object? parameter, string language)
        {
            if (value is decimal d)
            {
                return System.Convert.ToDouble(d);
            }
            return 0.0;
        }

        public object ConvertBack(object? value, Type targetType, object? parameter, string language)
        {
            if (value is double d)
            {
                return System.Convert.ToDecimal(d);
            }
            return 0m;
        }
    }
}</file><file path="Module_Core/Converters/Converter_EmptyStringToVisibility.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Data;
using System;

namespace MTM_Receiving_Application.Module_Core.Converters
{
    public class Converter_EmptyStringToVisibility : IValueConverter
    {
        public object Convert(object? value, Type targetType, object? parameter, string language)
        {
            string? stringValue = value as string;
            bool isVisible = !string.IsNullOrWhiteSpace(stringValue);

            if (parameter is string s &amp;&amp; s.Equals(&quot;Inverse&quot;, StringComparison.OrdinalIgnoreCase))
            {
                isVisible = !isVisible;
            }

            return isVisible ? Visibility.Visible : Visibility.Collapsed;
        }

        public object ConvertBack(object? value, Type targetType, object? parameter, string language)
        {
            throw new NotImplementedException();
        }
    }
}</file><file path="Module_Core/Converters/Converter_IconCodeToGlyph.cs">using System;
using System.Net;
using Microsoft.UI.Xaml.Data;

namespace MTM_Receiving_Application.Module_Core.Converters;

/// &lt;summary&gt;
/// Converts an icon code (like &amp;#xE7B8; or E7B8) to a glyph character.
/// &lt;/summary&gt;
public class Converter_IconCodeToGlyph : IValueConverter
{
    public object Convert(object? value, Type targetType, object? parameter, string language)
    {
        if (value is string iconCode &amp;&amp; !string.IsNullOrWhiteSpace(iconCode))
        {
            // Handle HTML entity format: &amp;#xE7B8;
            if (iconCode.StartsWith(&quot;&amp;#x&quot;) &amp;&amp; iconCode.EndsWith(&quot;;&quot;))
            {
                string hex = iconCode.Substring(3, iconCode.Length - 4);
                if (int.TryParse(hex, System.Globalization.NumberStyles.HexNumber, null, out int code))
                {
                    return ((char)code).ToString();
                }
            }

            // Handle raw hex format: E7B8
            if (iconCode.Length == 4 &amp;&amp; int.TryParse(iconCode, System.Globalization.NumberStyles.HexNumber, null, out int rawCode))
            {
                return ((char)rawCode).ToString();
            }

            // If it&apos;s already a single character or something else, return as is
            return iconCode;
        }

        return &quot;\uE7B8&quot;; // Default box icon
    }

    public object ConvertBack(object? value, Type targetType, object? parameter, string language)
    {
        throw new NotImplementedException();
    }
}</file><file path="Module_Core/Converters/Converter_LoadNumberToOneBased.cs">using Microsoft.UI.Xaml.Data;
using System;

namespace MTM_Receiving_Application.Module_Core.Converters;

/// &lt;summary&gt;
/// Converts a zero-based load number to 1-based for display
/// &lt;/summary&gt;
public class Converter_LoadNumberToOneBased : IValueConverter
{
    public object Convert(object? value, Type targetType, object? parameter, string language)
    {
        if (value is int loadNumber)
        {
            return loadNumber + 1;
        }
        return value!;
    }

    public object ConvertBack(object? value, Type targetType, object? parameter, string language)
    {
        if (value is string strValue &amp;&amp; int.TryParse(strValue, out int displayNumber))
        {
            return displayNumber - 1;
        }
        return value!;
    }
}</file><file path="Module_Core/Converters/Converter_StringFormat.cs">using Microsoft.UI.Xaml.Data;
using System;

namespace MTM_Receiving_Application.Module_Core.Converters
{
    public class Converter_StringFormat : IValueConverter
    {
        public object Convert(object? value, Type targetType, object? parameter, string language)
        {
            if (parameter is string format)
            {
                return string.Format(format, value);
            }
            return value ?? string.Empty;
        }

        public object ConvertBack(object? value, Type targetType, object? parameter, string language)
        {
            throw new NotImplementedException();
        }
    }
}</file><file path="Module_Core/Defaults/InforVisualDefaults.cs">namespace MTM_Receiving_Application.Module_Core.Defaults;

/// &lt;summary&gt;
/// Centralized defaults for Infor Visual integration.
/// Prefer loading these values from configuration where possible.
/// &lt;/summary&gt;
public static class InforVisualDefaults
{
    public const string DefaultServer = &quot;VISUAL&quot;;
    public const string DefaultDatabase = &quot;MTMFG&quot;;
    public const string DefaultSiteId = &quot;002&quot;;
    public const string DefaultUom = &quot;EA&quot;;
    public const string DefaultPartStatus = &quot;ACTIVE&quot;;
}</file><file path="Module_Core/Defaults/WorkstationDefaults.cs">namespace MTM_Receiving_Application.Module_Core.Defaults;

/// &lt;summary&gt;
/// Centralized workstation configuration defaults.
/// Prefer loading these values from configuration where possible.
/// &lt;/summary&gt;
public static class WorkstationDefaults
{
    public const string SharedTerminalWorkstationType = &quot;shared_terminal&quot;;
    public const string PersonalWorkstationWorkstationType = &quot;personal_workstation&quot;;

    public const int SharedTerminalTimeoutMinutes = 15;
    public const int PersonalWorkstationTimeoutMinutes = 30;
}</file><file path="Module_Core/Models/Core/Model_Dao_Result_Factory.cs">using System;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Core.Models.Core;

/// &lt;summary&gt;
/// Factory for creating Model_Dao_Result instances to avoid self-referencing cycles in model classes.
/// &lt;/summary&gt;
public static class Model_Dao_Result_Factory
{
    public static Model_Dao_Result Failure(string? message, Exception? ex = null)
    {
        return new Model_Dao_Result
        {
            Success = false,
            ErrorMessage = string.IsNullOrWhiteSpace(message) ? &quot;Operation failed.&quot; : message,
            Exception = ex,
            Severity = Enum_ErrorSeverity.Error
        };
    }

    public static Model_Dao_Result Success(int affectedRows = 0)
    {
        return new Model_Dao_Result
        {
            Success = true,
            AffectedRows = Math.Max(0, affectedRows),
            ErrorMessage = string.Empty
        };
    }

    public static Model_Dao_Result&lt;T&gt; Failure&lt;T&gt;(string? message, Exception? ex = null)
    {
        return new Model_Dao_Result&lt;T&gt;
        {
            Success = false,
            ErrorMessage = string.IsNullOrWhiteSpace(message) ? &quot;Operation failed.&quot; : message,
            Exception = ex,
            Severity = Enum_ErrorSeverity.Error
        };
    }

    public static Model_Dao_Result&lt;T&gt; Success&lt;T&gt;(T data, int affectedRows = 0)
    {
        return new Model_Dao_Result&lt;T&gt;
        {
            Success = true,
            Data = data,
            AffectedRows = Math.Max(0, affectedRows),
            ErrorMessage = string.Empty
        };
    }
}</file><file path="Module_Core/Models/InforVisual/Model_InforVisualConnection.cs">namespace MTM_Receiving_Application.Module_Core.Models.InforVisual;

using MTM_Receiving_Application.Module_Core.Defaults;

/// &lt;summary&gt;
/// Configuration for Infor Visual database connection
/// READ-ONLY access to VISUAL server, MTMFG database
/// &lt;/summary&gt;
public class Model_InforVisualConnection
{
    public string Server { get; set; } = InforVisualDefaults.DefaultServer;
    public string Database { get; set; } = InforVisualDefaults.DefaultDatabase;
    public string UserId { get; set; } = &quot;SHOP2&quot;;
    public string Password { get; set; } = &quot;SHOP&quot;;
    public string SiteId { get; set; } = InforVisualDefaults.DefaultSiteId;

    /// &lt;summary&gt;
    /// Builds READ-ONLY connection string for Infor Visual
    /// &lt;/summary&gt;
    public string GetConnectionString()
    {
        return $&quot;Server={Server};Database={Database};User Id={UserId};Password={Password};TrustServerCertificate=True;ApplicationIntent=ReadOnly;&quot;;
    }
}</file><file path="Module_Core/Models/InforVisual/Model_InforVisualPart.cs">using System;
using CommunityToolkit.Mvvm.ComponentModel;
using MTM_Receiving_Application.Module_Core.Defaults;

namespace MTM_Receiving_Application.Module_Core.Models.InforVisual;

public partial class Model_InforVisualPart : ObservableObject
{
    /// &lt;summary&gt;Part Number (unique identifier)&lt;/summary&gt;
    [ObservableProperty]
    private string _partNumber = string.Empty;

    /// &lt;summary&gt;Part Description&lt;/summary&gt;
    [ObservableProperty]
    private string _description = string.Empty;

    /// &lt;summary&gt;Part Type (PURCHASED, MANUFACTURED, etc.)&lt;/summary&gt;
    [ObservableProperty]
    private string _partType = string.Empty;

    /// &lt;summary&gt;Standard Unit Cost&lt;/summary&gt;
    [ObservableProperty]
    private decimal _unitCost;

    /// &lt;summary&gt;Primary Unit of Measure&lt;/summary&gt;
    [ObservableProperty]
    private string _primaryUom = InforVisualDefaults.DefaultUom;

    /// &lt;summary&gt;On-Hand Quantity at Warehouse 002&lt;/summary&gt;
    [ObservableProperty]
    private decimal _onHandQty;

    /// &lt;summary&gt;Allocated Quantity (reserved for orders)&lt;/summary&gt;
    [ObservableProperty]
    private decimal _allocatedQty;

    /// &lt;summary&gt;Available Quantity (OnHandQty - AllocatedQty)&lt;/summary&gt;
    [ObservableProperty]
    private decimal _availableQty;

    /// &lt;summary&gt;Default Warehouse/Site&lt;/summary&gt;
    [ObservableProperty]
    private string _defaultSite = InforVisualDefaults.DefaultSiteId;

    /// &lt;summary&gt;Part Status (ACTIVE, OBSOLETE, etc.)&lt;/summary&gt;
    [ObservableProperty]
    private string _partStatus = InforVisualDefaults.DefaultPartStatus;

    /// &lt;summary&gt;Product Line/Category&lt;/summary&gt;
    [ObservableProperty]
    private string _productLine = string.Empty;
}</file><file path="Module_Core/Models/InforVisual/Model_InforVisualPO.cs">using System;
using CommunityToolkit.Mvvm.ComponentModel;
using MTM_Receiving_Application.Module_Core.Defaults;

namespace MTM_Receiving_Application.Module_Core.Models.InforVisual;

public partial class Model_InforVisualPO : ObservableObject
{
    [ObservableProperty]
    private string _poNumber = string.Empty;

    [ObservableProperty]
    private int _poLine;

    [ObservableProperty]
    private string _partNumber = string.Empty;

    [ObservableProperty]
    private string _partDescription = string.Empty;

    [ObservableProperty]
    private decimal _orderedQty;

    [ObservableProperty]
    private decimal _receivedQty;

    [ObservableProperty]
    private decimal _remainingQty;

    [ObservableProperty]
    private string _unitOfMeasure = InforVisualDefaults.DefaultUom;

    [ObservableProperty]
    private DateTime? _dueDate;

    [ObservableProperty]
    private string _vendorCode = string.Empty;

    [ObservableProperty]
    private string _vendorName = string.Empty;

    [ObservableProperty]
    private string _poStatus = string.Empty;

    [ObservableProperty]
    private string _siteId = InforVisualDefaults.DefaultSiteId;
}</file><file path="Module_Core/Models/Reporting/Model_ReportRow.cs">using System;

namespace MTM_Receiving_Application.Module_Core.Models.Reporting;

/// &lt;summary&gt;
/// Unified data structure for report rows across all modules
/// Used for end-of-day reporting with support for Receiving, Dunnage, Routing, and Volvo data
/// &lt;/summary&gt;
public class Model_ReportRow
{
    /// &lt;summary&gt;
    /// Primary identifier from source table (GUID for receiving/dunnage, integer for routing)
    /// &lt;/summary&gt;
    public string Id { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Purchase order number (normalized format: PO-XXXXXX)
    /// &lt;/summary&gt;
    public string? PONumber { get; set; }

    /// &lt;summary&gt;
    /// Part number/identifier
    /// &lt;/summary&gt;
    public string? PartNumber { get; set; }

    /// &lt;summary&gt;
    /// Part description
    /// &lt;/summary&gt;
    public string? PartDescription { get; set; }

    /// &lt;summary&gt;
    /// Quantity of items
    /// &lt;/summary&gt;
    public decimal? Quantity { get; set; }

    /// &lt;summary&gt;
    /// Weight in pounds
    /// &lt;/summary&gt;
    public decimal? WeightLbs { get; set; }

    /// &lt;summary&gt;
    /// Heat/Lot number (concatenated format: HeatNumber/LotNumber)
    /// &lt;/summary&gt;
    public string? HeatLotNumber { get; set; }

    /// &lt;summary&gt;
    /// Date when record was created (transaction date)
    /// &lt;/summary&gt;
    public DateTime CreatedDate { get; set; }

    /// &lt;summary&gt;
    /// Source module name (Receiving, Dunnage, Routing, Volvo)
    /// &lt;/summary&gt;
    public string SourceModule { get; set; } = string.Empty;

    // Routing-specific fields

    /// &lt;summary&gt;
    /// Routing: Line number from PO
    /// &lt;/summary&gt;
    public string? LineNumber { get; set; }

    /// &lt;summary&gt;
    /// Routing: Delivery recipient name
    /// &lt;/summary&gt;
    public string? DeliverTo { get; set; }

    /// &lt;summary&gt;
    /// Routing: Department name
    /// &lt;/summary&gt;
    public string? Department { get; set; }

    /// &lt;summary&gt;
    /// Routing: Physical location
    /// &lt;/summary&gt;
    public string? Location { get; set; }

    /// &lt;summary&gt;
    /// Routing: Package description
    /// &lt;/summary&gt;
    public string? PackageDescription { get; set; }

    /// &lt;summary&gt;
    /// Routing: Work order number
    /// &lt;/summary&gt;
    public string? WorkOrderNumber { get; set; }

    /// &lt;summary&gt;
    /// Routing: Other reason (for non-PO packages)
    /// &lt;/summary&gt;
    public string? OtherReason { get; set; }

    /// &lt;summary&gt;
    /// Employee number who created the record
    /// &lt;/summary&gt;
    public string? EmployeeNumber { get; set; }

    // Dunnage-specific fields

    /// &lt;summary&gt;
    /// Dunnage: Type name (Pallet, Box, etc.)
    /// &lt;/summary&gt;
    public string? DunnageType { get; set; }

    /// &lt;summary&gt;
    /// Dunnage: Concatenated specifications (key:value pairs)
    /// &lt;/summary&gt;
    public string? SpecsCombined { get; set; }

    // Volvo-specific fields

    /// &lt;summary&gt;
    /// Volvo: Shipment number
    /// &lt;/summary&gt;
    public int? ShipmentNumber { get; set; }

    /// &lt;summary&gt;
    /// Volvo: Receiver number
    /// &lt;/summary&gt;
    public string? ReceiverNumber { get; set; }

    /// &lt;summary&gt;
    /// Volvo: Shipment status
    /// &lt;/summary&gt;
    public string? Status { get; set; }

    /// &lt;summary&gt;
    /// Volvo: Count of parts in shipment
    /// &lt;/summary&gt;
    public int? PartCount { get; set; }
}</file><file path="Module_Core/Models/Systems/Model_AuthenticationResult.cs">using System;

namespace MTM_Receiving_Application.Module_Core.Models.Systems
{
    /// &lt;summary&gt;
    /// Result of an authentication attempt.
    /// &lt;/summary&gt;
    public class Model_AuthenticationResult
    {
        public bool Success { get; set; }
        public Model_User? User { get; set; }
        public string ErrorMessage { get; set; } = string.Empty;

        public static Model_AuthenticationResult SuccessResult(Model_User user)
        {
            ArgumentNullException.ThrowIfNull(user);

            return new Model_AuthenticationResult
            {
                Success = true,
                User = user,
                ErrorMessage = string.Empty
            };
        }

        public static Model_AuthenticationResult ErrorResult(string message)
        {
            if (string.IsNullOrWhiteSpace(message))
            {
                throw new ArgumentException(&quot;Error message cannot be null or whitespace.&quot;, nameof(message));
            }

            return new Model_AuthenticationResult
            {
                Success = false,
                User = null,
                ErrorMessage = message
            };
        }
    }
}</file><file path="Module_Core/Models/Systems/Model_UserSession.cs">using System;

namespace MTM_Receiving_Application.Module_Core.Models.Systems
{
    /// &lt;summary&gt;
    /// Represents the current active user session with timeout tracking.
    /// Maintained in memory during application lifetime.
    /// &lt;/summary&gt;
    public class Model_UserSession
    {
        private static Func&lt;DateTime&gt; NowProvider { get; } = static () =&gt; DateTime.Now;

        // ====================================================================
        // User Information
        // ====================================================================

        /// &lt;summary&gt;
        /// Authenticated user for this session
        /// &lt;/summary&gt;
        public Model_User? User { get; set; }

        // ====================================================================
        // Session Metadata
        // ====================================================================

        /// &lt;summary&gt;
        /// Computer name where session is active (from Environment.MachineName)
        /// &lt;/summary&gt;
        public string WorkstationName { get; set; } = string.Empty;

        /// &lt;summary&gt;
        /// Workstation type: &quot;personal_workstation&quot; or &quot;shared_terminal&quot;
        /// &lt;/summary&gt;
        public string WorkstationType { get; set; } = string.Empty;

        /// &lt;summary&gt;
        /// Authentication method used: &quot;windows_auto&quot; or &quot;pin_login&quot;
        /// &lt;/summary&gt;
        public string AuthenticationMethod { get; set; } = string.Empty;

        /// &lt;summary&gt;
        /// Timestamp when user logged in
        /// &lt;/summary&gt;
        public DateTime LoginTimestamp { get; set; }

        /// &lt;summary&gt;
        /// Timestamp of last user interaction (mouse, keyboard, window focus)
        /// Updated by UpdateLastActivity() method
        /// &lt;/summary&gt;
        public DateTime LastActivityTimestamp { get; set; }

        // ====================================================================
        // Session Management
        // ====================================================================

        /// &lt;summary&gt;
        /// Session timeout duration based on workstation type
        /// 30 minutes for personal workstations, 15 minutes for shared terminals
        /// &lt;/summary&gt;
        public TimeSpan TimeoutDuration { get; set; }

        /// &lt;summary&gt;
        /// Time elapsed since last user activity
        /// &lt;/summary&gt;
        public TimeSpan TimeSinceLastActivity =&gt; NowProvider() - LastActivityTimestamp;

        /// &lt;summary&gt;
        /// Indicates if session has exceeded timeout duration
        /// &lt;/summary&gt;
        public bool IsTimedOut =&gt; TimeSinceLastActivity &gt;= TimeoutDuration;

        /// &lt;summary&gt;
        /// Indicates if user has configured ERP access (copied from User model)
        /// &lt;/summary&gt;
        public bool HasErpAccess =&gt; User?.HasErpAccess ?? false;

        // ====================================================================
        // Methods
        // ====================================================================

        /// &lt;summary&gt;
        /// Updates the last activity timestamp to current time.
        /// Called on any user interaction event (mouse, keyboard, window focus).
        /// &lt;/summary&gt;
        public void UpdateLastActivity()
        {
            LastActivityTimestamp = NowProvider();
        }

        // ====================================================================
        // Constructor
        // ====================================================================

        /// &lt;summary&gt;
        /// Default constructor
        /// &lt;/summary&gt;
        public Model_UserSession()
        {
            LoginTimestamp = NowProvider();
            LastActivityTimestamp = NowProvider();
        }

        /// &lt;summary&gt;
        /// Constructor that requires an authenticated user.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;user&quot;&gt;Authenticated user for this session.&lt;/param&gt;
        public Model_UserSession(Model_User user) : this()
        {
            ArgumentNullException.ThrowIfNull(user);
            User = user;
        }
    }
}</file><file path="Module_Core/Models/Systems/Model_ValidationResult.cs">using System;

namespace MTM_Receiving_Application.Module_Core.Models.Systems
{
    /// &lt;summary&gt;
    /// Result of a validation operation.
    /// &lt;/summary&gt;
    public class Model_ValidationResult
    {
        public bool IsValid { get; set; }
        public string ErrorMessage { get; set; } = string.Empty;

        public static Model_ValidationResult Valid() =&gt; new()
        {
            IsValid = true,
            ErrorMessage = string.Empty
        };

        public static Model_ValidationResult Invalid(string? message) =&gt; new()
        {
            IsValid = false,
            ErrorMessage = string.IsNullOrWhiteSpace(message) ? &quot;Validation failed.&quot; : message
        };
    }
}</file><file path="Module_Core/Services/Authentication/Service_UserSessionManager.cs">using System;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Systems;
using MTM_Receiving_Application.Module_Core.Data.Authentication;

namespace MTM_Receiving_Application.Module_Core.Services.Authentication
{
    /// &lt;summary&gt;
    /// Service implementation for session management and timeout monitoring.
    /// Uses IDispatcherService to check for session timeouts every 60 seconds.
    /// &lt;/summary&gt;
    public class Service_UserSessionManager : IService_UserSessionManager
    {
        private readonly Dao_User _daoUser;
        private readonly IService_Dispatcher _dispatcherService;
        private IService_DispatcherTimer? _timeoutTimer;
        private const int TimerIntervalSeconds = 60;

        /// &lt;summary&gt;
        /// Constructor with dependency injection.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;daoUser&quot;&gt;User data access object for activity logging&lt;/param&gt;
        /// &lt;param name=&quot;dispatcherService&quot;&gt;Dispatcher service for timer operations&lt;/param&gt;
        public Service_UserSessionManager(Dao_User daoUser, IService_Dispatcher dispatcherService)
        {
            _daoUser = daoUser ?? throw new ArgumentNullException(nameof(daoUser));
            _dispatcherService = dispatcherService ?? throw new ArgumentNullException(nameof(dispatcherService));
        }

        // ====================================================================
        // Properties
        // ====================================================================

        /// &lt;inheritdoc/&gt;
        public Model_UserSession? CurrentSession { get; private set; }

        // ====================================================================
        // Session Management
        // ====================================================================

        /// &lt;inheritdoc/&gt;
        public Model_UserSession CreateSession(
            Model_User user,
            Model_WorkstationConfig workstationConfig,
            string authenticationMethod)
        {
            if (user == null)
            {
                throw new ArgumentNullException(nameof(user));
            }

            if (workstationConfig == null)
            {
                throw new ArgumentNullException(nameof(workstationConfig));
            }

            CurrentSession = new Model_UserSession
            {
                User = user,
                WorkstationName = workstationConfig.ComputerName,
                WorkstationType = workstationConfig.WorkstationType,
                AuthenticationMethod = authenticationMethod,
                LoginTimestamp = DateTime.Now,
                LastActivityTimestamp = DateTime.Now,
                TimeoutDuration = workstationConfig.TimeoutDuration
            };

            return CurrentSession;
        }

        /// &lt;inheritdoc/&gt;
        public void UpdateLastActivity()
        {
            CurrentSession?.UpdateLastActivity();
        }

        // ====================================================================
        // Timeout Monitoring
        // ====================================================================

        /// &lt;inheritdoc/&gt;
        public void StartTimeoutMonitoring()
        {
            if (CurrentSession == null)
            {
                throw new InvalidOperationException(&quot;Cannot start timeout monitoring without an active session&quot;);
            }

            // Stop existing timer if running
            StopTimeoutMonitoring();

            // Create new timer
            _timeoutTimer = _dispatcherService.CreateTimer();
            _timeoutTimer.Interval = TimeSpan.FromSeconds(TimerIntervalSeconds);
            _timeoutTimer.IsRepeating = true;
            _timeoutTimer.Tick += OnTimerTick;
            _timeoutTimer.Start();

            System.Diagnostics.Debug.WriteLine($&quot;Session timeout monitoring started. Timeout: {CurrentSession.TimeoutDuration.TotalMinutes} minutes&quot;);
        }

        /// &lt;inheritdoc/&gt;
        public void StopTimeoutMonitoring()
        {
            if (_timeoutTimer != null)
            {
                _timeoutTimer.Stop();
                _timeoutTimer.Tick -= OnTimerTick;
                _timeoutTimer = null;

                System.Diagnostics.Debug.WriteLine(&quot;Session timeout monitoring stopped&quot;);
            }
        }

        /// &lt;inheritdoc/&gt;
        public bool IsSessionTimedOut()
        {
            return CurrentSession?.IsTimedOut ?? false;
        }

        /// &lt;inheritdoc/&gt;
        public async Task EndSessionAsync(string reason)
        {
            if (CurrentSession?.User == null)
            {
                return;
            }

            try
            {
                // Log session end
                await _daoUser.LogUserActivityAsync(
                    reason,
                    CurrentSession.User.WindowsUsername,
                    CurrentSession.WorkstationName,
                    $&quot;Session ended. Duration: {(DateTime.Now - CurrentSession.LoginTimestamp).TotalMinutes:F1} minutes&quot;);

                System.Diagnostics.Debug.WriteLine($&quot;Session ended. Reason: {reason}&quot;);
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($&quot;Failed to log session end: {ex.Message}&quot;);
            }
            finally
            {
                // Clean up
                StopTimeoutMonitoring();
                CurrentSession = null;
            }
        }

        // ====================================================================
        // Events
        // ====================================================================

        /// &lt;inheritdoc/&gt;
        public event EventHandler&lt;Model_SessionTimedOutEventArgs&gt;? SessionTimedOut;

        // ====================================================================
        // Private Methods
        // ====================================================================

        /// &lt;summary&gt;
        /// Timer tick handler - checks for session timeout.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;args&quot;&gt;&lt;/param&gt;
        private void OnTimerTick(object? sender, object args)
        {
            if (CurrentSession == null)
            {
                return;
            }

            if (IsSessionTimedOut())
            {
                System.Diagnostics.Debug.WriteLine(
                    $&quot;Session timeout detected. Idle time: {CurrentSession.TimeSinceLastActivity.TotalMinutes:F1} minutes&quot;);

                // Raise timeout event
                SessionTimedOut?.Invoke(this, new Model_SessionTimedOutEventArgs
                {
                    Session = CurrentSession,
                    IdleDuration = CurrentSession.TimeSinceLastActivity
                });

                // Stop monitoring (app will close)
                StopTimeoutMonitoring();
            }
        }
    }
}</file><file path="Module_Core/Services/Database/Service_LoggingUtility.cs">using System;
using System.IO;
using System.Text;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Contracts.Services;

namespace MTM_Receiving_Application.Module_Core.Services.Database;

/// &lt;summary&gt;
/// Implements file-based logging with daily rotation
/// Logs are written to %APPDATA%\MTM_Receiving_Application\Logs\
/// &lt;/summary&gt;
public class Service_LoggingUtility : IService_LoggingUtility
{
    private readonly string _logDirectory;
    private readonly object _lockObject = new object();
    private readonly System.Collections.Concurrent.BlockingCollection&lt;string&gt; _logQueue = new();

    public Service_LoggingUtility()
    {
        _logDirectory = Path.Combine(
            Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
            &quot;MTM_Receiving_Application&quot;,
            &quot;Logs&quot;
        );

        EnsureLogDirectoryExists();

        // Start background logging thread
        System.Threading.Tasks.Task.Factory.StartNew(ProcessLogQueue,
            System.Threading.CancellationToken.None,
            System.Threading.Tasks.TaskCreationOptions.LongRunning,
            System.Threading.Tasks.TaskScheduler.Default);
    }

    private void ProcessLogQueue()
    {
        foreach (var logEntry in _logQueue.GetConsumingEnumerable())
        {
            try
            {
                string logFilePath = GetCurrentLogFilePath();
                lock (_lockObject)
                {
                    File.AppendAllText(logFilePath, logEntry, Encoding.UTF8);
                }
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($&quot;Background logging failed: {ex.Message}&quot;);
            }
        }
    }

    /// &lt;summary&gt;
    /// Logs an informational message
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;
    public void LogInfo(string message, string? context = null)
    {
        WriteLog(&quot;INFO&quot;, message, null, context);
    }

    /// &lt;summary&gt;
    /// Logs a warning message
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;
    public void LogWarning(string message, string? context = null)
    {
        WriteLog(&quot;WARNING&quot;, message, null, context);
    }

    /// &lt;summary&gt;
    /// Logs an error message with optional exception
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;exception&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;
    public void LogError(string message, Exception? exception = null, string? context = null)
    {
        WriteLog(&quot;ERROR&quot;, message, exception, context);
    }

    /// &lt;summary&gt;
    /// Logs a critical error message with optional exception
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;exception&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;
    public void LogCritical(string message, Exception? exception = null, string? context = null)
    {
        WriteLog(&quot;CRITICAL&quot;, message, exception, context);
    }

    /// &lt;summary&gt;
    /// Logs a fatal error message with optional exception
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;exception&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;
    public void LogFatal(string message, Exception? exception = null, string? context = null)
    {
        WriteLog(&quot;FATAL&quot;, message, exception, context);
    }

    public Task LogInfoAsync(string message, string? context = null)
    {
        LogInfo(message, context);
        return Task.CompletedTask;
    }

    public Task LogErrorAsync(string message, Exception? exception = null, string? context = null)
    {
        LogError(message, exception, context);
        return Task.CompletedTask;
    }

    /// &lt;summary&gt;
    /// Gets the path to today&apos;s log file
    /// &lt;/summary&gt;
    public string GetCurrentLogFilePath()
    {
        string fileName = $&quot;app_{DateTime.Now:yyyy-MM-dd}.log&quot;;
        return Path.Combine(_logDirectory, fileName);
    }

    /// &lt;summary&gt;
    /// Ensures the log directory exists and is writable
    /// &lt;/summary&gt;
    public bool EnsureLogDirectoryExists()
    {
        try
        {
            if (!Directory.Exists(_logDirectory))
            {
                Directory.CreateDirectory(_logDirectory);
            }
            return true;
        }
        catch (Exception ex)
        {
            // Can&apos;t log this error since logging is broken
            System.Diagnostics.Debug.WriteLine($&quot;Failed to create log directory: {ex.Message}&quot;);
            return false;
        }
    }

    /// &lt;summary&gt;
    /// Archives old log files (older than specified days)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;daysToKeep&quot;&gt;&lt;/param&gt;
    public int ArchiveOldLogs(int daysToKeep = 30)
    {
        int archivedCount = 0;

        try
        {
            if (!Directory.Exists(_logDirectory))
            {
                return 0;
            }

            var cutoffDate = DateTime.Now.AddDays(-daysToKeep);
            var archiveDirectory = Path.Combine(_logDirectory, &quot;archive&quot;);

            foreach (var file in Directory.GetFiles(_logDirectory, &quot;app_*.log&quot;))
            {
                var fileInfo = new FileInfo(file);

                if (fileInfo.LastWriteTime &lt; cutoffDate)
                {
                    // Create archive directory if it doesn&apos;t exist
                    if (!Directory.Exists(archiveDirectory))
                    {
                        Directory.CreateDirectory(archiveDirectory);
                    }

                    // Move file to archive
                    string archivePath = Path.Combine(archiveDirectory, fileInfo.Name);

                    // If file already exists in archive, delete it first
                    if (File.Exists(archivePath))
                    {
                        File.Delete(archivePath);
                    }

                    File.Move(file, archivePath);
                    archivedCount++;
                }
            }
        }
        catch (Exception ex)
        {
            WriteLog(&quot;ERROR&quot;, $&quot;Failed to archive old logs: {ex.Message}&quot;, ex, &quot;LoggingUtility.ArchiveOldLogs&quot;);
        }

        return archivedCount;
    }

    /// &lt;summary&gt;
    /// Core logging method that writes to file
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;severity&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;exception&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;
    private void WriteLog(string severity, string message, Exception? exception, string? context)
    {
        try
        {
            string logFilePath = GetCurrentLogFilePath();
            var logEntry = new StringBuilder();

            // Timestamp and severity
            logEntry.AppendLine($&quot;[{DateTime.Now:yyyy-MM-dd HH:mm:ss.fff}] [{severity}] {(context != null ? $&quot;[{context}]&quot; : &quot;&quot;)}&quot;);
            logEntry.AppendLine($&quot;Message: {message}&quot;);

            // Add context information if provided
            if (!string.IsNullOrEmpty(context))
            {
                logEntry.AppendLine($&quot;Context: User={Environment.UserName}, Machine={Environment.MachineName}&quot;);
            }

            // Add exception details if provided
            if (exception != null)
            {
                logEntry.AppendLine($&quot;Exception: {exception.GetType().FullName}: {exception.Message}&quot;);
                logEntry.AppendLine($&quot;Stack Trace:&quot;);
                logEntry.AppendLine(exception.StackTrace);

                // Log inner exceptions
                var innerException = exception.InnerException;
                while (innerException != null)
                {
                    logEntry.AppendLine($&quot;Inner Exception: {innerException.GetType().FullName}: {innerException.Message}&quot;);
                    logEntry.AppendLine(innerException.StackTrace);
                    innerException = innerException.InnerException;
                }
            }

            logEntry.AppendLine(); // Blank line between entries

            // Queue for background writing
            _logQueue.Add(logEntry.ToString());

            // Also write to Debug output for development
            System.Diagnostics.Debug.Write(logEntry.ToString());
        }
        catch (Exception ex)
        {
            // Last resort - write to debug output if file logging fails
            System.Diagnostics.Debug.WriteLine($&quot;LOGGING FAILED: {ex.Message}&quot;);
            System.Diagnostics.Debug.WriteLine($&quot;Original message: {message}&quot;);
        }
    }

    public Task LogWarningAsync(string message, string? context = null)
    {
        LogWarning(message, context);
        return Task.CompletedTask;
    }
}</file><file path="Module_Core/Services/Service_Focus.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using Microsoft.UI.Xaml.Media;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using System;

namespace MTM_Receiving_Application.Module_Core.Services
{
    public class Service_Focus : IService_Focus
    {
        public void SetFocus(Control control)
        {
            if (control == null)
            {
                return;
            }

            // Ensure we are on the UI thread or use DispatcherQueue
            if (control.DispatcherQueue != null)
            {
                control.DispatcherQueue.TryEnqueue(() =&gt;
                {
                    control.Focus(FocusState.Programmatic);
                });
            }
            else
            {
                control.Focus(FocusState.Programmatic);
            }
        }

        public void SetFocusFirstInput(DependencyObject container)
        {
            if (container == null)
            {
                return;
            }

            if (container is FrameworkElement fe &amp;&amp; fe.DispatcherQueue != null)
            {
                fe.DispatcherQueue.TryEnqueue(() =&gt;
                {
                    var control = FindFirstFocusableChild(container);
                    control?.Focus(FocusState.Programmatic);
                });
            }
        }

        public void AttachFocusOnVisibility(FrameworkElement view, Control? targetControl = null)
        {
            if (view == null)
            {
                return;
            }

            // Initial check if already visible and loaded
            if (view.IsLoaded &amp;&amp; view.Visibility == Visibility.Visible)
            {
                if (targetControl != null)
                {
                    SetFocus(targetControl);
                }
                else
                {
                    SetFocusFirstInput(view);
                }
            }

            // Hook into Loaded to handle initial focus
            view.Loaded += (_, _) =&gt;
            {
                if (view.Visibility == Visibility.Visible)
                {
                    if (targetControl != null)
                    {
                        SetFocus(targetControl);
                    }
                    else
                    {
                        SetFocusFirstInput(view);
                    }
                }
            };

            // Hook into Visibility changes
            view.RegisterPropertyChangedCallback(UIElement.VisibilityProperty, (_, _) =&gt;
            {
                if (view.Visibility == Visibility.Visible)
                {
                    if (targetControl != null)
                    {
                        SetFocus(targetControl);
                    }
                    else
                    {
                        SetFocusFirstInput(view);
                    }
                }
            });
        }

        private Control? FindFirstFocusableChild(DependencyObject parent)
        {
            if (parent == null)
            {
                return null;
            }

            int childrenCount = VisualTreeHelper.GetChildrenCount(parent);
            for (int i = 0; i &lt; childrenCount; i++)
            {
                var child = VisualTreeHelper.GetChild(parent, i);

                if (child is Control control &amp;&amp; IsFocusable(control))
                {
                    return control;
                }

                var result = FindFirstFocusableChild(child);
                if (result != null)
                {
                    return result;
                }
            }
            return null;
        }

        private bool IsFocusable(Control control)
        {
            if (!control.IsEnabled || control.Visibility != Visibility.Visible)
            {
                return false;
            }

            // Check for specific input types we want to prioritize
            if (control is TextBox ||
                control is NumberBox ||
                control is ComboBox ||
                control is PasswordBox ||
                control is AutoSuggestBox)
            {
                return true;
            }

            // Buttons and other controls are also focusable, but maybe we prefer inputs?
            // For now, let&apos;s include them but maybe inputs should be prioritized if we were doing a deeper search.
            // But since we are doing a depth-first search (or breadth-first?), the order matters.
            // The current implementation is depth-first.

            if (control is Button ||
                control is CheckBox ||
                control is RadioButton ||
                control is ToggleSwitch ||
                control is ListView ||
                control is GridView)
            {
                return true;
            }

            return false;
        }
    }
}</file><file path="Module_Dunnage/Contracts/IService_DunnageAdminWorkflow.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Receiving.Models; // For Model_WorkflowStepResult if needed
using MTM_Receiving_Application.Module_Core.Models.Enums; // For other enums if needed

namespace MTM_Receiving_Application.Module_Dunnage.Contracts;

/// &lt;summary&gt;
/// Service interface for Dunnage Admin UI navigation workflow
/// Manages 4-section navigation: Types, Parts, Specs, Inventoried List
/// &lt;/summary&gt;
public interface IService_DunnageAdminWorkflow
{
    /// &lt;summary&gt;
    /// Gets the current admin section being displayed
    /// &lt;/summary&gt;
    public Enum_DunnageAdminSection CurrentSection { get; }

    /// &lt;summary&gt;
    /// Raised when admin section changes
    /// &lt;/summary&gt;
    public event EventHandler&lt;Enum_DunnageAdminSection&gt;? SectionChanged;

    /// &lt;summary&gt;
    /// Raised when status message needs to be displayed
    /// &lt;/summary&gt;
    public event EventHandler&lt;string&gt;? StatusMessageRaised;

    /// &lt;summary&gt;
    /// Navigate to specific admin section
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;section&quot;&gt;Target section (Types, Parts, Specs, InventoriedList)&lt;/param&gt;
    public Task NavigateToSectionAsync(Enum_DunnageAdminSection section);

    /// &lt;summary&gt;
    /// Return to main admin hub (4-card navigation view)
    /// &lt;/summary&gt;
    public Task NavigateToHubAsync();

    /// &lt;summary&gt;
    /// Validate if navigation away from current section is allowed
    /// (checks for unsaved changes, pending operations)
    /// &lt;/summary&gt;
    /// &lt;returns&gt;True if navigation allowed, false if blocked&lt;/returns&gt;
    public Task&lt;bool&gt; CanNavigateAwayAsync();

    /// &lt;summary&gt;
    /// Mark current section as having unsaved changes
    /// &lt;/summary&gt;
    public void MarkDirty();

    /// &lt;summary&gt;
    /// Clear unsaved changes flag (after save or discard)
    /// &lt;/summary&gt;
    public void MarkClean();

    /// &lt;summary&gt;
    /// Check if current section has unsaved changes
    /// &lt;/summary&gt;
    public bool IsDirty { get; }
}</file><file path="Module_Dunnage/Contracts/IService_DunnageCSVWriter.cs">using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Dunnage.Models;

namespace MTM_Receiving_Application.Module_Dunnage.Contracts;

/// &lt;summary&gt;
/// Service interface for CSV export of dunnage data with dynamic column generation
/// EXTENDED for dynamic spec columns (spec 010-dunnage-complete)
/// &lt;/summary&gt;
public interface IService_DunnageCSVWriter
{
    // ============================================
    // EXISTING METHOD (from spec 006-dunnage-services)
    // ============================================

    /// &lt;summary&gt;
    /// Write dunnage loads to CSV file (wizard workflow export)
    /// Uses fixed columns based on selected type&apos;s specs
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;loads&quot;&gt;List of loads to export&lt;/param&gt;
    /// &lt;param name=&quot;typeName&quot;&gt;Dunnage type name for filename&lt;/param&gt;
    /// &lt;returns&gt;File paths (local and network) and success status&lt;/returns&gt;
    public Task&lt;Model_CSVWriteResult&gt; WriteToCsvAsync(List&lt;Model_DunnageLoad&gt; loads, string typeName);

    /// &lt;summary&gt;
    /// Write dunnage loads to CSV file (backward compatibility)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;loads&quot;&gt;&lt;/param&gt;
    public Task&lt;Model_CSVWriteResult&gt; WriteToCSVAsync(List&lt;Model_DunnageLoad&gt; loads);

    // ============================================
    // NEW METHODS (spec 010-dunnage-complete)
    // ============================================

    /// &lt;summary&gt;
    /// Write dunnage loads to CSV with dynamic columns for all spec keys
    /// Used for Manual Entry and Edit Mode exports (all types in one file)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;loads&quot;&gt;List of loads to export&lt;/param&gt;
    /// &lt;param name=&quot;allSpecKeys&quot;&gt;Union of all spec keys across all types (from GetAllSpecKeysAsync)&lt;/param&gt;
    /// &lt;param name=&quot;filename&quot;&gt;Optional custom filename (default: DunnageData_{timestamp}.csv)&lt;/param&gt;
    /// &lt;returns&gt;CSV write result with local/network paths and success status&lt;/returns&gt;
    /// &lt;remarks&gt;
    /// Generates columns: ID, PartID, DunnageType, Quantity, PONumber, ReceivedDate, UserId, Location, LabelNumber, [Dynamic Spec Columns]
    /// Blank cells for specs not applicable to a load&apos;s type
    /// RFC 4180 compliant (CsvHelper escaping)
    /// Dual-path write: local (%APPDATA%) always succeeds, network (\\MTMDC\) best-effort
    /// &lt;/remarks&gt;
    public Task&lt;Model_CSVWriteResult&gt; WriteDynamicCsvAsync(
        List&lt;Model_DunnageLoad&gt; loads,
        List&lt;string&gt; allSpecKeys,
        string? filename = null);

    /// &lt;summary&gt;
    /// Export selected loads from DataGrid (Manual Entry or Edit Mode)
    /// Includes dynamic spec columns based on types in selection
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;selectedLoads&quot;&gt;Loads selected in DataGrid&lt;/param&gt;
    /// &lt;param name=&quot;includeAllSpecColumns&quot;&gt;If true, includes all spec keys across all types. If false, only keys used by selected loads&apos; types.&lt;/param&gt;
    /// &lt;returns&gt;CSV write result&lt;/returns&gt;
    public Task&lt;Model_CSVWriteResult&gt; ExportSelectedLoadsAsync(
        List&lt;Model_DunnageLoad&gt; selectedLoads,
        bool includeAllSpecColumns = false);

    /// &lt;summary&gt;
    /// Validate network path availability (for dual-path writing)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;timeout&quot;&gt;Timeout in seconds for reachability check&lt;/param&gt;
    /// &lt;returns&gt;True if network path reachable, false otherwise&lt;/returns&gt;
    public Task&lt;bool&gt; IsNetworkPathAvailableAsync(int timeout = 3);

    /// &lt;summary&gt;
    /// Get local CSV file path for current user
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;filename&quot;&gt;Filename (without path)&lt;/param&gt;
    /// &lt;returns&gt;Full local path (%APPDATA%\MTM_Receiving_Application\{filename})&lt;/returns&gt;
    public string GetLocalCsvPath(string filename);

    /// &lt;summary&gt;
    /// Get network CSV file path for current user
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;filename&quot;&gt;Filename (without path)&lt;/param&gt;
    /// &lt;returns&gt;Full network path (\\MTMDC\DunnageData\{username}\{filename})&lt;/returns&gt;
    public string GetNetworkCsvPath(string filename);

    /// &lt;summary&gt;
    /// Clears the contents of all CSV files created by the application from local and network paths
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;filenamePattern&quot;&gt;Optional filename pattern to match (e.g., &quot;DunnageData_*.csv&quot;). If null, clears all CSV files.&lt;/param&gt;
    /// &lt;returns&gt;CSV clear result with counts of cleared files and any errors&lt;/returns&gt;
    public Task&lt;Model_CSVDeleteResult&gt; ClearCSVFilesAsync(string? filenamePattern = null);
}</file><file path="Module_Dunnage/Contracts/IService_DunnageWorkflow.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Receiving.Models; // For Model_WorkflowStepResult if needed
using MTM_Receiving_Application.Module_Core.Models.Enums; // For other enums if needed

namespace MTM_Receiving_Application.Module_Dunnage.Contracts
{
    public interface IService_DunnageWorkflow
    {
        public Enum_DunnageWorkflowStep CurrentStep { get; }
        public Model_DunnageSession CurrentSession { get; }

        public event EventHandler StepChanged;
        public event EventHandler&lt;string&gt; StatusMessageRaised;

        public Task&lt;bool&gt; StartWorkflowAsync();
        public Task&lt;Model_WorkflowStepResult&gt; AdvanceToNextStepAsync();
        public void GoToStep(Enum_DunnageWorkflowStep step);
        public Task&lt;Model_SaveResult&gt; SaveSessionAsync();
        public Task&lt;Model_SaveResult&gt; SaveToCSVOnlyAsync();
        public Task&lt;Model_SaveResult&gt; SaveToDatabaseOnlyAsync();
        public void ClearSession();

        public Task&lt;Model_CSVDeleteResult&gt; ResetCSVFilesAsync();
        public void AddCurrentLoadToSession();
    }
}</file><file path="Module_Dunnage/Contracts/IService_MySQL_Dunnage.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Dunnage.Models;

namespace MTM_Receiving_Application.Module_Dunnage.Contracts
{
    /// &lt;summary&gt;
    /// Service for dunnage database operations.
    /// Wraps DAOs with business logic validation and error handling.
    /// &lt;/summary&gt;
    public interface IService_MySQL_Dunnage
    {
        // ==================== Type Operations (7 methods) ====================

        public Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnageType&gt;&gt;&gt; GetAllTypesAsync();
        public Task&lt;Model_Dao_Result&lt;Model_DunnageType&gt;&gt; GetTypeByIdAsync(int typeId);
        public Task&lt;Model_Dao_Result&lt;int&gt;&gt; InsertTypeAsync(string typeName, string icon);
        public Task&lt;Model_Dao_Result&gt; InsertTypeAsync(Model_DunnageType type);
        public Task&lt;Model_Dao_Result&gt; UpdateTypeAsync(Model_DunnageType type);
        public Task&lt;Model_Dao_Result&gt; DeleteTypeAsync(int typeId);
        public Task&lt;Model_Dao_Result&lt;int&gt;&gt; CheckDuplicateTypeNameAsync(string typeName);

        // ==================== Spec Operations (6 methods) ====================

        public Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnageSpec&gt;&gt;&gt; GetSpecsForTypeAsync(int typeId);
        public Task&lt;Model_Dao_Result&gt; InsertSpecAsync(Model_DunnageSpec spec);
        public Task&lt;Model_Dao_Result&gt; UpdateSpecAsync(Model_DunnageSpec spec);
        public Task&lt;Model_Dao_Result&gt; DeleteSpecAsync(int specId);
        public Task&lt;Model_Dao_Result&gt; DeleteSpecsByTypeIdAsync(int typeId);
        public Task&lt;List&lt;string&gt;&gt; GetAllSpecKeysAsync();

        // ==================== Part Operations (7 methods) ====================

        public Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnagePart&gt;&gt;&gt; GetAllPartsAsync();
        public Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnagePart&gt;&gt;&gt; GetPartsByTypeAsync(int typeId);
        public Task&lt;Model_Dao_Result&lt;Model_DunnagePart&gt;&gt; GetPartByIdAsync(string partId);
        public Task&lt;Model_Dao_Result&gt; InsertPartAsync(Model_DunnagePart part);
        public Task&lt;Model_Dao_Result&gt; UpdatePartAsync(Model_DunnagePart part);
        public Task&lt;Model_Dao_Result&gt; DeletePartAsync(string partId);
        public Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnagePart&gt;&gt;&gt; SearchPartsAsync(string searchText, int? typeId = null);

        // ==================== Load Operations (6 methods) ====================

        public Task&lt;Model_Dao_Result&gt; SaveLoadsAsync(List&lt;Model_DunnageLoad&gt; loads);
        public Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnageLoad&gt;&gt;&gt; GetLoadsByDateRangeAsync(DateTime start, DateTime end);
        public Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnageLoad&gt;&gt;&gt; GetAllLoadsAsync();
        public Task&lt;Model_Dao_Result&lt;Model_DunnageLoad&gt;&gt; GetLoadByIdAsync(string loadUuid);
        public Task&lt;Model_Dao_Result&gt; UpdateLoadAsync(Model_DunnageLoad load);
        public Task&lt;Model_Dao_Result&gt; DeleteLoadAsync(string loadUuid);

        // ==================== Inventory Operations (6 methods) ====================

        public Task&lt;bool&gt; IsPartInventoriedAsync(string partId);
        public Task&lt;Model_Dao_Result&lt;Model_InventoriedDunnage&gt;&gt; GetInventoryDetailsAsync(string partId);
        public Task&lt;Model_Dao_Result&lt;List&lt;Model_InventoriedDunnage&gt;&gt;&gt; GetAllInventoriedPartsAsync();
        public Task&lt;Model_Dao_Result&gt; AddToInventoriedListAsync(Model_InventoriedDunnage item);
        public Task&lt;Model_Dao_Result&gt; RemoveFromInventoriedListAsync(string partId);
        public Task&lt;Model_Dao_Result&gt; UpdateInventoriedPartAsync(Model_InventoriedDunnage item);

        // ==================== Impact Analysis (4 methods) ====================

        public Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetPartCountByTypeIdAsync(int typeId);
        public Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetTransactionCountByPartIdAsync(string partId);
        public Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetTransactionCountByTypeIdAsync(int typeId);
        public Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetPartCountBySpecKeyAsync(int typeId, string specKey);

        // Aliases for compatibility (spec 010-dunnage-complete)
        public Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetPartCountByTypeAsync(int typeId) =&gt; GetPartCountByTypeIdAsync(typeId);
        public Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetTransactionCountByTypeAsync(int typeId) =&gt; GetTransactionCountByTypeIdAsync(typeId);
        public Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetTransactionCountByPartAsync(string partId) =&gt; GetTransactionCountByPartIdAsync(partId);

        // ==================== Custom Field Operations (3 methods) ====================

        public Task&lt;Model_Dao_Result&gt; InsertCustomFieldAsync(int typeId, Model_CustomFieldDefinition field);
        public Task&lt;Model_Dao_Result&lt;List&lt;Model_CustomFieldDefinition&gt;&gt;&gt; GetCustomFieldsByTypeAsync(int typeId);
        public Task&lt;Model_Dao_Result&gt; DeleteCustomFieldAsync(int fieldId);

        // ==================== User Preference Operations (2 methods) ====================

        public Task&lt;Model_Dao_Result&gt; UpsertUserPreferenceAsync(string key, string value);
        public Task&lt;Model_Dao_Result&lt;List&lt;Model_IconDefinition&gt;&gt;&gt; GetRecentlyUsedIconsAsync(int count);
    }
}</file><file path="Module_Dunnage/Data/Dao_DunnageLine.cs">using System;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Contracts.Services;

namespace MTM_Receiving_Application.Module_Dunnage.Data;

/// &lt;summary&gt;
/// Data Access Object for label_table_dunnage table
/// Provides CRUD operations using stored procedures
/// &lt;/summary&gt;
public static class Dao_DunnageLine
{
    private static IService_ErrorHandler? _errorHandler;

    /// &lt;summary&gt;
    /// Sets the error handler service (dependency injection)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;errorHandler&quot;&gt;&lt;/param&gt;
    public static void SetErrorHandler(IService_ErrorHandler errorHandler)
    {
        _errorHandler = errorHandler;
    }

    /// &lt;summary&gt;
    /// Inserts a new dunnage line record into the database
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;line&quot;&gt;DunnageLine model to insert&lt;/param&gt;
    /// &lt;returns&gt;Model_Dao_Result with success status and affected rows&lt;/returns&gt;
    public static async Task&lt;Model_Dao_Result&gt; InsertDunnageLineAsync(Model_DunnageLine line)
    {
        try
        {
            // Get connection string
            string connectionString = Helper_Database_Variables.GetConnectionString(useProduction: true);

            // Prepare stored procedure parameters
            var parameters = new MySqlParameter[]
            {
                new MySqlParameter(&quot;@p_Line1&quot;, line.Line1 ?? string.Empty),
                new MySqlParameter(&quot;@p_Line2&quot;, line.Line2 ?? string.Empty),
                new MySqlParameter(&quot;@p_PONumber&quot;, line.PONumber),
                new MySqlParameter(&quot;@p_Date&quot;, line.Date),
                new MySqlParameter(&quot;@p_EmployeeNumber&quot;, line.EmployeeNumber),
                new MySqlParameter(&quot;@p_VendorName&quot;, line.VendorName ?? &quot;Unknown&quot;),
                new MySqlParameter(&quot;@p_Location&quot;, line.Location ?? string.Empty),
                new MySqlParameter(&quot;@p_Status&quot;, MySqlDbType.Int32) { Direction = System.Data.ParameterDirection.Output },
                new MySqlParameter(&quot;@p_ErrorMsg&quot;, MySqlDbType.VarChar, 500) { Direction = System.Data.ParameterDirection.Output }
            };

            // Validate parameters
            if (!Helper_Database_StoredProcedure.ValidateParameters(parameters))
            {
                return new Model_Dao_Result
                {
                    Success = false,
                    ErrorMessage = &quot;Required parameters are missing or invalid&quot;,
                    Severity = Module_Core.Models.Enums.Enum_ErrorSeverity.Warning
                };
            }

            // Execute stored procedure
            var result = await Helper_Database_StoredProcedure.ExecuteAsync(
                &quot;sp_Dunnage_Line_Insert&quot;,
                parameters,
                connectionString
            );

            return result;
        }
        catch (Exception ex)
        {
            var errorResult = new Model_Dao_Result
            {
                Success = false,
                ErrorMessage = $&quot;Unexpected error inserting dunnage line: {ex.Message}&quot;,
                Severity = Module_Core.Models.Enums.Enum_ErrorSeverity.Error
            };

            // Log the error using error handler if available
            if (_errorHandler != null)
            {
                await _errorHandler.HandleErrorAsync(
                    errorResult.ErrorMessage,
                    errorResult.Severity,
                    ex,
                    showDialog: false
                );
            }

            return errorResult;
        }
    }
}</file><file path="Module_Dunnage/Data/Dao_DunnagePart.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;

namespace MTM_Receiving_Application.Module_Dunnage.Data;

public class Dao_DunnagePart
{
    private readonly string _connectionString;

    public Dao_DunnagePart(string connectionString)
    {
        _connectionString = connectionString;
    }

    public virtual async Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnagePart&gt;&gt;&gt; GetAllAsync()
    {
        return await Helper_Database_StoredProcedure.ExecuteListAsync&lt;Model_DunnagePart&gt;(
            _connectionString,
            &quot;sp_Dunnage_Parts_GetAll&quot;,
            MapFromReader
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnagePart&gt;&gt;&gt; GetByTypeAsync(int typeId)
    {
        System.Diagnostics.Debug.WriteLine($&quot;Dao_DunnagePart: GetByTypeAsync called for typeId={typeId}&quot;);
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;type_id&quot;, typeId }
        };

        var result = await Helper_Database_StoredProcedure.ExecuteListAsync&lt;Model_DunnagePart&gt;(
            _connectionString,
            &quot;sp_Dunnage_Parts_GetByType&quot;,
            MapFromReader,
            parameters
        );

        System.Diagnostics.Debug.WriteLine($&quot;Dao_DunnagePart: GetByTypeAsync returned {result.Data?.Count ?? 0} parts. Success: {result.IsSuccess}&quot;);
        return result;
    }

    public virtual async Task&lt;Model_Dao_Result&lt;Model_DunnagePart&gt;&gt; GetByIdAsync(string partId)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;part_id&quot;, partId }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync&lt;Model_DunnagePart&gt;(
            _connectionString,
            &quot;sp_Dunnage_Parts_GetById&quot;,
            MapFromReader,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;int&gt;&gt; InsertAsync(string partId, int typeId, string specValues, string homeLocation, string user)
    {
        var pNewId = new MySqlParameter(&quot;@p_new_id&quot;, MySqlDbType.Int32)
        {
            Direction = ParameterDirection.Output
        };

        var parameters = new MySqlParameter[]
        {
            new MySqlParameter(&quot;@p_part_id&quot;, partId),
            new MySqlParameter(&quot;@p_type_id&quot;, typeId),
            new MySqlParameter(&quot;@p_spec_values&quot;, specValues),
            new MySqlParameter(&quot;@p_home_location&quot;, homeLocation),
            new MySqlParameter(&quot;@p_user&quot;, user),
            pNewId
        };

        var result = await Helper_Database_StoredProcedure.ExecuteAsync(
            &quot;sp_dunnage_parts_insert&quot;,
            parameters,
            _connectionString
        );

        if (result.IsSuccess)
        {
            if (pNewId.Value != null &amp;&amp; pNewId.Value != DBNull.Value)
            {
                return Model_Dao_Result_Factory.Success&lt;int&gt;(Convert.ToInt32(pNewId.Value));
            }
            return Model_Dao_Result_Factory.Failure&lt;int&gt;(&quot;Failed to retrieve new ID&quot;);
        }

        return Model_Dao_Result_Factory.Failure&lt;int&gt;(result.ErrorMessage, result.Exception);
    }

    public virtual async Task&lt;Model_Dao_Result&gt; UpdateAsync(int id, string specValues, string homeLocation, string user)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;id&quot;, id },
            { &quot;spec_values&quot;, specValues },
            { &quot;home_location&quot;, homeLocation },
            { &quot;user&quot;, user }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_dunnage_parts_update&quot;,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&gt; DeleteAsync(int id)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;id&quot;, id }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_dunnage_parts_delete&quot;,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;int&gt;&gt; CountTransactionsAsync(string partId)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;part_id&quot;, partId }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync&lt;int&gt;(
            _connectionString,
            &quot;sp_Dunnage_Parts_CountTransactions&quot;,
            reader =&gt; reader.GetInt32(reader.GetOrdinal(&quot;transaction_count&quot;)),
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnagePart&gt;&gt;&gt; SearchAsync(string searchText, int? typeId = null)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;search_text&quot;, searchText },
            { &quot;type_id&quot;, typeId ?? 0 }
        };

        return await Helper_Database_StoredProcedure.ExecuteListAsync&lt;Model_DunnagePart&gt;(
            _connectionString,
            &quot;sp_dunnage_parts_search&quot;,
            MapFromReader,
            parameters
        );
    }

    private Model_DunnagePart MapFromReader(IDataReader reader)
    {
        return new Model_DunnagePart
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            PartId = reader.GetString(reader.GetOrdinal(&quot;part_id&quot;)),
            TypeId = reader.GetInt32(reader.GetOrdinal(&quot;type_id&quot;)),
            SpecValues = reader.IsDBNull(reader.GetOrdinal(&quot;spec_values&quot;)) ? &quot;{}&quot; : reader.GetString(reader.GetOrdinal(&quot;spec_values&quot;)),
            HomeLocation = reader.IsDBNull(reader.GetOrdinal(&quot;home_location&quot;)) ? string.Empty : reader.GetString(reader.GetOrdinal(&quot;home_location&quot;)),
            CreatedBy = reader.GetString(reader.GetOrdinal(&quot;created_by&quot;)),
            CreatedDate = reader.GetDateTime(reader.GetOrdinal(&quot;created_date&quot;)),
            ModifiedBy = reader.IsDBNull(reader.GetOrdinal(&quot;modified_by&quot;)) ? null : reader.GetString(reader.GetOrdinal(&quot;modified_by&quot;)),
            ModifiedDate = reader.IsDBNull(reader.GetOrdinal(&quot;modified_date&quot;)) ? null : reader.GetDateTime(reader.GetOrdinal(&quot;modified_date&quot;))
        };
    }
}</file><file path="Module_Dunnage/Data/Dao_DunnageSpec.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;

namespace MTM_Receiving_Application.Module_Dunnage.Data;

public class Dao_DunnageSpec
{
    private readonly string _connectionString;

    public Dao_DunnageSpec(string connectionString)
    {
        _connectionString = connectionString;
    }

    public virtual async Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnageSpec&gt;&gt;&gt; GetByTypeAsync(int typeId)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;type_id&quot;, typeId }
        };

        return await Helper_Database_StoredProcedure.ExecuteListAsync&lt;Model_DunnageSpec&gt;(
            _connectionString,
            &quot;sp_Dunnage_Specs_GetByType&quot;,
            MapFromReader,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnageSpec&gt;&gt;&gt; GetAllAsync()
    {
        return await Helper_Database_StoredProcedure.ExecuteListAsync&lt;Model_DunnageSpec&gt;(
            _connectionString,
            &quot;sp_Dunnage_Specs_GetAll&quot;,
            MapFromReader
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;Model_DunnageSpec&gt;&gt; GetByIdAsync(int id)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;id&quot;, id }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync&lt;Model_DunnageSpec&gt;(
            _connectionString,
            &quot;sp_Dunnage_Specs_GetById&quot;,
            MapFromReader,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;int&gt;&gt; InsertAsync(int typeId, string specKey, string specValue, string user)
    {
        var pNewId = new MySqlParameter(&quot;@p_new_id&quot;, MySqlDbType.Int32)
        {
            Direction = ParameterDirection.Output
        };

        var parameters = new MySqlParameter[]
        {
            new MySqlParameter(&quot;@p_type_id&quot;, typeId),
            new MySqlParameter(&quot;@p_spec_key&quot;, specKey),
            new MySqlParameter(&quot;@p_spec_value&quot;, specValue),
            new MySqlParameter(&quot;@p_user&quot;, user),
            pNewId
        };

        var result = await Helper_Database_StoredProcedure.ExecuteAsync(
            &quot;sp_dunnage_specs_insert&quot;,
            parameters,
            _connectionString
        );

        if (result.IsSuccess)
        {
            if (pNewId.Value != null &amp;&amp; pNewId.Value != DBNull.Value)
            {
                return Model_Dao_Result_Factory.Success&lt;int&gt;(Convert.ToInt32(pNewId.Value));
            }
            return Model_Dao_Result_Factory.Failure&lt;int&gt;(&quot;Failed to retrieve new ID&quot;);
        }

        return Model_Dao_Result_Factory.Failure&lt;int&gt;(result.ErrorMessage, result.Exception);
    }

    public virtual async Task&lt;Model_Dao_Result&gt; UpdateAsync(int id, string specValue, string user)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;id&quot;, id },
            { &quot;spec_value&quot;, specValue },
            { &quot;user&quot;, user }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_dunnage_specs_update&quot;,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&gt; DeleteByIdAsync(int id)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;id&quot;, id }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Dunnage_Specs_DeleteById&quot;,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&gt; DeleteByTypeAsync(int typeId)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;type_id&quot;, typeId }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Dunnage_Specs_DeleteByType&quot;,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;int&gt;&gt; CountPartsUsingSpecAsync(int typeId, string specKey)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;type_id&quot;, typeId },
            { &quot;spec_key&quot;, specKey }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync&lt;int&gt;(
            _connectionString,
            &quot;sp_Dunnage_Specs_CountPartsUsingSpec&quot;,
            reader =&gt; reader.GetInt32(reader.GetOrdinal(&quot;part_count&quot;)),
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Get union of all unique spec keys across all types (for dynamic CSV columns)
    /// &lt;/summary&gt;
    /// &lt;returns&gt;List of distinct spec keys ordered alphabetically&lt;/returns&gt;
    public virtual async Task&lt;Model_Dao_Result&lt;List&lt;string&gt;&gt;&gt; GetAllSpecKeysAsync()
    {
        return await Helper_Database_StoredProcedure.ExecuteListAsync&lt;string&gt;(
            _connectionString,
            &quot;sp_Dunnage_Specs_GetAllKeys&quot;,
            reader =&gt; reader.GetString(reader.GetOrdinal(&quot;SpecKey&quot;))
        );
    }

    private Model_DunnageSpec MapFromReader(IDataReader reader)
    {
        return new Model_DunnageSpec
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            TypeId = reader.GetInt32(reader.GetOrdinal(&quot;type_id&quot;)),
            SpecKey = reader.GetString(reader.GetOrdinal(&quot;spec_key&quot;)),
            SpecValue = reader.IsDBNull(reader.GetOrdinal(&quot;spec_value&quot;)) ? &quot;{}&quot; : reader.GetString(reader.GetOrdinal(&quot;spec_value&quot;)),
            CreatedBy = reader.GetString(reader.GetOrdinal(&quot;created_by&quot;)),
            CreatedDate = reader.GetDateTime(reader.GetOrdinal(&quot;created_date&quot;)),
            ModifiedBy = reader.IsDBNull(reader.GetOrdinal(&quot;modified_by&quot;)) ? null : reader.GetString(reader.GetOrdinal(&quot;modified_by&quot;)),
            ModifiedDate = reader.IsDBNull(reader.GetOrdinal(&quot;modified_date&quot;)) ? null : reader.GetDateTime(reader.GetOrdinal(&quot;modified_date&quot;))
        };
    }
}</file><file path="Module_Dunnage/Data/Dao_DunnageUserPreference.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;

namespace MTM_Receiving_Application.Module_Dunnage.Data;

public class Dao_DunnageUserPreference
{
    private readonly string _connectionString;

    public Dao_DunnageUserPreference(string connectionString)
    {
        _connectionString = connectionString;
    }

    public virtual async Task&lt;Model_Dao_Result&gt; UpsertAsync(string userId, string key, string value)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;user_id&quot;, userId },
            { &quot;pref_key&quot;, key },
            { &quot;pref_value&quot;, value }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Dunnage_UserPreferences_Upsert&quot;,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;List&lt;Model_IconDefinition&gt;&gt;&gt; GetRecentlyUsedIconsAsync(string userId, int count)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;user_id&quot;, userId },
            { &quot;count&quot;, count }
        };

        return await Helper_Database_StoredProcedure.ExecuteListAsync&lt;Model_IconDefinition&gt;(
            _connectionString,
            &quot;sp_Dunnage_UserPreferences_GetRecentIcons&quot;,
            reader =&gt; new Model_IconDefinition
            {
                IconName = reader.GetString(reader.GetOrdinal(&quot;icon_name&quot;))
            },
            parameters
        );
    }
}</file><file path="Module_Dunnage/Enums/Enum_DunnageAdminSection.cs">namespace MTM_Receiving_Application.Module_Dunnage.Enums;

/// &lt;summary&gt;
/// Enum for Dunnage Admin UI sections
/// &lt;/summary&gt;
public enum Enum_DunnageAdminSection
{
    /// &lt;summary&gt;
    /// Main navigation hub (4-card view)
    /// &lt;/summary&gt;
    Hub = 0,

    /// &lt;summary&gt;
    /// Dunnage Types management (CRUD on dunnage_types table)
    /// &lt;/summary&gt;
    Types = 1,

    /// &lt;summary&gt;
    /// Part Master management (CRUD on dunnage_part_numbers table)
    /// &lt;/summary&gt;
    Parts = 2,

    /// &lt;summary&gt;
    /// Spec Definitions management (CRUD on dunnage_specs table)
    /// &lt;/summary&gt;
    Specs = 3,

    /// &lt;summary&gt;
    /// Inventoried Dunnage List (CRUD on dunnage_requires_inventory_list table)
    /// &lt;/summary&gt;
    InventoriedList = 4
}</file><file path="Module_Dunnage/Models/Model_CustomFieldDefinition.cs">using System;
using System.Collections.Generic;
using CommunityToolkit.Mvvm.ComponentModel;

namespace MTM_Receiving_Application.Module_Dunnage.Models;

/// &lt;summary&gt;
/// Represents a user-defined custom field for dunnage types.
/// Corresponds to dunnage_custom_fields table.
/// &lt;/summary&gt;
public partial class Model_CustomFieldDefinition : ObservableObject
{
    [ObservableProperty]
    private int _id;

    [ObservableProperty]
    private int _dunnageTypeId;

    [ObservableProperty]
    private string _fieldName = string.Empty;

    [ObservableProperty]
    private string _databaseColumnName = string.Empty;

    [ObservableProperty]
    private string _fieldType = &quot;Text&quot;;

    [ObservableProperty]
    private int _displayOrder;

    [ObservableProperty]
    private bool _isRequired;

    [ObservableProperty]
    private string? _validationRules;

    [ObservableProperty]
    private DateTime _createdDate = DateTime.Now;

    [ObservableProperty]
    private string _createdBy = string.Empty;

    /// &lt;summary&gt;
    /// Returns a summary string for display in the UI
    /// &lt;/summary&gt;
    public string GetSummary()
    {
        string required = IsRequired ? &quot; (Required)&quot; : string.Empty;
        return $&quot;{FieldType}{required}&quot;;
    }
}</file><file path="Module_Dunnage/Models/Model_DunnageLoad.cs">using System;
using System.Collections.Generic;
using CommunityToolkit.Mvvm.ComponentModel;
using Material.Icons;

namespace MTM_Receiving_Application.Module_Dunnage.Models;

/// &lt;summary&gt;
/// Represents a received dunnage load transaction.
/// Database Table: dunnage_history
/// &lt;/summary&gt;
public partial class Model_DunnageLoad : ObservableObject
{
    [ObservableProperty]
    private Guid _loadUuid;

    [ObservableProperty]
    private string _partId = string.Empty;

    [ObservableProperty]
    private decimal _quantity;

    [ObservableProperty]
    private string _poNumber = string.Empty;

    [ObservableProperty]
    private string _dunnageType = string.Empty;

    [ObservableProperty]
    private int? _typeId;

    [ObservableProperty]
    private Dictionary&lt;string, object&gt; _specs = new();

    [ObservableProperty]
    private string? _location = string.Empty;

    [ObservableProperty]
    private string? _homeLocation = string.Empty;

    [ObservableProperty]
    private string _typeName = string.Empty;

    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(TypeIconKind))]
    private string _typeIcon = &quot;Help&quot;;

    /// &lt;summary&gt;
    /// Gets the MaterialIconKind for the dunnage type
    /// &lt;/summary&gt;
    public MaterialIconKind TypeIconKind
    {
        get
        {
            if (!string.IsNullOrEmpty(TypeIcon) &amp;&amp; Enum.TryParse&lt;MaterialIconKind&gt;(TypeIcon, true, out var kind))
            {
                return kind;
            }
            return MaterialIconKind.PackageVariantClosed;
        }
    }

    [ObservableProperty]
    private string _inventoryMethod = &quot;Adjust In&quot;;

    [ObservableProperty]
    private Dictionary&lt;string, object&gt;? _specValues;

    [ObservableProperty]
    private DateTime _receivedDate = DateTime.Now;

    [ObservableProperty]
    private string _createdBy = string.Empty;

    [ObservableProperty]
    private DateTime _createdDate = DateTime.Now;

    [ObservableProperty]
    private string? _modifiedBy;

    [ObservableProperty]
    private DateTime? _modifiedDate;

    [ObservableProperty]
    private string? _labelNumber;

    [ObservableProperty]
    private int _loadNumber;

    [ObservableProperty]
    private bool _isSelected;
}</file><file path="Module_Dunnage/Services/Service_MySQL_Dunnage.cs">using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Dunnage.Data;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Dunnage.Services
{
    public class Service_MySQL_Dunnage : IService_MySQL_Dunnage
    {
        private readonly IService_ErrorHandler _errorHandler;
        private readonly IService_LoggingUtility _logger;
        private readonly IService_UserSessionManager _sessionManager;
        private readonly Dao_DunnageLoad _daoDunnageLoad;
        private readonly Dao_DunnageType _daoDunnageType;
        private readonly Dao_DunnagePart _daoDunnagePart;
        private readonly Dao_DunnageSpec _daoDunnageSpec;
        private readonly Dao_InventoriedDunnage _daoInventoriedDunnage;
        private readonly Dao_DunnageCustomField _daoCustomField;
        private readonly Dao_DunnageUserPreference _daoUserPreference;

        private string CurrentUser =&gt; _sessionManager.CurrentSession?.User?.WindowsUsername ?? &quot;System&quot;;

        public Service_MySQL_Dunnage(
            IService_ErrorHandler errorHandler,
            IService_LoggingUtility logger,
            IService_UserSessionManager sessionManager,
            Dao_DunnageLoad daoDunnageLoad,
            Dao_DunnageType daoDunnageType,
            Dao_DunnagePart daoDunnagePart,
            Dao_DunnageSpec daoDunnageSpec,
            Dao_InventoriedDunnage daoInventoriedDunnage,
            Dao_DunnageCustomField daoCustomField,
            Dao_DunnageUserPreference daoUserPreference)
        {
            _errorHandler = errorHandler;
            _logger = logger;
            _sessionManager = sessionManager;
            _daoDunnageLoad = daoDunnageLoad;
            _daoDunnageType = daoDunnageType;
            _daoDunnagePart = daoDunnagePart;
            _daoDunnageSpec = daoDunnageSpec;
            _daoInventoriedDunnage = daoInventoriedDunnage;
            _daoCustomField = daoCustomField;
            _daoUserPreference = daoUserPreference;
        }

        // ==================== Type Operations ====================

        public async Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnageType&gt;&gt;&gt; GetAllTypesAsync()
        {
            try
            {
                return await _daoDunnageType.GetAllAsync();
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(GetAllTypesAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_DunnageType&gt;&gt;($&quot;Error retrieving dunnage types: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&lt;Model_DunnageType&gt;&gt; GetTypeByIdAsync(int typeId)
        {
            try
            {
                return await _daoDunnageType.GetByIdAsync(typeId);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(GetTypeByIdAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;Model_DunnageType&gt;($&quot;Error retrieving dunnage type: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; InsertTypeAsync(string typeName, string icon)
        {
            try
            {
                return await _daoDunnageType.InsertAsync(typeName, icon, CurrentUser);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(InsertTypeAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;int&gt;($&quot;Error inserting dunnage type: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&gt; InsertTypeAsync(Model_DunnageType type)
        {
            try
            {
                await _logger.LogInfoAsync($&quot;Inserting new dunnage type: {type.TypeName} (Icon: {type.Icon}) by user: {CurrentUser}&quot;);
                var result = await _daoDunnageType.InsertAsync(type.TypeName, type.Icon, CurrentUser);
                if (result.IsSuccess)
                {
                    type.Id = result.Data;
                    await _logger.LogInfoAsync($&quot;Successfully inserted dunnage type &apos;{type.TypeName}&apos; with ID: {type.Id}&quot;);
                    return Model_Dao_Result_Factory.Success();
                }

                if (result.ErrorMessage.Contains(&quot;Duplicate entry&quot;))
                {
                    await _logger.LogWarningAsync($&quot;Failed to insert dunnage type &apos;{type.TypeName}&apos;: Duplicate entry&quot;);
                    return Model_Dao_Result_Factory.Failure($&quot;The dunnage type name &apos;{type.TypeName}&apos; is already in use.&quot;);
                }

                await _logger.LogErrorAsync($&quot;Failed to insert dunnage type &apos;{type.TypeName}&apos;: {result.ErrorMessage}&quot;);
                return Model_Dao_Result_Factory.Failure(result.ErrorMessage);
            }
            catch (Exception ex)
            {
                await _logger.LogErrorAsync($&quot;Exception in InsertTypeAsync for type &apos;{type.TypeName}&apos;: {ex.Message}&quot;);
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(InsertTypeAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure($&quot;Error inserting dunnage type: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&gt; UpdateTypeAsync(Model_DunnageType type)
        {
            try
            {
                await _logger.LogInfoAsync($&quot;Updating dunnage type ID {type.Id}: {type.TypeName} (Icon: {type.Icon}) by user: {CurrentUser}&quot;);
                var result = await _daoDunnageType.UpdateAsync(type.Id, type.TypeName, type.Icon, CurrentUser);

                if (!result.IsSuccess &amp;&amp; result.ErrorMessage.Contains(&quot;Duplicate entry&quot;))
                {
                    await _logger.LogWarningAsync($&quot;Failed to update dunnage type ID {type.Id}: Duplicate entry for &apos;{type.TypeName}&apos;&quot;);
                    return Model_Dao_Result_Factory.Failure($&quot;The dunnage type name &apos;{type.TypeName}&apos; is already in use.&quot;);
                }

                if (result.IsSuccess)
                {
                    await _logger.LogInfoAsync($&quot;Successfully updated dunnage type ID {type.Id}: {type.TypeName}&quot;);
                }
                else
                {
                    await _logger.LogErrorAsync($&quot;Failed to update dunnage type ID {type.Id}: {result.ErrorMessage}&quot;);
                }

                return result;
            }
            catch (Exception ex)
            {
                await _logger.LogErrorAsync($&quot;Exception in UpdateTypeAsync for type ID {type.Id}: {ex.Message}&quot;);
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(UpdateTypeAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure($&quot;Error updating dunnage type: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&gt; DeleteTypeAsync(int typeId)
        {
            try
            {
                await _logger.LogInfoAsync($&quot;Attempting to delete dunnage type ID {typeId} by user: {CurrentUser}&quot;);

                // Check if any parts are using this type
                var partsResult = await _daoDunnagePart.GetByTypeAsync(typeId);
                if (partsResult.IsSuccess &amp;&amp; partsResult.Data?.Count &gt; 0)
                {
                    await _logger.LogWarningAsync($&quot;Cannot delete dunnage type ID {typeId}: Used by {partsResult.Data.Count} parts&quot;);
                    return Model_Dao_Result_Factory.Failure($&quot;Cannot delete type. It is used by {partsResult.Data.Count} parts.&quot;);
                }

                // Check if any specs are defined for this type
                var specsResult = await _daoDunnageSpec.GetByTypeAsync(typeId);
                if (specsResult.IsSuccess &amp;&amp; specsResult.Data?.Count &gt; 0)
                {
                    await _logger.LogWarningAsync($&quot;Cannot delete dunnage type ID {typeId}: Has {specsResult.Data.Count} specifications defined&quot;);
                    return Model_Dao_Result_Factory.Failure($&quot;Cannot delete type. It has {specsResult.Data.Count} specifications defined. Please delete them first.&quot;);
                }

                var result = await _daoDunnageType.DeleteAsync(typeId);
                if (result.IsSuccess)
                {
                    await _logger.LogInfoAsync($&quot;Successfully deleted dunnage type ID {typeId}&quot;);
                }
                else
                {
                    await _logger.LogErrorAsync($&quot;Failed to delete dunnage type ID {typeId}: {result.ErrorMessage}&quot;);
                }
                return result;
            }
            catch (Exception ex)
            {
                await _logger.LogErrorAsync($&quot;Exception in DeleteTypeAsync for type ID {typeId}: {ex.Message}&quot;);
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(DeleteTypeAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure($&quot;Error deleting dunnage type: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; CheckDuplicateTypeNameAsync(string typeName)
        {
            try
            {
                var result = await _daoDunnageType.CheckDuplicateNameAsync(typeName);
                if (result.IsSuccess)
                {
                    return Model_Dao_Result_Factory.Success&lt;int&gt;(result.Data ? 1 : 0);
                }
                return Model_Dao_Result_Factory.Failure&lt;int&gt;(result.ErrorMessage);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(CheckDuplicateTypeNameAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;int&gt;($&quot;Error checking duplicate type name: {ex.Message}&quot;);
            }
        }

        // ==================== Spec Operations ====================

        public async Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnageSpec&gt;&gt;&gt; GetSpecsForTypeAsync(int typeId)
        {
            try
            {
                return await _daoDunnageSpec.GetByTypeAsync(typeId);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(GetSpecsForTypeAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_DunnageSpec&gt;&gt;($&quot;Error retrieving specs: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&gt; InsertSpecAsync(Model_DunnageSpec spec)
        {
            try
            {
                await _logger.LogInfoAsync($&quot;Inserting spec &apos;{spec.SpecKey}&apos; for type ID {spec.TypeId} by user: {CurrentUser}&quot;);
                var result = await _daoDunnageSpec.InsertAsync(spec.TypeId, spec.SpecKey, spec.SpecValue, CurrentUser);
                if (result.IsSuccess)
                {
                    spec.Id = result.Data;
                    await _logger.LogInfoAsync($&quot;Successfully inserted spec &apos;{spec.SpecKey}&apos; with ID: {spec.Id}&quot;);
                    return Model_Dao_Result_Factory.Success();
                }
                await _logger.LogErrorAsync($&quot;Failed to insert spec &apos;{spec.SpecKey}&apos; for type ID {spec.TypeId}: {result.ErrorMessage}&quot;);
                return Model_Dao_Result_Factory.Failure(result.ErrorMessage);
            }
            catch (Exception ex)
            {
                await _logger.LogErrorAsync($&quot;Exception in InsertSpecAsync for spec &apos;{spec.SpecKey}&apos;: {ex.Message}&quot;);
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(InsertSpecAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure($&quot;Error inserting spec: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&gt; UpdateSpecAsync(Model_DunnageSpec spec)
        {
            try
            {
                await _logger.LogInfoAsync($&quot;Updating spec ID {spec.Id}: {spec.SpecKey} = {spec.SpecValue} by user: {CurrentUser}&quot;);
                var result = await _daoDunnageSpec.UpdateAsync(spec.Id, spec.SpecValue, CurrentUser);
                if (result.IsSuccess)
                {
                    await _logger.LogInfoAsync($&quot;Successfully updated spec ID {spec.Id}: {spec.SpecKey}&quot;);
                }
                else
                {
                    await _logger.LogErrorAsync($&quot;Failed to update spec ID {spec.Id}: {result.ErrorMessage}&quot;);
                }
                return result;
            }
            catch (Exception ex)
            {
                await _logger.LogErrorAsync($&quot;Exception in UpdateSpecAsync for spec ID {spec.Id}: {ex.Message}&quot;);
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(UpdateSpecAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure($&quot;Error updating spec: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&gt; DeleteSpecAsync(int specId)
        {
            try
            {
                return await _daoDunnageSpec.DeleteByIdAsync(specId);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(DeleteSpecAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure($&quot;Error deleting spec: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&gt; DeleteSpecsByTypeIdAsync(int typeId)
        {
            // Not implemented in DAO yet, but typically handled by cascade delete in DB
            return Model_Dao_Result_Factory.Success();
        }

        public async Task&lt;List&lt;string&gt;&gt; GetAllSpecKeysAsync()
        {
            try
            {
                var result = await _daoDunnageSpec.GetAllAsync();
                if (result.IsSuccess &amp;&amp; result.Data != null)
                {
                    return result.Data
                        .Select(s =&gt; s.SpecKey)
                        .Distinct()
                        .Order()
                        .ToList();
                }

                return new List&lt;string&gt;();
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(GetAllSpecKeysAsync), nameof(Service_MySQL_Dunnage));
                return new List&lt;string&gt;();
            }
        }

        // ==================== Part Operations ====================

        public async Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnagePart&gt;&gt;&gt; GetAllPartsAsync()
        {
            try
            {
                return await _daoDunnagePart.GetAllAsync();
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(GetAllPartsAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_DunnagePart&gt;&gt;($&quot;Error retrieving parts: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnagePart&gt;&gt;&gt; GetPartsByTypeAsync(int typeId)
        {
            _logger.LogInfo($&quot;Service_MySQL_Dunnage: GetPartsByTypeAsync called for typeId={typeId}&quot;, &quot;DunnageService&quot;);
            try
            {
                var result = await _daoDunnagePart.GetByTypeAsync(typeId);
                _logger.LogInfo($&quot;Service_MySQL_Dunnage: GetPartsByTypeAsync returned {result.Data?.Count ?? 0} parts&quot;, &quot;DunnageService&quot;);
                return result;
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(GetPartsByTypeAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_DunnagePart&gt;&gt;($&quot;Error retrieving parts by type: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&lt;Model_DunnagePart&gt;&gt; GetPartByIdAsync(string partId)
        {
            try
            {
                return await _daoDunnagePart.GetByIdAsync(partId);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(GetPartByIdAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;Model_DunnagePart&gt;($&quot;Error retrieving part: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&gt; InsertPartAsync(Model_DunnagePart part)
        {
            try
            {
                await _logger.LogInfoAsync($&quot;Inserting new dunnage part: {part.PartId} (Type ID: {part.TypeId}, Home Location: {part.HomeLocation}) by user: {CurrentUser}&quot;);
                var result = await _daoDunnagePart.InsertAsync(part.PartId, part.TypeId, part.SpecValues, part.HomeLocation, CurrentUser);
                if (result.IsSuccess)
                {
                    part.Id = result.Data;
                    await _logger.LogInfoAsync($&quot;Successfully inserted dunnage part &apos;{part.PartId}&apos; with ID: {part.Id}&quot;);
                    return Model_Dao_Result_Factory.Success();
                }
                await _logger.LogErrorAsync($&quot;Failed to insert dunnage part &apos;{part.PartId}&apos;: {result.ErrorMessage}&quot;);
                return Model_Dao_Result_Factory.Failure(result.ErrorMessage);
            }
            catch (Exception ex)
            {
                await _logger.LogErrorAsync($&quot;Exception in InsertPartAsync for part &apos;{part.PartId}&apos;: {ex.Message}&quot;);
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(InsertPartAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure($&quot;Error inserting part: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&gt; UpdatePartAsync(Model_DunnagePart part)
        {
            try
            {
                await _logger.LogInfoAsync($&quot;Updating dunnage part ID {part.Id} (Part ID: {part.PartId}, Home Location: {part.HomeLocation}) by user: {CurrentUser}&quot;);
                var result = await _daoDunnagePart.UpdateAsync(part.Id, part.SpecValues, part.HomeLocation, CurrentUser);
                if (result.IsSuccess)
                {
                    await _logger.LogInfoAsync($&quot;Successfully updated dunnage part ID {part.Id}&quot;);
                }
                else
                {
                    await _logger.LogErrorAsync($&quot;Failed to update dunnage part ID {part.Id}: {result.ErrorMessage}&quot;);
                }
                return result;
            }
            catch (Exception ex)
            {
                await _logger.LogErrorAsync($&quot;Exception in UpdatePartAsync for part ID {part.Id}: {ex.Message}&quot;);
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(UpdatePartAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure($&quot;Error updating part: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&gt; DeletePartAsync(string partId)
        {
            // Dao_DunnagePart does not have DeleteAsync yet.
            return Model_Dao_Result_Factory.Failure(&quot;Delete part not implemented in DAO yet.&quot;);
        }

        public async Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnagePart&gt;&gt;&gt; SearchPartsAsync(string searchText, int? typeId)
        {
            try
            {
                Model_Dao_Result&lt;List&lt;Model_DunnagePart&gt;&gt; result;
                if (typeId.HasValue)
                {
                    result = await _daoDunnagePart.GetByTypeAsync(typeId.Value);
                }
                else
                {
                    result = await _daoDunnagePart.GetAllAsync();
                }

                if (!result.IsSuccess || result.Data == null)
                {
                    return result;
                }

                if (string.IsNullOrWhiteSpace(searchText))
                {
                    return result;
                }

                var filtered = result.Data.Where(p =&gt;
                    p.PartId.Contains(searchText, StringComparison.OrdinalIgnoreCase) ||
                    p.DunnageTypeName.Contains(searchText, StringComparison.OrdinalIgnoreCase)
                ).ToList();

                return Model_Dao_Result_Factory.Success&lt;List&lt;Model_DunnagePart&gt;&gt;(filtered);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(SearchPartsAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_DunnagePart&gt;&gt;($&quot;Error searching parts: {ex.Message}&quot;);
            }
        }

        // ==================== Load Operations ====================

        public async Task&lt;Model_Dao_Result&gt; SaveLoadsAsync(List&lt;Model_DunnageLoad&gt; loads)
        {
            try
            {
                if (loads == null || loads.Count == 0)
                {
                    await _logger.LogInfoAsync(&quot;SaveLoadsAsync called with no loads to save&quot;);
                    return Model_Dao_Result_Factory.Success();
                }

                await _logger.LogInfoAsync($&quot;Saving batch of {loads.Count} dunnage loads by user: {CurrentUser}&quot;);
                var result = await _daoDunnageLoad.InsertBatchAsync(loads, CurrentUser);
                if (result.IsSuccess)
                {
                    var totalQuantity = loads.Sum(l =&gt; l.Quantity);
                    await _logger.LogInfoAsync($&quot;Successfully saved {loads.Count} dunnage loads (Total Quantity: {totalQuantity})&quot;);
                }
                else
                {
                    await _logger.LogErrorAsync($&quot;Failed to save {loads.Count} dunnage loads: {result.ErrorMessage}&quot;);
                }
                return result;
            }
            catch (Exception ex)
            {
                await _logger.LogErrorAsync($&quot;Exception in SaveLoadsAsync for {loads?.Count ?? 0} loads: {ex.Message}&quot;);
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(SaveLoadsAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure($&quot;Error saving loads: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnageLoad&gt;&gt;&gt; GetLoadsByDateRangeAsync(DateTime start, DateTime end)
        {
            try
            {
                return await _daoDunnageLoad.GetByDateRangeAsync(start, end);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(GetLoadsByDateRangeAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_DunnageLoad&gt;&gt;($&quot;Error retrieving loads: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnageLoad&gt;&gt;&gt; GetAllLoadsAsync()
        {
            try
            {
                return await _daoDunnageLoad.GetAllAsync();
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(GetAllLoadsAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_DunnageLoad&gt;&gt;($&quot;Error retrieving all loads: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&lt;Model_DunnageLoad&gt;&gt; GetLoadByIdAsync(string loadUuid)
        {
            try
            {
                if (Guid.TryParse(loadUuid, out var guid))
                {
                    return await _daoDunnageLoad.GetByIdAsync(guid);
                }
                return Model_Dao_Result_Factory.Failure&lt;Model_DunnageLoad&gt;(&quot;Invalid UUID format&quot;);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(GetLoadByIdAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;Model_DunnageLoad&gt;($&quot;Error retrieving load: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&gt; UpdateLoadAsync(Model_DunnageLoad load)
        {
            return Model_Dao_Result_Factory.Failure(&quot;Update load not implemented in DAO yet.&quot;);
        }

        public async Task&lt;Model_Dao_Result&gt; DeleteLoadAsync(string loadUuid)
        {
            return Model_Dao_Result_Factory.Failure(&quot;Delete load not implemented in DAO yet.&quot;);
        }

        // ==================== Inventory Operations ====================

        public async Task&lt;bool&gt; IsPartInventoriedAsync(string partId)
        {
            try
            {
                var result = await _daoInventoriedDunnage.CheckAsync(partId);
                return result.IsSuccess &amp;&amp; result.Data;
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Warning, nameof(IsPartInventoriedAsync), nameof(Service_MySQL_Dunnage));
                return false;
            }
        }

        public async Task&lt;Model_Dao_Result&lt;Model_InventoriedDunnage&gt;&gt; GetInventoryDetailsAsync(string partId)
        {
            try
            {
                return await _daoInventoriedDunnage.GetByPartAsync(partId);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(GetInventoryDetailsAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;Model_InventoriedDunnage&gt;($&quot;Error retrieving inventory details: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&lt;List&lt;Model_InventoriedDunnage&gt;&gt;&gt; GetAllInventoriedPartsAsync()
        {
            try
            {
                return await _daoInventoriedDunnage.GetAllAsync();
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(GetAllInventoriedPartsAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_InventoriedDunnage&gt;&gt;($&quot;Error retrieving inventoried parts: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&gt; AddToInventoriedListAsync(Model_InventoriedDunnage item)
        {
            try
            {
                await _logger.LogInfoAsync($&quot;Adding part &apos;{item.PartId}&apos; to inventoried list (Method: {item.InventoryMethod}) by user: {CurrentUser}&quot;);
                var result = await _daoInventoriedDunnage.InsertAsync(item.PartId, item.InventoryMethod ?? string.Empty, item.Notes ?? string.Empty, CurrentUser);
                if (result.IsSuccess)
                {
                    item.Id = result.Data;
                    await _logger.LogInfoAsync($&quot;Successfully added part &apos;{item.PartId}&apos; to inventoried list with ID: {item.Id}&quot;);
                    return Model_Dao_Result_Factory.Success();
                }
                await _logger.LogErrorAsync($&quot;Failed to add part &apos;{item.PartId}&apos; to inventoried list: {result.ErrorMessage}&quot;);
                return Model_Dao_Result_Factory.Failure(result.ErrorMessage);
            }
            catch (Exception ex)
            {
                await _logger.LogErrorAsync($&quot;Exception in AddToInventoriedListAsync for part &apos;{item.PartId}&apos;: {ex.Message}&quot;);
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(AddToInventoriedListAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure($&quot;Error adding to inventory list: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&gt; RemoveFromInventoriedListAsync(string partId)
        {
            return Model_Dao_Result_Factory.Failure(&quot;Remove from inventory list not implemented in DAO yet.&quot;);
        }

        public async Task&lt;Model_Dao_Result&gt; UpdateInventoriedPartAsync(Model_InventoriedDunnage item)
        {
            try
            {
                return await _daoInventoriedDunnage.UpdateAsync(item.Id, item.InventoryMethod ?? string.Empty, item.Notes ?? string.Empty, CurrentUser);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(UpdateInventoriedPartAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure($&quot;Error updating inventory item: {ex.Message}&quot;);
            }
        }

        // ==================== Impact Analysis ====================

        public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetPartCountByTypeIdAsync(int typeId)
        {
            try
            {
                return await _daoDunnageType.CountPartsAsync(typeId);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Warning, nameof(GetPartCountByTypeIdAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;int&gt;($&quot;Error counting parts: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetTransactionCountByPartIdAsync(string partId)
        {
            try
            {
                return await _daoDunnagePart.CountTransactionsAsync(partId);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Warning, nameof(GetTransactionCountByPartIdAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;int&gt;($&quot;Error counting transactions: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetTransactionCountByTypeIdAsync(int typeId)
        {
            try
            {
                return await _daoDunnageType.CountTransactionsAsync(typeId);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Warning, nameof(GetTransactionCountByTypeIdAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;int&gt;($&quot;Error counting transactions: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetPartCountBySpecKeyAsync(int typeId, string specKey)
        {
            try
            {
                return await _daoDunnageSpec.CountPartsUsingSpecAsync(typeId, specKey);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Warning, nameof(GetPartCountBySpecKeyAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;int&gt;($&quot;Error counting parts using spec: {ex.Message}&quot;);
            }
        }

        // ==================== Custom Field Operations ====================

        public async Task&lt;Model_Dao_Result&gt; InsertCustomFieldAsync(int typeId, Model_CustomFieldDefinition field)
        {
            try
            {
                var result = await _daoCustomField.InsertAsync(typeId, field, CurrentUser);
                if (result.IsSuccess)
                {
                    field.Id = result.Data;
                    return Model_Dao_Result_Factory.Success();
                }
                return Model_Dao_Result_Factory.Failure(result.ErrorMessage);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(InsertCustomFieldAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure($&quot;Error inserting custom field: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&lt;List&lt;Model_CustomFieldDefinition&gt;&gt;&gt; GetCustomFieldsByTypeAsync(int typeId)
        {
            try
            {
                return await _daoCustomField.GetByTypeAsync(typeId);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(GetCustomFieldsByTypeAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_CustomFieldDefinition&gt;&gt;($&quot;Error retrieving custom fields: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&gt; DeleteCustomFieldAsync(int fieldId)
        {
            try
            {
                return await _daoCustomField.DeleteAsync(fieldId);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(DeleteCustomFieldAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure($&quot;Error deleting custom field: {ex.Message}&quot;);
            }
        }

        // ==================== User Preference Operations ====================

        public async Task&lt;Model_Dao_Result&gt; UpsertUserPreferenceAsync(string key, string value)
        {
            try
            {
                return await _daoUserPreference.UpsertAsync(CurrentUser, key, value);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(UpsertUserPreferenceAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure($&quot;Error saving user preference: {ex.Message}&quot;);
            }
        }

        public async Task&lt;Model_Dao_Result&lt;List&lt;Model_IconDefinition&gt;&gt;&gt; GetRecentlyUsedIconsAsync(int count)
        {
            try
            {
                return await _daoUserPreference.GetRecentlyUsedIconsAsync(CurrentUser, count);
            }
            catch (Exception ex)
            {
                HandleException(ex, Enum_ErrorSeverity.Error, nameof(GetRecentlyUsedIconsAsync), nameof(Service_MySQL_Dunnage));
                return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_IconDefinition&gt;&gt;($&quot;Error retrieving recent icons: {ex.Message}&quot;);
            }
        }

        private void HandleException(Exception ex, Enum_ErrorSeverity severity, string method, string className)
        {
            _ = _errorHandler.HandleErrorAsync($&quot;Error in {method} ({className}): {ex.Message}&quot;, severity, ex);
        }
    }
}</file><file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_AdminPartsViewModel.cs">using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Dunnage Part Management
/// Handles CRUD operations with pagination, filtering, and search
/// &lt;/summary&gt;
public partial class ViewModel_Dunnage_AdminParts : ViewModel_Shared_Base
{
    private readonly IService_MySQL_Dunnage _dunnageService;
    private readonly IService_DunnageAdminWorkflow _adminWorkflow;
    private readonly IService_Pagination _paginationService;
    private readonly IService_Window _windowService;
    private readonly IService_Help _helpService;

    private List&lt;Model_DunnagePart&gt; _allParts = new();
    private const int PAGE_SIZE = 20;

    public ViewModel_Dunnage_AdminParts(
        IService_MySQL_Dunnage dunnageService,
        IService_DunnageAdminWorkflow adminWorkflow,
        IService_Pagination paginationService,
        IService_Window windowService,
        IService_Help helpService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger) : base(errorHandler, logger)
    {
        _dunnageService = dunnageService;
        _adminWorkflow = adminWorkflow;
        _paginationService = paginationService;
        _windowService = windowService;
        _helpService = helpService;

        // Configure pagination
        _paginationService.PageChanged += OnPageChanged;
    }

    #region Help Content Helpers

    /// &lt;summary&gt;
    /// Gets a tooltip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);

    #endregion

    #region Observable Properties

    [ObservableProperty]
    private ObservableCollection&lt;Model_DunnagePart&gt; _parts = new();

    [ObservableProperty]
    private ObservableCollection&lt;Model_DunnageType&gt; _availableTypes = new();

    [ObservableProperty]
    private Model_DunnagePart? _selectedPart;

    [ObservableProperty]
    private Model_DunnageType? _selectedFilterType;

    [ObservableProperty]
    private string _searchText = string.Empty;

    [ObservableProperty]
    private int _currentPage = 1;

    [ObservableProperty]
    private int _totalPages = 1;

    [ObservableProperty]
    private int _totalRecords = 0;

    [ObservableProperty]
    private bool _canEdit = false;

    [ObservableProperty]
    private bool _canDelete = false;

    [ObservableProperty]
    private bool _canNavigatePrevious = false;

    [ObservableProperty]
    private bool _canNavigateNext = false;

    #endregion

    #region Load Data

    /// &lt;summary&gt;
    /// Load all parts and types
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task LoadPartsAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading parts...&quot;;

            // Load types for filter dropdown
            var typesResult = await _dunnageService.GetAllTypesAsync();
            if (typesResult.Success &amp;&amp; typesResult.Data != null)
            {
                AvailableTypes.Clear();
                foreach (var type in typesResult.Data)
                {
                    AvailableTypes.Add(type);
                }
            }

            // Load all parts
            var partsResult = await _dunnageService.GetAllPartsAsync();

            if (!partsResult.Success)
            {
                await _errorHandler.HandleDaoErrorAsync(partsResult, &quot;LoadPartsAsync&quot;, true);
                return;
            }

            _allParts = partsResult.Data ?? new List&lt;Model_DunnagePart&gt;();
            TotalRecords = _allParts.Count;

            // Setup pagination
            _paginationService.SetSource(_allParts);
            TotalPages = _paginationService.TotalPages;
            CurrentPage = _paginationService.CurrentPage;

            // Load first page
            LoadPage();

            UpdateNavigationButtons();
            StatusMessage = $&quot;Loaded {TotalRecords} parts&quot;;
            await _logger.LogInfoAsync($&quot;Loaded {TotalRecords} dunnage parts&quot;, &quot;PartManagement&quot;);
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error loading parts&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    #endregion

    #region Filtering and Search

    /// &lt;summary&gt;
    /// Filter parts by selected type
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task FilterByTypeAsync()
    {
        if (SelectedFilterType == null)
        {
            await LoadPartsAsync();
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = $&quot;Filtering by {SelectedFilterType.DunnageType}...&quot;;

            var result = await _dunnageService.GetPartsByTypeAsync(SelectedFilterType.Id);

            if (!result.Success)
            {
                await _errorHandler.HandleDaoErrorAsync(result, &quot;FilterByTypeAsync&quot;, true);
                return;
            }

            _allParts = result.Data ?? new List&lt;Model_DunnagePart&gt;();
            TotalRecords = _allParts.Count;

            _paginationService.SetSource(_allParts);
            TotalPages = _paginationService.TotalPages;
            CurrentPage = _paginationService.CurrentPage;

            LoadPage();
            UpdateNavigationButtons();

            StatusMessage = $&quot;Filtered {TotalRecords} parts&quot;;
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error filtering parts&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Search parts by text
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task SearchPartsAsync()
    {
        if (string.IsNullOrWhiteSpace(SearchText))
        {
            await LoadPartsAsync();
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Searching...&quot;;

            var result = await _dunnageService.SearchPartsAsync(SearchText);

            if (!result.Success)
            {
                await _errorHandler.HandleDaoErrorAsync(result, &quot;SearchPartsAsync&quot;, true);
                return;
            }

            _allParts = result.Data ?? new List&lt;Model_DunnagePart&gt;();
            TotalRecords = _allParts.Count;

            _paginationService.SetSource(_allParts);
            TotalPages = _paginationService.TotalPages;
            CurrentPage = _paginationService.CurrentPage;

            LoadPage();
            UpdateNavigationButtons();

            StatusMessage = $&quot;Found {TotalRecords} parts&quot;;
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error searching parts&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Clear all filters
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task ClearFiltersAsync()
    {
        SelectedFilterType = null;
        SearchText = string.Empty;
        await LoadPartsAsync();
    }

    #endregion

    #region Pagination

    [RelayCommand]
    private void NextPage()
    {
        if (_paginationService.NextPage())
        {
            LoadPage();
        }
    }

    [RelayCommand]
    private void PreviousPage()
    {
        if (_paginationService.PreviousPage())
        {
            LoadPage();
        }
    }

    [RelayCommand]
    private void FirstPage()
    {
        if (_paginationService.FirstPage())
        {
            LoadPage();
        }
    }

    [RelayCommand]
    private void LastPage()
    {
        if (_paginationService.LastPage())
        {
            LoadPage();
        }
    }

    private void LoadPage()
    {
        var pageItems = _paginationService.GetCurrentPageItems&lt;Model_DunnagePart&gt;();

        Parts.Clear();
        foreach (var item in pageItems)
        {
            Parts.Add(item);
        }

        CurrentPage = _paginationService.CurrentPage;
        TotalPages = _paginationService.TotalPages;
        UpdateNavigationButtons();
    }

    private void OnPageChanged(object? sender, EventArgs e)
    {
        LoadPage();
    }

    private void UpdateNavigationButtons()
    {
        CanNavigatePrevious = _paginationService.HasPreviousPage;
        CanNavigateNext = _paginationService.HasNextPage;
    }

    #endregion

    #region Delete Part

    /// &lt;summary&gt;
    /// Show delete confirmation with transaction count
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task ShowDeleteConfirmationAsync()
    {
        if (SelectedPart == null)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Checking usage...&quot;;

            var countResult = await _dunnageService.GetTransactionCountByPartAsync(SelectedPart.PartId);

            if (!countResult.Success)
            {
                await _errorHandler.HandleDaoErrorAsync(countResult, &quot;GetTransactionCountByPartAsync&quot;, true);
                return;
            }

            int transactionCount = countResult.Data;
            IsBusy = false;

            string message = $&quot;Part ID: {SelectedPart.PartId}\n\n&quot;;
            message += $&quot;Transactions using this part: {transactionCount}\n\n&quot;;

            if (transactionCount &gt; 0)
            {
                message += &quot;WARNING: This part has transaction history and cannot be deleted.&quot;;

                var warningDialog = new ContentDialog
                {
                    Title = &quot;Cannot Delete Part&quot;,
                    Content = message,
                    CloseButtonText = &quot;OK&quot;,
                    XamlRoot = _windowService.GetXamlRoot()
                };

                await warningDialog.ShowAsync();
                return;
            }

            message += &quot;This part has no transaction history and can be deleted.\n\n&quot;;
            message += &quot;Are you sure you want to delete this part?&quot;;

            var confirmDialog = new ContentDialog
            {
                Title = &quot;Confirm Delete&quot;,
                Content = message,
                PrimaryButtonText = &quot;Delete&quot;,
                CloseButtonText = &quot;Cancel&quot;,
                DefaultButton = ContentDialogButton.Close,
                XamlRoot = _windowService.GetXamlRoot()
            };

            var result = await confirmDialog.ShowAsync();

            if (result == ContentDialogResult.Primary)
            {
                await DeletePartAsync();
            }
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error checking part usage&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    private async Task DeletePartAsync()
    {
        if (SelectedPart == null)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Deleting part...&quot;;

            var result = await _dunnageService.DeletePartAsync(SelectedPart.PartId);

            if (!result.Success)
            {
                await _errorHandler.HandleDaoErrorAsync(result, &quot;DeletePartAsync&quot;, true);
                return;
            }

            StatusMessage = &quot;Part deleted successfully&quot;;
            await _logger.LogInfoAsync($&quot;Deleted part: {SelectedPart.PartId}&quot;, &quot;PartManagement&quot;);

            // Reload parts
            await LoadPartsAsync();
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error deleting part&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    #endregion

    #region Navigation

    [RelayCommand]
    private async Task ReturnToAdminHubAsync()
    {
        try
        {
            await _adminWorkflow.NavigateToHubAsync();
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error navigating back&quot;,
                Enum_ErrorSeverity.Low,
                ex,
                false
            );
        }
    }

    #endregion

    #region Property Changed

    partial void OnSelectedPartChanged(Model_DunnagePart? value)
    {
        CanEdit = value != null;
        CanDelete = value != null;
    }

    #endregion
}</file><file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_DetailsEntryViewModel.cs">using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Text.Json;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Dunnage Details Entry
/// &lt;/summary&gt;
public partial class ViewModel_Dunnage_DetailsEntry : ViewModel_Shared_Base
{
    private readonly IService_DunnageWorkflow _workflowService;
    private readonly IService_Help _helpService;
    private readonly IService_MySQL_Dunnage _dunnageService;
    private readonly IService_Dispatcher _dispatcher;

    public ViewModel_Dunnage_DetailsEntry(
        IService_DunnageWorkflow workflowService,
        IService_MySQL_Dunnage dunnageService,
        IService_Dispatcher dispatcher,
        IService_Help helpService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger) : base(errorHandler, logger)
    {
        _workflowService = workflowService;
        _helpService = helpService;
        _dunnageService = dunnageService;
        _dispatcher = dispatcher;

        // Subscribe to workflow step changes to re-initialize when this step is reached
        _workflowService.StepChanged += OnWorkflowStepChanged;
    }

    private void OnWorkflowStepChanged(object? sender, EventArgs e)
    {
        if (_workflowService.CurrentStep == Enum_DunnageWorkflowStep.DetailsEntry)
        {
            _dispatcher.TryEnqueue(async () =&gt;
            {
                await LoadSpecsForSelectedPartAsync();
            });
        }
    }

    #region Observable Properties

    [ObservableProperty]
    private string _poNumber = string.Empty;

    [ObservableProperty]
    private string _location = string.Empty;

    [ObservableProperty]
    private ObservableCollection&lt;Model_SpecInput&gt; _specInputs = new();

    [ObservableProperty]
    private ObservableCollection&lt;Model_SpecInput&gt; _textSpecs = new();

    [ObservableProperty]
    private ObservableCollection&lt;Model_SpecInput&gt; _numberSpecs = new();

    [ObservableProperty]
    private ObservableCollection&lt;Model_SpecInput&gt; _booleanSpecs = new();

    [ObservableProperty]
    private bool _hasTextSpecs = false;

    [ObservableProperty]
    private bool _hasNumberSpecs = false;

    [ObservableProperty]
    private bool _hasBooleanSpecs = false;

    [ObservableProperty]
    private bool _isInventoryNotificationVisible = false;

    [ObservableProperty]
    private string _inventoryNotificationMessage = string.Empty;

    [ObservableProperty]
    private string _inventoryMethod = &quot;Adjust In&quot;;

    #endregion

    #region Initialization

    /// &lt;summary&gt;
    /// Load spec inputs for the selected part&apos;s type
    /// &lt;/summary&gt;
    public async Task LoadSpecsForSelectedPartAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading spec inputs...&quot;;

            var selectedTypeId = _workflowService.CurrentSession.SelectedTypeId;
            if (selectedTypeId &lt;= 0)
            {
                _logger.LogError(&quot;No type selected in workflow session&quot;, null, &quot;DetailsEntry&quot;);
                SpecInputs.Clear();
                return;
            }

            _logger.LogInfo($&quot;Loading specs for type ID: {selectedTypeId}&quot;, &quot;DetailsEntry&quot;);

            // Fetch specs from dunnage_specs table (NOT from SpecsJson field which doesn&apos;t exist)
            var specsResult = await _dunnageService.GetSpecsForTypeAsync(selectedTypeId);
            if (!specsResult.IsSuccess || specsResult.Data == null)
            {
                _logger.LogWarning($&quot;No specs found for type {selectedTypeId}: {specsResult.ErrorMessage}&quot;, &quot;DetailsEntry&quot;);
                SpecInputs.Clear();
                return;
            }

            var specs = specsResult.Data;
            _logger.LogInfo($&quot;Loaded {specs.Count} specs from database&quot;, &quot;DetailsEntry&quot;);

            // Get the selected part&apos;s spec values for defaults
            var selectedPart = _workflowService.CurrentSession.SelectedPart;
            Dictionary&lt;string, object&gt;? partSpecValues = null;
            if (selectedPart != null &amp;&amp; !string.IsNullOrWhiteSpace(selectedPart.SpecValues))
            {
                try
                {
                    partSpecValues = JsonSerializer.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(selectedPart.SpecValues);
                    _logger.LogInfo($&quot;Loaded spec values from part: {selectedPart.SpecValues}&quot;, &quot;DetailsEntry&quot;);
                }
                catch (Exception ex)
                {
                    _logger.LogError($&quot;Failed to parse part spec values: {ex.Message}&quot;, ex, &quot;DetailsEntry&quot;);
                }
            }

            // Create spec inputs from database specs
            SpecInputs.Clear();
            TextSpecs.Clear();
            NumberSpecs.Clear();
            BooleanSpecs.Clear();

            foreach (var spec in specs)
            {
                // Parse spec_value JSON to get type, unit, required
                var specValueDict = ParseSpecValue(spec.SpecValue);

                // Get default value from part if available
                string? defaultValue = null;
                if (partSpecValues?.ContainsKey(spec.SpecKey) == true)
                {
                    defaultValue = partSpecValues[spec.SpecKey]?.ToString();
                }

                var specType = specValueDict.ContainsKey(&quot;type&quot;) ? specValueDict[&quot;type&quot;]?.ToString()?.ToLowerInvariant() ?? &quot;text&quot; : &quot;text&quot;;

                // Convert default value to appropriate type
                object? typedValue = defaultValue;
                if (!string.IsNullOrWhiteSpace(defaultValue))
                {
                    try
                    {
                        if (specType == &quot;number&quot;)
                        {
                            typedValue = double.Parse(defaultValue);
                        }
                        else if (specType == &quot;boolean&quot;)
                        {
                            typedValue = bool.Parse(defaultValue);
                        }
                    }
                    catch (Exception ex)
                    {
                        _logger.LogWarning($&quot;Failed to convert value &apos;{defaultValue}&apos; to type &apos;{specType}&apos;: {ex.Message}&quot;, &quot;DetailsEntry&quot;);
                        typedValue = defaultValue; // Keep as string if conversion fails
                    }
                }

                var input = new Model_SpecInput
                {
                    SpecName = spec.SpecKey,
                    SpecType = specType,
                    Unit = specValueDict.ContainsKey(&quot;unit&quot;) ? specValueDict[&quot;unit&quot;]?.ToString() : null,
                    IsRequired = specValueDict.ContainsKey(&quot;required&quot;) &amp;&amp; bool.Parse(specValueDict[&quot;required&quot;]?.ToString() ?? &quot;false&quot;),
                    Value = typedValue
                };

                SpecInputs.Add(input);

                var typeFromDb = specValueDict.ContainsKey(&quot;type&quot;) ? specValueDict[&quot;type&quot;]?.ToString() ?? &quot;null&quot; : &quot;not found&quot;;
                _logger.LogInfo($&quot;Processing spec: {spec.SpecKey}, Type from DB: {typeFromDb}, Normalized: {specType}&quot;, &quot;DetailsEntry&quot;);

                // Add to type-specific collection
                if (specType == &quot;boolean&quot;)
                {
                    BooleanSpecs.Add(input);
                    _logger.LogInfo($&quot;Added {spec.SpecKey} to BooleanSpecs&quot;, &quot;DetailsEntry&quot;);
                }
                else if (specType == &quot;number&quot;)
                {
                    NumberSpecs.Add(input);
                    _logger.LogInfo($&quot;Added {spec.SpecKey} to NumberSpecs&quot;, &quot;DetailsEntry&quot;);
                }
                else
                {
                    TextSpecs.Add(input);
                    _logger.LogInfo($&quot;Added {spec.SpecKey} to TextSpecs&quot;, &quot;DetailsEntry&quot;);
                }
            }

            // Update visibility flags
            HasTextSpecs = TextSpecs.Count &gt; 0;
            HasNumberSpecs = NumberSpecs.Count &gt; 0;
            HasBooleanSpecs = BooleanSpecs.Count &gt; 0;

            _logger.LogInfo($&quot;Created {SpecInputs.Count} spec input controls (Text: {TextSpecs.Count}, Number: {NumberSpecs.Count}, Boolean: {BooleanSpecs.Count})&quot;, &quot;DetailsEntry&quot;);

            // Check if part is inventoried
            if (selectedPart != null)
            {
                var isInventoried = await _dunnageService.IsPartInventoriedAsync(selectedPart.PartId);
                if (isInventoried)
                {
                    IsInventoryNotificationVisible = true;
                    UpdateInventoryMessage();
                }
            }
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error loading specs&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    #endregion

    #region Spec Parsing Helpers

    private Dictionary&lt;string, object&gt; ParseSpecValue(string specValue)
    {
        try
        {
            if (string.IsNullOrWhiteSpace(specValue))
            {
                return new Dictionary&lt;string, object&gt;();
            }

            return JsonSerializer.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(specValue)
                ?? new Dictionary&lt;string, object&gt;();
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Failed to parse spec value JSON: {ex.Message}&quot;, ex, &quot;DetailsEntry&quot;);
            return new Dictionary&lt;string, object&gt;();
        }
    }

    #endregion

    #region Property Change Handlers

    partial void OnPoNumberChanged(string value)
    {
        if (string.IsNullOrWhiteSpace(value))
        {
            InventoryMethod = &quot;Adjust In&quot;;
        }
        else
        {
            InventoryMethod = &quot;Receive In&quot;;
        }

        UpdateInventoryMessage();
    }

    private void UpdateInventoryMessage()
    {
        if (IsInventoryNotificationVisible)
        {
            InventoryNotificationMessage = $&quot;This part requires inventory adjustment in Visual. Method: {InventoryMethod}&quot;;
        }
    }

    #endregion

    #region Validation

    private bool ValidateInputs()
    {
        // Check required specs
        foreach (var spec in SpecInputs.Where(s =&gt; s.IsRequired))
        {
            if (spec.Value == null || string.IsNullOrWhiteSpace(spec.Value.ToString()))
            {
                StatusMessage = $&quot;Required field missing: {spec.SpecName}&quot;;
                return false;
            }
        }

        return true;
    }

    #endregion

    #region Navigation Commands

    [RelayCommand]
    private void GoBack()
    {
        _logger.LogInfo(&quot;Navigating back to Quantity Entry&quot;, &quot;DetailsEntry&quot;);
        _workflowService.GoToStep(Enum_DunnageWorkflowStep.QuantityEntry);
    }

    [RelayCommand]
    private async Task GoNextAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Validating...&quot;;

            if (!ValidateInputs())
            {
                return;
            }

            // Set details in workflow session
            _workflowService.CurrentSession.PONumber = PoNumber;
            _workflowService.CurrentSession.Location = Location;

            // Convert spec inputs to dictionary
            var specValues = SpecInputs.ToDictionary(
                s =&gt; s.SpecName,
                s =&gt; s.Value ?? string.Empty
            );

            _workflowService.CurrentSession.SpecValues = specValues;

            _logger.LogInfo(&quot;Details saved, navigating to Review&quot;, &quot;DetailsEntry&quot;);

            // Navigate to Review
            _workflowService.GoToStep(Enum_DunnageWorkflowStep.Review);
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error saving details&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;\n    /// Shows contextual help for details entry\n    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;\n    [RelayCommand]\n    private async Task ShowHelpAsync()\n    {\n        await _helpService.ShowHelpAsync(\&quot;Dunnage.DetailsEntry\&quot;);\n    }

    #endregion

    #region Help Content Helpers

    /// &lt;summary&gt;
    /// Gets a tooltip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);

    /// &lt;summary&gt;
    /// Gets a placeholder by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);

    /// &lt;summary&gt;
    /// Gets a tip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTip(string key) =&gt; _helpService.GetTip(key);

    #endregion
}</file><file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_ManualEntryViewModel.cs">using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Dunnage Manual Entry mode
/// &lt;/summary&gt;
public partial class ViewModel_Dunnage_ManualEntry : ViewModel_Shared_Base
{
    private readonly IService_DunnageWorkflow _workflowService;
    private readonly IService_MySQL_Dunnage _dunnageService;
    private readonly IService_DunnageCSVWriter _csvWriter;
    private readonly IService_Window _windowService;
    private readonly IService_Help _helpService;

    public ViewModel_Dunnage_ManualEntry(
        IService_DunnageWorkflow workflowService,
        IService_MySQL_Dunnage dunnageService,
        IService_DunnageCSVWriter csvWriter,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger,
        IService_Window windowService,
        IService_Help helpService) : base(errorHandler, logger)
    {
        _workflowService = workflowService;
        _dunnageService = dunnageService;
        _csvWriter = csvWriter;
        _windowService = windowService;
        _helpService = helpService;
    }

    #region Observable Properties

    [ObservableProperty]
    private ObservableCollection&lt;Model_DunnageLoad&gt; _loads = new();

    [ObservableProperty]
    private Model_DunnageLoad? _selectedLoad;

    [ObservableProperty]
    private bool _canSave = false;

    [ObservableProperty]
    private ObservableCollection&lt;Model_DunnageType&gt; _availableTypes = new();

    [ObservableProperty]
    private ObservableCollection&lt;Model_DunnagePart&gt; _availableParts = new();

    [ObservableProperty]
    private List&lt;string&gt; _specColumnHeaders = new();

    #endregion

    #region Initialization

    public async Task InitializeAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading types and parts...&quot;;

            // Load available types
            var typesResult = await _dunnageService.GetAllTypesAsync();
            if (typesResult.Success &amp;&amp; typesResult.Data != null)
            {
                AvailableTypes.Clear();
                foreach (var type in typesResult.Data)
                {
                    AvailableTypes.Add(type);
                }
            }

            // Load available parts
            var partsResult = await _dunnageService.GetAllPartsAsync();
            if (partsResult.Success &amp;&amp; partsResult.Data != null)
            {
                AvailableParts.Clear();
                foreach (var part in partsResult.Data)
                {
                    AvailableParts.Add(part);
                }
            }

            // Load dynamic spec columns
            await LoadSpecColumnsAsync();

            // Add initial empty row
            AddRow();

            _logger.LogInfo(&quot;Manual Entry initialized&quot;, &quot;ManualEntry&quot;);
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error initializing manual entry&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    #endregion

    #region Row Management Commands

    [RelayCommand]
    private void AddRow()
    {
        var newLoad = new Model_DunnageLoad
        {
            Quantity = 1,
            CreatedDate = DateTime.Now,
            CreatedBy = Environment.UserName
        };

        Loads.Add(newLoad);
        SelectedLoad = newLoad;
        UpdateCanSave();

        _logger.LogInfo($&quot;Added new row, total: {Loads.Count}&quot;, &quot;ManualEntry&quot;);
    }

    [RelayCommand]
    private async Task AddMultipleRowsAsync()
    {
        try
        {
            var xamlRoot = _windowService.GetXamlRoot();
            if (xamlRoot == null)
            {
                _logger.LogError(&quot;Cannot show dialog: XamlRoot is null&quot;, null, &quot;ManualEntry&quot;);
                await _errorHandler.HandleErrorAsync(&quot;Unable to display dialog&quot;, Enum_ErrorSeverity.Error, null, true);
                return;
            }

            var dialog = new Module_Dunnage.Views.View_Dunnage_Dialog_AddMultipleRowsDialog
            {
                XamlRoot = xamlRoot
            };

            var result = await dialog.ShowAsync();
            if (result == Microsoft.UI.Xaml.Controls.ContentDialogResult.Primary)
            {
                int count = dialog.RowCount;

                for (int i = 0; i &lt; count; i++)
                {
                    var newLoad = new Model_DunnageLoad
                    {
                        Quantity = 1,
                        CreatedDate = DateTime.Now,
                        CreatedBy = Environment.UserName
                    };
                    Loads.Add(newLoad);
                }

                UpdateCanSave();
                StatusMessage = $&quot;Added {count} rows (Total: {Loads.Count})&quot;;
                _logger.LogInfo($&quot;Added {count} rows via dialog, total: {Loads.Count}&quot;, &quot;ManualEntry&quot;);
            }
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error adding multiple rows&quot;,
                Enum_ErrorSeverity.Warning,
                ex,
                true
            );
        }
    }

    [RelayCommand]
    private void RemoveRow()
    {
        if (SelectedLoad == null)
        {
            return;
        }

        Loads.Remove(SelectedLoad);
        SelectedLoad = Loads.LastOrDefault();
        UpdateCanSave();

        _logger.LogInfo($&quot;Removed row, total: {Loads.Count}&quot;, &quot;ManualEntry&quot;);
    }

    #endregion

    #region Utility Commands

    [RelayCommand]
    private void FillBlankSpaces()
    {
        if (Loads.Count &lt; 2)
        {
            return;
        }

        var lastLoad = Loads.LastOrDefault();
        if (lastLoad == null)
        {
            return;
        }

        foreach (var load in Loads)
        {
            // Copy PO Number
            if (string.IsNullOrWhiteSpace(load.PoNumber) &amp;&amp; !string.IsNullOrWhiteSpace(lastLoad.PoNumber))
            {
                load.PoNumber = lastLoad.PoNumber;
            }

            // Copy Location
            if (string.IsNullOrWhiteSpace(load.Location) &amp;&amp; !string.IsNullOrWhiteSpace(lastLoad.Location))
            {
                load.Location = lastLoad.Location;
            }

            // Copy specs if they exist
            if (load.SpecValues == null &amp;&amp; lastLoad.SpecValues != null)
            {
                load.SpecValues = new Dictionary&lt;string, object&gt;(lastLoad.SpecValues);
            }
        }

        StatusMessage = &quot;Filled blank spaces from last row&quot;;
        _logger.LogInfo(&quot;Fill blank spaces executed&quot;, &quot;ManualEntry&quot;);
    }

    [RelayCommand]
    private void SortForPrinting()
    {
        var sorted = Loads
            .OrderBy(l =&gt; l.PartId)
            .ThenBy(l =&gt; l.PoNumber)
            .ThenBy(l =&gt; l.TypeName)
            .ToList();

        Loads.Clear();
        foreach (var load in sorted)
        {
            Loads.Add(load);
        }

        StatusMessage = &quot;Sorted (Part ID  PO  Type)&quot;;
        _logger.LogInfo(&quot;Sort for printing executed&quot;, &quot;ManualEntry&quot;);
    }

    [RelayCommand]
    private async Task AutoFillAsync()
    {
        if (SelectedLoad == null)
        {
            StatusMessage = &quot;Please select a row first&quot;;
            return;
        }

        if (string.IsNullOrWhiteSpace(SelectedLoad.PartId))
        {
            StatusMessage = &quot;Please enter a Part ID first&quot;;
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Auto-filling from part master data...&quot;;

            // Get part by ID
            var partResult = await _dunnageService.GetPartByIdAsync(SelectedLoad.PartId);
            if (!partResult.Success || partResult.Data == null)
            {
                await _errorHandler.HandleErrorAsync(
                    $&quot;Part ID &apos;{SelectedLoad.PartId}&apos; not found in master data&quot;,
                    Enum_ErrorSeverity.Warning,
                    null,
                    true);
                StatusMessage = &quot;Part not found - please check Part ID&quot;;
                return;
            }

            var part = partResult.Data;

            // Auto-fill Type
            var type = AvailableTypes.FirstOrDefault(t =&gt; t.Id == part.TypeId);
            if (type != null)
            {
                SelectedLoad.TypeName = type.TypeName;
                SelectedLoad.DunnageType = type.TypeName;
            }

            // Auto-fill Spec Values from part master data
            if (part.SpecValuesDict?.Count &gt; 0)
            {
                SelectedLoad.SpecValues = new Dictionary&lt;string, object&gt;(part.SpecValuesDict);
                _logger.LogInfo($&quot;Auto-filled {part.SpecValuesDict.Count} spec values for Part ID: {SelectedLoad.PartId}&quot;, &quot;ManualEntry&quot;);
            }

            // Set default values
            if (SelectedLoad.Quantity &lt;= 0)
            {
                SelectedLoad.Quantity = 1;
            }

            if (string.IsNullOrWhiteSpace(SelectedLoad.InventoryMethod))
            {
                SelectedLoad.InventoryMethod = string.IsNullOrWhiteSpace(SelectedLoad.PoNumber) ? &quot;Adjust In&quot; : &quot;Receive In&quot;;
            }

            StatusMessage = $&quot;Auto-filled data for Part ID: {SelectedLoad.PartId}&quot;;
            _logger.LogInfo($&quot;Auto-fill completed for Part ID: {SelectedLoad.PartId}&quot;, &quot;ManualEntry&quot;);
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error during auto-fill&quot;,
                Enum_ErrorSeverity.Warning,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    #endregion

    #region Save Commands

    [RelayCommand]
    private async Task SaveToHistoryAsync()
    {
        if (Loads.Count == 0)
        {
            return;
        }

        try
        {
            IsBusy = true;
            CanSave = false;
            StatusMessage = &quot;Saving to history...&quot;;

            // Use same save method - history is just another save
            var result = await _dunnageService.SaveLoadsAsync(Loads.ToList());

            if (result.Success)
            {
                StatusMessage = $&quot;Saved {Loads.Count} loads to history&quot;;
                _logger.LogInfo($&quot;Saved {Loads.Count} loads to history&quot;, &quot;ManualEntry&quot;);
            }
            else
            {
                await _errorHandler.HandleDaoErrorAsync(result, &quot;SaveToHistoryAsync&quot;, true);
            }
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error saving to history&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
            CanSave = true;
        }
    }

    [RelayCommand]
    private async Task SaveAllAsync()
    {
        if (Loads.Count == 0)
        {
            return;
        }

        try
        {
            IsBusy = true;
            CanSave = false;
            StatusMessage = &quot;Saving loads...&quot;;

            // Validate all loads
            foreach (var load in Loads)
            {
                if (string.IsNullOrWhiteSpace(load.TypeName) || string.IsNullOrWhiteSpace(load.PartId))
                {
                    StatusMessage = &quot;All loads must have Type and Part ID&quot;;
                    return;
                }
            }

            // Save to database
            var saveResult = await _dunnageService.SaveLoadsAsync(Loads.ToList());

            if (!saveResult.Success)
            {
                await _errorHandler.HandleDaoErrorAsync(saveResult, &quot;SaveAllAsync&quot;, true);
                return;
            }

            // Export to CSV
            var csvResult = await _csvWriter.WriteToCSVAsync(Loads.ToList());

            if (!csvResult.LocalSuccess)
            {
                await _errorHandler.HandleErrorAsync(
                    csvResult.ErrorMessage ?? &quot;CSV export failed&quot;,
                    Enum_ErrorSeverity.Warning,
                    null,
                    true);
            }

            StatusMessage = $&quot;Successfully saved {Loads.Count} loads&quot;;
            _logger.LogInfo($&quot;Saved {Loads.Count} loads&quot;, &quot;ManualEntry&quot;);

            // Clear loads
            Loads.Clear();
            AddRow(); // Add new empty row
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error saving loads&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
            CanSave = true;
        }
    }

    /// &lt;summary&gt;\n    /// Shows contextual help for manual entry\n    /// &lt;/summary&gt;\n    [RelayCommand]\n    private async Task ShowHelpAsync()\n    {\n        await _helpService.ShowHelpAsync(\&quot;Dunnage.ManualEntry\&quot;);\n    }

    #endregion

    #region Navigation Commands

    [RelayCommand]
    private async Task ReturnToModeSelectionAsync()
    {
        var xamlRoot = _windowService.GetXamlRoot();
        if (xamlRoot == null)
        {
            _logger.LogError(&quot;Cannot show dialog: XamlRoot is null&quot;, null, &quot;ManualEntry&quot;);
            await _errorHandler.HandleErrorAsync(&quot;Unable to display dialog&quot;, Enum_ErrorSeverity.Error, null, true);
            return;
        }

        var dialog = new Microsoft.UI.Xaml.Controls.ContentDialog
        {
            Title = &quot;Change Mode?&quot;,
            Content = &quot;Returning to mode selection will clear all current work in progress. This cannot be undone. Are you sure?&quot;,
            PrimaryButtonText = &quot;Yes, Change Mode&quot;,
            CloseButtonText = &quot;Cancel&quot;,
            DefaultButton = Microsoft.UI.Xaml.Controls.ContentDialogButton.Close,
            XamlRoot = xamlRoot
        };

        var result = await dialog.ShowAsync().AsTask();
        if (result == Microsoft.UI.Xaml.Controls.ContentDialogResult.Primary)
        {
            try
            {
                _logger.LogInfo(&quot;User confirmed return to mode selection, clearing loads&quot;, &quot;ManualEntry&quot;);
                Loads.Clear();
                _workflowService.ClearSession();
                _workflowService.GoToStep(Enum_DunnageWorkflowStep.ModeSelection);
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Failed to return to mode selection: {ex.Message}&quot;, ex, &quot;ManualEntry&quot;);
                await _errorHandler.HandleErrorAsync(&quot;Failed to return to mode selection&quot;, Enum_ErrorSeverity.Error, ex, true);
            }
        }
        else
        {
            _logger.LogInfo(&quot;User cancelled return to mode selection&quot;, &quot;ManualEntry&quot;);
        }
    }

    #endregion

    #region Helper Methods

    private async Task LoadSpecColumnsAsync()
    {
        try
        {
            var specKeys = await _dunnageService.GetAllSpecKeysAsync();
            SpecColumnHeaders = specKeys;
            _logger.LogInfo($&quot;Loaded {SpecColumnHeaders.Count} dynamic spec columns&quot;, &quot;ManualEntry&quot;);
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Failed to load spec columns: {ex.Message}&quot;, ex, &quot;ManualEntry&quot;);
        }
    }

    /// &lt;summary&gt;
    /// Handles PartID change to trigger auto-fill
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;load&quot;&gt;&lt;/param&gt;
    public async Task OnPartIdChangedAsync(Model_DunnageLoad load)
    {
        if (load == null || string.IsNullOrWhiteSpace(load.PartId))
        {
            return;
        }

        try
        {
            // Auto-populate type and specs when PartID is entered
            var partResult = await _dunnageService.GetPartByIdAsync(load.PartId);
            if (partResult.Success &amp;&amp; partResult.Data != null)
            {
                var part = partResult.Data;
                var type = AvailableTypes.FirstOrDefault(t =&gt; t.Id == part.TypeId);
                if (type != null)
                {
                    load.TypeName = type.TypeName;
                    load.DunnageType = type.TypeName;
                }

                // Auto-fill specs from part master
                if (part.SpecValuesDict?.Count &gt; 0)
                {
                    load.SpecValues = new Dictionary&lt;string, object&gt;(part.SpecValuesDict);
                }

                _logger.LogInfo($&quot;Auto-populated data for Part ID: {load.PartId}&quot;, &quot;ManualEntry&quot;);
            }
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error auto-populating part data: {ex.Message}&quot;, ex, &quot;ManualEntry&quot;);
        }
    }

    private void UpdateCanSave()
    {
        CanSave = Loads.Any(l =&gt; !string.IsNullOrWhiteSpace(l.TypeName) || !string.IsNullOrWhiteSpace(l.PartId));
    }

    #endregion

    #region Help Content Helpers

    /// &lt;summary&gt;
    /// Gets a tooltip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);

    /// &lt;summary&gt;
    /// Gets a placeholder by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);

    /// &lt;summary&gt;
    /// Gets a tip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTip(string key) =&gt; _helpService.GetTip(key);

    #endregion
}</file><file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_PartSelectionViewModel.cs">using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Material.Icons;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Dunnage Part Selection with inventory notification
/// &lt;/summary&gt;
public partial class ViewModel_Dunnage_PartSelection : ViewModel_Shared_Base
{
    private readonly IService_DunnageWorkflow _workflowService;
    private readonly IService_MySQL_Dunnage _dunnageService; private readonly IService_Help _helpService; private readonly IService_Dispatcher _dispatcher;

    public ViewModel_Dunnage_PartSelection(
        IService_DunnageWorkflow workflowService,
        IService_MySQL_Dunnage dunnageService,
        IService_Dispatcher dispatcher,
        IService_Help helpService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger) : base(errorHandler, logger)
    {
        _workflowService = workflowService;
        _dunnageService = dunnageService;
        _dispatcher = dispatcher;
        _helpService = helpService;

        // Subscribe to workflow step changes to re-initialize when this step is reached
        _workflowService.StepChanged += OnWorkflowStepChanged;
        _logger.LogInfo(&quot;PartSelection: ViewModel constructed and subscribed to StepChanged&quot;, &quot;PartSelection&quot;);
    }

    private void OnWorkflowStepChanged(object? sender, EventArgs e)
    {
        _logger.LogInfo($&quot;PartSelection: Workflow step changed to {_workflowService.CurrentStep}&quot;, &quot;PartSelection&quot;);
        if (_workflowService.CurrentStep == Enum_DunnageWorkflowStep.PartSelection)
        {
            _logger.LogInfo(&quot;PartSelection: Step is PartSelection, calling InitializeAsync via dispatcher&quot;, &quot;PartSelection&quot;);
            _dispatcher.TryEnqueue(async () =&gt;
            {
                await InitializeAsync();
            });
        }
    }

    #region Observable Properties

    [ObservableProperty]
    private ObservableCollection&lt;Model_DunnagePart&gt; _availableParts = new();

    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(IsPartSelected))]
    private Model_DunnagePart? _selectedPart;

    [ObservableProperty]
    private bool _isInventoryNotificationVisible;

    [ObservableProperty]
    private string _inventoryNotificationMessage = string.Empty;

    [ObservableProperty]
    private string _inventoryMethod = &quot;Adjust In&quot;;

    [ObservableProperty]
    private string _selectedTypeName = string.Empty;

    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(SelectedTypeIconKind))]
    private string _selectedTypeIcon = &quot;Help&quot;;

    /// &lt;summary&gt;
    /// Gets the MaterialIconKind for the selected type
    /// &lt;/summary&gt;
    public MaterialIconKind SelectedTypeIconKind
    {
        get
        {
            if (!string.IsNullOrEmpty(SelectedTypeIcon) &amp;&amp; Enum.TryParse&lt;MaterialIconKind&gt;(SelectedTypeIcon, true, out var kind))
            {
                return kind;
            }
            return MaterialIconKind.PackageVariantClosed;
        }
    }

    [ObservableProperty]
    private int _selectedTypeId;

    /// &lt;summary&gt;
    /// Helper property for UI binding
    /// &lt;/summary&gt;
    public bool IsPartSelected =&gt; SelectedPart != null;

    #endregion

    #region Initialization

    /// &lt;summary&gt;
    /// Initialize and load parts for selected type
    /// &lt;/summary&gt;
    public async Task InitializeAsync()
    {
        _logger.LogInfo(&quot;PartSelection: InitializeAsync called&quot;, &quot;PartSelection&quot;);
        if (IsBusy)
        {
            _logger.LogInfo(&quot;PartSelection: InitializeAsync returning because IsBusy is true&quot;, &quot;PartSelection&quot;);
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading parts...&quot;;

            // Get selected type from workflow
            SelectedTypeId = _workflowService.CurrentSession.SelectedTypeId;
            SelectedTypeName = _workflowService.CurrentSession.SelectedTypeName ?? string.Empty;
            SelectedTypeIcon = _workflowService.CurrentSession.SelectedType?.Icon ?? &quot;Help&quot;;

            _logger.LogInfo($&quot;PartSelection: SelectedTypeId={SelectedTypeId}, SelectedTypeName={SelectedTypeName}, SelectedTypeIcon={SelectedTypeIcon}&quot;, &quot;PartSelection&quot;);

            await LoadPartsAsync();

            StatusMessage = $&quot;Loaded {AvailableParts.Count} parts for {SelectedTypeName}&quot;;
            _logger.LogInfo($&quot;PartSelection: {StatusMessage}&quot;, &quot;PartSelection&quot;);
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;PartSelection: Failed to initialize: {ex.Message}&quot;, ex, &quot;PartSelection&quot;);
            await _errorHandler.HandleErrorAsync(
                &quot;Failed to initialize part selection&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
            StatusMessage = &quot;Error loading parts&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }

    #endregion

    #region Load Parts Command

    [RelayCommand]
    private async Task LoadPartsAsync()
    {
        _logger.LogInfo($&quot;PartSelection: LoadPartsAsync called with SelectedTypeId={SelectedTypeId}&quot;, &quot;PartSelection&quot;);
        if (SelectedTypeId == 0)
        {
            _logger.LogInfo(&quot;PartSelection: SelectedTypeId is 0, returning from LoadPartsAsync&quot;, &quot;PartSelection&quot;);
            return;
        }

        try
        {
            IsBusy = true;

            _logger.LogInfo($&quot;PartSelection: Calling _dunnageService.GetPartsByTypeAsync({SelectedTypeId})&quot;, &quot;PartSelection&quot;);
            var result = await _dunnageService.GetPartsByTypeAsync(SelectedTypeId);

            if (result.IsSuccess &amp;&amp; result.Data != null)
            {
                AvailableParts.Clear();
                foreach (var part in result.Data)
                {
                    AvailableParts.Add(part);
                }

                _logger.LogInfo($&quot;PartSelection: Successfully loaded {AvailableParts.Count} parts&quot;, &quot;PartSelection&quot;);
            }
            else
            {
                _logger.LogWarning($&quot;PartSelection: Failed to load parts: {result.ErrorMessage}&quot;, &quot;PartSelection&quot;);
                await _errorHandler.HandleDaoErrorAsync(
                    result,
                    nameof(LoadPartsAsync),
                    true
                );
            }
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;PartSelection: Error in LoadPartsAsync: {ex.Message}&quot;, ex, &quot;PartSelection&quot;);
            await _errorHandler.HandleErrorAsync(
                &quot;Error loading parts&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    #endregion

    #region Part Selection

    partial void OnSelectedPartChanged(Model_DunnagePart? oldValue, Model_DunnagePart? newValue)
    {
        if (newValue != null)
        {
            _logger.LogInfo($&quot;Part selected via ComboBox: {newValue.PartId}&quot;, &quot;PartSelection&quot;);

            // Update workflow session immediately when part is selected
            _workflowService.CurrentSession.SelectedPart = newValue;
            _logger.LogInfo($&quot;Updated workflow session with selected part: {newValue.PartId}&quot;, &quot;PartSelection&quot;);

            _ = CheckInventoryStatusAsync(newValue);
        }
        else
        {
            _workflowService.CurrentSession.SelectedPart = null;
            IsInventoryNotificationVisible = false;
        }

        // Notify that command can execute state changed
        SelectPartCommand.NotifyCanExecuteChanged();
    }

    private async Task CheckInventoryStatusAsync(Model_DunnagePart part)
    {
        try
        {
            var isInventoried = await _dunnageService.IsPartInventoriedAsync(part.PartId);

            if (isInventoried)
            {
                // Part is inventoried - show notification
                IsInventoryNotificationVisible = true;
                InventoryMethod = &quot;Adjust In&quot;; // No PO context yet
                UpdateInventoryMessage();

                _logger.LogInfo($&quot;Part {part.PartId} is inventoried - showing notification&quot;, &quot;PartSelection&quot;);
            }
            else
            {
                IsInventoryNotificationVisible = false;
            }
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error checking inventory status: {ex.Message}&quot;, ex, &quot;PartSelection&quot;);
            // Don&apos;t show error to user - just hide notification
            IsInventoryNotificationVisible = false;
        }
    }

    private void UpdateInventoryMessage()
    {
        InventoryNotificationMessage = $&quot;This part requires inventory in Visual. Method: {InventoryMethod}&quot;;
    }

    #endregion

    #region Navigation Commands

    [RelayCommand]
    private void GoBack()
    {
        _logger.LogInfo(&quot;Returning to Type Selection&quot;, &quot;PartSelection&quot;);
        _workflowService.GoToStep(Enum_DunnageWorkflowStep.TypeSelection);
    }

    [RelayCommand(CanExecute = nameof(IsPartSelected))]
    private async Task SelectPartAsync()
    {
        if (SelectedPart == null || IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;

            // Set selected part in workflow
            _workflowService.CurrentSession.SelectedPart = SelectedPart;

            _logger.LogInfo($&quot;Selected part: {SelectedPart.PartId}&quot;, &quot;PartSelection&quot;);

            // Navigate to quantity entry
            _workflowService.GoToStep(Enum_DunnageWorkflowStep.QuantityEntry);
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error selecting part&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    [RelayCommand]
    private async Task QuickAddPartAsync()
    {
        try
        {
            _logger.LogInfo($&quot;Quick Add Part requested for type {SelectedTypeName}&quot;, &quot;PartSelection&quot;);

            // Fetch specs for the selected type
            var specsResult = await _dunnageService.GetSpecsForTypeAsync(SelectedTypeId);
            var specs = (specsResult.IsSuccess &amp;&amp; specsResult.Data != null)
                ? specsResult.Data
                : new List&lt;Model_DunnageSpec&gt;();

            // Show dialog with type pre-selected and specs
            var dialog = new Module_Dunnage.Views.View_Dunnage_QuickAddPartDialog(SelectedTypeId, SelectedTypeName, specs)
            {
                XamlRoot = App.MainWindow?.Content?.XamlRoot
            };

            if (dialog.XamlRoot == null)
            {
                _logger.LogInfo(&quot;Cannot show dialog: XamlRoot is null&quot;, &quot;PartSelection&quot;);
                return;
            }

            var result = await dialog.ShowAsync();

            if (result == Microsoft.UI.Xaml.Controls.ContentDialogResult.Primary)
            {
                var partId = dialog.PartId;
                var specValuesJson = dialog.SpecValuesJson;

                _logger.LogInfo($&quot;Adding new part: {partId} for type {SelectedTypeName}&quot;, &quot;PartSelection&quot;);

                // Create new part model
                var newPart = new Model_DunnagePart
                {
                    PartId = partId,
                    TypeId = SelectedTypeId,
                    SpecValues = specValuesJson,
                    DunnageTypeName = SelectedTypeName
                };

                // Insert new part
                var insertResult = await _dunnageService.InsertPartAsync(newPart);

                if (insertResult.IsSuccess)
                {
                    _logger.LogInfo($&quot;Successfully added part: {partId}&quot;, &quot;PartSelection&quot;);

                    // Reload parts to show new part
                    await LoadPartsAsync();

                    // Auto-select the new part
                    var addedPart = AvailableParts.FirstOrDefault(p =&gt; p.PartId == partId);
                    if (addedPart != null)
                    {
                        SelectedPart = addedPart;
                    }

                    StatusMessage = $&quot;Added new part: {partId}&quot;;
                }
                else
                {
                    await _errorHandler.HandleDaoErrorAsync(
                        insertResult,
                        nameof(QuickAddPartAsync),
                        true
                    );
                }
            }
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error adding new dunnage part&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
    }

    /// &lt;summary&gt;\n    /// Shows contextual help for part selection\n    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;\n    [RelayCommand]\n    private async Task ShowHelpAsync()\n    {\n        await _helpService.ShowHelpAsync(\&quot;Dunnage.PartSelection\&quot;);\n    }

    #endregion

    #region Help Content Helpers

    /// &lt;summary&gt;
    /// Gets a tooltip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);

    /// &lt;summary&gt;
    /// Gets a placeholder by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);

    /// &lt;summary&gt;
    /// Gets a tip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTip(string key) =&gt; _helpService.GetTip(key);

    #endregion
}</file><file path="Module_Dunnage/Views/View_Dunnage_AdminInventoryView.xaml.cs">using Microsoft.UI.Xaml.Controls;
using Microsoft.UI.Xaml.Navigation;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.Views;

public sealed partial class View_Dunnage_AdminInventoryView : Page
{
    public ViewModel_Dunnage_AdminInventory ViewModel { get; }
    private readonly IService_Focus _focusService;

    public View_Dunnage_AdminInventoryView()
    {
        ViewModel = App.GetService&lt;ViewModel_Dunnage_AdminInventory&gt;();
        _focusService = App.GetService&lt;IService_Focus&gt;();
        InitializeComponent();

        _focusService.AttachFocusOnVisibility(this);
    }

    protected override async void OnNavigatedTo(NavigationEventArgs e)
    {
        base.OnNavigatedTo(e);
        App.GetService&lt;IService_LoggingUtility&gt;().LogInfo(&quot;Admin Inventory View loaded&quot;, &quot;AdminInventoryView&quot;);
        await ViewModel.InitializeAsync();
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_AdminTypesView.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.Views;

public sealed partial class View_Dunnage_AdminTypesView : Page
{
    public ViewModel_Dunnage_AdminTypes ViewModel { get; }
    private readonly IService_Focus _focusService;

    public View_Dunnage_AdminTypesView()
    {
        ViewModel = App.GetService&lt;ViewModel_Dunnage_AdminTypes&gt;();
        _focusService = App.GetService&lt;IService_Focus&gt;();
        InitializeComponent();

        _focusService.AttachFocusOnVisibility(this);
    }

    private async void OnPageLoaded(object sender, RoutedEventArgs e)
    {
        App.GetService&lt;IService_LoggingUtility&gt;().LogInfo(&quot;Admin Types View loaded&quot;, &quot;AdminTypesView&quot;);
        await ViewModel.LoadTypesCommand.ExecuteAsync(null);
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_Control_IconPickerControl.xaml.cs">using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using Material.Icons;
using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Core.Helpers.UI;

namespace MTM_Receiving_Application.Module_Dunnage.Views;

public sealed partial class View_Dunnage_Control_IconPickerControl : UserControl
{
    public static readonly DependencyProperty SelectedIconProperty =
        DependencyProperty.Register(
            nameof(SelectedIcon),
            typeof(MaterialIconKind?),
            typeof(View_Dunnage_Control_IconPickerControl),
            new PropertyMetadata(MaterialIconKind.PackageVariantClosed, OnSelectedIconChanged));

    public static readonly DependencyProperty RecentlyUsedIconsProperty =
        DependencyProperty.Register(
            nameof(RecentlyUsedIcons),
            typeof(ObservableCollection&lt;Model_IconDefinition&gt;),
            typeof(View_Dunnage_Control_IconPickerControl),
            new PropertyMetadata(default(ObservableCollection&lt;Model_IconDefinition&gt;)));

    public MaterialIconKind? SelectedIcon
    {
        get =&gt; (MaterialIconKind?)GetValue(SelectedIconProperty);
        set =&gt; SetValue(SelectedIconProperty, value);
    }

    public ObservableCollection&lt;Model_IconDefinition&gt; RecentlyUsedIcons
    {
        get =&gt; (ObservableCollection&lt;Model_IconDefinition&gt;)GetValue(RecentlyUsedIconsProperty);
        set =&gt; SetValue(RecentlyUsedIconsProperty, value);
    }

    private readonly List&lt;MaterialIconKind&gt; _allIcons;
    private readonly ObservableCollection&lt;MaterialIconKind&gt; _filteredIcons;

    public View_Dunnage_Control_IconPickerControl()
    {
        InitializeComponent();

        // Load all icons
        _allIcons = Helper_MaterialIcons.GetAllIcons();
        _filteredIcons = new ObservableCollection&lt;MaterialIconKind&gt;(_allIcons.Take(200)); // Initial limit for performance

        AllIconsGrid.ItemsSource = _filteredIcons;
    }

    private static void OnSelectedIconChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        if (d is View_Dunnage_Control_IconPickerControl control &amp;&amp; e.NewValue is MaterialIconKind kind)
        {
            // Update RecentIconsGrid selection if the icon is in the list
            if (control.RecentlyUsedIcons != null)
            {
                var recent = control.RecentlyUsedIcons.FirstOrDefault(x =&gt; x.Kind == kind);
                if (recent != null)
                {
                    control.RecentIconsGrid.SelectedItem = recent;
                }
                else
                {
                    control.RecentIconsGrid.SelectedItem = null;
                }
            }
        }
    }

    private void OnRecentIconSelectionChanged(object sender, SelectionChangedEventArgs e)
    {
        if (RecentIconsGrid.SelectedItem is Model_IconDefinition selectedModel)
        {
            SelectedIcon = selectedModel.Kind;
        }
    }

    private void OnSearchTextChanged(object sender, TextChangedEventArgs e)
    {
        var searchText = SearchBox.Text;

        _filteredIcons.Clear();

        var matches = Helper_MaterialIcons.SearchIcons(searchText).Take(200);
        foreach (var icon in matches)
        {
            _filteredIcons.Add(icon);
        }
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_QuickAddPartDialog.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.Json;
using MTM_Receiving_Application.Module_Dunnage.Models;

namespace MTM_Receiving_Application.Module_Dunnage.Views;

public sealed partial class View_Dunnage_QuickAddPartDialog : ContentDialog
{
    public string PartId { get; private set; } = string.Empty;
    public int TypeId { get; private set; }
    public string TypeName { get; private set; } = string.Empty;
    public string SpecValuesJson { get; private set; } = string.Empty;

    private readonly List&lt;Model_DunnageSpec&gt; _specs;
    private readonly Dictionary&lt;string, Control&gt; _specInputs = new();

    public View_Dunnage_QuickAddPartDialog(int typeId, string typeName, List&lt;Model_DunnageSpec&gt; specs)
    {
        InitializeComponent();

        TypeId = typeId;
        TypeName = typeName;
        TypeNameTextBlock.Text = typeName;
        _specs = specs;

        GenerateSpecFields();
        UpdatePartId();
    }

    private void GenerateSpecFields()
    {
        if (_specs == null || _specs.Count == 0)
        {
            return;
        }

        foreach (var spec in _specs)
        {
            // Skip dimensions as they are handled by the static fields
            if (string.Equals(spec.SpecKey, &quot;Width&quot;, System.StringComparison.OrdinalIgnoreCase) ||
                string.Equals(spec.SpecKey, &quot;Height&quot;, System.StringComparison.OrdinalIgnoreCase) ||
                string.Equals(spec.SpecKey, &quot;Depth&quot;, System.StringComparison.OrdinalIgnoreCase))
            {
                continue;
            }

            SpecDefinition? def = null;
            try
            {
                def = JsonSerializer.Deserialize&lt;SpecDefinition&gt;(spec.SpecValue);
            }
            catch
            {
                // Intentionally empty - fallback to null
            }

            if (def == null)
            {
                def = new SpecDefinition { DataType = &quot;Text&quot; }; // Fallback
            }

            var stackPanel = new StackPanel { Spacing = 4 };

            var labelText = spec.SpecKey;
            if (def.Required)
            {
                labelText += &quot; *&quot;;
            }

            if (!string.IsNullOrEmpty(def.Unit))
            {
                labelText += $&quot; ({def.Unit})&quot;;
            }

            var label = new TextBlock
            {
                Text = labelText,
                Style = (Style?)Application.Current.Resources[&quot;CaptionTextBlockStyle&quot;]
            };
            stackPanel.Children.Add(label);

            Control? inputControl = null;

            if (string.Equals(def.DataType, &quot;Number&quot;, System.StringComparison.OrdinalIgnoreCase))
            {
                var numberBox = new NumberBox
                {
                    PlaceholderText = &quot;0&quot;,
                    SpinButtonPlacementMode = NumberBoxSpinButtonPlacementMode.Compact
                };
                if (def.MinValue.HasValue)
                {
                    numberBox.Minimum = def.MinValue.Value;
                }

                if (def.MaxValue.HasValue)
                {
                    numberBox.Maximum = def.MaxValue.Value;
                }

                numberBox.ValueChanged += (s, e) =&gt; UpdatePartId();
                inputControl = numberBox;
            }
            else if (string.Equals(def.DataType, &quot;Boolean&quot;, System.StringComparison.OrdinalIgnoreCase))
            {
                var checkBox = new CheckBox
                {
                    Content = &quot;Yes&quot;
                };
                checkBox.Checked += (s, e) =&gt; UpdatePartId();
                checkBox.Unchecked += (s, e) =&gt; UpdatePartId();
                inputControl = checkBox;
            }
            else // Text
            {
                var textBox = new TextBox
                {
                    PlaceholderText = $&quot;Enter {spec.SpecKey.ToLower()}&quot;,
                    MaxLength = 100
                };
                textBox.TextChanged += (s, e) =&gt; UpdatePartId();
                inputControl = textBox;
            }

            stackPanel.Children.Add(inputControl);
            DynamicSpecsPanel.Children.Add(stackPanel);
            _specInputs[spec.SpecKey] = inputControl;
        }
    }

    private void OnDimensionChanged(NumberBox sender, NumberBoxValueChangedEventArgs args)
    {
        UpdatePartId();
    }

    private void UpdatePartId()
    {
        var parts = new List&lt;string&gt;();

        // 1. Type name
        parts.Add(TypeName);

        // 2. Text specs (if any)
        var textSpecs = new List&lt;string&gt;();
        foreach (var kvp in _specInputs)
        {
            if (kvp.Value is TextBox tb &amp;&amp; !string.IsNullOrWhiteSpace(tb.Text))
            {
                textSpecs.Add(tb.Text.Trim());
            }
        }

        // 3. Number specs in parentheses with x separator
        var numbers = new List&lt;double&gt;();
        if (!double.IsNaN(WidthNumberBox.Value) &amp;&amp; WidthNumberBox.Value &gt; 0)
        {
            numbers.Add(WidthNumberBox.Value);
        }

        if (!double.IsNaN(HeightNumberBox.Value) &amp;&amp; HeightNumberBox.Value &gt; 0)
        {
            numbers.Add(HeightNumberBox.Value);
        }

        if (!double.IsNaN(DepthNumberBox.Value) &amp;&amp; DepthNumberBox.Value &gt; 0)
        {
            numbers.Add(DepthNumberBox.Value);
        }

        // Add other number specs from dynamic inputs
        foreach (var kvp in _specInputs)
        {
            if (kvp.Value is NumberBox nb &amp;&amp; !double.IsNaN(nb.Value) &amp;&amp; nb.Value &gt; 0)
            {
                numbers.Add(nb.Value);
            }
        }

        if (numbers.Count &gt; 0)
        {
            // Format numbers: remove decimals if whole numbers
            var formattedNumbers = numbers.Select(n =&gt;
                n == Math.Floor(n) ? ((int)n).ToString() : n.ToString(&quot;0.##&quot;)
            );
            parts.Add($&quot;({string.Join(&quot;x&quot;, formattedNumbers)})&quot;);
        }

        // 4. Boolean specs (only if true, abbreviated if &gt;2 words)
        var boolSpecs = new List&lt;string&gt;();
        foreach (var kvp in _specInputs)
        {
            if (kvp.Value is CheckBox cb &amp;&amp; cb.IsChecked == true)
            {
                var specName = kvp.Key;
                var words = specName.Split(new[] { &apos; &apos;, &apos;_&apos; }, System.StringSplitOptions.RemoveEmptyEntries);

                if (words.Length &gt; 2)
                {
                    // Abbreviate: use first letter of each word
                    boolSpecs.Add(string.Join(&quot;&quot;, words.Select(w =&gt; char.ToUpper(w[0]))));
                }
                else
                {
                    // Use full name
                    boolSpecs.Add(specName);
                }
            }
        }

        if (boolSpecs.Count &gt; 0)
        {
            parts.Add(string.Join(&quot;, &quot;, boolSpecs));
        }

        // Add text specs if any
        if (textSpecs.Count &gt; 0)
        {
            // Insert text specs after type name
            parts.Insert(1, string.Join(&quot;, &quot;, textSpecs));
        }

        PartIdTextBox.Text = string.Join(&quot; - &quot;, parts);
    }

    private void OnPrimaryButtonClick(ContentDialog sender, ContentDialogButtonClickEventArgs args)
    {
        // Set Part ID
        PartId = PartIdTextBox.Text.Trim();

        // Build spec values dictionary
        var specValues = new Dictionary&lt;string, object&gt;();

        // Add dynamic specs
        foreach (var kvp in _specInputs)
        {
            if (kvp.Value is TextBox tb &amp;&amp; !string.IsNullOrWhiteSpace(tb.Text))
            {
                specValues[kvp.Key] = tb.Text.Trim();
            }
            else if (kvp.Value is NumberBox nb &amp;&amp; !double.IsNaN(nb.Value))
            {
                specValues[kvp.Key] = nb.Value;
            }
            else if (kvp.Value is CheckBox cb)
            {
                specValues[kvp.Key] = cb.IsChecked ?? false;
            }
        }

        // Add dimensions if provided
        if (!double.IsNaN(WidthNumberBox.Value) &amp;&amp; WidthNumberBox.Value &gt; 0)
        {
            specValues[&quot;Width&quot;] = WidthNumberBox.Value;
        }

        if (!double.IsNaN(HeightNumberBox.Value) &amp;&amp; HeightNumberBox.Value &gt; 0)
        {
            specValues[&quot;Height&quot;] = HeightNumberBox.Value;
        }

        if (!double.IsNaN(DepthNumberBox.Value) &amp;&amp; DepthNumberBox.Value &gt; 0)
        {
            specValues[&quot;Depth&quot;] = DepthNumberBox.Value;
        }

        // Add notes if provided
        if (!string.IsNullOrWhiteSpace(NotesTextBox.Text))
        {
            specValues[&quot;Notes&quot;] = NotesTextBox.Text.Trim();
        }

        // Serialize to JSON
        if (specValues.Count &gt; 0)
        {
            SpecValuesJson = JsonSerializer.Serialize(specValues);
        }
        else
        {
            SpecValuesJson = &quot;{}&quot;;
        }
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_TypeSelectionView.xaml">&lt;UserControl x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_dunnage_typeselectionView&quot;
             x:Name=&quot;RootUserControl&quot;
             xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
             xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
             xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
             xmlns:viewmodels=&quot;using:MTM_Receiving_Application.Module_Dunnage.ViewModels&quot;
             xmlns:models=&quot;using:MTM_Receiving_Application.Module_Dunnage.Models&quot;
             xmlns:materialIcons=&quot;using:Material.Icons.WinUI3&quot;
             xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
             mc:Ignorable=&quot;d&quot;
             Loaded=&quot;OnLoaded&quot;&gt;

    &lt;UserControl.Resources&gt;
        &lt;converters:Converter_IconCodeToGlyph x:Key=&quot;IconCodeToGlyphConverter&quot; /&gt;
    &lt;/UserControl.Resources&gt;

    &lt;Grid&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot; /&gt;
            &lt;RowDefinition Height=&quot;*&quot; /&gt;
            &lt;RowDefinition Height=&quot;Auto&quot; /&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header --&gt;
        &lt;StackPanel Grid.Row=&quot;0&quot;
                    Spacing=&quot;8&quot;
                    Margin=&quot;0,0,0,32&quot;&gt;
            &lt;TextBlock Text=&quot;Select Dunnage Type&quot;
                       Style=&quot;{StaticResource TitleTextBlockStyle}&quot; /&gt;
            &lt;TextBlock Text=&quot;{x:Bind ViewModel.GetTip(&apos;Dunnage.TypeSelection&apos;), Mode=OneWay}&quot;
                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot; /&gt;
        &lt;/StackPanel&gt;

        &lt;!-- 3x3 Type Grid --&gt;
        &lt;GridView Grid.Row=&quot;1&quot;
                  ItemsSource=&quot;{x:Bind ViewModel.DisplayedTypes, Mode=OneWay}&quot;
                  SelectedItem=&quot;{x:Bind ViewModel.SelectedType, Mode=TwoWay}&quot;
                  SelectionMode=&quot;None&quot;
                  IsItemClickEnabled=&quot;True&quot;
                  ItemClick=&quot;TypeCard_ItemClick&quot;
                  MaxWidth=&quot;960&quot;
                  HorizontalAlignment=&quot;Center&quot;&gt;
            &lt;GridView.ItemsPanel&gt;
                &lt;ItemsPanelTemplate&gt;
                    &lt;ItemsWrapGrid Orientation=&quot;Horizontal&quot;
                                   MaximumRowsOrColumns=&quot;3&quot; /&gt;
                &lt;/ItemsPanelTemplate&gt;
            &lt;/GridView.ItemsPanel&gt;
            &lt;GridView.ItemTemplate&gt;
                &lt;DataTemplate x:DataType=&quot;models:Model_DunnageType&quot;&gt;
                    &lt;Border Width=&quot;280&quot;
                            Height=&quot;180&quot;
                            Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                            BorderThickness=&quot;1&quot;
                            CornerRadius=&quot;8&quot;
                            Padding=&quot;20&quot;&gt;
                        &lt;Border.ContextFlyout&gt;
                            &lt;MenuFlyout&gt;
                                &lt;MenuFlyoutItem Text=&quot;Edit&quot;
                                                Icon=&quot;Edit&quot;
                                                Command=&quot;{Binding ElementName=RootUserControl, Path=ViewModel.EditTypeCommand}&quot;
                                                CommandParameter=&quot;{x:Bind}&quot; /&gt;
                                &lt;MenuFlyoutItem Text=&quot;Delete&quot;
                                                Icon=&quot;Delete&quot;
                                                Command=&quot;{Binding ElementName=RootUserControl, Path=ViewModel.DeleteTypeCommand}&quot;
                                                CommandParameter=&quot;{x:Bind}&quot; /&gt;
                            &lt;/MenuFlyout&gt;
                        &lt;/Border.ContextFlyout&gt;
                        &lt;Grid&gt;
                            &lt;Grid.RowDefinitions&gt;
                                &lt;RowDefinition Height=&quot;Auto&quot; /&gt;
                                &lt;RowDefinition Height=&quot;*&quot; /&gt;
                                &lt;RowDefinition Height=&quot;Auto&quot; /&gt;
                            &lt;/Grid.RowDefinitions&gt;

                            &lt;!-- Icon --&gt;
                            &lt;materialIcons:MaterialIcon Grid.Row=&quot;0&quot;
                                                        Kind=&quot;{x:Bind IconKind, Mode=OneWay}&quot;
                                                        Width=&quot;48&quot;
                                                        Height=&quot;48&quot;
                                                        Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;
                                                        HorizontalAlignment=&quot;Center&quot;
                                                        Margin=&quot;0,0,0,12&quot; /&gt;

                            &lt;!-- Type Name --&gt;
                            &lt;TextBlock Grid.Row=&quot;1&quot;
                                       Text=&quot;{x:Bind TypeName}&quot;
                                       Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;
                                       HorizontalAlignment=&quot;Center&quot;
                                       VerticalAlignment=&quot;Center&quot;
                                       TextAlignment=&quot;Center&quot;
                                       TextWrapping=&quot;Wrap&quot; /&gt;
                        &lt;/Grid&gt;
                    &lt;/Border&gt;
                &lt;/DataTemplate&gt;
            &lt;/GridView.ItemTemplate&gt;
        &lt;/GridView&gt;

        &lt;!-- Pagination Controls --&gt;
        &lt;StackPanel Grid.Row=&quot;2&quot;
                    Orientation=&quot;Horizontal&quot;
                    HorizontalAlignment=&quot;Center&quot;
                    Spacing=&quot;16&quot;
                    Margin=&quot;0,32,0,0&quot;&gt;
            &lt;!-- First Page --&gt;
            &lt;Button Command=&quot;{x:Bind ViewModel.FirstPageCommand}&quot;
                    ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.FirstPage&apos;), Mode=OneWay}&quot;&gt;
                &lt;FontIcon Glyph=&quot;&amp;#xE892;&quot;
                          FontSize=&quot;16&quot; /&gt;
            &lt;/Button&gt;

            &lt;!-- Previous Page --&gt;
            &lt;Button Command=&quot;{x:Bind ViewModel.PreviousPageCommand}&quot;
                    ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.PreviousPage&apos;), Mode=OneWay}&quot;&gt;
                &lt;FontIcon Glyph=&quot;&amp;#xE76B;&quot;
                          FontSize=&quot;16&quot; /&gt;
            &lt;/Button&gt;

            &lt;!-- Page Info --&gt;
            &lt;Border Background=&quot;{ThemeResource LayerFillColorDefaultBrush}&quot;
                    Padding=&quot;16,8&quot;
                    CornerRadius=&quot;4&quot;
                    MinWidth=&quot;120&quot;&gt;
                &lt;TextBlock Text=&quot;{x:Bind ViewModel.PageInfo, Mode=OneWay}&quot;
                           HorizontalAlignment=&quot;Center&quot;
                           VerticalAlignment=&quot;Center&quot; /&gt;
            &lt;/Border&gt;

            &lt;!-- Next Page --&gt;
            &lt;Button Command=&quot;{x:Bind ViewModel.NextPageCommand}&quot;
                    ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.NextPage&apos;), Mode=OneWay}&quot;&gt;
                &lt;FontIcon Glyph=&quot;&amp;#xE76C;&quot;
                          FontSize=&quot;16&quot; /&gt;
            &lt;/Button&gt;

            &lt;!-- Last Page --&gt;
            &lt;Button Command=&quot;{x:Bind ViewModel.LastPageCommand}&quot;
                    ToolTipService.ToolTip=&quot;{x:Bind ViewModel.GetTooltip(&apos;Button.LastPage&apos;), Mode=OneWay}&quot;&gt;
                &lt;FontIcon Glyph=&quot;&amp;#xE893;&quot;
                          FontSize=&quot;16&quot; /&gt;
            &lt;/Button&gt;

            &lt;!-- Quick Add Button --&gt;
            &lt;Button Command=&quot;{x:Bind ViewModel.QuickAddTypeCommand}&quot;
                    Style=&quot;{StaticResource AccentButtonStyle}&quot;
                    Margin=&quot;32,0,0,0&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot;
                            Spacing=&quot;8&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE710;&quot;
                              FontSize=&quot;16&quot; /&gt;
                    &lt;TextBlock Text=&quot;Quick Add Type&quot; /&gt;
                &lt;/StackPanel&gt;
            &lt;/Button&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;</file><file path="Module_Dunnage/Views/View_Dunnage_TypeSelectionView.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.Views;

/// &lt;summary&gt;
/// UserControl for Dunnage Type Selection view with 3x3 paginated grid
/// &lt;/summary&gt;
public sealed partial class View_dunnage_typeselectionView : UserControl
{
    public ViewModel_dunnage_typeselection ViewModel { get; }
    private readonly IService_Focus _focusService;

    public View_dunnage_typeselectionView()
    {
        ViewModel = App.GetService&lt;ViewModel_dunnage_typeselection&gt;();
        _focusService = App.GetService&lt;IService_Focus&gt;();
        InitializeComponent();

        _focusService.AttachFocusOnVisibility(this);
    }

    private async void OnLoaded(object sender, RoutedEventArgs e)
    {
        System.Diagnostics.Debug.WriteLine(&quot;dunnage_typeselectionView: OnLoaded called&quot;);
        await ViewModel.InitializeAsync();
    }

    private async void TypeCard_ItemClick(object sender, ItemClickEventArgs e)
    {
        if (e.ClickedItem is Model_DunnageType type)
        {
            await ViewModel.SelectTypeCommand.ExecuteAsync(type);
        }
    }
}</file><file path="Module_Receiving/Contracts/IService_MySQL_PackagePreferences.cs">using System;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;

namespace MTM_Receiving_Application.Module_Receiving.Contracts
{
    /// &lt;summary&gt;
    /// Service for managing package type preferences in MySQL database.
    /// &lt;/summary&gt;
    public interface IService_MySQL_PackagePreferences
    {
        /// &lt;summary&gt;
        /// Retrieves the saved package type preference for a part ID.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;partID&quot;&gt;Part identifier&lt;/param&gt;
        /// &lt;returns&gt;PackageTypePreference if found, null otherwise&lt;/returns&gt;
        /// &lt;exception cref=&quot;ArgumentException&quot;&gt;If partID is null or empty&lt;/exception&gt;
        public Task&lt;Model_PackageTypePreference?&gt; GetPreferenceAsync(string partID);

        /// &lt;summary&gt;
        /// Saves or updates the package type preference for a part ID.
        /// Uses UPSERT logic (INSERT or UPDATE based on existence).
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;preference&quot;&gt;Preference to save&lt;/param&gt;
        /// &lt;exception cref=&quot;ArgumentNullException&quot;&gt;If preference is null&lt;/exception&gt;
        /// &lt;exception cref=&quot;ArgumentException&quot;&gt;If preference.PartID is null or empty&lt;/exception&gt;
        /// &lt;exception cref=&quot;InvalidOperationException&quot;&gt;If database operation fails&lt;/exception&gt;
        public Task SavePreferenceAsync(Model_PackageTypePreference preference);

        /// &lt;summary&gt;
        /// Deletes a package type preference for a part ID.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;partID&quot;&gt;Part identifier&lt;/param&gt;
        /// &lt;returns&gt;True if deleted, false if not found&lt;/returns&gt;
        public Task&lt;bool&gt; DeletePreferenceAsync(string partID);
    }
}</file><file path="Module_Receiving/Contracts/IService_MySQL_Receiving.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;

namespace MTM_Receiving_Application.Module_Receiving.Contracts
{
    /// &lt;summary&gt;
    /// Service for saving receiving load data to MySQL database.
    /// &lt;/summary&gt;
    public interface IService_MySQL_Receiving
    {
        /// &lt;summary&gt;
        /// Saves a batch of receiving loads to the database within a transaction.
        /// All loads succeed or all fail (atomic operation).
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;loads&quot;&gt;List of receiving loads to save&lt;/param&gt;
        /// &lt;returns&gt;Number of loads successfully inserted&lt;/returns&gt;
        /// &lt;exception cref=&quot;ArgumentException&quot;&gt;If loads list is null or empty&lt;/exception&gt;
        /// &lt;exception cref=&quot;InvalidOperationException&quot;&gt;If database operation fails&lt;/exception&gt;
        public Task&lt;int&gt; SaveReceivingLoadsAsync(List&lt;Model_ReceivingLoad&gt; loads);

        /// &lt;summary&gt;
        /// Retrieves receiving history for a specific part (for reference/audit).
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;partID&quot;&gt;Part identifier&lt;/param&gt;
        /// &lt;param name=&quot;startDate&quot;&gt;Start date for history&lt;/param&gt;
        /// &lt;param name=&quot;endDate&quot;&gt;End date for history&lt;/param&gt;
        /// &lt;returns&gt;List of historical receiving loads&lt;/returns&gt;
        public Task&lt;List&lt;Model_ReceivingLoad&gt;&gt; GetReceivingHistoryAsync(string partID, DateTime startDate, DateTime endDate);

        /// &lt;summary&gt;
        /// Retrieves all receiving loads within a date range.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;startDate&quot;&gt;Start date for retrieval&lt;/param&gt;
        /// &lt;param name=&quot;endDate&quot;&gt;End date for retrieval&lt;/param&gt;
        /// &lt;returns&gt;DAO result containing list of receiving loads&lt;/returns&gt;
        public Task&lt;Model_Dao_Result&lt;List&lt;Model_ReceivingLoad&gt;&gt;&gt; GetAllReceivingLoadsAsync(DateTime startDate, DateTime endDate);

        /// &lt;summary&gt;
        /// Updates a batch of receiving loads in the database.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;loads&quot;&gt;List of loads to update&lt;/param&gt;
        /// &lt;returns&gt;Number of loads successfully updated&lt;/returns&gt;
        public Task&lt;int&gt; UpdateReceivingLoadsAsync(List&lt;Model_ReceivingLoad&gt; loads);

        /// &lt;summary&gt;
        /// Deletes a batch of receiving loads from the database.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;loads&quot;&gt;List of loads to delete&lt;/param&gt;
        /// &lt;returns&gt;Number of loads successfully deleted&lt;/returns&gt;
        public Task&lt;int&gt; DeleteReceivingLoadsAsync(List&lt;Model_ReceivingLoad&gt; loads);

        /// &lt;summary&gt;
        /// Validates that the MySQL database connection is available.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;True if connection successful, false otherwise&lt;/returns&gt;
        public Task&lt;bool&gt; TestConnectionAsync();
    }
}</file><file path="Module_Receiving/Contracts/IService_MySQL_ReceivingLine.cs">using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;

namespace MTM_Receiving_Application.Module_Receiving.Contracts;

public interface IService_MySQL_ReceivingLine
{
    /// &lt;summary&gt;Insert a new receiving line&lt;/summary&gt;
    /// &lt;param name=&quot;line&quot;&gt;&lt;/param&gt;
    public Task&lt;Model_Dao_Result&gt; InsertReceivingLineAsync(Model_ReceivingLine line);

    // Add other methods if needed by ReceivingLabelViewModel
}</file><file path="Module_Receiving/Contracts/IService_ReceivingValidation.cs">using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;

namespace MTM_Receiving_Application.Module_Receiving.Contracts
{
    /// &lt;summary&gt;
    /// Service for validating receiving data and enforcing business rules.
    /// &lt;/summary&gt;
    public interface IService_ReceivingValidation
    {
        /// &lt;summary&gt;
        /// Validates a PO number format (6 digits, numeric).
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;poNumber&quot;&gt;PO number to validate&lt;/param&gt;
        /// &lt;returns&gt;Validation result with success flag and error message if invalid&lt;/returns&gt;
        public Model_ReceivingValidationResult ValidatePONumber(string poNumber);

        /// &lt;summary&gt;
        /// Validates a Part ID format and basic requirements.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;partID&quot;&gt;Part ID to validate&lt;/param&gt;
        /// &lt;returns&gt;Validation result&lt;/returns&gt;
        public Model_ReceivingValidationResult ValidatePartID(string partID);

        /// &lt;summary&gt;
        /// Validates number of loads (1-99).
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;numLoads&quot;&gt;Number of loads&lt;/param&gt;
        /// &lt;returns&gt;Validation result&lt;/returns&gt;
        public Model_ReceivingValidationResult ValidateNumberOfLoads(int numLoads);

        /// &lt;summary&gt;
        /// Validates weight/quantity value (must be &gt; 0).
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;weightQuantity&quot;&gt;Weight quantity&lt;/param&gt;
        /// &lt;returns&gt;Validation result&lt;/returns&gt;
        public Model_ReceivingValidationResult ValidateWeightQuantity(decimal weightQuantity);

        /// &lt;summary&gt;
        /// Validates package count (must be &gt; 0).
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;packagesPerLoad&quot;&gt;Package count&lt;/param&gt;
        /// &lt;returns&gt;Validation result&lt;/returns&gt;
        public Model_ReceivingValidationResult ValidatePackageCount(int packagesPerLoad);

        /// &lt;summary&gt;
        /// Validates heat/lot number (required, max length).
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;heatLotNumber&quot;&gt;Heat/lot number&lt;/param&gt;
        /// &lt;returns&gt;Validation result&lt;/returns&gt;
        public Model_ReceivingValidationResult ValidateHeatLotNumber(string heatLotNumber);

        /// &lt;summary&gt;
        /// Validates total quantity against PO ordered quantity (for PO items only).
        /// Returns warning result if exceeded, allowing user to override.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;totalQuantity&quot;&gt;Sum of all load quantities&lt;/param&gt;
        /// &lt;param name=&quot;orderedQuantity&quot;&gt;PO ordered quantity&lt;/param&gt;
        /// &lt;param name=&quot;partID&quot;&gt;Part identifier for error message&lt;/param&gt;
        /// &lt;returns&gt;Validation result with warning severity if exceeded&lt;/returns&gt;
        public Task&lt;Model_ReceivingValidationResult&gt; ValidateAgainstPOQuantityAsync(
            decimal totalQuantity,
            decimal orderedQuantity,
            string partID);

        /// &lt;summary&gt;
        /// Checks for same-day receiving and returns warning if found.
        /// For PO items only - queries Infor Visual for today&apos;s receipts.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;poNumber&quot;&gt;PO number&lt;/param&gt;
        /// &lt;param name=&quot;partID&quot;&gt;Part identifier&lt;/param&gt;
        /// &lt;param name=&quot;userEnteredQuantity&quot;&gt;User&apos;s total entered quantity&lt;/param&gt;
        /// &lt;returns&gt;Validation result with warning if same-day receiving exists&lt;/returns&gt;
        public Task&lt;Model_ReceivingValidationResult&gt; CheckSameDayReceivingAsync(
            string poNumber,
            string partID,
            decimal userEnteredQuantity);

        /// &lt;summary&gt;
        /// Validates a complete receiving load before save.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;load&quot;&gt;Load to validate&lt;/param&gt;
        /// &lt;returns&gt;Validation result&lt;/returns&gt;
        public Model_ReceivingValidationResult ValidateReceivingLoad(Model_ReceivingLoad load);

        /// &lt;summary&gt;
        /// Validates all loads in a session before save.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;loads&quot;&gt;List of loads&lt;/param&gt;
        /// &lt;returns&gt;Validation result with all errors aggregated&lt;/returns&gt;
        public Model_ReceivingValidationResult ValidateSession(List&lt;Model_ReceivingLoad&gt; loads);

        /// &lt;summary&gt;
        /// Validates a part ID exists in Infor Visual (for edit scenarios).
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;partID&quot;&gt;Part ID to check&lt;/param&gt;
        /// &lt;returns&gt;Validation result&lt;/returns&gt;
        public Task&lt;Model_ReceivingValidationResult&gt; ValidatePartExistsInVisualAsync(string partID);
    }
}</file><file path="Module_Receiving/Contracts/IService_ReceivingWorkflow.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Receiving.Contracts
{
    /// &lt;summary&gt;
    /// Service for orchestrating the receiving workflow state machine.
    /// Manages step transitions, validation gates, and session state.
    /// &lt;/summary&gt;
    public interface IService_ReceivingWorkflow
    {
        /// &lt;summary&gt;
        /// Event raised when a status message should be shown.
        /// &lt;/summary&gt;
        public event EventHandler&lt;string&gt; StatusMessageRaised;

        /// &lt;summary&gt;
        /// Raises a status message.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;
        public void RaiseStatusMessage(string message);

        /// &lt;summary&gt;
        /// Event raised when the workflow step changes.
        /// &lt;/summary&gt;
        public event EventHandler StepChanged;

        /// &lt;summary&gt;
        /// Gets the current workflow step.
        /// &lt;/summary&gt;
        public Enum_ReceivingWorkflowStep CurrentStep { get; }

        /// &lt;summary&gt;
        /// Gets the current session.
        /// &lt;/summary&gt;
        public Model_ReceivingSession CurrentSession { get; }

        /// &lt;summary&gt;
        /// Gets or sets the current PO number being processed.
        /// &lt;/summary&gt;
        public string? CurrentPONumber { get; set; }

        /// &lt;summary&gt;
        /// Gets or sets the current part being processed.
        /// &lt;/summary&gt;
        public Model_InforVisualPart? CurrentPart { get; set; }

        /// &lt;summary&gt;
        /// Gets or sets whether the current item is a non-PO item.
        /// &lt;/summary&gt;
        public bool IsNonPOItem { get; set; }

        /// &lt;summary&gt;
        /// Gets or sets the number of loads to create for the current part.
        /// &lt;/summary&gt;
        public int NumberOfLoads { get; set; }

        /// &lt;summary&gt;
        /// Starts a new receiving workflow session.
        /// Loads any existing persisted session if available.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;True if existing session restored, false if new session&lt;/returns&gt;
        public Task&lt;bool&gt; StartWorkflowAsync();

        /// &lt;summary&gt;
        /// Advances to the next step if validation passes.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;Result indicating success and any validation errors&lt;/returns&gt;
        public Task&lt;Model_ReceivingWorkflowStepResult&gt; AdvanceToNextStepAsync();

        /// &lt;summary&gt;
        /// Goes back to the previous step.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;Result indicating success&lt;/returns&gt;
        public Model_ReceivingWorkflowStepResult GoToPreviousStep();

        /// &lt;summary&gt;
        /// Goes to a specific step (used for &quot;Add Another Part/PO&quot;).
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;step&quot;&gt;Target step&lt;/param&gt;
        /// &lt;returns&gt;Result indicating success&lt;/returns&gt;
        public Model_ReceivingWorkflowStepResult GoToStep(Enum_ReceivingWorkflowStep step);

        /// &lt;summary&gt;
        /// Adds current loads to session and resets for next part entry.
        /// &lt;/summary&gt;
        public Task AddCurrentPartToSessionAsync();

        /// &lt;summary&gt;
        /// Saves all loads in session to CSV and database.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;messageProgress&quot;&gt;Progress reporter for status messages&lt;/param&gt;
        /// &lt;param name=&quot;percentProgress&quot;&gt;Progress reporter for percentage completion&lt;/param&gt;
        /// &lt;returns&gt;Result with save operation details&lt;/returns&gt;
        public Task&lt;Model_SaveResult&gt; SaveSessionAsync(IProgress&lt;string&gt;? messageProgress = null, IProgress&lt;int&gt;? percentProgress = null);

        /// &lt;summary&gt;
        /// Clears all UI inputs in registered ViewModels.
        /// &lt;/summary&gt;
        public void ClearUIInputs();

        /// &lt;summary&gt;
        /// Saves all loads in session to CSV only.
        /// &lt;/summary&gt;
        public Task&lt;Model_SaveResult&gt; SaveToCSVOnlyAsync();

        /// &lt;summary&gt;
        /// Saves all loads in session to database only.
        /// &lt;/summary&gt;
        public Task&lt;Model_SaveResult&gt; SaveToDatabaseOnlyAsync();

        /// &lt;summary&gt;
        /// Resets the workflow to initial state.
        /// &lt;/summary&gt;
        public Task ResetWorkflowAsync();

        /// &lt;summary&gt;
        /// Resets the CSV files (deletes them).
        /// &lt;/summary&gt;
        public Task&lt;Model_CSVDeleteResult&gt; ResetCSVFilesAsync();

        /// &lt;summary&gt;
        /// Persists current session state to JSON.
        /// &lt;/summary&gt;
        public Task PersistSessionAsync();
    }
}</file><file path="Module_Receiving/Data/Dao_PackageTypePreference.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using MySql.Data.MySqlClient;

namespace MTM_Receiving_Application.Module_Receiving.Data;

public class Dao_PackageTypePreference
{
    private readonly string _connectionString;

    public Dao_PackageTypePreference(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    // ====================================================================
    // User Preferences (New Feature)
    // ====================================================================

    public async Task&lt;Model_Dao_Result&lt;Model_UserPreference&gt;&gt; GetByUserAsync(string username)
    {
        try
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;username&quot;, username }
            };

            return await Helper_Database_StoredProcedure.ExecuteSingleAsync&lt;Model_UserPreference&gt;(
                _connectionString,
                &quot;sp_package_preferences_get_by_user&quot;,
                reader =&gt; new Model_UserPreference
                {
                    Username = reader[&quot;username&quot;].ToString() ?? string.Empty,
                    PreferredPackageType = reader[&quot;preferred_package_type&quot;].ToString() ?? string.Empty,
                    Workstation = reader[&quot;workstation&quot;].ToString() ?? string.Empty,
                    LastUpdated = Convert.ToDateTime(reader[&quot;last_modified&quot;])
                },
                parameters);
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;Model_UserPreference&gt;(
                $&quot;Error retrieving user package preference: {ex.Message}&quot;,
                ex);
        }
    }

    public async Task&lt;Model_Dao_Result&gt; UpsertAsync(Model_UserPreference preference)
    {
        try
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;username&quot;, preference.Username },
                { &quot;preferred_package_type&quot;, preference.PreferredPackageType },
                { &quot;workstation&quot;, preference.Workstation }
            };

            return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
                _connectionString,
                &quot;sp_package_preferences_upsert&quot;,
                parameters);
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure(
                $&quot;Error upserting user package preference: {ex.Message}&quot;,
                ex);
        }
    }

    // ====================================================================
    // Part Preferences (Existing Feature)
    // ====================================================================

    public async Task&lt;Model_Dao_Result&lt;Model_PackageTypePreference?&gt;&gt; GetPreferenceAsync(string partID)
    {
        try
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;@p_PartID&quot;, partID }
            };

            // Using custom mapper as in original service
            var result = await Helper_Database_StoredProcedure.ExecuteSingleAsync&lt;Model_PackageTypePreference?&gt;(
                _connectionString,
                &quot;sp_Receiving_PackageTypePreference_Get&quot;,
                reader =&gt; new Model_PackageTypePreference
                {
                    PreferenceID = Convert.ToInt32(reader[&quot;PreferenceID&quot;]),
                    PartID = reader[&quot;PartID&quot;].ToString() ?? string.Empty,
                    PackageTypeName = reader[&quot;PackageTypeName&quot;].ToString() ?? string.Empty,
                    CustomTypeName = reader[&quot;CustomTypeName&quot;] == DBNull.Value ? null : reader[&quot;CustomTypeName&quot;].ToString(),
                    LastModified = Convert.ToDateTime(reader[&quot;LastModified&quot;])
                },
                parameters
            );

            if (result.Success)
            {
                return Model_Dao_Result_Factory.Success(result.Data);
            }
            return Model_Dao_Result_Factory.Failure&lt;Model_PackageTypePreference?&gt;(result.ErrorMessage);
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;Model_PackageTypePreference?&gt;(
                $&quot;Error retrieving part package preference: {ex.Message}&quot;,
                ex);
        }
    }

    public async Task&lt;Model_Dao_Result&gt; SavePreferenceAsync(Model_PackageTypePreference preference)
    {
        try
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;@p_PartID&quot;, preference.PartID },
                { &quot;@p_PackageTypeName&quot;, preference.PackageTypeName },
                { &quot;@p_CustomTypeName&quot;, preference.CustomTypeName ?? (object)DBNull.Value },
                { &quot;@p_LastModified&quot;, DateTime.Now }
            };

            var result = await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
                _connectionString,
                &quot;sp_Receiving_PackageTypePreference_Save&quot;,
                parameters
            );

            if (result.Success)
            {
                return Model_Dao_Result_Factory.Success();
            }
            return Model_Dao_Result_Factory.Failure(result.ErrorMessage);
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure(
                $&quot;Error saving part package preference: {ex.Message}&quot;,
                ex);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;bool&gt;&gt; DeletePreferenceAsync(string partID)
    {
        try
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;@p_PartID&quot;, partID }
            };

            var result = await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
                _connectionString,
                &quot;sp_Receiving_PackageTypePreference_Delete&quot;,
                parameters
            );

            if (result.Success)
            {
                return Model_Dao_Result_Factory.Success(true);
            }
            return Model_Dao_Result_Factory.Failure&lt;bool&gt;(result.ErrorMessage);
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;bool&gt;(
                $&quot;Error deleting part package preference: {ex.Message}&quot;,
                ex);
        }
    }
}</file><file path="Module_Receiving/Data/Dao_ReceivingLoad.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;

namespace MTM_Receiving_Application.Module_Receiving.Data;

public class Dao_ReceivingLoad
{
    private readonly string _connectionString;

    public Dao_ReceivingLoad(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    private string? CleanPONumber(string? poNumber)
    {
        if (string.IsNullOrEmpty(poNumber))
        {
            return null;
        }

        return poNumber.Replace(&quot;PO-&quot;, &quot;&quot;, StringComparison.OrdinalIgnoreCase).Trim();
    }

    public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; SaveLoadsAsync(List&lt;Model_ReceivingLoad&gt; loads)
    {
        if (loads == null || loads.Count == 0)
        {
            return Model_Dao_Result_Factory.Failure&lt;int&gt;(&quot;Loads list cannot be null or empty&quot;);
        }

        await using var connection = new MySqlConnection(_connectionString);
        await connection.OpenAsync();

        await using var transaction = await connection.BeginTransactionAsync();
        try
        {
            int savedCount = 0;

            foreach (var load in loads)
            {
                var parameters = new Dictionary&lt;string, object&gt;
                {
                    { &quot;LoadID&quot;, load.LoadID.ToString() },
                    { &quot;PartID&quot;, load.PartID },
                    { &quot;PartType&quot;, load.PartType },
                    { &quot;PONumber&quot;, CleanPONumber(load.PoNumber) ?? (object)DBNull.Value },
                    { &quot;POLineNumber&quot;, load.PoLineNumber },
                    { &quot;LoadNumber&quot;, load.LoadNumber },
                    { &quot;WeightQuantity&quot;, load.WeightQuantity },
                    { &quot;HeatLotNumber&quot;, load.HeatLotNumber },
                    { &quot;PackagesPerLoad&quot;, load.PackagesPerLoad },
                    { &quot;PackageTypeName&quot;, load.PackageTypeName },
                    { &quot;WeightPerPackage&quot;, load.WeightPerPackage },
                    { &quot;IsNonPOItem&quot;, load.IsNonPOItem },
                    { &quot;ReceivedDate&quot;, load.ReceivedDate }
                };

                var result = await Helper_Database_StoredProcedure.ExecuteInTransactionAsync(
                    connection,
                    transaction,
                    &quot;sp_Receiving_Load_Insert&quot;,
                    parameters
                );

                if (!result.Success)
                {
                    throw new InvalidOperationException(result.ErrorMessage, result.Exception);
                }

                savedCount++;
            }

            await transaction.CommitAsync();
            return Model_Dao_Result_Factory.Success&lt;int&gt;(savedCount);
        }
        catch (Exception ex)
        {
            await transaction.RollbackAsync();
            return Model_Dao_Result_Factory.Failure&lt;int&gt;($&quot;Failed to save loads: {ex.Message}&quot;, ex);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; UpdateLoadsAsync(List&lt;Model_ReceivingLoad&gt; loads)
    {
        if (loads == null || loads.Count == 0)
        {
            return Model_Dao_Result_Factory.Failure&lt;int&gt;(&quot;Loads list cannot be null or empty&quot;);
        }

        await using var connection = new MySqlConnection(_connectionString);
        await connection.OpenAsync();

        await using var transaction = await connection.BeginTransactionAsync();
        try
        {
            int updatedCount = 0;

            foreach (var load in loads)
            {
                var parameters = new Dictionary&lt;string, object&gt;
                {
                    { &quot;LoadID&quot;, load.LoadID.ToString() },
                    { &quot;PartID&quot;, load.PartID },
                    { &quot;PartType&quot;, load.PartType },
                    { &quot;PONumber&quot;, CleanPONumber(load.PoNumber) ?? (object)DBNull.Value },
                    { &quot;POLineNumber&quot;, load.PoLineNumber },
                    { &quot;LoadNumber&quot;, load.LoadNumber },
                    { &quot;WeightQuantity&quot;, load.WeightQuantity },
                    { &quot;HeatLotNumber&quot;, load.HeatLotNumber },
                    { &quot;PackagesPerLoad&quot;, load.PackagesPerLoad },
                    { &quot;PackageTypeName&quot;, load.PackageTypeName },
                    { &quot;WeightPerPackage&quot;, load.WeightPerPackage },
                    { &quot;IsNonPOItem&quot;, load.IsNonPOItem },
                    { &quot;ReceivedDate&quot;, load.ReceivedDate }
                };

                var result = await Helper_Database_StoredProcedure.ExecuteInTransactionAsync(
                    connection,
                    transaction,
                    &quot;sp_Receiving_Load_Update&quot;,
                    parameters
                );

                if (!result.Success)
                {
                    throw new InvalidOperationException(result.ErrorMessage, result.Exception);
                }

                updatedCount++;
            }

            await transaction.CommitAsync();
            return Model_Dao_Result_Factory.Success&lt;int&gt;(updatedCount);
        }
        catch (Exception ex)
        {
            await transaction.RollbackAsync();
            return Model_Dao_Result_Factory.Failure&lt;int&gt;($&quot;Failed to update loads: {ex.Message}&quot;, ex);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; DeleteLoadsAsync(List&lt;Model_ReceivingLoad&gt; loads)
    {
        if (loads == null || loads.Count == 0)
        {
            return Model_Dao_Result_Factory.Success&lt;int&gt;(0);
        }

        await using var connection = new MySqlConnection(_connectionString);
        await connection.OpenAsync();

        await using var transaction = await connection.BeginTransactionAsync();
        try
        {
            int deletedCount = 0;

            foreach (var load in loads)
            {
                var parameters = new Dictionary&lt;string, object&gt;
                {
                    { &quot;p_LoadID&quot;, load.LoadID.ToString() }
                };

                var result = await Helper_Database_StoredProcedure.ExecuteInTransactionAsync(
                    connection,
                    transaction,
                    &quot;sp_Receiving_Load_Delete&quot;,
                    parameters
                );

                if (!result.Success)
                {
                    throw new InvalidOperationException(result.ErrorMessage, result.Exception);
                }

                deletedCount++;
            }

            await transaction.CommitAsync();
            return Model_Dao_Result_Factory.Success&lt;int&gt;(deletedCount);
        }
        catch (Exception ex)
        {
            await transaction.RollbackAsync();
            return Model_Dao_Result_Factory.Failure&lt;int&gt;($&quot;Failed to delete loads: {ex.Message}&quot;, ex);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_ReceivingLoad&gt;&gt;&gt; GetHistoryAsync(string partID, DateTime startDate, DateTime endDate)
    {
        try
        {
            var loads = new List&lt;Model_ReceivingLoad&gt;();
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;PartID&quot;, partID },
                { &quot;StartDate&quot;, startDate },
                { &quot;EndDate&quot;, endDate }
            };

            var result = await Helper_Database_StoredProcedure.ExecuteDataTableAsync(
                _connectionString,
                &quot;sp_Receiving_History_Get&quot;,
                parameters
            );

            if (result.IsSuccess &amp;&amp; result.Data != null)
            {
                foreach (DataRow row in result.Data.Rows)
                {
                    loads.Add(MapRowToLoad(row));
                }
                return Model_Dao_Result_Factory.Success(loads);
            }
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_ReceivingLoad&gt;&gt;(result.ErrorMessage);
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_ReceivingLoad&gt;&gt;($&quot;Error retrieving history: {ex.Message}&quot;, ex);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_ReceivingLoad&gt;&gt;&gt; GetAllAsync(DateTime startDate, DateTime endDate)
    {
        try
        {
            var loads = new List&lt;Model_ReceivingLoad&gt;();
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;StartDate&quot;, startDate },
                { &quot;EndDate&quot;, endDate }
            };

            var result = await Helper_Database_StoredProcedure.ExecuteDataTableAsync(
                _connectionString,
                &quot;sp_Receiving_Load_GetAll&quot;,
                parameters
            );

            if (result.IsSuccess &amp;&amp; result.Data != null)
            {
                foreach (DataRow row in result.Data.Rows)
                {
                    loads.Add(MapRowToLoad(row));
                }
                return Model_Dao_Result_Factory.Success(loads);
            }
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_ReceivingLoad&gt;&gt;(result.ErrorMessage);
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_ReceivingLoad&gt;&gt;($&quot;Error retrieving all loads: {ex.Message}&quot;, ex);
        }
    }

    private Model_ReceivingLoad MapRowToLoad(DataRow row)
    {
        return new Model_ReceivingLoad
        {
            LoadID = Guid.Parse(row[&quot;LoadID&quot;]?.ToString() ?? Guid.Empty.ToString()),
            PartID = row[&quot;PartID&quot;]?.ToString() ?? string.Empty,
            PartType = row[&quot;PartType&quot;]?.ToString() ?? string.Empty,
            PoNumber = row[&quot;PONumber&quot;] == DBNull.Value ? null : row[&quot;PONumber&quot;].ToString(),
            PoLineNumber = row[&quot;POLineNumber&quot;]?.ToString() ?? string.Empty,
            LoadNumber = Convert.ToInt32(row[&quot;LoadNumber&quot;]),
            WeightQuantity = Convert.ToDecimal(row[&quot;WeightQuantity&quot;]),
            HeatLotNumber = row[&quot;HeatLotNumber&quot;]?.ToString() ?? string.Empty,
            PackagesPerLoad = Convert.ToInt32(row[&quot;PackagesPerLoad&quot;]),
            PackageTypeName = row[&quot;PackageTypeName&quot;]?.ToString() ?? string.Empty,
            WeightPerPackage = Convert.ToDecimal(row[&quot;WeightPerPackage&quot;]),
            IsNonPOItem = Convert.ToBoolean(row[&quot;IsNonPOItem&quot;]),
            ReceivedDate = Convert.ToDateTime(row[&quot;ReceivedDate&quot;])
        };
    }
}</file><file path="Module_Receiving/Models/Model_ReceivingLine.cs">using System;

namespace MTM_Receiving_Application.Module_Receiving.Models;

/// &lt;summary&gt;
/// Represents a receiving label entry from Google Sheets &quot;Receiving Data&quot;
/// Maps to receiving_label_data database table
/// &lt;/summary&gt;
public class Model_ReceivingLine
{
    /// &lt;summary&gt;
    /// Auto-increment primary key
    /// &lt;/summary&gt;
    public int Id { get; set; }

    /// &lt;summary&gt;
    /// Number of pieces received (Column A in Google Sheets)
    /// &lt;/summary&gt;
    public int Quantity { get; set; }

    /// &lt;summary&gt;
    /// Part identifier (Column B in Google Sheets)
    /// &lt;/summary&gt;
    public string PartID { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Purchase order number (Column C in Google Sheets)
    /// &lt;/summary&gt;
    public int PONumber { get; set; }

    /// &lt;summary&gt;
    /// Receiving employee number (Column D in Google Sheets)
    /// &lt;/summary&gt;
    public int EmployeeNumber { get; set; }

    /// &lt;summary&gt;
    /// Heat/lot number (Column E in Google Sheets)
    /// &lt;/summary&gt;
    public string Heat { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Transaction date (Column F in Google Sheets)
    /// &lt;/summary&gt;
    public DateTime Date { get; set; } = DateTime.Now;

    /// &lt;summary&gt;
    /// Storage location (Column G in Google Sheets)
    /// &lt;/summary&gt;
    public string InitialLocation { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Optional coil count (Column H in Google Sheets)
    /// &lt;/summary&gt;
    public int? CoilsOnSkid { get; set; }

    /// &lt;summary&gt;
    /// Current label number (calculated)
    /// &lt;/summary&gt;
    public int LabelNumber { get; set; } = 1;

    /// &lt;summary&gt;
    /// Total labels for this PO (calculated)
    /// &lt;/summary&gt;
    public int TotalLabels { get; set; } = 1;

    /// &lt;summary&gt;
    /// Supplier name (looked up from part/PO)
    /// &lt;/summary&gt;
    public string VendorName { get; set; } = &quot;Unknown&quot;;

    /// &lt;summary&gt;
    /// Part description (looked up from part ID)
    /// &lt;/summary&gt;
    public string PartDescription { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Record creation timestamp
    /// &lt;/summary&gt;
    public DateTime CreatedAt { get; set; }

    /// &lt;summary&gt;
    /// Formatted label text (e.g., &quot;1 / 5&quot;)
    /// &lt;/summary&gt;
    public string LabelText =&gt; $&quot;{LabelNumber} / {TotalLabels}&quot;;
}</file><file path="Module_Receiving/Models/Model_ReceivingLoad.cs">using CommunityToolkit.Mvvm.ComponentModel;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using System;

namespace MTM_Receiving_Application.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Represents one load/skid of received material with all associated details.
    /// Implements ObservableObject for data binding in WinUI 3.
    /// &lt;/summary&gt;
    public partial class Model_ReceivingLoad : ObservableObject
    {
        [ObservableProperty]
        private Guid _loadID = Guid.NewGuid();

        [ObservableProperty]
        private bool _isSelected;

        [ObservableProperty]
        private string _partID = string.Empty;

        [ObservableProperty]
        private string _partType = string.Empty;

        [ObservableProperty]
        private string? _poNumber;  // Nullable for non-PO items

        [ObservableProperty]
        private string _poLineNumber = string.Empty;

        [ObservableProperty]
        private int _loadNumber;

        [ObservableProperty]
        private decimal _weightQuantity;

        [ObservableProperty]
        private string _heatLotNumber = string.Empty;  // Default to empty, set to &quot;Nothing Entered&quot; on save if blank

        [ObservableProperty]
        private int _remainingQuantity;

        [ObservableProperty]
        private int _packagesPerLoad = 0;  // Default to 0 (blank)

        [ObservableProperty]
        private string _packageTypeName = nameof(Enum_PackageType.Skid);

        [ObservableProperty]
        private Enum_PackageType _packageType = Enum_PackageType.Skid;

        [ObservableProperty]
        private decimal _weightPerPackage;

        [ObservableProperty]
        private bool _isNonPOItem;

        [ObservableProperty]
        private DateTime _receivedDate = DateTime.Now;

        [ObservableProperty]
        private string? _userId;

        partial void OnPartIDChanged(string value)
        {
            if (string.IsNullOrWhiteSpace(value))
                return;

            // If PackagesPerLoad is 0 (default/blank), set it to 1 when PartID is entered
            if (PackagesPerLoad == 0)
            {
                PackagesPerLoad = 1;
            }

            try
            {
                var upperValue = value.ToUpperInvariant();
                if (upperValue.Contains(&quot;MMC&quot;))
                {
                    PackageType = Enum_PackageType.Coil;
                }
                else if (upperValue.Contains(&quot;MMF&quot;))
                {
                    PackageType = Enum_PackageType.Sheet;
                }
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($&quot;[Model_ReceivingLoad] OnPartIDChanged error: {ex.Message}&quot;);
            }
        }

        partial void OnPackageTypeChanged(Enum_PackageType value)
        {
            PackageTypeName = value.ToString();
        }

        partial void OnPackageTypeNameChanged(string value)
        {
            if (Enum.TryParse&lt;Enum_PackageType&gt;(value, out var result))
            {
                if (PackageType != result)
                {
                    PackageType = result;
                }
            }
        }

        /// &lt;summary&gt;
        /// Calculates and updates WeightPerPackage when quantity or package count changes.
        /// &lt;/summary&gt;
        partial void OnWeightQuantityChanged(decimal value)
        {
            CalculateWeightPerPackage();
        }

        /// &lt;summary&gt;
        /// Calculates and updates WeightPerPackage when package count changes.
        /// &lt;/summary&gt;
        partial void OnPackagesPerLoadChanged(int value)
        {
            CalculateWeightPerPackage();
        }

        /// &lt;summary&gt;
        /// Calculates weight per package: WeightQuantity  PackagesPerLoad.
        /// &lt;/summary&gt;
        private void CalculateWeightPerPackage()
        {
            if (PackagesPerLoad &gt; 0)
            {
                // Round to whole number as requested
                WeightPerPackage = Math.Round(WeightQuantity / PackagesPerLoad, 0);
            }
            else
            {
                WeightPerPackage = 0;
            }
        }

        /// &lt;summary&gt;
        /// Display property for review grid showing weight per package with unit.
        /// &lt;/summary&gt;
        public string WeightPerPackageDisplay =&gt;
            $&quot;{WeightPerPackage:F0} lbs per {PackageTypeName}&quot;;

        /// &lt;summary&gt;
        /// Display property for PO number handling null values.
        /// &lt;/summary&gt;
        public string PONumberDisplay =&gt;
            string.IsNullOrEmpty(PoNumber) ? &quot;N/A&quot; : PoNumber;
    }
}</file><file path="Module_Receiving/Models/Model_ReceivingSession.cs">using System;
using System.Collections.Generic;
using System.Linq;
using MTM_Receiving_Application.Module_Core.Models.Systems;

namespace MTM_Receiving_Application.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Represents the current data entry session with accumulated loads from potentially multiple parts.
    /// Persisted to JSON for session restoration across application restarts.
    /// &lt;/summary&gt;
    public class Model_ReceivingSession
    {
        public Guid SessionID { get; set; } = Guid.NewGuid();

        public DateTime CreatedDate { get; set; } = DateTime.Now;

        public List&lt;Model_ReceivingLoad&gt; Loads { get; set; } = new();

        public bool IsNonPO { get; set; }

        public string? PoNumber { get; set; }

        public Model_User? User { get; set; }

        // Transient properties (not persisted to JSON)

        /// &lt;summary&gt;
        /// Total number of loads across all parts in this session.
        /// &lt;/summary&gt;
        public int TotalLoadsCount =&gt; Loads?.Count ?? 0;

        /// &lt;summary&gt;
        /// Sum of all load weights/quantities in this session.
        /// &lt;/summary&gt;
        public decimal TotalWeightQuantity =&gt; Loads?.Sum(l =&gt; l.WeightQuantity) ?? 0;

        /// &lt;summary&gt;
        /// List of unique part IDs in this session.
        /// &lt;/summary&gt;
        public List&lt;string&gt; UniqueParts =&gt;
            Loads?.Select(l =&gt; l.PartID).Distinct().ToList() ?? new List&lt;string&gt;();

        /// &lt;summary&gt;
        /// Indicates whether this session has any loads.
        /// &lt;/summary&gt;
        public bool HasLoads =&gt; Loads?.Count &gt; 0;
    }
}</file><file path="Module_Receiving/Models/Model_ReceivingValidationResult.cs">using System.Collections.Generic;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Result of a receiving validation operation.
    /// &lt;/summary&gt;
    public class Model_ReceivingValidationResult
    {
        public bool IsValid { get; set; }
        public Enum_ValidationSeverity Severity { get; set; } = Enum_ValidationSeverity.Error;
        public string Message { get; set; } = string.Empty;
        public List&lt;string&gt; Errors { get; set; } = new();

        public static Model_ReceivingValidationResult Success() =&gt; new() { IsValid = true };
        public static Model_ReceivingValidationResult Error(string message) =&gt; new()
        {
            IsValid = false,
            Severity = Enum_ValidationSeverity.Error,
            Message = message,
            Errors = new List&lt;string&gt; { message }
        };
        public static Model_ReceivingValidationResult Warning(string message) =&gt; new()
        {
            IsValid = true, // Warnings don&apos;t block
            Severity = Enum_ValidationSeverity.Warning,
            Message = message
        };
    }
}</file><file path="Module_Receiving/Models/Model_ReceivingWorkflowStepResult.cs">using System.Collections.Generic;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Result of a workflow step transition for Receiving.
    /// &lt;/summary&gt;
    public class Model_ReceivingWorkflowStepResult
    {
        public bool Success { get; set; }
        public Enum_ReceivingWorkflowStep NewStep { get; set; }
        public string Message { get; set; } = string.Empty;
        public List&lt;string&gt; ValidationErrors { get; set; } = new();

        public static Model_ReceivingWorkflowStepResult SuccessResult(Enum_ReceivingWorkflowStep newStep, string message = &quot;&quot;) =&gt; new()
        {
            Success = true,
            NewStep = newStep,
            Message = message
        };

        public static Model_ReceivingWorkflowStepResult ErrorResult(List&lt;string&gt; errors) =&gt; new()
        {
            Success = false,
            ValidationErrors = errors
        };
    }
}</file><file path="Module_Receiving/Services/Service_CSVWriter.cs">using CsvHelper;
using CsvHelper.Configuration;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using System;
using System.Collections.Generic;
using System.Globalization;
using System.IO;
using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Receiving.Services
{
    /// &lt;summary&gt;
    /// Service for writing receiving data to CSV files.
    /// Handles both local (%APPDATA%) and network paths with graceful fallback.
    /// &lt;/summary&gt;
    public class Service_CSVWriter : IService_CSVWriter
    {
        private readonly string _localCSVPath;
        private readonly IService_UserSessionManager _sessionManager;
        private readonly IService_LoggingUtility _logger;

        public Service_CSVWriter(IService_UserSessionManager sessionManager, IService_LoggingUtility logger)
        {
            _sessionManager = sessionManager ?? throw new ArgumentNullException(nameof(sessionManager));
            _logger = logger ?? throw new ArgumentNullException(nameof(logger));

            var appDataPath = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
            // Ensure directory exists
            var appDir = Path.Combine(appDataPath, &quot;MTM_Receiving_Application&quot;);
            if (!Directory.Exists(appDir))
            {
                Directory.CreateDirectory(appDir);
            }
            _localCSVPath = Path.Combine(appDir, &quot;ReceivingData.csv&quot;);
        }

        private string GetNetworkCSVPathInternal()
        {
            _logger.LogInfo(&quot;Resolving network CSV path...&quot;);
            try
            {
                string userName;
                if (_sessionManager.CurrentSession?.User != null)
                {
                    userName = _sessionManager.CurrentSession.User.WindowsUsername;
                }
                else
                {
                    userName = Environment.UserName;
                }

                var networkBase = @&quot;\\mtmanu-fs01\Expo Drive\Receiving\MTM Receiving Application\User CSV Files&quot;;
                var userDir = Path.Combine(networkBase, userName);

                _logger.LogInfo($&quot;Checking network directory: {userDir}&quot;);
                // Ensure directory exists
                if (!Directory.Exists(userDir))
                {
                    try
                    {
                        _logger.LogInfo($&quot;Creating network directory: {userDir}&quot;);
                        Directory.CreateDirectory(userDir);
                    }
                    catch (Exception ex)
                    {
                        _logger.LogWarning($&quot;Failed to create network directory: {ex.Message}&quot;);
                    }
                }
                return Path.Combine(userDir, &quot;ReceivingData.csv&quot;);
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Error resolving network path: {ex.Message}&quot;);
                return @&quot;\\mtmanu-fs01\Expo Drive\Receiving\MTM Receiving Application\User CSV Files\UnknownUser\ReceivingData.csv&quot;;
            }
        }

        public async Task&lt;Model_CSVWriteResult&gt; WriteToCSVAsync(List&lt;Model_ReceivingLoad&gt; loads)
        {
            _logger.LogInfo($&quot;Starting WriteToCSVAsync for {loads?.Count ?? 0} loads.&quot;);
            if (loads == null || loads.Count == 0)
            {
                throw new ArgumentException(&quot;Loads list cannot be null or empty&quot;, nameof(loads));
            }

            var result = new Model_CSVWriteResult { RecordsWritten = loads.Count };

            // Write to local CSV (required - failure is critical)
            try
            {
                _logger.LogInfo($&quot;Writing to local CSV: {_localCSVPath}&quot;);
                await WriteToFileAsync(_localCSVPath, loads);
                result.LocalSuccess = true;
                _logger.LogInfo(&quot;Local CSV write successful.&quot;);
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Local CSV write failed: {ex.Message}&quot;);
                result.LocalSuccess = false;
                result.LocalError = ex.Message;
                throw new InvalidOperationException(&quot;Failed to write local CSV file&quot;, ex);
            }

            // Attempt network CSV (optional - failure is not critical)
            try
            {
                _logger.LogInfo(&quot;Attempting network CSV write...&quot;);
                var networkPath = await Task.Run(() =&gt; GetNetworkCSVPathInternal());
                _logger.LogInfo($&quot;Network path resolved: {networkPath}&quot;);
                await WriteToFileAsync(networkPath, loads);
                result.NetworkSuccess = true;
                _logger.LogInfo(&quot;Network CSV write successful.&quot;);
            }
            catch (Exception ex)
            {
                _logger.LogWarning($&quot;Network CSV write failed: {ex.Message}&quot;);
                result.NetworkSuccess = false;
                result.NetworkError = ex.Message;
                // Don&apos;t throw - graceful degradation
            }

            return result;
        }

        public async Task WriteToFileAsync(string filePath, List&lt;Model_ReceivingLoad&gt; loads, bool append = true)
        {
            _logger.LogInfo($&quot;WriteToFileAsync called for: {filePath}, Append: {append}&quot;);
            await Task.Run(async () =&gt;
            {
                try
                {
                    bool isNewFile = !File.Exists(filePath) || !append;
                    _logger.LogInfo($&quot;File exists check for {filePath}: {!isNewFile}&quot;);

                    var config = new CsvConfiguration(CultureInfo.InvariantCulture)
                    {
                        // We handle header manually
                    };

                    var fileMode = append ? FileMode.Append : FileMode.Create;
                    await using var stream = new FileStream(filePath, fileMode, FileAccess.Write, FileShare.Read);
                    await using var writer = new StreamWriter(stream);
                    await using var csv = new CsvWriter(writer, config);

                    if (isNewFile)
                    {
                        csv.WriteHeader&lt;Model_ReceivingLoad&gt;();
                        csv.NextRecord();
                    }

                    foreach (var load in loads)
                    {
                        csv.WriteRecord(load);
                        csv.NextRecord();
                    }

                    await writer.FlushAsync();
                    _logger.LogInfo($&quot;Successfully wrote to {filePath}&quot;);
                }
                catch (Exception ex)
                {
                    _logger.LogError($&quot;Error writing to file {filePath}: {ex.Message}&quot;);
                    throw;
                }
            });
        }

        public async Task&lt;List&lt;Model_ReceivingLoad&gt;&gt; ReadFromCSVAsync(string filePath)
        {
            _logger.LogInfo($&quot;ReadFromCSVAsync called for: {filePath}&quot;);
            return await Task.Run(() =&gt;
            {
                try
                {
                    if (!File.Exists(filePath))
                    {
                        throw new FileNotFoundException($&quot;CSV file not found: {filePath}&quot;);
                    }

                    var config = new CsvConfiguration(CultureInfo.InvariantCulture)
                    {
                        HeaderValidated = null,
                        MissingFieldFound = null
                    };

                    using var reader = new StreamReader(filePath);
                    using var csv = new CsvReader(reader, config);

                    var records = csv.GetRecords&lt;Model_ReceivingLoad&gt;();
                    var loads = new List&lt;Model_ReceivingLoad&gt;(records);

                    _logger.LogInfo($&quot;Successfully read {loads.Count} records from {filePath}&quot;);
                    return loads;
                }
                catch (Exception ex)
                {
                    _logger.LogError($&quot;Error reading from file {filePath}: {ex.Message}&quot;);
                    throw;
                }
            });
        }

        public async Task&lt;Model_CSVDeleteResult&gt; ClearCSVFilesAsync()
        {
            var result = new Model_CSVDeleteResult();

            // Clear local CSV
            if (File.Exists(_localCSVPath))
            {
                try
                {
                    await Task.Run(() =&gt;
                    {
                        using var writer = new StreamWriter(_localCSVPath);
                        using var csv = new CsvWriter(writer, CultureInfo.InvariantCulture);
                        csv.WriteHeader&lt;Model_ReceivingLoad&gt;();
                        csv.NextRecord();
                    });
                    result.LocalDeleted = true;
                }
                catch (Exception ex)
                {
                    result.LocalDeleted = false;
                    result.LocalError = ex.Message;
                }
            }

            // Clear network CSV
            await Task.Run(() =&gt;
            {
                try
                {
                    var networkPath = GetNetworkCSVPathInternal();
                    if (File.Exists(networkPath))
                    {
                        using var writer = new StreamWriter(networkPath);
                        using var csv = new CsvWriter(writer, CultureInfo.InvariantCulture);
                        csv.WriteHeader&lt;Model_ReceivingLoad&gt;();
                        csv.NextRecord();
                        result.NetworkDeleted = true;
                    }
                }
                catch (Exception ex)
                {
                    result.NetworkDeleted = false;
                    result.NetworkError = ex.Message;
                }
            });

            return result;
        }

        public async Task&lt;Model_CSVExistenceResult&gt; CheckCSVFilesExistAsync()
        {
            var result = new Model_CSVExistenceResult();

            await Task.Run(() =&gt;
            {
                result.LocalExists = File.Exists(_localCSVPath);

                try
                {
                    var networkPath = GetNetworkCSVPathInternal();
                    result.NetworkExists = File.Exists(networkPath);
                    result.NetworkAccessible = true;
                }
                catch
                {
                    result.NetworkExists = false;
                    result.NetworkAccessible = false;
                }
            });

            return result;
        }

        public string GetLocalCSVPath() =&gt; _localCSVPath;

        public string GetNetworkCSVPath() =&gt; GetNetworkCSVPathInternal();
    }
}</file><file path="Module_Receiving/Services/Service_MySQL_PackagePreferences.cs">using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Receiving.Data;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using System;
using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Receiving.Services
{
    /// &lt;summary&gt;
    /// Service for managing package type preferences in MySQL database.
    /// &lt;/summary&gt;
    public class Service_MySQL_PackagePreferences : IService_MySQL_PackagePreferences
    {
        private readonly Dao_PackageTypePreference _dao;

        public Service_MySQL_PackagePreferences(Dao_PackageTypePreference dao)
        {
            _dao = dao ?? throw new ArgumentNullException(nameof(dao));
        }

        // Constructor for backward compatibility if needed
        public Service_MySQL_PackagePreferences(string connectionString)
        {
            _dao = new Dao_PackageTypePreference(connectionString);
        }

        public async Task&lt;Model_PackageTypePreference?&gt; GetPreferenceAsync(string partID)
        {
            if (string.IsNullOrWhiteSpace(partID))
            {
                throw new ArgumentException(&quot;Part ID cannot be null or empty&quot;, nameof(partID));
            }

            var result = await _dao.GetPreferenceAsync(partID);

            if (result.IsSuccess)
            {
                return result.Data;
            }

            return null;
        }

        public async Task SavePreferenceAsync(Model_PackageTypePreference preference)
        {
            if (preference == null)
            {
                throw new ArgumentNullException(nameof(preference));
            }

            var result = await _dao.SavePreferenceAsync(preference);

            if (!result.IsSuccess)
            {
                throw new Exception(result.ErrorMessage);
            }
        }

        public async Task&lt;bool&gt; DeletePreferenceAsync(string partID)
        {
            if (string.IsNullOrWhiteSpace(partID))
            {
                throw new ArgumentException(&quot;Part ID cannot be null or empty&quot;, nameof(partID));
            }

            var result = await _dao.DeletePreferenceAsync(partID);

            return result.IsSuccess;
        }
    }
}</file><file path="Module_Receiving/Services/Service_MySQL_Receiving.cs">using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Receiving.Data;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Receiving.Services
{
    /// &lt;summary&gt;
    /// Service for saving receiving load data to MySQL database.
    /// &lt;/summary&gt;
    public class Service_MySQL_Receiving : IService_MySQL_Receiving
    {
        private readonly Dao_ReceivingLoad _receivingLoadDao;
        private readonly IService_LoggingUtility _logger;

        public Service_MySQL_Receiving(
            Dao_ReceivingLoad receivingLoadDao,
            IService_LoggingUtility logger)
        {
            _receivingLoadDao = receivingLoadDao;
            _logger = logger ?? throw new ArgumentNullException(nameof(logger));
        }

        // Constructor for backward compatibility if needed, but DI should handle it
        public Service_MySQL_Receiving(string connectionString, IService_LoggingUtility logger)
        {
            _receivingLoadDao = new Dao_ReceivingLoad(connectionString);
            _logger = logger ?? throw new ArgumentNullException(nameof(logger));
        }

        public async Task&lt;int&gt; SaveReceivingLoadsAsync(List&lt;Model_ReceivingLoad&gt; loads)
        {
            if (loads == null)
            {
                return 0;
            }

            _logger.LogInfo($&quot;Saving {loads.Count} loads to database.&quot;);

            var result = await _receivingLoadDao.SaveLoadsAsync(loads);

            if (result.IsSuccess)
            {
                _logger.LogInfo($&quot;Successfully saved {result.Data} loads.&quot;);
                return result.Data;
            }
            else
            {
                _logger.LogError($&quot;Failed to save loads: {result.ErrorMessage}&quot;, result.Exception);
                throw new InvalidOperationException(result.ErrorMessage, result.Exception);
            }
        }

        public async Task&lt;int&gt; UpdateReceivingLoadsAsync(List&lt;Model_ReceivingLoad&gt; loads)
        {
            if (loads == null)
            {
                return 0;
            }

            _logger.LogInfo($&quot;Updating {loads.Count} loads in database.&quot;);

            var result = await _receivingLoadDao.UpdateLoadsAsync(loads);

            if (result.IsSuccess)
            {
                _logger.LogInfo($&quot;Successfully updated {result.Data} loads.&quot;);
                return result.Data;
            }
            else
            {
                _logger.LogError($&quot;Failed to update loads: {result.ErrorMessage}&quot;, result.Exception);
                throw new InvalidOperationException(result.ErrorMessage, result.Exception);
            }
        }

        public async Task&lt;int&gt; DeleteReceivingLoadsAsync(List&lt;Model_ReceivingLoad&gt; loads)
        {
            if (loads == null)
            {
                return 0;
            }

            _logger.LogInfo($&quot;Deleting {loads.Count} loads from database.&quot;);

            var result = await _receivingLoadDao.DeleteLoadsAsync(loads);

            if (result.IsSuccess)
            {
                _logger.LogInfo($&quot;Successfully deleted {result.Data} loads.&quot;);
                return result.Data;
            }
            else
            {
                _logger.LogError($&quot;Failed to delete loads: {result.ErrorMessage}&quot;, result.Exception);
                throw new InvalidOperationException(result.ErrorMessage, result.Exception);
            }
        }

        public async Task&lt;List&lt;Model_ReceivingLoad&gt;&gt; GetReceivingHistoryAsync(string partID, DateTime startDate, DateTime endDate)
        {
            var result = await _receivingLoadDao.GetHistoryAsync(partID, startDate, endDate);

            if (result.IsSuccess)
            {
                return result.Data ?? new List&lt;Model_ReceivingLoad&gt;();
            }
            else
            {
                _logger.LogError($&quot;Failed to get receiving history: {result.ErrorMessage}&quot;, result.Exception);
                // Return empty list or throw? Original implementation returned empty list on error (implicitly via empty result)
                // But here we know it failed.
                // I&apos;ll return empty list to match previous behavior of returning list (even if empty).
                return new List&lt;Model_ReceivingLoad&gt;();
            }
        }

        public async Task&lt;Model_Dao_Result&lt;List&lt;Model_ReceivingLoad&gt;&gt;&gt; GetAllReceivingLoadsAsync(DateTime startDate, DateTime endDate)
        {
            _logger.LogInfo($&quot;Retrieving all receiving loads from {startDate:yyyy-MM-dd} to {endDate:yyyy-MM-dd}&quot;);

            var result = await _receivingLoadDao.GetAllAsync(startDate, endDate);

            if (result.IsSuccess)
            {
                _logger.LogInfo($&quot;Retrieved {result.Data?.Count ?? 0} receiving loads from database&quot;);
                return result;
            }
            else
            {
                _logger.LogError($&quot;Failed to retrieve receiving loads: {result.ErrorMessage}&quot;, result.Exception);
                return result;
            }
        }

        public async Task&lt;bool&gt; TestConnectionAsync()
        {
            // Delegate to DAO or keep simple check?
            // DAO doesn&apos;t have TestConnection.
            // I&apos;ll keep it simple or add it to DAO.
            // Since I don&apos;t want to modify DAO again right now, I&apos;ll just try a simple query via DAO if possible,
            // or just assume true if DAO is instantiated.
            // Actually, I can&apos;t easily test connection without exposing connection string or adding method to DAO.
            // I&apos;ll add TestConnectionAsync to DAO later if needed.
            // For now, I&apos;ll just return true as a placeholder or try to call GetAllAsync with limit 0?
            // Or I can just remove this method if it&apos;s not in the interface.
            // Let&apos;s check interface.
            return true;
        }
    }
}</file><file path="Module_Receiving/Services/Service_MySQL_ReceivingLine.cs">using System;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Receiving.Data;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Receiving.Models;

namespace MTM_Receiving_Application.Module_Receiving.Services;

public class Service_MySQL_ReceivingLine : IService_MySQL_ReceivingLine
{
    private readonly Dao_ReceivingLine _receivingLineDao;
    private readonly IService_LoggingUtility _logger;
    private readonly IService_ErrorHandler _errorHandler;

    public Service_MySQL_ReceivingLine(
        Dao_ReceivingLine receivingLineDao,
        IService_LoggingUtility logger,
        IService_ErrorHandler errorHandler)
    {
        _receivingLineDao = receivingLineDao;
        _logger = logger;
        _errorHandler = errorHandler;
    }

    public async Task&lt;Model_Dao_Result&gt; InsertReceivingLineAsync(Model_ReceivingLine line)
    {
        try
        {
            // DELEGATE TO DAO
            var result = await _receivingLineDao.InsertReceivingLineAsync(line);

            if (!result.IsSuccess)
            {
                _logger.LogError(
                    $&quot;Failed to insert receiving line: {result.ErrorMessage}&quot;, null, &quot;ReceivingLine&quot;);
            }
            else
            {
                _logger.LogInfo(
                   $&quot;Inserted receiving line for PO {line.PONumber}, Part {line.PartID}&quot;, &quot;ReceivingLine&quot;);
            }

            return result;
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                $&quot;Error in {nameof(InsertReceivingLineAsync)}: {ex.Message}&quot;,
                Enum_ErrorSeverity.Critical,
                ex);

            return Model_Dao_Result_Factory.Failure(
                &quot;An error occurred while inserting receiving line.&quot;, ex);
        }
    }
}</file><file path="Module_Receiving/Services/Service_ReceivingWorkflow.cs">using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;


namespace MTM_Receiving_Application.Module_Receiving.Services
{
    /// &lt;summary&gt;
    /// Service for orchestrating the receiving workflow state machine.
    /// Manages step transitions, validation gates, and session state.
    /// &lt;/summary&gt;
    public class Service_ReceivingWorkflow : IService_ReceivingWorkflow
    {
        private readonly IService_SessionManager _sessionManager;
        private readonly IService_CSVWriter _csvWriter;
        private readonly IService_MySQL_Receiving _mysqlReceiving;
        private readonly IService_ReceivingValidation _validation;
        private readonly IService_LoggingUtility _logger;
        private readonly IService_ViewModelRegistry _viewModelRegistry;
        private readonly List&lt;Model_ReceivingLoad&gt; _currentBatchLoads = new();

        public event EventHandler? StepChanged;
        public event EventHandler&lt;string&gt;? StatusMessageRaised;

        public void RaiseStatusMessage(string message)
        {
            StatusMessageRaised?.Invoke(this, message);
        }

        private Enum_ReceivingWorkflowStep _currentStep = Enum_ReceivingWorkflowStep.ModeSelection;
        public Enum_ReceivingWorkflowStep CurrentStep
        {
            get =&gt; _currentStep;
            private set
            {
                if (_currentStep != value)
                {
                    _logger.LogInfo($&quot;Changing step from {_currentStep} to {value}&quot;);
                    _currentStep = value;
                    StepChanged?.Invoke(this, EventArgs.Empty);
                    _logger.LogInfo($&quot;Step changed to {value} (event fired)&quot;);
                }
            }
        }
        public Model_ReceivingSession CurrentSession { get; private set; } = new();
        public string? CurrentPONumber { get; set; }
        public Model_InforVisualPart? CurrentPart { get; set; }
        public bool IsNonPOItem { get; set; }
        public int NumberOfLoads { get; set; } = 1;

        public Service_ReceivingWorkflow(
            IService_SessionManager sessionManager,
            IService_CSVWriter csvWriter,
            IService_MySQL_Receiving mysqlReceiving,
            IService_ReceivingValidation validation,
            IService_LoggingUtility logger,
            IService_ViewModelRegistry viewModelRegistry)
        {
            _sessionManager = sessionManager ?? throw new ArgumentNullException(nameof(sessionManager));
            _csvWriter = csvWriter ?? throw new ArgumentNullException(nameof(csvWriter));
            _mysqlReceiving = mysqlReceiving ?? throw new ArgumentNullException(nameof(mysqlReceiving));
            _validation = validation ?? throw new ArgumentNullException(nameof(validation));
            _logger = logger ?? throw new ArgumentNullException(nameof(logger));
            _viewModelRegistry = viewModelRegistry ?? throw new ArgumentNullException(nameof(viewModelRegistry));
        }

        public async Task&lt;bool&gt; StartWorkflowAsync()
        {
            _logger.LogInfo(&quot;Starting receiving workflow.&quot;);
            // Try to load existing session
            var existingSession = await _sessionManager.LoadSessionAsync();

            if (existingSession?.HasLoads == true)
            {
                _logger.LogInfo(&quot;Restoring existing session.&quot;);
                CurrentSession = existingSession;
                // Determine which step to restore to based on session state
                CurrentStep = Enum_ReceivingWorkflowStep.Review; // Default to review if session exists
                return true; // Session restored
            }

            // Start fresh
            CurrentSession = new Model_ReceivingSession();
            NumberOfLoads = 1;

            // Check if user has a default receiving mode set
            var userSessionManager = App.GetService&lt;IService_UserSessionManager&gt;();
            var currentUser = userSessionManager?.CurrentSession?.User;

            if (currentUser != null &amp;&amp; !string.IsNullOrEmpty(currentUser.DefaultReceivingMode))
            {
                // Skip mode selection and go directly to the default mode
                switch (currentUser.DefaultReceivingMode.ToLower())
                {
                    case &quot;guided&quot;:
                        CurrentStep = Enum_ReceivingWorkflowStep.POEntry;
                        _logger.LogInfo(&quot;Starting in Guided mode (default)&quot;);
                        break;
                    case &quot;manual&quot;:
                        CurrentStep = Enum_ReceivingWorkflowStep.ManualEntry;
                        _logger.LogInfo(&quot;Starting in Manual Entry mode (default)&quot;);
                        break;
                    case &quot;edit&quot;:
                        CurrentStep = Enum_ReceivingWorkflowStep.EditMode;
                        _logger.LogInfo(&quot;Starting in Edit mode (default)&quot;);
                        break;
                    default:
                        // Invalid default, show mode selection
                        CurrentStep = Enum_ReceivingWorkflowStep.ModeSelection;
                        _logger.LogInfo(&quot;Invalid default mode, showing mode selection&quot;);
                        break;
                }
            }
            else
            {
                // No default mode, show mode selection
                CurrentStep = Enum_ReceivingWorkflowStep.ModeSelection;
                _logger.LogInfo(&quot;No default mode set, showing mode selection&quot;);
            }

            return false; // New session
        }

        public async Task&lt;Model_ReceivingWorkflowStepResult&gt; AdvanceToNextStepAsync()
        {
            // Validate current step before advancing
            var validationErrors = new List&lt;string&gt;();

            switch (CurrentStep)
            {
                case Enum_ReceivingWorkflowStep.ModeSelection:
                    // Transition handled by GoToStep
                    return Model_ReceivingWorkflowStepResult.SuccessResult(CurrentStep);

                case Enum_ReceivingWorkflowStep.ManualEntry:
                    // Manual entry goes directly to saving/review
                    // Validation happens on save
                    CurrentStep = Enum_ReceivingWorkflowStep.Saving;
                    return Model_ReceivingWorkflowStepResult.SuccessResult(CurrentStep);

                case Enum_ReceivingWorkflowStep.EditMode:
                    // Edit mode goes to saving/review
                    CurrentStep = Enum_ReceivingWorkflowStep.Saving;
                    return Model_ReceivingWorkflowStepResult.SuccessResult(CurrentStep);

                case Enum_ReceivingWorkflowStep.POEntry:
                    if (string.IsNullOrEmpty(CurrentPONumber) &amp;&amp; !IsNonPOItem)
                    {
                        validationErrors.Add(&quot;PO Number is required.&quot;);
                        return Model_ReceivingWorkflowStepResult.ErrorResult(validationErrors);
                    }
                    if (CurrentPart == null)
                    {
                        validationErrors.Add(&quot;Part selection is required.&quot;);
                        return Model_ReceivingWorkflowStepResult.ErrorResult(validationErrors);
                    }

                    // Update session with PO/Part info
                    CurrentSession.IsNonPO = IsNonPOItem;
                    CurrentSession.PoNumber = IsNonPOItem ? null : CurrentPONumber;

                    CurrentStep = Enum_ReceivingWorkflowStep.LoadEntry;
                    break;

                case Enum_ReceivingWorkflowStep.LoadEntry:
                    if (NumberOfLoads &lt; 1)
                    {
                        validationErrors.Add(&quot;Number of loads must be at least 1.&quot;);
                        return Model_ReceivingWorkflowStepResult.ErrorResult(validationErrors);
                    }
                    GenerateLoads();
                    CurrentStep = Enum_ReceivingWorkflowStep.WeightQuantityEntry;
                    break;

                case Enum_ReceivingWorkflowStep.WeightQuantityEntry:
                    foreach (var load in CurrentSession.Loads)
                    {
                        var result = _validation.ValidateWeightQuantity(load.WeightQuantity);
                        if (!result.IsValid)
                        {
                            validationErrors.Add($&quot;Load {load.LoadNumber}: {result.Message}&quot;);
                        }
                    }
                    if (validationErrors.Count &gt; 0)
                    {
                        return Model_ReceivingWorkflowStepResult.ErrorResult(validationErrors);
                    }
                    CurrentStep = Enum_ReceivingWorkflowStep.HeatLotEntry;
                    break;

                case Enum_ReceivingWorkflowStep.HeatLotEntry:
                    foreach (var load in CurrentSession.Loads)
                    {
                        var result = _validation.ValidateHeatLotNumber(load.HeatLotNumber);
                        if (!result.IsValid)
                        {
                            validationErrors.Add($&quot;Load {load.LoadNumber}: {result.Message}&quot;);
                        }
                    }
                    if (validationErrors.Count &gt; 0)
                    {
                        return Model_ReceivingWorkflowStepResult.ErrorResult(validationErrors);
                    }
                    CurrentStep = Enum_ReceivingWorkflowStep.PackageTypeEntry;
                    break;

                case Enum_ReceivingWorkflowStep.PackageTypeEntry:
                    foreach (var load in CurrentSession.Loads)
                    {
                        var result = _validation.ValidatePackageCount(load.PackagesPerLoad);
                        if (!result.IsValid)
                        {
                            validationErrors.Add($&quot;Load {load.LoadNumber}: {result.Message}&quot;);
                        }
                        if (string.IsNullOrWhiteSpace(load.PackageTypeName))
                        {
                            validationErrors.Add($&quot;Load {load.LoadNumber}: Package Type is required.&quot;);
                        }
                    }
                    if (validationErrors.Count &gt; 0)
                    {
                        return Model_ReceivingWorkflowStepResult.ErrorResult(validationErrors);
                    }
                    CurrentStep = Enum_ReceivingWorkflowStep.Review;
                    break;

                case Enum_ReceivingWorkflowStep.Review:
                    _logger.LogInfo(&quot;Transitioning from Review to Saving...&quot;);
                    CurrentStep = Enum_ReceivingWorkflowStep.Saving;
                    break;

                case Enum_ReceivingWorkflowStep.Saving:
                    CurrentStep = Enum_ReceivingWorkflowStep.Complete;
                    break;

                default:
                    validationErrors.Add($&quot;Cannot advance from step {CurrentStep}&quot;);
                    return Model_ReceivingWorkflowStepResult.ErrorResult(validationErrors);
            }

            // Persist session after step change
            _logger.LogInfo(&quot;Persisting session...&quot;);
            await PersistSessionAsync();
            _logger.LogInfo(&quot;Session persisted.&quot;);

            return Model_ReceivingWorkflowStepResult.SuccessResult(CurrentStep, $&quot;Advanced to {CurrentStep}&quot;);
        }

        private void GenerateLoads()
        {
            // Remove previous loads from this batch if they exist
            if (_currentBatchLoads.Count &gt; 0)
            {
                foreach (var load in _currentBatchLoads)
                {
                    CurrentSession.Loads.Remove(load);
                }
                _currentBatchLoads.Clear();
            }

            for (int i = 1; i &lt;= NumberOfLoads; i++)
            {
                var load = new Model_ReceivingLoad
                {
                    PartID = CurrentPart?.PartID ?? string.Empty,
                    PartType = CurrentPart?.PartType ?? string.Empty,
                    PoNumber = IsNonPOItem ? null : CurrentPONumber,
                    PoLineNumber = CurrentPart?.POLineNumber ?? string.Empty,
                    LoadNumber = CurrentSession.Loads.Count + 1, // Increment load number globally
                    IsNonPOItem = IsNonPOItem
                };
                CurrentSession.Loads.Add(load);
                _currentBatchLoads.Add(load);
            }
        }

        public Model_ReceivingWorkflowStepResult GoToPreviousStep()
        {
            switch (CurrentStep)
            {
                case Enum_ReceivingWorkflowStep.LoadEntry:
                    CurrentStep = Enum_ReceivingWorkflowStep.POEntry;
                    break;

                case Enum_ReceivingWorkflowStep.WeightQuantityEntry:
                    CurrentStep = Enum_ReceivingWorkflowStep.LoadEntry;
                    break;

                case Enum_ReceivingWorkflowStep.HeatLotEntry:
                    CurrentStep = Enum_ReceivingWorkflowStep.WeightQuantityEntry;
                    break;

                case Enum_ReceivingWorkflowStep.PackageTypeEntry:
                    CurrentStep = Enum_ReceivingWorkflowStep.HeatLotEntry;
                    break;

                case Enum_ReceivingWorkflowStep.Review:
                    CurrentStep = Enum_ReceivingWorkflowStep.PackageTypeEntry;
                    break;

                default:
                    return Model_ReceivingWorkflowStepResult.ErrorResult(new List&lt;string&gt; { $&quot;Cannot go back from step {CurrentStep}&quot; });
            }

            return Model_ReceivingWorkflowStepResult.SuccessResult(CurrentStep, $&quot;Returned to {CurrentStep}&quot;);
        }
        public Model_ReceivingWorkflowStepResult GoToStep(Enum_ReceivingWorkflowStep step)
        {
            CurrentStep = step;
            return Model_ReceivingWorkflowStepResult.SuccessResult(CurrentStep, $&quot;Navigated to {CurrentStep}&quot;);
        }

        public async Task AddCurrentPartToSessionAsync()
        {
            // Commit current batch
            _currentBatchLoads.Clear();

            // Reset for next part
            CurrentPONumber = null;
            CurrentPart = null;
            IsNonPOItem = false;
            NumberOfLoads = 1;

            await PersistSessionAsync();
            CurrentStep = Enum_ReceivingWorkflowStep.POEntry;
        }

        public void ClearUIInputs()
        {
            _viewModelRegistry.ClearAllInputs();
        }

        public async Task&lt;Model_SaveResult&gt; SaveToCSVOnlyAsync()
        {
            var result = new Model_SaveResult();

            // Validate session
            var validation = _validation.ValidateSession(CurrentSession.Loads);
            if (!validation.IsValid)
            {
                result.Success = false;
                result.Errors = validation.Errors;
                return result;
            }

            try
            {
                var csvResult = await _csvWriter.WriteToCSVAsync(CurrentSession.Loads);

                result.LocalCSVSuccess = csvResult.LocalSuccess;
                result.NetworkCSVSuccess = csvResult.NetworkSuccess;
                result.LocalCSVPath = _csvWriter.GetLocalCSVPath();
                result.NetworkCSVPath = _csvWriter.GetNetworkCSVPath();

                if (!csvResult.LocalSuccess)
                {
                    result.Errors.Add($&quot;Local CSV write failed: {csvResult.LocalError}&quot;);
                }

                if (!csvResult.NetworkSuccess)
                {
                    result.Warnings.Add($&quot;Network CSV write failed: {csvResult.NetworkError}&quot;);
                }

                result.Success = result.LocalCSVSuccess; // Network failure is just a warning
            }
            catch (Exception ex)
            {
                result.Success = false;
                result.Errors.Add($&quot;CSV save failed: {ex.Message}&quot;);
                _logger.LogError(&quot;CSV save failed&quot;, ex);
            }

            return result;
        }

        public async Task&lt;Model_SaveResult&gt; SaveToDatabaseOnlyAsync()
        {
            var result = new Model_SaveResult();

            // Validate session
            var validation = _validation.ValidateSession(CurrentSession.Loads);
            if (!validation.IsValid)
            {
                result.Success = false;
                result.Errors = validation.Errors;
                return result;
            }

            try
            {
                int savedCount = await _mysqlReceiving.SaveReceivingLoadsAsync(CurrentSession.Loads);
                result.DatabaseSuccess = true;
                result.LoadsSaved = savedCount;
                result.Success = true;
            }
            catch (Exception ex)
            {
                result.DatabaseSuccess = false;
                result.Success = false;
                result.Errors.Add($&quot;Database save failed: {ex.Message}&quot;);
                _logger.LogError(&quot;Database save failed&quot;, ex);
            }

            return result;
        }

        public async Task&lt;Model_SaveResult&gt; SaveSessionAsync(IProgress&lt;string&gt;? messageProgress = null, IProgress&lt;int&gt;? percentProgress = null)
        {
            _logger.LogInfo(&quot;Starting session save.&quot;);
            var result = new Model_SaveResult();

            messageProgress?.Report(&quot;Validating session...&quot;);
            percentProgress?.Report(10);

            // Validate session
            _logger.LogInfo(&quot;Validating session before save...&quot;);
            var validation = _validation.ValidateSession(CurrentSession.Loads);
            if (!validation.IsValid)
            {
                _logger.LogWarning($&quot;Session validation failed: {string.Join(&quot;, &quot;, validation.Errors)}&quot;);
                result.Success = false;
                result.Errors = validation.Errors;
                return result;
            }

            try
            {
                _logger.LogInfo(&quot;Reporting progress: Saving to local CSV...&quot;);
                messageProgress?.Report(&quot;Saving to local CSV...&quot;);
                percentProgress?.Report(30);

                // Save to CSV
                var csvResult = await SaveToCSVOnlyAsync();

                result.LocalCSVSuccess = csvResult.LocalCSVSuccess;
                result.NetworkCSVSuccess = csvResult.NetworkCSVSuccess;
                result.LocalCSVPath = csvResult.LocalCSVPath;
                result.NetworkCSVPath = csvResult.NetworkCSVPath;
                result.Errors.AddRange(csvResult.Errors);
                result.Warnings.AddRange(csvResult.Warnings);

                _logger.LogInfo(&quot;Reporting progress: Saving to database...&quot;);
                messageProgress?.Report(&quot;Saving to database...&quot;);
                percentProgress?.Report(60);

                // Save to database
                var dbResult = await SaveToDatabaseOnlyAsync();

                result.DatabaseSuccess = dbResult.DatabaseSuccess;
                result.LoadsSaved = dbResult.LoadsSaved;
                if (!dbResult.Success)
                {
                    result.Errors.AddRange(dbResult.Errors);
                }

                _logger.LogInfo(&quot;Reporting progress: Finalizing...&quot;);
                messageProgress?.Report(&quot;Finalizing...&quot;);
                percentProgress?.Report(90);

                // Final success check
                // Success if Local CSV worked AND Database worked
                result.Success = result.LocalCSVSuccess &amp;&amp; result.DatabaseSuccess;

                if (result.Success)
                {
                    _logger.LogInfo(&quot;Save completed successfully. Clearing session.&quot;);
                    // Clear session
                    await _sessionManager.ClearSessionAsync();
                    CurrentSession.Loads.Clear();

                    // Also clear CSV files since we saved successfully
                    await _csvWriter.ClearCSVFilesAsync();
                }
                else
                {
                    _logger.LogWarning($&quot;Save completed with errors. Success: {result.Success}&quot;);
                }

                percentProgress?.Report(100);
                return result;
            }
            catch (Exception ex)
            {
                _logger.LogError(&quot;Unexpected error during save session&quot;, ex);
                result.Success = false;
                result.Errors.Add($&quot;Unexpected error: {ex.Message}&quot;);
                return result;
            }
        }

        public async Task ResetWorkflowAsync()
        {
            CurrentSession = new Model_ReceivingSession();
            NumberOfLoads = 1;
            CurrentStep = Enum_ReceivingWorkflowStep.POEntry;
            CurrentPONumber = null;
            CurrentPart = null;
            IsNonPOItem = false;
            _currentBatchLoads.Clear();

            _viewModelRegistry.ClearAllInputs();

            await _sessionManager.ClearSessionAsync();
            StepChanged?.Invoke(this, EventArgs.Empty);
        }

        public async Task&lt;Model_CSVDeleteResult&gt; ResetCSVFilesAsync()
        {
            _logger.LogInfo(&quot;Resetting CSV files requested.&quot;);
            return await _csvWriter.ClearCSVFilesAsync();
        }

        public async Task PersistSessionAsync()
        {
            if (CurrentSession.HasLoads)
            {
                await _sessionManager.SaveSessionAsync(CurrentSession);
            }
        }
    }
}</file><file path="Module_Receiving/Services/Service_SessionManager.cs">using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using System;
using System.IO;
using System.Text.Json;
using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Receiving.Services
{
    /// &lt;summary&gt;
    /// Service for persisting and restoring session state to/from JSON file.
    /// Session file location: %APPDATA%\MTM_Receiving_Application\session.json
    /// &lt;/summary&gt;
    public class Service_SessionManager : IService_SessionManager
    {
        private readonly string _sessionPath;
        private readonly IService_LoggingUtility _logger;

        public Service_SessionManager(IService_LoggingUtility logger)
        {
            _logger = logger ?? throw new ArgumentNullException(nameof(logger));
            var appDataPath = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
            var appFolder = Path.Combine(appDataPath, &quot;MTM_Receiving_Application&quot;);

            // Ensure directory exists
            if (!Directory.Exists(appFolder))
            {
                Directory.CreateDirectory(appFolder);
            }

            _sessionPath = Path.Combine(appFolder, &quot;session.json&quot;);
        }

        public async Task SaveSessionAsync(Model_ReceivingSession session)
        {
            _logger.LogInfo(&quot;SaveSessionAsync started.&quot;);
            if (session == null)
            {
                throw new ArgumentNullException(nameof(session));
            }

            try
            {
                var options = new JsonSerializerOptions
                {
                    WriteIndented = true,
                    PropertyNamingPolicy = JsonNamingPolicy.CamelCase
                };

                _logger.LogInfo(&quot;Serializing session...&quot;);
                var json = JsonSerializer.Serialize(session, options);
                _logger.LogInfo($&quot;Writing session to file: {_sessionPath}&quot;);
                await File.WriteAllTextAsync(_sessionPath, json);
                _logger.LogInfo(&quot;Session saved successfully.&quot;);
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Failed to save session to file: {ex.Message}&quot;, ex);
                throw new InvalidOperationException(&quot;Failed to save session to file&quot;, ex);
            }
        }

        public async Task&lt;Model_ReceivingSession?&gt; LoadSessionAsync()
        {
            if (!File.Exists(_sessionPath))
            {
                return null;
            }

            try
            {
                var json = await File.ReadAllTextAsync(_sessionPath);

                var options = new JsonSerializerOptions
                {
                    PropertyNamingPolicy = JsonNamingPolicy.CamelCase
                };

                return JsonSerializer.Deserialize&lt;Model_ReceivingSession&gt;(json, options);
            }
            catch (JsonException)
            {
                // Corrupted file - delete and return null
                try
                {
                    File.Delete(_sessionPath);
                }
                catch
                {
                    // Ignore delete errors
                }
                return null;
            }
            catch (Exception ex)
            {
                throw new InvalidOperationException(&quot;Failed to load session from file&quot;, ex);
            }
        }

        public async Task&lt;bool&gt; ClearSessionAsync()
        {
            if (!File.Exists(_sessionPath))
            {
                return false;
            }

            try
            {
                await Task.Run(() =&gt; File.Delete(_sessionPath));
                return true;
            }
            catch
            {
                return false;
            }
        }

        public bool SessionExists()
        {
            return File.Exists(_sessionPath);
        }

        public string GetSessionFilePath()
        {
            return _sessionPath;
        }
    }
}</file><file path="Module_Receiving/ViewModels/ViewModel_Receiving_EditMode.cs">using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using System.Collections.Generic;
using System.IO;

namespace MTM_Receiving_Application.Module_Receiving.ViewModels
{
    /// &lt;summary&gt;
    /// ViewModel for Edit Mode - allows editing existing loads but not adding new ones.
    /// &lt;/summary&gt;
    public partial class ViewModel_Receiving_EditMode : ViewModel_Shared_Base
    {
        private readonly IService_ReceivingWorkflow _workflowService;
        private readonly IService_MySQL_Receiving _mysqlService;
        private readonly IService_CSVWriter _csvWriter;
        private readonly IService_Pagination _paginationService;
        private readonly IService_Help _helpService;

        private readonly List&lt;Model_ReceivingLoad&gt; _allLoads = new();
        private List&lt;Model_ReceivingLoad&gt; _filteredLoads = new();

        [ObservableProperty]
        private ObservableCollection&lt;Model_ReceivingLoad&gt; _loads;

        [ObservableProperty]
        private Model_ReceivingLoad? _selectedLoad;

        [ObservableProperty]
        private Enum_DataSourceType _currentDataSource = Enum_DataSourceType.Memory;

        [ObservableProperty]
        private string _selectAllButtonText = &quot;Select All&quot;;

        [ObservableProperty]
        private DateTimeOffset _filterStartDate = DateTimeOffset.Now.AddDays(-7);

        [ObservableProperty]
        private DateTimeOffset _filterEndDate = DateTimeOffset.Now;

        [ObservableProperty]
        private string _thisMonthButtonText = DateTime.Now.ToString(&quot;MMMM&quot;);

        [ObservableProperty]
        private string _thisQuarterButtonText = GetQuarterText(DateTime.Now);

        [ObservableProperty]
        private int _currentPage = 1;

        [ObservableProperty]
        private int _totalPages = 1;

        [ObservableProperty]
        private int _gotoPageNumber = 1;

        private string? _currentCsvPath;
        private readonly List&lt;Model_ReceivingLoad&gt; _deletedLoads = new();
        private readonly IService_Window _windowService;

        public ObservableCollection&lt;Enum_PackageType&gt; PackageTypes { get; } = new(Enum.GetValues&lt;Enum_PackageType&gt;());

        /// &lt;summary&gt;
        /// Initializes a new instance of the EditModeViewModel class.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;workflowService&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;mysqlService&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;csvWriter&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;paginationService&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;errorHandler&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;logger&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;windowService&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;helpService&quot;&gt;&lt;/param&gt;
        public ViewModel_Receiving_EditMode(
            IService_ReceivingWorkflow workflowService,
            IService_MySQL_Receiving mysqlService,
            IService_CSVWriter csvWriter,
            IService_Pagination paginationService,
            IService_ErrorHandler errorHandler,
            IService_LoggingUtility logger,
            IService_Window windowService,
            IService_Help helpService)
            : base(errorHandler, logger)
        {
            _windowService = windowService;
            _workflowService = workflowService;
            _mysqlService = mysqlService;
            _csvWriter = csvWriter;
            _paginationService = paginationService;
            _helpService = helpService;

            _loads = new ObservableCollection&lt;Model_ReceivingLoad&gt;();
            _loads.CollectionChanged += Loads_CollectionChanged;

            _paginationService.PageChanged += OnPageChanged;
            _paginationService.PageSize = 20;

            _logger.LogInfo(&quot;Edit Mode initialized&quot;);
        }

        /// &lt;summary&gt;
        /// Gets the text representation of the quarter for a given date.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;date&quot;&gt;&lt;/param&gt;
        private static string GetQuarterText(DateTime date)
        {
            int quarter = (date.Month - 1) / 3 + 1;
            return quarter switch
            {
                1 =&gt; &quot;Jan-Mar&quot;,
                2 =&gt; &quot;Apr-Jun&quot;,
                3 =&gt; &quot;Jul-Sep&quot;,
                4 =&gt; &quot;Oct-Dec&quot;,
                _ =&gt; &quot;Quarter&quot;
            };
        }

        /// &lt;summary&gt;
        /// Handles the pagination page changed event.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        private void OnPageChanged(object? sender, EventArgs e)
        {
            UpdatePagedDisplay();
        }

        /// &lt;summary&gt;
        /// Updates the displayed loads based on the current page.
        /// &lt;/summary&gt;
        private void UpdatePagedDisplay()
        {
            var pageItems = _paginationService.GetCurrentPageItems&lt;Model_ReceivingLoad&gt;();

            Loads.Clear();
            foreach (var item in pageItems)
            {
                Loads.Add(item);
            }

            CurrentPage = _paginationService.CurrentPage;
            TotalPages = _paginationService.TotalPages;
            GotoPageNumber = CurrentPage;

            NotifyPaginationCommands();
            NotifyCommands();
        }

        /// &lt;summary&gt;
        /// Notifies that pagination command execution status has changed.
        /// &lt;/summary&gt;
        private void NotifyPaginationCommands()
        {
            NextPageCommand.NotifyCanExecuteChanged();
            PreviousPageCommand.NotifyCanExecuteChanged();
            FirstPageCommand.NotifyCanExecuteChanged();
            LastPageCommand.NotifyCanExecuteChanged();
            GoToPageCommand.NotifyCanExecuteChanged();
        }

        /// &lt;summary&gt;
        /// Handles changes to the Loads collection to attach/detach property change listeners.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        private void Loads_CollectionChanged(object? sender, System.Collections.Specialized.NotifyCollectionChangedEventArgs e)
        {
            if (e.NewItems != null)
            {
                foreach (Model_ReceivingLoad item in e.NewItems)
                {
                    item.PropertyChanged += Load_PropertyChanged;
                }
            }
            if (e.OldItems != null)
            {
                foreach (Model_ReceivingLoad item in e.OldItems)
                {
                    item.PropertyChanged -= Load_PropertyChanged;
                }
            }

            NotifyCommands();
        }

        /// &lt;summary&gt;
        /// Handles property changes on individual load items.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        private void Load_PropertyChanged(object? sender, System.ComponentModel.PropertyChangedEventArgs e)
        {
            if (e.PropertyName == nameof(Model_ReceivingLoad.IsSelected))
            {
                RemoveRowCommand.NotifyCanExecuteChanged();
            }
        }

        /// &lt;summary&gt;
        /// Notifies that command execution status has changed.
        /// &lt;/summary&gt;
        private void NotifyCommands()
        {
            SaveCommand.NotifyCanExecuteChanged();
            RemoveRowCommand.NotifyCanExecuteChanged();
            SelectAllCommand.NotifyCanExecuteChanged();
        }

        /// &lt;summary&gt;
        /// Handles changes to the filter start date.
        /// &lt;/summary&gt;
        partial void OnFilterStartDateChanged(DateTimeOffset value) =&gt; ApplyDateFilter();

        /// &lt;summary&gt;
        /// Handles changes to the filter end date.
        /// &lt;/summary&gt;
        partial void OnFilterEndDateChanged(DateTimeOffset value) =&gt; ApplyDateFilter();

        /// &lt;summary&gt;
        /// Applies the date filter to the loaded data.
        /// &lt;/summary&gt;
        private void ApplyDateFilter()
        {
            if (_allLoads.Count == 0)
            {
                return;
            }

            FilterAndPaginate();
        }

        /// &lt;summary&gt;
        /// Filters the master list and updates pagination.
        /// &lt;/summary&gt;
        private void FilterAndPaginate()
        {
            var start = FilterStartDate.Date;
            var end = FilterEndDate.Date.AddDays(1).AddTicks(-1);

            if (CurrentDataSource == Enum_DataSourceType.History)
            {
                _filteredLoads = _allLoads.Where(l =&gt; l.ReceivedDate &gt;= start &amp;&amp; l.ReceivedDate &lt;= end).ToList();
            }
            else
            {
                _filteredLoads = _allLoads.Where(l =&gt; l.ReceivedDate &gt;= start &amp;&amp; l.ReceivedDate &lt;= end).ToList();
            }

            _paginationService.SetSource(_filteredLoads);
        }

        /// &lt;summary&gt;
        /// Sets the date filter to the last 7 days.
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task SetFilterLastWeekAsync()
        {
            FilterStartDate = DateTime.Today.AddDays(-7);
            FilterEndDate = DateTime.Today;
            if (CurrentDataSource == Enum_DataSourceType.History)
            {
                await LoadFromHistoryAsync();
            }
            else
            {
                FilterAndPaginate();
            }
        }

        /// &lt;summary&gt;
        /// Sets the date filter to today.
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task SetFilterTodayAsync()
        {
            FilterStartDate = DateTime.Today;
            FilterEndDate = DateTime.Today;
            if (CurrentDataSource == Enum_DataSourceType.History)
            {
                await LoadFromHistoryAsync();
            }
            else
            {
                FilterAndPaginate();
            }
        }

        /// &lt;summary&gt;
        /// Sets the date filter to the current week.
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task SetFilterThisWeekAsync()
        {
            var today = DateTime.Today;
            var start = today.AddDays(-(int)today.DayOfWeek);
            var end = start.AddDays(6);
            FilterStartDate = start;
            FilterEndDate = end;
            if (CurrentDataSource == Enum_DataSourceType.History)
            {
                await LoadFromHistoryAsync();
            }
            else
            {
                FilterAndPaginate();
            }
        }

        /// &lt;summary&gt;
        /// Sets the date filter to the current month.
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task SetFilterThisMonthAsync()
        {
            var today = DateTime.Today;
            FilterStartDate = new DateTime(today.Year, today.Month, 1);
            FilterEndDate = FilterStartDate.AddMonths(1).AddDays(-1);
            if (CurrentDataSource == Enum_DataSourceType.History)
            {
                await LoadFromHistoryAsync();
            }
            else
            {
                FilterAndPaginate();
            }
        }

        /// &lt;summary&gt;
        /// Sets the date filter to the current quarter.
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task SetFilterThisQuarterAsync()
        {
            var today = DateTime.Today;
            int quarter = (today.Month - 1) / 3 + 1;
            FilterStartDate = new DateTime(today.Year, 3 * quarter - 2, 1);
            FilterEndDate = FilterStartDate.AddMonths(3).AddDays(-1);
            if (CurrentDataSource == Enum_DataSourceType.History)
            {
                await LoadFromHistoryAsync();
            }
            else
            {
                FilterAndPaginate();
            }
        }

        /// &lt;summary&gt;
        /// Sets the date filter to show all records (last year).
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task SetFilterShowAllAsync()
        {
            FilterStartDate = DateTime.Today.AddYears(-1);
            FilterEndDate = DateTime.Today;
            if (CurrentDataSource == Enum_DataSourceType.History)
            {
                await LoadFromHistoryAsync();
            }
            else
            {
                FilterAndPaginate();
            }
        }

        /// &lt;summary&gt;
        /// Navigates to the previous page.
        /// &lt;/summary&gt;
        [RelayCommand(CanExecute = nameof(CanGoPrevious))]
        private void PreviousPage() =&gt; _paginationService.PreviousPage();

        /// &lt;summary&gt;
        /// Navigates to the next page.
        /// &lt;/summary&gt;
        [RelayCommand(CanExecute = nameof(CanGoNext))]
        private void NextPage() =&gt; _paginationService.NextPage();

        /// &lt;summary&gt;
        /// Navigates to the first page.
        /// &lt;/summary&gt;
        [RelayCommand(CanExecute = nameof(CanGoPrevious))]
        private void FirstPage() =&gt; _paginationService.FirstPage();

        /// &lt;summary&gt;
        /// Navigates to the last page.
        /// &lt;/summary&gt;
        [RelayCommand(CanExecute = nameof(CanGoNext))]
        private void LastPage() =&gt; _paginationService.LastPage();

        /// &lt;summary&gt;
        /// Navigates to a specific page number.
        /// &lt;/summary&gt;
        [RelayCommand]
        private void GoToPage() =&gt; _paginationService.GoToPage(GotoPageNumber);

        /// &lt;summary&gt;
        /// Determines if navigation to the next page is possible.
        /// &lt;/summary&gt;
        private bool CanGoNext() =&gt; _paginationService.HasNextPage;

        /// &lt;summary&gt;
        /// Determines if navigation to the previous page is possible.
        /// &lt;/summary&gt;
        private bool CanGoPrevious() =&gt; _paginationService.HasPreviousPage;

        /// &lt;summary&gt;
        /// Loads data from the current in-memory session.
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task LoadFromCurrentMemoryAsync()
        {
            try
            {
                _logger.LogInfo(&quot;Loading data from current memory&quot;);
                IsBusy = true;
                StatusMessage = &quot;Loading from current session...&quot;;
                _deletedLoads.Clear();

                var currentLoads = _workflowService.CurrentSession.Loads;
                if (currentLoads.Count == 0)
                {
                    await _errorHandler.HandleErrorAsync(
                        &quot;No data in current session. Please use Manual Entry mode to create new loads.&quot;,
                        Enum_ErrorSeverity.Warning);
                    return;
                }

                _allLoads.Clear();
                foreach (var load in currentLoads)
                {
                    _allLoads.Add(load);
                }

                StatusMessage = $&quot;Loaded {_allLoads.Count} loads from current session&quot;;
                _logger.LogInfo($&quot;Successfully loaded {_allLoads.Count} loads from current memory&quot;);
                CurrentDataSource = Enum_DataSourceType.Memory;
                SelectAllButtonText = &quot;Select All&quot;;

                FilterStartDate = DateTimeOffset.Now.AddYears(-1);
                FilterEndDate = DateTimeOffset.Now;

                FilterAndPaginate();
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Failed to load from current memory: {ex.Message}&quot;);
                await _errorHandler.HandleErrorAsync(&quot;Failed to load data from current session&quot;, Enum_ErrorSeverity.Error, ex);
            }
            finally
            {
                IsBusy = false;
            }
        }

        /// &lt;summary&gt;
        /// Loads data from current label CSV files.
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task LoadFromCurrentLabelsAsync()
        {
            try
            {
                _logger.LogInfo(&quot;User initiated Current Labels (CSV) load&quot;);
                IsBusy = true;
                StatusMessage = &quot;Checking for existing label files...&quot;;

                if (await TryLoadFromDefaultCsvAsync())
                {
                    return;
                }

                await _errorHandler.ShowErrorDialogAsync(
                    &quot;No Labels Found&quot;,
                    &quot;Could not find any current label files in the default locations.&quot;,
                    Enum_ErrorSeverity.Warning);
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Failed to load from labels: {ex.Message}&quot;);
                await _errorHandler.HandleErrorAsync(&quot;Failed to load data from label file&quot;, Enum_ErrorSeverity.Error, ex);
            }
            finally
            {
                IsBusy = false;
            }
        }

        /// &lt;summary&gt;
        /// Attempts to load data from default CSV locations (local or network).
        /// &lt;/summary&gt;
        private async Task&lt;bool&gt; TryLoadFromDefaultCsvAsync()
        {
            string localPath = _csvWriter.GetLocalCSVPath();
            if (File.Exists(localPath))
            {
                try
                {
                    _logger.LogInfo($&quot;Attempting to load from local CSV: {localPath}&quot;);
                    var loadedData = await _csvWriter.ReadFromCSVAsync(localPath);

                    if (loadedData.Count &gt; 0)
                    {
                        _deletedLoads.Clear();
                        _allLoads.Clear();
                        foreach (var load in loadedData)
                        {
                            _allLoads.Add(load);
                            _workflowService.CurrentSession.Loads.Add(load);
                        }
                        StatusMessage = $&quot;Loaded {_allLoads.Count} loads from local labels&quot;;
                        _logger.LogInfo($&quot;Successfully loaded {_allLoads.Count} loads from local labels&quot;);
                        CurrentDataSource = Enum_DataSourceType.CurrentLabels;
                        _currentCsvPath = localPath;
                        SelectAllButtonText = &quot;Select All&quot;;

                        FilterStartDate = DateTimeOffset.Now.AddYears(-1);
                        FilterEndDate = DateTimeOffset.Now;

                        FilterAndPaginate();
                        return true;
                    }
                }
                catch (Exception ex)
                {
                    _logger.LogWarning($&quot;Failed to load from local labels: {ex.Message}&quot;);
                }
            }

            try
            {
                string networkPath = _csvWriter.GetNetworkCSVPath();
                if (File.Exists(networkPath))
                {
                    _logger.LogInfo($&quot;Attempting to load from network labels: {networkPath}&quot;);
                    var loadedData = await _csvWriter.ReadFromCSVAsync(networkPath);

                    if (loadedData.Count &gt; 0)
                    {
                        _deletedLoads.Clear();
                        _allLoads.Clear();
                        foreach (var load in loadedData)
                        {
                            _allLoads.Add(load);
                            _workflowService.CurrentSession.Loads.Add(load);
                        }
                        StatusMessage = $&quot;Loaded {_allLoads.Count} loads from network labels&quot;;
                        _logger.LogInfo($&quot;Successfully loaded {_allLoads.Count} loads from network labels&quot;);
                        CurrentDataSource = Enum_DataSourceType.CurrentLabels;
                        _currentCsvPath = networkPath;
                        SelectAllButtonText = &quot;Select All&quot;;

                        FilterStartDate = DateTimeOffset.Now.AddYears(-1);
                        FilterEndDate = DateTimeOffset.Now;

                        FilterAndPaginate();
                        return true;
                    }
                }
            }
            catch (Exception ex)
            {
                _logger.LogWarning($&quot;Failed to load from network labels: {ex.Message}&quot;);
            }

            return false;
        }

        /// &lt;summary&gt;
        /// Loads historical data from the database.
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task LoadFromHistoryAsync()
        {
            try
            {
                _logger.LogInfo(&quot;User initiated history load&quot;);
                IsBusy = true;
                StatusMessage = &quot;Loading from history...&quot;;

                var startDate = FilterStartDate.Date;
                var endDate = FilterEndDate.Date;

                _logger.LogInfo($&quot;Loading receiving history from {startDate:yyyy-MM-dd} to {endDate:yyyy-MM-dd}&quot;);
                var result = await _mysqlService.GetAllReceivingLoadsAsync(startDate, endDate);

                if (!result.IsSuccess)
                {
                    await _errorHandler.HandleErrorAsync(
                        $&quot;Failed to load from history: {result.ErrorMessage}&quot;,
                        Enum_ErrorSeverity.Error);
                    return;
                }

                if (result.Data == null || result.Data.Count == 0)
                {
                    await _errorHandler.HandleErrorAsync(
                        &quot;No receiving records found in the specified date range.&quot;,
                        Enum_ErrorSeverity.Warning);
                    return;
                }

                _deletedLoads.Clear();
                _allLoads.Clear();
                foreach (var load in result.Data)
                {
                    _allLoads.Add(load);
                    _workflowService.CurrentSession.Loads.Add(load);
                }

                StatusMessage = $&quot;Loaded {_allLoads.Count} loads from history&quot;;
                _logger.LogInfo($&quot;Successfully loaded {_allLoads.Count} loads from history&quot;);
                CurrentDataSource = Enum_DataSourceType.History;
                SelectAllButtonText = &quot;Select All&quot;;

                FilterAndPaginate();
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Failed to load from history: {ex.Message}&quot;);
                await _errorHandler.HandleErrorAsync(&quot;Failed to load data from history&quot;, Enum_ErrorSeverity.Error, ex);
            }
            finally
            {
                IsBusy = false;
            }
        }

        /// &lt;summary&gt;
        /// Selects or deselects all currently displayed loads.
        /// &lt;/summary&gt;
        [RelayCommand(CanExecute = nameof(CanSelectAll))]
        private void SelectAll()
        {
            bool anyUnselected = Loads.Any(l =&gt; !l.IsSelected);

            if (anyUnselected)
            {
                foreach (var load in Loads)
                {
                    load.IsSelected = true;
                }

                SelectAllButtonText = &quot;Deselect All&quot;;
            }
            else
            {
                foreach (var load in Loads)
                {
                    load.IsSelected = false;
                }

                SelectAllButtonText = &quot;Select All&quot;;
            }
        }

        /// &lt;summary&gt;
        /// Determines if the Select All command can be executed.
        /// &lt;/summary&gt;
        private bool CanSelectAll() =&gt; Loads.Count &gt; 0;

        /// &lt;summary&gt;
        /// Removes the selected row(s) from the collection.
        /// &lt;/summary&gt;
        [RelayCommand(CanExecute = nameof(CanRemoveRow))]
        private void RemoveRow()
        {
            var selectedLoads = Loads.Where(l =&gt; l.IsSelected).ToList();

            if (selectedLoads.Count &gt; 0)
            {
                _logger.LogInfo($&quot;Removing {selectedLoads.Count} selected loads&quot;);
                foreach (var load in selectedLoads)
                {
                    _deletedLoads.Add(load);
                    _workflowService.CurrentSession.Loads.Remove(load);
                    _allLoads.Remove(load);
                    _filteredLoads.Remove(load);
                    Loads.Remove(load);
                }

                FilterAndPaginate();
            }
            else if (SelectedLoad != null)
            {
                _logger.LogInfo($&quot;Removing load {SelectedLoad.LoadNumber} (Part ID: {SelectedLoad.PartID})&quot;);
                _deletedLoads.Add(SelectedLoad);
                _workflowService.CurrentSession.Loads.Remove(SelectedLoad);
                _allLoads.Remove(SelectedLoad);
                _filteredLoads.Remove(SelectedLoad);
                Loads.Remove(SelectedLoad);

                FilterAndPaginate();
            }
            else
            {
                _logger.LogWarning(&quot;RemoveRow called with no selected load(s)&quot;);
            }
            SaveCommand.NotifyCanExecuteChanged();
        }

        /// &lt;summary&gt;
        /// Determines if the Remove Row command can be executed.
        /// &lt;/summary&gt;
        private bool CanRemoveRow() =&gt; Loads.Any(l =&gt; l.IsSelected);

        /// &lt;summary&gt;
        /// Saves the changes made to the loads.
        /// &lt;/summary&gt;
        [RelayCommand(CanExecute = nameof(CanSave))]
        private async Task SaveAsync()
        {
            try
            {
                _logger.LogInfo($&quot;Validating and saving {_filteredLoads.Count} loads from edit mode&quot;);
                IsBusy = true;
                StatusMessage = &quot;Validating loads...&quot;;

                // Set default Heat/Lot if empty for all loads being processed
                // We update _allLoads to ensure consistency across all data sources
                foreach (var load in _allLoads)
                {
                    if (string.IsNullOrWhiteSpace(load.HeatLotNumber))
                    {
                        load.HeatLotNumber = &quot;Nothing Entered&quot;;
                    }
                }

                var validationErrors = ValidateLoads(_filteredLoads);
                if (validationErrors.Count &gt; 0)
                {
                    var errorMessage = string.Join(&quot;\n&quot;, validationErrors);
                    _logger.LogWarning($&quot;Edit mode validation failed: {validationErrors.Count} errors&quot;);
                    await _errorHandler.HandleErrorAsync(
                        $&quot;Validation failed:\n{errorMessage}&quot;,
                        Enum_ErrorSeverity.Warning);
                    return;
                }

                StatusMessage = &quot;Saving data...&quot;;

                switch (CurrentDataSource)
                {
                    case Enum_DataSourceType.Memory:
                        await _workflowService.AdvanceToNextStepAsync();
                        break;

                    case Enum_DataSourceType.CurrentLabels:
                        if (string.IsNullOrEmpty(_currentCsvPath))
                        {
                            await _errorHandler.HandleErrorAsync(&quot;No label file path available for saving.&quot;, Enum_ErrorSeverity.Error);
                            return;
                        }

                        _logger.LogInfo($&quot;Overwriting label file: {_currentCsvPath}&quot;);
                        await _csvWriter.WriteToFileAsync(_currentCsvPath, _allLoads, append: false);
                        StatusMessage = &quot;Label file updated successfully&quot;;
                        await _errorHandler.ShowErrorDialogAsync(&quot;Success&quot;, &quot;Label file updated successfully.&quot;, Enum_ErrorSeverity.Info);
                        break;

                    case Enum_DataSourceType.History:
                        _logger.LogInfo(&quot;Updating history records&quot;);
                        int deleted = 0;
                        if (_deletedLoads.Count &gt; 0)
                        {
                            _logger.LogInfo($&quot;Deleting {_deletedLoads.Count} removed records&quot;);
                            deleted = await _mysqlService.DeleteReceivingLoadsAsync(_deletedLoads);
                        }

                        int updated = 0;
                        if (_filteredLoads.Count &gt; 0)
                        {
                            updated = await _mysqlService.UpdateReceivingLoadsAsync(_filteredLoads);
                        }

                        StatusMessage = $&quot;History updated ({updated} updated, {deleted} deleted)&quot;;
                        await _errorHandler.ShowErrorDialogAsync(&quot;Success&quot;, $&quot;History updated successfully.\n{updated} records updated.\n{deleted} records deleted.&quot;, Enum_ErrorSeverity.Info);
                        break;
                }

                _logger.LogInfo($&quot;Edit mode save completed successfully for source: {CurrentDataSource}&quot;);
                _deletedLoads.Clear();
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Failed to save edit mode data: {ex.Message}&quot;);
                await _errorHandler.HandleErrorAsync(&quot;Failed to save receiving data&quot;, Enum_ErrorSeverity.Critical, ex);
            }
            finally
            {
                IsBusy = false;
            }
        }

        /// &lt;summary&gt;
        /// Determines if the Save command can be executed.
        /// &lt;/summary&gt;
        private bool CanSave()
        {
            return _filteredLoads.Count &gt; 0 || _deletedLoads.Count &gt; 0;
        }

        /// &lt;summary&gt;
        /// Returns to the mode selection screen after confirmation.
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task ReturnToModeSelectionAsync()
        {
            var xamlRoot = _windowService.GetXamlRoot();
            if (xamlRoot == null)
            {
                _logger.LogError(&quot;Cannot show dialog: XamlRoot is null&quot;);
                await _errorHandler.HandleErrorAsync(&quot;Unable to display dialog&quot;, Enum_ErrorSeverity.Error);
                return;
            }

            var dialog = new Microsoft.UI.Xaml.Controls.ContentDialog
            {
                Title = &quot;Change Mode?&quot;,
                Content = &quot;Returning to mode selection will clear all current work in progress. This cannot be undone. Are you sure?&quot;,
                PrimaryButtonText = &quot;Yes, Change Mode&quot;,
                CloseButtonText = &quot;Cancel&quot;,
                DefaultButton = Microsoft.UI.Xaml.Controls.ContentDialogButton.Close,
                XamlRoot = xamlRoot
            };

            var result = await dialog.ShowAsync().AsTask();
            if (result == Microsoft.UI.Xaml.Controls.ContentDialogResult.Primary)
            {
                try
                {
                    _logger.LogInfo(&quot;User confirmed return to mode selection, resetting workflow&quot;);
                    await _workflowService.ResetWorkflowAsync();
                    _workflowService.GoToStep(Enum_ReceivingWorkflowStep.ModeSelection);
                }
                catch (Exception ex)
                {
                    _logger.LogError($&quot;Failed to reset workflow: {ex.Message}&quot;);
                    await _errorHandler.HandleErrorAsync(&quot;Failed to return to mode selection&quot;, Enum_ErrorSeverity.Error, ex);
                }
            }
            else
            {
                _logger.LogInfo(&quot;User cancelled return to mode selection&quot;);
            }
        }

        /// &lt;summary&gt;
        /// Validates the list of loads before saving.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;loadsToValidate&quot;&gt;&lt;/param&gt;
        private System.Collections.Generic.List&lt;string&gt; ValidateLoads(IEnumerable&lt;Model_ReceivingLoad&gt; loadsToValidate)
        {
            var errors = new System.Collections.Generic.List&lt;string&gt;();

            if (!loadsToValidate.Any() &amp;&amp; _deletedLoads.Count == 0)
            {
                errors.Add(&quot;No loads to save&quot;);
                return errors;
            }

            foreach (var load in loadsToValidate)
            {
                if (string.IsNullOrWhiteSpace(load.PartID))
                {
                    errors.Add($&quot;Load #{load.LoadNumber}: Part ID is required&quot;);
                }

                if (load.WeightQuantity &lt;= 0)
                {
                    errors.Add($&quot;Load #{load.LoadNumber}: Weight/Quantity must be greater than zero&quot;);
                }

                if (load.PackagesPerLoad &lt;= 0)
                {
                    errors.Add($&quot;Load #{load.LoadNumber}: Packages per load must be greater than zero&quot;);
                }
            }

            return errors;
        }

        /// &lt;summary&gt;
        /// Shows contextual help for edit mode
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task ShowHelpAsync()
        {
            await _helpService.ShowHelpAsync(&quot;Receiving.EditMode&quot;);
        }

        #region Help Content Helpers

        public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);
        public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);
        public string GetTip(string key) =&gt; _helpService.GetTip(key);

        #endregion
    }
}</file><file path="Module_Receiving/ViewModels/ViewModel_Receiving_ManualEntry.cs">using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Receiving.ViewModels
{
    public partial class ViewModel_Receiving_ManualEntry : ViewModel_Shared_Base
    {
        private readonly IService_ReceivingWorkflow _workflowService;
        private readonly IService_MySQL_Receiving _mysqlService;
        private readonly IService_Window _windowService;
        private readonly IService_Help _helpService;

        [ObservableProperty]
        private ObservableCollection&lt;Model_ReceivingLoad&gt; _loads;

        [ObservableProperty]
        private Model_ReceivingLoad? _selectedLoad;

        public ObservableCollection&lt;Enum_PackageType&gt; PackageTypes { get; } = new(Enum.GetValues&lt;Enum_PackageType&gt;());

        public ViewModel_Receiving_ManualEntry(
            IService_ReceivingWorkflow workflowService,
            IService_MySQL_Receiving mysqlService,
            IService_ErrorHandler errorHandler,
            IService_LoggingUtility logger,
            IService_Window windowService,
            IService_Help helpService)
            : base(errorHandler, logger)
        {
            _windowService = windowService;
            _workflowService = workflowService;
            _mysqlService = mysqlService;
            _helpService = helpService;
            _loads = new ObservableCollection&lt;Model_ReceivingLoad&gt;(_workflowService.CurrentSession.Loads);
        }

        [RelayCommand]
        private async Task AutoFillAsync()
        {
            try
            {
                IsBusy = true;
                StatusMessage = &quot;Filling blank spaces...&quot;;
                _logger.LogInfo(&quot;Starting Auto-Fill Blank Spaces operation&quot;);

                int filledCount = 0;

                // Iterate through all loads in the grid
                for (int i = 0; i &lt; Loads.Count; i++)
                {
                    var currentLoad = Loads[i];

                    // 1. Part ID (Material ID) - Fill Down Logic
                    // If blank, copy from immediate predecessor
                    if (string.IsNullOrWhiteSpace(currentLoad.PartID))
                    {
                        if (i &gt; 0)
                        {
                            var prev = Loads[i - 1];
                            if (!string.IsNullOrWhiteSpace(prev.PartID))
                            {
                                currentLoad.PartID = prev.PartID;
                                filledCount++;
                            }
                        }
                    }

                    // 2. Other Fields - Copy from nearest previous row with SAME PartID
                    if (!string.IsNullOrWhiteSpace(currentLoad.PartID))
                    {
                        // Find source load (nearest previous row with same PartID)
                        Model_ReceivingLoad? sourceLoad = null;
                        for (int j = i - 1; j &gt;= 0; j--)
                        {
                            if (Loads[j].PartID == currentLoad.PartID)
                            {
                                sourceLoad = Loads[j];
                                break;
                            }
                        }

                        if (sourceLoad != null)
                        {
                            // PO Number: If blank, use PO from previous row with same Material ID
                            if (string.IsNullOrWhiteSpace(currentLoad.PoNumber) &amp;&amp; !string.IsNullOrWhiteSpace(sourceLoad.PoNumber))
                            {
                                currentLoad.PoNumber = sourceLoad.PoNumber;
                                filledCount++;
                            }

                            // Quantity: If blank (0), use Quantity from previous row with same Material ID
                            if (currentLoad.WeightQuantity &lt;= 0 &amp;&amp; sourceLoad.WeightQuantity &gt; 0)
                            {
                                currentLoad.WeightQuantity = sourceLoad.WeightQuantity;
                                filledCount++;
                            }

                            // Heat: If blank, use Heat from previous row with same Material ID
                            if (string.IsNullOrWhiteSpace(currentLoad.HeatLotNumber) &amp;&amp; !string.IsNullOrWhiteSpace(sourceLoad.HeatLotNumber))
                            {
                                currentLoad.HeatLotNumber = sourceLoad.HeatLotNumber;
                                filledCount++;
                            }

                            // Also copy other useful fields if blank, consistent with &quot;same material&quot; logic
                            if (currentLoad.PackagesPerLoad &lt;= 0 &amp;&amp; sourceLoad.PackagesPerLoad &gt; 0)
                            {
                                currentLoad.PackagesPerLoad = sourceLoad.PackagesPerLoad;
                            }

                            if (string.IsNullOrWhiteSpace(currentLoad.PackageTypeName) &amp;&amp; !string.IsNullOrWhiteSpace(sourceLoad.PackageTypeName))
                            {
                                currentLoad.PackageTypeName = sourceLoad.PackageTypeName;
                            }
                        }
                    }

                    // Date: If blank (default/min value), use current date
                    // Note: Model_ReceivingLoad initializes ReceivedDate to DateTime.Now usually, but let&apos;s ensure it.
                    if (currentLoad.ReceivedDate == default || currentLoad.ReceivedDate == DateTime.MinValue)
                    {
                        currentLoad.ReceivedDate = DateTime.Now;
                    }

                    // Employee: If blank, use employee from first row
                    // Assuming &quot;Employee&quot; maps to UserId or similar. 
                    // Model_ReceivingLoad has UserId.
                    if (string.IsNullOrWhiteSpace(currentLoad.UserId))
                    {
                        // Try previous row first (propagation)
                        if (i &gt; 0 &amp;&amp; !string.IsNullOrWhiteSpace(Loads[i - 1].UserId))
                        {
                            currentLoad.UserId = Loads[i - 1].UserId;
                        }
                        else if (Loads.Count &gt; 0 &amp;&amp; !string.IsNullOrWhiteSpace(Loads[0].UserId))
                        {
                            currentLoad.UserId = Loads[0].UserId;
                        }
                        // If first row is also blank, maybe use current session user?
                        else if (_workflowService.CurrentSession.User != null)
                        {
                            currentLoad.UserId = _workflowService.CurrentSession.User.WindowsUsername;
                        }
                    }
                }

                StatusMessage = $&quot;Auto-fill complete. Updated {filledCount} fields.&quot;;
                _logger.LogInfo($&quot;Auto-Fill Blank Spaces completed. Updated {filledCount} fields across {Loads.Count} rows.&quot;);

                // Force UI update if needed (ObservableCollection updates properties automatically if INPC is fired)
                // Model_ReceivingLoad implements ObservableObject so it should be fine.
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Auto-fill failed: {ex.Message}&quot;);
                await _errorHandler.HandleErrorAsync(&quot;Auto-fill failed&quot;, Enum_ErrorSeverity.Error, ex);
            }
            finally
            {
                IsBusy = false;
            }
        }

        [RelayCommand]
        private void AddRow()
        {
            AddNewLoad();
        }

        [RelayCommand]
        private async Task AddMultipleRowsAsync()
        {
            // Prompt for number of rows
            var xamlRoot = _windowService.GetXamlRoot();
            if (xamlRoot == null)
            {
                return;
            }

            var inputTextBox = new Microsoft.UI.Xaml.Controls.TextBox
            {
                PlaceholderText = &quot;Enter number of rows (1-50)&quot;,
                InputScope = new Microsoft.UI.Xaml.Input.InputScope
                {
                    Names = { new Microsoft.UI.Xaml.Input.InputScopeName(Microsoft.UI.Xaml.Input.InputScopeNameValue.Number) }
                }
            };

            var dialog = new Microsoft.UI.Xaml.Controls.ContentDialog
            {
                Title = &quot;Add Multiple Rows&quot;,
                Content = inputTextBox,
                PrimaryButtonText = &quot;Add&quot;,
                CloseButtonText = &quot;Cancel&quot;,
                DefaultButton = Microsoft.UI.Xaml.Controls.ContentDialogButton.Primary,
                XamlRoot = xamlRoot
            };

            var result = await dialog.ShowAsync();
            if (result == Microsoft.UI.Xaml.Controls.ContentDialogResult.Primary)
            {
                if (int.TryParse(inputTextBox.Text, out int count) &amp;&amp; count &gt; 0 &amp;&amp; count &lt;= 50)
                {
                    _logger.LogInfo($&quot;Adding {count} new rows to manual entry grid&quot;);
                    for (int i = 0; i &lt; count; i++)
                    {
                        AddNewLoad();
                    }
                }
                else
                {
                    _logger.LogWarning($&quot;Invalid row count entered: {inputTextBox.Text}&quot;);
                    await _errorHandler.HandleErrorAsync(&quot;Please enter a valid number between 1 and 50.&quot;, Enum_ErrorSeverity.Warning);
                }
            }
        }

        public void AddNewLoad()
        {
            var newLoad = new Model_ReceivingLoad
            {
                LoadID = System.Guid.NewGuid(),
                ReceivedDate = System.DateTime.Now,
                LoadNumber = Loads.Count + 1
            };
            Loads.Add(newLoad);
            _workflowService.CurrentSession.Loads.Add(newLoad);

            // Select the new load
            SelectedLoad = newLoad;
        }

        [RelayCommand]
        private void RemoveRow()
        {
            if (SelectedLoad != null)
            {
                _logger.LogInfo($&quot;Removing load {SelectedLoad.LoadNumber} (Part ID: {SelectedLoad.PartID})&quot;);
                _workflowService.CurrentSession.Loads.Remove(SelectedLoad);
                Loads.Remove(SelectedLoad);
            }
            else
            {
                _logger.LogWarning(&quot;RemoveRow called with no selected load&quot;);
            }
        }

        [RelayCommand]
        private async Task SaveAsync()
        {
            try
            {
                _logger.LogInfo($&quot;Saving {Loads.Count} loads from manual entry&quot;);

                // Set default Heat/Lot if empty
                foreach (var load in Loads)
                {
                    if (string.IsNullOrWhiteSpace(load.HeatLotNumber))
                    {
                        load.HeatLotNumber = &quot;Nothing Entered&quot;;
                    }
                }

                // In manual mode, we skip step-by-step validation and go straight to saving
                // The workflow service will handle the actual save logic
                await _workflowService.AdvanceToNextStepAsync();
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Failed to save manual entry data: {ex.Message}&quot;);
                await _errorHandler.HandleErrorAsync(&quot;Failed to save receiving data&quot;, Enum_ErrorSeverity.Critical, ex);
            }
        }

        [RelayCommand]
        private async Task ReturnToModeSelectionAsync()
        {
            var xamlRoot = _windowService.GetXamlRoot();
            if (xamlRoot == null)
            {
                _logger.LogError(&quot;Cannot show dialog: XamlRoot is null&quot;);
                await _errorHandler.HandleErrorAsync(&quot;Unable to display dialog&quot;, Enum_ErrorSeverity.Error);
                return;
            }

            var dialog = new Microsoft.UI.Xaml.Controls.ContentDialog
            {
                Title = &quot;Change Mode?&quot;,
                Content = &quot;Returning to mode selection will clear all current work in progress. This cannot be undone. Are you sure?&quot;,
                PrimaryButtonText = &quot;Yes, Change Mode&quot;,
                CloseButtonText = &quot;Cancel&quot;,
                DefaultButton = Microsoft.UI.Xaml.Controls.ContentDialogButton.Close,
                XamlRoot = xamlRoot
            };

            var result = await dialog.ShowAsync().AsTask();
            if (result == Microsoft.UI.Xaml.Controls.ContentDialogResult.Primary)
            {
                try
                {
                    _logger.LogInfo(&quot;User confirmed return to mode selection, resetting workflow&quot;);
                    // Reset workflow and return to mode selection
                    await _workflowService.ResetWorkflowAsync();
                    _workflowService.GoToStep(Enum_ReceivingWorkflowStep.ModeSelection);
                    // The ReceivingWorkflowViewModel will handle the visibility update through StepChanged event
                }
                catch (Exception ex)
                {
                    _logger.LogError($&quot;Failed to reset workflow: {ex.Message}&quot;);
                    await _errorHandler.HandleErrorAsync(&quot;Failed to return to mode selection&quot;, Enum_ErrorSeverity.Error, ex);
                }
            }
            else
            {
                _logger.LogInfo(&quot;User cancelled return to mode selection&quot;);
            }
        }

        /// &lt;summary&gt;
        /// Shows contextual help for manual entry
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task ShowHelpAsync()
        {
            await _helpService.ShowHelpAsync(&quot;Receiving.ManualEntry&quot;);
        }

        #region Help Content Helpers

        public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);
        public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);
        public string GetTip(string key) =&gt; _helpService.GetTip(key);

        #endregion
    }
}</file><file path="Module_Receiving/ViewModels/ViewModel_Receiving_PackageType.cs">using System;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using System.Collections.ObjectModel;
using System.Threading.Tasks;
using System.Linq;

namespace MTM_Receiving_Application.Module_Receiving.ViewModels
{
    public partial class ViewModel_Receiving_PackageType : ViewModel_Shared_Base
    {
        private readonly IService_ReceivingWorkflow _workflowService;
        private readonly IService_MySQL_PackagePreferences _preferencesService;
        private readonly IService_ReceivingValidation _validationService;
        private readonly IService_Help _helpService;

        [ObservableProperty]
        private ObservableCollection&lt;Model_ReceivingLoad&gt; _loads = new();

        [ObservableProperty]
        private ObservableCollection&lt;string&gt; _packageTypes = new() { &quot;Coils&quot;, &quot;Sheets&quot;, &quot;Skids&quot;, &quot;Custom&quot; };

        [ObservableProperty]
        private string _selectedPackageType = string.Empty;

        [ObservableProperty]
        private string _customPackageTypeName = string.Empty;

        [ObservableProperty]
        private bool _isCustomTypeVisible;

        [ObservableProperty]
        private bool _isSaveAsDefault;
        private static readonly System.Text.RegularExpressions.Regex _regex = new System.Text.RegularExpressions.Regex(@&quot;^[\w\s\-\.\(\)]+$&quot;);

        public ViewModel_Receiving_PackageType(
            IService_ReceivingWorkflow workflowService,
            IService_MySQL_PackagePreferences preferencesService,
            IService_ReceivingValidation validationService,
            IService_Help helpService,
            IService_ErrorHandler errorHandler,
            IService_LoggingUtility logger)
            : base(errorHandler, logger)
        {
            _workflowService = workflowService;
            _preferencesService = preferencesService;
            _validationService = validationService;
            _helpService = helpService;

            _workflowService.StepChanged += OnStepChanged;
        }

        private void OnStepChanged(object? sender, System.EventArgs e)
        {
            if (_workflowService.CurrentStep == Enum_ReceivingWorkflowStep.PackageTypeEntry)
            {
                _ = OnNavigatedToAsync();
            }
        }

        public async Task OnNavigatedToAsync()
        {
            Loads.Clear();
            if (_workflowService.CurrentSession?.Loads != null)
            {
                foreach (var load in _workflowService.CurrentSession.Loads)
                {
                    Loads.Add(load);
                }
            }

            await LoadPreferencesAsync();
        }

        private async Task LoadPreferencesAsync()
        {
            var partId = _workflowService.CurrentPart?.PartID;
            if (string.IsNullOrEmpty(partId))
            {
                return;
            }

            // Try to load from DB
            var preference = await _preferencesService.GetPreferenceAsync(partId);
            if (preference != null)
            {
                // Apply saved preference
                if (PackageTypes.Contains(preference.PackageTypeName))
                {
                    SelectedPackageType = preference.PackageTypeName;
                }
                else
                {
                    SelectedPackageType = &quot;Custom&quot;;
                    CustomPackageTypeName = preference.PackageTypeName;
                }
            }
            else
            {
                // Apply smart defaults based on PartID prefix
                var partID = _workflowService.CurrentPart?.PartID ?? string.Empty;
                if (partID.StartsWith(&quot;MMC&quot;, StringComparison.OrdinalIgnoreCase))
                {
                    SelectedPackageType = &quot;Coils&quot;;
                    _logger?.LogInfo($&quot;Auto-set package type to Coils for part {partID}&quot;);
                }
                else if (partID.StartsWith(&quot;MMF&quot;, StringComparison.OrdinalIgnoreCase))
                {
                    SelectedPackageType = &quot;Sheets&quot;;
                    _logger?.LogInfo($&quot;Auto-set package type to Sheets for part {partID}&quot;);
                }
                else
                {
                    SelectedPackageType = &quot;Skids&quot;; // Default fallback
                    _logger?.LogInfo($&quot;Auto-set package type to Skids (default) for part {partID}&quot;);
                }
            }
        }

        partial void OnSelectedPackageTypeChanged(string value)
        {
            IsCustomTypeVisible = value == &quot;Custom&quot;;
            UpdateLoadsPackageType();
            if (IsSaveAsDefault)
                SavePreferenceAsync().ConfigureAwait(false);
        }

        partial void OnCustomPackageTypeNameChanged(string value)
        {
            if (SelectedPackageType == &quot;Custom&quot;)
            {
                UpdateLoadsPackageType();
                if (IsSaveAsDefault)
                    SavePreferenceAsync().ConfigureAwait(false);
            }
        }

        partial void OnIsSaveAsDefaultChanged(bool value)
        {
            if (value)
            {
                SavePreferenceAsync().ConfigureAwait(false);
            }
            else
            {
                // Optional: Delete preference if unchecked?
                // For now, we just don&apos;t update it.
                // Or we could delete it.
                // Let&apos;s delete it to be consistent with &quot;Default&quot; concept.
                DeletePreferenceAsync().ConfigureAwait(false);
            }
        }

        private void UpdateLoadsPackageType()
        {
            var typeName = SelectedPackageType == &quot;Custom&quot; ? CustomPackageTypeName : SelectedPackageType;

            foreach (var load in Loads)
            {
                load.PackageTypeName = typeName;
            }
        }

        [RelayCommand]
        private async Task SavePreferenceAsync()
        {
            var partId = _workflowService.CurrentPart?.PartID;
            if (string.IsNullOrEmpty(partId))
            {
                return;
            }

            if (partId.Length &gt; 50)
            {
                _workflowService.RaiseStatusMessage(&quot;Part ID too long (max 50 chars).&quot;);
                return;
            }

            var typeName = SelectedPackageType == &quot;Custom&quot; ? CustomPackageTypeName : SelectedPackageType;
            if (string.IsNullOrWhiteSpace(typeName))
            {
                _workflowService.RaiseStatusMessage(&quot;Please enter a package type name.&quot;);
                return;
            }

            if (typeName.Length &gt; 50)
            {
                _workflowService.RaiseStatusMessage(&quot;Package type name too long (max 50 chars).&quot;);
                return;
            }

            // T020b: Ensure PackageTypeName has valid characters
            // Allow alphanumeric, spaces, hyphens, dots, parentheses
            if (!_regex.IsMatch(typeName))
            {
                _workflowService.RaiseStatusMessage(&quot;Invalid characters in package type name.&quot;);
                return;
            }

            var preference = new Model_PackageTypePreference
            {
                PartID = partId,
                PackageTypeName = typeName,
                CustomTypeName = SelectedPackageType == &quot;Custom&quot; ? CustomPackageTypeName : null
            };

            try
            {
                await _preferencesService.SavePreferenceAsync(preference);
                _workflowService.RaiseStatusMessage(&quot;Preference saved.&quot;);
            }
            catch (System.Exception ex)
            {
                // T020d: Add more detailed error logging
                var msg = $&quot;Failed to save preference. PartID: &apos;{partId}&apos;, Type: &apos;{typeName}&apos;, Custom: &apos;{preference.CustomTypeName}&apos;. Error: {ex.Message}&quot;;
                await _errorHandler.HandleErrorAsync(msg, Enum_ErrorSeverity.Warning, ex);
            }
        }

        private async Task DeletePreferenceAsync()
        {
            var partId = _workflowService.CurrentPart?.PartID;
            if (string.IsNullOrEmpty(partId))
            {
                return;
            }

            try
            {
                await _preferencesService.DeletePreferenceAsync(partId);
                _workflowService.RaiseStatusMessage(&quot;Preference deleted.&quot;);
            }
            catch (System.Exception ex)
            {
                await _errorHandler.HandleErrorAsync(&quot;Failed to delete preference&quot;, Enum_ErrorSeverity.Warning, ex);
            }
        }

        /// &lt;summary&gt;
        /// Shows contextual help for package type selection
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task ShowHelpAsync()
        {
            await _helpService.ShowHelpAsync(&quot;Receiving.PackageType&quot;);
        }

        #region Help Content Helpers

        public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);
        public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);
        public string GetTip(string key) =&gt; _helpService.GetTip(key);

        #endregion
    }
}</file><file path="Module_Receiving/Views/View_Receiving_ManualEntry.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Receiving.ViewModels;
using Microsoft.UI.Xaml.Input;
using Microsoft.UI.Input;
using Windows.System;
using Windows.UI.Core;
using CommunityToolkit.WinUI.UI.Controls;
using System.Linq;
using System.Collections;
using System;
using System.Diagnostics;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using System.Threading.Tasks;
using Microsoft.UI.Xaml;
using MTM_Receiving_Application.Module_Core.Contracts.Services;

namespace MTM_Receiving_Application.Module_Receiving.Views
{
    public sealed partial class View_Receiving_ManualEntry : UserControl
    {
        public ViewModel_Receiving_ManualEntry ViewModel { get; }
        private readonly IService_Focus _focusService;

        public View_Receiving_ManualEntry()
        {
            ViewModel = App.GetService&lt;ViewModel_Receiving_ManualEntry&gt;();
            _focusService = App.GetService&lt;IService_Focus&gt;();
            this.DataContext = ViewModel;
            this.InitializeComponent();

            // Listen for collection changes to handle &quot;Add Row&quot; focus
            ViewModel.Loads.CollectionChanged += Loads_CollectionChanged;

            _focusService.AttachFocusOnVisibility(this, AddRowButton);
        }

        private void Loads_CollectionChanged(object? sender, System.Collections.Specialized.NotifyCollectionChangedEventArgs e)
        {
            if (e.Action == System.Collections.Specialized.NotifyCollectionChangedAction.Add)
            {
                Debug.WriteLine(&quot;[ManualEntryView] Loads_CollectionChanged: New row added&quot;);
                // When a new row is added, ensure we focus and edit the first cell
                ManualEntryDataGrid.DispatcherQueue.TryEnqueue(() =&gt;
                {
                    if (ViewModel.Loads.Count &gt; 0)
                    {
                        // Select the last added item (assuming add to bottom)
                        if (e.NewItems?[0] is Model_ReceivingLoad newItem)
                        {
                            Debug.WriteLine($&quot;[ManualEntryView] Loads_CollectionChanged: Selecting new item LoadNumber={newItem.LoadNumber}&quot;);
                            ManualEntryDataGrid.SelectedItem = newItem;
                            ManualEntryDataGrid.ScrollIntoView(newItem, ManualEntryDataGrid.Columns.FirstOrDefault());

                            // Use async delay to ensure grid is fully ready before entering edit mode
                            _ = Task.Run(async () =&gt;
                            {
                                await Task.Delay(100); // Give grid time to complete selection and render
                                ManualEntryDataGrid.DispatcherQueue.TryEnqueue(() =&gt;
                                {
                                    SelectFirstEditableCell(ManualEntryDataGrid);
                                });
                            });
                        }
                    }
                });
            }
        }

        private void ManualEntryDataGrid_CurrentCellChanged(object? sender, EventArgs e)
        {
            var grid = sender as DataGrid;
            // Wait for the move to complete then activate edit mode
            grid?.DispatcherQueue.TryEnqueue(() =&gt;
            {
                if (grid.CurrentColumn?.IsReadOnly == false)
                {
                    Debug.WriteLine($&quot;[ManualEntryView] CurrentCellChanged: BeginEdit for Row={grid.SelectedIndex}, Col={grid.CurrentColumn.Header}&quot;);
                    grid.BeginEdit();
                }
            });
        }

        private void ManualEntryDataGrid_KeyDown(object sender, KeyRoutedEventArgs e)
        {
            if (!(sender is DataGrid grid))
            {
                return;
            }

            var shiftState = InputKeyboardSource.GetKeyStateForCurrentThread(VirtualKey.Shift);
            bool isShiftDown = (shiftState &amp; CoreVirtualKeyStates.Down) == CoreVirtualKeyStates.Down;

            Debug.WriteLine($&quot;[ManualEntryView] KeyDown: Key={e.Key}, Shift={isShiftDown}, OriginalSource={e.OriginalSource}, CurrentColumn={grid.CurrentColumn?.Header}&quot;);
        }

        private void ManualEntryDataGrid_Tapped(object sender, TappedRoutedEventArgs e)
        {
            if (!(sender is DataGrid grid))
            {
                return;
            }

            Debug.WriteLine($&quot;[ManualEntryView] Tapped: OriginalSource={e.OriginalSource}&quot;);

            // Handle empty grid or header clicks
            if (grid.ItemsSource is IList items &amp;&amp; items.Count == 0)
            {
                Debug.WriteLine(&quot;[ManualEntryView] Tapped: Grid empty, triggering AddRow command.&quot;);
                if (ViewModel.AddRowCommand.CanExecute(null))
                {
                    ViewModel.AddRowCommand.Execute(null);
                }
                // Focus handled by Loads_CollectionChanged
            }
            else if (grid.SelectedItem == null)
            {
                Debug.WriteLine(&quot;[ManualEntryView] Tapped: SelectedItem is null (Header or empty space). Selecting first editable cell.&quot;);
                // Header clicked or empty space
                if (grid.ItemsSource is IList list &amp;&amp; list.Count &gt; 0)
                {
                    grid.SelectedIndex = 0;
                    SelectFirstEditableCell(grid);
                }
            }
            else
            {
                // Cell clicked - CurrentCellChanged handles the edit mode if cell changes.
                // But if we tap the SAME cell, CurrentCellChanged might not fire.
                // So we ensure edit mode here too.
                Debug.WriteLine(&quot;[ManualEntryView] Tapped: Cell clicked. Enqueuing BeginEdit.&quot;);
                grid.DispatcherQueue.TryEnqueue(() =&gt;
                {
                    if (grid.CurrentColumn?.IsReadOnly == false)
                    {
                        Debug.WriteLine($&quot;[ManualEntryView] Tapped: BeginEdit for Row={grid.SelectedIndex}, Col={grid.CurrentColumn.Header}&quot;);
                        grid.BeginEdit();
                    }
                });
            }
        }

        private void SelectFirstEditableCell(DataGrid grid)
        {
            Debug.WriteLine(&quot;[ManualEntryView] SelectFirstEditableCell: Starting&quot;);
            if (grid.ItemsSource is IList items &amp;&amp; items.Count &gt; 0)
            {
                // Find first non-readonly column
                var firstEditable = grid.Columns.OrderBy(c =&gt; c.DisplayIndex).FirstOrDefault(c =&gt; !c.IsReadOnly);
                if (firstEditable != null)
                {
                    Debug.WriteLine($&quot;[ManualEntryView] SelectFirstEditableCell: Found editable column {firstEditable.Header}. Setting CurrentColumn and calling BeginEdit.&quot;);
                    grid.CurrentColumn = firstEditable;
                    grid.Focus(Microsoft.UI.Xaml.FocusState.Programmatic);
                    grid.BeginEdit();
                    Debug.WriteLine($&quot;[ManualEntryView] SelectFirstEditableCell: BeginEdit called for column {firstEditable.Header}&quot;);
                }
                else
                {
                    Debug.WriteLine(&quot;[ManualEntryView] SelectFirstEditableCell: No editable column found.&quot;);
                }
            }
            else
            {
                var itemCount = (grid.ItemsSource as IList)?.Count ?? 0;
                Debug.WriteLine($&quot;[ManualEntryView] SelectFirstEditableCell: Grid has no items (Count={itemCount})&quot;);
            }
        }
    }
}</file><file path="Module_Reporting/Contracts/IService_Reporting.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.Reporting;

namespace MTM_Receiving_Application.Module_Reporting.Contracts;

/// &lt;summary&gt;
/// Service interface for End-of-Day reporting across all modules
/// Filters history data by date range, normalizes PO numbers, and exports to CSV/email format
/// Reference: EndOfDayEmail.js and AppScript.js from Google Sheets routing label system
/// &lt;/summary&gt;
public interface IService_Reporting
{
    /// &lt;summary&gt;
    /// Retrieves Receiving history data filtered by date range
    /// Includes: PO Number (normalized), Part Number, Description, Quantity, Weight, Heat/Lot, Date
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;startDate&quot;&gt;Start date for filter&lt;/param&gt;
    /// &lt;param name=&quot;endDate&quot;&gt;End date for filter&lt;/param&gt;
    /// &lt;returns&gt;DAO result containing list of report rows&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;List&lt;Model_ReportRow&gt;&gt;&gt; GetReceivingHistoryAsync(
        DateTime startDate,
        DateTime endDate);

    /// &lt;summary&gt;
    /// Retrieves Dunnage history data filtered by date range
    /// Includes: Type, Part, Specs (concatenated), Quantity, Date
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;startDate&quot;&gt;Start date for filter&lt;/param&gt;
    /// &lt;param name=&quot;endDate&quot;&gt;End date for filter&lt;/param&gt;
    /// &lt;returns&gt;DAO result containing list of report rows&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;List&lt;Model_ReportRow&gt;&gt;&gt; GetDunnageHistoryAsync(
        DateTime startDate,
        DateTime endDate);

    /// &lt;summary&gt;
    /// Retrieves Routing history data filtered by date range
    /// Includes: Deliver To, Department, Package Description, PO Number, Employee, Date
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;startDate&quot;&gt;Start date for filter&lt;/param&gt;
    /// &lt;param name=&quot;endDate&quot;&gt;End date for filter&lt;/param&gt;
    /// &lt;returns&gt;DAO result containing list of report rows&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;List&lt;Model_ReportRow&gt;&gt;&gt; GetRoutingHistoryAsync(
        DateTime startDate,
        DateTime endDate);

    /// &lt;summary&gt;
    /// Retrieves Volvo history data filtered by date range
    /// Includes: Shipment Date, Shipment Number, PO Number, Receiver Number, Status, Date
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;startDate&quot;&gt;Start date for filter&lt;/param&gt;
    /// &lt;param name=&quot;endDate&quot;&gt;End date for filter&lt;/param&gt;
    /// &lt;returns&gt;DAO result containing list of report rows&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;List&lt;Model_ReportRow&gt;&gt;&gt; GetVolvoHistoryAsync(
        DateTime startDate,
        DateTime endDate);

    /// &lt;summary&gt;
    /// Checks availability of data for each module in the specified date range
    /// Returns dictionary of module name  record count
    /// Used to enable/disable module checkboxes in UI
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;startDate&quot;&gt;Start date for filter&lt;/param&gt;
    /// &lt;param name=&quot;endDate&quot;&gt;End date for filter&lt;/param&gt;
    /// &lt;returns&gt;DAO result containing dictionary of module names and record counts&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;Dictionary&lt;string, int&gt;&gt;&gt; CheckAvailabilityAsync(
        DateTime startDate,
        DateTime endDate);

    /// &lt;summary&gt;
    /// Exports report data to CSV file matching MiniUPSLabel.csv structure
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;data&quot;&gt;Filtered report rows&lt;/param&gt;
    /// &lt;param name=&quot;moduleName&quot;&gt;Module name for filename (Receiving, Dunnage, Routing, Volvo)&lt;/param&gt;
    /// &lt;returns&gt;DAO result with file path of generated CSV&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;string&gt;&gt; ExportToCSVAsync(
        List&lt;Model_ReportRow&gt; data,
        string moduleName);

    /// &lt;summary&gt;
    /// Formats report data as email body with alternating row colors grouped by date
    /// Matches Google Sheets colorHistory() function behavior
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;data&quot;&gt;Filtered report rows&lt;/param&gt;
    /// &lt;param name=&quot;applyDateGrouping&quot;&gt;Apply alternating colors by date group&lt;/param&gt;
    /// &lt;returns&gt;DAO result containing HTML-formatted string for email body&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;string&gt;&gt; FormatForEmailAsync(
        List&lt;Model_ReportRow&gt; data,
        bool applyDateGrouping = true);

    /// &lt;summary&gt;
    /// Normalizes PO number to standard format (PO-063150 or PO-063150B)
    /// Matches EndOfDayEmail.js normalizePO() algorithm
    /// Examples:
    /// - &quot;63150&quot;  &quot;PO-063150&quot;
    /// - &quot;063150B&quot;  &quot;PO-063150B&quot;
    /// - &quot;Customer Supplied&quot;  &quot;Customer Supplied&quot; (pass through)
    /// - &quot;&quot;  &quot;No PO&quot;
    /// - &quot;1234&quot;  &quot;Validate PO&quot; (too short)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;Raw PO number to normalize&lt;/param&gt;
    /// &lt;returns&gt;Normalized PO number&lt;/returns&gt;
    public string NormalizePONumber(string? poNumber);
}</file><file path="Module_Routing/Constants/Constant_Routing.cs">namespace MTM_Receiving_Application.Module_Routing.Constants;

/// &lt;summary&gt;
/// Constants for Routing Module
/// Fixes Issue #10: Magic string &quot;OTHER&quot; scattered across codebase
/// &lt;/summary&gt;
public static class Constant_Routing
{
    /// &lt;summary&gt;
    /// Special PO number value indicating non-PO package
    /// &lt;/summary&gt;
    public const string OtherPoNumber = &quot;OTHER&quot;;

    /// &lt;summary&gt;
    /// Line number used for OTHER packages
    /// &lt;/summary&gt;
    public const string OtherLineNumber = &quot;0&quot;;
}</file><file path="Module_Routing/Constants/Constant_RoutingConfiguration.cs">namespace MTM_Receiving_Application.Module_Routing.Constants;

/// &lt;summary&gt;
/// Configuration key constants for Routing Module
/// Fixes Issue #22: Magic numbers in configuration keys
/// &lt;/summary&gt;
public static class Constant_RoutingConfiguration
{
    // CSV Export Configuration
    public const string CsvExportPathNetwork = &quot;RoutingModule:CsvExportPath:Network&quot;;
    public const string CsvExportPathLocal = &quot;RoutingModule:CsvExportPath:Local&quot;;
    public const string CsvExportPathBaseDirectory = &quot;RoutingModule:CsvExportPath:BaseDirectory&quot;;

    // CSV Retry Configuration
    public const string CsvRetryMaxAttempts = &quot;RoutingModule:CsvRetry:MaxAttempts&quot;;
    public const string CsvRetryDelayMs = &quot;RoutingModule:CsvRetry:DelayMs&quot;;

    // Default Values
    public const int DefaultCsvRetryMaxAttempts = 3;
    public const int DefaultCsvRetryDelayMs = 500;
    public const int DefaultDuplicateDetectionHours = 24;
    public const int DefaultQuickAddRecipientCount = 5;
    public const int DefaultPageLimit = 100;
}</file><file path="Module_Routing/Data/Dao_RoutingRecipient.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Models;
using MTM_Receiving_Application.Module_Core.Helpers.Database;

namespace MTM_Receiving_Application.Module_Routing.Data;

/// &lt;summary&gt;
/// Data Access Object for routing_recipients table
/// &lt;/summary&gt;
public class Dao_RoutingRecipient
{
    private readonly string _connectionString;

    public Dao_RoutingRecipient(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Retrieves all active recipients
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingRecipient&gt;&gt;&gt; GetAllActiveRecipientsAsync()
    {
        try
        {
            return await Helper_Database_StoredProcedure.ExecuteListAsync&lt;Model_RoutingRecipient&gt;(
                _connectionString,
                &quot;sp_routing_recipient_get_all_active&quot;,
                MapFromReader
            );
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_RoutingRecipient&gt;&gt;($&quot;Error retrieving recipients: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Retrieves top recipients by usage (personalized or system-wide)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;employeeNumber&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;topCount&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingRecipient&gt;&gt;&gt; GetTopRecipientsByUsageAsync(int employeeNumber, int topCount = 5)
    {
        try
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;p_employee_number&quot;, employeeNumber },
                { &quot;p_top_count&quot;, topCount }
            };

            return await Helper_Database_StoredProcedure.ExecuteListAsync&lt;Model_RoutingRecipient&gt;(
                _connectionString,
                &quot;sp_routing_recipient_get_top_by_usage&quot;,
                MapFromReaderWithUsage,
                parameters
            );
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_RoutingRecipient&gt;&gt;($&quot;Error retrieving top recipients: {ex.Message}&quot;, ex);
        }
    }

    private Model_RoutingRecipient MapFromReader(IDataReader reader)
    {
        return new Model_RoutingRecipient
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            Name = reader.GetString(reader.GetOrdinal(&quot;name&quot;)),
            Location = reader.GetString(reader.GetOrdinal(&quot;location&quot;)),
            Department = reader.IsDBNull(reader.GetOrdinal(&quot;department&quot;)) ? null : reader.GetString(reader.GetOrdinal(&quot;department&quot;)),
            IsActive = reader.GetBoolean(reader.GetOrdinal(&quot;is_active&quot;)),
            CreatedDate = reader.GetDateTime(reader.GetOrdinal(&quot;created_date&quot;)),
            UpdatedDate = reader.GetDateTime(reader.GetOrdinal(&quot;updated_date&quot;))
        };
    }

    private Model_RoutingRecipient MapFromReaderWithUsage(IDataReader reader)
    {
        var recipient = MapFromReader(reader);
        recipient.UsageCount = reader.GetInt32(reader.GetOrdinal(&quot;usage_count&quot;));
        return recipient;
    }
}</file><file path="Module_Routing/Interfaces/IDao_RoutingLabel.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Models;

namespace MTM_Receiving_Application.Module_Routing.Interfaces;

/// &lt;summary&gt;
/// Interface for routing label data access operations
/// Issue #25: Created for testability and dependency injection
/// &lt;/summary&gt;
public interface IDao_RoutingLabel
{
    Task&lt;Model_Dao_Result&lt;int&gt;&gt; InsertLabelAsync(Model_RoutingLabel label);
    Task&lt;Model_Dao_Result&gt; UpdateLabelAsync(Model_RoutingLabel label);
    Task&lt;Model_Dao_Result&lt;Model_RoutingLabel&gt;&gt; GetLabelByIdAsync(int labelId);
    Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingLabel&gt;&gt;&gt; GetAllLabelsAsync(int limit = 100, int offset = 0);
    Task&lt;Model_Dao_Result&gt; DeleteLabelAsync(int labelId);
    Task&lt;Model_Dao_Result&gt; MarkLabelExportedAsync(int labelId);
    Task&lt;Model_Dao_Result&lt;Model_RoutingLabel&gt;&gt; CheckDuplicateLabelAsync(string poNumber, string lineNumber, int recipientId, int hoursWindow = 24);
    Task&lt;Model_Dao_Result&lt;(bool Exists, int? ExistingLabelId)&gt;&gt; CheckDuplicateAsync(string poNumber, string lineNumber, int recipientId, DateTime createdWithinDate);
    Task&lt;Model_Dao_Result&gt; MarkExportedAsync(List&lt;int&gt; labelIds);
}</file><file path="Module_Routing/Interfaces/IDao_RoutingLabelHistory.cs">using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Models;

namespace MTM_Receiving_Application.Module_Routing.Interfaces;

/// &lt;summary&gt;
/// Interface for label history data access operations
/// Issue #25: Created for testability and dependency injection
/// &lt;/summary&gt;
public interface IDao_RoutingLabelHistory
{
    Task&lt;Model_Dao_Result&gt; InsertHistoryAsync(Model_RoutingLabelHistory history);
    Task&lt;Model_Dao_Result&gt; InsertHistoryBatchAsync(List&lt;Model_RoutingLabelHistory&gt; historyEntries);
    Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingLabelHistory&gt;&gt;&gt; GetHistoryByLabelAsync(int labelId);
}</file><file path="Module_Routing/Interfaces/IDao_RoutingRecipient.cs">using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Models;

namespace MTM_Receiving_Application.Module_Routing.Interfaces;

/// &lt;summary&gt;
/// Interface for routing recipient data access operations
/// Issue #25: Created for testability and dependency injection
/// &lt;/summary&gt;
public interface IDao_RoutingRecipient
{
    Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingRecipient&gt;&gt;&gt; GetAllActiveRecipientsAsync();
    Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingRecipient&gt;&gt;&gt; GetTopRecipientsByUsageAsync(int employeeNumber, int topCount = 5);
}</file><file path="Module_Routing/Interfaces/IDao_RoutingUsageTracking.cs">using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;

namespace MTM_Receiving_Application.Module_Routing.Interfaces;

/// &lt;summary&gt;
/// Interface for usage tracking data access operations
/// Issue #25: Created for testability and dependency injection
/// &lt;/summary&gt;
public interface IDao_RoutingUsageTracking
{
    Task&lt;Model_Dao_Result&gt; IncrementUsageAsync(int employeeNumber, int recipientId);
}</file><file path="Module_Routing/Models/Model_RoutingLabelHistory.cs">using System;

namespace MTM_Receiving_Application.Module_Routing.Models;

/// &lt;summary&gt;
/// Represents audit trail entry for label edits
/// Maps to routing_history database table
/// &lt;/summary&gt;
public class Model_RoutingLabelHistory
{
    /// &lt;summary&gt;
    /// Auto-increment primary key
    /// &lt;/summary&gt;
    public int Id { get; set; }

    /// &lt;summary&gt;
    /// Foreign key to routing_label_data table
    /// &lt;/summary&gt;
    public int LabelId { get; set; }

    /// &lt;summary&gt;
    /// Name of field that was changed (e.g., &quot;Recipient&quot;, &quot;Quantity&quot;)
    /// &lt;/summary&gt;
    public string FieldChanged { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Old value before edit (nullable)
    /// &lt;/summary&gt;
    public string? OldValue { get; set; }

    /// &lt;summary&gt;
    /// New value after edit (nullable)
    /// &lt;/summary&gt;
    public string? NewValue { get; set; }

    /// &lt;summary&gt;
    /// Employee number who made the edit
    /// &lt;/summary&gt;
    public int EditedBy { get; set; }

    /// &lt;summary&gt;
    /// Timestamp of edit
    /// &lt;/summary&gt;
    public DateTime EditDate { get; set; } = DateTime.Now;
}</file><file path="Module_Routing/Models/Model_RoutingOtherReason.cs">namespace MTM_Receiving_Application.Module_Routing.Models;

/// &lt;summary&gt;
/// Represents a reason code for non-PO packages (po_number=&apos;OTHER&apos;)
/// Maps to routing_po_alternatives database table
/// &lt;/summary&gt;
public class Model_RoutingOtherReason
{
    /// &lt;summary&gt;
    /// Auto-increment primary key
    /// &lt;/summary&gt;
    public int Id { get; set; }

    /// &lt;summary&gt;
    /// Short reason code (e.g., &quot;RETURNED&quot;, &quot;SAMPLE&quot;)
    /// &lt;/summary&gt;
    public string ReasonCode { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// User-facing description (e.g., &quot;Returned Item&quot;)
    /// &lt;/summary&gt;
    public string Description { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Active status (0=inactive, 1=active)
    /// &lt;/summary&gt;
    public bool IsActive { get; set; } = true;

    /// &lt;summary&gt;
    /// Sort order for dropdown display (lower = first)
    /// &lt;/summary&gt;
    public int DisplayOrder { get; set; } = 999;
}</file><file path="Module_Routing/Models/Model_RoutingRecipient.cs">using System;

namespace MTM_Receiving_Application.Module_Routing.Models;

/// &lt;summary&gt;
/// Represents a recipient (person or department) who can receive packages
/// Maps to routing_recipients database table
/// &lt;/summary&gt;
public class Model_RoutingRecipient
{
    /// &lt;summary&gt;
    /// Auto-increment primary key
    /// &lt;/summary&gt;
    public int Id { get; set; }

    /// &lt;summary&gt;
    /// Recipient name (unique, person or department)
    /// &lt;/summary&gt;
    public string Name { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Physical location (e.g., &quot;Building A - Floor 2&quot;)
    /// &lt;/summary&gt;
    public string Location { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Department name (optional)
    /// &lt;/summary&gt;
    public string? Department { get; set; }

    /// &lt;summary&gt;
    /// Active status (0=inactive, 1=active)
    /// &lt;/summary&gt;
    public bool IsActive { get; set; } = true;

    /// &lt;summary&gt;
    /// Record creation timestamp
    /// &lt;/summary&gt;
    public DateTime CreatedDate { get; set; } = DateTime.Now;

    /// &lt;summary&gt;
    /// Last update timestamp
    /// &lt;/summary&gt;
    public DateTime UpdatedDate { get; set; } = DateTime.Now;

    /// &lt;summary&gt;
    /// Usage count for sorting (from JOIN with routing_recipient_tracker, not stored in table)
    /// &lt;/summary&gt;
    public int UsageCount { get; set; } = 0;
}</file><file path="Module_Routing/Models/Model_RoutingUsageTracking.cs">using System;

namespace MTM_Receiving_Application.Module_Routing.Models;

/// &lt;summary&gt;
/// Represents usage tracking for personalized Quick Add and smart sorting
/// Maps to routing_recipient_tracker database table
/// &lt;/summary&gt;
public class Model_RoutingUsageTracking
{
    /// &lt;summary&gt;
    /// Auto-increment primary key
    /// &lt;/summary&gt;
    public int Id { get; set; }

    /// &lt;summary&gt;
    /// Employee number being tracked
    /// &lt;/summary&gt;
    public int EmployeeNumber { get; set; }

    /// &lt;summary&gt;
    /// Foreign key to routing_recipients table
    /// &lt;/summary&gt;
    public int RecipientId { get; set; }

    /// &lt;summary&gt;
    /// Number of times employee selected this recipient
    /// &lt;/summary&gt;
    public int UsageCount { get; set; } = 0;

    /// &lt;summary&gt;
    /// Timestamp of most recent usage
    /// &lt;/summary&gt;
    public DateTime LastUsedDate { get; set; } = DateTime.Now;
}</file><file path="Module_Routing/Models/Model_RoutingUserPreference.cs">using System;

namespace MTM_Receiving_Application.Module_Routing.Models;

/// &lt;summary&gt;
/// Represents user preferences for routing module (default mode, validation toggle)
/// Maps to settings_routing_personal database table
/// &lt;/summary&gt;
public class Model_RoutingUserPreference
{
    /// &lt;summary&gt;
    /// Auto-increment primary key
    /// &lt;/summary&gt;
    public int Id { get; set; }

    /// &lt;summary&gt;
    /// Employee number (unique)
    /// &lt;/summary&gt;
    public int EmployeeNumber { get; set; }

    /// &lt;summary&gt;
    /// Default mode: &quot;WIZARD&quot;, &quot;MANUAL&quot;, or &quot;EDIT&quot;
    /// &lt;/summary&gt;
    public string DefaultMode { get; set; } = &quot;WIZARD&quot;;

    /// &lt;summary&gt;
    /// Infor Visual validation toggle (true=on, false=off)
    /// &lt;/summary&gt;
    public bool EnableValidation { get; set; } = true;

    /// &lt;summary&gt;
    /// Last update timestamp
    /// &lt;/summary&gt;
    public DateTime UpdatedDate { get; set; } = DateTime.Now;
}</file><file path="Module_Routing/Services/IRoutingInforVisualService.cs">using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Models;

namespace MTM_Receiving_Application.Module_Routing.Services;

/// &lt;summary&gt;
/// Service interface for Infor Visual ERP integration: PO validation, line retrieval (READ ONLY)
/// &lt;/summary&gt;
public interface IRoutingInforVisualService
{
    /// &lt;summary&gt;
    /// Validates PO number exists in Infor Visual MTMFG database
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;PO number to validate&lt;/param&gt;
    /// &lt;returns&gt;Result with validation status (IsSuccess=true if found, false if not found or error)&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;bool&gt;&gt; ValidatePoNumberAsync(string poNumber);

    /// &lt;summary&gt;
    /// Retrieves line items for a valid PO number from Infor Visual
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;PO number to retrieve lines for&lt;/param&gt;
    /// &lt;returns&gt;Result with list of PO line items (part number, description, quantity) or error&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;List&lt;Model_InforVisualPOLine&gt;&gt;&gt; GetPoLinesAsync(string poNumber);

    /// &lt;summary&gt;
    /// Retrieves a single line item for a PO from Infor Visual
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;PO number&lt;/param&gt;
    /// &lt;param name=&quot;lineNumber&quot;&gt;Line number&lt;/param&gt;
    /// &lt;returns&gt;Result with PO line data or error&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;Model_InforVisualPOLine&gt;&gt; GetPoLineAsync(string poNumber, string lineNumber);

    /// &lt;summary&gt;
    /// Checks if Infor Visual connection is available (health check)
    /// &lt;/summary&gt;
    /// &lt;returns&gt;Result with connection status (IsSuccess=true if available)&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;bool&gt;&gt; CheckConnectionAsync();
}</file><file path="Module_Routing/Services/IRoutingService.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Models;

namespace MTM_Receiving_Application.Module_Routing.Services;

/// &lt;summary&gt;
/// Service interface for core routing label operations: creation, editing, CSV export, validation
/// &lt;/summary&gt;
public interface IRoutingService
{
    /// &lt;summary&gt;
    /// Creates a new routing label, saves to database and exports to CSV
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;label&quot;&gt;Label data to create&lt;/param&gt;
    /// &lt;returns&gt;Result with created label ID or error message&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;int&gt;&gt; CreateLabelAsync(Model_RoutingLabel label);

    /// &lt;summary&gt;
    /// Updates an existing routing label (Edit Mode), logs changes to history
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;label&quot;&gt;Updated label data (must include ID)&lt;/param&gt;
    /// &lt;param name=&quot;editedByEmployeeNumber&quot;&gt;Employee number making the edit&lt;/param&gt;
    /// &lt;returns&gt;Result indicating success or failure&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&gt; UpdateLabelAsync(Model_RoutingLabel label, int editedByEmployeeNumber);

    /// &lt;summary&gt;
    /// Retrieves a single label by ID
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;labelId&quot;&gt;Label ID to retrieve&lt;/param&gt;
    /// &lt;returns&gt;Result with label data or error message&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;Model_RoutingLabel&gt;&gt; GetLabelByIdAsync(int labelId);

    /// &lt;summary&gt;
    /// Retrieves all labels for Edit Mode grid (paginated, sorted by date DESC)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;limit&quot;&gt;Number of records to return&lt;/param&gt;
    /// &lt;param name=&quot;offset&quot;&gt;Number of records to skip&lt;/param&gt;
    /// &lt;returns&gt;Result with list of labels or error message&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingLabel&gt;&gt;&gt; GetAllLabelsAsync(int limit = 100, int offset = 0);

    /// &lt;summary&gt;
    /// Checks if a duplicate label exists (same PO, Line, Recipient, Date)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;PO number&lt;/param&gt;
    /// &lt;param name=&quot;lineNumber&quot;&gt;Line number&lt;/param&gt;
    /// &lt;param name=&quot;recipientId&quot;&gt;Recipient ID&lt;/param&gt;
    /// &lt;param name=&quot;createdDate&quot;&gt;Date to check&lt;/param&gt;
    /// &lt;returns&gt;Result with duplicate check data (exists flag + existing label ID if found)&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;(bool Exists, int? ExistingLabelId)&gt;&gt; CheckDuplicateLabelAsync(
        string poNumber,
        string lineNumber,
        int recipientId,
        DateTime createdDate);

    /// &lt;summary&gt;
    /// Exports a single label to CSV file (async with retry)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;label&quot;&gt;Label to export&lt;/param&gt;
    /// &lt;returns&gt;Result indicating CSV export success or failure&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&gt; ExportLabelToCsvAsync(Model_RoutingLabel label);

    /// &lt;summary&gt;
    /// Regenerates CSV entry for a label (Reprint functionality in Edit Mode)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;labelId&quot;&gt;Label ID to regenerate CSV for&lt;/param&gt;
    /// &lt;returns&gt;Result indicating CSV regeneration success or failure&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&gt; RegenerateLabelCsvAsync(int labelId);

    /// &lt;summary&gt;
    /// Resets (clears) the CSV file (with confirmation required)
    /// &lt;/summary&gt;
    /// &lt;returns&gt;Result indicating CSV reset success or failure&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&gt; ResetCsvFileAsync();

    /// &lt;summary&gt;
    /// Validates label data before creation (business rules)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;label&quot;&gt;Label to validate&lt;/param&gt;
    /// &lt;returns&gt;Validation result (IsSuccess=true if valid, ErrorMessage if invalid)&lt;/returns&gt;
    public Model_Dao_Result ValidateLabel(Model_RoutingLabel label);
}</file><file path="Module_Routing/Services/IRoutingUsageTrackingService.cs">using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Models;

namespace MTM_Receiving_Application.Module_Routing.Services;

/// &lt;summary&gt;
/// Service interface for usage tracking: increment counts, smart sorting calculation
/// &lt;/summary&gt;
public interface IRoutingUsageTrackingService
{
    /// &lt;summary&gt;
    /// Increments usage count for employee-recipient pair (called after label creation)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;employeeNumber&quot;&gt;Employee who created the label&lt;/param&gt;
    /// &lt;param name=&quot;recipientId&quot;&gt;Recipient selected for the label&lt;/param&gt;
    /// &lt;returns&gt;Result indicating success or failure&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&gt; IncrementUsageCountAsync(int employeeNumber, int recipientId);

    /// &lt;summary&gt;
    /// Retrieves usage count for a specific employee-recipient pair
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;employeeNumber&quot;&gt;Employee number&lt;/param&gt;
    /// &lt;param name=&quot;recipientId&quot;&gt;Recipient ID&lt;/param&gt;
    /// &lt;returns&gt;Result with usage count (0 if no usage record exists)&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetUsageCountAsync(int employeeNumber, int recipientId);

    /// &lt;summary&gt;
    /// Retrieves total number of labels created by employee (for 20-label threshold check)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;employeeNumber&quot;&gt;Employee number&lt;/param&gt;
    /// &lt;returns&gt;Result with label count&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetEmployeeLabelCountAsync(int employeeNumber);
}</file><file path="Module_Routing/Services/IRoutingUserPreferenceService.cs">using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Models;

namespace MTM_Receiving_Application.Module_Routing.Services;

/// &lt;summary&gt;
/// Service interface for user preferences: default mode, validation toggle
/// &lt;/summary&gt;
public interface IRoutingUserPreferenceService
{
    /// &lt;summary&gt;
    /// Retrieves user preferences for employee (returns defaults if not set)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;employeeNumber&quot;&gt;Employee number&lt;/param&gt;
    /// &lt;returns&gt;Result with user preference data (default_mode, enable_validation)&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;Model_RoutingUserPreference&gt;&gt; GetUserPreferenceAsync(int employeeNumber);

    /// &lt;summary&gt;
    /// Creates or updates user preferences
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;preference&quot;&gt;User preference data to save&lt;/param&gt;
    /// &lt;returns&gt;Result indicating success or failure&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&gt; SaveUserPreferenceAsync(Model_RoutingUserPreference preference);

    /// &lt;summary&gt;
    /// Resets user preferences to defaults (Wizard mode, validation enabled)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;employeeNumber&quot;&gt;Employee number&lt;/param&gt;
    /// &lt;returns&gt;Result indicating success or failure&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&gt; ResetToDefaultsAsync(int employeeNumber);
}</file><file path="Module_Routing/Views/RoutingEditModeView.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using Microsoft.UI.Xaml.Input;
using MTM_Receiving_Application.Module_Routing.ViewModels;
using MTM_Receiving_Application.Module_Routing.Models;
using System;
using System.Runtime.InteropServices.WindowsRuntime;
using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Routing.Views;

public sealed partial class RoutingEditModeView : Page
{
    public RoutingEditModeViewModel ViewModel { get; }

    public RoutingEditModeView()
    {
        ViewModel = App.GetService&lt;RoutingEditModeViewModel&gt;();
        InitializeComponent();
    }

    private async void OnPageLoaded(object sender, RoutedEventArgs e)
    {
        await ViewModel.InitializeAsync();
    }

    private async void OnDataGridDoubleTapped(object sender, DoubleTappedRoutedEventArgs e)
    {
        await EditSelectedLabelCommand.ExecuteAsync(null);
    }

    private async Task EditSelectedLabelCommand_ExecuteAsync(object? parameter)
    {
        if (ViewModel.SelectedLabel == null)
        {
            return;
        }

        // Create a copy for editing
        var editedLabel = new Model_RoutingLabel
        {
            Id = ViewModel.SelectedLabel.Id,
            PONumber = ViewModel.SelectedLabel.PONumber,
            LineNumber = ViewModel.SelectedLabel.LineNumber,
            Description = ViewModel.SelectedLabel.Description,
            RecipientId = ViewModel.SelectedLabel.RecipientId,
            Quantity = ViewModel.SelectedLabel.Quantity,
            OtherReasonId = ViewModel.SelectedLabel.OtherReasonId,
            CreatedBy = ViewModel.SelectedLabel.CreatedBy,
            CreatedDate = ViewModel.SelectedLabel.CreatedDate
        };

        // Create edit dialog
        var dialog = new ContentDialog
        {
            Title = &quot;Edit Routing Label&quot;,
            PrimaryButtonText = &quot;Save Changes&quot;,
            CloseButtonText = &quot;Cancel&quot;,
            DefaultButton = ContentDialogButton.Primary,
            XamlRoot = this.XamlRoot
        };

        // Create dialog content
        var grid = new Grid
        {
            RowSpacing = 12,
            ColumnSpacing = 12,
            Padding = new Thickness(24)
        };

        grid.RowDefinitions.Add(new RowDefinition { Height = GridLength.Auto });
        grid.RowDefinitions.Add(new RowDefinition { Height = GridLength.Auto });
        grid.RowDefinitions.Add(new RowDefinition { Height = GridLength.Auto });
        grid.RowDefinitions.Add(new RowDefinition { Height = GridLength.Auto });
        grid.RowDefinitions.Add(new RowDefinition { Height = GridLength.Auto });

        grid.ColumnDefinitions.Add(new ColumnDefinition { Width = GridLength.Auto });
        grid.ColumnDefinitions.Add(new ColumnDefinition { Width = new GridLength(1, GridUnitType.Star) });

        // PO Number (read-only)
        var poLabel = new TextBlock { Text = &quot;PO Number:&quot;, VerticalAlignment = VerticalAlignment.Center };
        var poValue = new TextBox { Text = editedLabel.PONumber ?? &quot;N/A&quot;, IsReadOnly = true };
        Grid.SetRow(poLabel, 0);
        Grid.SetColumn(poLabel, 0);
        Grid.SetRow(poValue, 0);
        Grid.SetColumn(poValue, 1);
        grid.Children.Add(poLabel);
        grid.Children.Add(poValue);

        // Part Description (read-only)
        var partLabel = new TextBlock { Text = &quot;Part Description:&quot;, VerticalAlignment = VerticalAlignment.Center };
        var partValue = new TextBox { Text = editedLabel.Description ?? &quot;N/A&quot;, IsReadOnly = true };
        Grid.SetRow(partLabel, 1);
        Grid.SetColumn(partLabel, 0);
        Grid.SetRow(partValue, 1);
        Grid.SetColumn(partValue, 1);
        grid.Children.Add(partLabel);
        grid.Children.Add(partValue);

        // Recipient (editable ComboBox)
        var recipientLabel = new TextBlock { Text = &quot;Recipient:&quot;, VerticalAlignment = VerticalAlignment.Center };
        var recipientCombo = new ComboBox
        {
            ItemsSource = ViewModel.AllRecipients,
            DisplayMemberPath = &quot;Name&quot;,
            SelectedValuePath = &quot;Id&quot;,
            SelectedValue = editedLabel.RecipientId,
            HorizontalAlignment = HorizontalAlignment.Stretch
        };
        Grid.SetRow(recipientLabel, 2);
        Grid.SetColumn(recipientLabel, 0);
        Grid.SetRow(recipientCombo, 2);
        Grid.SetColumn(recipientCombo, 1);
        grid.Children.Add(recipientLabel);
        grid.Children.Add(recipientCombo);

        // Quantity (editable NumberBox)
        var qtyLabel = new TextBlock { Text = &quot;Quantity:&quot;, VerticalAlignment = VerticalAlignment.Center };
        var qtyBox = new NumberBox
        {
            Value = editedLabel.Quantity,
            Minimum = 1,
            SpinButtonPlacementMode = NumberBoxSpinButtonPlacementMode.Inline
        };
        Grid.SetRow(qtyLabel, 3);
        Grid.SetColumn(qtyLabel, 0);
        Grid.SetRow(qtyBox, 3);
        Grid.SetColumn(qtyBox, 1);
        grid.Children.Add(qtyLabel);
        grid.Children.Add(qtyBox);

        // Created Date (read-only)
        var dateLabel = new TextBlock { Text = &quot;Created Date:&quot;, VerticalAlignment = VerticalAlignment.Center };
        var dateValue = new TextBox { Text = editedLabel.CreatedDate.ToString(&quot;g&quot;), IsReadOnly = true };
        Grid.SetRow(dateLabel, 4);
        Grid.SetColumn(dateLabel, 0);
        Grid.SetRow(dateValue, 4);
        Grid.SetColumn(dateValue, 1);
        grid.Children.Add(dateLabel);
        grid.Children.Add(dateValue);

        dialog.Content = grid;

        var result = await dialog.ShowAsync();

        if (result == ContentDialogResult.Primary)
        {
            // Update edited label with new values
            editedLabel.RecipientId = (int)(recipientCombo.SelectedValue ?? editedLabel.RecipientId);
            editedLabel.Quantity = (int)qtyBox.Value;

            // Save changes
            await ViewModel.SaveEditedLabelCommand.ExecuteAsync(editedLabel);
        }
    }

    private CommunityToolkit.Mvvm.Input.IAsyncRelayCommand EditSelectedLabelCommand =&gt; new CommunityToolkit.Mvvm.Input.AsyncRelayCommand&lt;object?&gt;(EditSelectedLabelCommand_ExecuteAsync);
}</file><file path="Module_Routing/Views/RoutingManualEntryView.xaml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;Page
    x:Class=&quot;MTM_Receiving_Application.Module_Routing.Views.RoutingManualEntryView&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    mc:Ignorable=&quot;d&quot;
    Loaded=&quot;OnPageLoaded&quot;&gt;

    &lt;Grid Padding=&quot;24&quot; RowSpacing=&quot;16&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header --&gt;
        &lt;StackPanel Grid.Row=&quot;0&quot; Spacing=&quot;8&quot;&gt;
            &lt;TextBlock Text=&quot;Manual Entry Mode&quot; Style=&quot;{StaticResource TitleTextBlockStyle}&quot;/&gt;
            &lt;TextBlock Text=&quot;Enter multiple labels and save in batch&quot; Style=&quot;{StaticResource BodyTextBlockStyle}&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- DataGrid --&gt;
        &lt;controls:DataGrid 
            Grid.Row=&quot;1&quot;
            ItemsSource=&quot;{x:Bind ViewModel.Labels, Mode=OneWay}&quot;
            SelectedItem=&quot;{x:Bind ViewModel.SelectedLabel, Mode=TwoWay}&quot;
            AutoGenerateColumns=&quot;False&quot;
            CanUserReorderColumns=&quot;False&quot;
            CanUserSortColumns=&quot;False&quot;
            GridLinesVisibility=&quot;All&quot;
            HeadersVisibility=&quot;All&quot;
            SelectionMode=&quot;Single&quot;
            AlternatingRowBackground=&quot;#F5F5F5&quot;
            CellEditEnding=&quot;OnCellEditEnding&quot;&gt;
            
            &lt;controls:DataGrid.Columns&gt;
                &lt;!-- PO Number --&gt;
                &lt;controls:DataGridTextColumn 
                    Header=&quot;PO Number&quot; 
                    Binding=&quot;{Binding PONumber, Mode=TwoWay}&quot;
                    Width=&quot;150&quot;/&gt;

                &lt;!-- Line --&gt;
                &lt;controls:DataGridTextColumn 
                    Header=&quot;Line&quot; 
                    Binding=&quot;{Binding POLine, Mode=TwoWay}&quot;
                    Width=&quot;80&quot;/&gt;

                &lt;!-- Recipient - Using Template Column since WinUI DataGridComboBoxColumn has different API --&gt;
                &lt;controls:DataGridTemplateColumn 
                    Header=&quot;Recipient&quot;
                    Width=&quot;200&quot;&gt;
                    &lt;controls:DataGridTemplateColumn.CellTemplate&gt;
                        &lt;DataTemplate&gt;
                            &lt;TextBlock 
                                Text=&quot;{Binding RecipientName}&quot; 
                                VerticalAlignment=&quot;Center&quot;
                                Padding=&quot;8,0&quot;/&gt;
                        &lt;/DataTemplate&gt;
                    &lt;/controls:DataGridTemplateColumn.CellTemplate&gt;
                    &lt;controls:DataGridTemplateColumn.CellEditingTemplate&gt;
                        &lt;DataTemplate&gt;
                            &lt;ComboBox 
                                SelectedValue=&quot;{Binding RecipientID, Mode=TwoWay}&quot;
                                ItemsSource=&quot;{Binding DataContext.AllRecipients, RelativeSource={RelativeSource Mode=TemplatedParent}}&quot;
                                DisplayMemberPath=&quot;Name&quot;
                                SelectedValuePath=&quot;Id&quot;
                                HorizontalAlignment=&quot;Stretch&quot;/&gt;
                        &lt;/DataTemplate&gt;
                    &lt;/controls:DataGridTemplateColumn.CellEditingTemplate&gt;
                &lt;/controls:DataGridTemplateColumn&gt;

                &lt;!-- Quantity --&gt;
                &lt;controls:DataGridTextColumn 
                    Header=&quot;Quantity&quot; 
                    Binding=&quot;{Binding Quantity, Mode=TwoWay}&quot;
                    Width=&quot;100&quot;/&gt;

                &lt;!-- Part ID (Read-Only, auto-populated) --&gt;
                &lt;controls:DataGridTextColumn 
                    Header=&quot;Part ID&quot; 
                    Binding=&quot;{Binding PartID, Mode=OneWay}&quot;
                    IsReadOnly=&quot;True&quot;
                    Width=&quot;*&quot;/&gt;
            &lt;/controls:DataGrid.Columns&gt;
        &lt;/controls:DataGrid&gt;

        &lt;!-- Action Buttons --&gt;
        &lt;StackPanel Grid.Row=&quot;2&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot;&gt;
            &lt;Button 
                Content=&quot;Add Row&quot; 
                Command=&quot;{x:Bind ViewModel.AddNewRowCommand}&quot;
                Style=&quot;{StaticResource AccentButtonStyle}&quot;/&gt;
            
            &lt;Button 
                Content=&quot;Delete Row&quot; 
                Command=&quot;{x:Bind ViewModel.DeleteSelectedRowCommand}&quot;/&gt;
            
            &lt;Button 
                Content=&quot;Save All Labels&quot; 
                Command=&quot;{x:Bind ViewModel.SaveAllLabelsCommand}&quot;
                Style=&quot;{StaticResource AccentButtonStyle}&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Status Bar --&gt;
        &lt;StackPanel Grid.Row=&quot;3&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot;&gt;
            &lt;ProgressRing 
                IsActive=&quot;{x:Bind ViewModel.IsBusy, Mode=OneWay}&quot;
                Width=&quot;20&quot; 
                Height=&quot;20&quot;/&gt;
            
            &lt;TextBlock 
                Text=&quot;{x:Bind ViewModel.StatusMessage, Mode=OneWay}&quot;
                VerticalAlignment=&quot;Center&quot;/&gt;
            
            &lt;TextBlock 
                Text=&quot;{x:Bind ViewModel.LabelCount, Mode=OneWay}&quot;
                VerticalAlignment=&quot;Center&quot;
                Foreground=&quot;{ThemeResource SystemAccentColor}&quot;/&gt;
            
            &lt;TextBlock 
                Text=&quot;labels ready to save&quot;
                VerticalAlignment=&quot;Center&quot;/&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Routing/Views/RoutingManualEntryView.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using CommunityToolkit.WinUI.UI.Controls;
using MTM_Receiving_Application.Module_Routing.ViewModels;
using MTM_Receiving_Application.Module_Routing.Models;

namespace MTM_Receiving_Application.Module_Routing.Views;

public sealed partial class RoutingManualEntryView : Page
{
    public RoutingManualEntryViewModel ViewModel { get; }

    public RoutingManualEntryView()
    {
        ViewModel = App.GetService&lt;RoutingManualEntryViewModel&gt;();
        InitializeComponent();
    }

    private async void OnPageLoaded(object sender, RoutedEventArgs e)
    {
        await ViewModel.InitializeAsync();
    }

    private async void OnCellEditEnding(object sender, DataGridCellEditEndingEventArgs e)
    {
        // If PO Number column was edited, validate PO
        if (e.Column.Header.ToString() == &quot;PO Number&quot; &amp;&amp; !e.Cancel)
        {
            if (e.Row.DataContext is Model_RoutingLabel label)
            {
                // Defer validation to avoid concurrent access issues
                _ = DispatcherQueue.TryEnqueue(async () =&gt;
                {
                    await ViewModel.ValidatePOAsync(label);
                });
            }
        }
    }
}</file><file path="Module_Routing/Views/RoutingModeSelectionView.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Routing.ViewModels;

namespace MTM_Receiving_Application.Module_Routing.Views;

public sealed partial class RoutingModeSelectionView : Page
{
    public RoutingModeSelectionViewModel ViewModel { get; }

    public RoutingModeSelectionView()
    {
        ViewModel = App.GetService&lt;RoutingModeSelectionViewModel&gt;();
        InitializeComponent();
    }

    private async void OnPageLoaded(object sender, RoutedEventArgs e)
    {
        if (this.Frame != null)
        {
            ViewModel.SetNavigationFrame(this.Frame);
        }
        await ViewModel.InitializeAsync();
    }
}</file><file path="Module_Routing/Views/RoutingWizardStep2View.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using Microsoft.UI.Xaml.Input;
using MTM_Receiving_Application.Module_Routing.ViewModels;

namespace MTM_Receiving_Application.Module_Routing.Views;

public sealed partial class RoutingWizardStep2View : Page
{
    public RoutingWizardStep2ViewModel ViewModel { get; }

    public RoutingWizardStep2View()
    {
        ViewModel = App.GetService&lt;RoutingWizardStep2ViewModel&gt;();
        InitializeComponent();
    }

    private async void OnPageLoaded(object sender, RoutedEventArgs e)
    {
        // Load recipients when page loads
        await ViewModel.LoadRecipientsCommand.ExecuteAsync(null);
    }

    private void ListView_KeyDown(object sender, KeyRoutedEventArgs e)
    {
        if (e.Key == Windows.System.VirtualKey.Enter &amp;&amp; ViewModel.SelectedRecipient != null)
        {
            e.Handled = true;
            ViewModel.ProceedToStep3Command.Execute(null);
        }
    }
}</file><file path="Module_Settings/Interfaces/IService_SettingsWorkflow.cs">using MTM_Receiving_Application.Module_Settings.Enums;
using System;

namespace MTM_Receiving_Application.Module_Settings.Interfaces;

/// &lt;summary&gt;
/// Service for managing Settings workflow navigation and state
/// &lt;/summary&gt;
public interface IService_SettingsWorkflow
{
    /// &lt;summary&gt;
    /// Event raised when workflow step changes
    /// &lt;/summary&gt;
    public event EventHandler&lt;Enum_SettingsWorkflowStep&gt;? StepChanged;

    /// &lt;summary&gt;
    /// Navigate to a specific step in the settings workflow
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;step&quot;&gt;&lt;/param&gt;
    public void GoToStep(Enum_SettingsWorkflowStep step);

    /// &lt;summary&gt;
    /// Go back to the previous step
    /// &lt;/summary&gt;
    public void GoBack();

    /// &lt;summary&gt;
    /// Reset workflow to initial state
    /// &lt;/summary&gt;
    public void Reset();
}</file><file path="Module_Settings/Models/Model_ConnectionTestResult.cs">using CommunityToolkit.Mvvm.ComponentModel;

namespace MTM_Receiving_Application.Module_Settings.Models;

/// &lt;summary&gt;
/// Represents the result of a database connection test (development diagnostics)
/// &lt;/summary&gt;
public partial class Model_ConnectionTestResult : ObservableObject
{
    [ObservableProperty]
    private bool _isConnected;

    [ObservableProperty]
    private string _connectionStatus = string.Empty;

    [ObservableProperty]
    private int _connectionTimeMs;

    [ObservableProperty]
    private string _serverVersion = string.Empty;
}</file><file path="Module_Settings/Models/Model_DaoTestResult.cs">using CommunityToolkit.Mvvm.ComponentModel;

namespace MTM_Receiving_Application.Module_Settings.Models;

/// &lt;summary&gt;
/// Represents a DAO validation result (development diagnostics)
/// &lt;/summary&gt;
public partial class Model_DaoTestResult : ObservableObject
{
    [ObservableProperty]
    private string _daoName = string.Empty;

    [ObservableProperty]
    private bool _isValid;

    [ObservableProperty]
    private string _operationsTested = string.Empty;

    [ObservableProperty]
    private string _statusText = string.Empty;
}</file><file path="Module_Settings/Models/Model_SettingValue.cs">using System;
using System.Text.Json;

namespace MTM_Receiving_Application.Module_Settings.Models;

/// &lt;summary&gt;
/// Helper model for working with typed setting values
/// Provides type-safe conversion from raw string values
/// &lt;/summary&gt;
public class Model_SettingValue
{
    public string RawValue { get; set; } = string.Empty;
    public string DataType { get; set; } = &quot;string&quot;;

    /// &lt;summary&gt;
    /// Returns the raw string value
    /// &lt;/summary&gt;
    public string AsString() =&gt; RawValue ?? string.Empty;

    /// &lt;summary&gt;
    /// Parses the value as an integer (returns 0 if invalid)
    /// &lt;/summary&gt;
    public int AsInt() =&gt; int.TryParse(RawValue, out var val) ? val : 0;

    /// &lt;summary&gt;
    /// Parses the value as a boolean (returns false if invalid)
    /// &lt;/summary&gt;
    public bool AsBool() =&gt; bool.TryParse(RawValue, out var val) &amp;&amp; val;

    /// &lt;summary&gt;
    /// Parses the value as a double (returns 0.0 if invalid)
    /// &lt;/summary&gt;
    public double AsDouble() =&gt; double.TryParse(RawValue, out var val) ? val : 0.0;

    /// &lt;summary&gt;
    /// Deserializes the value as JSON (returns default(T) if invalid)
    /// &lt;/summary&gt;
    public T? AsJson&lt;T&gt;()
    {
        try
        {
            return string.IsNullOrWhiteSpace(RawValue)
                ? default
                : JsonSerializer.Deserialize&lt;T&gt;(RawValue);
        }
        catch
        {
            return default;
        }
    }

    /// &lt;summary&gt;
    /// Returns the value as a strongly-typed object based on DataType
    /// &lt;/summary&gt;
    public object? AsTyped()
    {
        return DataType?.ToLower() switch
        {
            &quot;int&quot; =&gt; AsInt(),
            &quot;boolean&quot; =&gt; AsBool(),
            &quot;double&quot; =&gt; AsDouble(),
            &quot;json&quot; =&gt; RawValue,
            _ =&gt; AsString()
        };
    }
}</file><file path="Module_Settings/Models/Model_StoredProcedureTestResult.cs">using CommunityToolkit.Mvvm.ComponentModel;

namespace MTM_Receiving_Application.Module_Settings.Models;

/// &lt;summary&gt;
/// Represents a stored procedure validation result (development diagnostics)
/// &lt;/summary&gt;
public partial class Model_StoredProcedureTestResult : ObservableObject
{
    [ObservableProperty]
    private string _procedureName = string.Empty;

    [ObservableProperty]
    private bool _isValid;

    [ObservableProperty]
    private int _executionTimeMs;

    [ObservableProperty]
    private string _testDetails = string.Empty;
}</file><file path="Module_Settings/Models/Model_TableTestResult.cs">using CommunityToolkit.Mvvm.ComponentModel;

namespace MTM_Receiving_Application.Module_Settings.Models;

/// &lt;summary&gt;
/// Represents a database table validation result (development diagnostics)
/// &lt;/summary&gt;
public partial class Model_TableTestResult : ObservableObject
{
    [ObservableProperty]
    private string _tableName = string.Empty;

    [ObservableProperty]
    private string _details = string.Empty;

    [ObservableProperty]
    private bool _isValid;

    [ObservableProperty]
    private string _statusText = string.Empty;
}</file><file path="Module_Settings/Services/Service_UserPreferences.cs">using System;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Data.Authentication;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Settings.Interfaces;

namespace MTM_Receiving_Application.Module_Settings.Services;

public class Service_UserPreferences : IService_UserPreferences
{
    private readonly Dao_User _userDao;
    private readonly IService_LoggingUtility _logger;
    private readonly IService_ErrorHandler _errorHandler;

    public Service_UserPreferences(
        Dao_User userDao,
        IService_LoggingUtility logger,
        IService_ErrorHandler errorHandler)
    {
        _userDao = userDao;
        _logger = logger;
        _errorHandler = errorHandler;
    }

    public async Task&lt;Model_Dao_Result&lt;Model_UserPreference&gt;&gt; GetLatestUserPreferenceAsync(string username)
    {
        try
        {
            // BUSINESS RULE: Username normalization
            var normalizedUsername = username?.Trim();
            if (string.IsNullOrWhiteSpace(normalizedUsername))
            {
                return Model_Dao_Result_Factory.Failure&lt;Model_UserPreference&gt;(
                    &quot;Username cannot be empty&quot;);
            }

            // DELEGATE TO DAO
            var userResult = await _userDao.GetUserByWindowsUsernameAsync(normalizedUsername);

            if (!userResult.IsSuccess)
            {
                _logger.LogError(
                   $&quot;Failed to retrieve user {normalizedUsername}: {userResult.ErrorMessage}&quot;, null, &quot;UserPreferences&quot;);
                return Model_Dao_Result_Factory.Failure&lt;Model_UserPreference&gt;(userResult.ErrorMessage);
            }

            if (userResult.Data == null)
            {
                return Model_Dao_Result_Factory.Failure&lt;Model_UserPreference&gt;(&quot;User not found&quot;);
            }

            // Brand-new users must always have usable defaults.
            // Persisted fields may be null if migrations are not yet applied; provide safe fallbacks.
            var preference = new Model_UserPreference
            {
                Username = userResult.Data.WindowsUsername,
                DefaultMode = null,
                DefaultReceivingMode = string.IsNullOrWhiteSpace(userResult.Data.DefaultReceivingMode)
                    ? &quot;guided&quot;
                    : userResult.Data.DefaultReceivingMode,
                DefaultDunnageMode = string.IsNullOrWhiteSpace(userResult.Data.DefaultDunnageMode)
                    ? &quot;guided&quot;
                    : userResult.Data.DefaultDunnageMode
            };

            return Model_Dao_Result_Factory.Success(preference);
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error getting user preference for {username}&quot;, ex, &quot;UserPreferences&quot;);
            return Model_Dao_Result_Factory.Failure&lt;Model_UserPreference&gt;(ex.Message);
        }
    }

    public async Task&lt;Model_Dao_Result&gt; UpdateDefaultModeAsync(string username, string defaultMode)
    {
        try
        {
            var normalizedUsername = username?.Trim();
            if (string.IsNullOrWhiteSpace(normalizedUsername))
            {
                return Model_Dao_Result_Factory.Success();
            }

            var userResult = await _userDao.GetUserByWindowsUsernameAsync(normalizedUsername);
            if (!userResult.IsSuccess || userResult.Data == null)
            {
                _logger.LogWarning($&quot;Default mode update skipped: user not found ({normalizedUsername})&quot;);
                return Model_Dao_Result_Factory.Success();
            }

            var normalizedMode = string.IsNullOrWhiteSpace(defaultMode)
                ? null
                : defaultMode.Trim().ToLowerInvariant();

            var result = await _userDao.UpdateDefaultModeAsync(userResult.Data.EmployeeNumber, normalizedMode);
            if (!result.Success)
            {
                _logger.LogWarning($&quot;Default mode update failed (non-blocking): {result.ErrorMessage}&quot;);
            }

            return Model_Dao_Result_Factory.Success();
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error updating default mode for {username} (non-blocking)&quot;, ex, &quot;UserPreferences&quot;);
            return Model_Dao_Result_Factory.Success();
        }
    }

    public async Task&lt;Model_Dao_Result&gt; UpdateDefaultReceivingModeAsync(string username, string defaultMode)
    {
        try
        {
            var normalizedUsername = username?.Trim();
            if (string.IsNullOrWhiteSpace(normalizedUsername))
            {
                return Model_Dao_Result_Factory.Success();
            }

            var userResult = await _userDao.GetUserByWindowsUsernameAsync(normalizedUsername);
            if (!userResult.IsSuccess || userResult.Data == null)
            {
                _logger.LogWarning($&quot;Receiving default update skipped: user not found ({normalizedUsername})&quot;);
                return Model_Dao_Result_Factory.Success();
            }

            var normalizedMode = string.IsNullOrWhiteSpace(defaultMode)
                ? null
                : defaultMode.Trim().ToLowerInvariant();

            var result = await _userDao.UpdateDefaultReceivingModeAsync(userResult.Data.EmployeeNumber, normalizedMode);
            if (!result.Success)
            {
                _logger.LogWarning($&quot;Receiving default update failed (non-blocking): {result.ErrorMessage}&quot;);
            }

            return Model_Dao_Result_Factory.Success();
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error updating receiving default for {username} (non-blocking)&quot;, ex, &quot;UserPreferences&quot;);
            return Model_Dao_Result_Factory.Success();
        }
    }

    public async Task&lt;Model_Dao_Result&gt; UpdateDefaultDunnageModeAsync(string username, string defaultMode)
    {
        try
        {
            var normalizedUsername = username?.Trim();
            if (string.IsNullOrWhiteSpace(normalizedUsername))
            {
                return Model_Dao_Result_Factory.Success();
            }

            var userResult = await _userDao.GetUserByWindowsUsernameAsync(normalizedUsername);
            if (!userResult.IsSuccess || userResult.Data == null)
            {
                _logger.LogWarning($&quot;Dunnage default update skipped: user not found ({normalizedUsername})&quot;);
                return Model_Dao_Result_Factory.Success();
            }

            var normalizedMode = string.IsNullOrWhiteSpace(defaultMode)
                ? null
                : defaultMode.Trim().ToLowerInvariant();

            var result = await _userDao.UpdateDefaultDunnageModeAsync(userResult.Data.EmployeeNumber, normalizedMode);
            if (!result.Success)
            {
                _logger.LogWarning($&quot;Dunnage default update failed (non-blocking): {result.ErrorMessage}&quot;);
            }

            return Model_Dao_Result_Factory.Success();
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error updating dunnage default for {username} (non-blocking)&quot;, ex, &quot;UserPreferences&quot;);
            return Model_Dao_Result_Factory.Success();
        }
    }
}</file><file path="Module_Settings/Views/View_Settings_DatabaseTest.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Settings.ViewModels;
using System;

namespace MTM_Receiving_Application.Module_Settings.Views;

/// &lt;summary&gt;
/// Settings Database Test page - Development tool for validating database schema, stored procedures, and DAOs
/// &lt;/summary&gt;
public sealed partial class View_Settings_DatabaseTest : Page
{
    public ViewModel_Settings_DatabaseTest? ViewModel { get; private set; }

    public View_Settings_DatabaseTest()
    {
        System.Diagnostics.Debug.WriteLine(&quot;[DatabaseTestView] Constructor started&quot;);

        // CRITICAL: Set ViewModel BEFORE InitializeComponent() for x:Bind to work
        try
        {
            System.Diagnostics.Debug.WriteLine(&quot;[DatabaseTestView] Attempting to get ViewModel from DI&quot;);
            ViewModel = App.GetService&lt;ViewModel_Settings_DatabaseTest&gt;();
            System.Diagnostics.Debug.WriteLine($&quot;[DatabaseTestView] ViewModel obtained: {ViewModel != null}&quot;);

            if (ViewModel == null)
            {
                throw new InvalidOperationException(&quot;Failed to obtain ViewModel from DI - returned null&quot;);
            }
        }
        catch (Exception ex)
        {
            System.Diagnostics.Debug.WriteLine($&quot;[DatabaseTestView] Failed to create ViewModel: {ex.Message}&quot;);
            System.Diagnostics.Debug.WriteLine($&quot;[DatabaseTestView] Exception type: {ex.GetType().FullName}&quot;);
            System.Diagnostics.Debug.WriteLine($&quot;[DatabaseTestView] Stack trace: {ex.StackTrace}&quot;);

            // Cannot continue without ViewModel for x:Bind
            throw;
        }

        try
        {
            // Initialize component AFTER ViewModel is set (required for x:Bind)
            System.Diagnostics.Debug.WriteLine(&quot;[DatabaseTestView] Calling InitializeComponent()&quot;);
            InitializeComponent();
            System.Diagnostics.Debug.WriteLine(&quot;[DatabaseTestView] InitializeComponent() completed&quot;);
        }
        catch (Exception ex)
        {
            System.Diagnostics.Debug.WriteLine($&quot;[DatabaseTestView] InitializeComponent() FAILED: {ex.Message}&quot;);
            System.Diagnostics.Debug.WriteLine($&quot;[DatabaseTestView] Exception type: {ex.GetType().FullName}&quot;);
            System.Diagnostics.Debug.WriteLine($&quot;[DatabaseTestView] Stack trace: {ex.StackTrace}&quot;);
            throw; // Re-throw to show in navigation error dialog
        }

        System.Diagnostics.Debug.WriteLine(&quot;[DatabaseTestView] Setting DataContext&quot;);
        DataContext = ViewModel;

        // Attach focus service if available
        try
        {
            System.Diagnostics.Debug.WriteLine(&quot;[DatabaseTestView] Attempting to get Focus service&quot;);
            var focusService = App.GetService&lt;IService_Focus&gt;();
            if (focusService != null)
            {
                System.Diagnostics.Debug.WriteLine(&quot;[DatabaseTestView] Attaching focus service&quot;);
                focusService.AttachFocusOnVisibility(this);
            }
            else
            {
                System.Diagnostics.Debug.WriteLine(&quot;[DatabaseTestView] Focus service is null&quot;);
            }
        }
        catch (Exception ex)
        {
            System.Diagnostics.Debug.WriteLine($&quot;[DatabaseTestView] Focus service failed (non-critical): {ex.Message}&quot;);
        }

        // Run tests after view is loaded
        System.Diagnostics.Debug.WriteLine(&quot;[DatabaseTestView] Attaching Loaded event handler&quot;);
        this.Loaded += OnLoaded;

        System.Diagnostics.Debug.WriteLine(&quot;[DatabaseTestView] Constructor completed&quot;);
    }

    private async void OnLoaded(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
    {
        System.Diagnostics.Debug.WriteLine(&quot;[DatabaseTestView] OnLoaded event fired&quot;);
        try
        {
            // Run tests after UI is fully initialized
            if (ViewModel?.RunAllTestsCommand != null)
            {
                System.Diagnostics.Debug.WriteLine(&quot;[DatabaseTestView] Executing RunAllTestsCommand&quot;);
                await ViewModel.RunAllTestsCommand.ExecuteAsync(null);
                System.Diagnostics.Debug.WriteLine(&quot;[DatabaseTestView] RunAllTestsCommand completed&quot;);
                UpdateTabVisibility();
            }
            else
            {
                System.Diagnostics.Debug.WriteLine($&quot;[DatabaseTestView] Cannot run tests - ViewModel: {ViewModel != null}, Command: {ViewModel?.RunAllTestsCommand != null}&quot;);
            }
        }
        catch (Exception ex)
        {
            System.Diagnostics.Debug.WriteLine($&quot;[DatabaseTestView] Error running database tests: {ex.Message}&quot;);
            System.Diagnostics.Debug.WriteLine($&quot;[DatabaseTestView] Exception type: {ex.GetType().FullName}&quot;);
            System.Diagnostics.Debug.WriteLine($&quot;[DatabaseTestView] Stack trace: {ex.StackTrace}&quot;);
        }
    }

    // Tab click handlers
    private void OnSchemaTabClick(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
    {
        if (ViewModel != null)
        {
            ViewModel.SelectedTab = &quot;Schema&quot;;
            UpdateTabVisibility();
        }
    }

    private void OnStoredProceduresTabClick(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
    {
        if (ViewModel != null)
        {
            ViewModel.SelectedTab = &quot;StoredProcedures&quot;;
            UpdateTabVisibility();
        }
    }

    private void OnDaosTabClick(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
    {
        if (ViewModel != null)
        {
            ViewModel.SelectedTab = &quot;DAOs&quot;;
            UpdateTabVisibility();
        }
    }

    private void OnLogsTabClick(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
    {
        if (ViewModel != null)
        {
            ViewModel.SelectedTab = &quot;Logs&quot;;
            UpdateTabVisibility();
        }
    }

    private void UpdateTabVisibility()
    {
        if (ViewModel == null)
            return;

        System.Diagnostics.Debug.WriteLine($&quot;[DatabaseTestView] Selected tab: {ViewModel.SelectedTab}&quot;);

        SchemaTabContent.Visibility = ViewModel.SelectedTab == &quot;Schema&quot;
            ? Microsoft.UI.Xaml.Visibility.Visible
            : Microsoft.UI.Xaml.Visibility.Collapsed;

        StoredProceduresTabContent.Visibility = ViewModel.SelectedTab == &quot;StoredProcedures&quot;
            ? Microsoft.UI.Xaml.Visibility.Visible
            : Microsoft.UI.Xaml.Visibility.Collapsed;

        DaosTabContent.Visibility = ViewModel.SelectedTab == &quot;DAOs&quot;
            ? Microsoft.UI.Xaml.Visibility.Visible
            : Microsoft.UI.Xaml.Visibility.Collapsed;

        LogsTabContent.Visibility = ViewModel.SelectedTab == &quot;Logs&quot;
            ? Microsoft.UI.Xaml.Visibility.Visible
            : Microsoft.UI.Xaml.Visibility.Collapsed;
    }
}</file><file path="Module_Shared/ViewModels/ViewModel_Shared_MainWindow.cs">using CommunityToolkit.Mvvm.ComponentModel;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Systems;
using Microsoft.UI.Xaml.Controls;
using System.ComponentModel;

namespace MTM_Receiving_Application.Module_Shared.ViewModels;

public partial class ViewModel_Shared_MainWindow : ViewModel_Shared_Base
{
    private readonly IService_UserSessionManager _sessionManager;
    public IService_Notification NotificationService { get; }

    [ObservableProperty]
    private string _userDisplayText = &quot;Not Logged In&quot;;

    public ViewModel_Shared_MainWindow(
        IService_UserSessionManager sessionManager,
        IService_Notification notificationService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger)
        : base(errorHandler, logger)
    {
        _sessionManager = sessionManager;
        NotificationService = notificationService;
        NotificationService.PropertyChanged += OnNotificationServicePropertyChanged;

        if (_sessionManager.CurrentSession?.User != null)
        {
            UpdateUserDisplay(_sessionManager.CurrentSession.User);
        }
    }

    private void OnNotificationServicePropertyChanged(object? sender, PropertyChangedEventArgs e)
    {
        if (e.PropertyName == nameof(IService_Notification.StatusSeverity))
        {
            OnPropertyChanged(nameof(WinUIStatusSeverity));
        }
    }

    public InfoBarSeverity WinUIStatusSeverity
    {
        get
        {
            return NotificationService.StatusSeverity switch
            {
                Module_Core.Models.Enums.InfoBarSeverity.Informational =&gt; InfoBarSeverity.Informational,
                Module_Core.Models.Enums.InfoBarSeverity.Success =&gt; InfoBarSeverity.Success,
                Module_Core.Models.Enums.InfoBarSeverity.Warning =&gt; InfoBarSeverity.Warning,
                Module_Core.Models.Enums.InfoBarSeverity.Error =&gt; InfoBarSeverity.Error,
                _ =&gt; InfoBarSeverity.Informational
            };
        }
    }

    private void UpdateUserDisplay(Model_User user)
    {
        UserDisplayText = user.DisplayName;
    }
}</file><file path="Module_Volvo/Contracts/IService_Volvo.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Volvo.Models;

namespace MTM_Receiving_Application.Module_Volvo.Contracts;

/// &lt;summary&gt;
/// Service interface for Volvo dunnage requisition business logic
/// Handles component explosion, CSV generation, email formatting, and shipment management
/// &lt;/summary&gt;
public interface IService_Volvo
{
    /// &lt;summary&gt;
    /// Calculates component explosion and aggregates piece counts for all parts in shipment
    /// Example: If V-EMB-500 (3 skids) includes components V-EMB-2 and V-EMB-92,
    /// result includes V-EMB-500: 264 pcs + V-EMB-2: 3 pcs + V-EMB-92: 3 pcs
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;lines&quot;&gt;List of shipment lines with part numbers and skid counts&lt;/param&gt;
    /// &lt;returns&gt;Dictionary of part numbers to total piece counts (includes parent parts + components)&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;Dictionary&lt;string, int&gt;&gt;&gt; CalculateComponentExplosionAsync(
        List&lt;Model_VolvoShipmentLine&gt; lines);

    /// &lt;summary&gt;
    /// Generates CSV file for LabelView 2022 label printing
    /// Format: Material,Quantity,Employee,Date,Time,Receiver,Notes
    /// Saved to: %APPDATA%\MTM_Receiving_Application\Volvo\Labels\Shipment_[ID]_[Date].csv
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipmentId&quot;&gt;Shipment ID to generate labels for&lt;/param&gt;
    /// &lt;returns&gt;File path where CSV was written&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;string&gt;&gt; GenerateLabelCsvAsync(int shipmentId);

    /// &lt;summary&gt;
    /// Formats email text for PO requisition (with discrepancy notice if applicable)
    /// Includes: Greeting, discrepancy table (if any), requested lines, signature
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipment&quot;&gt;Shipment header&lt;/param&gt;
    /// &lt;param name=&quot;lines&quot;&gt;Shipment lines with discrepancy data&lt;/param&gt;
    /// &lt;param name=&quot;requestedLines&quot;&gt;Aggregated component explosion results&lt;/param&gt;
    /// &lt;returns&gt;Formatted email text ready to copy to Outlook&lt;/returns&gt;
    public Task&lt;string&gt; FormatEmailTextAsync(
        Model_VolvoShipment shipment,
        List&lt;Model_VolvoShipmentLine&gt; lines,
        Dictionary&lt;string, int&gt;? requestedLines = null);

    /// &lt;summary&gt;
    /// Formats email data for PO requisition (structured for preview and HTML export)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipment&quot;&gt;Shipment header&lt;/param&gt;
    /// &lt;param name=&quot;lines&quot;&gt;Shipment lines with discrepancy data&lt;/param&gt;
    /// &lt;param name=&quot;requestedLines&quot;&gt;Aggregated component explosion results&lt;/param&gt;
    /// &lt;returns&gt;Structured email data&lt;/returns&gt;
    public Task&lt;Model_VolvoEmailData&gt; FormatEmailDataAsync(
        Model_VolvoShipment shipment,
        List&lt;Model_VolvoShipmentLine&gt; lines,
        Dictionary&lt;string, int&gt;? requestedLines = null);

    /// &lt;summary&gt;
    /// Converts structured email data to HTML format with tables for Outlook paste
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;emailData&quot;&gt;Structured email data&lt;/param&gt;
    /// &lt;returns&gt;HTML formatted email&lt;/returns&gt;
    public string FormatEmailAsHtml(Model_VolvoEmailData emailData);

    /// &lt;summary&gt;
    /// Validates shipment data before save
    /// Centralized validation logic to ensure data integrity
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipment&quot;&gt;Shipment header to validate&lt;/param&gt;
    /// &lt;param name=&quot;lines&quot;&gt;Shipment lines to validate&lt;/param&gt;
    /// &lt;returns&gt;Validation result with error message if failed&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&gt; ValidateShipmentAsync(
        Model_VolvoShipment shipment,
        List&lt;Model_VolvoShipmentLine&gt; lines);

    /// &lt;summary&gt;
    /// Saves shipment and lines with status=&apos;pending_po&apos;
    /// Validates: Only one pending shipment allowed at a time
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipment&quot;&gt;Shipment header data&lt;/param&gt;
    /// &lt;param name=&quot;lines&quot;&gt;Shipment line items&lt;/param&gt;
    /// &lt;param name=&quot;overwriteExisting&quot;&gt;If true, deletes any existing pending shipment before saving&lt;/param&gt;
    /// &lt;returns&gt;Tuple of (ShipmentId, ShipmentNumber) for the saved shipment&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;(int ShipmentId, int ShipmentNumber)&gt;&gt; SaveShipmentAsync(
        Model_VolvoShipment shipment,
        List&lt;Model_VolvoShipmentLine&gt; lines,
        bool overwriteExisting = false);

    /// &lt;summary&gt;
    /// Gets pending shipment if one exists (status=&apos;pending_po&apos;)
    /// &lt;/summary&gt;
    /// &lt;returns&gt;Pending shipment or null if none exists&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;Model_VolvoShipment?&gt;&gt; GetPendingShipmentAsync();

    /// &lt;summary&gt;
    /// Gets pending shipment with all line items
    /// &lt;/summary&gt;
    /// &lt;returns&gt;Tuple of (shipment, lines) or null if no pending shipment&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;(Model_VolvoShipment? Shipment, List&lt;Model_VolvoShipmentLine&gt; Lines)&gt;&gt; GetPendingShipmentWithLinesAsync();

    /// &lt;summary&gt;
    /// Completes shipment with PO and Receiver numbers
    /// Sets status=&apos;completed&apos; and is_archived=1
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipmentId&quot;&gt;Shipment ID to complete&lt;/param&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;Purchase order number from purchasing department&lt;/param&gt;
    /// &lt;param name=&quot;receiverNumber&quot;&gt;Receiver number from Infor Visual&lt;/param&gt;
    /// &lt;returns&gt;Success/failure result&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&gt; CompleteShipmentAsync(int shipmentId, string poNumber, string receiverNumber);

    /// &lt;summary&gt;
    /// Gets all active Volvo parts for dropdown population
    /// &lt;/summary&gt;
    /// &lt;returns&gt;List of active parts (is_active=1)&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoPart&gt;&gt;&gt; GetActivePartsAsync();

    /// &lt;summary&gt;
    /// Gets shipment history with filtering
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;startDate&quot;&gt;Start date for filter&lt;/param&gt;
    /// &lt;param name=&quot;endDate&quot;&gt;End date for filter&lt;/param&gt;
    /// &lt;param name=&quot;status&quot;&gt;Status filter (&apos;pending_po&apos;, &apos;completed&apos;, or &apos;all&apos;)
    /// &lt;/param&gt;
    /// &lt;returns&gt;List of shipments matching filters&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoShipment&gt;&gt;&gt; GetHistoryAsync(
        DateTime startDate,
        DateTime endDate,
        string status = &quot;all&quot;);

    /// &lt;summary&gt;
    /// Gets all shipment lines for a specific shipment
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipmentId&quot;&gt;Shipment ID&lt;/param&gt;
    /// &lt;returns&gt;List of shipment lines&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoShipmentLine&gt;&gt;&gt; GetShipmentLinesAsync(int shipmentId);

    /// &lt;summary&gt;
    /// Updates an existing shipment and its lines
    /// Regenerates CSV if applicable
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipment&quot;&gt;Updated shipment data&lt;/param&gt;
    /// &lt;param name=&quot;lines&quot;&gt;Updated shipment lines&lt;/param&gt;
    /// &lt;returns&gt;Success/failure result&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&gt; UpdateShipmentAsync(
        Model_VolvoShipment shipment,
        List&lt;Model_VolvoShipmentLine&gt; lines);

    /// &lt;summary&gt;
    /// Exports shipment history to CSV format
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;startDate&quot;&gt;Start date for filter&lt;/param&gt;
    /// &lt;param name=&quot;endDate&quot;&gt;End date for filter&lt;/param&gt;
    /// &lt;param name=&quot;status&quot;&gt;Status filter&lt;/param&gt;
    /// &lt;returns&gt;CSV content as string&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;string&gt;&gt; ExportHistoryToCsvAsync(
        DateTime startDate,
        DateTime endDate,
        string status = &quot;all&quot;);
}</file><file path="Module_Volvo/Contracts/IService_VolvoMasterData.cs">using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Volvo.Models;

namespace MTM_Receiving_Application.Module_Volvo.Contracts;

/// &lt;summary&gt;
/// Service interface for managing Volvo parts master data
/// &lt;/summary&gt;
public interface IService_VolvoMasterData
{
    /// &lt;summary&gt;
    /// Gets all parts from the master catalog
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;includeInactive&quot;&gt;Include deactivated parts&lt;/param&gt;
    /// &lt;returns&gt;List of parts&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoPart&gt;&gt;&gt; GetAllPartsAsync(bool includeInactive = false);

    /// &lt;summary&gt;
    /// Gets a specific part by part number
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;partNumber&quot;&gt;Part number to retrieve&lt;/param&gt;
    /// &lt;returns&gt;Part details or null if not found&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;Model_VolvoPart?&gt;&gt; GetPartByNumberAsync(string partNumber);

    /// &lt;summary&gt;
    /// Adds a new part to the master catalog
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;part&quot;&gt;Part to add&lt;/param&gt;
    /// &lt;param name=&quot;components&quot;&gt;Optional component relationships&lt;/param&gt;
    /// &lt;returns&gt;Success result&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&gt; AddPartAsync(Model_VolvoPart part, List&lt;Model_VolvoPartComponent&gt;? components = null);

    /// &lt;summary&gt;
    /// Updates an existing part in the master catalog
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;part&quot;&gt;Part with updated values&lt;/param&gt;
    /// &lt;param name=&quot;components&quot;&gt;Updated component relationships (replaces existing)&lt;/param&gt;
    /// &lt;returns&gt;Success result&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&gt; UpdatePartAsync(Model_VolvoPart part, List&lt;Model_VolvoPartComponent&gt;? components = null);

    /// &lt;summary&gt;
    /// Deactivates a part (soft delete - preserves historical integrity)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;partNumber&quot;&gt;Part number to deactivate&lt;/param&gt;
    /// &lt;returns&gt;Success result&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&gt; DeactivatePartAsync(string partNumber);

    /// &lt;summary&gt;
    /// Gets all components for a specific part
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;partNumber&quot;&gt;Part number&lt;/param&gt;
    /// &lt;returns&gt;List of components&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoPartComponent&gt;&gt;&gt; GetComponentsAsync(string partNumber);

    public Task&lt;Model_Dao_Result&lt;(int New, int Updated, int Unchanged)&gt;&gt; ImportCsvAsync(string csvFilePath);

    /// &lt;summary&gt;
    /// Exports all parts to CSV file
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;csvFilePath&quot;&gt;Path where CSV should be saved&lt;/param&gt;
    /// &lt;param name=&quot;includeInactive&quot;&gt;Include deactivated parts&lt;/param&gt;
    /// &lt;returns&gt;Success result with file path&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;string&gt;&gt; ExportCsvAsync(string csvFilePath, bool includeInactive = false);
}</file><file path="Module_Volvo/Interfaces/IDao_VolvoPart.cs">using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Volvo.Models;

namespace MTM_Receiving_Application.Module_Volvo.Interfaces;

/// &lt;summary&gt;
/// Interface for Volvo part data access operations
/// Created for testability and dependency injection
/// &lt;/summary&gt;
public interface IDao_VolvoPart
{
    Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoPart&gt;&gt;&gt; GetAllAsync(bool includeInactive = false);
    Task&lt;Model_Dao_Result&lt;Model_VolvoPart&gt;&gt; GetByPartNumberAsync(string partNumber);
    Task&lt;Model_Dao_Result&lt;int&gt;&gt; InsertAsync(Model_VolvoPart part);
    Task&lt;Model_Dao_Result&gt; UpdateAsync(Model_VolvoPart part);
    Task&lt;Model_Dao_Result&gt; DeactivateAsync(string partNumber);
}</file><file path="Module_Volvo/Interfaces/IDao_VolvoShipment.cs">using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Volvo.Models;

namespace MTM_Receiving_Application.Module_Volvo.Interfaces;

/// &lt;summary&gt;
/// Interface for Volvo shipment data access operations
/// Created for testability and dependency injection
/// &lt;/summary&gt;
public interface IDao_VolvoShipment
{
    Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoShipment&gt;&gt;&gt; GetAllAsync(bool includeArchived = false);
    Task&lt;Model_Dao_Result&lt;Model_VolvoShipment&gt;&gt; GetByIdAsync(int shipmentId);
    Task&lt;Model_Dao_Result&lt;Model_VolvoShipment&gt;&gt; GetPendingAsync();
    Task&lt;Model_Dao_Result&lt;int&gt;&gt; InsertAsync(Model_VolvoShipment shipment);
    Task&lt;Model_Dao_Result&gt; UpdateAsync(Model_VolvoShipment shipment);
    Task&lt;Model_Dao_Result&gt; ArchiveAsync(int shipmentId);
}</file><file path="Module_Volvo/Interfaces/IDao_VolvoShipmentLine.cs">using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Volvo.Models;

namespace MTM_Receiving_Application.Module_Volvo.Interfaces;

/// &lt;summary&gt;
/// Interface for Volvo shipment line data access operations
/// Created for testability and dependency injection
/// &lt;/summary&gt;
public interface IDao_VolvoShipmentLine
{
    Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoShipmentLine&gt;&gt;&gt; GetByShipmentIdAsync(int shipmentId);
    Task&lt;Model_Dao_Result&lt;int&gt;&gt; InsertAsync(Model_VolvoShipmentLine line);
    Task&lt;Model_Dao_Result&gt; UpdateAsync(Model_VolvoShipmentLine line);
    Task&lt;Model_Dao_Result&gt; DeleteAsync(int lineId);
}</file><file path="Module_Volvo/Models/Model_EmailRecipient.cs">using System.Text.Json.Serialization;

namespace MTM_Receiving_Application.Module_Volvo.Models;

/// &lt;summary&gt;
/// Represents an email recipient with name and email address
/// &lt;/summary&gt;
public class Model_EmailRecipient
{
    [JsonPropertyName(&quot;name&quot;)]
    public string Name { get; set; } = string.Empty;

    [JsonPropertyName(&quot;email&quot;)]
    public string Email { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Formats the recipient in Outlook format: &quot;Name&quot; &amp;lt;email@domain.com&amp;gt;
    /// &lt;/summary&gt;
    public string ToOutlookFormat()
    {
        return $&quot;\&quot;{Name}\&quot; &lt;{Email}&gt;&quot;;
    }
}</file><file path="Module_Volvo/Models/Model_VolvoEmailData.cs">using System.Collections.Generic;

namespace MTM_Receiving_Application.Module_Volvo.Models;

/// &lt;summary&gt;
/// Structured email data for PO requisition
/// Separates email content into logical sections for display and formatting
/// &lt;/summary&gt;
public class Model_VolvoEmailData
{
    /// &lt;summary&gt;
    /// Email subject line
    /// &lt;/summary&gt;
    public string Subject { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Greeting text
    /// &lt;/summary&gt;
    public string Greeting { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Main message body
    /// &lt;/summary&gt;
    public string Message { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// List of discrepancy line items (empty if no discrepancies)
    /// &lt;/summary&gt;
    public List&lt;DiscrepancyLineItem&gt; Discrepancies { get; set; } = new();

    /// &lt;summary&gt;
    /// Requested parts/quantities after component explosion
    /// &lt;/summary&gt;
    public Dictionary&lt;string, int&gt; RequestedLines { get; set; } = new();

    /// &lt;summary&gt;
    /// Additional notes (optional)
    /// &lt;/summary&gt;
    public string? AdditionalNotes { get; set; }

    /// &lt;summary&gt;
    /// Email signature
    /// &lt;/summary&gt;
    public string Signature { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Represents a discrepancy line item for table display
    /// &lt;/summary&gt;
    public class DiscrepancyLineItem
    {
        public string PartNumber { get; set; } = string.Empty;
        public int PacklistQty { get; set; }
        public int ReceivedQty { get; set; }
        public int Difference { get; set; }
        public string Note { get; set; } = string.Empty;
    }
}</file><file path="Module_Volvo/Models/Model_VolvoPartComponent.cs">namespace MTM_Receiving_Application.Module_Volvo.Models;

/// &lt;summary&gt;
/// Represents a component relationship for Volvo parts (component explosion)
/// Maps to volvo_part_components database table
/// Example: V-EMB-500 includes 1 V-EMB-2 and 1 V-EMB-92
/// &lt;/summary&gt;
public class Model_VolvoPartComponent
{
    /// &lt;summary&gt;
    /// Auto-increment primary key
    /// &lt;/summary&gt;
    public int Id { get; set; }

    /// &lt;summary&gt;
    /// The parent part number (e.g., V-EMB-500)
    /// &lt;/summary&gt;
    public string ParentPartNumber { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// The component part number included with the parent (e.g., V-EMB-2)
    /// &lt;/summary&gt;
    public string ComponentPartNumber { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Quantity of this component included per skid of the parent part
    /// Usually 1, but can be higher (e.g., V-EMB-780 includes 3 V-EMB-26)
    /// &lt;/summary&gt;
    public int Quantity { get; set; } = 1;

    /// &lt;summary&gt;
    /// Quantity per skid for the component part (from volvo_masterdata)
    /// Used for calculating total piece count during component explosion
    /// &lt;/summary&gt;
    public int ComponentQuantityPerSkid { get; set; }
}</file><file path="Module_Volvo/Models/Model_VolvoShipment.cs">using System;

namespace MTM_Receiving_Application.Module_Volvo.Models;

/// &lt;summary&gt;
/// Represents a Volvo dunnage shipment header
/// Maps to volvo_label_data database table
/// &lt;/summary&gt;
public class Model_VolvoShipment
{
    /// &lt;summary&gt;
    /// Auto-increment primary key
    /// &lt;/summary&gt;
    public int Id { get; set; }

    /// &lt;summary&gt;
    /// Date of shipment arrival
    /// &lt;/summary&gt;
    public DateTime ShipmentDate { get; set; } = DateTime.Today;

    /// &lt;summary&gt;
    /// Auto-generated sequential number for the day (resets daily)
    /// Example: Shipment #1, Shipment #2 for the same date
    /// &lt;/summary&gt;
    public int ShipmentNumber { get; set; }

    /// &lt;summary&gt;
    /// Purchase order number (filled after purchasing department provides it)
    /// NULL until shipment is completed
    /// &lt;/summary&gt;
    public string? PONumber { get; set; }

    /// &lt;summary&gt;
    /// Receiver number from Infor Visual (filled after PO receiving)
    /// NULL until shipment is completed
    /// &lt;/summary&gt;
    public string? ReceiverNumber { get; set; }

    /// &lt;summary&gt;
    /// Employee number from authentication context
    /// &lt;/summary&gt;
    public string EmployeeNumber { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Optional notes about the shipment
    /// &lt;/summary&gt;
    public string? Notes { get; set; }

    /// &lt;summary&gt;
    /// Status: &apos;pending_po&apos; (awaiting PO from purchasing) or &apos;completed&apos; (PO/Receiver entered)
    /// &lt;/summary&gt;
    public string Status { get; set; } = &quot;pending_po&quot;;

    /// &lt;summary&gt;
    /// Timestamp when shipment was created
    /// &lt;/summary&gt;
    public DateTime CreatedDate { get; set; } = DateTime.Now;

    /// &lt;summary&gt;
    /// Timestamp when shipment was last modified
    /// &lt;/summary&gt;
    public DateTime ModifiedDate { get; set; } = DateTime.Now;

    /// &lt;summary&gt;
    /// Flag indicating if shipment has been archived to history
    /// Set to true when status changes to &apos;completed&apos;
    /// &lt;/summary&gt;
    public bool IsArchived { get; set; } = false;
}</file><file path="Module_Volvo/Models/VolvoShipmentStatus.cs">namespace MTM_Receiving_Application.Module_Volvo.Models;

/// &lt;summary&gt;
/// Constants for Volvo shipment status values
/// Prevents magic strings throughout the codebase
/// &lt;/summary&gt;
public static class VolvoShipmentStatus
{
    /// &lt;summary&gt;
    /// Shipment is pending PO creation (user has not yet completed with PO/Receiver numbers)
    /// &lt;/summary&gt;
    public const string PendingPo = &quot;pending_po&quot;;

    /// &lt;summary&gt;
    /// Shipment has been completed with PO and Receiver numbers
    /// &lt;/summary&gt;
    public const string Completed = &quot;completed&quot;;

    /// &lt;summary&gt;
    /// Shipment has been archived (soft delete)
    /// &lt;/summary&gt;
    public const string Archived = &quot;archived&quot;;
}</file><file path="Module_Volvo/Services/IService_VolvoAuthorization.cs">using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;

namespace MTM_Receiving_Application.Module_Volvo.Services;

/// &lt;summary&gt;
/// Authorization service for Volvo module operations
/// Implements role-based access control (RBAC) for Volvo features
/// &lt;/summary&gt;
public interface IService_VolvoAuthorization
{
    /// &lt;summary&gt;
    /// Checks if current user can create/modify Volvo shipments
    /// &lt;/summary&gt;
    Task&lt;Model_Dao_Result&gt; CanManageShipmentsAsync();

    /// &lt;summary&gt;
    /// Checks if current user can manage Volvo master data (parts, components)
    /// &lt;/summary&gt;
    Task&lt;Model_Dao_Result&gt; CanManageMasterDataAsync();

    /// &lt;summary&gt;
    /// Checks if current user can complete/close Volvo shipments
    /// &lt;/summary&gt;
    Task&lt;Model_Dao_Result&gt; CanCompleteShipmentsAsync();

    /// &lt;summary&gt;
    /// Checks if current user can generate labels for Volvo shipments
    /// &lt;/summary&gt;
    Task&lt;Model_Dao_Result&gt; CanGenerateLabelsAsync();
}</file><file path="Module_Volvo/Views/VolvoPartAddEditDialog.xaml">&lt;ContentDialog
    x:Class=&quot;MTM_Receiving_Application.Module_Volvo.Views.VolvoPartAddEditDialog&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    mc:Ignorable=&quot;d&quot;
    Title=&quot;Add/Edit Volvo Part&quot;
    PrimaryButtonText=&quot;Save&quot;
    CloseButtonText=&quot;Cancel&quot;
    DefaultButton=&quot;Primary&quot;
    PrimaryButtonClick=&quot;OnSaveClicked&quot;
    Width=&quot;500&quot;&gt;

    &lt;StackPanel Spacing=&quot;16&quot; Padding=&quot;8&quot;&gt;
        &lt;!-- Part Number --&gt;
        &lt;TextBox x:Name=&quot;PartNumberTextBox&quot;
                 Header=&quot;Part Number&quot;
                 PlaceholderText=&quot;e.g., V-EMB-500&quot;
                 MaxLength=&quot;50&quot;/&gt;

        &lt;!-- Quantity Per Skid --&gt;
        &lt;NumberBox x:Name=&quot;QuantityPerSkidNumberBox&quot;
                   Header=&quot;Quantity Per Skid&quot;
                   PlaceholderText=&quot;e.g., 88&quot;
                   Minimum=&quot;0&quot;
                   Maximum=&quot;10000&quot;
                   SpinButtonPlacementMode=&quot;Inline&quot;
                   Value=&quot;0&quot;/&gt;

        &lt;!-- Historical Integrity Warning (Edit Mode Only) --&gt;
        &lt;InfoBar x:Name=&quot;EditModeWarning&quot;
                 Severity=&quot;Warning&quot;
                 IsOpen=&quot;False&quot;
                 IsClosable=&quot;False&quot;
                 Message=&quot;Changes to quantity will NOT affect past shipments. Historical piece counts are preserved.&quot;/&gt;

        &lt;!-- Component Section (Simplified - Future Enhancement) --&gt;
        &lt;Expander Header=&quot;Components (Advanced)&quot; IsExpanded=&quot;False&quot;&gt;
            &lt;StackPanel Spacing=&quot;8&quot; Padding=&quot;8&quot;&gt;
                &lt;TextBlock Text=&quot;Component management will be available in a future update.&quot; 
                          Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                          Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                &lt;TextBlock Text=&quot;For now, use CSV import to define components.&quot; 
                          Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                          Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
            &lt;/StackPanel&gt;
        &lt;/Expander&gt;
    &lt;/StackPanel&gt;
&lt;/ContentDialog&gt;</file><file path="MTM_Receiving_Application.Tests/Fixtures/DatabaseFixture.cs">using System;

namespace MTM_Receiving_Application.Tests.Fixtures;

/// &lt;summary&gt;
/// Shared test fixture for database-related tests.
/// Keep this lightweight; prefer per-test isolation unless explicitly needed.
/// &lt;/summary&gt;
public sealed class DatabaseFixture : IDisposable
{
    public DatabaseFixture()
    {
        // Intentionally empty: initialize per-module DB helpers when needed.
    }

    public void Dispose()
    {
        // Intentionally empty: dispose connections/resources when added.
    }
}</file><file path="MTM_Receiving_Application.Tests/Fixtures/ServiceCollectionFixture.cs">using System;

namespace MTM_Receiving_Application.Tests.Fixtures;

/// &lt;summary&gt;
/// Shared test fixture for DI container setup.
/// This can be expanded to register services/DAOs with test doubles.
/// &lt;/summary&gt;
public sealed class ServiceCollectionFixture : IDisposable
{
    public ServiceCollectionFixture()
    {
        // Intentionally empty: register services in tests as needed.
    }

    public void Dispose()
    {
        // Intentionally empty: dispose provider/resources when added.
    }
}</file><file path="MTM_Receiving_Application.Tests/Helpers/TestHelper.cs">using System;

namespace MTM_Receiving_Application.Tests.Helpers;

public static class TestHelper
{
    public static string NewGuidString() =&gt; Guid.NewGuid().ToString(&quot;N&quot;);
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_BooleanToVisibility_Tests.cs">using Microsoft.UI.Xaml;
using MTM_Receiving_Application.Module_Core.Converters;

namespace MTM_Receiving_Application.Tests.Module_Core.Converters;

/// &lt;summary&gt;
/// Unit tests for &lt;see cref=&quot;Converter_BooleanToVisibility&quot;/&gt;.
/// Tests conversion of boolean values to WinUI Visibility with optional inverse parameter.
/// &lt;/summary&gt;
[Trait(&quot;Category&quot;, &quot;Unit&quot;)]
[Trait(&quot;Type&quot;, &quot;Converter&quot;)]
public class Converter_BooleanToVisibility_Tests
{
    private readonly Converter_BooleanToVisibility _sut;

    public Converter_BooleanToVisibility_Tests()
    {
        _sut = new();
    }

    [Theory]
    [InlineData(true, null, Visibility.Visible)]
    [InlineData(false, null, Visibility.Collapsed)]
    [InlineData(true, &quot;Inverse&quot;, Visibility.Collapsed)]
    [InlineData(false, &quot;Inverse&quot;, Visibility.Visible)]
    [InlineData(true, &quot;inverse&quot;, Visibility.Collapsed)]
    [InlineData(false, &quot;inverse&quot;, Visibility.Visible)]
    public void Convert_WithBooleanValue_ReturnsExpectedVisibility(bool input, string? parameter, Visibility expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(Visibility), parameter, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Fact]
    public void Convert_WithNullValue_ReturnsCollapsed()
    {
        // Act
        var result = _sut.Convert(null, typeof(Visibility), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(Visibility.Collapsed);
    }

    [Theory]
    [InlineData(&quot;true&quot;)]
    [InlineData(&quot;false&quot;)]
    [InlineData(1)]
    [InlineData(0)]
    public void Convert_WithNonBooleanValue_ReturnsCollapsed(object input)
    {
        // Act
        var result = _sut.Convert(input, typeof(Visibility), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(Visibility.Collapsed);
    }

    [Fact]
    public void Convert_WithUnknownParameter_IgnoresParameter()
    {
        // Act
        var result = _sut.Convert(true, typeof(Visibility), &quot;SomeOtherParam&quot;, &quot;en-US&quot;);

        // Assert
        result.Should().Be(Visibility.Visible);
    }

    [Fact]
    public void ConvertBack_ThrowsNotImplementedException()
    {
        // Act
        Action act = () =&gt; _sut.ConvertBack(Visibility.Visible, typeof(bool), null, &quot;en-US&quot;);

        // Assert
        act.Should().Throw&lt;NotImplementedException&gt;();
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_BoolToString_Tests.cs">using MTM_Receiving_Application.Module_Core.Converters;

namespace MTM_Receiving_Application.Tests.Module_Core.Converters;

/// &lt;summary&gt;
/// Unit tests for &lt;see cref=&quot;Converter_BoolToString&quot;/&gt;.
/// Tests conversion of boolean values to custom string representations using pipe-delimited parameter.
/// Format: &quot;TrueString|FalseString&quot;
/// &lt;/summary&gt;
[Trait(&quot;Category&quot;, &quot;Unit&quot;)]
[Trait(&quot;Type&quot;, &quot;Converter&quot;)]
public class Converter_BoolToString_Tests
{
    private readonly Converter_BoolToString _sut;

    public Converter_BoolToString_Tests()
    {
        _sut = new();
    }

    [Theory]
    [InlineData(true, &quot;Yes|No&quot;, &quot;Yes&quot;)]
    [InlineData(false, &quot;Yes|No&quot;, &quot;No&quot;)]
    [InlineData(true, &quot;Active|Inactive&quot;, &quot;Active&quot;)]
    [InlineData(false, &quot;Active|Inactive&quot;, &quot;Inactive&quot;)]
    [InlineData(true, &quot;|&quot;, &quot;&quot;)]
    [InlineData(false, &quot;|&quot;, &quot;&quot;)]
    public void Convert_WithBooleanAndValidParameter_ReturnsCorrectString(bool input, string parameter, string expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), parameter, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Fact]
    public void Convert_WithNullValue_ReturnsEmptyString()
    {
        // Act
        var result = _sut.Convert(null, typeof(string), &quot;Yes|No&quot;, &quot;en-US&quot;);

        // Assert
        result.Should().Be(string.Empty);
    }

    [Theory]
    [InlineData(true, null)]
    [InlineData(false, null)]
    public void Convert_WithNullParameter_ReturnsBooleanToString(bool input, object? parameter)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), parameter, &quot;en-US&quot;);

        // Assert
        result.Should().Be(input.ToString());
    }

    [Theory]
    [InlineData(true, &quot;OnlyOneValue&quot;)]
    [InlineData(false, &quot;OnlyOneValue&quot;)]
    public void Convert_WithInvalidParameter_ReturnsBooleanToString(bool input, string parameter)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), parameter, &quot;en-US&quot;);

        // Assert
        result.Should().Be(input.ToString());
    }

    [Theory]
    [InlineData(&quot;true&quot;, &quot;Yes|No&quot;)]
    [InlineData(1, &quot;Yes|No&quot;)]
    public void Convert_WithNonBooleanValue_ReturnsValueToString(object input, string parameter)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), parameter, &quot;en-US&quot;);

        // Assert
        result.Should().Be(input.ToString());
    }

    [Theory]
    [InlineData(true, &quot;Yes|No|Maybe&quot;)]
    [InlineData(false, &quot;Yes|No|Maybe&quot;)]
    public void Convert_WithMoreThanTwoParts_ReturnsOriginalBooleanString(bool input, string parameter)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), parameter, &quot;en-US&quot;);

        // Assert
        result.Should().Be(input.ToString());
    }

    [Fact]
    public void ConvertBack_ThrowsNotImplementedException()
    {
        // Act
        Action act = () =&gt; _sut.ConvertBack(&quot;Yes&quot;, typeof(bool), &quot;Yes|No&quot;, &quot;en-US&quot;);

        // Assert
        act.Should().Throw&lt;NotImplementedException&gt;();
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_DecimalToString_Tests.cs">using MTM_Receiving_Application.Module_Core.Converters;

namespace MTM_Receiving_Application.Tests.Module_Core.Converters;

/// &lt;summary&gt;
/// Unit tests for &lt;see cref=&quot;Converter_DecimalToString&quot;/&gt;.
/// Tests bidirectional conversion between decimal and string, with special handling for zero values.
/// &lt;/summary&gt;
[Trait(&quot;Category&quot;, &quot;Unit&quot;)]
[Trait(&quot;Type&quot;, &quot;Converter&quot;)]
public class Converter_DecimalToString_Tests
{
    private readonly Converter_DecimalToString _sut;

    public Converter_DecimalToString_Tests()
    {
        _sut = new();
    }

    [Theory]
    [InlineData(0.0, &quot;&quot;)]
    [InlineData(42.5, &quot;42.5&quot;)]
    [InlineData(100.0, &quot;100&quot;)]
    [InlineData(1234.56789, &quot;1234.56789&quot;)]
    [InlineData(-50.25, &quot;-50.25&quot;)]
    public void Convert_WithDecimalValue_ReturnsExpectedString(decimal input, string expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Fact]
    public void Convert_WithVeryPreciseDecimal_ReturnsPreciseString()
    {
        // Arrange - G29 format preserves up to 29 significant digits
        var input = 0.12345678901234567890123456789m;

        // Act
        var result = _sut.Convert(input, typeof(string), null, &quot;en-US&quot;);

        // Assert - G29 will trim trailing zeros and use the most compact representation
        result.Should().BeOfType&lt;string&gt;();
        var resultString = (string)result;
        resultString.Should().NotBeNullOrEmpty();
        resultString.Should().StartWith(&quot;0.12345678901234&quot;);
    }

    [Fact]
    public void Convert_WithZero_ReturnsEmptyString()
    {
        // Act
        var result = _sut.Convert(0m, typeof(string), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(string.Empty);
    }

    [Theory]
    [InlineData(null)]
    [InlineData(&quot;text&quot;)]
    [InlineData(42)]
    public void Convert_WithNonDecimalValue_ReturnsEmptyString(object? input)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(string.Empty);
    }

    [Theory]
    [InlineData(&quot;42.5&quot;, 42.5)]
    [InlineData(&quot;100&quot;, 100)]
    [InlineData(&quot;1234.56789&quot;, 1234.56789)]
    [InlineData(&quot;-50.25&quot;, -50.25)]
    [InlineData(&quot;0&quot;, 0)]
    public void ConvertBack_WithValidString_ReturnsDecimal(string input, decimal expected)
    {
        // Act
        var result = _sut.ConvertBack(input, typeof(decimal), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(&quot;&quot;)]
    [InlineData(&quot;   &quot;)]
    [InlineData(null)]
    public void ConvertBack_WithEmptyOrWhitespaceString_ReturnsZero(string? input)
    {
        // Act
        var result = _sut.ConvertBack(input, typeof(decimal), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(0m);
    }

    [Theory]
    [InlineData(&quot;abc&quot;)]
    [InlineData(&quot;12.34.56&quot;)]
    [InlineData(&quot;not a number&quot;)]
    public void ConvertBack_WithInvalidString_ReturnsZero(string input)
    {
        // Act
        var result = _sut.ConvertBack(input, typeof(decimal), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(0m);
    }

    [Fact]
    public void ConvertBack_WithNonStringValue_ReturnsZero()
    {
        // Act
        var result = _sut.ConvertBack(42, typeof(decimal), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(0m);
    }

    [Fact]
    public void Convert_RoundTrip_PreservesValue()
    {
        // Arrange
        var originalValue = 1234.56789m;

        // Act - Convert to string
        var stringResult = _sut.Convert(originalValue, typeof(string), null, &quot;en-US&quot;);

        // Act - Convert back to decimal
        var decimalResult = _sut.ConvertBack(stringResult, typeof(decimal), null, &quot;en-US&quot;);

        // Assert
        decimalResult.Should().Be(originalValue);
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_DoubleToDecimal_Tests.cs">using MTM_Receiving_Application.Module_Core.Converters;

namespace MTM_Receiving_Application.Tests.Module_Core.Converters;

/// &lt;summary&gt;
/// Unit tests for &lt;see cref=&quot;Converter_DoubleToDecimal&quot;/&gt;.
/// Tests bidirectional conversion between decimal and double types.
/// &lt;/summary&gt;
[Trait(&quot;Category&quot;, &quot;Unit&quot;)]
[Trait(&quot;Type&quot;, &quot;Converter&quot;)]
public class Converter_DoubleToDecimal_Tests
{
    private readonly Converter_DoubleToDecimal _sut;

    public Converter_DoubleToDecimal_Tests()
    {
        _sut = new();
    }

    [Theory]
    [InlineData(0.0, 0.0)]
    [InlineData(42.5, 42.5)]
    [InlineData(100.0, 100.0)]
    [InlineData(1234.56789, 1234.56789)]
    [InlineData(-50.25, -50.25)]
    public void Convert_WithDecimalValue_ReturnsDouble(decimal input, double expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(double), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(null)]
    [InlineData(&quot;text&quot;)]
    [InlineData(42)]
    public void Convert_WithNonDecimalValue_ReturnsZeroDouble(object? input)
    {
        // Act
        var result = _sut.Convert(input, typeof(double), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(0.0);
    }

    [Theory]
    [InlineData(0.0, 0.0)]
    [InlineData(42.5, 42.5)]
    [InlineData(100.0, 100.0)]
    [InlineData(1234.56789, 1234.56789)]
    [InlineData(-50.25, -50.25)]
    public void ConvertBack_WithDoubleValue_ReturnsDecimal(double input, decimal expected)
    {
        // Act
        var result = _sut.ConvertBack(input, typeof(decimal), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(null)]
    [InlineData(&quot;text&quot;)]
    [InlineData(42)]
    public void ConvertBack_WithNonDoubleValue_ReturnsZeroDecimal(object? input)
    {
        // Act
        var result = _sut.ConvertBack(input, typeof(decimal), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(0m);
    }

    [Fact]
    public void Convert_RoundTrip_PreservesValue()
    {
        // Arrange
        var originalValue = 1234.56789m;

        // Act - Convert to double
        var doubleResult = _sut.Convert(originalValue, typeof(double), null, &quot;en-US&quot;);

        // Act - Convert back to decimal
        var decimalResult = _sut.ConvertBack(doubleResult, typeof(decimal), null, &quot;en-US&quot;);

        // Assert
        decimalResult.Should().Be(originalValue);
    }

    [Fact]
    public void Convert_WithLargeDecimalValue_HandlesWithinDoubleRange()
    {
        // Arrange - Use a large value that&apos;s within double range but shows precision
        var input = 79228162514264m; // Well within both decimal and double range

        // Act
        var result = _sut.Convert(input, typeof(double), null, &quot;en-US&quot;);

        // Assert - Should not throw
        result.Should().BeOfType&lt;double&gt;();
        ((double)result).Should().BeApproximately(79228162514264.0, 0.1);
    }

    [Fact]
    public void ConvertBack_WithLargeDoubleValue_HandlesWithinDecimalRange()
    {
        // Arrange - Use a large value within decimal range
        var input = 79228162514264.0; // Well within decimal range

        // Act
        var result = _sut.ConvertBack(input, typeof(decimal), null, &quot;en-US&quot;);

        // Assert - Should not throw
        result.Should().BeOfType&lt;decimal&gt;();
        ((decimal)result).Should().BeApproximately(79228162514264m, 1m);
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_EmptyStringToVisibility_Tests.cs">using Microsoft.UI.Xaml;
using MTM_Receiving_Application.Module_Core.Converters;

namespace MTM_Receiving_Application.Tests.Module_Core.Converters;

/// &lt;summary&gt;
/// Unit tests for &lt;see cref=&quot;Converter_EmptyStringToVisibility&quot;/&gt;.
/// Tests conversion of string values to Visibility based on empty/whitespace checks with optional inverse.
/// &lt;/summary&gt;
[Trait(&quot;Category&quot;, &quot;Unit&quot;)]
[Trait(&quot;Type&quot;, &quot;Converter&quot;)]
public class Converter_EmptyStringToVisibility_Tests
{
    private readonly Converter_EmptyStringToVisibility _sut;

    public Converter_EmptyStringToVisibility_Tests()
    {
        _sut = new();
    }

    [Theory]
    [InlineData(&quot;Hello&quot;, null, Visibility.Visible)]
    [InlineData(&quot;Some text&quot;, null, Visibility.Visible)]
    [InlineData(&quot;  text  &quot;, null, Visibility.Visible)]
    [InlineData(&quot;&quot;, null, Visibility.Collapsed)]
    [InlineData(&quot;   &quot;, null, Visibility.Collapsed)]
    [InlineData(null, null, Visibility.Collapsed)]
    public void Convert_WithStringValue_ReturnsExpectedVisibility(string? input, object? parameter, Visibility expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(Visibility), parameter, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(&quot;Hello&quot;, &quot;Inverse&quot;, Visibility.Collapsed)]
    [InlineData(&quot;Some text&quot;, &quot;Inverse&quot;, Visibility.Collapsed)]
    [InlineData(&quot;&quot;, &quot;Inverse&quot;, Visibility.Visible)]
    [InlineData(&quot;   &quot;, &quot;Inverse&quot;, Visibility.Visible)]
    [InlineData(null, &quot;Inverse&quot;, Visibility.Visible)]
    [InlineData(&quot;Text&quot;, &quot;inverse&quot;, Visibility.Collapsed)]
    public void Convert_WithInverseParameter_ReturnsInvertedVisibility(string? input, string parameter, Visibility expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(Visibility), parameter, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(42)]
    [InlineData(true)]
    [InlineData(3.14)]
    public void Convert_WithNonStringValue_ReturnsCollapsed(object input)
    {
        // Act
        var result = _sut.Convert(input, typeof(Visibility), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(Visibility.Collapsed);
    }

    [Fact]
    public void Convert_WithUnknownParameter_IgnoresParameter()
    {
        // Act
        var result = _sut.Convert(&quot;Hello&quot;, typeof(Visibility), &quot;SomeOtherParam&quot;, &quot;en-US&quot;);

        // Assert
        result.Should().Be(Visibility.Visible);
    }

    [Fact]
    public void ConvertBack_ThrowsNotImplementedException()
    {
        // Act
        Action act = () =&gt; _sut.ConvertBack(Visibility.Visible, typeof(string), null, &quot;en-US&quot;);

        // Assert
        act.Should().Throw&lt;NotImplementedException&gt;();
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_EnumToVisibility_Tests.cs">using Microsoft.UI.Xaml;
using MTM_Receiving_Application.Module_Core.Converters;

namespace MTM_Receiving_Application.Tests.Module_Core.Converters;

/// &lt;summary&gt;
/// Unit tests for &lt;see cref=&quot;Converter_EnumToVisibility&quot;/&gt;.
/// Tests conversion of enum values to Visibility based on parameter match (case-insensitive).
/// &lt;/summary&gt;
[Trait(&quot;Category&quot;, &quot;Unit&quot;)]
[Trait(&quot;Type&quot;, &quot;Converter&quot;)]
public class Converter_EnumToVisibility_Tests
{
    private readonly Converter_EnumToVisibility _sut;

    // Test enum for converter testing
    public enum TestEnum
    {
        First,
        Second,
        Third
    }

    public Converter_EnumToVisibility_Tests()
    {
        _sut = new();
    }

    [Theory]
    [InlineData(TestEnum.First, &quot;First&quot;, Visibility.Visible)]
    [InlineData(TestEnum.First, &quot;Second&quot;, Visibility.Collapsed)]
    [InlineData(TestEnum.Second, &quot;Second&quot;, Visibility.Visible)]
    [InlineData(TestEnum.Third, &quot;Third&quot;, Visibility.Visible)]
    [InlineData(TestEnum.First, &quot;first&quot;, Visibility.Visible)]
    [InlineData(TestEnum.Second, &quot;SECOND&quot;, Visibility.Visible)]
    public void Convert_WithEnumValue_ReturnsExpectedVisibility(TestEnum input, string parameter, Visibility expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(Visibility), parameter, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Fact]
    public void Convert_WithNullValue_ReturnsCollapsed()
    {
        // Act
        var result = _sut.Convert(null, typeof(Visibility), &quot;First&quot;, &quot;en-US&quot;);

        // Assert
        result.Should().Be(Visibility.Collapsed);
    }

    [Fact]
    public void Convert_WithNullParameter_ReturnsCollapsed()
    {
        // Act
        var result = _sut.Convert(TestEnum.First, typeof(Visibility), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(Visibility.Collapsed);
    }

    [Fact]
    public void Convert_WithBothNull_ReturnsCollapsed()
    {
        // Act
        var result = _sut.Convert(null, typeof(Visibility), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(Visibility.Collapsed);
    }

    [Theory]
    [InlineData(&quot;First&quot;, &quot;First&quot;, Visibility.Visible)]
    [InlineData(&quot;Second&quot;, &quot;Second&quot;, Visibility.Visible)]
    [InlineData(&quot;First&quot;, &quot;Second&quot;, Visibility.Collapsed)]
    public void Convert_WithStringValue_ComparesCorrectly(string input, string parameter, Visibility expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(Visibility), parameter, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(1, &quot;1&quot;, Visibility.Visible)]
    [InlineData(2, &quot;1&quot;, Visibility.Collapsed)]
    public void Convert_WithNumericValue_ComparesAsString(int input, string parameter, Visibility expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(Visibility), parameter, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Fact]
    public void ConvertBack_ThrowsNotImplementedException()
    {
        // Act
        Action act = () =&gt; _sut.ConvertBack(Visibility.Visible, typeof(TestEnum), &quot;First&quot;, &quot;en-US&quot;);

        // Assert
        act.Should().Throw&lt;NotImplementedException&gt;();
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_IconCodeToGlyph_Tests.cs">using MTM_Receiving_Application.Module_Core.Converters;

namespace MTM_Receiving_Application.Tests.Module_Core.Converters;

/// &lt;summary&gt;
/// Unit tests for &lt;see cref=&quot;Converter_IconCodeToGlyph&quot;/&gt;.
/// Tests conversion of icon codes (HTML entity or hex format) to Unicode glyph characters.
/// Supports formats: &quot;&amp;#xE7B8;&quot; (HTML entity) or &quot;E7B8&quot; (raw hex)
/// &lt;/summary&gt;
[Trait(&quot;Category&quot;, &quot;Unit&quot;)]
[Trait(&quot;Type&quot;, &quot;Converter&quot;)]
public class Converter_IconCodeToGlyph_Tests
{
    private readonly Converter_IconCodeToGlyph _sut;

    public Converter_IconCodeToGlyph_Tests()
    {
        _sut = new();
    }

    [Theory]
    [InlineData(&quot;&amp;#xE7B8;&quot;, &quot;\uE7B8&quot;)]
    [InlineData(&quot;&amp;#xE8A7;&quot;, &quot;\uE8A7&quot;)]
    [InlineData(&quot;&amp;#xE700;&quot;, &quot;\uE700&quot;)]
    [InlineData(&quot;&amp;#xE74D;&quot;, &quot;\uE74D&quot;)]
    public void Convert_WithHtmlEntityFormat_ReturnsGlyphCharacter(string input, string expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(&quot;E7B8&quot;, &quot;\uE7B8&quot;)]
    [InlineData(&quot;E8A7&quot;, &quot;\uE8A7&quot;)]
    [InlineData(&quot;E700&quot;, &quot;\uE700&quot;)]
    [InlineData(&quot;E74D&quot;, &quot;\uE74D&quot;)]
    public void Convert_WithRawHexFormat_ReturnsGlyphCharacter(string input, string expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(null)]
    [InlineData(&quot;&quot;)]
    [InlineData(&quot;   &quot;)]
    public void Convert_WithNullOrWhitespace_ReturnsDefaultIcon(string? input)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(&quot;\uE7B8&quot;); // Default box icon
    }

    [Theory]
    [InlineData(&quot;InvalidFormat&quot;)]
    [InlineData(&quot;&amp;#xZZZZ;&quot;)]
    [InlineData(&quot;ZZZZ&quot;)]
    [InlineData(&quot;12345&quot;)]
    [InlineData(&quot;ABC&quot;)]
    public void Convert_WithInvalidHexValue_ReturnsInputAsIs(string input)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(input);
    }

    [Theory]
    [InlineData(&quot;A&quot;)]
    [InlineData(&quot;AB&quot;)]
    [InlineData(&quot;ABC&quot;)]
    [InlineData(&quot;ABCDE&quot;)]
    public void Convert_WithNonFourCharacterHex_ReturnsInputAsIs(string input)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(input);
    }

    [Fact]
    public void Convert_WithSingleCharacterString_ReturnsInputAsIs()
    {
        // Arrange
        var input = &quot;X&quot;;

        // Act
        var result = _sut.Convert(input, typeof(string), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(input);
    }

    [Theory]
    [InlineData(42)]
    [InlineData(true)]
    public void Convert_WithNonStringValue_ReturnsDefaultIcon(object input)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(&quot;\uE7B8&quot;);
    }

    [Fact]
    public void ConvertBack_ThrowsNotImplementedException()
    {
        // Act
        Action act = () =&gt; _sut.ConvertBack(&quot;\uE7B8&quot;, typeof(string), null, &quot;en-US&quot;);

        // Assert
        act.Should().Throw&lt;NotImplementedException&gt;();
    }

    [Theory]
    [InlineData(&quot;&amp;#xE7B8;&quot;)]
    [InlineData(&quot;E7B8&quot;)]
    public void Convert_WithLowercaseHex_HandlesCorrectly(string input)
    {
        // Arrange
        var lowercaseInput = input.ToLower();

        // Act
        var result = _sut.Convert(lowercaseInput, typeof(string), null, &quot;en-US&quot;);

        // Assert
        result.Should().NotBeNull();
        result.Should().BeOfType&lt;string&gt;();
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_IntToVisibility_Tests.cs">using Microsoft.UI.Xaml;
using MTM_Receiving_Application.Module_Core.Converters;

namespace MTM_Receiving_Application.Tests.Module_Core.Converters;

/// &lt;summary&gt;
/// Unit tests for &lt;see cref=&quot;Converter_IntToVisibility&quot;/&gt;.
/// Tests conversion of integer values to Visibility with multiple parameter modes:
/// - No parameter: Visible if value &gt; 0
/// - &quot;Inverse&quot;: Visible if value == 0
/// - Numeric string (e.g., &quot;1&quot;, &quot;2&quot;): Visible if value == parameter
/// - Direct int parameter: Visible if value == parameter
/// &lt;/summary&gt;
[Trait(&quot;Category&quot;, &quot;Unit&quot;)]
[Trait(&quot;Type&quot;, &quot;Converter&quot;)]
public class Converter_IntToVisibility_Tests
{
    private readonly Converter_IntToVisibility _sut;

    public Converter_IntToVisibility_Tests()
    {
        _sut = new();
    }

    [Theory]
    [InlineData(0, Visibility.Collapsed)]
    [InlineData(1, Visibility.Visible)]
    [InlineData(5, Visibility.Visible)]
    [InlineData(-1, Visibility.Collapsed)]
    public void Convert_WithNoParameter_ShowsWhenValueGreaterThanZero(int input, Visibility expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(Visibility), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(0, Visibility.Visible)]
    [InlineData(1, Visibility.Collapsed)]
    [InlineData(5, Visibility.Collapsed)]
    [InlineData(-1, Visibility.Collapsed)]
    public void Convert_WithInverseParameter_ShowsWhenValueIsZero(int input, Visibility expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(Visibility), &quot;Inverse&quot;, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(0, Visibility.Visible)]
    [InlineData(1, Visibility.Collapsed)]
    [InlineData(5, Visibility.Collapsed)]
    public void Convert_WithInverseParameterCaseInsensitive_WorksCorrectly(int input, Visibility expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(Visibility), &quot;inverse&quot;, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(1, &quot;1&quot;, Visibility.Visible)]
    [InlineData(1, &quot;2&quot;, Visibility.Collapsed)]
    [InlineData(2, &quot;2&quot;, Visibility.Visible)]
    [InlineData(3, &quot;3&quot;, Visibility.Visible)]
    [InlineData(0, &quot;0&quot;, Visibility.Visible)]
    public void Convert_WithNumericStringParameter_ShowsWhenValueMatchesParameter(int input, string parameter, Visibility expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(Visibility), parameter, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(1, 1, Visibility.Visible)]
    [InlineData(1, 2, Visibility.Collapsed)]
    [InlineData(2, 2, Visibility.Visible)]
    [InlineData(0, 0, Visibility.Visible)]
    public void Convert_WithDirectIntParameter_ShowsWhenValueMatchesParameter(int input, int parameter, Visibility expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(Visibility), parameter, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Fact]
    public void Convert_WithNullValue_ReturnsCollapsed()
    {
        // Act
        var result = _sut.Convert(null, typeof(Visibility), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(Visibility.Collapsed);
    }

    [Theory]
    [InlineData(&quot;NotANumber&quot;)]
    [InlineData(&quot;abc&quot;)]
    public void Convert_WithNonNumericStringParameter_FallsBackToGreaterThanZero(string parameter)
    {
        // Act
        var result = _sut.Convert(5, typeof(Visibility), parameter, &quot;en-US&quot;);

        // Assert
        result.Should().Be(Visibility.Visible);
    }

    [Theory]
    [InlineData(&quot;5&quot;)]
    [InlineData(5.5)]
    public void Convert_WithNonIntegerValue_TreatsAsZero(object input)
    {
        // Act
        var result = _sut.Convert(input, typeof(Visibility), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(Visibility.Collapsed);
    }

    [Fact]
    public void ConvertBack_ThrowsNotImplementedException()
    {
        // Act
        Action act = () =&gt; _sut.ConvertBack(Visibility.Visible, typeof(int), null, &quot;en-US&quot;);

        // Assert
        act.Should().Throw&lt;NotImplementedException&gt;();
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_LoadNumberToOneBased_Tests.cs">using MTM_Receiving_Application.Module_Core.Converters;

namespace MTM_Receiving_Application.Tests.Module_Core.Converters;

/// &lt;summary&gt;
/// Unit tests for &lt;see cref=&quot;Converter_LoadNumberToOneBased&quot;/&gt;.
/// Tests bidirectional conversion between zero-based (internal) and one-based (display) load numbers.
/// &lt;/summary&gt;
[Trait(&quot;Category&quot;, &quot;Unit&quot;)]
[Trait(&quot;Type&quot;, &quot;Converter&quot;)]
public class Converter_LoadNumberToOneBased_Tests
{
    private readonly Converter_LoadNumberToOneBased _sut;

    public Converter_LoadNumberToOneBased_Tests()
    {
        _sut = new();
    }

    [Theory]
    [InlineData(0, 1)]
    [InlineData(1, 2)]
    [InlineData(5, 6)]
    [InlineData(10, 11)]
    [InlineData(99, 100)]
    public void Convert_WithIntegerValue_ReturnsOneBasedValue(int input, int expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(int), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(null)]
    [InlineData(&quot;text&quot;)]
    [InlineData(3.14)]
    [InlineData(true)]
    public void Convert_WithNonIntegerValue_ReturnsValueAsIs(object? input)
    {
        // Act
        var result = _sut.Convert(input, typeof(int), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(input);
    }

    [Theory]
    [InlineData(&quot;1&quot;, 0)]
    [InlineData(&quot;2&quot;, 1)]
    [InlineData(&quot;6&quot;, 5)]
    [InlineData(&quot;11&quot;, 10)]
    [InlineData(&quot;100&quot;, 99)]
    public void ConvertBack_WithValidStringValue_ReturnsZeroBasedValue(string input, int expected)
    {
        // Act
        var result = _sut.ConvertBack(input, typeof(int), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(&quot;&quot;)]
    [InlineData(&quot;abc&quot;)]
    [InlineData(&quot;12.34&quot;)]
    public void ConvertBack_WithInvalidString_ReturnsValueAsIs(string input)
    {
        // Act
        var result = _sut.ConvertBack(input, typeof(int), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(input);
    }

    [Theory]
    [InlineData(null)]
    [InlineData(42)]
    [InlineData(true)]
    public void ConvertBack_WithNonStringValue_ReturnsValueAsIs(object? input)
    {
        // Act
        var result = _sut.ConvertBack(input, typeof(int), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(input);
    }

    [Theory]
    [InlineData(0)]
    [InlineData(1)]
    [InlineData(5)]
    [InlineData(10)]
    [InlineData(99)]
    public void Convert_RoundTrip_PreservesValue(int originalValue)
    {
        // Act - Convert to one-based
        var oneBasedResult = _sut.Convert(originalValue, typeof(int), null, &quot;en-US&quot;);

        // Act - Convert back to zero-based
        var zeroBasedResult = _sut.ConvertBack(oneBasedResult.ToString(), typeof(int), null, &quot;en-US&quot;);

        // Assert
        zeroBasedResult.Should().Be(originalValue);
    }

    [Fact]
    public void Convert_WithNegativeValue_ReturnsNegativeOneBased()
    {
        // Act
        var result = _sut.Convert(-5, typeof(int), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(-4);
    }

    [Fact]
    public void ConvertBack_WithZeroString_ReturnsNegativeOne()
    {
        // Act
        var result = _sut.ConvertBack(&quot;0&quot;, typeof(int), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(-1);
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_StringFormat_Tests.cs">using MTM_Receiving_Application.Module_Core.Converters;

namespace MTM_Receiving_Application.Tests.Module_Core.Converters;

/// &lt;summary&gt;
/// Unit tests for &lt;see cref=&quot;Converter_StringFormat&quot;/&gt;.
/// Tests string formatting using parameter as format string (e.g., &quot;Total: {0}&quot;).
/// &lt;/summary&gt;
[Trait(&quot;Category&quot;, &quot;Unit&quot;)]
[Trait(&quot;Type&quot;, &quot;Converter&quot;)]
public class Converter_StringFormat_Tests
{
    private readonly Converter_StringFormat _sut;

    public Converter_StringFormat_Tests()
    {
        _sut = new();
    }

    [Theory]
    [InlineData(&quot;Hello&quot;, &quot;Greeting: {0}&quot;, &quot;Greeting: Hello&quot;)]
    [InlineData(42, &quot;Count: {0}&quot;, &quot;Count: 42&quot;)]
    [InlineData(3.14, &quot;Value: {0:F2}&quot;, &quot;Value: 3.14&quot;)]
    [InlineData(&quot;Item&quot;, &quot;{0} - Selected&quot;, &quot;Item - Selected&quot;)]
    public void Convert_WithValidFormatParameter_ReturnsFormattedString(object input, string format, string expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), format, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(&quot;Hello&quot;)]
    [InlineData(42)]
    [InlineData(3.14)]
    public void Convert_WithNullParameter_ReturnsValueAsIs(object input)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(input);
    }

    [Theory]
    [InlineData(42)]
    [InlineData(true)]
    [InlineData(3.14)]
    public void Convert_WithNonStringParameter_ReturnsValueAsIs(object input)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), 123, &quot;en-US&quot;);

        // Assert
        result.Should().Be(input);
    }

    [Fact]
    public void Convert_WithNullValue_FormatsNullAsString()
    {
        // Act
        var result = _sut.Convert(null, typeof(string), &quot;Value: {0}&quot;, &quot;en-US&quot;);

        // Assert
        result.Should().Be(&quot;Value: &quot;);
    }

    [Theory]
    [InlineData(1234, &quot;{0:N0}&quot;, &quot;1,234&quot;)]
    [InlineData(1234.5678, &quot;{0:F2}&quot;, &quot;1234.57&quot;)]
    [InlineData(0.75, &quot;{0:P0}&quot;, &quot;75%&quot;)]
    public void Convert_WithNumericFormatting_ReturnsFormattedNumber(object input, string format, string expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), format, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Fact]
    public void Convert_WithEmptyFormatString_ReturnsEmptyString()
    {
        // Act
        var result = _sut.Convert(&quot;Hello&quot;, typeof(string), &quot;&quot;, &quot;en-US&quot;);

        // Assert
        result.Should().Be(&quot;&quot;);
    }

    [Fact]
    public void ConvertBack_ThrowsNotImplementedException()
    {
        // Act
        Action act = () =&gt; _sut.ConvertBack(&quot;Formatted String&quot;, typeof(object), &quot;{0}&quot;, &quot;en-US&quot;);

        // Assert
        act.Should().Throw&lt;NotImplementedException&gt;();
    }

    [Theory]
    [InlineData(&quot;Test&quot;, &quot;Prefix: {0} Suffix&quot;, &quot;Prefix: Test Suffix&quot;)]
    [InlineData(100, &quot;Item #{0:D3}&quot;, &quot;Item #100&quot;)]
    public void Convert_WithComplexFormatString_HandlesCorrectly(object input, string format, string expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), format, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Converters/NullableDoubleToDoubleConverter_Tests.cs">using MTM_Receiving_Application.Module_Core.Converters;

namespace MTM_Receiving_Application.Tests.Module_Core.Converters;

/// &lt;summary&gt;
/// Unit tests for &lt;see cref=&quot;NullableDoubleToDoubleConverter&quot;/&gt;.
/// Tests bidirectional conversion between nullable double (double?) and double for NumberBox bindings.
/// &lt;/summary&gt;
[Trait(&quot;Category&quot;, &quot;Unit&quot;)]
[Trait(&quot;Type&quot;, &quot;Converter&quot;)]
public class NullableDoubleToDoubleConverter_Tests
{
    private readonly NullableDoubleToDoubleConverter _sut;

    public NullableDoubleToDoubleConverter_Tests()
    {
        _sut = new();
    }

    [Theory]
    [InlineData(0.0, 0.0)]
    [InlineData(42.5, 42.5)]
    [InlineData(100.0, 100.0)]
    [InlineData(1234.56789, 1234.56789)]
    [InlineData(-50.25, -50.25)]
    [InlineData(double.MaxValue, double.MaxValue)]
    [InlineData(double.MinValue, double.MinValue)]
    public void Convert_WithDoubleValue_ReturnsDoubleValue(double input, double expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(double), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(null)]
    [InlineData(&quot;text&quot;)]
    [InlineData(42)]
    [InlineData(true)]
    public void Convert_WithNonDoubleValue_ReturnsZero(object? input)
    {
        // Act
        var result = _sut.Convert(input, typeof(double), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(0.0);
    }

    [Theory]
    [InlineData(0.0)]
    [InlineData(42.5)]
    [InlineData(100.0)]
    [InlineData(1234.56789)]
    [InlineData(-50.25)]
    public void ConvertBack_WithDoubleValue_ReturnsNullableDouble(double input)
    {
        // Act
        var result = _sut.ConvertBack(input, typeof(double?), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be((double?)input);
    }

    [Theory]
    [InlineData(null)]
    [InlineData(&quot;text&quot;)]
    [InlineData(42)]
    [InlineData(true)]
    public void ConvertBack_WithNonDoubleValue_ReturnsNull(object? input)
    {
        // Act
        var result = _sut.ConvertBack(input, typeof(double?), null, &quot;en-US&quot;);

        // Assert
        result.Should().BeNull();
    }

    [Theory]
    [InlineData(0.0)]
    [InlineData(42.5)]
    [InlineData(1234.56789)]
    [InlineData(-50.25)]
    public void Convert_RoundTrip_PreservesValue(double originalValue)
    {
        // Act - Convert to double
        var doubleResult = _sut.Convert(originalValue, typeof(double), null, &quot;en-US&quot;);

        // Act - Convert back to nullable double
        var nullableResult = _sut.ConvertBack(doubleResult, typeof(double?), null, &quot;en-US&quot;);

        // Assert
        nullableResult.Should().Be(originalValue);
    }

    [Fact]
    public void Convert_WithNaN_ReturnsNaN()
    {
        // Act
        var result = _sut.Convert(double.NaN, typeof(double), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(double.NaN);
    }

    [Fact]
    public void Convert_WithPositiveInfinity_ReturnsPositiveInfinity()
    {
        // Act
        var result = _sut.Convert(double.PositiveInfinity, typeof(double), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(double.PositiveInfinity);
    }

    [Fact]
    public void Convert_WithNegativeInfinity_ReturnsNegativeInfinity()
    {
        // Act
        var result = _sut.Convert(double.NegativeInfinity, typeof(double), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be(double.NegativeInfinity);
    }

    [Fact]
    public void ConvertBack_WithNaN_ReturnsNullableNaN()
    {
        // Act
        var result = _sut.ConvertBack(double.NaN, typeof(double?), null, &quot;en-US&quot;);

        // Assert
        result.Should().Be((double?)double.NaN);
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Defaults/InforVisualDefaults_Tests.cs">using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Defaults;
using MTM_Receiving_Application.Module_Core.Models.InforVisual;
using Xunit;

namespace MTM_Receiving_Application.Tests.Module_Core.Defaults;

public class InforVisualDefaults_Tests
{
    [Fact]
    public void DefaultSiteId_ShouldNotBeNullOrWhiteSpace()
    {
        InforVisualDefaults.DefaultSiteId.Should().NotBeNullOrWhiteSpace();
    }

    [Fact]
    public void DefaultUom_ShouldNotBeNullOrWhiteSpace()
    {
        InforVisualDefaults.DefaultUom.Should().NotBeNullOrWhiteSpace();
    }

    [Fact]
    public void DefaultPartStatus_ShouldNotBeNullOrWhiteSpace()
    {
        InforVisualDefaults.DefaultPartStatus.Should().NotBeNullOrWhiteSpace();
    }

    [Fact]
    public void Model_InforVisualConnection_DefaultsShouldMatch()
    {
        var model = new Model_InforVisualConnection();

        model.Server.Should().Be(InforVisualDefaults.DefaultServer);
        model.Database.Should().Be(InforVisualDefaults.DefaultDatabase);
        model.SiteId.Should().Be(InforVisualDefaults.DefaultSiteId);
    }

    [Fact]
    public void Model_InforVisualPart_DefaultsShouldMatch()
    {
        var model = new Model_InforVisualPart();

        model.PrimaryUom.Should().Be(InforVisualDefaults.DefaultUom);
        model.DefaultSite.Should().Be(InforVisualDefaults.DefaultSiteId);
        model.PartStatus.Should().Be(InforVisualDefaults.DefaultPartStatus);
    }

    [Fact]
    public void Model_InforVisualPO_DefaultsShouldMatch()
    {
        var model = new Model_InforVisualPO();

        model.UnitOfMeasure.Should().Be(InforVisualDefaults.DefaultUom);
        model.SiteId.Should().Be(InforVisualDefaults.DefaultSiteId);
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Defaults/WorkstationDefaults_Tests.cs">using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Defaults;
using Xunit;

namespace MTM_Receiving_Application.Tests.Module_Core.Defaults;

public class WorkstationDefaults_Tests
{
    [Fact]
    public void SharedTerminalWorkstationType_ShouldNotBeNullOrWhiteSpace()
    {
        WorkstationDefaults.SharedTerminalWorkstationType.Should().NotBeNullOrWhiteSpace();
    }

    [Fact]
    public void PersonalWorkstationWorkstationType_ShouldNotBeNullOrWhiteSpace()
    {
        WorkstationDefaults.PersonalWorkstationWorkstationType.Should().NotBeNullOrWhiteSpace();
    }

    [Fact]
    public void SharedTerminalTimeoutMinutes_ShouldBePositive()
    {
        WorkstationDefaults.SharedTerminalTimeoutMinutes.Should().BeGreaterThan(0);
    }

    [Fact]
    public void PersonalWorkstationTimeoutMinutes_ShouldBePositive()
    {
        WorkstationDefaults.PersonalWorkstationTimeoutMinutes.Should().BeGreaterThan(0);
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Helpers/Database/Helper_Database_StoredProcedure_Tests.cs">using System.Data;
using MySql.Data.MySqlClient;
using Xunit;
using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Helpers.Database;

namespace MTM_Receiving_Application.Tests.Module_Core.Helpers.Database
{
    /// &lt;summary&gt;
    /// Unit tests for Helper_Database_StoredProcedure logic
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Helper&quot;)]
    public class Helper_Database_StoredProcedure_Tests
    {
        [Fact]
        public void ValidateParameters_NullParameters_ReturnsTrue()
        {
            // Act
            var result = Helper_Database_StoredProcedure.ValidateParameters(null);

            // Assert
            result.Should().BeTrue(&quot;null parameters list is considered valid (no parameters to validate)&quot;);
        }

        [Fact]
        public void ValidateParameters_ValidInputParameters_ReturnsTrue()
        {
            // Arrange
            var parameters = new[]
            {
                new MySqlParameter(&quot;@p1&quot;, &quot;value&quot;),
                new MySqlParameter(&quot;@p2&quot;, 123)
            };

            // Act
            var result = Helper_Database_StoredProcedure.ValidateParameters(parameters);

            // Assert
            result.Should().BeTrue();
        }

        [Fact]
        public void ValidateParameters_NullInputParameterContent_ReturnsFalse()
        {
            // Arrange
            // Create a parameter with explicit null value (not DBNull)
            var parameter = new MySqlParameter(&quot;@p1&quot;, MySqlDbType.VarChar);
            parameter.Value = null;
            parameter.Direction = ParameterDirection.Input;

            var parameters = new[] { parameter };

            // Act
            var result = Helper_Database_StoredProcedure.ValidateParameters(parameters);

            // Assert
            result.Should().BeFalse(&quot;input parameters should not be null (use DBNull.Value instead)&quot;);
        }

        [Fact]
        public void ValidateParameters_DBNullInputParameter_ReturnsTrue()
        {
            // Arrange
            var parameters = new[]
            {
                new MySqlParameter(&quot;@p1&quot;, System.DBNull.Value)
            };

            // Act
            var result = Helper_Database_StoredProcedure.ValidateParameters(parameters);

            // Assert
            result.Should().BeTrue(&quot;DBNull.Value is a valid value for parameters&quot;);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Helpers/Database/Helper_Database_Variables_Tests.cs">using Xunit;
using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Helpers.Database;

namespace MTM_Receiving_Application.Tests.Module_Core.Helpers.Database
{
    /// &lt;summary&gt;
    /// Unit tests for Helper_Database_Variables
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Helper&quot;)]
    public class Helper_Database_Variables_Tests
    {
        [Fact]
        public void GetConnectionString_Production_ReturnsProductionString()
        {
            // Act
            var connectionString = Helper_Database_Variables.GetConnectionString(true);

            // Assert
            connectionString.Should().Contain(&quot;Database=mtm_receiving_application&quot;);
            connectionString.Should().NotContain(&quot;_test&quot;);
        }

        [Fact]
        public void GetConnectionString_Test_ReturnsTestString()
        {
            // Act
            var connectionString = Helper_Database_Variables.GetConnectionString(false);

            // Assert
            connectionString.Should().Contain(&quot;Database=mtm_receiving_application_test&quot;);
        }

        [Fact]
        public void GetInforVisualConnectionString_ReturnsReadOnlyIntent()
        {
            // Act
            var connectionString = Helper_Database_Variables.GetInforVisualConnectionString();

            // Assert
            connectionString.Should().Contain(&quot;ApplicationIntent=ReadOnly&quot;);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_AuthenticationResult_Tests.cs">using System;
using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Models.Systems;
using Xunit;

namespace MTM_Receiving_Application.Tests.Module_Core.Models.Systems
{
    /// &lt;summary&gt;
    /// Unit tests for Model_AuthenticationResult
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_AuthenticationResult_Tests
    {
        [Fact]
        public void SuccessResult_SetsSuccessTrue()
        {
            var user = new Model_User();

            var result = Model_AuthenticationResult.SuccessResult(user);

            result.Success.Should().BeTrue();
        }

        [Fact]
        public void SuccessResult_SetsUser()
        {
            var user = new Model_User();

            var result = Model_AuthenticationResult.SuccessResult(user);

            result.User.Should().BeSameAs(user);
        }

        [Fact]
        public void SuccessResult_SetsErrorMessageEmpty()
        {
            var user = new Model_User();

            var result = Model_AuthenticationResult.SuccessResult(user);

            result.ErrorMessage.Should().BeEmpty();
        }

        [Fact]
        public void SuccessResult_WithNullUser_Throws()
        {
            var act = static () =&gt; Model_AuthenticationResult.SuccessResult(null!);

            act.Should().Throw&lt;ArgumentNullException&gt;();
        }

        [Fact]
        public void ErrorResult_SetsSuccessFalse()
        {
            var result = Model_AuthenticationResult.ErrorResult(&quot;bad&quot;);

            result.Success.Should().BeFalse();
        }

        [Fact]
        public void ErrorResult_SetsUserNull()
        {
            var result = Model_AuthenticationResult.ErrorResult(&quot;bad&quot;);

            result.User.Should().BeNull();
        }

        [Fact]
        public void ErrorResult_SetsErrorMessage()
        {
            var result = Model_AuthenticationResult.ErrorResult(&quot;bad&quot;);

            result.ErrorMessage.Should().Be(&quot;bad&quot;);
        }

        [Fact]
        public void ErrorResult_WithNullMessage_Throws()
        {
            var act = static () =&gt; Model_AuthenticationResult.ErrorResult(null!);

            act.Should().Throw&lt;ArgumentException&gt;();
        }

        [Fact]
        public void ErrorResult_WithWhitespaceMessage_Throws()
        {
            var act = static () =&gt; Model_AuthenticationResult.ErrorResult(&quot;   &quot;);

            act.Should().Throw&lt;ArgumentException&gt;();
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_User_Tests.cs">using System;
using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Models.Systems;
using Xunit;

namespace MTM_Receiving_Application.Tests.Module_Core.Models.Systems
{
    /// &lt;summary&gt;
    /// Unit tests for Model_User
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_User_Tests
    {
        [Fact]
        public void Constructor_Default_SetsCreatedAndModifiedToNow()
        {
            // Arrange
            var before = DateTime.Now;

            // Act
            var user = new Model_User();
            var after = DateTime.Now;

            // Assert
            user.CreatedDate.Should().BeOnOrAfter(before);
            user.CreatedDate.Should().BeOnOrBefore(after);
            user.ModifiedDate.Should().BeOnOrAfter(before);
            user.ModifiedDate.Should().BeOnOrBefore(after);
        }

        [Fact]
        public void HasErpAccess_ReturnsFalseWhenVisualUsernameMissing()
        {
            var user = new Model_User { VisualUsername = null };

            user.HasErpAccess.Should().BeFalse();
        }

        [Fact]
        public void HasErpAccess_ReturnsFalseWhenVisualUsernameWhitespace()
        {
            var user = new Model_User { VisualUsername = &quot;   &quot; };

            user.HasErpAccess.Should().BeFalse();
        }

        [Fact]
        public void HasErpAccess_ReturnsTrueWhenVisualUsernameProvided()
        {
            var user = new Model_User { VisualUsername = &quot;user&quot; };

            user.HasErpAccess.Should().BeTrue();
        }

        [Fact]
        public void DisplayName_FormatsEmployeeNumberAndName()
        {
            var user = new Model_User
            {
                FullName = &quot;Jane Doe&quot;,
                EmployeeNumber = 123
            };

            user.DisplayName.Should().Be(&quot;Jane Doe (Emp #123)&quot;);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_ValidationResult_Tests.cs">using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Models.Systems;
using Xunit;

namespace MTM_Receiving_Application.Tests.Module_Core.Models.Systems
{
    /// &lt;summary&gt;
    /// Unit tests for Model_ValidationResult
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_ValidationResult_Tests
    {
        [Fact]
        public void Valid_SetsIsValidTrue()
        {
            var result = Model_ValidationResult.Valid();

            result.IsValid.Should().BeTrue();
        }

        [Fact]
        public void Valid_SetsErrorMessageEmpty()
        {
            var result = Model_ValidationResult.Valid();

            result.ErrorMessage.Should().BeEmpty();
        }

        [Fact]
        public void Invalid_SetsIsValidFalse()
        {
            var result = Model_ValidationResult.Invalid(&quot;bad&quot;);

            result.IsValid.Should().BeFalse();
        }

        [Fact]
        public void Invalid_SetsErrorMessage()
        {
            var result = Model_ValidationResult.Invalid(&quot;bad&quot;);

            result.ErrorMessage.Should().Be(&quot;bad&quot;);
        }

        [Fact]
        public void Invalid_WithNullMessage_NormalizesMessage()
        {
            var result = Model_ValidationResult.Invalid(null);

            result.ErrorMessage.Should().Be(&quot;Validation failed.&quot;);
        }

        [Fact]
        public void Invalid_WithWhitespaceMessage_NormalizesMessage()
        {
            var result = Model_ValidationResult.Invalid(&quot;   &quot;);

            result.ErrorMessage.Should().Be(&quot;Validation failed.&quot;);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Services/Authentication/Service_Authentication_Tests.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using System.Linq;
using Xunit;
using FluentAssertions;
using Moq;
using MTM_Receiving_Application.Module_Core.Services.Authentication;
using MTM_Receiving_Application.Module_Core.Data.Authentication;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Systems;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Core.Models.Core;

namespace MTM_Receiving_Application.Tests.Module_Core.Services.Authentication
{
    /// &lt;summary&gt;
    /// Unit tests for Service_Authentication
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Service&quot;)]
    public class Service_Authentication_Tests
    {
        private readonly Mock&lt;Dao_User&gt; _mockDaoUser;
        private readonly Mock&lt;IService_ErrorHandler&gt; _mockErrorHandler;
        private readonly Service_Authentication _sut;

        public Service_Authentication_Tests()
        {
            // Dao_User constructor requires a string, but the mock object will override virtual methods
            _mockDaoUser = new Mock&lt;Dao_User&gt;(&quot;Server=fake;&quot;);
            _mockErrorHandler = new Mock&lt;IService_ErrorHandler&gt;();
            _sut = new Service_Authentication(_mockDaoUser.Object, _mockErrorHandler.Object);
        }

        [Fact]
        public async Task AuthenticateByWindowsUsernameAsync_EmptyUsername_ReturnsError_Async()
        {
            // Act
            var result = await _sut.AuthenticateByWindowsUsernameAsync(&quot;&quot;);

            // Assert
            result.Success.Should().BeFalse();
            result.ErrorMessage.Should().Contain(&quot;required&quot;);
        }

        [Fact]
        public async Task AuthenticateByWindowsUsernameAsync_UserNotFound_ReturnsError_Async()
        {
            // Arrange
            _mockDaoUser.Setup(x =&gt; x.GetUserByWindowsUsernameAsync(It.IsAny&lt;string&gt;()))
                .ReturnsAsync(Model_Dao_Result_Factory.Failure&lt;Model_User&gt;(&quot;User not found&quot;));

            // Act
            var result = await _sut.AuthenticateByWindowsUsernameAsync(&quot;domain\\user&quot;);

            // Assert
            result.Success.Should().BeFalse();
            result.ErrorMessage.Should().Contain(&quot;not found&quot;);
        }

        [Fact]
        public async Task AuthenticateByWindowsUsernameAsync_ValidUser_ReturnsSuccess_Async()
        {
            // Arrange
            var user = new Model_User { FullName = &quot;Test User&quot;, WindowsUsername = &quot;domain\\user&quot; };
            _mockDaoUser.Setup(x =&gt; x.GetUserByWindowsUsernameAsync(&quot;domain\\user&quot;))
                .ReturnsAsync(Model_Dao_Result_Factory.Success(user));

            _mockDaoUser.Setup(x =&gt; x.LogUserActivityAsync(It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;()))
                .ReturnsAsync(Model_Dao_Result_Factory.Success(true));

            // Act
            var result = await _sut.AuthenticateByWindowsUsernameAsync(&quot;domain\\user&quot;);

            // Assert
            result.Success.Should().BeTrue();
            result.User.Should().BeEquivalentTo(user);
            _mockDaoUser.Verify(x =&gt; x.LogUserActivityAsync(&quot;login_success&quot;, &quot;domain\\user&quot;, It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;()), Times.Once);
        }

        [Theory]
        [InlineData(&quot;&quot;, &quot;1234&quot;)]
        [InlineData(&quot;user&quot;, &quot;&quot;)]
        [InlineData(&quot;user&quot;, &quot;123&quot;)] // Too short
        [InlineData(&quot;user&quot;, &quot;12345&quot;)] // Too long
        [InlineData(&quot;user&quot;, &quot;abcd&quot;)] // Non-numeric
        public async Task AuthenticateByPinAsync_InvalidInput_ReturnsError_Async(string username, string pin)
        {
            // Act
            var result = await _sut.AuthenticateByPinAsync(username, pin);

            // Assert
            result.Success.Should().BeFalse();
        }

        [Fact]
        public async Task AuthenticateByPinAsync_ValidCredentials_ReturnsSuccess_Async()
        {
            // Arrange
            var user = new Model_User { FullName = &quot;Test User&quot;, WindowsUsername = &quot;domain\\user&quot; };
            _mockDaoUser.Setup(x =&gt; x.ValidateUserPinAsync(&quot;user&quot;, &quot;1234&quot;))
                .ReturnsAsync(Model_Dao_Result_Factory.Success(user));

             _mockDaoUser.Setup(x =&gt; x.LogUserActivityAsync(It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;()))
                .ReturnsAsync(Model_Dao_Result_Factory.Success(true));

            // Act
            var result = await _sut.AuthenticateByPinAsync(&quot;user&quot;, &quot;1234&quot;);

            // Assert
            result.Success.Should().BeTrue();
            result.User.Should().Be(user);
        }

        [Fact]
        public async Task CreateNewUserAsync_InvalidData_ReturnsError_Async()
        {
            // Arrange
            var user = new Model_User { WindowsUsername = &quot;&quot; }; // Missing fields

            // Act
            var result = await _sut.CreateNewUserAsync(user, &quot;admin&quot;);

            // Assert
            result.Success.Should().BeFalse();
        }

         [Fact]
        public async Task CreateNewUserAsync_ValidData_ReturnsSuccess_Async()
        {
            // Arrange
            var user = new Model_User 
            { 
                WindowsUsername = &quot;domain\\newuser&quot;,
                FullName = &quot;New User&quot;,
                Department = &quot;Receiving&quot;,
                Shift = &quot;1&quot;,
                Pin = &quot;1234&quot;
            };
            
            _mockDaoUser.Setup(x =&gt; x.CreateNewUserAsync(user, &quot;admin&quot;))
                .ReturnsAsync(Model_Dao_Result_Factory.Success&lt;int&gt;(101));

             _mockDaoUser.Setup(x =&gt; x.LogUserActivityAsync(It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;()))
                .ReturnsAsync(Model_Dao_Result_Factory.Success(true));

            // Act
            var result = await _sut.CreateNewUserAsync(user, &quot;admin&quot;);

            // Assert
            result.Success.Should().BeTrue();
            result.EmployeeNumber.Should().Be(101);
        }

        [Theory]
        [InlineData(&quot;1234&quot;, true)]
        [InlineData(&quot;123&quot;, false)]
        [InlineData(&quot;abcd&quot;, false)]
        [InlineData(&quot;&quot;, false)]
        public async Task ValidatePinAsync_ValidatesCorrectly_Async(string pin, bool expectedValid)
        {
            // Act
            var result = await _sut.ValidatePinAsync(pin);

            // Assert
            result.IsValid.Should().Be(expectedValid);
        }

        [Fact]
        public async Task DetectWorkstationTypeAsync_SharedTerminal_ReturnsType_Async()
        {
            // Arrange
            var computerName = &quot;SHARED-PC&quot;;
            _mockDaoUser.Setup(x =&gt; x.GetSharedTerminalNamesAsync())
                .ReturnsAsync(Model_Dao_Result_Factory.Success(new List&lt;string&gt; { &quot;SHARED-PC&quot; }));

            // Act
            var result = await _sut.DetectWorkstationTypeAsync(computerName);

            // Assert
            result.WorkstationType.Should().Be(&quot;shared_terminal&quot;);
            result.ComputerName.Should().Be(computerName);
        }

         [Fact]
        public async Task DetectWorkstationTypeAsync_PersonalWorkstation_ReturnsType_Async()
        {
             // Arrange
            var computerName = &quot;PERSONAL-PC&quot;;
            _mockDaoUser.Setup(x =&gt; x.GetSharedTerminalNamesAsync())
                .ReturnsAsync(Model_Dao_Result_Factory.Success(new List&lt;string&gt; { &quot;SHARED-PC&quot; }));

            // Act
            var result = await _sut.DetectWorkstationTypeAsync(computerName);

            // Assert
            result.WorkstationType.Should().Be(&quot;personal_workstation&quot;);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Services/Authentication/Service_UserSessionManager_Tests.cs">using System;
using System.Threading.Tasks;
using Xunit;
using FluentAssertions;
using Moq;
using MTM_Receiving_Application.Module_Core.Services.Authentication;
using MTM_Receiving_Application.Module_Core.Data.Authentication;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Systems;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Core.Models.Core;

namespace MTM_Receiving_Application.Tests.Module_Core.Services.Authentication
{
    /// &lt;summary&gt;
    /// Unit tests for Service_UserSessionManager
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Service&quot;)]
    public class Service_UserSessionManager_Tests
    {
        private readonly Mock&lt;Dao_User&gt; _mockDaoUser;
        private readonly Mock&lt;IService_Dispatcher&gt; _mockDispatcher;
        private readonly Mock&lt;IService_DispatcherTimer&gt; _mockTimer;
        private readonly Service_UserSessionManager _sut;

        public Service_UserSessionManager_Tests()
        {
            _mockDaoUser = new Mock&lt;Dao_User&gt;(&quot;Server=fake;&quot;);
            _mockDispatcher = new Mock&lt;IService_Dispatcher&gt;();
            _mockTimer = new Mock&lt;IService_DispatcherTimer&gt;();
            
            _mockDispatcher.Setup(x =&gt; x.CreateTimer()).Returns(_mockTimer.Object);

            _sut = new Service_UserSessionManager(_mockDaoUser.Object, _mockDispatcher.Object);
        }

        [Fact]
        public void CreateSession_NullUser_ThrowsArgumentNullException()
        {
            // Act
            Action act = () =&gt; _sut.CreateSession(null!, new Model_WorkstationConfig(&quot;PC&quot;), &quot;Windows&quot;);

            // Assert
            act.Should().Throw&lt;ArgumentNullException&gt;().WithParameterName(&quot;user&quot;);
        }

        [Fact]
        public void CreateSession_ValidData_SetsCurrentSession()
        {
            // Arrange
            var user = new Model_User { WindowsUsername = &quot;test&quot; };
            var config = new Model_WorkstationConfig(&quot;PC&quot;) { WorkstationType = &quot;personal_workstation&quot; };

            // Act
            var session = _sut.CreateSession(user, config, &quot;Windows&quot;);

            // Assert
            session.Should().NotBeNull();
            session.User.Should().Be(user);
            session.WorkstationName.Should().Be(&quot;PC&quot;);
            session.TimeoutDuration.Should().Be(TimeSpan.FromMinutes(30));
            _sut.CurrentSession.Should().Be(session);
        }

        [Fact]
        public void StartTimeoutMonitoring_NoSession_ThrowsInvalidOperationException()
        {
            // Act
            Action act = () =&gt; _sut.StartTimeoutMonitoring();

            // Assert
            act.Should().Throw&lt;InvalidOperationException&gt;();
        }

        [Fact]
        public void StartTimeoutMonitoring_WithSession_StartsTimer()
        {
            // Arrange
            _sut.CreateSession(new Model_User(), new Model_WorkstationConfig(&quot;PC&quot;), &quot;Windows&quot;);

            // Act
            _sut.StartTimeoutMonitoring();

            // Assert
            _mockDispatcher.Verify(x =&gt; x.CreateTimer(), Times.Once);
            _mockTimer.Verify(x =&gt; x.Start(), Times.Once);
            _mockTimer.VerifySet(x =&gt; x.Interval = It.IsAny&lt;TimeSpan&gt;());
            _mockTimer.VerifySet(x =&gt; x.IsRepeating = true);
        }

        [Fact]
        public void StopTimeoutMonitoring_StopsTimer()
        {
            // Arrange
            _sut.CreateSession(new Model_User(), new Model_WorkstationConfig(&quot;PC&quot;), &quot;Windows&quot;);
            _sut.StartTimeoutMonitoring();

            // Act
            _sut.StopTimeoutMonitoring();

            // Assert
            _mockTimer.Verify(x =&gt; x.Stop(), Times.Once);
        }

        [Fact]
        public async Task EndSessionAsync_LogsAndClearsSession_Async()
        {
            // Arrange
            var user = new Model_User { WindowsUsername = &quot;test&quot; };
            _sut.CreateSession(user, new Model_WorkstationConfig(&quot;PC&quot;), &quot;Windows&quot;);
            _sut.StartTimeoutMonitoring();

            _mockDaoUser.Setup(x =&gt; x.LogUserActivityAsync(It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;()))
                .ReturnsAsync(Model_Dao_Result_Factory.Success(true));

            // Act
            await _sut.EndSessionAsync(&quot;Logout&quot;);

            // Assert
            _sut.CurrentSession.Should().BeNull();
            _mockTimer.Verify(x =&gt; x.Stop(), Times.Once); // Should stop monitoring
             _mockDaoUser.Verify(x =&gt; x.LogUserActivityAsync(&quot;Logout&quot;, &quot;test&quot;, &quot;PC&quot;, It.IsNotNull&lt;string&gt;()), Times.Once);
        }

        [Fact]
        public void UpdateLastActivity_UpdatesTimestamp()
        {
            // Arrange
            _sut.CreateSession(new Model_User(), new Model_WorkstationConfig(&quot;PC&quot;), &quot;Windows&quot;);
            var initialTime = _sut.CurrentSession!.LastActivityTimestamp;
            
            // Wait a tiny bit (not reliable in unit tests really, but checks update)
            // Instead we can check that it&apos;s very close or just called.
            // Since we can&apos;t inject time provider, we assume DateTime.Now changes or is called.
            
            // Act
            _sut.UpdateLastActivity();

            // Assert
            _sut.CurrentSession.LastActivityTimestamp.Should().BeOnOrAfter(initialTime);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Services/Database/Service_ErrorHandler_Tests.cs">using System;
using System.Threading.Tasks;
using Xunit;
using FluentAssertions;
using Moq;
using MTM_Receiving_Application.Module_Core.Services.Database;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Core.Models.Core;
using Microsoft.UI.Xaml;

namespace MTM_Receiving_Application.Tests.Module_Core.Services.Database
{
    /// &lt;summary&gt;
    /// Unit tests for Service_ErrorHandler
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Service&quot;)]
    public class Service_ErrorHandler_Tests
    {
        private readonly Mock&lt;IService_LoggingUtility&gt; _mockLogger;
        private readonly Mock&lt;IService_Window&gt; _mockWindowService;
        private readonly Service_ErrorHandler _sut;

        public Service_ErrorHandler_Tests()
        {
            _mockLogger = new Mock&lt;IService_LoggingUtility&gt;();
            _mockWindowService = new Mock&lt;IService_Window&gt;();
            _sut = new Service_ErrorHandler(_mockLogger.Object, _mockWindowService.Object);
        }

        [Fact]
        public async Task LogErrorAsync_InfoSeverity_CallsLogInfo_Async()
        {
            // Act
            await _sut.LogErrorAsync(&quot;Test Info&quot;, Enum_ErrorSeverity.Info);

            // Assert
            _mockLogger.Verify(x =&gt; x.LogInfo(&quot;Test Info&quot;, It.IsAny&lt;string?&gt;()), Times.Once);
        }

        [Fact]
        public async Task LogErrorAsync_ErrorSeverity_CallsLogError_Async()
        {
            // Arrange
            var ex = new Exception(&quot;Test Ex&quot;);

            // Act
            await _sut.LogErrorAsync(&quot;Test Error&quot;, Enum_ErrorSeverity.Error, ex);

            // Assert
            _mockLogger.Verify(x =&gt; x.LogError(&quot;Test Error&quot;, ex, It.IsAny&lt;string?&gt;()), Times.Once);
        }

        [Fact]
        public async Task HandleErrorAsync_ShowDialogFalse_OnlyLogs_Async()
        {
            // Act
            await _sut.HandleErrorAsync(&quot;Test&quot;, Enum_ErrorSeverity.Warning, null, false);

            // Assert
            _mockLogger.Verify(x =&gt; x.LogWarning(&quot;Test&quot;, It.IsAny&lt;string?&gt;()), Times.Once);
            _mockWindowService.Verify(x =&gt; x.GetXamlRoot(), Times.Never);
        }

        [Fact]
        public async Task HandleErrorAsync_ShowDialogTrue_LogsAndChecksWindow_Async()
        {
            // Arrange
            _mockWindowService.Setup(x =&gt; x.GetXamlRoot()).Returns((XamlRoot?)null); // Returrns null to avoid UI thread crash

            // Act
            await _sut.HandleErrorAsync(&quot;Test&quot;, Enum_ErrorSeverity.Error, null, true);

            // Assert
            _mockLogger.Verify(x =&gt; x.LogError(&quot;Test&quot;, null, It.IsAny&lt;string?&gt;()), Times.Once);
            _mockWindowService.Verify(x =&gt; x.GetXamlRoot(), Times.Once);
            // Since xamlRoot is null, we expect a warning log about it
            _mockLogger.Verify(x =&gt; x.LogWarning(&quot;Cannot show dialog - XamlRoot is null&quot;, It.IsAny&lt;string?&gt;()), Times.Once);
        }

        [Fact]
        public async Task HandleDaoErrorAsync_SuccessResult_DoesNothing_Async()
        {
            // Arrange
            var result = Model_Dao_Result_Factory.Success();

            // Act
            await _sut.HandleDaoErrorAsync(result, &quot;TestOp&quot;);

            // Assert
            _mockLogger.Verify(x =&gt; x.LogInfo(It.IsAny&lt;string&gt;(), It.IsAny&lt;string?&gt;()), Times.Never);
            _mockLogger.Verify(x =&gt; x.LogError(It.IsAny&lt;string&gt;(), It.IsAny&lt;Exception?&gt;(), It.IsAny&lt;string?&gt;()), Times.Never);
        }

        [Fact]
        public async Task HandleDaoErrorAsync_FailureResult_LogsError_Async()
        {
            // Arrange
            var result = Model_Dao_Result_Factory.Failure(&quot;DB Fail&quot;, new Exception(&quot;SQL Error&quot;));
            _mockWindowService.Setup(x =&gt; x.GetXamlRoot()).Returns((XamlRoot?)null);

            // Act
            await _sut.HandleDaoErrorAsync(result, &quot;TestOp&quot;, true);

            // Assert
            _mockLogger.Verify(x =&gt; x.LogError(It.Is&lt;string&gt;(s =&gt; s.Contains(&quot;DB Fail&quot;) &amp;&amp; s.Contains(&quot;TestOp&quot;)), It.IsAny&lt;Exception&gt;(), It.IsAny&lt;string?&gt;()), Times.Once);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Services/Help/Service_Help_Tests.cs">using System;
using System.Linq;
using Xunit;
using FluentAssertions;
using Moq;
using MTM_Receiving_Application.Module_Core.Services.Help;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Core;

namespace MTM_Receiving_Application.Tests.Module_Core.Services.Help
{
    /// &lt;summary&gt;
    /// Unit tests for Service_Help content retrieval
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Service&quot;)]
    public class Service_Help_Tests
    {
        private readonly Mock&lt;IService_Window&gt; _mockWindow;
        private readonly Mock&lt;IService_LoggingUtility&gt; _mockLogger;
        private readonly Mock&lt;IService_Dispatcher&gt; _mockDispatcher;
        private readonly Service_Help _sut;

        public Service_Help_Tests()
        {
            _mockWindow = new Mock&lt;IService_Window&gt;();
            _mockLogger = new Mock&lt;IService_LoggingUtility&gt;();
            _mockDispatcher = new Mock&lt;IService_Dispatcher&gt;();

        _sut = new Service_Help(_mockWindow.Object, _mockLogger.Object, _mockDispatcher.Object);
        }

        [Fact]
        public void GetHelpContent_ExistingKey_ReturnsContent()
        {
            // Act
            var content = _sut.GetHelpContent(&quot;Dunnage.ModeSelection&quot;);

            // Assert
            content.Should().NotBeNull();
            content?.Title.Should().Be(&quot;Select Entry Mode&quot;);
            content?.Key.Should().Be(&quot;Dunnage.ModeSelection&quot;);
        }

        [Fact]
        public void GetHelpContent_NonExistentKey_ReturnsNull()
        {
            // Act
            var content = _sut.GetHelpContent(&quot;NonExistentKey&quot;);

            // Assert
            content.Should().BeNull();
        }

        [Fact]
        public void GetHelpByCategory_ReturnsFilteredList()
        {
            // Act
            var list = _sut.GetHelpByCategory(&quot;Dunnage Workflow&quot;);

            // Assert
            list.Should().NotBeEmpty();
            list.All(x =&gt; x.Category == &quot;Dunnage Workflow&quot;).Should().BeTrue();
        }

        [Fact]
        public void SearchHelp_ReturnsMatchingItems()
        {
            // Act
            var results = _sut.SearchHelp(&quot;dunnage&quot;);

            // Assert
            results.Should().NotBeEmpty();
            // Should contain items with &quot;dunnage&quot; in title or content
            results.Should().Contain(x =&gt; x.Title.ToLower().Contains(&quot;dunnage&quot;) || x.Content.ToLower().Contains(&quot;dunnage&quot;));
        }

        [Fact]
        public void SearchHelp_EmptyTerm_ReturnsEmptyList()
        {
            // Act
            var results = _sut.SearchHelp(&quot;&quot;);

            // Assert
            results.Should().BeEmpty();
        }

         [Fact]
        public void TipRetreival_ReturnsContent()
        {
            // Act
            var tip = _sut.GetTip(&quot;Dunnage.QuantityEntry&quot;);

            // Assert
            tip.Should().NotBeNullOrEmpty();
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Services/UI/Service_ViewModelRegistry_Tests.cs">using System;
using System.Linq;
using Xunit;
using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Services.UI;
using MTM_Receiving_Application.Module_Core.Contracts.ViewModels;

namespace MTM_Receiving_Application.Tests.Module_Core.Services.UI
{
    /// &lt;summary&gt;
    /// Unit tests for Service_ViewModelRegistry
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Service&quot;)]
    public class Service_ViewModelRegistry_Tests
    {
        private class TestViewModel : IResettableViewModel
        {
            public bool ResetCalled { get; private set; }
            public void ResetToDefaults() =&gt; ResetCalled = true;
        }

        private class AnotherViewModel { }

        [Fact]
        public void Register_and_GetViewModels_WorksCorrectly()
        {
            // Arrange
            var sut = new Service_ViewModelRegistry();
            var vm1 = new TestViewModel();
            var vm2 = new AnotherViewModel();

            // Act
            sut.Register(vm1);
            sut.Register(vm2);

            var retrieved = sut.GetViewModels&lt;TestViewModel&gt;().ToList();

            // Assert
            retrieved.Should().HaveCount(1);
            retrieved.First().Should().Be(vm1);
        }

        [Fact]
        public void ClearAllInputs_CallsResetOnResettableVMs()
        {
            // Arrange
            var sut = new Service_ViewModelRegistry();
            var vm1 = new TestViewModel();
            var vm2 = new AnotherViewModel(); // Not resettable

            sut.Register(vm1);
            sut.Register(vm2);

            // Act
            sut.ClearAllInputs();

            // Assert
            vm1.ResetCalled.Should().BeTrue();
        }

        [Fact]
        public void Cleanup_RemovesDeadReferences()
        {
             // Arrange
            var sut = new Service_ViewModelRegistry();
            
            void RegisterTemporaryVM()
            {
                var vm = new TestViewModel();
                sut.Register(vm);
            }

            RegisterTemporaryVM();
            
            // Force GC to collect the temporary VM
            GC.Collect();
            GC.WaitForPendingFinalizers();

            // Act
            // GetViewModels calls Cleanup internally
            var list = sut.GetViewModels&lt;TestViewModel&gt;().ToList();

            // Assert
            list.Should().BeEmpty();
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_Application_Variables_Tests.cs">using System;
using System.IO;
using FluentAssertions;
using MTM_Receiving_Application.Module_Receiving.Models;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Unit tests for Model_Application_Variables.
    /// Tests default configurations.
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_Application_Variables_Tests
    {
        [Fact]
        public void Constructor_Defaults_SetsSensibleValues()
        {
            // Act
            var config = new Model_Application_Variables();

            // Assert
            config.ApplicationName.Should().NotBeEmpty();
            config.Version.Should().MatchRegex(@&quot;\d+\.\d+\.\d+&quot;);
            config.ConnectionString.Should().BeEmpty();
            config.EnvironmentType.Should().Be(&quot;Development&quot;);
        }

        [Fact]
        public void LogDirectory_Default_IsInAppData()
        {
            // Act
            var config = new Model_Application_Variables();
            var appData = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);

            // Assert
            config.LogDirectory.Should().StartWith(appData);
            config.LogDirectory.Should().Contain(&quot;MTM_Receiving_Application&quot;);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_CSVDeleteResult_Tests.cs">using FluentAssertions;
using MTM_Receiving_Application.Module_Receiving.Models;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Unit tests for Model_CSVDeleteResult.
    /// Tests simple property behavior.
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_CSVDeleteResult_Tests
    {
        [Fact]
        public void Properties_SetAndGet_WorksCorrectly()
        {
            // Arrange
            var result = new Model_CSVDeleteResult();

            // Act
            result.LocalDeleted = true;
            result.NetworkDeleted = false;
            result.LocalError = null;
            result.NetworkError = &quot;Access Denied&quot;;

            // Assert
            result.LocalDeleted.Should().BeTrue();
            result.NetworkDeleted.Should().BeFalse();
            result.LocalError.Should().BeNull();
            result.NetworkError.Should().Be(&quot;Access Denied&quot;);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_CSVExistenceResult_Tests.cs">using FluentAssertions;
using MTM_Receiving_Application.Module_Receiving.Models;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Unit tests for Model_CSVExistenceResult.
    /// Tests simple property holders.
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_CSVExistenceResult_Tests
    {
        [Fact]
        public void Properties_SetAndGet_Works()
        {
            // Arrange
            var result = new Model_CSVExistenceResult();

            // Act
            result.LocalExists = true;
            result.NetworkExists = true;
            result.NetworkAccessible = true;

            // Assert
            result.LocalExists.Should().BeTrue();
            result.NetworkExists.Should().BeTrue();
            result.NetworkAccessible.Should().BeTrue();
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_CSVWriteResult_Tests.cs">using FluentAssertions;
using MTM_Receiving_Application.Module_Receiving.Models;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Unit tests for Model_CSVWriteResult.
    /// Tests success calculation logic.
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_CSVWriteResult_Tests
    {
        [Fact]
        public void Constructor_Defaults_AreCorrect()
        {
            // Act
            var result = new Model_CSVWriteResult();

            // Assert
            result.LocalSuccess.Should().BeFalse();
            result.NetworkSuccess.Should().BeFalse();
            result.ErrorMessage.Should().BeEmpty();
        }

        [Fact]
        public void IsFullSuccess_ReturnsTrueOnlyIfBothSucceed()
        {
            // Arrange
            var result = new Model_CSVWriteResult
            {
                LocalSuccess = true,
                NetworkSuccess = true
            };

            // Assert
            result.IsFullSuccess.Should().BeTrue();
            result.IsPartialSuccess.Should().BeFalse();
            result.IsFailure.Should().BeFalse();
        }

        [Fact]
        public void IsPartialSuccess_ReturnsTrueOnlyIfLocalSucceedsButNetworkFails()
        {
            // Arrange
            var result = new Model_CSVWriteResult
            {
                LocalSuccess = true,
                NetworkSuccess = false
            };

            // Assert
            result.IsFullSuccess.Should().BeFalse();
            result.IsPartialSuccess.Should().BeTrue();
            result.IsFailure.Should().BeFalse();
        }

        [Fact]
        public void IsFailure_ReturnsTrueIfLocalFails()
        {
            // Arrange
            var result = new Model_CSVWriteResult
            {
                LocalSuccess = false,
                NetworkSuccess = true // Weird case, but if local fails it&apos;s considered failure per logic
            };

            // Assert
            result.IsFailure.Should().BeTrue();
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_InforVisualPart_Tests.cs">using FluentAssertions;
using MTM_Receiving_Application.Module_Receiving.Models;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Unit tests for Model_InforVisualPart.
    /// Tests display text logic.
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_InforVisualPart_Tests
    {
        [Fact]
        public void DisplayText_FormatsCorrectly()
        {
            // Arrange
            var part = new Model_InforVisualPart
            {
                PartID = &quot;PART-01&quot;,
                Description = &quot;A Widget&quot;,
                POLineNumber = &quot;001&quot;
            };

            // Act
            var text = part.DisplayText;

            // Assert
            text.Should().Be(&quot;PART-01 - A Widget (Line 001)&quot;);
        }

        [Fact]
        public void Constructor_Defaults_AreCorrect()
        {
            // Act
            var part = new Model_InforVisualPart();

            // Assert
            part.UnitOfMeasure.Should().Be(&quot;EA&quot;);
            part.QtyOrdered.Should().Be(0);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_InforVisualPO_Tests.cs">using System.Collections.Generic;
using FluentAssertions;
using MTM_Receiving_Application.Module_Receiving.Models;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Unit tests for Model_InforVisualPO.
    /// Tests calculated properties and default lists.
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_InforVisualPO_Tests
    {
        [Fact]
        public void Constructor_Defaults_AreCorrect()
        {
            // Act
            var po = new Model_InforVisualPO();

            // Assert
            po.Parts.Should().NotBeNull().And.BeEmpty();
            po.HasParts.Should().BeFalse();
            po.PONumber.Should().BeEmpty();
        }

        [Fact]
        public void HasParts_ReturnsTrueOnlyWhenPartsExist()
        {
            // Arrange
            var po = new Model_InforVisualPO();

            // Act
            po.Parts.Add(new Model_InforVisualPart());

            // Assert
            po.HasParts.Should().BeTrue();
        }

        [Theory]
        [InlineData(&quot;R&quot;, &quot;Open&quot;)]
        [InlineData(&quot;O&quot;, &quot;Open&quot;)]
        [InlineData(&quot;C&quot;, &quot;Closed&quot;)]
        [InlineData(&quot;X&quot;, &quot;Cancelled&quot;)]
        [InlineData(&quot;P&quot;, &quot;Partially Received&quot;)]
        [InlineData(&quot;F&quot;, &quot;Firm&quot;)]
        [InlineData(&quot;&quot;, &quot;Unknown&quot;)]
        [InlineData(&quot;Z&quot;, &quot;Status: Z&quot;)] // Unknown code fallback
        public void StatusDescription_MapsCodesCorrectly(string code, string expected)
        {
            // Arrange
            var po = new Model_InforVisualPO { Status = code };

            // Act
            var desc = po.StatusDescription;

            // Assert
            desc.Should().Be(expected);
        }

        [Theory]
        [InlineData(&quot;C&quot;, true)]
        [InlineData(&quot;X&quot;, true)]
        [InlineData(&quot;R&quot;, false)]
        [InlineData(&quot;O&quot;, false)]
        [InlineData(&quot;P&quot;, false)]
        public void IsClosed_ReturnsTrueForClosedOrCancelled(string status, bool expected)
        {
            // Arrange
            var po = new Model_InforVisualPO { Status = status };

            // Act
            var isClosed = po.IsClosed;

            // Assert
            isClosed.Should().Be(expected);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_PackageTypePreference_Tests.cs">using System;
using FluentAssertions;
using MTM_Receiving_Application.Module_Receiving.Models;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Unit tests for Model_PackageTypePreference.
    /// Tests simple property behavior and default DateTime.
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_PackageTypePreference_Tests
    {
        [Fact]
        public void Constructor_Defaults_AreCorrect()
        {
            // Act
            var model = new Model_PackageTypePreference();

            // Assert
            model.PartID.Should().BeEmpty();
            model.PackageTypeName.Should().BeEmpty();
            model.LastModified.Should().BeCloseTo(DateTime.UtcNow, TimeSpan.FromSeconds(10));
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingLine_Tests.cs">using System;
using FluentAssertions;
using MTM_Receiving_Application.Module_Receiving.Models;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Unit tests for Model_ReceivingLine.
    /// Tests property defaults and formatting.
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_ReceivingLine_Tests
    {
        [Fact]
        public void Constructor_Defaults_AreCorrect()
        {
            // Act
            var line = new Model_ReceivingLine();

            // Assert
            line.Date.Should().BeCloseTo(DateTime.Now, TimeSpan.FromSeconds(1));
            line.LabelNumber.Should().Be(1);
            line.TotalLabels.Should().Be(1);
            line.VendorName.Should().Be(&quot;Unknown&quot;);
            line.PartID.Should().BeEmpty();
        }

        [Fact]
        public void LabelText_ReturnsFormattedString()
        {
            // Arrange
            var line = new Model_ReceivingLine
            {
                LabelNumber = 2,
                TotalLabels = 5
            };

            // Act
            var text = line.LabelText;

            // Assert
            text.Should().Be(&quot;2 / 5&quot;);
        }

        [Fact]
        public void LabelText_UpdatesWhenPropertiesChange()
        {
            // Arrange
            var line = new Model_ReceivingLine
            {
                LabelNumber = 1,
                TotalLabels = 1
            };

            // Act
            line.LabelNumber = 3;
            line.TotalLabels = 10;

            // Assert
            line.LabelText.Should().Be(&quot;3 / 10&quot;);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingLoad_Tests.cs">using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Receiving.Models;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Unit tests for Model_ReceivingLoad.
    /// Tests property logic, change handlers, and calculations.
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_ReceivingLoad_Tests
    {
        private Model_ReceivingLoad _sut;

        public Model_ReceivingLoad_Tests()
        {
            _sut = new Model_ReceivingLoad();
        }

        // ====================================================================
        // Constructor &amp; Defaults
        // ====================================================================

        [Fact]
        public void Constructor_Initialization_SetsDefaults()
        {
            // Act
            var model = new Model_ReceivingLoad();

            // Assert
            model.LoadID.Should().NotBeEmpty();
            model.PartID.Should().BeEmpty();
            model.HeatLotNumber.Should().BeEmpty();
            model.ReceivedDate.Should().BeCloseTo(DateTime.Now, TimeSpan.FromSeconds(1));
            model.PackageType.Should().Be(Enum_PackageType.Skid);
            model.PackageTypeName.Should().Be(&quot;Skid&quot;);
            model.PackagesPerLoad.Should().Be(0);
        }

        // ====================================================================
        // Property Logic: PartID
        // ====================================================================

        [Fact]
        public void PartID_WhenChanged_SetsPackagesPerLoadToOneIfZero()
        {
            // Arrange
            _sut.PackagesPerLoad = 0;

            // Act
            _sut.PartID = &quot;TEST-PART&quot;;

            // Assert
            _sut.PackagesPerLoad.Should().Be(1);
        }

        [Fact]
        public void PartID_WhenChangedToMMC_SetsPackageTypeToCoil()
        {
            // Arrange
            _sut.PackageType = Enum_PackageType.Skid;

            // Act
            _sut.PartID = &quot;PART-MMC-001&quot;;

            // Assert
            _sut.PackageType.Should().Be(Enum_PackageType.Coil);
        }

        [Fact]
        public void PartID_WhenChangedToMMF_SetsPackageTypeToSheet()
        {
            // Arrange
            _sut.PackageType = Enum_PackageType.Skid;

            // Act
            _sut.PartID = &quot;PART-MMF-001&quot;;

            // Assert
            _sut.PackageType.Should().Be(Enum_PackageType.Sheet);
        }

        [Theory]
        [InlineData(null)]
        [InlineData(&quot;&quot;)]
        [InlineData(&quot;   &quot;)]
        public void PartID_WhenSetToEmptyOrNull_DoesNotChangePackageType(string partId)
        {
            // Arrange
            _sut.PackageType = Enum_PackageType.Skid;
            _sut.PackagesPerLoad = 0;

            // Act
            _sut.PartID = partId;

            // Assert
            _sut.PackageType.Should().Be(Enum_PackageType.Skid);
            _sut.PackagesPerLoad.Should().Be(0);
        }

        // ====================================================================
        // Property Logic: PackageType / PackageTypeName
        // ====================================================================

        [Fact]
        public void PackageType_WhenChanged_UpdatesPackageTypeName()
        {
            // Act
            _sut.PackageType = Enum_PackageType.Box;

            // Assert
            _sut.PackageTypeName.Should().Be(&quot;Box&quot;);
        }

        [Fact]
        public void PackageTypeName_WhenChangedToValidEnum_UpdatesPackageType()
        {
            // Act
            _sut.PackageTypeName = &quot;Box&quot;;

            // Assert
            _sut.PackageType.Should().Be(Enum_PackageType.Box);
        }

        [Fact]
        public void PackageTypeName_WhenChangedToInvalidEnum_DoesNotUpdatePackageType()
        {
            // Arrange
            _sut.PackageType = Enum_PackageType.Skid;

            // Act
            _sut.PackageTypeName = &quot;InvalidType&quot;;

            // Assert
            _sut.PackageType.Should().Be(Enum_PackageType.Skid);
        }

        // ====================================================================
        // Calculation: WeightPerPackage
        // ====================================================================

        [Theory]
        [InlineData(100.0, 2, 50.0)]
        [InlineData(1000.0, 4, 250.0)]
        [InlineData(100.0, 3, 33.0)] // Rounds to nearest whole number as per logic: Math.Round(..., 0)
        [InlineData(0.0, 1, 0.0)]
        public void CalculateWeightPerPackage_UpdatesUsingWeightAndPackages(decimal weight, int packages, decimal expected)
        {
            // Act
            _sut.WeightQuantity = weight;
            _sut.PackagesPerLoad = packages;

            // Assert
            _sut.WeightPerPackage.Should().Be(expected);
        }

        [Fact]
        public void CalculateWeightPerPackage_WhenPackagesIsZero_SetResultToZero()
        {
            // Arrange
            _sut.WeightQuantity = 100;
            _sut.PackagesPerLoad = 0;

            // Act &amp; Assert
            // Triggers OnPackagesPerLoadChanged
            _sut.WeightPerPackage.Should().Be(0);
        }

        // ====================================================================
        // Calculated Properties
        // ====================================================================

        [Fact]
        public void WeightPerPackageDisplay_FormattedCorrectly()
        {
            // Arrange
            _sut.WeightQuantity = 100;
            _sut.PackagesPerLoad = 2;
            _sut.PackageType = Enum_PackageType.Box;

            // Act
            var display = _sut.WeightPerPackageDisplay;

            // Assert
            display.Should().Be(&quot;50 lbs per Box&quot;);
        }

        [Fact]
        public void PONumberDisplay_WhenNullOrEmpty_ReturnsNA()
        {
            // Arrange
            _sut.PoNumber = null;

            // Act
            var display = _sut.PONumberDisplay;

            // Assert
            display.Should().Be(&quot;N/A&quot;);
        }

        [Fact]
        public void PONumberDisplay_WhenValid_ReturnsPONumber()
        {
            // Arrange
            _sut.PoNumber = &quot;12345&quot;;

            // Act
            var display = _sut.PONumberDisplay;

            // Assert
            display.Should().Be(&quot;12345&quot;);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingSession_Tests.cs">using System;
using System.Collections.Generic;
using System.Linq;
using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Models.Systems;
using MTM_Receiving_Application.Module_Receiving.Models;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Unit tests for Model_ReceivingSession.
    /// Tests aggregation logic and transient properties.
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_ReceivingSession_Tests
    {
        [Fact]
        public void Constructor_Defaults_AreCorrect()
        {
            // Act
            var session = new Model_ReceivingSession();

            // Assert
            session.SessionID.Should().NotBeEmpty();
            session.CreatedDate.Should().BeCloseTo(DateTime.Now, TimeSpan.FromSeconds(1));
            session.Loads.Should().NotBeNull().And.BeEmpty();
            session.TotalLoadsCount.Should().Be(0);
            session.TotalWeightQuantity.Should().Be(0);
            session.HasLoads.Should().BeFalse();
        }

        [Fact]
        public void TotalWeightQuantity_CalculatesSumCorrectly()
        {
            // Arrange
            var session = new Model_ReceivingSession();
            session.Loads.Add(new Model_ReceivingLoad { WeightQuantity = 100 });
            session.Loads.Add(new Model_ReceivingLoad { WeightQuantity = 250 });

            // Act
            var total = session.TotalWeightQuantity;

            // Assert
            total.Should().Be(350);
        }

        [Fact]
        public void UniqueParts_ReturnsDistinctList()
        {
            // Arrange
            var session = new Model_ReceivingSession();
            session.Loads.Add(new Model_ReceivingLoad { PartID = &quot;PART-A&quot; });
            session.Loads.Add(new Model_ReceivingLoad { PartID = &quot;PART-A&quot; });
            session.Loads.Add(new Model_ReceivingLoad { PartID = &quot;PART-B&quot; });

            // Act
            var parts = session.UniqueParts;

            // Assert
            parts.Should().HaveCount(2);
            parts.Should().Contain(&quot;PART-A&quot;);
            parts.Should().Contain(&quot;PART-B&quot;);
        }

        [Fact]
        public void HasLoads_ReturnsTrueWhenLoadsExist()
        {
            // Arrange
            var session = new Model_ReceivingSession();
            session.Loads.Add(new Model_ReceivingLoad());

            // Act
            var hasLoads = session.HasLoads;

            // Assert
            hasLoads.Should().BeTrue();
        }

        [Fact]
        public void TransientProperties_HandleNullLoadsForSafety()
        {
            // Arrange
            var session = new Model_ReceivingSession
            {
                Loads = null! // Simulating deserialization issue or explicit null set
            };

            // Assert
            session.TotalLoadsCount.Should().Be(0);
            session.TotalWeightQuantity.Should().Be(0);
            session.UniqueParts.Should().NotBeNull().And.BeEmpty();
            session.HasLoads.Should().BeFalse();
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingValidationResult_Tests.cs">using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Receiving.Models;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Unit tests for Model_ReceivingValidationResult.
    /// Tests factory methods and default states.
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_ReceivingValidationResult_Tests
    {
        [Fact]
        public void Constructor_Defaults_AreSafe()
        {
            // Act
            var result = new Model_ReceivingValidationResult();

            // Assert
            result.IsValid.Should().BeFalse();
            result.Severity.Should().Be(Enum_ValidationSeverity.Error);
            result.Message.Should().BeEmpty();
            result.Errors.Should().NotBeNull().And.BeEmpty();
        }

        [Fact]
        public void Success_Factory_ReturnsValidObject()
        {
            // Act
            var result = Model_ReceivingValidationResult.Success();

            // Assert
            result.IsValid.Should().BeTrue();
            result.Message.Should().BeEmpty();
            result.Errors.Should().BeEmpty();
        }

        [Fact]
        public void Error_Factory_ReturnsErrorObject()
        {
            // Act
            var msg = &quot;Some error&quot;;
            var result = Model_ReceivingValidationResult.Error(msg);

            // Assert
            result.IsValid.Should().BeFalse();
            result.Severity.Should().Be(Enum_ValidationSeverity.Error);
            result.Message.Should().Be(msg);
            result.Errors.Should().Contain(msg);
        }

        [Fact]
        public void Warning_Factory_ReturnsWarningObject()
        {
            // Act
            var msg = &quot;Pay attention&quot;;
            var result = Model_ReceivingValidationResult.Warning(msg);

            // Assert
            result.IsValid.Should().BeTrue(&quot;Warnings should not block validity&quot;);
            result.Severity.Should().Be(Enum_ValidationSeverity.Warning);
            result.Message.Should().Be(msg);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingWorkflowStepResult_Tests.cs">using System.Collections.Generic;
using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Receiving.Models;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Unit tests for Model_ReceivingWorkflowStepResult.
    /// Tests factory methods and properties.
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_ReceivingWorkflowStepResult_Tests
    {
        [Fact]
        public void Constructor_Defaults_AreCorrect()
        {
            // Act
            var result = new Model_ReceivingWorkflowStepResult();

            // Assert
            result.Success.Should().BeFalse();
            result.Message.Should().BeEmpty();
            result.ValidationErrors.Should().NotBeNull().And.BeEmpty();
        }

        [Fact]
        public void SuccessResult_Factory_CreatesSuccessObject()
        {
            // Act
            var step = Enum_ReceivingWorkflowStep.Review;
            var message = &quot;Success&quot;;
            var result = Model_ReceivingWorkflowStepResult.SuccessResult(step, message);

            // Assert
            result.Success.Should().BeTrue();
            result.NewStep.Should().Be(step);
            result.Message.Should().Be(message);
        }

        [Fact]
        public void ErrorResult_Factory_CreatesErrorObject()
        {
            // Act
            var errors = new List&lt;string&gt; { &quot;Error 1&quot;, &quot;Error 2&quot; };
            var result = Model_ReceivingWorkflowStepResult.ErrorResult(errors);

            // Assert
            result.Success.Should().BeFalse();
            result.ValidationErrors.Should().BeEquivalentTo(errors);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_SaveResult_Tests.cs">using System.Collections.Generic;
using FluentAssertions;
using MTM_Receiving_Application.Module_Receiving.Models;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Unit tests for Model_SaveResult.
    /// Tests success calculation logic and property behavior.
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_SaveResult_Tests
    {
        [Fact]
        public void Constructor_Defaults_AreCorrect()
        {
            // Act
            var result = new Model_SaveResult();

            // Assert
            result.Success.Should().BeFalse();
            result.LoadsSaved.Should().Be(0);
            result.LocalCSVSuccess.Should().BeFalse();
            result.NetworkCSVSuccess.Should().BeFalse();
            result.DatabaseSuccess.Should().BeFalse();
            result.Errors.Should().BeEmpty();
            result.Warnings.Should().BeEmpty();
        }

        [Fact]
        public void IsFullSuccess_WhenAllTrue_ReturnsTrue()
        {
            // Arrange
            var result = new Model_SaveResult
            {
                LocalCSVSuccess = true,
                NetworkCSVSuccess = true,
                DatabaseSuccess = true
            };

            // Assert
            result.IsFullSuccess.Should().BeTrue();
            result.IsPartialSuccess.Should().BeFalse();
        }

        [Theory]
        [InlineData(false, true, true)]
        [InlineData(true, false, true)]
        [InlineData(true, true, false)]
        [InlineData(false, false, false)]
        public void IsFullSuccess_WhenAnyFalse_ReturnsFalse(bool local, bool network, bool db)
        {
            // Arrange
            var result = new Model_SaveResult
            {
                LocalCSVSuccess = local,
                NetworkCSVSuccess = network,
                DatabaseSuccess = db
            };

            // Assert
            result.IsFullSuccess.Should().BeFalse();
        }

        [Theory]
        [InlineData(true, false, false)] // Only Local
        [InlineData(false, false, true)] // Only DB
        [InlineData(true, false, true)] // Local + DB
        public void IsPartialSuccess_WhenMixedSuccessMatchesCriteria_ReturnsTrue(bool local, bool network, bool db)
        {
            // Arrange
            var result = new Model_SaveResult
            {
                LocalCSVSuccess = local,
                NetworkCSVSuccess = network,
                DatabaseSuccess = db
            };

            // Assert
            result.IsPartialSuccess.Should().BeTrue();
        }

        [Fact]
        public void IsPartialSuccess_WhenFullSuccess_ReturnsFalse()
        {
            // Arrange
            var result = new Model_SaveResult
            {
                LocalCSVSuccess = true,
                NetworkCSVSuccess = true,
                DatabaseSuccess = true
            };

            // Assert
            result.IsPartialSuccess.Should().BeFalse();
        }

        [Fact]
        public void IsPartialSuccess_WhenNoSuccess_ReturnsFalse()
        {
            // Arrange
            var result = new Model_SaveResult
            {
                LocalCSVSuccess = false,
                NetworkCSVSuccess = false,
                DatabaseSuccess = false
            };

            // Assert
            result.IsPartialSuccess.Should().BeFalse();
        }

        [Fact]
        public void LegacyProperties_MapToNewProperties()
        {
            // Arrange
            var result = new Model_SaveResult();

            // Act
            result.RecordsSaved = 10;
            result.IsSuccess = true;

            // Assert
            result.LoadsSaved.Should().Be(10);
            result.Success.Should().BeTrue();
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_UserPreference_Tests.cs">using System;
using FluentAssertions;
using MTM_Receiving_Application.Module_Receiving.Models;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Unit tests for Model_UserPreference.
    /// Tests ObservableObject properties.
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_UserPreference_Tests
    {
        [Fact]
        public void Constructor_Defaults_AreCorrect()
        {
            // Act
            var prefs = new Model_UserPreference();

            // Assert
            prefs.Username.Should().BeEmpty();
            prefs.PreferredPackageType.Should().Be(&quot;Package&quot;);
            prefs.Workstation.Should().BeEmpty();
        }

        [Fact]
        public void Properties_NotifyChanges()
        {
            // Arrange
            var prefs = new Model_UserPreference();
            var propertyChanged = false;
            prefs.PropertyChanged += (s, e) =&gt;
            {
                if (e.PropertyName == nameof(Model_UserPreference.Username))
                    propertyChanged = true;
            };

            // Act
            prefs.Username = &quot;NewUser&quot;;

            // Assert
            propertyChanged.Should().BeTrue();
            prefs.Username.Should().Be(&quot;NewUser&quot;);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_WorkflowStepResult_Tests.cs">using FluentAssertions;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Receiving.Models;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Models
{
    /// &lt;summary&gt;
    /// Unit tests for Model_WorkflowStepResult.
    /// Tests property defaults and setting values.
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_WorkflowStepResult_Tests
    {
        [Fact]
        public void Constructor_Defaults_AreCorrect()
        {
            // Act
            var model = new Model_WorkflowStepResult();

            // Assert
            model.IsSuccess.Should().BeFalse();
            model.ErrorMessage.Should().BeEmpty();
            model.TargetStep.Should().BeNull();
        }

        [Fact]
        public void Properties_SetAndGet_WorksCorrectly()
        {
            // Arrange
            var model = new Model_WorkflowStepResult();
            var step = Enum_DunnageWorkflowStep.Review;

            // Act
            model.IsSuccess = true;
            model.ErrorMessage = &quot;Operation successful&quot;;
            model.TargetStep = step;

            // Assert
            model.IsSuccess.Should().BeTrue();
            model.ErrorMessage.Should().Be(&quot;Operation successful&quot;);
            model.TargetStep.Should().Be(step);
        }
    }
}</file><file path="Module_Core/Contracts/Services/IService_Authentication.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Systems;

namespace MTM_Receiving_Application.Module_Core.Contracts.Services
{
    /// &lt;summary&gt;
    /// Service contract for user authentication operations.
    /// Handles Windows username and PIN-based authentication flows.
    /// &lt;/summary&gt;
    public interface IService_Authentication
    {
        /// &lt;summary&gt;
        /// Authenticates a user by Windows username (automatic login for personal workstations).
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;windowsUsername&quot;&gt;Windows username from Environment.UserName&lt;/param&gt;
        /// &lt;param name=&quot;progress&quot;&gt;Optional progress reporter for splash screen updates&lt;/param&gt;
        /// &lt;returns&gt;Authentication result with user data or error message&lt;/returns&gt;
        public Task&lt;Model_AuthenticationResult&gt; AuthenticateByWindowsUsernameAsync(
            string windowsUsername,
            IProgress&lt;string&gt;? progress = null);

        /// &lt;summary&gt;
        /// Authenticates a user by username and PIN (shared terminal login).
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;username&quot;&gt;Username (Windows username or full name)&lt;/param&gt;
        /// &lt;param name=&quot;pin&quot;&gt;4-digit numeric PIN&lt;/param&gt;
        /// &lt;param name=&quot;progress&quot;&gt;Optional progress reporter for splash screen updates&lt;/param&gt;
        /// &lt;returns&gt;Authentication result with user data or error message&lt;/returns&gt;
        public Task&lt;Model_AuthenticationResult&gt; AuthenticateByPinAsync(
            string username,
            string pin,
            IProgress&lt;string&gt;? progress = null);

        /// &lt;summary&gt;
        /// Creates a new user account with validation.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;user&quot;&gt;User model with account data&lt;/param&gt;
        /// &lt;param name=&quot;createdBy&quot;&gt;Windows username of account creator&lt;/param&gt;
        /// &lt;param name=&quot;progress&quot;&gt;Optional progress reporter for UI feedback&lt;/param&gt;
        /// &lt;returns&gt;Result with new employee number or error message&lt;/returns&gt;
        public Task&lt;Model_CreateUserResult&gt; CreateNewUserAsync(
            Model_User user,
            string createdBy,
            IProgress&lt;string&gt;? progress = null);

        /// &lt;summary&gt;
        /// Validates PIN format.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;pin&quot;&gt;4-digit PIN to validate&lt;/param&gt;
        /// &lt;param name=&quot;excludeEmployeeNumber&quot;&gt;Unused (kept for backward compatibility)&lt;/param&gt;
        /// &lt;returns&gt;Validation result with error message if invalid&lt;/returns&gt;
        public Task&lt;Model_ValidationResult&gt; ValidatePinAsync(string pin, int? excludeEmployeeNumber = null);

        /// &lt;summary&gt;
        /// Detects workstation type (personal workstation or shared terminal).
        /// Queries auth_workstation_config table to determine authentication flow.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;computerName&quot;&gt;Computer name (defaults to Environment.MachineName)&lt;/param&gt;
        /// &lt;returns&gt;Workstation configuration with type and timeout settings&lt;/returns&gt;
        public Task&lt;Model_WorkstationConfig&gt; DetectWorkstationTypeAsync(string? computerName = null);

        /// &lt;summary&gt;
        /// Retrieves list of active departments for dropdown population.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;List of department names&lt;/returns&gt;
        public Task&lt;List&lt;string&gt;&gt; GetActiveDepartmentsAsync();

        /// &lt;summary&gt;
        /// Logs a user activity event for audit trail.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;eventType&quot;&gt;Event type (login_success, login_failed, session_timeout, user_created)&lt;/param&gt;
        /// &lt;param name=&quot;username&quot;&gt;Username involved in event&lt;/param&gt;
        /// &lt;param name=&quot;workstationName&quot;&gt;Computer name where event occurred&lt;/param&gt;
        /// &lt;param name=&quot;details&quot;&gt;Additional event details&lt;/param&gt;
        public Task LogUserActivityAsync(string eventType, string username, string workstationName, string details);
    }
}</file><file path="Module_Core/Converters/Converter_EnumToVisibility.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Data;
using System;

namespace MTM_Receiving_Application.Module_Core.Converters;

/// &lt;summary&gt;
/// Converts enum value to Visibility based on parameter match
/// &lt;/summary&gt;
public class Converter_EnumToVisibility : IValueConverter
{
    public object Convert(object? value, Type targetType, object? parameter, string language)
    {
        if (value == null || parameter == null)
        {
            return Visibility.Collapsed;
        }

        var enumValue = value.ToString();
        var targetValue = parameter.ToString();

        return string.Equals(enumValue, targetValue, StringComparison.OrdinalIgnoreCase)
            ? Visibility.Visible
            : Visibility.Collapsed;
    }

    public object ConvertBack(object? value, Type targetType, object? parameter, string language)
    {
        throw new NotImplementedException();
    }
}</file><file path="Module_Core/Converters/Converter_IntToVisibility.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Data;
using System;

namespace MTM_Receiving_Application.Module_Core.Converters
{
    /// &lt;summary&gt;
    /// Converts an integer value to Visibility
    /// - If ConverterParameter is an integer string (e.g., &quot;1&quot;, &quot;2&quot;), compares value == parameter
    /// - If ConverterParameter is &quot;Inverse&quot;, shows when value == 0
    /// - If no parameter, shows when value &gt; 0
    /// &lt;/summary&gt;
    public class Converter_IntToVisibility : IValueConverter
    {
        public object Convert(object? value, Type targetType, object? parameter, string language)
        {
            if (value == null)
                return Visibility.Collapsed;

            int intValue = value is int i ? i : 0;
            bool isVisible;

            // Handle different parameter types
            if (parameter is string paramStr)
            {
                // Check for &quot;Inverse&quot; parameter (legacy behavior: show when count is 0)
                if (paramStr.Equals(&quot;Inverse&quot;, StringComparison.OrdinalIgnoreCase))
                {
                    isVisible = intValue == 0;
                }
                // Check for numeric parameter (e.g., &quot;1&quot;, &quot;2&quot;, &quot;3&quot; for step matching)
                else if (int.TryParse(paramStr, out int paramInt))
                {
                    isVisible = intValue == paramInt;
                }
                else
                {
                    // Fallback for unknown string parameters
                    isVisible = intValue &gt; 0;
                }
            }
            else if (parameter is int paramIntDirect)
            {
                // Direct integer parameter comparison
                isVisible = intValue == paramIntDirect;
            }
            else
            {
                // No parameter: show if value &gt; 0 (legacy behavior)
                isVisible = intValue &gt; 0;
            }

            return isVisible ? Visibility.Visible : Visibility.Collapsed;
        }

        public object ConvertBack(object? value, Type targetType, object? parameter, string language)
        {
            throw new NotImplementedException();
        }
    }
}</file><file path="Module_Core/Converters/NullableDoubleToDoubleConverter.cs">using Microsoft.UI.Xaml.Data;
using System;

namespace MTM_Receiving_Application.Module_Core.Converters;

/// &lt;summary&gt;
/// Converts between double? and double for NumberBox bindings
/// &lt;/summary&gt;
public class NullableDoubleToDoubleConverter : IValueConverter
{
    public object Convert(object? value, Type targetType, object? parameter, string language)
    {
        if (value is double doubleValue)
        {
            return doubleValue;
        }
        return 0.0;
    }

    public object? ConvertBack(object? value, Type targetType, object? parameter, string language)
    {
        if (value is double doubleValue)
        {
            return (double?)doubleValue;
        }
        return null;
    }
}</file><file path="Module_Core/Helpers/Database/Helper_Database_StoredProcedure.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Diagnostics;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Core.Helpers.Database;

/// &lt;summary&gt;
/// Helper class for executing stored procedures with retry logic, 
/// performance monitoring, and standardized error handling
/// &lt;/summary&gt;
public static class Helper_Database_StoredProcedure
{
    private const int MaxRetries = 3;
    private static readonly int[] RetryDelaysMs = { 100, 200, 400 };

    /// &lt;summary&gt;
    /// Executes a stored procedure using MySqlParameter array (compatible with legacy/receiving DAOs)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;procedureName&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;parameters&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;connectionString&quot;&gt;&lt;/param&gt;
    public static async Task&lt;Model_Dao_Result&gt; ExecuteAsync(
        string procedureName,
        MySqlParameter[] parameters,
        string connectionString)
    {
        var result = new Model_Dao_Result();
        var stopwatch = Stopwatch.StartNew();
        int attempt = 0;

        while (attempt &lt; MaxRetries)
        {
            attempt++;

            try
            {
                await using var connection = new MySqlConnection(connectionString);
                await connection.OpenAsync();

                await using var command = new MySqlCommand(procedureName, connection)
                {
                    CommandType = CommandType.StoredProcedure
                };

                if (parameters != null)
                {
                    command.Parameters.AddRange(parameters);
                }

                var affectedRows = await command.ExecuteNonQueryAsync();

                // Handle output parameters if any
                foreach (var param in command.Parameters)
                {
                    if (param is MySqlParameter p &amp;&amp; (p.Direction == ParameterDirection.Output || p.Direction == ParameterDirection.InputOutput))
                    {
                        // You might want to capture output values here if needed
                        // For now, we just ensure the command executes
                    }
                }

                stopwatch.Stop();
                result.Success = true;
                result.AffectedRows = affectedRows;
                result.ExecutionTimeMs = stopwatch.ElapsedMilliseconds;
                return result;
            }
            catch (MySqlException ex) when (IsTransientError(ex) &amp;&amp; attempt &lt; MaxRetries)
            {
                await Task.Delay(RetryDelaysMs[attempt - 1]);
                continue;
            }
            catch (Exception ex)
            {
                stopwatch.Stop();
                return Model_Dao_Result_Factory.Failure($&quot;Stored procedure &apos;{procedureName}&apos; failed: {ex.Message}&quot;, ex);
            }
        }

        stopwatch.Stop();
        return Model_Dao_Result_Factory.Failure($&quot;Stored procedure &apos;{procedureName}&apos; failed after {MaxRetries} attempts&quot;);
    }

    /// &lt;summary&gt;
    /// Validates that all required parameters are present and not null
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;parameters&quot;&gt;&lt;/param&gt;
    public static bool ValidateParameters(MySqlParameter[]? parameters)
    {
        if (parameters == null)
        {
            return true;
        }

        foreach (var param in parameters)
        {
            if (param.Value == null &amp;&amp; param.Direction == ParameterDirection.Input)
            {
                // Allow DBNull.Value but not null
                return false;
            }
        }
        return true;
    }

    /// &lt;summary&gt;
    /// Executes a stored procedure that returns no data (INSERT, UPDATE, DELETE)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;connectionString&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;procedureName&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;parameters&quot;&gt;&lt;/param&gt;
    public static async Task&lt;Model_Dao_Result&gt; ExecuteNonQueryAsync(
        string connectionString,
        string procedureName,
        Dictionary&lt;string, object&gt;? parameters = null)
    {
        var result = new Model_Dao_Result();
        var stopwatch = Stopwatch.StartNew();
        int attempt = 0;

        while (attempt &lt; MaxRetries)
        {
            attempt++;

            try
            {
                System.Diagnostics.Debug.WriteLine($&quot;[DB] ExecuteNonQueryAsync: {procedureName} (Attempt {attempt}/{MaxRetries})&quot;);

                await using var connection = new MySqlConnection(connectionString);
                await connection.OpenAsync();

                await using var command = new MySqlCommand(procedureName, connection)
                {
                    CommandType = CommandType.StoredProcedure
                };

                AddParameters(command, parameters);

                System.Diagnostics.Debug.WriteLine($&quot;[DB] Executing: {procedureName}&quot;);
                foreach (MySqlParameter param in command.Parameters)
                {
                    var valueDisplay = param.Value == DBNull.Value ? &quot;NULL&quot; : param.Value?.ToString() ?? &quot;NULL&quot;;
                    System.Diagnostics.Debug.WriteLine($&quot;[DB]   {param.ParameterName} = {valueDisplay} ({param.Value?.GetType().Name ?? &quot;DBNull&quot;})&quot;);
                }

                var affectedRows = await command.ExecuteNonQueryAsync();

                stopwatch.Stop();
                System.Diagnostics.Debug.WriteLine($&quot;[DB] Success: {affectedRows} rows affected in {stopwatch.ElapsedMilliseconds}ms&quot;);
                result.Success = true;
                result.AffectedRows = affectedRows;
                result.ExecutionTimeMs = stopwatch.ElapsedMilliseconds;
                return result;
            }
            catch (MySqlException ex) when (IsTransientError(ex) &amp;&amp; attempt &lt; MaxRetries)
            {
                await Task.Delay(RetryDelaysMs[attempt - 1]);
                continue;
            }
            catch (Exception ex)
            {
                stopwatch.Stop();
                result.Success = false;
                result.ErrorMessage = $&quot;Stored procedure &apos;{procedureName}&apos; failed: {ex.Message}&quot;;
                result.Severity = Enum_ErrorSeverity.Error;
                result.ExecutionTimeMs = stopwatch.ElapsedMilliseconds;
                result.Exception = ex;
                return result;
            }
        }

        stopwatch.Stop();
        result.Success = false;
        result.ErrorMessage = $&quot;Stored procedure &apos;{procedureName}&apos; failed after {MaxRetries} attempts&quot;;
        result.Severity = Enum_ErrorSeverity.Critical;
        result.ExecutionTimeMs = stopwatch.ElapsedMilliseconds;
        return result;
    }

    /// &lt;summary&gt;
    /// Executes a stored procedure that returns a single record mapped to T
    /// &lt;/summary&gt;
    /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
    /// &lt;param name=&quot;connectionString&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;procedureName&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;mapper&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;parameters&quot;&gt;&lt;/param&gt;
    public static async Task&lt;Model_Dao_Result&lt;T&gt;&gt; ExecuteSingleAsync&lt;T&gt;(
        string connectionString,
        string procedureName,
        Func&lt;IDataReader, T&gt; mapper,
        Dictionary&lt;string, object&gt;? parameters = null)
    {
        var result = new Model_Dao_Result&lt;T&gt;();
        var stopwatch = Stopwatch.StartNew();
        int attempt = 0;

        while (attempt &lt; MaxRetries)
        {
            attempt++;

            try
            {
                System.Diagnostics.Debug.WriteLine($&quot;[DB] ExecuteSingleAsync: {procedureName} (Attempt {attempt}/{MaxRetries})&quot;);

                await using var connection = new MySqlConnection(connectionString);
                await connection.OpenAsync();

                await using var command = new MySqlCommand(procedureName, connection)
                {
                    CommandType = CommandType.StoredProcedure
                };

                AddParameters(command, parameters);

                System.Diagnostics.Debug.WriteLine($&quot;[DB] Executing: {procedureName}&quot;);
                foreach (MySqlParameter param in command.Parameters)
                {
                    var valueDisplay = param.Value == DBNull.Value ? &quot;NULL&quot; : param.Value?.ToString() ?? &quot;NULL&quot;;
                    System.Diagnostics.Debug.WriteLine($&quot;[DB]   {param.ParameterName} = {valueDisplay} ({param.Value?.GetType().Name ?? &quot;DBNull&quot;})&quot;);
                }

                await using var reader = await command.ExecuteReaderAsync();

                if (await reader.ReadAsync())
                {
                    result.Data = mapper(reader);
                    result.Success = true;
                    result.AffectedRows = 1;
                    System.Diagnostics.Debug.WriteLine($&quot;[DB] Success: 1 record found in {stopwatch.ElapsedMilliseconds}ms&quot;);
                }
                else
                {
                    result.Success = false;
                    result.ErrorMessage = &quot;No record found&quot;;
                    result.Severity = Enum_ErrorSeverity.Info;
                    System.Diagnostics.Debug.WriteLine($&quot;[DB] No record found&quot;);
                }

                stopwatch.Stop();
                result.ExecutionTimeMs = stopwatch.ElapsedMilliseconds;
                return result;
            }
            catch (MySqlException ex) when (IsTransientError(ex) &amp;&amp; attempt &lt; MaxRetries)
            {
                await Task.Delay(RetryDelaysMs[attempt - 1]);
                continue;
            }
            catch (Exception ex)
            {
                stopwatch.Stop();
                System.Diagnostics.Debug.WriteLine($&quot;[DB] ERROR in ExecuteSingleAsync: {procedureName}&quot;);
                System.Diagnostics.Debug.WriteLine($&quot;[DB] Error Type: {ex.GetType().Name}&quot;);
                System.Diagnostics.Debug.WriteLine($&quot;[DB] Error Message: {ex.Message}&quot;);
                if (ex is MySqlException sqlEx)
                {
                    var errorDesc = GetMySqlErrorDescription(sqlEx.Number);
                    System.Diagnostics.Debug.WriteLine($&quot;[DB] MySQL Error {sqlEx.Number}: {errorDesc}&quot;);
                    System.Diagnostics.Debug.WriteLine($&quot;[DB] SQL State: {sqlEx.SqlState}&quot;);
                }
                return Model_Dao_Result_Factory.Failure&lt;T&gt;($&quot;Stored procedure &apos;{procedureName}&apos; failed: {ex.Message}&quot;, ex);
            }
        }

        stopwatch.Stop();
        return Model_Dao_Result_Factory.Failure&lt;T&gt;($&quot;Stored procedure &apos;{procedureName}&apos; failed after {MaxRetries} attempts&quot;);
    }

    /// &lt;summary&gt;
    /// Executes a stored procedure that returns a list of records mapped to T
    /// &lt;/summary&gt;
    /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
    /// &lt;param name=&quot;connectionString&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;procedureName&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;mapper&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;parameters&quot;&gt;&lt;/param&gt;
    public static async Task&lt;Model_Dao_Result&lt;List&lt;T&gt;&gt;&gt; ExecuteListAsync&lt;T&gt;(
        string connectionString,
        string procedureName,
        Func&lt;IDataReader, T&gt; mapper,
        Dictionary&lt;string, object&gt;? parameters = null)
    {
        var result = new Model_Dao_Result&lt;List&lt;T&gt;&gt;();
        var stopwatch = Stopwatch.StartNew();
        int attempt = 0;

        while (attempt &lt; MaxRetries)
        {
            attempt++;

            try
            {
                System.Diagnostics.Debug.WriteLine($&quot;[DB] ExecuteListAsync: {procedureName} (Attempt {attempt}/{MaxRetries})&quot;);

                await using var connection = new MySqlConnection(connectionString);
                await connection.OpenAsync();

                await using var command = new MySqlCommand(procedureName, connection)
                {
                    CommandType = CommandType.StoredProcedure
                };

                AddParameters(command, parameters);

                System.Diagnostics.Debug.WriteLine($&quot;[DB] Executing: {procedureName}&quot;);
                foreach (MySqlParameter param in command.Parameters)
                {
                    var valueDisplay = param.Value == DBNull.Value ? &quot;NULL&quot; : param.Value?.ToString() ?? &quot;NULL&quot;;
                    System.Diagnostics.Debug.WriteLine($&quot;[DB]   {param.ParameterName} = {valueDisplay} ({param.Value?.GetType().Name ?? &quot;DBNull&quot;})&quot;);
                }

                await using var reader = await command.ExecuteReaderAsync();
                var list = new List&lt;T&gt;();

                while (await reader.ReadAsync())
                {
                    list.Add(mapper(reader));
                }

                result.Data = list;
                result.Success = true;
                result.AffectedRows = list.Count;

                stopwatch.Stop();
                System.Diagnostics.Debug.WriteLine($&quot;[DB] Success: {list.Count} records retrieved in {stopwatch.ElapsedMilliseconds}ms&quot;);
                result.ExecutionTimeMs = stopwatch.ElapsedMilliseconds;
                return result;
            }
            catch (MySqlException ex) when (IsTransientError(ex) &amp;&amp; attempt &lt; MaxRetries)
            {
                await Task.Delay(RetryDelaysMs[attempt - 1]);
                continue;
            }
            catch (Exception ex)
            {
                stopwatch.Stop();
                System.Diagnostics.Debug.WriteLine($&quot;[DB] ERROR in ExecuteListAsync: {procedureName}&quot;);
                System.Diagnostics.Debug.WriteLine($&quot;[DB] Error Type: {ex.GetType().Name}&quot;);
                System.Diagnostics.Debug.WriteLine($&quot;[DB] Error Message: {ex.Message}&quot;);
                if (ex is MySqlException sqlEx)
                {
                    System.Diagnostics.Debug.WriteLine($&quot;[DB] MySQL Error Code: {sqlEx.Number}&quot;);
                    System.Diagnostics.Debug.WriteLine($&quot;[DB] SQL State: {sqlEx.SqlState}&quot;);
                }
                return Model_Dao_Result_Factory.Failure&lt;List&lt;T&gt;&gt;($&quot;Stored procedure &apos;{procedureName}&apos; failed: {ex.Message}&quot;, ex);
            }
        }

        stopwatch.Stop();
        return Model_Dao_Result_Factory.Failure&lt;List&lt;T&gt;&gt;($&quot;Stored procedure &apos;{procedureName}&apos; failed after {MaxRetries} attempts&quot;);
    }

    /// &lt;summary&gt;
    /// Executes a stored procedure that returns a DataTable (SELECT)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;connectionString&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;procedureName&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;parameters&quot;&gt;&lt;/param&gt;
    public static async Task&lt;Model_Dao_Result&lt;DataTable&gt;&gt; ExecuteDataTableAsync(
        string connectionString,
        string procedureName,
        Dictionary&lt;string, object&gt;? parameters = null)
    {
        var result = new Model_Dao_Result&lt;DataTable&gt;();
        var stopwatch = Stopwatch.StartNew();
        int attempt = 0;

        while (attempt &lt; MaxRetries)
        {
            attempt++;

            try
            {
                await using var connection = new MySqlConnection(connectionString);
                await connection.OpenAsync();

                await using var command = new MySqlCommand(procedureName, connection)
                {
                    CommandType = CommandType.StoredProcedure
                };

                AddParameters(command, parameters);

                await using var reader = await command.ExecuteReaderAsync();
                var dataTable = new DataTable();
                dataTable.Load(reader);

                stopwatch.Stop();
                result.Success = true;
                result.Data = dataTable;
                result.AffectedRows = dataTable.Rows.Count;
                result.ExecutionTimeMs = stopwatch.ElapsedMilliseconds;
                return result;
            }
            catch (MySqlException ex) when (IsTransientError(ex) &amp;&amp; attempt &lt; MaxRetries)
            {
                await Task.Delay(RetryDelaysMs[attempt - 1]);
                continue;
            }
            catch (Exception ex)
            {
                stopwatch.Stop();
                result.Success = false;
                result.ErrorMessage = $&quot;Stored procedure &apos;{procedureName}&apos; failed: {ex.Message}&quot;;
                result.Severity = Enum_ErrorSeverity.Error;
                result.ExecutionTimeMs = stopwatch.ElapsedMilliseconds;
                result.Exception = ex;
                return result;
            }
        }

        stopwatch.Stop();
        result.Success = false;
        result.ErrorMessage = $&quot;Stored procedure &apos;{procedureName}&apos; failed after {MaxRetries} attempts&quot;;
        result.Severity = Enum_ErrorSeverity.Critical;
        result.ExecutionTimeMs = stopwatch.ElapsedMilliseconds;
        return result;
    }

    /// &lt;summary&gt;
    /// Executes a stored procedure within an existing transaction
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;connection&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;transaction&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;procedureName&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;parameters&quot;&gt;&lt;/param&gt;
    public static async Task&lt;Model_Dao_Result&gt; ExecuteInTransactionAsync(
        MySqlConnection connection,
        MySqlTransaction transaction,
        string procedureName,
        Dictionary&lt;string, object&gt;? parameters = null)
    {
        var result = new Model_Dao_Result();
        var stopwatch = Stopwatch.StartNew();

        try
        {
            await using var command = new MySqlCommand(procedureName, connection, transaction)
            {
                CommandType = CommandType.StoredProcedure
            };

            AddParameters(command, parameters);

            // Log the actual command being executed
            System.Diagnostics.Debug.WriteLine($&quot;[DB] Executing SP: {procedureName}&quot;);
            foreach (MySqlParameter param in command.Parameters)
            {
                var valueDisplay = param.Value == DBNull.Value ? &quot;NULL&quot; : param.Value?.ToString() ?? &quot;NULL&quot;;
                System.Diagnostics.Debug.WriteLine($&quot;[DB]   Parameter: {param.ParameterName} = {valueDisplay} (Type: {param.MySqlDbType})&quot;);
            }

            var affectedRows = await command.ExecuteNonQueryAsync();

            stopwatch.Stop();
            result.Success = true;
            result.AffectedRows = affectedRows;
            result.ExecutionTimeMs = stopwatch.ElapsedMilliseconds;
            System.Diagnostics.Debug.WriteLine($&quot;[DB] Success: {affectedRows} rows affected in {stopwatch.ElapsedMilliseconds}ms&quot;);
            return result;
        }
        catch (MySqlException sqlEx)
        {
            stopwatch.Stop();
            result.Success = false;
            result.ErrorMessage = $&quot;Stored procedure &apos;{procedureName}&apos; failed: MySQL Error {sqlEx.Number}: {sqlEx.Message}&quot;;
            result.Severity = Enum_ErrorSeverity.Error;
            result.ExecutionTimeMs = stopwatch.ElapsedMilliseconds;
            result.Exception = sqlEx;

            // Detailed SQL error logging
            var errorDesc = GetMySqlErrorDescription(sqlEx.Number);
            System.Diagnostics.Debug.WriteLine($&quot;[DB] MySQL ERROR {sqlEx.Number}: {errorDesc}&quot;);
            System.Diagnostics.Debug.WriteLine($&quot;[DB] Error Message: {sqlEx.Message}&quot;);
            System.Diagnostics.Debug.WriteLine($&quot;[DB] SQL State: {sqlEx.SqlState}&quot;);
            System.Diagnostics.Debug.WriteLine($&quot;[DB] Procedure: {procedureName}&quot;);

            return result;
        }
        catch (Exception ex)
        {
            stopwatch.Stop();
            result.Success = false;
            result.ErrorMessage = $&quot;Stored procedure &apos;{procedureName}&apos; failed in transaction: {ex.Message}&quot;;
            result.Severity = Enum_ErrorSeverity.Error;
            result.ExecutionTimeMs = stopwatch.ElapsedMilliseconds;
            result.Exception = ex;

            System.Diagnostics.Debug.WriteLine($&quot;[DB] ERROR: {ex.GetType().Name}: {ex.Message}&quot;);

            return result;
        }
    }

    private static void AddParameters(MySqlCommand command, Dictionary&lt;string, object&gt;? parameters)
    {
        if (parameters != null)
        {
            System.Diagnostics.Debug.WriteLine($&quot;[DB] Adding {parameters.Count} parameters:&quot;);
            foreach (var param in parameters)
            {
                // Automatically add &apos;p_&apos; prefix if missing, as per convention
                string paramName = param.Key.StartsWith(&quot;p_&quot;) ? &quot;@&quot; + param.Key : &quot;@p_&quot; + param.Key;
                // Or just use the key if the caller is expected to provide the correct name
                // The constitution says: &quot;Parameter names in C# match stored procedure parameters (WITHOUT p_ prefix - added automatically)&quot;
                // So we should add p_ prefix.

                // However, existing code might be using @p_ already.
                // Let&apos;s be safe: if it starts with @, use it. If not, check if it starts with p_.

                string cleanName = param.Key.TrimStart(&apos;@&apos;);
                string finalName = cleanName.StartsWith(&quot;p_&quot;) ? &quot;@&quot; + cleanName : &quot;@p_&quot; + cleanName;

                var valueDisplay = param.Value == null ? &quot;NULL&quot; :
                                   param.Value == DBNull.Value ? &quot;DBNull&quot; :
                                   param.Value.ToString();

                System.Diagnostics.Debug.WriteLine($&quot;[DB]   {param.Key}  {finalName} = {valueDisplay} ({param.Value?.GetType().Name ?? &quot;null&quot;})&quot;);

                command.Parameters.AddWithValue(finalName, param.Value ?? DBNull.Value);
            }
        }
        else
        {
            System.Diagnostics.Debug.WriteLine($&quot;[DB] No parameters provided&quot;);
        }
    }

    /// &lt;summary&gt;
    /// Gets a human-readable description for common MySQL error codes
    /// Reference: MySQL 5.7 Error Message Reference
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;errorCode&quot;&gt;&lt;/param&gt;
    private static string GetMySqlErrorDescription(int errorCode)
    {
        return errorCode switch
        {
            // Server Error Message Reference (Chapter 2)
            1000 =&gt; &quot;hashchk&quot;,
            1001 =&gt; &quot;isamchk&quot;,
            1002 =&gt; &quot;NO&quot;,
            1003 =&gt; &quot;YES&quot;,
            1004 =&gt; &quot;Can&apos;t create file (errno: %d - %s)&quot;,
            1005 =&gt; &quot;Can&apos;t create table (errno: %d)&quot;,
            1006 =&gt; &quot;Can&apos;t create database (errno: %d)&quot;,
            1007 =&gt; &quot;Can&apos;t create database; database exists&quot;,
            1008 =&gt; &quot;Can&apos;t drop database; database doesn&apos;t exist&quot;,
            1009 =&gt; &quot;Error dropping database (can&apos;t delete &apos;%s&apos;, errno: %d)&quot;,
            1010 =&gt; &quot;Error dropping database (can&apos;t rmdir &apos;%s&apos;, errno: %d)&quot;,
            1011 =&gt; &quot;Error on delete of &apos;%s&apos; (errno: %d - %s)&quot;,
            1012 =&gt; &quot;Can&apos;t read record in system table&quot;,
            1013 =&gt; &quot;Can&apos;t get status of &apos;%s&apos; (errno: %d - %s)&quot;,
            1014 =&gt; &quot;Can&apos;t get working directory (errno: %d - %s)&quot;,
            1015 =&gt; &quot;Can&apos;t lock file (errno: %d - %s)&quot;,
            1016 =&gt; &quot;Can&apos;t open file: &apos;%s&apos; (errno: %d - %s)&quot;,
            1017 =&gt; &quot;Can&apos;t find file: &apos;%s&apos; (errno: %d - %s)&quot;,
            1018 =&gt; &quot;Can&apos;t read dir of &apos;%s&apos; (errno: %d - %s)&quot;,
            1019 =&gt; &quot;Can&apos;t change dir to &apos;%s&apos; (errno: %d - %s)&quot;,
            1020 =&gt; &quot;Record has changed since last read in table &apos;%s&apos;&quot;,
            1021 =&gt; &quot;Disk full (%s); waiting for someone to free some space...&quot;,
            1022 =&gt; &quot;Can&apos;t write; duplicate key in table &apos;%s&apos;&quot;,
            1023 =&gt; &quot;Error on close of &apos;%s&apos; (errno: %d - %s)&quot;,
            1024 =&gt; &quot;Error reading file &apos;%s&apos; (errno: %d - %s)&quot;,
            1025 =&gt; &quot;Error on rename of &apos;%s&apos; to &apos;%s&apos; (errno: %d - %s)&quot;,
            1026 =&gt; &quot;Error writing file &apos;%s&apos; (errno: %d - %s)&quot;,
            1027 =&gt; &quot;&apos;%s&apos; is locked against change&quot;,
            1028 =&gt; &quot;Sort aborted&quot;,
            1029 =&gt; &quot;View &apos;%s&apos; doesn&apos;t exist for &apos;%s&apos;&quot;,
            1030 =&gt; &quot;Got error %d from storage engine&quot;,
            1031 =&gt; &quot;Table storage engine for &apos;%s&apos; doesn&apos;t have this option&quot;,
            1032 =&gt; &quot;Can&apos;t find record in &apos;%s&apos;&quot;,
            1033 =&gt; &quot;Incorrect information in file: &apos;%s&apos;&quot;,
            1034 =&gt; &quot;Incorrect key file for table &apos;%s&apos;; try to repair it&quot;,
            1035 =&gt; &quot;Old key file for table &apos;%s&apos;; repair it!&quot;,
            1036 =&gt; &quot;Table &apos;%s&apos; is read only&quot;,
            1037 =&gt; &quot;Out of memory; restart server and try again (needed %d bytes)&quot;,
            1038 =&gt; &quot;Out of sort memory, consider increasing server sort buffer size&quot;,
            1039 =&gt; &quot;Unexpected EOF found when reading file &apos;%s&apos; (errno: %d - %s)&quot;,
            1040 =&gt; &quot;Too many connections&quot;,
            1041 =&gt; &quot;Out of memory; check if mysqld or some other process uses all available memory&quot;,
            1042 =&gt; &quot;Can&apos;t get hostname for your address&quot;,
            1043 =&gt; &quot;Bad handshake&quot;,
            1044 =&gt; &quot;Access denied for user &apos;%s&apos;@&apos;%s&apos; to database &apos;%s&apos;&quot;,
            1045 =&gt; &quot;Access denied for user &apos;%s&apos;@&apos;%s&apos; (using password: %s)&quot;,
            1046 =&gt; &quot;No database selected&quot;,
            1047 =&gt; &quot;Unknown command&quot;,
            1048 =&gt; &quot;Column &apos;%s&apos; cannot be null&quot;,
            1049 =&gt; &quot;Unknown database &apos;%s&apos;&quot;,
            1050 =&gt; &quot;Table &apos;%s&apos; already exists&quot;,
            1051 =&gt; &quot;Unknown table &apos;%s&apos;&quot;,
            1052 =&gt; &quot;Column &apos;%s&apos; in %s is ambiguous&quot;,
            1053 =&gt; &quot;Server shutdown in progress&quot;,
            1054 =&gt; &quot;Unknown column &apos;%s&apos; in &apos;%s&apos;&quot;,
            1055 =&gt; &quot;&apos;%s&apos; isn&apos;t in GROUP BY&quot;,
            1056 =&gt; &quot;Can&apos;t group on &apos;%s&apos;&quot;,
            1057 =&gt; &quot;Statement has sum functions and columns in same statement&quot;,
            1058 =&gt; &quot;Column count doesn&apos;t match value count&quot;,
            1059 =&gt; &quot;Identifier name &apos;%s&apos; is too long&quot;,
            1060 =&gt; &quot;Duplicate column name &apos;%s&apos;&quot;,
            1061 =&gt; &quot;Duplicate key name &apos;%s&apos;&quot;,
            1062 =&gt; &quot;Duplicate entry &apos;%s&apos; for key %d&quot;,
            1063 =&gt; &quot;Incorrect column specifier for column &apos;%s&apos;&quot;,
            1064 =&gt; &quot;Parse error/Syntax error&quot;,
            1065 =&gt; &quot;Query was empty&quot;,
            1066 =&gt; &quot;Not unique table/alias: &apos;%s&apos;&quot;,
            1067 =&gt; &quot;Invalid default value for &apos;%s&apos;&quot;,
            1068 =&gt; &quot;Multiple primary key defined&quot;,
            1069 =&gt; &quot;Too many keys specified; max %d keys allowed&quot;,
            1070 =&gt; &quot;Too many key parts specified; max %d parts allowed&quot;,
            1071 =&gt; &quot;Specified key was too long; max key length is %d bytes&quot;,
            1072 =&gt; &quot;Key column &apos;%s&apos; doesn&apos;t exist in table&quot;,
            1073 =&gt; &quot;BLOB column &apos;%s&apos; can&apos;t be used in key specification with the used table type&quot;,
            1074 =&gt; &quot;Column length too big for column &apos;%s&apos; (max = %lu); use BLOB or TEXT instead&quot;,
            1075 =&gt; &quot;Incorrect table definition; there can be only one auto column and it must be defined as a key&quot;,
            1076 =&gt; &quot;Ready for connections&quot;,
            1077 =&gt; &quot;Normal shutdown&quot;,
            1078 =&gt; &quot;Got signal %d. Aborting!&quot;,
            1079 =&gt; &quot;Shutdown complete&quot;,
            1080 =&gt; &quot;Forcing close of thread %ld user: &apos;%s&apos;&quot;,
            1081 =&gt; &quot;Can&apos;t create IP socket&quot;,
            1082 =&gt; &quot;Table &apos;%s&apos; has no index like the one used in CREATE INDEX; recreate the table&quot;,
            1083 =&gt; &quot;Field separator argument is not what is expected&quot;,
            1084 =&gt; &quot;You can&apos;t use fixed rowlength with BLOBs; please use &apos;fields terminated by&apos;&quot;,
            1085 =&gt; &quot;The file &apos;%s&apos; must be in the database directory or be readable by all&quot;,
            1086 =&gt; &quot;File &apos;%s&apos; already exists&quot;,
            1087 =&gt; &quot;Load Info: Records: %ld Deleted: %ld Skipped: %ld Warnings: %ld&quot;,
            1088 =&gt; &quot;Alter Info: Records: %ld Duplicates: %ld&quot;,
            1089 =&gt; &quot;Incorrect prefix key&quot;,
            1090 =&gt; &quot;You can&apos;t delete all columns with ALTER TABLE; use DROP TABLE instead&quot;,
            1091 =&gt; &quot;Can&apos;t DROP &apos;%s&apos;; check that column/key exists&quot;,
            1092 =&gt; &quot;Insert Info: Records: %ld Duplicates: %ld Warnings: %ld&quot;,
            1093 =&gt; &quot;You can&apos;t specify target table &apos;%s&apos; for update in FROM clause&quot;,
            1094 =&gt; &quot;Unknown thread id: %lu&quot;,
            1095 =&gt; &quot;You are not owner of thread %lu&quot;,
            1096 =&gt; &quot;No tables used&quot;,
            1097 =&gt; &quot;Too many strings for column %s and SET&quot;,
            1098 =&gt; &quot;Can&apos;t generate a unique log-filename %s.(1-999)&quot;,
            1099 =&gt; &quot;Table &apos;%s&apos; was locked with a READ lock and can&apos;t be updated&quot;,
            1100 =&gt; &quot;Table &apos;%s&apos; was not locked with LOCK TABLES&quot;,
            1101 =&gt; &quot;BLOB, TEXT, GEOMETRY or JSON column &apos;%s&apos; can&apos;t have a default value&quot;,
            1102 =&gt; &quot;Incorrect database name &apos;%s&apos;&quot;,
            1103 =&gt; &quot;Incorrect table name &apos;%s&apos;&quot;,
            1104 =&gt; &quot;The SELECT would examine more than MAX_JOIN_SIZE rows&quot;,
            1105 =&gt; &quot;Unknown error&quot;,
            1106 =&gt; &quot;Unknown procedure &apos;%s&apos;&quot;,
            1107 =&gt; &quot;Incorrect parameter count to procedure &apos;%s&apos;&quot;,
            1108 =&gt; &quot;Incorrect parameters to procedure &apos;%s&apos;&quot;,
            1109 =&gt; &quot;Unknown table &apos;%s&apos; in %s&quot;,
            1110 =&gt; &quot;Column &apos;%s&apos; specified twice&quot;,
            1111 =&gt; &quot;Invalid use of group function&quot;,
            1112 =&gt; &quot;Table &apos;%s&apos; uses an extension that doesn&apos;t exist in this MySQL version&quot;,
            1113 =&gt; &quot;A table must have at least 1 column&quot;,
            1114 =&gt; &quot;The table &apos;%s&apos; is full&quot;,
            1115 =&gt; &quot;Unknown character set: &apos;%s&apos;&quot;,
            1116 =&gt; &quot;Too many tables; MySQL can only use %d tables in a join&quot;,
            1117 =&gt; &quot;Too many columns&quot;,
            1118 =&gt; &quot;Row size too large&quot;,
            1119 =&gt; &quot;Thread stack overrun&quot;,
            1120 =&gt; &quot;Cross dependency found in OUTER JOIN; examine your ON conditions&quot;,
            1121 =&gt; &quot;Table handler doesn&apos;t support NULL in given index&quot;,
            1122 =&gt; &quot;Can&apos;t load function &apos;%s&apos;&quot;,
            1123 =&gt; &quot;Can&apos;t initialize function &apos;%s&apos;; %s&quot;,
            1124 =&gt; &quot;No paths allowed for shared library&quot;,
            1125 =&gt; &quot;Function &apos;%s&apos; already exists&quot;,
            1126 =&gt; &quot;Can&apos;t open shared library &apos;%s&apos; (errno: %d %s)&quot;,
            1127 =&gt; &quot;Can&apos;t find symbol &apos;%s&apos; in library&quot;,
            1128 =&gt; &quot;Function &apos;%s&apos; is not defined&quot;,
            1129 =&gt; &quot;Host &apos;%s&apos; is blocked because of many connection errors&quot;,
            1130 =&gt; &quot;Host &apos;%s&apos; is not allowed to connect to this MySQL server&quot;,
            1131 =&gt; &quot;Anonymous users are not allowed to change passwords&quot;,
            1132 =&gt; &quot;You must have privileges to update tables in the mysql database to change passwords&quot;,
            1133 =&gt; &quot;Can&apos;t find any matching row in the user table&quot;,
            1134 =&gt; &quot;Update Info: Rows matched: %ld Changed: %ld Warnings: %ld&quot;,
            1135 =&gt; &quot;Can&apos;t create a new thread (errno %d)&quot;,
            1136 =&gt; &quot;Column count doesn&apos;t match value count at row %ld&quot;,
            1137 =&gt; &quot;Can&apos;t reopen table: &apos;%s&apos;&quot;,
            1138 =&gt; &quot;Invalid use of NULL value&quot;,
            1139 =&gt; &quot;Got error &apos;%s&apos; from regexp&quot;,
            1140 =&gt; &quot;Mixing of GROUP columns with no GROUP columns is illegal if there is no GROUP BY clause&quot;,
            1141 =&gt; &quot;There is no such grant defined for user &apos;%s&apos; on host &apos;%s&apos;&quot;,
            1142 =&gt; &quot;%s command denied to user &apos;%s&apos;@&apos;%s&apos; for table &apos;%s&apos;&quot;,
            1143 =&gt; &quot;%s command denied to user &apos;%s&apos;@&apos;%s&apos; for column &apos;%s&apos; in table &apos;%s&apos;&quot;,
            1144 =&gt; &quot;Illegal GRANT/REVOKE command&quot;,
            1145 =&gt; &quot;The host or user argument to GRANT is too long&quot;,
            1146 =&gt; &quot;Table &apos;%s.%s&apos; doesn&apos;t exist&quot;,
            1147 =&gt; &quot;There is no such grant defined for user &apos;%s&apos; on host &apos;%s&apos; on table &apos;%s&apos;&quot;,
            1148 =&gt; &quot;The used command is not allowed with this MySQL version&quot;,
            1149 =&gt; &quot;Syntax error&quot;,
            1150 =&gt; &quot;Delayed insert thread couldn&apos;t get requested lock for table %s&quot;,
            1151 =&gt; &quot;Too many delayed threads in use&quot;,
            1152 =&gt; &quot;Aborted connection %ld to db: &apos;%s&apos; user: &apos;%s&apos; (%s)&quot;,
            1153 =&gt; &quot;Got a packet bigger than &apos;max_allowed_packet&apos; bytes&quot;,
            1154 =&gt; &quot;Got a read error from the connection pipe&quot;,
            1155 =&gt; &quot;Got an error from fcntl()&quot;,
            1156 =&gt; &quot;Got packets out of order&quot;,
            1157 =&gt; &quot;Couldn&apos;t uncompress communication packet&quot;,
            1158 =&gt; &quot;Got an error reading communication packets&quot;,
            1159 =&gt; &quot;Got timeout reading communication packets&quot;,
            1160 =&gt; &quot;Got an error writing communication packets&quot;,
            1161 =&gt; &quot;Got timeout writing communication packets&quot;,
            1162 =&gt; &quot;Result string is longer than &apos;max_allowed_packet&apos; bytes&quot;,
            1163 =&gt; &quot;The used table type doesn&apos;t support BLOB/TEXT columns&quot;,
            1164 =&gt; &quot;The used table type doesn&apos;t support AUTO_INCREMENT columns&quot;,
            1165 =&gt; &quot;INSERT DELAYED can&apos;t be used with table &apos;%s&apos; because it is locked with LOCK TABLES&quot;,
            1166 =&gt; &quot;Incorrect column name &apos;%s&apos;&quot;,
            1167 =&gt; &quot;The used storage engine can&apos;t index column &apos;%s&apos;&quot;,
            1168 =&gt; &quot;Unable to open underlying table&quot;,
            1169 =&gt; &quot;Can&apos;t write, because of unique constraint, to table &apos;%s&apos;&quot;,
            1170 =&gt; &quot;BLOB/TEXT column &apos;%s&apos; used in key specification without a key length&quot;,
            1171 =&gt; &quot;All parts of a PRIMARY KEY must be NOT NULL&quot;,
            1172 =&gt; &quot;Result consisted of more than one row&quot;,
            1173 =&gt; &quot;This table type requires a primary key&quot;,
            1174 =&gt; &quot;This version of MySQL is not compiled with RAID support&quot;,
            1175 =&gt; &quot;You are using safe update mode and you tried to update a table without a WHERE that uses a KEY column&quot;,
            1176 =&gt; &quot;Key &apos;%s&apos; doesn&apos;t exist in table &apos;%s&apos;&quot;,
            1177 =&gt; &quot;Can&apos;t open table&quot;,
            1178 =&gt; &quot;The storage engine for the table doesn&apos;t support %s&quot;,
            1179 =&gt; &quot;You are not allowed to execute this command in a transaction&quot;,
            1180 =&gt; &quot;Got error %d during COMMIT&quot;,
            1181 =&gt; &quot;Got error %d during ROLLBACK&quot;,
            1182 =&gt; &quot;Got error %d during FLUSH_LOGS&quot;,
            1183 =&gt; &quot;Got error %d during CHECKPOINT&quot;,
            1184 =&gt; &quot;Aborted connection %u to db: &apos;%s&apos; user: &apos;%s&apos; host: &apos;%s&apos; (%s)&quot;,
            1185 =&gt; &quot;The storage engine for the table does not support binary table dump&quot;,
            1186 =&gt; &quot;Binlog closed, cannot RESET MASTER&quot;,

            // Connection/Client specific errors often encountered
            1203 =&gt; &quot;Max user connections exceeded&quot;,
            1205 =&gt; &quot;Lock wait timeout exceeded&quot;,
            1213 =&gt; &quot;Deadlock found when trying to get lock&quot;,
            1226 =&gt; &quot;User command resources exceeded&quot;,
            1267 =&gt; &quot;Illegal mix of collations&quot;,
            1318 =&gt; &quot;Incorrect number of arguments for procedure&quot;,
            1366 =&gt; &quot;Incorrect integer value&quot;,
            1452 =&gt; &quot;Cannot add or update a child row (FK constraint fails)&quot;,
            2002 =&gt; &quot;Can&apos;t connect to local MySQL server through socket&quot;,
            2003 =&gt; &quot;Can&apos;t connect to MySQL server&quot;,
            2006 =&gt; &quot;MySQL server has gone away&quot;,
            2013 =&gt; &quot;Lost connection to MySQL server during query&quot;,
            2055 =&gt; &quot;Lost connection to MySQL server at &apos;reading initial communication packet&apos;&quot;,
            _ =&gt; &quot;Unknown MySQL error (Check server logs)&quot;
        };
    }

    /// &lt;summary&gt;
    /// Determines if a MySQL exception is transient (temporary) and should be retried
    /// Reference: MySQL 5.7 Error Message Reference
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;ex&quot;&gt;&lt;/param&gt;
    private static bool IsTransientError(MySqlException ex)
    {
        // Transient error codes that can be retried:
        // 1040 = Too many connections
        // 1053 = Server shutdown in progress
        // 1080 = Forcing close of thread (server side)
        // 1152 = Aborted connection
        // 1153 = Packet bigger than max_allowed_packet (sometimes transient if config changes dynamically or network glitch)
        // 1154 = Read error from connection pipe
        // 1155 = Error from fcntl()
        // 1156 = Packets out of order
        // 1157 = Couldn&apos;t uncompress packet
        // 1158 = Error reading communication packets
        // 1159 = Timeout reading communication packets
        // 1160 = Error writing communication packets
        // 1161 = Timeout writing communication packets
        // 1184 = Aborted connection (new)
        // 1203 = User max connections exceeded
        // 1205 = Lock wait timeout exceeded
        // 1213 = Deadlock found
        // 1226 = Resource limit exceeded
        // 2002 = Can&apos;t connect to local MySQL server through socket
        // 2003 = Can&apos;t connect to MySQL server
        // 2006 = MySQL server has gone away
        // 2013 = Lost connection to MySQL server during query
        // 2055 = Lost connection to MySQL server at &apos;reading initial communication packet&apos;

        return ex.Number switch
        {
            1040 or 1053 or 1080 or
            1152 or 1153 or 1154 or 1155 or 1156 or 1157 or 1158 or 1159 or 1160 or 1161 or 1184 or
            1203 or 1205 or 1213 or 1226 or
            2002 or 2003 or 2006 or 2013 or 2055 =&gt; true,
            _ =&gt; false
        };
    }
}</file><file path="Module_Core/Models/Systems/Model_User.cs">using System;

namespace MTM_Receiving_Application.Module_Core.Models.Systems
{
    /// &lt;summary&gt;
    /// Represents a user/employee entity in the authentication system.
    /// Maps to the &apos;users&apos; database table.
    /// &lt;/summary&gt;
    public class Model_User
    {
        private static Func&lt;DateTime&gt; NowProvider { get; } = static () =&gt; DateTime.Now;

        // ====================================================================
        // Database Fields
        // ====================================================================

        /// &lt;summary&gt;
        /// Unique employee identifier (Primary Key, Auto-increment)
        /// &lt;/summary&gt;
        public int EmployeeNumber { get; set; }

        /// &lt;summary&gt;
        /// Windows login username (DOMAIN\username format)
        /// Unique constraint in database
        /// &lt;/summary&gt;
        public string WindowsUsername { get; set; } = string.Empty;

        /// &lt;summary&gt;
        /// Employee full name for display
        /// &lt;/summary&gt;
        public string FullName { get; set; } = string.Empty;

        /// &lt;summary&gt;
        /// 4-digit numeric PIN for shared terminal login (plain text storage)
        /// Not unique across users (shared PINs allowed)
        /// &lt;/summary&gt;
        public string Pin { get; set; } = string.Empty;

        /// &lt;summary&gt;
        /// Department assignment (required)
        /// &lt;/summary&gt;
        public string Department { get; set; } = string.Empty;

        /// &lt;summary&gt;
        /// Shift assignment: &quot;1st Shift&quot;, &quot;2nd Shift&quot;, or &quot;3rd Shift&quot;
        /// &lt;/summary&gt;
        public string Shift { get; set; } = string.Empty;

        /// &lt;summary&gt;
        /// Account active status
        /// &lt;/summary&gt;
        public bool IsActive { get; set; } = true;

        /// &lt;summary&gt;
        /// Optional Visual/Infor ERP username (plain text storage)
        /// &lt;/summary&gt;
        public string? VisualUsername { get; set; }

        /// &lt;summary&gt;
        /// Optional Visual/Infor ERP password (plain text storage, masked in UI)
        /// &lt;/summary&gt;
        public string? VisualPassword { get; set; }

        /// &lt;summary&gt;
        /// Default receiving workflow mode: &quot;guided&quot;, &quot;manual&quot;, or null (show selection)
        /// &lt;/summary&gt;
        public string? DefaultReceivingMode { get; set; }

        /// &lt;summary&gt;
        /// Default dunnage workflow mode: &quot;guided&quot;, &quot;manual&quot;, &quot;edit&quot;, or null (show selection)
        /// &lt;/summary&gt;
        public string? DefaultDunnageMode { get; set; }

        /// &lt;summary&gt;
        /// Account creation timestamp
        /// &lt;/summary&gt;
        public DateTime CreatedDate { get; set; }

        /// &lt;summary&gt;
        /// Windows username of account creator
        /// &lt;/summary&gt;
        public string? CreatedBy { get; set; }

        /// &lt;summary&gt;
        /// Last modification timestamp
        /// &lt;/summary&gt;
        public DateTime ModifiedDate { get; set; }

        // ====================================================================
        // Computed Properties
        // ====================================================================

        /// &lt;summary&gt;
        /// Display name formatted as &quot;Full Name (Emp #NNNN)&quot;
        /// Used in UI header display
        /// &lt;/summary&gt;
        public string DisplayName =&gt; $&quot;{FullName} (Emp #{EmployeeNumber})&quot;;

        /// &lt;summary&gt;
        /// Indicates if user has configured ERP access credentials
        /// &lt;/summary&gt;
        public bool HasErpAccess =&gt; !string.IsNullOrWhiteSpace(VisualUsername);

        // ====================================================================
        // Constructor
        // ====================================================================

        /// &lt;summary&gt;
        /// Default constructor
        /// &lt;/summary&gt;
        public Model_User()
        {
            var now = NowProvider();
            CreatedDate = now;
            ModifiedDate = now;
        }
    }
}</file><file path="Module_Core/Services/Startup/Service_OnStartup_AppLifecycle.cs">using System;
using System.Threading.Tasks;
using Microsoft.UI.Xaml;
using Microsoft.Extensions.DependencyInjection;
using CommunityToolkit.WinUI;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Systems;
using MTM_Receiving_Application.Module_Shared.Views;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Core.Services.Startup
{
    public class Service_OnStartup_AppLifecycle : IService_OnStartup_AppLifecycle
    {
        private readonly IServiceProvider _serviceProvider;
        private readonly IService_Authentication _authService;
        private readonly IService_UserSessionManager _sessionManager;
        private readonly IService_ErrorHandler _errorHandler;
        private readonly IService_CSVWriter _csvWriter;
        private View_Shared_SplashScreenWindow? _splashScreen;

        public Service_OnStartup_AppLifecycle(
            IServiceProvider serviceProvider,
            IService_Authentication authService,
            IService_UserSessionManager sessionManager,
            IService_ErrorHandler errorHandler,
            IService_CSVWriter csvWriter)
        {
            _serviceProvider = serviceProvider;
            _authService = authService;
            _sessionManager = sessionManager;
            _errorHandler = errorHandler;
            _csvWriter = csvWriter;
        }

        public async Task StartAsync()
        {
            try
            {
                // 1. Show splash screen immediately (0-15%)
                _splashScreen = _serviceProvider.GetRequiredService&lt;View_Shared_SplashScreenWindow&gt;();
                _splashScreen.Activate();
                UpdateSplash(5, &quot;Starting application...&quot;);
                await Task.Delay(100);

                // 2. Create Main Window (hidden initially)
                UpdateSplash(15, &quot;Loading main window...&quot;);
                var mainWindow = _serviceProvider.GetRequiredService&lt;MainWindow&gt;();
                App.MainWindow = mainWindow;

                // Give UI thread time to initialize
                await Task.Delay(100);

                // 3. Initialize Services (20%)
                UpdateSplash(20, &quot;Initializing services...&quot;);
                await Task.Delay(300);

                // 3. Check if Windows user exists (30%)
                UpdateSplash(30, &quot;Checking user account...&quot;);
                var windowsUser = Environment.UserName;
                var userCheckResult = await _authService.AuthenticateByWindowsUsernameAsync(windowsUser);

                Model_User? authenticatedUser = null;
                string authMethod = &quot;&quot;;

                // If user doesn&apos;t exist, create account first (before workstation detection)
                if (!userCheckResult.Success)
                {
                    SetSplashIndeterminate(&quot;User account not found. Waiting for account creation...&quot;);

                    // Show New User Setup Dialog as child of splash screen
                    var newUserViewModel = _serviceProvider.GetRequiredService&lt;ViewModel_Shared_NewUserSetup&gt;();
                    newUserViewModel.WindowsUsername = windowsUser;
                    newUserViewModel.CreatedBy = windowsUser; // Self-creation (physical presence is authorization)

                    var newUserDialog = new View_Shared_NewUserSetupDialog(newUserViewModel);

                    // Set splash screen as parent
                    if (_splashScreen?.Content is Microsoft.UI.Xaml.UIElement rootElement)
                    {
                        newUserDialog.XamlRoot = rootElement.XamlRoot;
                    }

                    // Show dialog and wait for result
                    var dialogResult = await newUserDialog.ShowAsync();

                    // Check result
                    if (newUserViewModel.NewEmployeeNumber &gt; 0 &amp;&amp; !newUserViewModel.IsCancelled)
                    {
                        // Account created successfully - re-authenticate to get full user data
                        UpdateSplash(40, &quot;Employee account created...&quot;);
                        userCheckResult = await _authService.AuthenticateByWindowsUsernameAsync(windowsUser);

                        if (userCheckResult.Success)
                        {
                            authenticatedUser = userCheckResult.User;
                            UpdateSplash(45, $&quot;Account created for {authenticatedUser?.FullName}&quot;);
                        }
                        else
                        {
                            // Resilience: if the DB lookup doesn&apos;t immediately return the user (e.g. mismatch or timing),
                            // continue startup with the known data instead of shutting down.
                            authenticatedUser = new Model_User
                            {
                                EmployeeNumber = newUserViewModel.NewEmployeeNumber,
                                WindowsUsername = windowsUser,
                                FullName = newUserViewModel.FullName,
                                Department = newUserViewModel.Department,
                                Shift = newUserViewModel.Shift,
                                Pin = newUserViewModel.Pin,
                                IsActive = true,
                                VisualUsername = newUserViewModel.ConfigureErpAccess ? newUserViewModel.VisualUsername : null,
                                VisualPassword = newUserViewModel.ConfigureErpAccess ? newUserViewModel.VisualPassword : null
                            };

                            ApplySafeUserDefaults(authenticatedUser);

                            await _errorHandler.HandleErrorAsync(
                                $&quot;User account was created but could not be reloaded by username &apos;{windowsUser}&apos;. Continuing with in-memory user for this session.&quot;,
                                Models.Enums.Enum_ErrorSeverity.Warning,
                                showDialog: false);

                            UpdateSplash(45, $&quot;Account created for {authenticatedUser.FullName}&quot;);
                        }
                    }
                    else if (newUserViewModel.IsCancelled)
                    {
                        // User cancelled account creation - close app properly
                        await _errorHandler.HandleErrorAsync(
                            &quot;User account creation cancelled. Application closing.&quot;,
                            Models.Enums.Enum_ErrorSeverity.Info,
                            showDialog: false);

                        // Close splash screen
                        if (_splashScreen != null)
                        {
                            _splashScreen.IsProgrammaticClose = true;
                            _splashScreen.Close();
                        }

                        // Close main window if it exists
                        App.MainWindow?.Close();

                        // Exit application properly
                        Application.Current.Exit();
                        return;
                    }
                }
                else
                {
                    // User exists - use existing user account
                    authenticatedUser = userCheckResult.User;
                }

                // Ensure first-run never proceeds with missing defaults.
                // Database schema may be mid-migration; apply safe app-level defaults.
                ApplySafeUserDefaults(authenticatedUser);

                // 4. Detect Workstation (50%)
                UpdateSplash(50, &quot;Detecting workstation configuration...&quot;);
                var workstationConfig = await _authService.DetectWorkstationTypeAsync();

                // Debug logging
                System.Diagnostics.Debug.WriteLine($&quot;Workstation: {workstationConfig.ComputerName}&quot;);
                System.Diagnostics.Debug.WriteLine($&quot;Type: {workstationConfig.WorkstationType}&quot;);
                System.Diagnostics.Debug.WriteLine($&quot;Is Shared: {workstationConfig.IsSharedTerminal}&quot;);
                System.Diagnostics.Debug.WriteLine($&quot;Is Personal: {workstationConfig.IsPersonalWorkstation}&quot;);

                // 5. Determine authentication method based on workstation type (55-80%)
                if (workstationConfig.IsPersonalWorkstation)
                {
                    // Personal workstation - use Windows auto-login
                    UpdateSplash(55, &quot;Personal workstation - Windows authentication&quot;);
                    authMethod = &quot;windows_auto&quot;;
                    UpdateSplash(80, $&quot;Welcome, {authenticatedUser?.FullName}&quot;);
                }
                else if (workstationConfig.IsSharedTerminal)
                {
                    // Shared terminal - require PIN authentication
                    // Clear any pre-authenticated user (from Windows auth) to ensure PIN is required
                    authenticatedUser = null;

                    SetSplashIndeterminate(&quot;Shared terminal detected. Waiting for PIN login...&quot;);

                    // Show PIN login dialog as child of splash screen
                    var loginViewModel = _serviceProvider.GetRequiredService&lt;ViewModel_Shared_SharedTerminalLogin&gt;();
                    var loginDialog = new View_Shared_SharedTerminalLoginDialog(loginViewModel);

                    // Set splash screen as parent
                    if (_splashScreen?.Content is Microsoft.UI.Xaml.UIElement rootElement)
                    {
                        loginDialog.XamlRoot = rootElement.XamlRoot;
                    }

                    // Show dialog and wait for result
                    var dialogResult = await loginDialog.ShowAsync();

                    // Check result
                    if (loginViewModel.AuthenticatedUser != null &amp;&amp; !loginViewModel.IsCancelled &amp;&amp; !loginViewModel.IsLockedOut)
                    {
                        // Authentication successful - override with PIN-authenticated user
                        authenticatedUser = loginViewModel.AuthenticatedUser;
                        authMethod = &quot;pin_login&quot;;
                        UpdateSplash(80, $&quot;Welcome, {authenticatedUser.FullName}&quot;);
                    }
                    else if (loginViewModel.IsLockedOut)
                    {
                        // Maximum attempts exceeded - log and close app
                        await _errorHandler.HandleErrorAsync(
                            &quot;Maximum login attempts exceeded. Application closing for security.&quot;,
                            Models.Enums.Enum_ErrorSeverity.Warning,
                            showDialog: false);

                        // Close application
                        Microsoft.Windows.AppLifecycle.AppInstance.GetCurrent().UnregisterKey();
                        System.Environment.Exit(0);
                        return;
                    }
                    else if (loginViewModel.IsCancelled)
                    {
                        // User cancelled login - close app
                        await _errorHandler.HandleErrorAsync(
                            &quot;User cancelled login. Application closing.&quot;,
                            Models.Enums.Enum_ErrorSeverity.Info,
                            showDialog: false);

                        System.Environment.Exit(0);
                        return;
                    }
                    else
                    {
                        // Fallback for unexpected dialog closure (e.g. Esc key if not handled)
                        await _errorHandler.HandleErrorAsync(
                            &quot;Login dialog closed unexpectedly. Application closing.&quot;,
                            Models.Enums.Enum_ErrorSeverity.Info,
                            showDialog: false);

                        System.Environment.Exit(0);
                        return;
                    }
                }

                // 6. Create Session (90%)
                if (authenticatedUser != null)
                {
                    UpdateSplash(90, &quot;Creating user session...&quot;);
                    _sessionManager.CreateSession(authenticatedUser, workstationConfig, authMethod);
                    _sessionManager.StartTimeoutMonitoring();

                    // Update MainWindow user display
                    if (App.MainWindow is MainWindow mainWin)
                    {
                        mainWin.DispatcherQueue.TryEnqueue(() =&gt; mainWin.UpdateUserDisplay());
                    }
                }
                else
                {
                    // No authenticated user - should not reach here unless cancelled
                    await _errorHandler.HandleErrorAsync(
                        &quot;Authentication failed. Application closing.&quot;,
                        Models.Enums.Enum_ErrorSeverity.Warning,
                        showDialog: false);
                    System.Environment.Exit(0);
                    return;
                }

                // 7. Finalize (100%) - Show main window, hide splash
                UpdateSplash(100, &quot;Ready!&quot;);
                await Task.Delay(500);

                // Show main window and hide splash screen
                App.MainWindow?.Activate();
                if (_splashScreen != null)
                {
                    _splashScreen.IsProgrammaticClose = true;
                    _splashScreen.Close();
                }
                _splashScreen = null;

                // CSV reset dialog removed - only appears when user explicitly clicks Reset CSV button
            }
            catch (Exception ex)
            {
                await _errorHandler.HandleErrorAsync(&quot;Startup failed&quot;, Models.Enums.Enum_ErrorSeverity.Critical, ex);
                if (_splashScreen != null)
                {
                    _splashScreen.IsProgrammaticClose = true;
                    _splashScreen.Close();
                }
                System.Environment.Exit(1);
            }
        }

        private void UpdateSplash(double percentage, string message)
        {
            _splashScreen?.ViewModel.UpdateProgress(percentage, message);
        }

        private void SetSplashIndeterminate(string message)
        {
            _splashScreen?.ViewModel.SetIndeterminate(message);
        }

        private static void ApplySafeUserDefaults(Model_User? user)
        {
            if (user == null)
            {
                return;
            }

            if (string.IsNullOrWhiteSpace(user.DefaultReceivingMode))
            {
                user.DefaultReceivingMode = &quot;guided&quot;;
            }

            if (string.IsNullOrWhiteSpace(user.DefaultDunnageMode))
            {
                user.DefaultDunnageMode = &quot;guided&quot;;
            }
        }
    }
}</file><file path="Module_Dunnage/Data/Dao_DunnageCustomField.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;

namespace MTM_Receiving_Application.Module_Dunnage.Data;

public class Dao_DunnageCustomField
{
    private readonly string _connectionString;

    public Dao_DunnageCustomField(string connectionString)
    {
        _connectionString = connectionString;
    }

    public virtual async Task&lt;Model_Dao_Result&lt;int&gt;&gt; InsertAsync(int typeId, Model_CustomFieldDefinition field, string user)
    {
        var pNewId = new MySqlParameter(&quot;@p_new_id&quot;, MySqlDbType.Int32)
        {
            Direction = ParameterDirection.Output
        };

        var parameters = new MySqlParameter[]
        {
            new MySqlParameter(&quot;@p_type_id&quot;, typeId),
            new MySqlParameter(&quot;@p_field_name&quot;, field.FieldName),
            new MySqlParameter(&quot;@p_field_type&quot;, field.FieldType),
            new MySqlParameter(&quot;@p_display_order&quot;, field.DisplayOrder),
            new MySqlParameter(&quot;@p_is_required&quot;, field.IsRequired),
            new MySqlParameter(&quot;@p_user&quot;, user),
            pNewId
        };

        var result = await Helper_Database_StoredProcedure.ExecuteAsync(
            &quot;sp_Dunnage_CustomFields_Insert&quot;,
            parameters,
            _connectionString
        );

        if (result.IsSuccess)
        {
            if (pNewId.Value != null &amp;&amp; pNewId.Value != DBNull.Value)
            {
                return Model_Dao_Result_Factory.Success&lt;int&gt;(Convert.ToInt32(pNewId.Value));
            }
            return Model_Dao_Result_Factory.Failure&lt;int&gt;(&quot;Failed to retrieve new ID&quot;);
        }

        return Model_Dao_Result_Factory.Failure&lt;int&gt;(result.ErrorMessage, result.Exception);
    }

    public virtual async Task&lt;Model_Dao_Result&lt;List&lt;Model_CustomFieldDefinition&gt;&gt;&gt; GetByTypeAsync(int typeId)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;@p_type_id&quot;, typeId }
        };

        return await Helper_Database_StoredProcedure.ExecuteListAsync&lt;Model_CustomFieldDefinition&gt;(
            _connectionString,
            &quot;sp_Dunnage_CustomFields_GetByType&quot;,
            MapFromReader,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&gt; DeleteAsync(int fieldId)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;@p_field_id&quot;, fieldId }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_custom_fields_delete&quot;,
            parameters
        );
    }

    private Model_CustomFieldDefinition MapFromReader(IDataReader reader)
    {
        return new Model_CustomFieldDefinition
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            FieldName = reader.GetString(reader.GetOrdinal(&quot;field_name&quot;)),
            FieldType = reader.GetString(reader.GetOrdinal(&quot;field_type&quot;)),
            DisplayOrder = reader.GetInt32(reader.GetOrdinal(&quot;display_order&quot;)),
            IsRequired = reader.GetBoolean(reader.GetOrdinal(&quot;is_required&quot;))
        };
    }
}</file><file path="Module_Dunnage/Data/Dao_DunnageLoad.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Receiving.Models;
using System.Text.Json;

namespace MTM_Receiving_Application.Module_Dunnage.Data;

public class Dao_DunnageLoad
{
    private readonly string _connectionString;

    public Dao_DunnageLoad(string connectionString)
    {
        _connectionString = connectionString;
    }

    public virtual async Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnageLoad&gt;&gt;&gt; GetAllAsync()
    {
        return await Helper_Database_StoredProcedure.ExecuteListAsync&lt;Model_DunnageLoad&gt;(
            _connectionString,
            &quot;sp_Dunnage_Loads_GetAll&quot;,
            MapFromReader
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnageLoad&gt;&gt;&gt; GetByDateRangeAsync(DateTime startDate, DateTime endDate)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;start_date&quot;, startDate },
            { &quot;end_date&quot;, endDate }
        };

        return await Helper_Database_StoredProcedure.ExecuteListAsync&lt;Model_DunnageLoad&gt;(
            _connectionString,
            &quot;sp_Dunnage_Loads_GetByDateRange&quot;,
            MapFromReader,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;Model_DunnageLoad&gt;&gt; GetByIdAsync(Guid loadUuid)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;load_uuid&quot;, loadUuid.ToString() }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync&lt;Model_DunnageLoad&gt;(
            _connectionString,
            &quot;sp_Dunnage_Loads_GetById&quot;,
            MapFromReader,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&gt; InsertAsync(Guid loadUuid, string partId, decimal quantity, string user)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;load_uuid&quot;, loadUuid.ToString() },
            { &quot;part_id&quot;, partId },
            { &quot;quantity&quot;, quantity },
            { &quot;user&quot;, user }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Dunnage_Loads_Insert&quot;,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&gt; InsertBatchAsync(List&lt;Model_DunnageLoad&gt; loads, string user)
    {
        // Validate that all part IDs exist before attempting insert
        var uniquePartIds = loads.Select(l =&gt; l.PartId).Distinct().ToList();
        var daoPart = new Dao_DunnagePart(_connectionString);
        var invalidParts = new List&lt;string&gt;();

        foreach (var partId in uniquePartIds)
        {
            var partResult = await daoPart.GetByIdAsync(partId);
            if (!partResult.IsSuccess || partResult.Data == null)
            {
                invalidParts.Add(partId);
            }
        }

        if (invalidParts.Count &gt; 0)
        {
            return new Model_Dao_Result
            {
                Success = false,
                ErrorMessage = $&quot;Cannot save loads: The following Part ID(s) have not been registered in the system: {string.Join(&quot;, &quot;, invalidParts)}. &quot; +
                              $&quot;Please go to Admin &gt; Manage Parts to register these parts before receiving them.&quot;,
                Severity = Enum_ErrorSeverity.Error
            };
        }

        // Serialize loads to JSON for batch insert
        // We need to map the model properties to the JSON structure expected by the SP
        var loadData = new List&lt;object&gt;();
        foreach (var load in loads)
        {
            loadData.Add(new
            {
                load_uuid = load.LoadUuid.ToString(),
                part_id = load.PartId,
                quantity = load.Quantity
            });
        }

        string json = JsonSerializer.Serialize(loadData);

        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;load_data&quot;, json },
            { &quot;user&quot;, user }
        };

        var result = await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Dunnage_Loads_InsertBatch&quot;,
            parameters
        );

        // Enhance foreign key constraint error messages
        if (!result.Success &amp;&amp; result.ErrorMessage != null)
        {
            if (result.ErrorMessage.Contains(&quot;FK_dunnage_history_part_id&quot;) ||
                result.ErrorMessage.Contains(&quot;foreign key constraint&quot;))
            {
                result.ErrorMessage = &quot;Cannot save loads: One or more Part IDs are not registered in the system. &quot; +
                                     &quot;Please go to Admin &gt; Manage Parts to register all parts before receiving them.&quot;;
                result.Severity = Enum_ErrorSeverity.Error;
            }
        }

        return result;
    }

    public virtual async Task&lt;Model_Dao_Result&gt; UpdateAsync(Guid loadUuid, decimal quantity, string user)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;load_uuid&quot;, loadUuid.ToString() },
            { &quot;quantity&quot;, quantity },
            { &quot;user&quot;, user }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Dunnage_Loads_Update&quot;,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&gt; DeleteAsync(Guid loadUuid)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;load_uuid&quot;, loadUuid.ToString() }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Dunnage_Loads_Delete&quot;,
            parameters
        );
    }

    private Model_DunnageLoad MapFromReader(IDataReader reader)
    {
        return new Model_DunnageLoad
        {
            LoadUuid = (Guid)reader[reader.GetOrdinal(&quot;load_uuid&quot;)],
            PartId = reader.GetString(reader.GetOrdinal(&quot;part_id&quot;)),
            Quantity = reader.GetDecimal(reader.GetOrdinal(&quot;quantity&quot;)),
            ReceivedDate = reader.GetDateTime(reader.GetOrdinal(&quot;received_date&quot;)),
            CreatedBy = reader.GetString(reader.GetOrdinal(&quot;created_by&quot;)),
            CreatedDate = reader.GetDateTime(reader.GetOrdinal(&quot;created_date&quot;)),
            ModifiedBy = reader.IsDBNull(reader.GetOrdinal(&quot;modified_by&quot;)) ? null : reader.GetString(reader.GetOrdinal(&quot;modified_by&quot;)),
            ModifiedDate = reader.IsDBNull(reader.GetOrdinal(&quot;modified_date&quot;)) ? null : reader.GetDateTime(reader.GetOrdinal(&quot;modified_date&quot;))
        };
    }
}</file><file path="Module_Dunnage/Data/Dao_DunnageType.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;

namespace MTM_Receiving_Application.Module_Dunnage.Data;

public class Dao_DunnageType
{
    private readonly string _connectionString;

    public Dao_DunnageType(string connectionString)
    {
        _connectionString = connectionString;
    }

    public virtual async Task&lt;Model_Dao_Result&lt;List&lt;Model_DunnageType&gt;&gt;&gt; GetAllAsync()
    {
        Console.WriteLine($&quot;[Dao_DunnageType] GetAllAsync called&quot;);
        Console.WriteLine($&quot;[Dao_DunnageType] Connection string: {_connectionString}&quot;);

        var result = await Helper_Database_StoredProcedure.ExecuteListAsync&lt;Model_DunnageType&gt;(
            _connectionString,
            &quot;sp_Dunnage_Types_GetAll&quot;,
            MapFromReader
        );

        Console.WriteLine($&quot;[Dao_DunnageType] Result - IsSuccess: {result.IsSuccess}, Data Count: {result.Data?.Count ?? 0}, Error: {result.ErrorMessage}&quot;);

        return result;
    }

    public virtual async Task&lt;Model_Dao_Result&lt;Model_DunnageType&gt;&gt; GetByIdAsync(int id)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;id&quot;, id }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync&lt;Model_DunnageType&gt;(
            _connectionString,
            &quot;sp_Dunnage_Types_GetById&quot;,
            MapFromReader,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;int&gt;&gt; InsertAsync(string typeName, string icon, string user)
    {
        var pNewId = new MySqlParameter(&quot;@p_new_id&quot;, MySqlDbType.Int32)
        {
            Direction = ParameterDirection.Output
        };

        var parameters = new MySqlParameter[]
        {
            new MySqlParameter(&quot;@p_type_name&quot;, typeName),
            new MySqlParameter(&quot;@p_icon&quot;, icon),
            new MySqlParameter(&quot;@p_user&quot;, user),
            pNewId
        };

        var result = await Helper_Database_StoredProcedure.ExecuteAsync(
            &quot;sp_dunnage_types_insert&quot;,
            parameters,
            _connectionString
        );

        if (result.IsSuccess)
        {
            if (pNewId.Value != null &amp;&amp; pNewId.Value != DBNull.Value)
            {
                return Model_Dao_Result_Factory.Success&lt;int&gt;(Convert.ToInt32(pNewId.Value));
            }
            return Model_Dao_Result_Factory.Failure&lt;int&gt;(&quot;Failed to retrieve new ID&quot;);
        }

        return Model_Dao_Result_Factory.Failure&lt;int&gt;(result.ErrorMessage, result.Exception);
    }

    public virtual async Task&lt;Model_Dao_Result&gt; UpdateAsync(int id, string typeName, string icon, string user)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;id&quot;, id },
            { &quot;type_name&quot;, typeName },
            { &quot;icon&quot;, icon },
            { &quot;user&quot;, user }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_dunnage_types_update&quot;,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&gt; DeleteAsync(int id)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;id&quot;, id }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_dunnage_types_delete&quot;,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;int&gt;&gt; CountPartsAsync(int typeId)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;type_id&quot;, typeId }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync&lt;int&gt;(
            _connectionString,
            &quot;sp_Dunnage_Types_CountParts&quot;,
            reader =&gt; reader.GetInt32(reader.GetOrdinal(&quot;part_count&quot;)),
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;int&gt;&gt; CountTransactionsAsync(int typeId)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;type_id&quot;, typeId }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync&lt;int&gt;(
            _connectionString,
            &quot;sp_Dunnage_Types_CountTransactions&quot;,
            reader =&gt; reader.GetInt32(reader.GetOrdinal(&quot;transaction_count&quot;)),
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Check if a dunnage type name already exists (for duplicate detection during create/update)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;typeName&quot;&gt;Type name to check&lt;/param&gt;
    /// &lt;param name=&quot;excludeId&quot;&gt;ID to exclude from check (null for new types, type ID for updates)&lt;/param&gt;
    /// &lt;returns&gt;True if duplicate exists, false otherwise&lt;/returns&gt;
    public virtual async Task&lt;Model_Dao_Result&lt;bool&gt;&gt; CheckDuplicateNameAsync(string typeName, int? excludeId = null)
    {
        var pExists = new MySqlParameter(&quot;@p_exists&quot;, MySqlDbType.Bit)
        {
            Direction = ParameterDirection.Output
        };

        var parameters = new MySqlParameter[]
        {
            new MySqlParameter(&quot;@p_type_name&quot;, typeName),
            new MySqlParameter(&quot;@p_exclude_id&quot;, excludeId.HasValue ? (object)excludeId.Value : DBNull.Value),
            pExists
        };

        var result = await Helper_Database_StoredProcedure.ExecuteAsync(
            &quot;sp_Dunnage_Types_CheckDuplicate&quot;,
            parameters,
            _connectionString
        );

        if (result.IsSuccess)
        {
            if (pExists.Value != null &amp;&amp; pExists.Value != DBNull.Value)
            {
                return Model_Dao_Result_Factory.Success&lt;bool&gt;(Convert.ToBoolean(pExists.Value));
            }
            return Model_Dao_Result_Factory.Success&lt;bool&gt;(false);
        }

        return Model_Dao_Result_Factory.Failure&lt;bool&gt;(result.ErrorMessage, result.Exception);
    }

    private Model_DunnageType MapFromReader(IDataReader reader)
    {
        return new Model_DunnageType
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            TypeName = reader.GetString(reader.GetOrdinal(&quot;type_name&quot;)),
            Icon = reader.IsDBNull(reader.GetOrdinal(&quot;icon&quot;)) ? &quot;Help&quot; : reader.GetString(reader.GetOrdinal(&quot;icon&quot;)),
            CreatedBy = reader.GetString(reader.GetOrdinal(&quot;created_by&quot;)),
            CreatedDate = reader.GetDateTime(reader.GetOrdinal(&quot;created_date&quot;)),
            ModifiedBy = reader.IsDBNull(reader.GetOrdinal(&quot;modified_by&quot;)) ? null : reader.GetString(reader.GetOrdinal(&quot;modified_by&quot;)),
            ModifiedDate = reader.IsDBNull(reader.GetOrdinal(&quot;modified_date&quot;)) ? null : reader.GetDateTime(reader.GetOrdinal(&quot;modified_date&quot;))
        };
    }
}</file><file path="Module_Dunnage/Data/Dao_InventoriedDunnage.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;

namespace MTM_Receiving_Application.Module_Dunnage.Data;

public class Dao_InventoriedDunnage
{
    private readonly string _connectionString;

    public Dao_InventoriedDunnage(string connectionString)
    {
        _connectionString = connectionString;
    }

    public virtual async Task&lt;Model_Dao_Result&lt;List&lt;Model_InventoriedDunnage&gt;&gt;&gt; GetAllAsync()
    {
        return await Helper_Database_StoredProcedure.ExecuteListAsync&lt;Model_InventoriedDunnage&gt;(
            _connectionString,
            &quot;sp_Dunnage_Inventory_GetAll&quot;,
            MapFromReader
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;bool&gt;&gt; CheckAsync(string partId)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;part_id&quot;, partId }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync&lt;bool&gt;(
            _connectionString,
            &quot;sp_Dunnage_Inventory_Check&quot;,
            reader =&gt; reader.GetBoolean(reader.GetOrdinal(&quot;requires_inventory&quot;)),
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;Model_InventoriedDunnage&gt;&gt; GetByPartAsync(string partId)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;part_id&quot;, partId }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync&lt;Model_InventoriedDunnage&gt;(
            _connectionString,
            &quot;sp_Dunnage_Inventory_GetByPart&quot;,
            MapFromReader,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&lt;int&gt;&gt; InsertAsync(string partId, string inventoryMethod, string notes, string user)
    {
        var pNewId = new MySqlParameter(&quot;@p_new_id&quot;, MySqlDbType.Int32)
        {
            Direction = ParameterDirection.Output
        };

        var parameters = new MySqlParameter[]
        {
            new MySqlParameter(&quot;@p_part_id&quot;, partId),
            new MySqlParameter(&quot;@p_inventory_method&quot;, inventoryMethod),
            new MySqlParameter(&quot;@p_notes&quot;, notes),
            new MySqlParameter(&quot;@p_user&quot;, user),
            pNewId
        };

        var result = await Helper_Database_StoredProcedure.ExecuteAsync(
            &quot;sp_Dunnage_Inventory_Insert&quot;,
            parameters,
            _connectionString
        );

        if (result.IsSuccess)
        {
            if (pNewId.Value != null &amp;&amp; pNewId.Value != DBNull.Value)
            {
                return Model_Dao_Result_Factory.Success&lt;int&gt;(Convert.ToInt32(pNewId.Value));
            }
            return Model_Dao_Result_Factory.Failure&lt;int&gt;(&quot;Failed to retrieve new ID&quot;);
        }

        return Model_Dao_Result_Factory.Failure&lt;int&gt;(result.ErrorMessage, result.Exception);
    }

    public virtual async Task&lt;Model_Dao_Result&gt; UpdateAsync(int id, string inventoryMethod, string notes, string user)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;id&quot;, id },
            { &quot;inventory_method&quot;, inventoryMethod },
            { &quot;notes&quot;, notes },
            { &quot;user&quot;, user }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Dunnage_Inventory_Update&quot;,
            parameters
        );
    }

    public virtual async Task&lt;Model_Dao_Result&gt; DeleteAsync(int id)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;id&quot;, id }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Dunnage_Inventory_Delete&quot;,
            parameters
        );
    }

    private Model_InventoriedDunnage MapFromReader(IDataReader reader)
    {
        return new Model_InventoriedDunnage
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            PartId = reader.GetString(reader.GetOrdinal(&quot;part_id&quot;)),
            InventoryMethod = reader.IsDBNull(reader.GetOrdinal(&quot;inventory_method&quot;)) ? null : reader.GetString(reader.GetOrdinal(&quot;inventory_method&quot;)),
            Notes = reader.IsDBNull(reader.GetOrdinal(&quot;notes&quot;)) ? null : reader.GetString(reader.GetOrdinal(&quot;notes&quot;)),
            CreatedBy = reader.GetString(reader.GetOrdinal(&quot;created_by&quot;)),
            CreatedDate = reader.GetDateTime(reader.GetOrdinal(&quot;created_date&quot;)),
            ModifiedBy = reader.IsDBNull(reader.GetOrdinal(&quot;modified_by&quot;)) ? null : reader.GetString(reader.GetOrdinal(&quot;modified_by&quot;)),
            ModifiedDate = reader.IsDBNull(reader.GetOrdinal(&quot;modified_date&quot;)) ? null : reader.GetDateTime(reader.GetOrdinal(&quot;modified_date&quot;))
        };
    }
}</file><file path="Module_Dunnage/Services/Service_DunnageAdminWorkflow.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using System.Linq;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Dunnage.Data;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Enums;
namespace MTM_Receiving_Application.Module_Dunnage.Services;

/// &lt;summary&gt;
/// Service implementation for Dunnage Admin UI navigation workflow
/// Manages 4-section navigation: Types, Parts, Specs, Inventoried List
/// &lt;/summary&gt;
public class Service_DunnageAdminWorkflow : IService_DunnageAdminWorkflow
{
    private Enum_DunnageAdminSection _currentSection = Enum_DunnageAdminSection.Hub;
    private bool _isDirty;

    /// &lt;summary&gt;
    /// Gets the current admin section being displayed
    /// &lt;/summary&gt;
    public Enum_DunnageAdminSection CurrentSection
    {
        get =&gt; _currentSection;
        private set
        {
            if (_currentSection != value)
            {
                _currentSection = value;
                SectionChanged?.Invoke(this, _currentSection);
            }
        }
    }

    /// &lt;summary&gt;
    /// Raised when admin section changes
    /// &lt;/summary&gt;
    public event EventHandler&lt;Enum_DunnageAdminSection&gt;? SectionChanged;

    /// &lt;summary&gt;
    /// Raised when status message needs to be displayed
    /// &lt;/summary&gt;
    public event EventHandler&lt;string&gt;? StatusMessageRaised;

    /// &lt;summary&gt;
    /// Navigate to specific admin section
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;section&quot;&gt;Target section (Types, Parts, Specs, InventoriedList)&lt;/param&gt;
    public async Task NavigateToSectionAsync(Enum_DunnageAdminSection section)
    {
        // Check if navigation is allowed
        if (!await CanNavigateAwayAsync())
        {
            StatusMessageRaised?.Invoke(this, &quot;Cannot navigate - unsaved changes exist. Please save or discard changes first.&quot;);
            return;
        }

        // Navigate to section
        CurrentSection = section;
        MarkClean();

        // Raise status message
        string sectionName = section switch
        {
            Enum_DunnageAdminSection.Hub =&gt; &quot;Admin Hub&quot;,
            Enum_DunnageAdminSection.Types =&gt; &quot;Dunnage Types Management&quot;,
            Enum_DunnageAdminSection.Parts =&gt; &quot;Part Master Management&quot;,
            Enum_DunnageAdminSection.Specs =&gt; &quot;Spec Definitions Management&quot;,
            Enum_DunnageAdminSection.InventoriedList =&gt; &quot;Inventoried Dunnage List&quot;,
            _ =&gt; &quot;Unknown Section&quot;
        };

        StatusMessageRaised?.Invoke(this, $&quot;Navigated to {sectionName}&quot;);
    }

    /// &lt;summary&gt;
    /// Return to main admin hub (4-card navigation view)
    /// &lt;/summary&gt;
    public async Task NavigateToHubAsync()
    {
        await NavigateToSectionAsync(Enum_DunnageAdminSection.Hub);
    }

    /// &lt;summary&gt;
    /// Validate if navigation away from current section is allowed
    /// (checks for unsaved changes, pending operations)
    /// &lt;/summary&gt;
    /// &lt;returns&gt;True if navigation allowed, false if blocked&lt;/returns&gt;
    public Task&lt;bool&gt; CanNavigateAwayAsync()
    {
        // If no unsaved changes, allow navigation
        if (!_isDirty)
        {
            return Task.FromResult(true);
        }

        // If unsaved changes exist, block navigation
        // The UI should prompt the user to save or discard changes
        return Task.FromResult(false);
    }

    /// &lt;summary&gt;
    /// Mark current section as having unsaved changes
    /// &lt;/summary&gt;
    public void MarkDirty()
    {
        _isDirty = true;
    }

    /// &lt;summary&gt;
    /// Clear unsaved changes flag (after save or discard)
    /// &lt;/summary&gt;
    public void MarkClean()
    {
        _isDirty = false;
    }

    /// &lt;summary&gt;
    /// Check if current section has unsaved changes
    /// &lt;/summary&gt;
    public bool IsDirty =&gt; _isDirty;
}</file><file path="Module_Dunnage/Services/Service_DunnageCSVWriter.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using System.Linq;
using System.Text;
using System.IO;
using System.Dynamic;
using CsvHelper;
using CsvHelper.Configuration;
using System.Globalization;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Dunnage.Data;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Dunnage.Services
{
    public class Service_DunnageCSVWriter : IService_DunnageCSVWriter
    {
        private readonly IService_MySQL_Dunnage _dunnageService;
        private readonly IService_UserSessionManager _sessionManager;
        private readonly IService_LoggingUtility _logger;
        private readonly IService_ErrorHandler _errorHandler;

        public Service_DunnageCSVWriter(
            IService_MySQL_Dunnage dunnageService,
            IService_UserSessionManager sessionManager,
            IService_LoggingUtility logger,
            IService_ErrorHandler errorHandler)
        {
            _dunnageService = dunnageService;
            _sessionManager = sessionManager;
            _logger = logger;
            _errorHandler = errorHandler;
        }

        /// &lt;summary&gt;
        /// Get RFC 4180 compliant CSV configuration
        /// T103-T109: RFC 4180 CSV Formatting
        /// &lt;/summary&gt;
        private CsvConfiguration GetRfc4180Configuration()
        {
            return new CsvConfiguration(CultureInfo.InvariantCulture)
            {
                // T103: RFC 4180 settings
                Delimiter = &quot;,&quot;,              // Standard comma delimiter
                Quote = &apos;&quot;&apos;,                  // Double quote for field escaping
                HasHeaderRecord = true,       // Include header row

                // T106: CRLF line endings
                NewLine = &quot;\r\n&quot;,            // RFC 4180 requires CRLF

                // T104: Automatic escaping for special characters (commas, quotes, newlines)
                ShouldQuote = args =&gt; !string.IsNullOrEmpty(args.Field) &amp;&amp;
                                     (args.Field.Contains(&quot;,&quot;) ||
                                      args.Field.Contains(&quot;\&quot;&quot;) ||
                                      args.Field.Contains(&quot;\n&quot;) ||
                                      args.Field.Contains(&quot;\r&quot;)),

                // T105: UTF-8 with BOM for Excel/LabelView compatibility
                Encoding = Encoding.UTF8,

                // T108: Invariant culture for numeric formatting (period as decimal separator)
                // Already handled by CultureInfo.InvariantCulture
            };
        }

        public async Task&lt;Model_CSVWriteResult&gt; WriteToCSVAsync(List&lt;Model_DunnageLoad&gt; loads)
        {
            // Default to DunnageData.csv for backward compatibility
            return await WriteToCsvAsync(loads, &quot;DunnageData&quot;);
        }

        /// &lt;summary&gt;
        /// Write dunnage loads to CSV file (wizard workflow export)
        /// Uses fixed columns based on selected type&apos;s specs
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;loads&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;typeName&quot;&gt;&lt;/param&gt;
        public async Task&lt;Model_CSVWriteResult&gt; WriteToCsvAsync(List&lt;Model_DunnageLoad&gt; loads, string typeName)
        {
            if (loads == null || loads.Count == 0)
            {
                await _logger.LogWarningAsync(&quot;WriteToCsvAsync called with no loads to export&quot;);
                return new Model_CSVWriteResult { ErrorMessage = &quot;No loads to export.&quot; };
            }

            try
            {
                await _logger.LogInfoAsync($&quot;Starting CSV export for {loads.Count} loads of type &apos;{typeName}&apos;&quot;);

                // FR-046: Get dynamic spec keys
                var specKeys = await _dunnageService.GetAllSpecKeysAsync();
                specKeys.Sort(); // FR-042: Alphabetically sorted

                // Prepare records
                var records = new List&lt;dynamic&gt;();
                foreach (var load in loads)
                {
                    dynamic record = new ExpandoObject();
                    var dict = (IDictionary&lt;string, object&gt;)record;

                    // FR-041: Fixed columns
                    dict[&quot;DunnageType&quot;] = load.DunnageType;
                    dict[&quot;PartID&quot;] = load.PartId;
                    dict[&quot;Quantity&quot;] = load.Quantity;
                    dict[&quot;PONumber&quot;] = load.PoNumber;
                    dict[&quot;ReceivedDate&quot;] = FormatDateTime(load.ReceivedDate); // T109: yyyy-MM-dd HH:mm:ss
                    dict[&quot;Employee&quot;] = load.CreatedBy;

                    // FR-042: Dynamic columns
                    foreach (var key in specKeys)
                    {
                        if (load.Specs != null &amp;&amp; load.Specs.TryGetValue(key, out object? value))
                        {
                            dict[key] = value;
                        }
                        else
                        {
                            dict[key] = &quot;&quot;; // FR-043: Empty string if missing
                        }
                    }
                    records.Add(record);
                }

                // Write to local path
                string filename = $&quot;{typeName}_{DateTime.Now:yyyyMMdd_HHmmss}.csv&quot;;
                var localPath = GetLocalCsvPath(filename);
                await WriteCsvFileAsync(localPath, records);
                await _logger.LogInfoAsync($&quot;Successfully wrote {records.Count} records to local CSV: {localPath}&quot;);

                // Write to network path
                string networkPath = &quot;&quot;;
                bool networkSuccess = false;
                try
                {
                    networkPath = GetNetworkCsvPath(filename);
                    // Ensure directory exists for network path
                    var networkDir = Path.GetDirectoryName(networkPath);
                    if (!string.IsNullOrEmpty(networkDir) &amp;&amp; !Directory.Exists(networkDir))
                    {
                        Directory.CreateDirectory(networkDir);
                    }
                    await WriteCsvFileAsync(networkPath, records);
                    networkSuccess = true;
                    await _logger.LogInfoAsync($&quot;Successfully wrote {records.Count} records to network CSV: {networkPath}&quot;);
                }
                catch (Exception ex)
                {
                    await _logger.LogErrorAsync($&quot;Failed to write to network path &apos;{networkPath}&apos;: {ex.Message}&quot;);
                    // FR-044: Network failure graceful handling
                }

                return new Model_CSVWriteResult
                {
                    LocalSuccess = true,
                    LocalFilePath = localPath,
                    NetworkSuccess = networkSuccess,
                    NetworkFilePath = networkPath,
                    RecordsWritten = records.Count,
                    ErrorMessage = networkSuccess ? &quot;&quot; : &quot;Network write failed. See logs.&quot;
                };
            }
            catch (Exception ex)
            {
                await _logger.LogErrorAsync($&quot;CSV export failed for type &apos;{typeName}&apos;: {ex.Message}&quot;);
                await _errorHandler.HandleErrorAsync($&quot;Export failed: {ex.Message}&quot;, Enum_ErrorSeverity.Error, ex, true);
                return new Model_CSVWriteResult { ErrorMessage = $&quot;Export failed: {ex.Message}&quot; };
            }
        }

        /// &lt;summary&gt;
        /// Write dunnage loads to CSV with dynamic columns for all spec keys
        /// Used for Manual Entry and Edit Mode exports (all types in one file)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;loads&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;allSpecKeys&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;filename&quot;&gt;&lt;/param&gt;
        public async Task&lt;Model_CSVWriteResult&gt; WriteDynamicCsvAsync(
            List&lt;Model_DunnageLoad&gt; loads,
            List&lt;string&gt; allSpecKeys,
            string? filename = null)
        {
            if (loads == null || loads.Count == 0)
            {
                await _logger.LogWarningAsync(&quot;WriteDynamicCsvAsync called with no loads to export&quot;);
                return new Model_CSVWriteResult { ErrorMessage = &quot;No loads to export.&quot; };
            }

            try
            {
                await _logger.LogInfoAsync($&quot;Starting dynamic CSV export for {loads.Count} loads&quot;);

                // Use provided spec keys or fetch all
                var specKeys = allSpecKeys ?? await _dunnageService.GetAllSpecKeysAsync();
                specKeys.Sort(); // Alphabetically sorted

                // Prepare records
                var records = new List&lt;dynamic&gt;();
                foreach (var load in loads)
                {
                    dynamic record = new ExpandoObject();
                    var dict = (IDictionary&lt;string, object&gt;)record;

                    // Fixed columns
                    dict[&quot;ID&quot;] = load.LoadUuid;
                    dict[&quot;PartID&quot;] = load.PartId;
                    dict[&quot;DunnageType&quot;] = load.DunnageType ?? string.Empty;
                    dict[&quot;Quantity&quot;] = load.Quantity;
                    dict[&quot;PONumber&quot;] = load.PoNumber ?? string.Empty;
                    dict[&quot;ReceivedDate&quot;] = FormatDateTime(load.ReceivedDate); // T109: yyyy-MM-dd HH:mm:ss
                    dict[&quot;UserId&quot;] = load.CreatedBy;
                    dict[&quot;Location&quot;] = load.Location ?? string.Empty;
                    dict[&quot;LabelNumber&quot;] = load.LabelNumber ?? string.Empty;

                    // Dynamic spec columns
                    foreach (var key in specKeys)
                    {
                        if (load.Specs != null &amp;&amp; load.Specs.TryGetValue(key, out object? value))
                        {
                            dict[key] = value;
                        }
                        else
                        {
                            dict[key] = &quot;&quot;; // Blank cell for specs not applicable to this load&apos;s type
                        }
                    }
                    records.Add(record);
                }

                // Generate filename if not provided
                string csvFilename = filename ?? $&quot;DunnageData_{DateTime.Now:yyyyMMdd_HHmmss}.csv&quot;;

                // Write to local path
                var localPath = GetLocalCsvPath(csvFilename);
                await WriteCsvFileAsync(localPath, records);
                await _logger.LogInfoAsync($&quot;Successfully wrote {records.Count} records to local CSV: {localPath}&quot;);

                // Write to network path (best-effort)
                string networkPath = &quot;&quot;;
                bool networkSuccess = false;
                string? networkError = null;

                if (await IsNetworkPathAvailableAsync())
                {
                    try
                    {
                        networkPath = GetNetworkCsvPath(csvFilename);
                        var networkDir = Path.GetDirectoryName(networkPath);
                        if (!string.IsNullOrEmpty(networkDir) &amp;&amp; !Directory.Exists(networkDir))
                        {
                            Directory.CreateDirectory(networkDir);
                        }
                        await WriteCsvFileAsync(networkPath, records);
                        networkSuccess = true;
                        await _logger.LogInfoAsync($&quot;Successfully wrote {records.Count} records to network CSV: {networkPath}&quot;);
                    }
                    catch (Exception ex)
                    {
                        networkError = ex.Message;
                        await _logger.LogErrorAsync($&quot;Failed to write to network path &apos;{networkPath}&apos;: {ex.Message}&quot;);
                    }
                }
                else
                {
                    await _logger.LogWarningAsync(&quot;Network path not available for CSV export&quot;);
                }

                return new Model_CSVWriteResult
                {
                    LocalSuccess = true,
                    LocalFilePath = localPath,
                    NetworkSuccess = networkSuccess,
                    NetworkFilePath = networkPath,
                    NetworkError = networkError,
                    RecordsWritten = records.Count
                };
            }
            catch (Exception ex)
            {
                await _errorHandler.HandleErrorAsync($&quot;Dynamic CSV export failed: {ex.Message}&quot;, Enum_ErrorSeverity.Error, ex, true);
                return new Model_CSVWriteResult
                {
                    LocalSuccess = false,
                    ErrorMessage = $&quot;Export failed: {ex.Message}&quot;
                };
            }
        }

        /// &lt;summary&gt;
        /// Export selected loads from DataGrid (Manual Entry or Edit Mode)
        /// Includes dynamic spec columns based on types in selection
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;selectedLoads&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;includeAllSpecColumns&quot;&gt;&lt;/param&gt;
        public async Task&lt;Model_CSVWriteResult&gt; ExportSelectedLoadsAsync(
            List&lt;Model_DunnageLoad&gt; selectedLoads,
            bool includeAllSpecColumns = false)
        {
            if (selectedLoads == null || selectedLoads.Count == 0)
            {
                return new Model_CSVWriteResult { ErrorMessage = &quot;No loads selected for export.&quot; };
            }

            try
            {
                List&lt;string&gt; specKeys;

                if (includeAllSpecColumns)
                {
                    // Include all spec keys across all types
                    specKeys = await _dunnageService.GetAllSpecKeysAsync();
                }
                else
                {
                    // Only include spec keys used by selected loads&apos; types
                    var typeIds = selectedLoads
                        .Where(l =&gt; l.TypeId.HasValue)
                        .Select(l =&gt; l.TypeId!.Value)
                        .Distinct()
                        .ToList();

                    specKeys = new List&lt;string&gt;();
                    foreach (var typeId in typeIds)
                    {
                        var specs = await _dunnageService.GetSpecsForTypeAsync(typeId);
                        if (specs.IsSuccess &amp;&amp; specs.Data != null)
                        {
                            var keys = specs.Data.Select(s =&gt; s.SpecKey).Distinct();
                            specKeys.AddRange(keys);
                        }
                    }
                    specKeys = specKeys.Distinct().ToList();
                }

                string filename = $&quot;DunnageSelection_{DateTime.Now:yyyyMMdd_HHmmss}.csv&quot;;
                return await WriteDynamicCsvAsync(selectedLoads, specKeys, filename);
            }
            catch (Exception ex)
            {
                await _errorHandler.HandleErrorAsync($&quot;Selected loads export failed: {ex.Message}&quot;, Enum_ErrorSeverity.Error, ex, true);
                return new Model_CSVWriteResult { ErrorMessage = $&quot;Export failed: {ex.Message}&quot; };
            }
        }

        /// &lt;summary&gt;
        /// Validate network path availability (for dual-path writing)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;timeout&quot;&gt;&lt;/param&gt;
        public async Task&lt;bool&gt; IsNetworkPathAvailableAsync(int timeout = 3)
        {
            return await Task.Run(() =&gt;
            {
                try
                {
                    var networkRoot = @&quot;\\mtmanu-fs01\Expo Drive\Receiving\MTM Receiving Application\User CSV Files&quot;;
                    return Directory.Exists(networkRoot);
                }
                catch
                {
                    return false;
                }
            });
        }

        /// &lt;summary&gt;
        /// Get local CSV file path for current user
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;filename&quot;&gt;&lt;/param&gt;
        public string GetLocalCsvPath(string filename)
        {
            var appData = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
            var folder = Path.Combine(appData, &quot;MTM_Receiving_Application&quot;);
            if (!Directory.Exists(folder))
            {
                Directory.CreateDirectory(folder);
            }
            return Path.Combine(folder, filename);
        }

        /// &lt;summary&gt;
        /// Get network CSV file path for current user
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;filename&quot;&gt;&lt;/param&gt;
        public string GetNetworkCsvPath(string filename)
        {
            var username = _sessionManager.CurrentSession?.User?.WindowsUsername ?? &quot;Unknown&quot;;
            var folder = $@&quot;\\mtmanu-fs01\Expo Drive\Receiving\MTM Receiving Application\User CSV Files\{username}&quot;;
            return Path.Combine(folder, filename);
        }

        private async Task WriteCsvFileAsync(string path, IEnumerable&lt;dynamic&gt; records)
        {
            // T105: UTF-8 with BOM for Excel/LabelView compatibility
            var encoding = new UTF8Encoding(true); // true = include BOM

            await using (var writer = new StreamWriter(path, false, encoding))
            await using (var csv = new CsvWriter(writer, GetRfc4180Configuration()))
            {
                await csv.WriteRecordsAsync(records);
            }
        }

        /// &lt;summary&gt;
        /// Format date/time values as yyyy-MM-dd HH:mm:ss (T109)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;value&quot;&gt;&lt;/param&gt;
        private string FormatDateTime(DateTime value)
        {
            return value.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;, CultureInfo.InvariantCulture);
        }

        /// &lt;summary&gt;
        /// Clear CSV files from both local and network paths
        /// If filenamePattern is provided, only clear files matching the pattern
        /// If null, clear all CSV files in the user directories
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;filenamePattern&quot;&gt;Optional pattern to match (e.g., &quot;DunnageData*.csv&quot;)&lt;/param&gt;
        /// &lt;returns&gt;Result indicating success/failure for local and network operations&lt;/returns&gt;
        public async Task&lt;Model_CSVDeleteResult&gt; ClearCSVFilesAsync(string? filenamePattern = null)
        {
            var result = new Model_CSVDeleteResult();
            var errors = new List&lt;string&gt;();

            try
            {
                await _logger.LogInfoAsync($&quot;Starting CSV file clearing with pattern: {filenamePattern ?? &quot;all&quot;}&quot;);

                // Clear local files
                try
                {
                    var localFolder = Path.GetDirectoryName(GetLocalCsvPath(&quot;dummy.csv&quot;));
                    if (Directory.Exists(localFolder))
                    {
                        var filesToClear = Directory.GetFiles(localFolder, filenamePattern ?? &quot;*.csv&quot;);
                        foreach (var file in filesToClear)
                        {
                            // Overwrite with header only
                            await using var writer = new StreamWriter(file, false, new UTF8Encoding(true));
                            await using var csv = new CsvWriter(writer, GetRfc4180Configuration());
                            csv.WriteHeader&lt;Model_DunnageLoad&gt;();
                            csv.NextRecord();

                            await _logger.LogInfoAsync($&quot;Cleared local CSV file: {file}&quot;);
                        }
                        result.LocalDeleted = true;
                    }
                    else
                    {
                        result.LocalDeleted = true; // No directory means no files to clear
                        await _logger.LogInfoAsync(&quot;Local CSV directory does not exist - no files to clear&quot;);
                    }
                }
                catch (Exception ex)
                {
                    result.LocalDeleted = false;
                    result.LocalError = $&quot;Local clearing failed: {ex.Message}&quot;;
                    errors.Add(result.LocalError);
                    await _logger.LogErrorAsync($&quot;Failed to clear local CSV files: {ex.Message}&quot;);
                }

                // Clear network files (best-effort)
                try
                {
                    if (await IsNetworkPathAvailableAsync())
                    {
                        var networkFolder = Path.GetDirectoryName(GetNetworkCsvPath(&quot;dummy.csv&quot;));
                        if (Directory.Exists(networkFolder))
                        {
                            var filesToClear = Directory.GetFiles(networkFolder, filenamePattern ?? &quot;*.csv&quot;);
                            foreach (var file in filesToClear)
                            {
                                await using var writer = new StreamWriter(file, false, new UTF8Encoding(true));
                                await using var csv = new CsvWriter(writer, GetRfc4180Configuration());
                                csv.WriteHeader&lt;Model_DunnageLoad&gt;();
                                csv.NextRecord();

                                await _logger.LogInfoAsync($&quot;Cleared network CSV file: {file}&quot;);
                            }
                            result.NetworkDeleted = true;
                        }
                        else
                        {
                            result.NetworkDeleted = true; // No directory means no files to clear
                            await _logger.LogInfoAsync(&quot;Network CSV directory does not exist - no files to clear&quot;);
                        }
                    }
                    else
                    {
                        result.NetworkDeleted = false;
                        result.NetworkError = &quot;Network path not available&quot;;
                        errors.Add(&quot;Network path not available&quot;);
                        await _logger.LogWarningAsync(&quot;Network path not available for CSV clearing&quot;);
                    }
                }
                catch (Exception ex)
                {
                    result.NetworkDeleted = false;
                    result.NetworkError = $&quot;Network clearing failed: {ex.Message}&quot;;
                    errors.Add(result.NetworkError);
                    await _logger.LogErrorAsync($&quot;Failed to clear network CSV files: {ex.Message}&quot;);
                }

                await _logger.LogInfoAsync($&quot;CSV clearing completed. Local: {result.LocalDeleted}, Network: {result.NetworkDeleted}&quot;);
            }
            catch (Exception ex)
            {
                var msg = $&quot;Unexpected error during CSV clearing: {ex.Message}&quot;;
                result.LocalError = result.LocalError ?? msg;
                await _errorHandler.HandleErrorAsync($&quot;CSV clearing failed: {ex.Message}&quot;, Enum_ErrorSeverity.Error, ex, true);
            }

            return result;
        }
    }
}</file><file path="Module_Dunnage/Services/Service_DunnageWorkflow.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using System.Linq;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Dunnage.Data;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Dunnage.Services
{
    public class Service_DunnageWorkflow : IService_DunnageWorkflow
    {
        private readonly IService_MySQL_Dunnage _dunnageService;
        private readonly IService_DunnageCSVWriter _csvWriter;
        private readonly IService_UserSessionManager _sessionManager;
        private readonly IService_LoggingUtility _logger;
        private readonly IService_ErrorHandler _errorHandler;
        private readonly IService_ViewModelRegistry _viewModelRegistry;

        public Enum_DunnageWorkflowStep CurrentStep { get; private set; }
        public Model_DunnageSession CurrentSession { get; private set; } = new();

        public event EventHandler? StepChanged;
        public event EventHandler&lt;string&gt;? StatusMessageRaised;

        public Service_DunnageWorkflow(
            IService_MySQL_Dunnage dunnageService,
            IService_DunnageCSVWriter csvWriter,
            IService_UserSessionManager sessionManager,
            IService_LoggingUtility logger,
            IService_ErrorHandler errorHandler,
            IService_ViewModelRegistry viewModelRegistry)
        {
            _dunnageService = dunnageService;
            _csvWriter = csvWriter;
            _sessionManager = sessionManager;
            _logger = logger;
            _errorHandler = errorHandler;
            _viewModelRegistry = viewModelRegistry;
        }

        public Task&lt;bool&gt; StartWorkflowAsync()
        {
            ClearSession();

            // Check if user has a default mode set
            var currentUser = _sessionManager.CurrentSession?.User;
            if (currentUser != null &amp;&amp; !string.IsNullOrEmpty(currentUser.DefaultDunnageMode))
            {
                // Skip mode selection and go directly to the default mode
                switch (currentUser.DefaultDunnageMode.ToLower())
                {
                    case &quot;guided&quot;:
                        GoToStep(Enum_DunnageWorkflowStep.TypeSelection);
                        StatusMessageRaised?.Invoke(this, &quot;Starting Guided Wizard mode&quot;);
                        break;
                    case &quot;manual&quot;:
                        GoToStep(Enum_DunnageWorkflowStep.ManualEntry);
                        StatusMessageRaised?.Invoke(this, &quot;Starting Manual Entry mode&quot;);
                        break;
                    case &quot;edit&quot;:
                        GoToStep(Enum_DunnageWorkflowStep.EditMode);
                        StatusMessageRaised?.Invoke(this, &quot;Starting Edit mode&quot;);
                        break;
                    default:
                        // Invalid default, show mode selection
                        GoToStep(Enum_DunnageWorkflowStep.ModeSelection);
                        StatusMessageRaised?.Invoke(this, &quot;Workflow started&quot;);
                        break;
                }
            }
            else
            {
                // No default mode, show mode selection
                GoToStep(Enum_DunnageWorkflowStep.ModeSelection);
                StatusMessageRaised?.Invoke(this, &quot;Workflow started&quot;);
            }

            return Task.FromResult(true);
        }

        public Task&lt;Model_WorkflowStepResult&gt; AdvanceToNextStepAsync()
        {
            try
            {
                switch (CurrentStep)
                {
                    case Enum_DunnageWorkflowStep.ModeSelection:
                        GoToStep(Enum_DunnageWorkflowStep.TypeSelection);
                        break;

                    case Enum_DunnageWorkflowStep.TypeSelection:
                        if (CurrentSession.SelectedTypeId &lt;= 0)
                        {
                            return Task.FromResult(new Model_WorkflowStepResult { IsSuccess = false, ErrorMessage = &quot;Please select a dunnage type.&quot; });
                        }
                        GoToStep(Enum_DunnageWorkflowStep.PartSelection);
                        break;

                    case Enum_DunnageWorkflowStep.PartSelection:
                        if (CurrentSession.SelectedPart == null)
                        {
                            return Task.FromResult(new Model_WorkflowStepResult { IsSuccess = false, ErrorMessage = &quot;Please select a part.&quot; });
                        }
                        GoToStep(Enum_DunnageWorkflowStep.QuantityEntry);
                        break;

                    case Enum_DunnageWorkflowStep.QuantityEntry:
                        if (CurrentSession.Quantity &lt;= 0)
                        {
                            return Task.FromResult(new Model_WorkflowStepResult { IsSuccess = false, ErrorMessage = &quot;Quantity must be greater than zero.&quot; });
                        }
                        GoToStep(Enum_DunnageWorkflowStep.DetailsEntry);
                        break;

                    case Enum_DunnageWorkflowStep.DetailsEntry:
                        // Add current load to session before advancing to Review
                        AddCurrentLoadToSession();
                        GoToStep(Enum_DunnageWorkflowStep.Review);
                        break;

                    case Enum_DunnageWorkflowStep.Review:
                        return Task.FromResult(new Model_WorkflowStepResult { IsSuccess = false, ErrorMessage = &quot;Already at Review step. Use Save to finish.&quot; });
                }

                return Task.FromResult(new Model_WorkflowStepResult { IsSuccess = true, TargetStep = CurrentStep });
            }
            catch (Exception ex)
            {
                _errorHandler.HandleErrorAsync(&quot;Error advancing step&quot;, Enum_ErrorSeverity.Error, ex, true);
                return Task.FromResult(new Model_WorkflowStepResult { IsSuccess = false, ErrorMessage = ex.Message });
            }
        }

        public void GoToStep(Enum_DunnageWorkflowStep step)
        {
            CurrentStep = step;
            StepChanged?.Invoke(this, EventArgs.Empty);
        }

        public async Task&lt;Model_SaveResult&gt; SaveToCSVOnlyAsync()
        {
            try
            {
                var loads = new System.Collections.Generic.List&lt;Model_DunnageLoad&gt;(CurrentSession.Loads);

                // If no loads in list, try to create one from current session state
                if (loads.Count == 0)
                {
                    if (CurrentSession.SelectedPart != null &amp;&amp; CurrentSession.Quantity &gt; 0)
                    {
                        var load = CreateLoadFromCurrentSession();
                        loads.Add(load);
                    }
                    else
                    {
                        return new Model_SaveResult { IsSuccess = false, ErrorMessage = &quot;No data to save.&quot; };
                    }
                }

                var csvResult = await _csvWriter.WriteToCSVAsync(loads);

                return new Model_SaveResult
                {
                    IsSuccess = csvResult.LocalSuccess,
                    CSVExportResult = csvResult
                };
            }
            catch (Exception ex)
            {
                await _errorHandler.HandleErrorAsync(&quot;Error saving CSV&quot;, Enum_ErrorSeverity.Error, ex, true);
                return new Model_SaveResult { IsSuccess = false, ErrorMessage = ex.Message };
            }
        }

        public async Task&lt;Model_SaveResult&gt; SaveToDatabaseOnlyAsync()
        {
            try
            {
                var loads = new System.Collections.Generic.List&lt;Model_DunnageLoad&gt;(CurrentSession.Loads);

                if (loads.Count == 0)
                {
                    if (CurrentSession.SelectedPart != null &amp;&amp; CurrentSession.Quantity &gt; 0)
                    {
                        var load = CreateLoadFromCurrentSession();
                        loads.Add(load);
                    }
                    else
                    {
                        return new Model_SaveResult { IsSuccess = false, ErrorMessage = &quot;No data to save.&quot; };
                    }
                }

                var dbResult = await _dunnageService.SaveLoadsAsync(loads);

                return new Model_SaveResult
                {
                    IsSuccess = dbResult.IsSuccess,
                    ErrorMessage = dbResult.ErrorMessage,
                    RecordsSaved = dbResult.IsSuccess ? loads.Count : 0
                };
            }
            catch (Exception ex)
            {
                await _errorHandler.HandleErrorAsync(&quot;Error saving to database&quot;, Enum_ErrorSeverity.Error, ex, true);
                return new Model_SaveResult { IsSuccess = false, ErrorMessage = ex.Message };
            }
        }

        public async Task&lt;Model_SaveResult&gt; SaveSessionAsync()
        {
            try
            {
                // Save to DB
                var dbResult = await SaveToDatabaseOnlyAsync();
                if (!dbResult.IsSuccess)
                {
                    return dbResult;
                }

                // Export to CSV
                var csvResult = await SaveToCSVOnlyAsync();

                return new Model_SaveResult
                {
                    IsSuccess = true,
                    RecordsSaved = dbResult.RecordsSaved,
                    CSVExportResult = csvResult.CSVExportResult
                };
            }
            catch (Exception ex)
            {
                await _errorHandler.HandleErrorAsync(&quot;Error saving session&quot;, Enum_ErrorSeverity.Error, ex, true);
                return new Model_SaveResult { IsSuccess = false, ErrorMessage = ex.Message };
            }
        }

        public void ClearSession()
        {
            CurrentSession = new Model_DunnageSession();
            _viewModelRegistry.ClearAllInputs();
            StatusMessageRaised?.Invoke(this, &quot;Session cleared&quot;);
        }

        public async Task&lt;Model_CSVDeleteResult&gt; ResetCSVFilesAsync()
        {
            return await _csvWriter.ClearCSVFilesAsync();
        }

        public void AddCurrentLoadToSession()
        {
            try
            {
                if (CurrentSession.SelectedPart != null &amp;&amp; CurrentSession.Quantity &gt; 0)
                {
                    // Default location to part&apos;s home location if not specified
                    var location = string.IsNullOrWhiteSpace(CurrentSession.Location)
                        ? CurrentSession.SelectedPart.HomeLocation
                        : CurrentSession.Location;

                    // Default PO number if not specified
                    var poNumber = string.IsNullOrWhiteSpace(CurrentSession.PONumber)
                        ? &quot;Nothing Entered&quot;
                        : CurrentSession.PONumber;

                    var load = new Model_DunnageLoad
                    {
                        LoadUuid = Guid.NewGuid(),
                        PartId = CurrentSession.SelectedPart.PartId,
                        Quantity = CurrentSession.Quantity,
                        PoNumber = poNumber,
                        Location = location,
                        TypeName = CurrentSession.SelectedTypeName,
                        TypeIcon = CurrentSession.SelectedType?.Icon ?? &quot;Help&quot;,
                        DunnageType = CurrentSession.SelectedTypeName,
                        TypeId = CurrentSession.SelectedTypeId,
                        Specs = CurrentSession.SpecValues ?? new Dictionary&lt;string, object&gt;(),
                        ReceivedDate = DateTime.Now,
                        CreatedBy = _sessionManager.CurrentSession?.User?.WindowsUsername ?? &quot;Unknown&quot;
                    };

                    CurrentSession.Loads.Add(load);
                    _logger.LogInfo($&quot;Added load to session: Part {load.PartId}, Qty {load.Quantity}&quot;, &quot;DunnageWorkflow&quot;);
                    StatusMessageRaised?.Invoke(this, $&quot;Added load to session&quot;);
                }
            }
            catch (Exception ex)
            {
                _errorHandler.HandleErrorAsync(&quot;Error adding load to session&quot;, Enum_ErrorSeverity.Medium, ex, false);
            }
        }

        private Model_DunnageLoad CreateLoadFromCurrentSession()
        {
            // Default location to part&apos;s home location if not specified
            var location = string.IsNullOrWhiteSpace(CurrentSession.Location)
                ? CurrentSession.SelectedPart?.HomeLocation
                : CurrentSession.Location;

            // Default PO number if not specified
            var poNumber = string.IsNullOrWhiteSpace(CurrentSession.PONumber)
                ? &quot;Nothing Entered&quot;
                : CurrentSession.PONumber;

            return new Model_DunnageLoad
            {
                LoadUuid = Guid.NewGuid(),
                PartId = CurrentSession.SelectedPart?.PartId ?? &quot;Unknown&quot;,
                Quantity = CurrentSession.Quantity,
                PoNumber = poNumber,
                Location = location,
                DunnageType = CurrentSession.SelectedTypeName,
                TypeName = CurrentSession.SelectedTypeName,
                TypeIcon = CurrentSession.SelectedType?.Icon ?? &quot;Help&quot;,
                TypeId = CurrentSession.SelectedTypeId,
                Specs = CurrentSession.SpecValues ?? new Dictionary&lt;string, object&gt;(),
                ReceivedDate = DateTime.Now,
                CreatedBy = _sessionManager.CurrentSession?.User?.WindowsUsername ?? &quot;Unknown&quot;
            };
        }
    }
}</file><file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_AddTypeDialogViewModel.cs">using System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Material.Icons;
using Microsoft.UI.Dispatching;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Add New Type Dialog with real-time validation and custom field preview
/// &lt;/summary&gt;
public partial class ViewModel_Dunnage_AddTypeDialog : ViewModel_Shared_Base
{
    #region Dependencies
    private readonly IService_MySQL_Dunnage _dunnageService;
    private readonly DispatcherQueue _dispatcherQueue;
    private DispatcherQueueTimer? _validationTimer;
    #endregion

    #region Observable Properties - Basic Information
    [ObservableProperty]
    private string _typeName = string.Empty;

    [ObservableProperty]
    private MaterialIconKind _selectedIcon = MaterialIconKind.PackageVariantClosed; // Default icon

    [ObservableProperty]
    private string _typeNameError = string.Empty;

    [ObservableProperty]
    private bool _showDuplicateWarning;

    [ObservableProperty]
    private string _duplicateTypeId = string.Empty;
    #endregion

    #region Observable Properties - Custom Fields
    [ObservableProperty]
    private ObservableCollection&lt;Model_CustomFieldDefinition&gt; _customFields = new();

    [ObservableProperty]
    private string _fieldName = string.Empty;

    [ObservableProperty]
    private string _fieldType = &quot;Text&quot;;

    [ObservableProperty]
    private bool _isFieldRequired;

    [ObservableProperty]
    private string _fieldNameError = string.Empty;

    [ObservableProperty]
    private int _fieldCharacterCount;

    [ObservableProperty]
    private bool _showFieldLimitWarning;

    [ObservableProperty]
    private bool _canAddField = true;

    [ObservableProperty]
    private Model_CustomFieldDefinition? _editingField;
    #endregion

    #region Observable Properties - Validation
    [ObservableProperty]
    private bool _canSave;
    #endregion

    #region Observable Properties - Icon Picker
    [ObservableProperty]
    private ObservableCollection&lt;Model_IconDefinition&gt; _recentlyUsedIcons = new();
    #endregion

    #region Constructor
    public ViewModel_Dunnage_AddTypeDialog(
        IService_MySQL_Dunnage dunnageService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger)
        : base(errorHandler, logger)
    {
        _dunnageService = dunnageService;
        _dispatcherQueue = DispatcherQueue.GetForCurrentThread();

        // Initialize validation timer
        _validationTimer = _dispatcherQueue.CreateTimer();
        _validationTimer.Interval = TimeSpan.FromMilliseconds(300);
        _validationTimer.Tick += OnValidationTimerTick;

        // Load recently used icons
        _ = LoadRecentlyUsedIconsAsync();
    }
    #endregion

    #region Commands - Save Type
    [RelayCommand]
    private async Task SaveTypeAsync()
    {
        if (IsBusy || !CanSave)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Saving type...&quot;;

            // Save type to database
            var typeResult = await _dunnageService.InsertTypeAsync(TypeName, SelectedIcon.ToString());
            if (!typeResult.IsSuccess)
            {
                await _errorHandler.ShowUserErrorAsync(typeResult.ErrorMessage, &quot;Save Failed&quot;, nameof(SaveTypeAsync));
                return;
            }

            // Save custom fields
            int typeId = typeResult.Data;
            foreach (var field in CustomFields)
            {
                var fieldResult = await _dunnageService.InsertCustomFieldAsync(typeId, field);
                if (!fieldResult.IsSuccess)
                {
                    await _errorHandler.ShowUserErrorAsync($&quot;Failed to save field &apos;{field.FieldName}&apos;: {fieldResult.ErrorMessage}&quot;,
                        &quot;Save Failed&quot;, nameof(SaveTypeAsync));
                    return;
                }
            }

            // Update recently used icons
            await _dunnageService.UpsertUserPreferenceAsync($&quot;RecentIcon_{SelectedIcon}&quot;, DateTime.Now.ToString(&quot;O&quot;));

            StatusMessage = &quot;Type saved successfully&quot;;
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(ex, Enum_ErrorSeverity.Medium,
                nameof(SaveTypeAsync), nameof(ViewModel_Dunnage_AddTypeDialog));
        }
        finally
        {
            IsBusy = false;
        }
    }
    #endregion

    #region Commands - Custom Fields
    [RelayCommand]
    private void AddField()
    {
        if (string.IsNullOrWhiteSpace(FieldName) || CustomFields.Count &gt;= 25)
        {
            return;
        }

        if (EditingField != null)
        {
            // Update existing field
            EditingField.FieldName = FieldName;
            EditingField.FieldType = FieldType;
            EditingField.IsRequired = IsFieldRequired;
            EditingField = null;
        }
        else
        {
            // Add new field
            var field = new Model_CustomFieldDefinition
            {
                FieldName = FieldName,
                FieldType = FieldType,
                IsRequired = IsFieldRequired,
                DisplayOrder = CustomFields.Count + 1
            };
            CustomFields.Add(field);
        }

        // Clear form
        FieldName = string.Empty;
        FieldType = &quot;Text&quot;;
        IsFieldRequired = false;

        // Update warnings and limits
        ShowFieldLimitWarning = CustomFields.Count &gt;= 10;
        CanAddField = CustomFields.Count &lt; 25;
        UpdateCanSave();
    }

    [RelayCommand]
    private void EditField(Model_CustomFieldDefinition field)
    {
        EditingField = field;
        FieldName = field.FieldName;
        FieldType = field.FieldType;
        IsFieldRequired = field.IsRequired;
    }

    [RelayCommand]
    private void DeleteField(Model_CustomFieldDefinition field)
    {
        CustomFields.Remove(field);

        // Update display order
        for (int i = 0; i &lt; CustomFields.Count; i++)
        {
            CustomFields[i].DisplayOrder = i + 1;
        }

        ShowFieldLimitWarning = CustomFields.Count &gt;= 10;
        CanAddField = CustomFields.Count &lt; 25;
        UpdateCanSave();
    }
    #endregion

    #region Validation Methods
    partial void OnTypeNameChanged(string value)
    {
        FieldCharacterCount = value.Length;
        _validationTimer?.Stop();
        _validationTimer?.Start();
    }

    partial void OnFieldNameChanged(string value)
    {
        FieldCharacterCount = value.Length;
        _validationTimer?.Stop();
        _validationTimer?.Start();
    }

    private void OnValidationTimerTick(object? sender, object e)
    {
        _validationTimer?.Stop();
        ValidateTypeName();
        ValidateFieldName();
        UpdateCanSave();
    }

    private async void ValidateTypeName()
    {
        TypeNameError = string.Empty;
        ShowDuplicateWarning = false;

        if (string.IsNullOrWhiteSpace(TypeName))
        {
            TypeNameError = &quot;Type name is required&quot;;
            return;
        }

        if (TypeName.Length &gt; 100)
        {
            TypeNameError = &quot;Type name cannot exceed 100 characters&quot;;
            return;
        }

        // Check for duplicate
        var result = await _dunnageService.CheckDuplicateTypeNameAsync(TypeName);
        if (result.IsSuccess &amp;&amp; result.Data &gt; 0)
        {
            ShowDuplicateWarning = true;
            DuplicateTypeId = result.Data.ToString();
        }
    }

    private void ValidateFieldName()
    {
        FieldNameError = string.Empty;

        if (string.IsNullOrWhiteSpace(FieldName))
        {
            return; // Don&apos;t show error if empty (only on add)
        }

        if (FieldName.Length &gt; 100)
        {
            FieldNameError = &quot;Field name cannot exceed 100 characters&quot;;
            return;
        }

        // Check for special characters
        if (FieldName.Any(c =&gt; &quot;&lt;&gt;{}[]|\\&quot;.Contains(c)))
        {
            FieldNameError = &quot;Field name cannot contain special characters: &lt; &gt; { } [ ] | \\&quot;;
            return;
        }

        // Check for duplicate field name
        if (CustomFields.Any(f =&gt; f.FieldName.Equals(FieldName, StringComparison.OrdinalIgnoreCase) &amp;&amp; f != EditingField))
        {
            FieldNameError = &quot;Field name must be unique&quot;;
            return;
        }
    }

    private void UpdateCanSave()
    {
        CanSave = !string.IsNullOrWhiteSpace(TypeName) &amp;&amp;
                  string.IsNullOrEmpty(TypeNameError) &amp;&amp;
                  TypeName.Length &lt;= 100;
    }
    #endregion

    #region Helper Methods
    private async Task LoadRecentlyUsedIconsAsync()
    {
        try
        {
            var result = await _dunnageService.GetRecentlyUsedIconsAsync(6);
            if (result.IsSuccess &amp;&amp; result.Data != null)
            {
                RecentlyUsedIcons.Clear();
                foreach (var icon in result.Data)
                {
                    RecentlyUsedIcons.Add(icon);
                }
            }
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Failed to load recently used icons: {ex.Message}&quot;);
        }
    }
    #endregion

    #region Drag-Drop Reordering
    public void OnDragItemsCompleted()
    {
        // Update DisplayOrder based on current position in collection
        for (int i = 0; i &lt; CustomFields.Count; i++)
        {
            CustomFields[i].DisplayOrder = i + 1;
        }
    }
    #endregion
}</file><file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_AdminMainViewModel.cs">using System;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Dunnage Admin Main Navigation Hub
/// Provides 4-section navigation: Types, Parts, Specs, Inventoried List
/// &lt;/summary&gt;
public partial class ViewModel_Dunnage_AdminMain : ViewModel_Shared_Base
{
    private readonly IService_DunnageAdminWorkflow _adminWorkflow;

    public ViewModel_Dunnage_AdminMain(
        IService_DunnageAdminWorkflow adminWorkflow,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger) : base(errorHandler, logger)
    {
        _adminWorkflow = adminWorkflow;

        // Subscribe to workflow events
        _adminWorkflow.SectionChanged += OnSectionChanged;
        _adminWorkflow.StatusMessageRaised += OnStatusMessageRaised;

        // Initialize to Hub view
        UpdateVisibility(Enum_DunnageAdminSection.Hub);
    }

    #region Observable Properties

    [ObservableProperty]
    private bool _isMainNavigationVisible = true;

    [ObservableProperty]
    private bool _isManageTypesVisible = false;

    [ObservableProperty]
    private bool _isManagePartsVisible = false;

    [ObservableProperty]
    private bool _isManageSpecsVisible = false;

    [ObservableProperty]
    private bool _isInventoriedListVisible = false;

    #endregion

    #region Navigation Commands

    /// &lt;summary&gt;
    /// Navigate to Dunnage Types Management
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task NavigateToManageTypesAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Opening Type Management...&quot;;

            await _adminWorkflow.NavigateToSectionAsync(Enum_DunnageAdminSection.Types);

            await _logger.LogInfoAsync(&quot;Navigated to Type Management&quot;, &quot;AdminMain&quot;);
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error navigating to Type Management&quot;,
                Enum_ErrorSeverity.Medium,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Navigate to Dunnage Specs Management
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task NavigateToManageSpecsAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Opening Spec Management...&quot;;

            await _adminWorkflow.NavigateToSectionAsync(Enum_DunnageAdminSection.Specs);

            await _logger.LogInfoAsync(&quot;Navigated to Spec Management&quot;, &quot;AdminMain&quot;);
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error navigating to Spec Management&quot;,
                Enum_ErrorSeverity.Medium,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Navigate to Dunnage Parts Management
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task NavigateToManagePartsAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Opening Part Management...&quot;;

            await _adminWorkflow.NavigateToSectionAsync(Enum_DunnageAdminSection.Parts);

            await _logger.LogInfoAsync(&quot;Navigated to Part Management&quot;, &quot;AdminMain&quot;);
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error navigating to Part Management&quot;,
                Enum_ErrorSeverity.Medium,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Navigate to Inventoried Dunnage List
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task NavigateToInventoriedListAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Opening Inventoried List...&quot;;

            await _adminWorkflow.NavigateToSectionAsync(Enum_DunnageAdminSection.InventoriedList);

            await _logger.LogInfoAsync(&quot;Navigated to Inventoried List&quot;, &quot;AdminMain&quot;);
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error navigating to Inventoried List&quot;,
                Enum_ErrorSeverity.Medium,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Return to main navigation hub (4-card view)
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task ReturnToMainNavigationAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Returning to main menu...&quot;;

            await _adminWorkflow.NavigateToHubAsync();

            await _logger.LogInfoAsync(&quot;Returned to main navigation hub&quot;, &quot;AdminMain&quot;);
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error returning to main navigation&quot;,
                Enum_ErrorSeverity.Medium,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    #endregion

    #region Event Handlers

    private void OnSectionChanged(object? sender, Enum_DunnageAdminSection section)
    {
        UpdateVisibility(section);
    }

    private void OnStatusMessageRaised(object? sender, string message)
    {
        StatusMessage = message;
    }

    #endregion

    #region Helper Methods

    /// &lt;summary&gt;
    /// Update visibility flags based on current section
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;section&quot;&gt;&lt;/param&gt;
    private void UpdateVisibility(Enum_DunnageAdminSection section)
    {
        IsMainNavigationVisible = section == Enum_DunnageAdminSection.Hub;
        IsManageTypesVisible = section == Enum_DunnageAdminSection.Types;
        IsManagePartsVisible = section == Enum_DunnageAdminSection.Parts;
        IsManageSpecsVisible = section == Enum_DunnageAdminSection.Specs;
        IsInventoriedListVisible = section == Enum_DunnageAdminSection.InventoriedList;
    }

    #endregion
}</file><file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_AdminTypesViewModel.cs">using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Material.Icons;
using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Settings.Interfaces;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Dunnage Type Management
/// Handles CRUD operations for dunnage_types table with impact analysis
/// &lt;/summary&gt;
public partial class ViewModel_Dunnage_AdminTypes : ViewModel_Shared_Base
{
    private readonly IService_MySQL_Dunnage _dunnageService;
    private readonly IService_DunnageAdminWorkflow _adminWorkflow;
    private readonly IService_Window _windowService;
    private readonly IService_Help _helpService;

    public ViewModel_Dunnage_AdminTypes(
        IService_MySQL_Dunnage dunnageService,
        IService_DunnageAdminWorkflow adminWorkflow,
        IService_Window windowService,
        IService_Help helpService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger) : base(errorHandler, logger)
    {
        _dunnageService = dunnageService;
        _adminWorkflow = adminWorkflow;
        _windowService = windowService;
        _helpService = helpService;
    }

    #region Observable Properties

    [ObservableProperty]
    private ObservableCollection&lt;Model_DunnageType&gt; _types = new();

    [ObservableProperty]
    private Model_DunnageType? _selectedType;

    [ObservableProperty]
    private bool _canEdit = false;

    [ObservableProperty]
    private bool _canDelete = false;

    #endregion

    #region Load Data

    /// &lt;summary&gt;
    /// Load all dunnage types from database
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task LoadTypesAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading types...&quot;;

            var result = await _dunnageService.GetAllTypesAsync();

            if (!result.Success)
            {
                await _errorHandler.HandleDaoErrorAsync(result, &quot;LoadTypesAsync&quot;, true);
                return;
            }

            Types.Clear();
            if (result.Data != null)
            {
                foreach (var type in result.Data)
                {
                    Types.Add(type);
                }
            }

            StatusMessage = $&quot;Loaded {Types.Count} types&quot;;
            await _logger.LogInfoAsync($&quot;Loaded {Types.Count} dunnage types&quot;, &quot;TypeManagement&quot;);
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error loading types&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    #endregion

    #region Add Type

    /// &lt;summary&gt;
    /// Show Add New Type dialog
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task ShowAddTypeAsync()
    {
        try
        {
            var dialog = new Module_Dunnage.Views.View_Dunnage_Dialog_Dunnage_AddTypeDialog
            {
                XamlRoot = _windowService.GetXamlRoot()
            };

            var result = await dialog.ShowAsync();

            if (result == ContentDialogResult.Primary)
            {
                StatusMessage = &quot;Type added successfully&quot;;
                await _logger.LogInfoAsync(&quot;New dunnage type added via Add Type Dialog&quot;, &quot;TypeManagement&quot;);

                // Reload types to show the new type
                await LoadTypesAsync();
            }
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error showing Add Type dialog&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
    }

    #endregion

    #region Edit Type

    /// &lt;summary&gt;
    /// Show edit dialog for selected type
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task ShowEditTypeAsync()
    {
        if (SelectedType == null)
        {
            return;
        }

        try
        {
            var editedType = new Model_DunnageType
            {
                Id = SelectedType.Id,
                DunnageType = SelectedType.DunnageType,
                Icon = SelectedType.Icon,
                DateAdded = SelectedType.DateAdded,
                AddedBy = SelectedType.AddedBy,
                LastModified = SelectedType.LastModified,
                ModifiedBy = SelectedType.ModifiedBy
            };

            var dialog = new ContentDialog
            {
                Title = &quot;Edit Dunnage Type&quot;,
                PrimaryButtonText = &quot;Save&quot;,
                CloseButtonText = &quot;Cancel&quot;,
                DefaultButton = ContentDialogButton.Primary,
                XamlRoot = _windowService.GetXamlRoot()
            };

            var stackPanel = new StackPanel { Spacing = 12 };

            var typeNameBox = new TextBox
            {
                Header = &quot;Type Name&quot;,
                Text = editedType.DunnageType,
                PlaceholderText = &quot;Enter type name&quot;
            };

            // Icon selector button
            var iconSelectorButton = new Button
            {
                HorizontalAlignment = HorizontalAlignment.Stretch,
                Padding = new Thickness(16, 12, 16, 12)
            };

            var iconButtonPanel = new StackPanel
            {
                Orientation = Orientation.Horizontal,
                Spacing = 12
            };

            var iconDisplay = new Material.Icons.WinUI3.MaterialIcon
            {
                Kind = editedType.IconKind,
                Width = 32,
                Height = 32,
                Foreground = (Microsoft.UI.Xaml.Media.Brush)Microsoft.UI.Xaml.Application.Current.Resources[&quot;AccentFillColorDefaultBrush&quot;]
            };

            var iconTextPanel = new StackPanel
            {
                VerticalAlignment = VerticalAlignment.Center
            };

            var iconLabel = new TextBlock
            {
                Text = &quot;Click to select icon&quot;,
                FontWeight = Microsoft.UI.Text.FontWeights.SemiBold
            };

            var iconName = new TextBlock
            {
                Text = editedType.Icon,
                FontSize = 12,
                Foreground = (Microsoft.UI.Xaml.Media.Brush)Microsoft.UI.Xaml.Application.Current.Resources[&quot;TextFillColorSecondaryBrush&quot;]
            };

            iconTextPanel.Children.Add(iconLabel);
            iconTextPanel.Children.Add(iconName);
            iconButtonPanel.Children.Add(iconDisplay);
            iconButtonPanel.Children.Add(iconTextPanel);
            iconSelectorButton.Content = iconButtonPanel;

            // Handle icon selection
            iconSelectorButton.Click += async (_, __) =&gt;
            {
                var iconSelector = new MTM_Receiving_Application.Module_Shared.Views.View_Shared_IconSelectorWindow();
                iconSelector.SetInitialSelection(editedType.IconKind);
                iconSelector.Activate();

                var selectedIcon = await iconSelector.WaitForSelectionAsync();
                if (selectedIcon.HasValue)
                {
                    editedType.Icon = selectedIcon.Value.ToString();
                    iconDisplay.Kind = selectedIcon.Value;
                    iconName.Text = selectedIcon.Value.ToString();
                }
            };

            var iconHeader = new TextBlock
            {
                Text = &quot;Icon&quot;,
                Margin = new Thickness(0, 8, 0, 0),
                FontWeight = Microsoft.UI.Text.FontWeights.SemiBold
            };

            stackPanel.Children.Add(typeNameBox);
            stackPanel.Children.Add(iconHeader);
            stackPanel.Children.Add(iconSelectorButton);
            dialog.Content = stackPanel;

            var result = await dialog.ShowAsync();

            if (result == ContentDialogResult.Primary)
            {
                editedType.DunnageType = typeNameBox.Text.Trim();
                // Icon is already set by the button click handler

                if (string.IsNullOrWhiteSpace(editedType.DunnageType))
                {
                    await _errorHandler.ShowUserErrorAsync(&quot;Type name is required&quot;, &quot;Validation Error&quot;, &quot;ShowEditTypeAsync&quot;);
                    return;
                }

                IsBusy = true;
                StatusMessage = &quot;Saving changes...&quot;;

                var updateResult = await _dunnageService.UpdateTypeAsync(editedType);

                if (!updateResult.Success)
                {
                    await _errorHandler.HandleDaoErrorAsync(updateResult, &quot;UpdateTypeAsync&quot;, true);
                    return;
                }

                StatusMessage = &quot;Type updated successfully&quot;;
                await _logger.LogInfoAsync($&quot;Updated type: {editedType.DunnageType}&quot;, &quot;TypeManagement&quot;);

                // Reload types
                await LoadTypesAsync();
            }
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error editing type&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    #endregion

    #region Delete Type

    /// &lt;summary&gt;
    /// Show delete confirmation dialog with impact analysis
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task ShowDeleteConfirmationAsync()
    {
        if (SelectedType == null)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Checking impact...&quot;;

            // Get impact counts
            var partCountResult = await _dunnageService.GetPartCountByTypeAsync(SelectedType.Id);
            var transactionCountResult = await _dunnageService.GetTransactionCountByTypeAsync(SelectedType.Id);

            if (!partCountResult.Success || !transactionCountResult.Success)
            {
                await _errorHandler.HandleDaoErrorAsync(
                    partCountResult.Success ? transactionCountResult : partCountResult,
                    &quot;GetImpactCounts&quot;,
                    true
                );
                return;
            }

            int partCount = partCountResult.Data;
            int transactionCount = transactionCountResult.Data;

            IsBusy = false;

            // Build impact message
            string impactMessage = $&quot;Type: {SelectedType.DunnageType}\n\n&quot;;
            impactMessage += $&quot;Parts using this type: {partCount}\n&quot;;
            impactMessage += $&quot;Transactions using this type: {transactionCount}\n\n&quot;;

            if (partCount &gt; 0 || transactionCount &gt; 0)
            {
                impactMessage += &quot;WARNING: This type is in use and cannot be deleted.&quot;;

                var warningDialog = new ContentDialog
                {
                    Title = &quot;Cannot Delete Type&quot;,
                    Content = impactMessage,
                    CloseButtonText = &quot;OK&quot;,
                    XamlRoot = _windowService.GetXamlRoot()
                };

                await warningDialog.ShowAsync();
                return;
            }

            // Require &quot;DELETE&quot; confirmation
            impactMessage += &quot;This type is not in use and can be deleted.\n\n&quot;;
            impactMessage += &quot;Type DELETE to confirm:&quot;;

            var confirmDialog = new ContentDialog
            {
                Title = &quot;Confirm Delete&quot;,
                PrimaryButtonText = &quot;Delete&quot;,
                CloseButtonText = &quot;Cancel&quot;,
                DefaultButton = ContentDialogButton.Close,
                XamlRoot = _windowService.GetXamlRoot()
            };

            var stackPanel = new StackPanel { Spacing = 12 };
            stackPanel.Children.Add(new TextBlock { Text = impactMessage, TextWrapping = Microsoft.UI.Xaml.TextWrapping.Wrap });

            var confirmBox = new TextBox
            {
                PlaceholderText = &quot;Type DELETE to confirm&quot;
            };
            stackPanel.Children.Add(confirmBox);

            confirmDialog.Content = stackPanel;

            var result = await confirmDialog.ShowAsync();

            if (result == ContentDialogResult.Primary &amp;&amp; confirmBox.Text == &quot;DELETE&quot;)
            {
                await DeleteTypeAsync();
            }
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error checking delete impact&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Delete the selected type (after confirmation)
    /// &lt;/summary&gt;
    private async Task DeleteTypeAsync()
    {
        if (SelectedType == null)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Deleting type...&quot;;

            var result = await _dunnageService.DeleteTypeAsync(SelectedType.Id);

            if (!result.Success)
            {
                await _errorHandler.HandleDaoErrorAsync(result, &quot;DeleteTypeAsync&quot;, true);
                return;
            }

            StatusMessage = &quot;Type deleted successfully&quot;;
            await _logger.LogInfoAsync($&quot;Deleted type: {SelectedType.DunnageType}&quot;, &quot;TypeManagement&quot;);

            // Reload types
            await LoadTypesAsync();
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error deleting type&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    #endregion

    #region Navigation

    /// &lt;summary&gt;
    /// Return to Admin Main Hub
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task ReturnToAdminHubAsync()
    {
        try
        {
            _logger.LogInfo(&quot;Returning to Settings Mode Selection from Admin Types&quot;);
            var settingsWorkflow = App.GetService&lt;IService_SettingsWorkflow&gt;();
            settingsWorkflow.GoBack();
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error navigating back&quot;,
                Enum_ErrorSeverity.Low,
                ex,
                false
            );
        }
    }

    #endregion

    #region Property Changed

    partial void OnSelectedTypeChanged(Model_DunnageType? value)
    {
        CanEdit = value != null;
        CanDelete = value != null;
    }

    #endregion

    #region Help Content Helpers

    /// &lt;summary&gt;
    /// Gets a tooltip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);

    #endregion
}</file><file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_EditModeViewModel.cs">using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using CsvHelper;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Dunnage Edit Mode (historical data editing)
/// &lt;/summary&gt;
public partial class ViewModel_Dunnage_EditMode : ViewModel_Shared_Base
{
    private readonly IService_MySQL_Dunnage _dunnageService;
    private readonly IService_Pagination _paginationService;
    private readonly IService_DunnageCSVWriter _csvWriter;
    private readonly IService_DunnageWorkflow _workflowService;
    private readonly IService_Window _windowService;
    private readonly IService_Help _helpService;

    private const int PAGE_SIZE = 50;

    public ViewModel_Dunnage_EditMode(
        IService_MySQL_Dunnage dunnageService,
        IService_Pagination paginationService,
        IService_DunnageCSVWriter csvWriter,
        IService_DunnageWorkflow workflowService,
        IService_Window windowService,
        IService_Help helpService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger) : base(errorHandler, logger)
    {
        _dunnageService = dunnageService;
        _paginationService = paginationService;
        _csvWriter = csvWriter;
        _workflowService = workflowService;
        _windowService = windowService;
        _helpService = helpService;

        // T166: Set page size to 50
        _paginationService.PageSize = PAGE_SIZE;

        // T167: Subscribe to PageChanged event
        _paginationService.PageChanged += OnPageChanged;

        // Set default date range (last 7 days)
        ToDate = DateTimeOffset.Now;
        FromDate = DateTimeOffset.Now.AddDays(-7);
    }

    #region Observable Properties

    [ObservableProperty]
    private ObservableCollection&lt;Model_DunnageLoad&gt; _filteredLoads = new();

    [ObservableProperty]
    private ObservableCollection&lt;Model_DunnageLoad&gt; _selectedLoads = new();

    [ObservableProperty]
    private DateTimeOffset? _fromDate;

    [ObservableProperty]
    private DateTimeOffset? _toDate;

    [ObservableProperty]
    private int _currentPage = 1;

    [ObservableProperty]
    private int _totalPages = 1;

    [ObservableProperty]
    private int _totalRecords = 0;

    [ObservableProperty]
    private bool _canSave = false;

    [ObservableProperty]
    private bool _canNavigate = false;

    private List&lt;Model_DunnageLoad&gt; _allLoads = new();

    // T164: Dynamic button text for date filters
    public string LastWeekButtonText =&gt; $&quot;Last Week ({DateTime.Now.Date.AddDays(-7):MMM d} - {DateTime.Now.Date:MMM d})&quot;;

    public string TodayButtonText =&gt; $&quot;Today ({DateTime.Now.Date:MMM d})&quot;;

    public string ThisWeekButtonText
    {
        get
        {
            var today = DateTime.Now.Date;
            var startOfWeek = today.AddDays(-(int)today.DayOfWeek + (int)DayOfWeek.Monday);
            if (startOfWeek &gt; today)
            {
                startOfWeek = startOfWeek.AddDays(-7);
            }

            return $&quot;This Week ({startOfWeek:MMM d} - {today:MMM d})&quot;;
        }
    }

    public string ThisMonthButtonText =&gt; $&quot;This Month ({DateTime.Now:MMMM yyyy})&quot;;

    public string ThisQuarterButtonText
    {
        get
        {
            var today = DateTime.Now.Date;
            var quarter = (today.Month - 1) / 3 + 1;
            var startMonth = (quarter - 1) * 3 + 1;
            var quarterStart = new DateTime(today.Year, startMonth, 1);
            return $&quot;This Quarter (Q{quarter} {today.Year})&quot;;
        }
    }

    #endregion

    #region Load Data Commands

    /// &lt;summary&gt;
    /// T151: Load data from current workflow session (unsaved loads in memory)
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task LoadFromCurrentMemoryAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading session data...&quot;;

            if (_workflowService.CurrentSession == null || _workflowService.CurrentSession.Loads.Count == 0)
            {
                // T156: Info message for empty session
                await _errorHandler.HandleErrorAsync(
                    &quot;No unsaved loads in session&quot;,
                    Enum_ErrorSeverity.Info,
                    null,
                    true
                );
                _allLoads = new List&lt;Model_DunnageLoad&gt;();
                StatusMessage = &quot;No data in session&quot;;
                _logger.LogInfo(&quot;No unsaved loads found in current session&quot;, &quot;EditMode&quot;);
                return;
            }

            _allLoads = _workflowService.CurrentSession.Loads.ToList();
            TotalRecords = _allLoads.Count;

            // Set pagination source
            _paginationService.SetSource(_allLoads);
            TotalPages = _paginationService.TotalPages;
            CurrentPage = _paginationService.CurrentPage;

            // Load first page
            LoadPage(1);

            CanNavigate = TotalPages &gt; 1;
            StatusMessage = $&quot;Loaded {TotalRecords} loads from session&quot;;

            _logger.LogInfo($&quot;Loaded {TotalRecords} loads from current session&quot;, &quot;EditMode&quot;);
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error loading session data&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// T152: Load data from most recent CSV export (Current Labels)
    /// T153: CSV parsing error handling with line number reporting
    /// T155: Error handling for missing CSV file
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task LoadFromCurrentLabelsAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading label data...&quot;;

            var username = Environment.UserName;
            var localPath = System.IO.Path.Combine(
                Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
                &quot;MTM_Receiving_Application&quot;,
                &quot;DunnageData.csv&quot;
            );

            // T155: Check if file exists
            if (!System.IO.File.Exists(localPath))
            {
                await _errorHandler.HandleErrorAsync(
                    &quot;No label file found for current user&quot;,
                    Enum_ErrorSeverity.Warning,
                    null,
                    true
                );
                _allLoads = new List&lt;Model_DunnageLoad&gt;();
                StatusMessage = &quot;No label file found&quot;;
                _logger.LogWarning($&quot;CSV file not found at {localPath}&quot;, &quot;EditMode&quot;);
                return;
            }

            // T152: Parse CSV using CsvHelper
            using var reader = new System.IO.StreamReader(localPath);
            using var csv = new CsvHelper.CsvReader(reader, System.Globalization.CultureInfo.InvariantCulture);

            var loadsList = new List&lt;Model_DunnageLoad&gt;();
            int lineNumber = 1; // Start at 1 (header is line 0)

            try
            {
                csv.Read();
                csv.ReadHeader();

                while (csv.Read())
                {
                    lineNumber++;
                    try
                    {
                        var load = new Model_DunnageLoad
                        {
                            TypeName = csv.GetField&lt;string&gt;(&quot;Type&quot;) ?? string.Empty,
                            PartId = csv.GetField&lt;string&gt;(&quot;PartID&quot;) ?? string.Empty,
                            Quantity = csv.GetField&lt;decimal&gt;(&quot;Quantity&quot;),
                            PoNumber = csv.GetField&lt;string&gt;(&quot;PO&quot;) ?? string.Empty,
                            Location = csv.GetField&lt;string&gt;(&quot;Location&quot;) ?? string.Empty,
                            ReceivedDate = DateTime.TryParse(csv.GetField&lt;string&gt;(&quot;Date&quot;), out var date) ? date : DateTime.Now
                        };

                        loadsList.Add(load);
                    }
                    catch (Exception rowEx)
                    {
                        // T153: Line-specific error reporting
                        _logger.LogWarning($&quot;Failed to parse line {lineNumber}: {rowEx.Message}&quot;, &quot;EditMode&quot;);
                    }
                }
            }
            catch (Exception parseEx)
            {
                // T153: CSV parsing error with line number
                await _errorHandler.HandleErrorAsync(
                    $&quot;CSV parsing error at line {lineNumber}: {parseEx.Message}&quot;,
                    Enum_ErrorSeverity.Warning,
                    parseEx,
                    true
                );
                return;
            }

            _allLoads = loadsList;
            TotalRecords = _allLoads.Count;

            // Set pagination source
            _paginationService.SetSource(_allLoads);
            TotalPages = _paginationService.TotalPages;
            CurrentPage = _paginationService.CurrentPage;

            // Load first page
            LoadPage(1);

            CanNavigate = TotalPages &gt; 1;
            StatusMessage = $&quot;Loaded {TotalRecords} loads from labels&quot;;

            _logger.LogInfo($&quot;Loaded {TotalRecords} loads from CSV file&quot;, &quot;EditMode&quot;);
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error loading label data&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    [RelayCommand]
    private async Task LoadFromHistoryAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading historical data...&quot;;

            var startDate = FromDate?.DateTime ?? DateTime.Now.AddDays(-7);
            var endDate = ToDate?.DateTime ?? DateTime.Now;

            var result = await _dunnageService.GetLoadsByDateRangeAsync(startDate, endDate);

            if (!result.Success)
            {
                await _errorHandler.HandleDaoErrorAsync(result, &quot;LoadFromHistoryAsync&quot;, true);
                return;
            }

            _allLoads = result.Data ?? new List&lt;Model_DunnageLoad&gt;();
            TotalRecords = _allLoads.Count;

            // Set pagination source
            _paginationService.SetSource(_allLoads);
            TotalPages = _paginationService.TotalPages;
            CurrentPage = _paginationService.CurrentPage;

            // Load first page
            LoadPage(1);

            CanNavigate = TotalPages &gt; 1;
            StatusMessage = $&quot;Loaded {TotalRecords} records&quot;;

            _logger.LogInfo($&quot;Loaded {TotalRecords} historical loads from {startDate:d} to {endDate:d}&quot;, &quot;EditMode&quot;);
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error loading historical data&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;\n    /// Shows contextual help for edit mode\n    /// &lt;/summary&gt;\n    [RelayCommand]\n    private async Task ShowHelpAsync()\n    {\n        await _helpService.ShowHelpAsync(\&quot;Dunnage.EditMode\&quot;);\n    }

    /// &lt;summary&gt;
    /// T158: Set filter to last 7 days (today - 7 days to today)
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task SetFilterLastWeekAsync()
    {
        ToDate = DateTime.Now.Date;
        FromDate = DateTime.Now.Date.AddDays(-7);
        await LoadFromHistoryAsync();
    }

    /// &lt;summary&gt;
    /// T159: Set filter to today only (today 00:00 to today 23:59)
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task SetFilterTodayAsync()
    {
        FromDate = DateTime.Now.Date;
        ToDate = DateTime.Now.Date;
        await LoadFromHistoryAsync();
    }

    /// &lt;summary&gt;
    /// T160: Set filter to this week (Monday to Sunday of current week)
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task SetFilterThisWeekAsync()
    {
        var today = DateTime.Now.Date;
        var startOfWeek = today.AddDays(-(int)today.DayOfWeek + (int)DayOfWeek.Monday);
        if (startOfWeek &gt; today) // If today is Sunday
        {
            startOfWeek = startOfWeek.AddDays(-7);
        }
        FromDate = startOfWeek;
        ToDate = today;
        await LoadFromHistoryAsync();
    }

    /// &lt;summary&gt;
    /// T161: Set filter to this month (first to last day of current month)
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task SetFilterThisMonthAsync()
    {
        var today = DateTime.Now.Date;
        FromDate = new DateTime(today.Year, today.Month, 1);
        ToDate = today;
        await LoadFromHistoryAsync();
    }

    /// &lt;summary&gt;
    /// T162: Set filter to this quarter (first to last day of current quarter)
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task SetFilterThisQuarterAsync()
    {
        var today = DateTime.Now.Date;
        var quarter = (today.Month - 1) / 3 + 1;
        var startMonth = (quarter - 1) * 3 + 1;
        FromDate = new DateTime(today.Year, startMonth, 1);
        ToDate = today;
        await LoadFromHistoryAsync();
    }

    /// &lt;summary&gt;
    /// T163: Clear date filters (show last year of data)
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task SetFilterShowAllAsync()
    {
        FromDate = DateTime.Now.Date.AddYears(-1);
        ToDate = DateTime.Now.Date;
        await LoadFromHistoryAsync();
    }

    [RelayCommand]
    private void SetDateRangeToday()
    {
        FromDate = DateTime.Now.Date;
        ToDate = DateTime.Now.Date;
    }

    [RelayCommand]
    private void SetDateRangeLastWeek()
    {
        ToDate = DateTime.Now.Date;
        FromDate = DateTime.Now.Date.AddDays(-7);
    }

    [RelayCommand]
    private void SetDateRangeLastMonth()
    {
        ToDate = DateTime.Now.Date;
        FromDate = DateTime.Now.Date.AddMonths(-1);
    }

    #endregion

    #region Pagination Commands

    [RelayCommand]
    private void FirstPage()
    {
        if (CurrentPage == 1)
        {
            return;
        }

        LoadPage(1);
    }

    [RelayCommand]
    private void PreviousPage()
    {
        if (CurrentPage &lt;= 1)
        {
            return;
        }

        LoadPage(CurrentPage - 1);
    }

    [RelayCommand]
    private void NextPage()
    {
        if (CurrentPage &gt;= TotalPages)
        {
            return;
        }

        LoadPage(CurrentPage + 1);
    }

    [RelayCommand]
    private void LastPage()
    {
        if (CurrentPage == TotalPages)
        {
            return;
        }

        LoadPage(TotalPages);
    }

    private void LoadPage(int pageNumber)
    {
        _paginationService.GoToPage(pageNumber);
        CurrentPage = _paginationService.CurrentPage;

        var pageLoads = _paginationService.GetCurrentPageItems&lt;Model_DunnageLoad&gt;();

        FilteredLoads.Clear();
        foreach (var load in pageLoads)
        {
            FilteredLoads.Add(load);
        }

        StatusMessage = $&quot;Page {CurrentPage} of {TotalPages}&quot;;
        _logger.LogInfo($&quot;Loaded page {CurrentPage} of {TotalPages}&quot;, &quot;EditMode&quot;);
    }

    #endregion

    #region Edit Commands

    [RelayCommand]
    private void SelectAll()
    {
        SelectedLoads.Clear();
        foreach (var load in FilteredLoads)
        {
            SelectedLoads.Add(load);
        }

        UpdateCanSave();
        _logger.LogInfo($&quot;Selected all {FilteredLoads.Count} loads on page&quot;, &quot;EditMode&quot;);
    }

    [RelayCommand]
    private void RemoveSelectedRows()
    {
        if (SelectedLoads.Count == 0)
        {
            return;
        }

        var loadsToRemove = SelectedLoads.ToList();

        foreach (var load in loadsToRemove)
        {
            FilteredLoads.Remove(load);
            _allLoads.Remove(load);
        }

        SelectedLoads.Clear();
        TotalRecords = _allLoads.Count;
        UpdateCanSave();

        _logger.LogInfo($&quot;Removed {loadsToRemove.Count} loads&quot;, &quot;EditMode&quot;);
    }

    #endregion

    #region Save Commands

    [RelayCommand]
    private async Task SaveAllAsync()
    {
        if (_allLoads.Count == 0)
        {
            return;
        }

        try
        {
            IsBusy = true;
            CanSave = false;
            StatusMessage = &quot;Saving changes...&quot;;

            // Validate all loads
            foreach (var load in _allLoads)
            {
                if (string.IsNullOrWhiteSpace(load.TypeName) || string.IsNullOrWhiteSpace(load.PartId))
                {
                    StatusMessage = &quot;All loads must have Type and Part ID&quot;;
                    return;
                }
            }

            // Save to database
            var saveResult = await _dunnageService.SaveLoadsAsync(_allLoads);

            if (!saveResult.Success)
            {
                await _errorHandler.HandleDaoErrorAsync(saveResult, &quot;SaveAllAsync&quot;, true);
                return;
            }

            // Export to CSV
            var csvResult = await _csvWriter.WriteToCSVAsync(_allLoads);

            if (!csvResult.LocalSuccess)
            {
                await _errorHandler.HandleErrorAsync(
                    csvResult.ErrorMessage ?? &quot;CSV export failed&quot;,
                    Enum_ErrorSeverity.Warning,
                    null,
                    true);
            }

            StatusMessage = $&quot;Successfully saved {_allLoads.Count} loads&quot;;
            _logger.LogInfo($&quot;Saved {_allLoads.Count} loads&quot;, &quot;EditMode&quot;);
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error saving loads&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
            CanSave = true;
        }
    }

    #endregion

    #region Navigation Commands

    [RelayCommand]
    private async Task ReturnToModeSelectionAsync()
    {
        var xamlRoot = _windowService.GetXamlRoot();
        if (xamlRoot == null)
        {
            _logger.LogError(&quot;Cannot show dialog: XamlRoot is null&quot;, null, &quot;EditMode&quot;);
            await _errorHandler.HandleErrorAsync(&quot;Unable to display dialog&quot;, Enum_ErrorSeverity.Error, null, true);
            return;
        }

        var dialog = new Microsoft.UI.Xaml.Controls.ContentDialog
        {
            Title = &quot;Change Mode?&quot;,
            Content = &quot;Returning to mode selection will clear all current work in progress. This cannot be undone. Are you sure?&quot;,
            PrimaryButtonText = &quot;Yes, Change Mode&quot;,
            CloseButtonText = &quot;Cancel&quot;,
            DefaultButton = Microsoft.UI.Xaml.Controls.ContentDialogButton.Close,
            XamlRoot = xamlRoot
        };

        var result = await dialog.ShowAsync().AsTask();
        if (result == Microsoft.UI.Xaml.Controls.ContentDialogResult.Primary)
        {
            try
            {
                _logger.LogInfo(&quot;User confirmed return to mode selection, clearing data&quot;, &quot;EditMode&quot;);
                FilteredLoads.Clear();
                _allLoads.Clear();
                _workflowService.ClearSession();
                _workflowService.GoToStep(Enum_DunnageWorkflowStep.ModeSelection);
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Failed to return to mode selection: {ex.Message}&quot;, ex, &quot;EditMode&quot;);
                await _errorHandler.HandleErrorAsync(&quot;Failed to return to mode selection&quot;, Enum_ErrorSeverity.Error, ex, true);
            }
        }
        else
        {
            _logger.LogInfo(&quot;User cancelled return to mode selection&quot;, &quot;EditMode&quot;);
        }
    }

    #endregion

    #region Helper Methods

    /// &lt;summary&gt;
    /// T167: Event handler for pagination service PageChanged event
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
    private void OnPageChanged(object? sender, EventArgs e)
    {
        // Update FilteredLoads with current page items
        var pageLoads = _paginationService.GetCurrentPageItems&lt;Model_DunnageLoad&gt;();

        FilteredLoads.Clear();
        foreach (var load in pageLoads)
        {
            FilteredLoads.Add(load);
        }

        CurrentPage = _paginationService.CurrentPage;
        TotalPages = _paginationService.TotalPages;
        StatusMessage = $&quot;Page {CurrentPage} of {TotalPages}&quot;;

        _logger.LogInfo($&quot;Page changed to {CurrentPage} of {TotalPages}&quot;, &quot;EditMode&quot;);
    }

    private void UpdateCanSave()
    {
        CanSave = _allLoads.Any(l =&gt; !string.IsNullOrWhiteSpace(l.TypeName) || !string.IsNullOrWhiteSpace(l.PartId));
    }

    #endregion

    #region Help Content Helpers

    /// &lt;summary&gt;
    /// Gets a tooltip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);

    /// &lt;summary&gt;
    /// Gets a placeholder by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);

    /// &lt;summary&gt;
    /// Gets a tip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTip(string key) =&gt; _helpService.GetTip(key);

    #endregion
}</file><file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_QuantityEntryViewModel.cs">using System;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Material.Icons;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Dunnage Quantity Entry
/// &lt;/summary&gt;
public partial class ViewModel_Dunnage_QuantityEntry : ViewModel_Shared_Base
{
    private readonly IService_DunnageWorkflow _workflowService;
    private readonly IService_Dispatcher _dispatcher;
    private readonly IService_Help _helpService;

    public ViewModel_Dunnage_QuantityEntry(
        IService_DunnageWorkflow workflowService,
        IService_Dispatcher dispatcher,
        IService_Help helpService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger) : base(errorHandler, logger)
    {
        _workflowService = workflowService;
        _dispatcher = dispatcher;
        _helpService = helpService;

        // Subscribe to workflow step changes to re-initialize when this step is reached
        _workflowService.StepChanged += OnWorkflowStepChanged;
    }

    private void OnWorkflowStepChanged(object? sender, EventArgs e)
    {
        if (_workflowService.CurrentStep == Enum_DunnageWorkflowStep.QuantityEntry)
        {
            _dispatcher.TryEnqueue(LoadContextData);
        }
    }

    #region Observable Properties

    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(IsValid))]
    private int _quantity = 1;

    [ObservableProperty]
    private string _selectedTypeName = string.Empty;

    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(SelectedTypeIconKind))]
    private string _selectedTypeIcon = &quot;Help&quot;;

    /// &lt;summary&gt;
    /// Gets the MaterialIconKind for the selected type
    /// &lt;/summary&gt;
    public MaterialIconKind SelectedTypeIconKind
    {
        get
        {
            if (!string.IsNullOrEmpty(SelectedTypeIcon) &amp;&amp; Enum.TryParse&lt;MaterialIconKind&gt;(SelectedTypeIcon, true, out var kind))
            {
                return kind;
            }
            return MaterialIconKind.PackageVariantClosed;
        }
    }

    [ObservableProperty]
    private string _selectedPartName = string.Empty;

    [ObservableProperty]
    private string _validationMessage = string.Empty;

    /// &lt;summary&gt;
    /// Indicates if the quantity is valid
    /// &lt;/summary&gt;
    public bool IsValid =&gt; Quantity &gt; 0;

    #endregion

    #region Initialization

    /// &lt;summary&gt;
    /// Load context data from workflow session
    /// &lt;/summary&gt;
    public void LoadContextData()
    {
        try
        {
            SelectedTypeName = _workflowService.CurrentSession.SelectedTypeName ?? string.Empty;
            SelectedTypeIcon = _workflowService.CurrentSession.SelectedType?.Icon ?? &quot;Help&quot;;
            SelectedPartName = _workflowService.CurrentSession.SelectedPart?.PartId ?? string.Empty;

            // Initialize workflow session quantity with default value if not set
            if (_workflowService.CurrentSession.Quantity &lt;= 0)
            {
                _workflowService.CurrentSession.Quantity = Quantity;
                _logger.LogInfo($&quot;Initialized workflow session quantity to {Quantity}&quot;, &quot;QuantityEntry&quot;);
            }

            _logger.LogInfo($&quot;Loaded context: Type={SelectedTypeName}, Part={SelectedPartName}, Quantity={_workflowService.CurrentSession.Quantity}&quot;, &quot;QuantityEntry&quot;);
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error loading context data: {ex.Message}&quot;, ex, &quot;QuantityEntry&quot;);
        }
    }

    #endregion

    #region Validation

    partial void OnQuantityChanged(int value)
    {
        // Update workflow session immediately
        _workflowService.CurrentSession.Quantity = value;
        _logger.LogInfo($&quot;Quantity changed to {value}, updated workflow session&quot;, &quot;QuantityEntry&quot;);

        ValidateQuantity();
        GoNextCommand.NotifyCanExecuteChanged();
    }

    private void ValidateQuantity()
    {
        if (Quantity &lt;= 0)
        {
            ValidationMessage = &quot;Quantity must be greater than 0&quot;;
        }
        else
        {
            ValidationMessage = string.Empty;
        }
    }

    /// &lt;summary&gt;\n    /// Shows contextual help for quantity entry\n    /// &lt;/summary&gt;\n    [RelayCommand]\n    private async Task ShowHelpAsync()\n    {\n        await _helpService.ShowHelpAsync(\&quot;Dunnage.QuantityEntry\&quot;);\n    }

    #endregion

    #region Navigation Commands

    [RelayCommand]
    private void GoBack()
    {
        _logger.LogInfo(&quot;Navigating back to Part Selection&quot;, &quot;QuantityEntry&quot;);
        _workflowService.GoToStep(Enum_DunnageWorkflowStep.PartSelection);
    }

    [RelayCommand(CanExecute = nameof(IsValid))]
    private async Task GoNextAsync()
    {
        if (!IsValid || IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Saving quantity...&quot;;

            // Set quantity in workflow session
            _workflowService.CurrentSession.Quantity = Quantity;

            _logger.LogInfo($&quot;Quantity set to {Quantity}&quot;, &quot;QuantityEntry&quot;);

            // Navigate to Details Entry
            _workflowService.GoToStep(Enum_DunnageWorkflowStep.DetailsEntry);
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error saving quantity&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    #endregion

    #region Help Content Helpers

    /// &lt;summary&gt;
    /// Gets a tooltip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);

    /// &lt;summary&gt;
    /// Gets a placeholder by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);

    /// &lt;summary&gt;
    /// Gets a tip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTip(string key) =&gt; _helpService.GetTip(key);

    #endregion
}</file><file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_TypeSelectionViewModel.cs">using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Text.Json;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using MTM_Receiving_Application.Module_Core.Contracts.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Dunnage Type Selection with 3x3 paginated grid
/// &lt;/summary&gt;
public partial class ViewModel_dunnage_typeselection : ViewModel_Shared_Base, IResettableViewModel
{
    private readonly IService_DunnageWorkflow _workflowService;
    private readonly IService_MySQL_Dunnage _dunnageService;
    private readonly IService_Pagination _paginationService;
    private readonly IService_Help _helpService;
    private readonly IService_ViewModelRegistry _viewModelRegistry;

    public ViewModel_dunnage_typeselection(
        IService_DunnageWorkflow workflowService,
        IService_MySQL_Dunnage dunnageService,
        IService_Pagination paginationService,
        IService_Help helpService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger,
        IService_ViewModelRegistry viewModelRegistry) : base(errorHandler, logger)
    {
        _workflowService = workflowService;
        _dunnageService = dunnageService;
        _paginationService = paginationService;
        _helpService = helpService;
        _viewModelRegistry = viewModelRegistry;

        // Subscribe to pagination events
        _paginationService.PageChanged += OnPageChanged;

        _viewModelRegistry.Register(this);
    }

    public void ResetToDefaults()
    {
        SelectedType = null;
        _paginationService?.FirstPage();
    }

    #region Observable Properties

    [ObservableProperty]
    private ObservableCollection&lt;Model_DunnageType&gt; _displayedTypes = new();

    [ObservableProperty]
    private Model_DunnageType? _selectedType;

    [ObservableProperty]
    private int _currentPage = 1;

    [ObservableProperty]
    private int _totalPages = 1;

    [ObservableProperty]
    private bool _canGoNext;

    [ObservableProperty]
    private bool _canGoPrevious;

    [ObservableProperty]
    private string _pageInfo = &quot;Page 1 of 1&quot;;

    #endregion

    #region Initialization

    /// &lt;summary&gt;
    /// Load dunnage types and initialize pagination
    /// &lt;/summary&gt;
    public async Task InitializeAsync()
    {
        _logger.LogInfo(&quot;TypeSelection: InitializeAsync called&quot;, &quot;ViewModel_dunnage_typeselection&quot;);

        if (IsBusy)
        {
            _logger.LogInfo(&quot;TypeSelection: Already busy, returning&quot;, &quot;ViewModel_dunnage_typeselection&quot;);
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading dunnage types...&quot;;
            _logger.LogInfo(&quot;TypeSelection: Starting to load types&quot;, &quot;ViewModel_dunnage_typeselection&quot;);

            await LoadTypesAsync();

            StatusMessage = $&quot;Loaded {_paginationService.TotalItems} dunnage types&quot;;
        }
        catch (Exception ex)
        {
            _errorHandler.HandleErrorAsync(
                &quot;Failed to load dunnage types&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            ).Wait();
            StatusMessage = &quot;Error loading types&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }

    #endregion

    #region Load Data Commands

    [RelayCommand]
    private async Task LoadTypesAsync()
    {
        _logger.LogInfo(&quot;TypeSelection: LoadTypesAsync called&quot;, &quot;ViewModel_dunnage_typeselection&quot;);

        try
        {
            _logger.LogInfo(&quot;TypeSelection: Calling service.GetAllTypesAsync()&quot;, &quot;ViewModel_dunnage_typeselection&quot;);

            var result = await _dunnageService.GetAllTypesAsync();

            _logger.LogInfo($&quot;TypeSelection: Service returned - IsSuccess: {result.IsSuccess}, Data null: {result.Data == null}, Count: {result.Data?.Count ?? 0}&quot;, &quot;ViewModel_dunnage_typeselection&quot;);

            if (result.IsSuccess &amp;&amp; result.Data != null)
            {
                // Configure pagination for 3x3 grid (9 items per page)
                _paginationService.PageSize = 9;
                _paginationService.SetSource(result.Data);
                _logger.LogInfo($&quot;TypeSelection: Pagination configured with PageSize=9, TotalItems={result.Data.Count}&quot;, &quot;ViewModel_dunnage_typeselection&quot;);

                UpdatePaginationProperties();
                UpdatePageDisplay();

                _logger.LogInfo($&quot;TypeSelection: Successfully loaded {result.Data.Count} dunnage types with {TotalPages} pages, DisplayedTypes.Count={DisplayedTypes.Count}&quot;, &quot;ViewModel_dunnage_typeselection&quot;);
            }
            else
            {
                await _errorHandler.HandleDaoErrorAsync(
                    result,
                    nameof(LoadTypesAsync),
                    true
                );
            }
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error loading dunnage types&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
    }

    #endregion

    #region Pagination Commands

    [RelayCommand(CanExecute = nameof(CanGoNext))]
    private void NextPage()
    {
        _paginationService.NextPage();
    }

    [RelayCommand(CanExecute = nameof(CanGoPrevious))]
    private void PreviousPage()
    {
        _paginationService.PreviousPage();
    }

    [RelayCommand]
    private void FirstPage()
    {
        _paginationService.FirstPage();
    }

    [RelayCommand]
    private void LastPage()
    {
        _paginationService.LastPage();
    }

    #endregion

    #region Type Selection Commands

    [RelayCommand]
    private async Task SelectTypeAsync(Model_DunnageType? type)
    {
        if (type == null || IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            SelectedType = type;

            _logger.LogInfo($&quot;TypeSelection: Selected dunnage type: {type.TypeName} (ID: {type.Id})&quot;, &quot;TypeSelection&quot;);

            // Set in workflow session
            _workflowService.CurrentSession.SelectedType = type;
            _workflowService.CurrentSession.SelectedTypeId = type.Id;
            _workflowService.CurrentSession.SelectedTypeName = type.TypeName;

            _logger.LogInfo($&quot;TypeSelection: Session updated - SelectedTypeId={_workflowService.CurrentSession.SelectedTypeId}&quot;, &quot;TypeSelection&quot;);

            // Navigate to part selection
            _logger.LogInfo(&quot;TypeSelection: Navigating to PartSelection step&quot;, &quot;TypeSelection&quot;);
            _workflowService.GoToStep(Enum_DunnageWorkflowStep.PartSelection);
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;TypeSelection: Error selecting type: {ex.Message}&quot;, ex, &quot;TypeSelection&quot;);
            await _errorHandler.HandleErrorAsync(
                &quot;Error selecting dunnage type&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
        }
    }

    [RelayCommand]
    private async Task QuickAddTypeAsync()
    {
        try
        {
            _logger.LogInfo(&quot;Quick Add Type requested&quot;, &quot;TypeSelection&quot;);

            // Show dialog
            var dialog = new Module_Dunnage.Views.View_Dunnage_QuickAddTypeDialog
            {
                XamlRoot = App.MainWindow?.Content?.XamlRoot
            };

            if (dialog.XamlRoot == null)
            {
                _logger.LogInfo(&quot;Cannot show dialog: XamlRoot is null&quot;, &quot;TypeSelection&quot;);
                return;
            }

            var result = await dialog.ShowAsync();

            if (result == Microsoft.UI.Xaml.Controls.ContentDialogResult.Primary)
            {
                var typeName = dialog.TypeName;
                var iconName = dialog.SelectedIconKind.ToString();

                _logger.LogInfo($&quot;Adding new type: {typeName} with icon {iconName}&quot;, &quot;TypeSelection&quot;);

                // Insert new type
                var newType = new Model_DunnageType
                {
                    TypeName = typeName,
                    Icon = iconName
                    // Note: Icon storage would need to be added to database schema
                };

                var insertResult = await _dunnageService.InsertTypeAsync(newType);

                if (insertResult.IsSuccess)
                {
                    _logger.LogInfo($&quot;Successfully added type: {typeName}&quot;, &quot;TypeSelection&quot;);

                    // Insert specs
                    foreach (var specItem in dialog.Specs)
                    {
                        var specDef = new SpecDefinition
                        {
                            DataType = specItem.DataType,
                            Required = specItem.IsRequired,
                            Unit = specItem.Unit,
                            MinValue = specItem.MinValue,
                            MaxValue = specItem.MaxValue
                        };

                        var specModel = new Model_DunnageSpec
                        {
                            TypeId = newType.Id,
                            SpecKey = specItem.Name,
                            SpecValue = JsonSerializer.Serialize(specDef)
                        };
                        await _dunnageService.InsertSpecAsync(specModel);
                    }

                    // Reload types to show new type
                    await LoadTypesAsync();

                    StatusMessage = $&quot;Added new type: {typeName}&quot;;
                }
                else
                {
                    await _errorHandler.HandleDaoErrorAsync(
                        insertResult,
                        nameof(QuickAddTypeAsync),
                        true
                    );
                }
            }
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Error adding new dunnage type&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
    }

    [RelayCommand]
    private async Task EditTypeAsync(Model_DunnageType type)
    {
        if (type == null)
        {
            return;
        }

        try
        {
            _logger.LogInfo($&quot;Edit Type requested for {type.TypeName}&quot;, &quot;TypeSelection&quot;);

            var dialog = new Module_Dunnage.Views.View_Dunnage_QuickAddTypeDialog
            {
                XamlRoot = App.MainWindow?.Content?.XamlRoot
            };

            if (dialog.XamlRoot == null)
            {
                return;
            }

            // Load existing specs
            var specsResult = await _dunnageService.GetSpecsForTypeAsync(type.Id);
            var existingSpecsDict = new Dictionary&lt;string, SpecDefinition&gt;();

            if (specsResult.IsSuccess &amp;&amp; specsResult.Data != null)
            {
                foreach (var s in specsResult.Data)
                {
                    try
                    {
                        var def = JsonSerializer.Deserialize&lt;SpecDefinition&gt;(s.SpecValue);
                        if (def != null)
                        {
                            existingSpecsDict[s.SpecKey] = def;
                        }
                        else
                        {
                            existingSpecsDict[s.SpecKey] = new SpecDefinition(); // Fallback
                        }
                    }
                    catch
                    {
                        existingSpecsDict[s.SpecKey] = new SpecDefinition(); // Fallback for empty/invalid JSON
                    }
                }
            }

            dialog.InitializeForEdit(type.TypeName, type.Icon, existingSpecsDict);

            var result = await dialog.ShowAsync();

            if (result == Microsoft.UI.Xaml.Controls.ContentDialogResult.Primary)
            {
                var newName = dialog.TypeName;
                var newIcon = dialog.SelectedIconKind.ToString();
                var newSpecs = dialog.Specs; // Collection of SpecItem

                // Update Type info
                if (newName != type.TypeName || newIcon != type.Icon)
                {
                    type.TypeName = newName;
                    type.Icon = newIcon;

                    var updateResult = await _dunnageService.UpdateTypeAsync(type);
                    if (!updateResult.IsSuccess)
                    {
                        await _errorHandler.HandleDaoErrorAsync(updateResult, nameof(EditTypeAsync), true);
                        return;
                    }
                }

                // Update Specs
                // 1. Find removed specs
                var newSpecNames = newSpecs.Select(s =&gt; s.Name).ToList();
                var removedSpecKeys = existingSpecsDict.Keys.Except(newSpecNames).ToList();

                foreach (var specKey in removedSpecKeys)
                {
                    var specToDelete = specsResult.Data?.FirstOrDefault(s =&gt; s.SpecKey == specKey);
                    if (specToDelete != null)
                    {
                        await _dunnageService.DeleteSpecAsync(specToDelete.Id);
                    }
                }

                // 2. Find added or updated specs
                foreach (var specItem in newSpecs)
                {
                    var specDef = new SpecDefinition
                    {
                        DataType = specItem.DataType,
                        Required = specItem.IsRequired,
                        Unit = specItem.Unit,
                        MinValue = specItem.MinValue,
                        MaxValue = specItem.MaxValue
                    };
                    var json = JsonSerializer.Serialize(specDef);

                    if (existingSpecsDict.ContainsKey(specItem.Name))
                    {
                        // Update existing?
                        // We need to check if definition changed.
                        // For simplicity, we can just update the value if it&apos;s different.
                        var existingModel = specsResult.Data?.FirstOrDefault(s =&gt; s.SpecKey == specItem.Name);
                        if (existingModel != null &amp;&amp; existingModel.SpecValue != json)
                        {
                            existingModel.SpecValue = json;
                            await _dunnageService.UpdateSpecAsync(existingModel);
                        }
                    }
                    else
                    {
                        // Insert new
                        var specModel = new Model_DunnageSpec
                        {
                            TypeId = type.Id,
                            SpecKey = specItem.Name,
                            SpecValue = json
                        };
                        await _dunnageService.InsertSpecAsync(specModel);
                    }
                }

                _logger.LogInfo($&quot;Successfully updated type: {type.TypeName}&quot;, &quot;TypeSelection&quot;);
                await LoadTypesAsync();
                StatusMessage = $&quot;Updated type: {type.TypeName}&quot;;
            }
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(&quot;Error updating dunnage type&quot;, Enum_ErrorSeverity.Error, ex, true);
        }
    }

    [RelayCommand]
    private async Task DeleteTypeAsync(Model_DunnageType type)
    {
        if (type == null)
        {
            return;
        }

        try
        {
            _logger.LogInfo($&quot;Delete Type requested for {type.TypeName}&quot;, &quot;TypeSelection&quot;);

            var dialog = new Microsoft.UI.Xaml.Controls.ContentDialog
            {
                XamlRoot = App.MainWindow?.Content?.XamlRoot,
                Title = &quot;Delete Dunnage Type&quot;,
                Content = $&quot;Are you sure you want to delete &apos;{type.TypeName}&apos;? This action cannot be undone.&quot;,
                PrimaryButtonText = &quot;Delete&quot;,
                CloseButtonText = &quot;Cancel&quot;,
                DefaultButton = Microsoft.UI.Xaml.Controls.ContentDialogButton.Close
            };

            var result = await dialog.ShowAsync();

            if (result == Microsoft.UI.Xaml.Controls.ContentDialogResult.Primary)
            {
                var deleteResult = await _dunnageService.DeleteTypeAsync(type.Id);

                if (deleteResult.IsSuccess)
                {
                    _logger.LogInfo($&quot;Successfully deleted type: {type.TypeName}&quot;, &quot;TypeSelection&quot;);
                    await LoadTypesAsync();
                    StatusMessage = $&quot;Deleted type: {type.TypeName}&quot;;
                }
                else
                {
                    await _errorHandler.HandleDaoErrorAsync(deleteResult, nameof(DeleteTypeAsync), true);
                }
            }
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync(&quot;Error deleting dunnage type&quot;, Enum_ErrorSeverity.Error, ex, true);
        }
    }

    #endregion

    #region Helper Methods

    private void OnPageChanged(object? sender, EventArgs e)
    {
        UpdatePaginationProperties();
        UpdatePageDisplay();
    }

    private void UpdatePaginationProperties()
    {
        CurrentPage = _paginationService.CurrentPage;
        TotalPages = _paginationService.TotalPages;
        CanGoNext = _paginationService.HasNextPage;
        CanGoPrevious = _paginationService.HasPreviousPage;
        PageInfo = $&quot;Page {CurrentPage} of {TotalPages}&quot;;

        // Notify commands to update their CanExecute state
        NextPageCommand.NotifyCanExecuteChanged();
        PreviousPageCommand.NotifyCanExecuteChanged();
    }

    private void UpdatePageDisplay()
    {
        var currentItems = _paginationService.GetCurrentPageItems&lt;Model_DunnageType&gt;();
        _logger.LogInfo($&quot;TypeSelection: UpdatePageDisplay - Got {currentItems.Count()} items from pagination service&quot;, &quot;ViewModel_dunnage_typeselection&quot;);

        DisplayedTypes.Clear();
        foreach (var type in currentItems)
        {
            DisplayedTypes.Add(type);
            _logger.LogInfo($&quot;TypeSelection: Added type to DisplayedTypes - ID: {type.Id}, Name: {type.TypeName}&quot;, &quot;ViewModel_dunnage_typeselection&quot;);
        }

        _logger.LogInfo($&quot;TypeSelection: DisplayedTypes.Count after update: {DisplayedTypes.Count}&quot;, &quot;ViewModel_dunnage_typeselection&quot;);
    }

    #endregion

    #region Help Content Helpers

    /// &lt;summary&gt;
    /// Gets a tooltip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);

    /// &lt;summary&gt;
    /// Gets a placeholder by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);

    /// &lt;summary&gt;
    /// Gets a tip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTip(string key) =&gt; _helpService.GetTip(key);

    #endregion
}</file><file path="Module_Dunnage/Views/View_Dunnage_WorkflowView.xaml">&lt;Page x:Class=&quot;MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_WorkflowView&quot;
      xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
      xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
      xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
      xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
      xmlns:viewmodels=&quot;using:MTM_Receiving_Application.Module_Dunnage.ViewModels&quot;
      xmlns:views=&quot;using:MTM_Receiving_Application.Module_Dunnage.Views&quot;
      xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
      mc:Ignorable=&quot;d&quot;&gt;

    &lt;Page.Resources&gt;
        &lt;converters:Converter_BooleanToVisibility x:Key=&quot;BooleanToVisibilityConverter&quot; /&gt;
    &lt;/Page.Resources&gt;

    &lt;Grid&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot; /&gt;
            &lt;RowDefinition Height=&quot;*&quot; /&gt;
            &lt;RowDefinition Height=&quot;Auto&quot; /&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Content Area --&gt;
        &lt;Grid Grid.Row=&quot;1&quot;
              Margin=&quot;16,12,16,16&quot;&gt;
            &lt;!-- Mode Selection View --&gt;
            &lt;views:View_Dunnage_ModeSelectionView Visibility=&quot;{x:Bind ViewModel.IsModeSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot; /&gt;

            &lt;!-- Wizard Steps --&gt;
            &lt;views:View_dunnage_typeselectionView Visibility=&quot;{x:Bind ViewModel.IsTypeSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot; /&gt;

            &lt;views:View_Dunnage_PartSelectionView Visibility=&quot;{x:Bind ViewModel.IsPartSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot; /&gt;

            &lt;views:View_Dunnage_QuantityEntryView Visibility=&quot;{x:Bind ViewModel.IsQuantityEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot; /&gt;

            &lt;views:View_Dunnage_DetailsEntryView Visibility=&quot;{x:Bind ViewModel.IsDetailsEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot; /&gt;

            &lt;views:View_Dunnage_ReviewView Visibility=&quot;{x:Bind ViewModel.IsReviewVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot; /&gt;

            &lt;!-- Bulk Operation Views --&gt;
            &lt;views:View_Dunnage_ManualEntryView Visibility=&quot;{x:Bind ViewModel.IsManualEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot; /&gt;

            &lt;views:View_Dunnage_EditModeView Visibility=&quot;{x:Bind ViewModel.IsEditModeVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot; /&gt;
        &lt;/Grid&gt;

        &lt;!-- Navigation Buttons --&gt;
        &lt;Grid Grid.Row=&quot;2&quot;
              Margin=&quot;24&quot;&gt;
            &lt;Grid.ColumnDefinitions&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                &lt;ColumnDefinition Width=&quot;*&quot; /&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
            &lt;/Grid.ColumnDefinitions&gt;

            &lt;!-- Left-aligned buttons --&gt;
            &lt;StackPanel Grid.Column=&quot;0&quot;
                        Orientation=&quot;Horizontal&quot;
                        HorizontalAlignment=&quot;Left&quot;
                        Spacing=&quot;12&quot;&gt;
                &lt;!-- Mode Selection Button (visible in wizard steps) --&gt;
                &lt;Button Content=&quot;Mode Selection&quot;
                        Command=&quot;{x:Bind ViewModel.ReturnToModeSelectionCommand}&quot;
                        ToolTipService.ToolTip=&quot;Return to mode selection (clears current work)&quot;
                        Visibility=&quot;{x:Bind ViewModel.IsTypeSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot; /&gt;
                &lt;Button Content=&quot;Mode Selection&quot;
                        Command=&quot;{x:Bind ViewModel.ReturnToModeSelectionCommand}&quot;
                        ToolTipService.ToolTip=&quot;Return to mode selection (clears current work)&quot;
                        Visibility=&quot;{x:Bind ViewModel.IsPartSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot; /&gt;
                &lt;Button Content=&quot;Mode Selection&quot;
                        Command=&quot;{x:Bind ViewModel.ReturnToModeSelectionCommand}&quot;
                        ToolTipService.ToolTip=&quot;Return to mode selection (clears current work)&quot;
                        Visibility=&quot;{x:Bind ViewModel.IsQuantityEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot; /&gt;
                &lt;Button Content=&quot;Mode Selection&quot;
                        Command=&quot;{x:Bind ViewModel.ReturnToModeSelectionCommand}&quot;
                        ToolTipService.ToolTip=&quot;Return to mode selection (clears current work)&quot;
                        Visibility=&quot;{x:Bind ViewModel.IsDetailsEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot; /&gt;

                &lt;Button Content=&quot;Mode Selection&quot;
                        Command=&quot;{x:Bind ViewModel.ReturnToModeSelectionCommand}&quot;
                        ToolTipService.ToolTip=&quot;Return to mode selection (clears current work)&quot;
                        Visibility=&quot;{x:Bind ViewModel.IsManualEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot; /&gt;
                &lt;Button Content=&quot;Mode Selection&quot;
                        Command=&quot;{x:Bind ViewModel.ReturnToModeSelectionCommand}&quot;
                        ToolTipService.ToolTip=&quot;Return to mode selection (clears current work)&quot;
                        Visibility=&quot;{x:Bind ViewModel.IsEditModeVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot; /&gt;
            &lt;/StackPanel&gt;

            &lt;!-- Center help button --&gt;
            &lt;Button Grid.Column=&quot;1&quot;
                    HorizontalAlignment=&quot;Center&quot;
                    Style=&quot;{StaticResource AccentButtonStyle}&quot;
                    Padding=&quot;12,8&quot;
                    Click=&quot;HelpButton_Click&quot;
                    ToolTipService.ToolTip=&quot;Click for help about the current step&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot;
                            Spacing=&quot;8&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE946;&quot;
                              FontSize=&quot;16&quot; /&gt;
                    &lt;TextBlock Text=&quot;Help&quot; /&gt;
                &lt;/StackPanel&gt;
            &lt;/Button&gt;

            &lt;!-- Right-aligned navigation buttons (wizard flow) --&gt;
            &lt;StackPanel Grid.Column=&quot;2&quot;
                        Orientation=&quot;Horizontal&quot;
                        HorizontalAlignment=&quot;Right&quot;
                        Spacing=&quot;12&quot;&gt;
                &lt;!-- Back Button (not visible on first wizard step) --&gt;
                &lt;Button Content=&quot;Back&quot;
                        Visibility=&quot;{x:Bind ViewModel.IsPartSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;
                        Click=&quot;OnBackClick&quot;
                        ToolTipService.ToolTip=&quot;Go back to previous step (Ctrl+Left)&quot;&gt;
                    &lt;Button.KeyboardAccelerators&gt;
                        &lt;KeyboardAccelerator Key=&quot;Left&quot;
                                             Modifiers=&quot;Control&quot; /&gt;
                    &lt;/Button.KeyboardAccelerators&gt;
                &lt;/Button&gt;
                &lt;Button Content=&quot;Back&quot;
                        Visibility=&quot;{x:Bind ViewModel.IsQuantityEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;
                        Click=&quot;OnBackClick&quot;
                        ToolTipService.ToolTip=&quot;Go back to previous step (Ctrl+Left)&quot;&gt;
                    &lt;Button.KeyboardAccelerators&gt;
                        &lt;KeyboardAccelerator Key=&quot;Left&quot;
                                             Modifiers=&quot;Control&quot; /&gt;
                    &lt;/Button.KeyboardAccelerators&gt;
                &lt;/Button&gt;
                &lt;Button Content=&quot;Back&quot;
                        Visibility=&quot;{x:Bind ViewModel.IsDetailsEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;
                        Click=&quot;OnBackClick&quot;
                        ToolTipService.ToolTip=&quot;Go back to previous step (Ctrl+Left)&quot;&gt;
                    &lt;Button.KeyboardAccelerators&gt;
                        &lt;KeyboardAccelerator Key=&quot;Left&quot;
                                             Modifiers=&quot;Control&quot; /&gt;
                    &lt;/Button.KeyboardAccelerators&gt;
                &lt;/Button&gt;

                &lt;!-- Next Button (wizard flow) --&gt;
                &lt;Button Content=&quot;Next&quot;
                        Style=&quot;{StaticResource AccentButtonStyle}&quot;
                        Visibility=&quot;{x:Bind ViewModel.IsTypeSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;
                        Click=&quot;OnNextClick&quot;
                        ToolTipService.ToolTip=&quot;Proceed to next step (Ctrl+Right)&quot;&gt;
                    &lt;Button.KeyboardAccelerators&gt;
                        &lt;KeyboardAccelerator Key=&quot;Right&quot;
                                             Modifiers=&quot;Control&quot; /&gt;
                    &lt;/Button.KeyboardAccelerators&gt;
                &lt;/Button&gt;
                &lt;Button Content=&quot;Next&quot;
                        Style=&quot;{StaticResource AccentButtonStyle}&quot;
                        Visibility=&quot;{x:Bind ViewModel.IsPartSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;
                        Click=&quot;OnNextClick&quot;
                        ToolTipService.ToolTip=&quot;Proceed to next step (Ctrl+Right)&quot;&gt;
                    &lt;Button.KeyboardAccelerators&gt;
                        &lt;KeyboardAccelerator Key=&quot;Right&quot;
                                             Modifiers=&quot;Control&quot; /&gt;
                    &lt;/Button.KeyboardAccelerators&gt;
                &lt;/Button&gt;
                &lt;Button Content=&quot;Next&quot;
                        Style=&quot;{StaticResource AccentButtonStyle}&quot;
                        Visibility=&quot;{x:Bind ViewModel.IsQuantityEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;
                        Click=&quot;OnNextClick&quot;
                        ToolTipService.ToolTip=&quot;Proceed to next step (Ctrl+Right)&quot;&gt;
                    &lt;Button.KeyboardAccelerators&gt;
                        &lt;KeyboardAccelerator Key=&quot;Right&quot;
                                             Modifiers=&quot;Control&quot; /&gt;
                    &lt;/Button.KeyboardAccelerators&gt;
                &lt;/Button&gt;
                &lt;Button Content=&quot;Save &amp;amp; Review&quot;
                        Style=&quot;{StaticResource AccentButtonStyle}&quot;
                        Visibility=&quot;{x:Bind ViewModel.IsDetailsEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;
                        Click=&quot;OnSaveAndReviewClick&quot;
                        ToolTipService.ToolTip=&quot;Save entry and proceed to review (Ctrl+Right)&quot;&gt;
                    &lt;Button.KeyboardAccelerators&gt;
                        &lt;KeyboardAccelerator Key=&quot;Right&quot;
                                             Modifiers=&quot;Control&quot; /&gt;
                    &lt;/Button.KeyboardAccelerators&gt;
                &lt;/Button&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Receiving/Data/Dao_ReceivingLine.cs">using System;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Contracts.Services;

namespace MTM_Receiving_Application.Module_Receiving.Data;

/// &lt;summary&gt;
/// Data Access Object for receiving_label_data table
/// Provides CRUD operations using stored procedures
/// &lt;/summary&gt;
public class Dao_ReceivingLine
{
    private readonly string _connectionString;

    public Dao_ReceivingLine(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Inserts a new receiving line record into the database
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;line&quot;&gt;ReceivingLine model to insert&lt;/param&gt;
    /// &lt;returns&gt;Model_Dao_Result with success status and affected rows&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&gt; InsertReceivingLineAsync(Model_ReceivingLine line)
    {
        try
        {
            // Prepare stored procedure parameters
            var parameters = new MySqlParameter[]
            {
                new MySqlParameter(&quot;@p_Quantity&quot;, line.Quantity),
                new MySqlParameter(&quot;@p_PartID&quot;, line.PartID ?? string.Empty),
                new MySqlParameter(&quot;@p_PONumber&quot;, line.PONumber),
                new MySqlParameter(&quot;@p_EmployeeNumber&quot;, line.EmployeeNumber),
                new MySqlParameter(&quot;@p_Heat&quot;, line.Heat ?? string.Empty),
                new MySqlParameter(&quot;@p_Date&quot;, line.Date),
                new MySqlParameter(&quot;@p_InitialLocation&quot;, line.InitialLocation ?? string.Empty),
                new MySqlParameter(&quot;@p_CoilsOnSkid&quot;, (object?)line.CoilsOnSkid ?? DBNull.Value),
                new MySqlParameter(&quot;@p_VendorName&quot;, line.VendorName ?? &quot;Unknown&quot;),
                new MySqlParameter(&quot;@p_PartDescription&quot;, line.PartDescription ?? string.Empty),
                new MySqlParameter(&quot;@p_Status&quot;, MySqlDbType.Int32) { Direction = System.Data.ParameterDirection.Output },
                new MySqlParameter(&quot;@p_ErrorMsg&quot;, MySqlDbType.VarChar, 500) { Direction = System.Data.ParameterDirection.Output }
            };

            // Validate parameters
            if (!Helper_Database_StoredProcedure.ValidateParameters(parameters))
            {
                return new Model_Dao_Result
                {
                    Success = false,
                    ErrorMessage = &quot;Required parameters are missing or invalid&quot;,
                    Severity = Enum_ErrorSeverity.Warning
                };
            }

            // Execute stored procedure
            var result = await Helper_Database_StoredProcedure.ExecuteAsync(
                &quot;sp_Receiving_Line_Insert&quot;,
                parameters,
                _connectionString
            );

            return result;
        }
        catch (Exception ex)
        {
            return new Model_Dao_Result
            {
                Success = false,
                ErrorMessage = $&quot;Unexpected error inserting receiving line: {ex.Message}&quot;,
                Severity = Enum_ErrorSeverity.Error
            };
        }
    }
}</file><file path="Module_Receiving/Services/Service_ReceivingValidation.cs">using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.RegularExpressions;
using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Receiving.Services
{
    /// &lt;summary&gt;
    /// Service for validating receiving data and enforcing business rules.
    /// &lt;/summary&gt;
    public class Service_ReceivingValidation : IService_ReceivingValidation
    {
        private readonly IService_InforVisual _inforVisualService;
        private static readonly Regex _regex = new Regex(@&quot;^(PO-)?\d{1,6}$&quot;, RegexOptions.IgnoreCase);

        public Service_ReceivingValidation(IService_InforVisual inforVisualService)
        {
            _inforVisualService = inforVisualService ?? throw new ArgumentNullException(nameof(inforVisualService));
        }

        public Model_ReceivingValidationResult ValidatePONumber(string poNumber)
        {
            if (string.IsNullOrWhiteSpace(poNumber))
            {
                return Model_ReceivingValidationResult.Error(&quot;PO number is required&quot;);
            }

            // Allow optional &quot;PO-&quot; prefix followed by 1-6 digits
            if (!_regex.IsMatch(poNumber))
            {
                return Model_ReceivingValidationResult.Error(&quot;PO number must be numeric (up to 6 digits) or in PO-###### format&quot;);
            }

            return Model_ReceivingValidationResult.Success();
        }

        public Model_ReceivingValidationResult ValidatePartID(string partID)
        {
            if (string.IsNullOrWhiteSpace(partID))
            {
                return Model_ReceivingValidationResult.Error(&quot;Part ID is required&quot;);
            }

            if (partID.Length &gt; 50)
            {
                return Model_ReceivingValidationResult.Error(&quot;Part ID cannot exceed 50 characters&quot;);
            }

            return Model_ReceivingValidationResult.Success();
        }

        public Model_ReceivingValidationResult ValidateNumberOfLoads(int numLoads)
        {
            if (numLoads &lt; 1)
            {
                return Model_ReceivingValidationResult.Error(&quot;Number of loads must be at least 1&quot;);
            }

            if (numLoads &gt; 99)
            {
                return Model_ReceivingValidationResult.Error(&quot;Number of loads cannot exceed 99&quot;);
            }

            return Model_ReceivingValidationResult.Success();
        }

        public Model_ReceivingValidationResult ValidateWeightQuantity(decimal weightQuantity)
        {
            if (weightQuantity &lt;= 0)
            {
                return Model_ReceivingValidationResult.Error(&quot;Weight/Quantity must be greater than 0&quot;);
            }

            return Model_ReceivingValidationResult.Success();
        }

        public Model_ReceivingValidationResult ValidatePackageCount(int packagesPerLoad)
        {
            if (packagesPerLoad &lt;= 0)
            {
                return Model_ReceivingValidationResult.Error(&quot;Package count must be greater than 0&quot;);
            }

            return Model_ReceivingValidationResult.Success();
        }

        public Model_ReceivingValidationResult ValidateHeatLotNumber(string heatLotNumber)
        {
            if (string.IsNullOrWhiteSpace(heatLotNumber))
            {
                return Model_ReceivingValidationResult.Error(&quot;Heat/Lot number is required&quot;);
            }

            if (heatLotNumber.Length &gt; 50)
            {
                return Model_ReceivingValidationResult.Error(&quot;Heat/Lot number cannot exceed 50 characters&quot;);
            }

            return Model_ReceivingValidationResult.Success();
        }

        public Task&lt;Model_ReceivingValidationResult&gt; ValidateAgainstPOQuantityAsync(decimal totalQuantity, decimal orderedQuantity, string partID)
        {
            if (totalQuantity &gt; orderedQuantity)
            {
                return Task.FromResult(Model_ReceivingValidationResult.Warning(
                    $&quot;Total quantity ({totalQuantity:F2}) exceeds PO ordered quantity ({orderedQuantity:F2}) for part {partID}. Do you want to continue?&quot;));
            }

            return Task.FromResult(Model_ReceivingValidationResult.Success());
        }

        public async Task&lt;Model_ReceivingValidationResult&gt; CheckSameDayReceivingAsync(string poNumber, string partID, decimal userEnteredQuantity)
        {
            var result = await _inforVisualService.GetSameDayReceivingQuantityAsync(poNumber, partID, DateTime.Today);

            if (result.Success)
            {
                var sameDayQty = result.Data;
                if (sameDayQty &gt; 0)
                {
                    return Model_ReceivingValidationResult.Warning(
                        $&quot;Part {partID} was already received today. Visual shows {sameDayQty:F2} received. Your entry totals {userEnteredQuantity:F2}. Please verify.&quot;);
                }
            }

            // If check fails or returns 0, don&apos;t block - just skip the warning
            return Model_ReceivingValidationResult.Success();
        }

        public Model_ReceivingValidationResult ValidateReceivingLoad(Model_ReceivingLoad load)
        {
            var errors = new List&lt;string&gt;();

            if (string.IsNullOrWhiteSpace(load.PartID))
            {
                errors.Add(&quot;Part ID is required&quot;);
            }

            if (string.IsNullOrWhiteSpace(load.PartType))
            {
                errors.Add(&quot;Part Type is required&quot;);
            }

            if (load.LoadNumber &lt; 1)
            {
                errors.Add(&quot;Load number must be at least 1&quot;);
            }

            if (load.WeightQuantity &lt;= 0)
            {
                errors.Add($&quot;Load {load.LoadNumber}: Weight/Quantity must be greater than 0&quot;);
            }

            if (string.IsNullOrWhiteSpace(load.HeatLotNumber))
            {
                errors.Add($&quot;Load {load.LoadNumber}: Heat/Lot number is required&quot;);
            }

            if (load.PackagesPerLoad &lt;= 0)
            {
                errors.Add($&quot;Load {load.LoadNumber}: Package count must be greater than 0&quot;);
            }

            if (string.IsNullOrWhiteSpace(load.PackageTypeName))
            {
                errors.Add($&quot;Load {load.LoadNumber}: Package type is required&quot;);
            }

            if (errors.Count &gt; 0)
            {
                var result = Model_ReceivingValidationResult.Error(string.Join(&quot;; &quot;, errors));
                result.Errors = errors;
                return result;
            }

            return Model_ReceivingValidationResult.Success();
        }

        public Model_ReceivingValidationResult ValidateSession(List&lt;Model_ReceivingLoad&gt; loads)
        {
            if (loads == null || loads.Count == 0)
            {
                return Model_ReceivingValidationResult.Error(&quot;Session must contain at least one load&quot;);
            }

            var allErrors = new List&lt;string&gt;();

            foreach (var load in loads)
            {
                var loadValidation = ValidateReceivingLoad(load);
                if (!loadValidation.IsValid)
                {
                    allErrors.AddRange(loadValidation.Errors);
                }
            }

            if (allErrors.Count &gt; 0)
            {
                var result = Model_ReceivingValidationResult.Error($&quot;{allErrors.Count} validation error(s) found&quot;);
                result.Errors = allErrors;
                return result;
            }

            return Model_ReceivingValidationResult.Success();
        }

        public async Task&lt;Model_ReceivingValidationResult&gt; ValidatePartExistsInVisualAsync(string partID)
        {
            var result = await _inforVisualService.GetPartByIDAsync(partID);

            if (!result.Success)
            {
                return Model_ReceivingValidationResult.Error($&quot;Error validating part: {result.ErrorMessage}&quot;);
            }

            if (result.Data == null)
            {
                return Model_ReceivingValidationResult.Error($&quot;Part ID {partID} not found in Infor Visual database&quot;);
            }

            return Model_ReceivingValidationResult.Success();
        }
    }
}</file><file path="Module_Receiving/ViewModels/ViewModel_Receiving_HeatLot.cs">using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Linq;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Receiving.ViewModels
{
    public partial class ViewModel_Receiving_HeatLot : ViewModel_Shared_Base
    {
        private readonly IService_ReceivingWorkflow _workflowService;
        private readonly IService_ReceivingValidation _validationService;
        private readonly IService_Help _helpService;

        [ObservableProperty]
        private ObservableCollection&lt;Model_ReceivingLoad&gt; _loads = new();

        public ViewModel_Receiving_HeatLot(
            IService_ReceivingWorkflow workflowService,
            IService_ReceivingValidation validationService,
            IService_Help helpService,
            IService_ErrorHandler errorHandler,
            IService_LoggingUtility logger)
            : base(errorHandler, logger)
        {
            _workflowService = workflowService;
            _validationService = validationService;
            _helpService = helpService;

            _workflowService.StepChanged += OnStepChanged;
        }

        private void OnStepChanged(object? sender, System.EventArgs e)
        {
            if (_workflowService.CurrentStep == Enum_ReceivingWorkflowStep.HeatLotEntry)
            {
                _ = OnNavigatedToAsync();
            }
        }

        public Task OnNavigatedToAsync()
        {
            Loads.Clear();

            if (_workflowService.CurrentSession?.Loads != null)
            {
                foreach (var load in _workflowService.CurrentSession.Loads)
                {
                    Loads.Add(load);
                }
            }

            return Task.CompletedTask;
        }

        [RelayCommand]
        private void AutoFill()
        {
            // Fill down logic:
            // Iterate through loads. If a load has a blank HeatLotNumber,
            // copy it from the previous load (if available).
            for (int i = 1; i &lt; Loads.Count; i++)
            {
                var currentLoad = Loads[i];
                var prevLoad = Loads[i - 1];

                if (string.IsNullOrWhiteSpace(currentLoad.HeatLotNumber) &amp;&amp; !string.IsNullOrWhiteSpace(prevLoad.HeatLotNumber))
                {
                    currentLoad.HeatLotNumber = prevLoad.HeatLotNumber;
                }
            }
        }

        [RelayCommand]
        private Task ValidateAndContinueAsync()
        {
            // Set &quot;Not Entered&quot; for any blank heat/lot fields before advancing
            PrepareHeatLotFields();

            // Validation logic is handled by Service_ReceivingWorkflow when advancing
            return Task.CompletedTask;
        }

        /// &lt;summary&gt;
        /// Ensures all heat/lot fields have a value. Sets &quot;Nothing Entered&quot; for blank fields.
        /// &lt;/summary&gt;
        private void PrepareHeatLotFields()
        {
            foreach (var load in Loads)
            {
                if (string.IsNullOrWhiteSpace(load.HeatLotNumber))
                {
                    load.HeatLotNumber = &quot;Nothing Entered&quot;;
                }
            }
        }

        /// &lt;summary&gt;
        /// Shows contextual help for heat/lot entry
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task ShowHelpAsync()
        {
            await _helpService.ShowHelpAsync(&quot;Receiving.HeatLot&quot;);
        }

        #region Help Content Helpers

        public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);
        public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);
        public string GetTip(string key) =&gt; _helpService.GetTip(key);

        #endregion
    }
}</file><file path="Module_Receiving/ViewModels/ViewModel_Receiving_LoadEntry.cs">using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Core.Contracts.ViewModels;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Receiving.ViewModels
{
    public partial class ViewModel_Receiving_LoadEntry : ViewModel_Shared_Base, IResettableViewModel
    {
        private readonly IService_ReceivingWorkflow _workflowService;
        private readonly IService_ReceivingValidation _validationService;
        private readonly IService_Help _helpService;
        private readonly IService_ViewModelRegistry _viewModelRegistry;

        [ObservableProperty]
        private int _numberOfLoads = 1;

        [ObservableProperty]
        private string _selectedPartInfo = string.Empty;

        public ViewModel_Receiving_LoadEntry(
            IService_ReceivingWorkflow workflowService,
            IService_ReceivingValidation validationService,
            IService_Help helpService,
            IService_ErrorHandler errorHandler,
            IService_LoggingUtility logger,
            IService_ViewModelRegistry viewModelRegistry)
            : base(errorHandler, logger)
        {
            _workflowService = workflowService;
            _validationService = validationService;
            _helpService = helpService;
            _viewModelRegistry = viewModelRegistry;

            _workflowService.StepChanged += OnStepChanged;
            _viewModelRegistry.Register(this);
        }

        public void ResetToDefaults()
        {
            NumberOfLoads = 1;
            SelectedPartInfo = string.Empty;
        }

        private void OnStepChanged(object? sender, System.EventArgs e)
        {
            if (_workflowService.CurrentStep == Enum_ReceivingWorkflowStep.LoadEntry)
            {
                NumberOfLoads = _workflowService.NumberOfLoads;
            }
        }

        [RelayCommand]
        private async Task CreateLoadsAsync()
        {
            var validationResult = _validationService.ValidateNumberOfLoads(NumberOfLoads);
            if (!validationResult.IsValid)
            {
                await _errorHandler.HandleErrorAsync(validationResult.Message, Enum_ErrorSeverity.Warning);
                return;
            }

            // Sync with service
            _workflowService.NumberOfLoads = NumberOfLoads;
        }

        partial void OnNumberOfLoadsChanged(int value)
        {
            _workflowService.NumberOfLoads = value;
        }

        public void UpdatePartInfo(string partId, string description)
        {
            SelectedPartInfo = $&quot;{partId} - {description}&quot;;
        }

        /// &lt;summary&gt;
        /// Shows contextual help for load entry
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task ShowHelpAsync()
        {
            await _helpService.ShowHelpAsync(&quot;Receiving.LoadEntry&quot;);
        }

        #region Help Content Helpers

        public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);
        public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);
        public string GetTip(string key) =&gt; _helpService.GetTip(key);

        #endregion
    }
}</file><file path="Module_Receiving/ViewModels/ViewModel_Receiving_ModeSelection.cs">using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Settings.Interfaces;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using System;
using System.Threading.Tasks;
namespace MTM_Receiving_Application.Module_Receiving.ViewModels
{
    public partial class ViewModel_Receiving_ModeSelection : ViewModel_Shared_Base
    {
        private readonly IService_ReceivingWorkflow _workflowService;
        private readonly IService_UserSessionManager _sessionManager;
        private readonly IService_UserPreferences _userPreferencesService;
        private readonly IService_Help _helpService;
        private readonly IService_Window _windowService;

        [ObservableProperty]
        private bool _isGuidedModeDefault;

        [ObservableProperty]
        private bool _isManualModeDefault;

        [ObservableProperty]
        private bool _isEditModeDefault;

        public ViewModel_Receiving_ModeSelection(
            IService_ReceivingWorkflow workflowService,
            IService_UserSessionManager sessionManager,
            IService_UserPreferences userPreferencesService,
            IService_Help helpService,
            IService_Window windowService,
            IService_ErrorHandler errorHandler,
            IService_LoggingUtility logger)
            : base(errorHandler, logger)
        {
            _workflowService = workflowService;
            _sessionManager = sessionManager;
            _userPreferencesService = userPreferencesService;
            _helpService = helpService;
            _windowService = windowService;

            // Load current default mode
            LoadDefaultMode();
        }

        private void LoadDefaultMode()
        {
            var currentUser = _sessionManager.CurrentSession?.User;
            if (currentUser != null)
            {
                IsGuidedModeDefault = currentUser.DefaultReceivingMode == &quot;guided&quot;;
                IsManualModeDefault = currentUser.DefaultReceivingMode == &quot;manual&quot;;
                IsEditModeDefault = currentUser.DefaultReceivingMode == &quot;edit&quot;;
            }
        }

        [RelayCommand]
        private async Task SelectGuidedModeAsync()
        {
            _logger.LogInfo(&quot;User selected Guided Mode.&quot;);

            if (await ConfirmModeChangeAsync())
            {
                ClearWorkflowData();
                _workflowService.GoToStep(Enum_ReceivingWorkflowStep.POEntry);
            }
        }

        [RelayCommand]
        private async Task SelectManualModeAsync()
        {
            _logger.LogInfo(&quot;User selected Manual Mode.&quot;);

            if (await ConfirmModeChangeAsync())
            {
                ClearWorkflowData();
                _workflowService.GoToStep(Enum_ReceivingWorkflowStep.ManualEntry);
            }
        }

        [RelayCommand]
        private async Task SelectEditModeAsync()
        {
            _logger.LogInfo(&quot;User selected Edit Mode.&quot;);

            if (await ConfirmModeChangeAsync())
            {
                ClearWorkflowData();
                _workflowService.GoToStep(Enum_ReceivingWorkflowStep.EditMode);
            }
        }

        /// &lt;summary&gt;
        /// Shows confirmation dialog before mode change
        /// &lt;/summary&gt;
        /// &lt;returns&gt;True if user confirmed, false if cancelled&lt;/returns&gt;
        /// &lt;summary&gt;
        /// Checks if there is any unsaved data in the current workflow
        /// &lt;/summary&gt;
        private bool HasUnsavedData()
        {
            if (_workflowService.CurrentSession == null)
            {
                return false;
            }

            // Check if there are any loads in the session
            if (_workflowService.CurrentSession.Loads?.Count &gt; 0)
            {
                return true;
            }

            // Check if there&apos;s any PO/Part selection
            if (!string.IsNullOrEmpty(_workflowService.CurrentSession.PoNumber) ||
                _workflowService.CurrentPart != null)
            {
                return true;
            }

            return false;
        }

        private async Task&lt;bool&gt; ConfirmModeChangeAsync()
        {
            // Skip confirmation if there&apos;s no unsaved data
            if (!HasUnsavedData())
            {
                _logger.LogInfo(&quot;No unsaved data detected, skipping confirmation dialog&quot;);
                return true;
            }

            try
            {
                var xamlRoot = _windowService.GetXamlRoot();
                if (xamlRoot == null)
                {
                    _logger.LogWarning(&quot;XamlRoot is null, proceeding without confirmation&quot;);
                    return true;
                }

                var dialog = new ContentDialog
                {
                    Title = &quot;Confirm Mode Selection&quot;,
                    Content = &quot;Selecting a new mode will reset all unsaved data in the current workflow. Do you want to continue?&quot;,
                    PrimaryButtonText = &quot;Continue&quot;,
                    CloseButtonText = &quot;Cancel&quot;,
                    DefaultButton = ContentDialogButton.Close,
                    XamlRoot = xamlRoot
                };

                var result = await dialog.ShowAsync();
                return result == ContentDialogResult.Primary;
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Error showing confirmation dialog: {ex.Message}&quot;, ex);
                return true; // Proceed if dialog fails
            }
        }

        /// &lt;summary&gt;
        /// Clears all transient workflow data without affecting persisted data
        /// &lt;/summary&gt;
        private void ClearWorkflowData()
        {
            try
            {
                // Clear current session data (in-memory only, not database or CSV)
                if (_workflowService.CurrentSession != null)
                {
                    _workflowService.CurrentSession.Loads?.Clear();
                }

                // Clear UI inputs in all connected ViewModels
                ClearAllUIInputs();

                _logger.LogInfo(&quot;Workflow data and UI inputs cleared for mode change&quot;);
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Error clearing workflow data: {ex.Message}&quot;, ex);
            }
        }

        /// &lt;summary&gt;
        /// Clears UI input properties across all Receiving workflow ViewModels
        /// &lt;/summary&gt;
        private void ClearAllUIInputs()
        {
            try
            {
                // Clear POEntry ViewModel
                var poEntryVM = App.GetService&lt;ViewModel_Receiving_POEntry&gt;();
                if (poEntryVM != null)
                {
                    poEntryVM.PoNumber = string.Empty;
                    poEntryVM.PartID = string.Empty;
                    poEntryVM.SelectedPart = null;
                    poEntryVM.IsNonPOItem = false;
                    poEntryVM.Parts?.Clear();
                }

                // Clear PackageType ViewModel
                var packageTypeVM = App.GetService&lt;ViewModel_Receiving_PackageType&gt;();
                if (packageTypeVM != null)
                {
                    packageTypeVM.SelectedPackageType = string.Empty;
                    packageTypeVM.CustomPackageTypeName = string.Empty;
                    packageTypeVM.IsCustomTypeVisible = false;
                }

                // Clear LoadEntry ViewModel
                var loadEntryVM = App.GetService&lt;ViewModel_Receiving_LoadEntry&gt;();
                if (loadEntryVM != null)
                {
                    loadEntryVM.NumberOfLoads = 1;
                }

                // Clear WeightQuantity ViewModel
                var weightQuantityVM = App.GetService&lt;ViewModel_Receiving_WeightQuantity&gt;();
                if (weightQuantityVM != null)
                {
                    weightQuantityVM.Loads?.Clear();
                }

                // Clear HeatLot ViewModel
                var heatLotVM = App.GetService&lt;ViewModel_Receiving_HeatLot&gt;();
                if (heatLotVM != null)
                {
                    heatLotVM.Loads?.Clear();
                }

                _logger.LogInfo(&quot;UI inputs cleared across all Receiving ViewModels&quot;);
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Error clearing UI inputs: {ex.Message}&quot;, ex);
            }
        }

        [RelayCommand]
        private async Task SetGuidedAsDefaultAsync(bool isChecked)
        {
            try
            {
                var currentUser = _sessionManager.CurrentSession?.User;
                if (currentUser == null)
                {
                    return;
                }

                string? newMode = isChecked ? &quot;guided&quot; : null;

                var result = await _userPreferencesService.UpdateDefaultReceivingModeAsync(currentUser.WindowsUsername, newMode ?? &quot;&quot;);

                if (result.IsSuccess)
                {
                    // Update in-memory user object
                    currentUser.DefaultReceivingMode = newMode;

                    // Update UI state
                    IsGuidedModeDefault = isChecked;
                    if (isChecked)
                    {
                        IsManualModeDefault = false;
                        IsEditModeDefault = false;
                    }

                    _logger.LogInfo($&quot;Default mode set to: {newMode ?? &quot;none&quot;}&quot;);
                    StatusMessage = isChecked ? &quot;Guided mode set as default&quot; : &quot;Default mode cleared&quot;;
                }
                else
                {
                    await _errorHandler.ShowErrorDialogAsync(&quot;Save Error&quot;, result.ErrorMessage, Enum_ErrorSeverity.Error);
                    // Revert checkbox
                    IsGuidedModeDefault = !isChecked;
                }
            }
            catch (Exception ex)
            {
                await _errorHandler.HandleErrorAsync($&quot;Failed to set default mode: {ex.Message}&quot;,
                    Enum_ErrorSeverity.Error, ex, true);
                // Revert checkbox
                IsGuidedModeDefault = !isChecked;
            }
        }

        [RelayCommand]
        private async Task SetManualAsDefaultAsync(bool isChecked)
        {
            try
            {
                var currentUser = _sessionManager.CurrentSession?.User;
                if (currentUser == null)
                {
                    return;
                }

                string? newMode = isChecked ? &quot;manual&quot; : null;

                var result = await _userPreferencesService.UpdateDefaultReceivingModeAsync(currentUser.WindowsUsername, newMode ?? &quot;&quot;);

                if (result.IsSuccess)
                {
                    // Update in-memory user object
                    currentUser.DefaultReceivingMode = newMode;

                    // Update UI state
                    IsManualModeDefault = isChecked;
                    if (isChecked)
                    {
                        IsGuidedModeDefault = false;
                        IsEditModeDefault = false;
                    }

                    _logger.LogInfo($&quot;Default mode set to: {newMode ?? &quot;none&quot;}&quot;);
                    StatusMessage = isChecked ? &quot;Manual mode set as default&quot; : &quot;Default mode cleared&quot;;
                }
                else
                {
                    await _errorHandler.ShowErrorDialogAsync(&quot;Save Error&quot;, result.ErrorMessage, Enum_ErrorSeverity.Error);
                    // Revert checkbox
                    IsManualModeDefault = !isChecked;
                }
            }
            catch (Exception ex)
            {
                await _errorHandler.HandleErrorAsync($&quot;Failed to set default mode: {ex.Message}&quot;,
                    Enum_ErrorSeverity.Error, ex, true);
                // Revert checkbox
                IsManualModeDefault = !isChecked;
            }
        }

        [RelayCommand]
        private async Task SetEditAsDefaultAsync(bool isChecked)
        {
            try
            {
                var currentUser = _sessionManager.CurrentSession?.User;
                if (currentUser == null)
                {
                    return;
                }

                string? newMode = isChecked ? &quot;edit&quot; : null;

                var result = await _userPreferencesService.UpdateDefaultReceivingModeAsync(currentUser.WindowsUsername, newMode ?? &quot;&quot;);

                if (result.IsSuccess)
                {
                    // Update in-memory user object
                    currentUser.DefaultReceivingMode = newMode;

                    // Update UI state
                    IsEditModeDefault = isChecked;
                    if (isChecked)
                    {
                        IsGuidedModeDefault = false;
                        IsManualModeDefault = false;
                    }

                    _logger.LogInfo($&quot;Default mode set to: {newMode ?? &quot;none&quot;}&quot;);
                    StatusMessage = isChecked ? &quot;Edit mode set as default&quot; : &quot;Default mode cleared&quot;;
                }
                else
                {
                    await _errorHandler.ShowErrorDialogAsync(&quot;Save Error&quot;, result.ErrorMessage, Enum_ErrorSeverity.Error);
                    // Revert checkbox
                    IsEditModeDefault = !isChecked;
                }
            }
            catch (Exception ex)
            {
                await _errorHandler.HandleErrorAsync($&quot;Failed to set default mode: {ex.Message}&quot;,
                    Enum_ErrorSeverity.Error, ex, true);
                // Revert checkbox
                IsEditModeDefault = !isChecked;
            }
        }

        /// &lt;summary&gt;
        /// Shows contextual help for receiving mode selection
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task ShowHelpAsync()
        {
            await _helpService.ShowHelpAsync(&quot;Receiving.ModeSelection&quot;);
        }

        #region Help Content Helpers

        /// &lt;summary&gt;
        /// Gets a tooltip by key from the help service
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
        public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);

        /// &lt;summary&gt;
        /// Gets a placeholder by key from the help service
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
        public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);

        /// &lt;summary&gt;
        /// Gets a tip by key from the help service
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
        public string GetTip(string key) =&gt; _helpService.GetTip(key);

        #endregion
    }
}</file><file path="Module_Receiving/ViewModels/ViewModel_Receiving_Review.cs">using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using System.Collections.ObjectModel;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using System;

namespace MTM_Receiving_Application.Module_Receiving.ViewModels
{
    public partial class ViewModel_Receiving_Review : ViewModel_Shared_Base
    {
        private readonly IService_ReceivingWorkflow _workflowService;
        private readonly IService_ReceivingValidation _validationService;
        private readonly IService_Help _helpService;
        private readonly IService_Window _windowService;

        [ObservableProperty]
        private ObservableCollection&lt;Model_ReceivingLoad&gt; _loads = new();

        [ObservableProperty]
        private bool _isSingleView = true;  // Default to single entry view

        [ObservableProperty]
        private int _currentEntryIndex = 0;

        [ObservableProperty]
        private Model_ReceivingLoad? _currentEntry;

        /// &lt;summary&gt;
        /// Display index (1-based) for UI
        /// &lt;/summary&gt;
        public int DisplayIndex =&gt; CurrentEntryIndex + 1;

        /// &lt;summary&gt;
        /// Indicates if the Previous button should be enabled
        /// &lt;/summary&gt;
        public bool CanGoBack =&gt; CurrentEntryIndex &gt; 0;

        /// &lt;summary&gt;
        /// Indicates if the Next button should be enabled
        /// &lt;/summary&gt;
        public bool CanGoNext =&gt; Loads.Count &gt; 0 &amp;&amp; CurrentEntryIndex &lt; Loads.Count - 1;

        /// &lt;summary&gt;
        /// Inverse of IsSingleView for binding table view visibility
        /// &lt;/summary&gt;
        public bool IsTableView =&gt; !IsSingleView;

        public ViewModel_Receiving_Review(
            IService_ReceivingWorkflow workflowService,
            IService_ReceivingValidation validationService,
            IService_Help helpService,
            IService_Window windowService,
            IService_ErrorHandler errorHandler,
            IService_LoggingUtility logger)
            : base(errorHandler, logger)
        {
            _workflowService = workflowService;
            _validationService = validationService;
            _helpService = helpService;
            _windowService = windowService;

            _workflowService.StepChanged += OnStepChanged;
        }

        private void OnStepChanged(object? sender, System.EventArgs e)
        {
            if (_workflowService.CurrentStep == Enum_ReceivingWorkflowStep.Review)
            {
                _ = OnNavigatedToAsync();
            }
        }

        public async Task OnNavigatedToAsync()
        {
            Loads.Clear();
            if (_workflowService.CurrentSession?.Loads != null)
            {
                foreach (var load in _workflowService.CurrentSession.Loads)
                {
                    Loads.Add(load);
                }

                // Set current entry to first load if available
                if (Loads.Count &gt; 0)
                {
                    CurrentEntryIndex = 0;
                    CurrentEntry = Loads[0];
                }
            }

            OnPropertyChanged(nameof(CanGoBack));
            OnPropertyChanged(nameof(CanGoNext));
            OnPropertyChanged(nameof(DisplayIndex));
            await Task.CompletedTask;
        }

        [RelayCommand]
        private void PreviousEntry()
        {
            if (CurrentEntryIndex &gt; 0)
            {
                CurrentEntryIndex--;
                CurrentEntry = Loads[CurrentEntryIndex];
                OnPropertyChanged(nameof(CanGoBack));
                OnPropertyChanged(nameof(CanGoNext));
                OnPropertyChanged(nameof(DisplayIndex));
            }
        }

        [RelayCommand]
        private void NextEntry()
        {
            if (CurrentEntryIndex &lt; Loads.Count - 1)
            {
                CurrentEntryIndex++;
                CurrentEntry = Loads[CurrentEntryIndex];
                OnPropertyChanged(nameof(CanGoBack));
                OnPropertyChanged(nameof(CanGoNext));
                OnPropertyChanged(nameof(DisplayIndex));
            }
        }

        [RelayCommand]
        private void SwitchToTableView()
        {
            IsSingleView = false;
            OnPropertyChanged(nameof(IsTableView));
        }

        [RelayCommand]
        private void SwitchToSingleView()
        {
            IsSingleView = true;
            OnPropertyChanged(nameof(IsTableView));
        }

        [RelayCommand]
        private async Task AddAnotherPartAsync()
        {
            _logger.LogInfo(&quot;User requested to add another part/PO&quot;);

            try
            {
                // Show confirmation dialog to prevent accidental data loss
                if (!await ConfirmAddAnotherAsync())
                {
                    _logger.LogInfo(&quot;User cancelled add another part/PO&quot;);
                    return;
                }

                // Save current session to CSV before clearing
                IsBusy = true;
                StatusMessage = &quot;Saving to CSV...&quot;;
                var saveResult = await _workflowService.SaveToCSVOnlyAsync();

                if (!saveResult.Success)
                {
                    await _errorHandler.HandleErrorAsync(
                        $&quot;Failed to save CSV backup: {string.Join(&quot;, &quot;, saveResult.Errors)}&quot;,
                        Enum_ErrorSeverity.Warning,
                        null,
                        true);
                    IsBusy = false;
                    return;
                }
                IsBusy = false;

                // Clear transient workflow data FIRST (before navigation)
                ClearTransientWorkflowData();

                // Preserve current session loads
                await _workflowService.AddCurrentPartToSessionAsync();

                // Navigate to PO Entry to start new part/PO entry
                // Note: AddCurrentPartToSessionAsync already sets CurrentStep to POEntry
                // so this is redundant, but explicit for clarity
                _workflowService.GoToStep(Enum_ReceivingWorkflowStep.POEntry);

                _logger.LogInfo(&quot;Navigated to PO Entry for new part, workflow data cleared&quot;);
            }
            catch (Exception ex)
            {
                IsBusy = false;
                _logger.LogError($&quot;Error in AddAnotherPartAsync: {ex.Message}&quot;, ex);
                await _errorHandler.HandleErrorAsync(
                    &quot;Failed to prepare for new part entry&quot;,
                    Enum_ErrorSeverity.Medium,
                    ex,
                    true);
            }
        }

        /// &lt;summary&gt;
        /// Shows confirmation dialog before clearing data for new entry
        /// &lt;/summary&gt;
        private async Task&lt;bool&gt; ConfirmAddAnotherAsync()
        {
            try
            {
                var xamlRoot = _windowService.GetXamlRoot();
                if (xamlRoot == null)
                {
                    _logger.LogWarning(&quot;XamlRoot is null, proceeding without confirmation&quot;);
                    return true;
                }

                var dialog = new ContentDialog
                {
                    Title = &quot;Add Another Part/PO&quot;,
                    Content = &quot;Current form data will be cleared to start a new entry. Your reviewed loads are preserved. Continue?&quot;,
                    PrimaryButtonText = &quot;Continue&quot;,
                    CloseButtonText = &quot;Cancel&quot;,
                    DefaultButton = ContentDialogButton.Primary,
                    XamlRoot = xamlRoot
                };

                var result = await dialog.ShowAsync();
                return result == ContentDialogResult.Primary;
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Error showing confirmation dialog: {ex.Message}&quot;, ex);
                return true; // Proceed if dialog fails
            }
        }

        /// &lt;summary&gt;
        /// Clears transient workflow data from intermediate steps (not the session loads)
        /// This prevents data duplication when adding another part
        /// &lt;/summary&gt;
        private void ClearTransientWorkflowData()
        {
            try
            {
                // Clear the current session properties that hold form data
                // but preserve the Loads collection (already saved loads)
                var session = _workflowService.CurrentSession;
                if (session != null)
                {
                    // Clear PO-related properties if they exist in session
                    session.PoNumber = null;
                    session.IsNonPO = false;
                }

                // Clear UI inputs in connected ViewModels
                _workflowService.ClearUIInputs();

                _logger.LogInfo(&quot;Transient workflow data and UI inputs cleared for new entry&quot;);
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Error clearing transient workflow data: {ex.Message}&quot;, ex);
            }
        }



        [RelayCommand]
        private async Task SaveAsync()
        {
            // Trigger the save workflow
            // This moves to &quot;Saving&quot; step
            await _workflowService.AdvanceToNextStepAsync();
        }

        public void HandleCascadingUpdate(Model_ReceivingLoad changedLoad, string propertyName)
        {
            if (changedLoad == null)
            {
                return;
            }

            // Logic for cascading updates
            // If user changes a value in row X, should it update X+1, X+2...?
            // Spec says: &quot;Review Grid with Cascading Updates&quot;
            // Usually this means if I change Heat# on Load 1, it might ask to update others, 
            // or if I change PO# it updates all for that part?

            // T044 says: &quot;cascading update logic for Part# and PO#&quot;

            var index = Loads.IndexOf(changedLoad);
            if (index &lt; 0)
            {
                return;
            }

            if (propertyName == nameof(Model_ReceivingLoad.PoNumber))
            {
                // Update all subsequent loads? Or all loads for this part?
                // If we are reviewing the current session, and it&apos;s a single part (US1), 
                // changing PO probably implies changing it for all loads of this part.
                foreach (var load in Loads)
                {
                    if (load != changedLoad)
                    {
                        load.PoNumber = changedLoad.PoNumber;
                    }
                }
            }
            else if (propertyName == nameof(Model_ReceivingLoad.PartID))
            {
                // If PartID changes, we might need to re-validate or update description?
                // For now, let&apos;s assume we update all loads to match if it&apos;s the same &quot;group&quot;.
                foreach (var load in Loads)
                {
                    if (load != changedLoad)
                    {
                        load.PartID = changedLoad.PartID;
                    }
                }
            }
            // Add other cascading logic if needed (e.g. Heat Number cascading downwards)
        }

        /// &lt;summary&gt;
        /// Shows contextual help for review grid
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task ShowHelpAsync()
        {
            await _helpService.ShowHelpAsync(&quot;Receiving.Review&quot;);
        }

        #region Help Content Helpers

        public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);
        public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);
        public string GetTip(string key) =&gt; _helpService.GetTip(key);

        #endregion
    }
}</file><file path="Module_Receiving/ViewModels/ViewModel_Receiving_WeightQuantity.cs">using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Receiving.ViewModels
{
    public partial class ViewModel_Receiving_WeightQuantity : ViewModel_Shared_Base
    {
        private readonly IService_ReceivingWorkflow _workflowService;
        private readonly IService_ReceivingValidation _validationService;
        private readonly IService_InforVisual _inforVisualService;
        private readonly IService_Help _helpService;

        [ObservableProperty]
        private ObservableCollection&lt;Model_ReceivingLoad&gt; _loads = new();

        [ObservableProperty]
        private string _warningMessage = string.Empty;

        [ObservableProperty]
        private bool _hasWarning;

        [ObservableProperty]
        private string _poQuantityInfo = string.Empty;

        public ViewModel_Receiving_WeightQuantity(
            IService_ReceivingWorkflow workflowService,
            IService_ReceivingValidation validationService,
            IService_InforVisual inforVisualService,
            IService_Help helpService,
            IService_ErrorHandler errorHandler,
            IService_LoggingUtility logger)
            : base(errorHandler, logger)
        {
            _workflowService = workflowService;
            _validationService = validationService;
            _inforVisualService = inforVisualService;
            _helpService = helpService;

            _workflowService.StepChanged += OnStepChanged;
        }

        private void OnStepChanged(object? sender, EventArgs e)
        {
            if (_workflowService.CurrentStep == Enum_ReceivingWorkflowStep.WeightQuantityEntry)
            {
                _ = OnNavigatedToAsync();
            }
        }

        public async Task OnNavigatedToAsync()
        {
            // Refresh loads from session
            Loads.Clear();
            if (_workflowService.CurrentSession?.Loads != null)
            {
                foreach (var load in _workflowService.CurrentSession.Loads)
                {
                    Loads.Add(load);
                }
            }

            UpdatePOQuantityInfo();
            await CheckSameDayReceivingAsync();
        }

        private void UpdatePOQuantityInfo()
        {
            if (_workflowService.CurrentSession.IsNonPO)
            {
                PoQuantityInfo = &quot;Non-PO Item&quot;;
            }
            else if (_workflowService.CurrentPart != null)
            {
                PoQuantityInfo = $&quot;Ordered: {_workflowService.CurrentPart.QtyOrdered:N2}&quot;;
            }
            else
            {
                PoQuantityInfo = string.Empty;
            }
        }

        private async Task CheckSameDayReceivingAsync()
        {
            HasWarning = false;
            WarningMessage = string.Empty;

            if (_workflowService.CurrentSession.IsNonPO)
            {
                return;
            }

            var poNumber = _workflowService.CurrentPONumber;
            var partId = _workflowService.CurrentPart?.PartID;

            if (string.IsNullOrEmpty(poNumber) || string.IsNullOrEmpty(partId))
            {
                return;
            }

            try
            {
                var result = await _inforVisualService.GetSameDayReceivingQuantityAsync(poNumber, partId, DateTime.Today);
                if (result.IsSuccess &amp;&amp; result.Data &gt; 0)
                {
                    HasWarning = true;
                    WarningMessage = $&quot;Warning: {result.Data:N2} of this part has already been received today on this PO.&quot;;
                }
            }
            catch (Exception ex)
            {
                await _errorHandler.LogErrorAsync(&quot;Failed to check same-day receiving&quot;, Enum_ErrorSeverity.Warning, ex);
            }
        }

        [RelayCommand]
        private async Task ValidateAndContinueAsync()
        {
            // Validate all loads have weight &gt; 0
            foreach (var load in Loads)
            {
                var result = _validationService.ValidateWeightQuantity(load.WeightQuantity);
                if (!result.IsValid)
                {
                    await _errorHandler.HandleErrorAsync($&quot;Load {load.LoadNumber}: {result.Message}&quot;, Enum_ErrorSeverity.Warning);
                    return;
                }
            }

            if (!_workflowService.CurrentSession.IsNonPO &amp;&amp; _workflowService.CurrentPart != null)
            {
                var totalWeight = Loads.Sum(l =&gt; l.WeightQuantity);
                if (totalWeight &gt; _workflowService.CurrentPart.QtyOrdered)
                {
                    WarningMessage = $&quot;Warning: Total quantity ({totalWeight:N2}) exceeds PO ordered amount ({_workflowService.CurrentPart.QtyOrdered:N2}).&quot;;
                    HasWarning = true;
                }
            }
        }

        /// &lt;summary&gt;
        /// Shows contextual help for weight/quantity entry
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task ShowHelpAsync()
        {
            await _helpService.ShowHelpAsync(&quot;Receiving.WeightQuantity&quot;);
        }

        #region Help Content Helpers

        public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);
        public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);
        public string GetTip(string key) =&gt; _helpService.GetTip(key);

        #endregion
    }
}</file><file path="Module_Receiving/ViewModels/ViewModel_Receiving_Workflow.cs">using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using MTM_Receiving_Application.Module_Core.Helpers.UI;
using System;
using System.Threading.Tasks;

using InfoBarSeverity = MTM_Receiving_Application.Module_Core.Models.Enums.InfoBarSeverity;

namespace MTM_Receiving_Application.Module_Receiving.ViewModels
{
    public partial class ViewModel_Receiving_Workflow : ViewModel_Shared_Base
    {
        private readonly IService_ReceivingWorkflow _workflowService;
        private readonly IService_Help _helpService;

        [ObservableProperty]
        private string _currentStepTitle = &quot;Receiving - Mode Selection&quot;;

        [ObservableProperty]
        private bool _isModeSelectionVisible;

        [ObservableProperty]
        private bool _isManualEntryVisible;

        [ObservableProperty]
        private bool _isEditModeVisible;

        [ObservableProperty]
        private bool _isPOEntryVisible;

        [ObservableProperty]
        private bool _isPartSelectionVisible;

        [ObservableProperty]
        private bool _isLoadEntryVisible;

        [ObservableProperty]
        private bool _isWeightQuantityEntryVisible;

        [ObservableProperty]
        private bool _isHeatLotEntryVisible;

        [ObservableProperty]
        private bool _isPackageTypeEntryVisible;

        [ObservableProperty]
        private bool _isReviewVisible;

        [ObservableProperty]
        private bool _isSavingVisible;

        [ObservableProperty]
        private bool _isCompleteVisible;

        [ObservableProperty]
        private Model_SaveResult? _lastSaveResult;

        [ObservableProperty]
        private string _saveProgressMessage = &quot;Initializing...&quot;;

        [ObservableProperty]
        private double _saveProgressValue = 0;

        [ObservableProperty]
        private Microsoft.UI.Xaml.UIElement? _helpContent;

        private bool _isSaving = false;
        private readonly IService_Dispatcher _dispatcherService;
        private readonly IService_Window _windowService;

        public ViewModel_Receiving_Workflow(
            IService_ReceivingWorkflow workflowService,
            IService_ErrorHandler errorHandler,
            IService_LoggingUtility logger,
            IService_Dispatcher dispatcherService,
            IService_Window windowService,
            IService_Help helpService)
            : base(errorHandler, logger)
        {
            _dispatcherService = dispatcherService;
            _windowService = windowService;
            _workflowService = workflowService;
            _helpService = helpService;
            _workflowService.StepChanged += OnWorkflowStepChanged;
            _workflowService.StatusMessageRaised += (_, message) =&gt; ShowStatus(message);

            // Initialize visibility based on current step
            OnWorkflowStepChanged(this, EventArgs.Empty);
        }

        private void OnWorkflowStepChanged(object? sender, EventArgs e)
        {
            _logger.LogInfo(&quot;StepChanged event received in ViewModel. Updating visibility.&quot;);

            if (_workflowService.CurrentStep == Enum_ReceivingWorkflowStep.Saving)
            {
                _logger.LogInfo(&quot;Step is Saving. Enqueuing PerformSaveAsync via Dispatcher.&quot;);
                _dispatcherService.TryEnqueue(async () =&gt;
                {
                    await PerformSaveAsync();
                });
            }

            // Hide all steps
            IsModeSelectionVisible = false;
            IsManualEntryVisible = false;
            IsEditModeVisible = false;
            IsPOEntryVisible = false;
            IsPartSelectionVisible = false;
            IsLoadEntryVisible = false;
            IsWeightQuantityEntryVisible = false;
            IsHeatLotEntryVisible = false;
            IsPackageTypeEntryVisible = false;
            IsReviewVisible = false;
            IsSavingVisible = false;
            IsCompleteVisible = false;

            // Show current step and set title
            switch (_workflowService.CurrentStep)
            {
                case Enum_ReceivingWorkflowStep.ModeSelection:
                    IsModeSelectionVisible = true;
                    CurrentStepTitle = &quot;Receiving - Mode Selection&quot;;
                    break;
                case Enum_ReceivingWorkflowStep.ManualEntry:
                    IsManualEntryVisible = true;
                    CurrentStepTitle = &quot;Receiving - Manual Entry&quot;;
                    break;
                case Enum_ReceivingWorkflowStep.EditMode:
                    IsEditModeVisible = true;
                    CurrentStepTitle = &quot;Receiving - Edit Mode&quot;;
                    break;
                case Enum_ReceivingWorkflowStep.POEntry:
                    IsPOEntryVisible = true;
                    CurrentStepTitle = &quot;Receiving - Enter PO Number&quot;;
                    break;
                case Enum_ReceivingWorkflowStep.PartSelection:
                    IsPartSelectionVisible = true;
                    CurrentStepTitle = &quot;Receiving - Select Part&quot;;
                    break;
                case Enum_ReceivingWorkflowStep.LoadEntry:
                    IsLoadEntryVisible = true;
                    CurrentStepTitle = &quot;Receiving - Enter Number of Loads&quot;;
                    break;
                case Enum_ReceivingWorkflowStep.WeightQuantityEntry:
                    IsWeightQuantityEntryVisible = true;
                    CurrentStepTitle = &quot;Receiving - Enter Weight/Quantity&quot;;
                    break;
                case Enum_ReceivingWorkflowStep.HeatLotEntry:
                    IsHeatLotEntryVisible = true;
                    CurrentStepTitle = &quot;Receiving - Enter Heat/Lot Numbers&quot;;
                    break;
                case Enum_ReceivingWorkflowStep.PackageTypeEntry:
                    IsPackageTypeEntryVisible = true;
                    CurrentStepTitle = &quot;Receiving - Select Package Type&quot;;
                    break;
                case Enum_ReceivingWorkflowStep.Review:
                    IsReviewVisible = true;
                    CurrentStepTitle = &quot;Receiving - Review &amp; Save&quot;;
                    break;
                case Enum_ReceivingWorkflowStep.Saving:
                    IsSavingVisible = true;
                    CurrentStepTitle = &quot;Receiving - Saving...&quot;;
                    break;
                case Enum_ReceivingWorkflowStep.Complete:
                    IsCompleteVisible = true;
                    CurrentStepTitle = &quot;Receiving - Complete&quot;;
                    break;
                default:
                    IsModeSelectionVisible = true;
                    CurrentStepTitle = &quot;Receiving - Mode Selection&quot;;
                    break;
            }

            // Update help content based on step
            HelpContent = Helper_WorkflowHelpContentGenerator.GenerateHelpContent(_workflowService.CurrentStep);

            _logger.LogInfo($&quot;Visibility updated. Current Step: {_workflowService.CurrentStep}, Title: {CurrentStepTitle}&quot;);
        }

        [RelayCommand]
        private async Task NextStepAsync()
        {
            try
            {
                _logger.LogInfo(&quot;NextStepAsync command triggered.&quot;);

                // Removed Task.Yield() to avoid context switching issues
                // await Task.Yield();

                var result = await _workflowService.AdvanceToNextStepAsync();
                _logger.LogInfo($&quot;AdvanceToNextStepAsync returned. Success: {result.Success}, Step: {_workflowService.CurrentStep}&quot;);

                if (!result.Success)
                {
                    if (result.ValidationErrors.Count &gt; 0)
                    {
                        await _errorHandler.HandleErrorAsync(
                            string.Join(&quot;\n&quot;, result.ValidationErrors),
                            Enum_ErrorSeverity.Error);
                    }
                }
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Error in NextStepAsync: {ex.Message}&quot;, ex);
                await _errorHandler.HandleErrorAsync($&quot;An error occurred: {ex.Message}&quot;, Enum_ErrorSeverity.Error);
            }
        }

        private async Task PerformSaveAsync()
        {
            if (_isSaving)
            {
                _logger.LogInfo(&quot;PerformSaveAsync called but already saving. Ignoring.&quot;);
                return;
            }
            _isSaving = true;

            try
            {
                _logger.LogInfo(&quot;PerformSaveAsync started.&quot;);

                // Update UI immediately
                SaveProgressMessage = &quot;Saving to local and network CSV...&quot;;
                SaveProgressValue = 30;

                // Perform save
                var messageProgress = new Progress&lt;string&gt;(msg =&gt;
                {
                    _logger.LogInfo($&quot;Save progress message: {msg}&quot;);
                    SaveProgressMessage = msg;
                });
                var percentProgress = new Progress&lt;int&gt;(pct =&gt;
                {
                    _logger.LogInfo($&quot;Save progress percent: {pct}&quot;);
                    SaveProgressValue = pct;
                });

                _logger.LogInfo(&quot;Calling _workflowService.SaveSessionAsync...&quot;);
                LastSaveResult = await _workflowService.SaveSessionAsync(messageProgress, percentProgress);
                _logger.LogInfo($&quot;SaveSessionAsync returned. Success: {LastSaveResult.Success}&quot;);

                // Advance to Complete step
                await _workflowService.AdvanceToNextStepAsync();
            }
            catch (Exception ex)
            {
                _logger.LogError($&quot;Error in PerformSaveAsync: {ex.Message}&quot;, ex);
                await _errorHandler.HandleErrorAsync($&quot;Save failed: {ex.Message}&quot;, Enum_ErrorSeverity.Error);
            }
            finally
            {
                _isSaving = false;
            }
        }

        [RelayCommand]
        private async Task StartNewEntryAsync()
        {
            await _workflowService.ResetWorkflowAsync();
        }

        [RelayCommand]
        private async Task ResetCSVAsync()
        {
            var xamlRoot = _windowService.GetXamlRoot();
            if (xamlRoot == null)
            {
                _logger.LogError(&quot;Cannot show dialog: XamlRoot is null&quot;);
                await _errorHandler.HandleErrorAsync(&quot;Unable to display dialog&quot;, Enum_ErrorSeverity.Error);
                return;
            }

            var dialog = new ContentDialog
            {
                Title = &quot;Reset CSV Files&quot;,
                Content = &quot;Are you sure you want to delete the local and network CSV files? This action cannot be undone.&quot;,
                PrimaryButtonText = &quot;Delete&quot;,
                CloseButtonText = &quot;Cancel&quot;,
                DefaultButton = ContentDialogButton.Close,
                XamlRoot = xamlRoot
            };

            var result = await dialog.ShowAsync();
            if (result == ContentDialogResult.Primary)
            {
                // Try to save to DB first
                var saveResult = await _workflowService.SaveToDatabaseOnlyAsync();
                if (!saveResult.Success)
                {
                    var warnDialog = new ContentDialog
                    {
                        Title = &quot;Database Save Failed&quot;,
                        Content = $&quot;Failed to save to database: {string.Join(&quot;, &quot;, saveResult.Errors)}\n\nDo you want to proceed with deleting CSV files anyway?&quot;,
                        PrimaryButtonText = &quot;Delete Anyway&quot;,
                        CloseButtonText = &quot;Cancel&quot;,
                        DefaultButton = ContentDialogButton.Close,
                        XamlRoot = xamlRoot
                    };

                    var warnResult = await warnDialog.ShowAsync();
                    if (warnResult != ContentDialogResult.Primary)
                    {
                        return;
                    }
                }

                var deleteResult = await _workflowService.ResetCSVFilesAsync();
                if (deleteResult.LocalDeleted || deleteResult.NetworkDeleted)
                {
                    ShowStatus(&quot;CSV files deleted successfully.&quot;, InfoBarSeverity.Success);
                }
                else
                {
                    ShowStatus(&quot;Failed to delete CSV files or files not found.&quot;, InfoBarSeverity.Warning);
                }
            }
        }

        [RelayCommand]
        private void PreviousStep()
        {
            var result = _workflowService.GoToPreviousStep();
        }

        [RelayCommand]
        private async Task ReturnToModeSelectionAsync()
        {
            var xamlRoot = _windowService.GetXamlRoot();
            if (xamlRoot == null)
            {
                _logger.LogError(&quot;Cannot show dialog: XamlRoot is null&quot;);
                await _errorHandler.HandleErrorAsync(&quot;Unable to display dialog&quot;, Enum_ErrorSeverity.Error);
                return;
            }

            var dialog = new ContentDialog
            {
                Title = &quot;Change Mode?&quot;,
                Content = &quot;Returning to mode selection will clear all current work in progress. This cannot be undone. Are you sure?&quot;,
                PrimaryButtonText = &quot;Yes, Change Mode&quot;,
                CloseButtonText = &quot;Cancel&quot;,
                DefaultButton = ContentDialogButton.Close,
                XamlRoot = xamlRoot
            };

            var result = await dialog.ShowAsync();
            if (result == ContentDialogResult.Primary)
            {
                // Reset workflow and return to mode selection
                await _workflowService.ResetWorkflowAsync();
                _workflowService.GoToStep(Enum_ReceivingWorkflowStep.ModeSelection);
                ShowStatus(&quot;Workflow cleared. Please select a mode.&quot;, InfoBarSeverity.Informational);
            }
        }

        /// &lt;summary&gt;
        /// Shows contextual help for current workflow step
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task ShowHelpAsync()
        {
            await _helpService.ShowHelpAsync(&quot;Receiving.Workflow&quot;);
        }

        #region Help Content Helpers

        public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);
        public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);
        public string GetTip(string key) =&gt; _helpService.GetTip(key);

        #endregion
    }
}</file><file path="Module_Receiving/Views/View_Receiving_Workflow.xaml.cs">using Microsoft.UI.Xaml.Controls;
using Microsoft.UI.Xaml.Navigation;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Receiving.ViewModels;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Receiving.Views
{
    public sealed partial class View_Receiving_Workflow : Page
    {
        public ViewModel_Receiving_Workflow ViewModel { get; }
        private readonly IService_ReceivingWorkflow? _workflowService;
        private readonly IService_Help? _helpService;

        public View_Receiving_Workflow()
        {
            ViewModel = App.GetService&lt;ViewModel_Receiving_Workflow&gt;();
            this.InitializeComponent();

            _workflowService = App.GetService&lt;IService_ReceivingWorkflow&gt;();
            _helpService = App.GetService&lt;IService_Help&gt;();
        }

        private async void HelpButton_Click(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
        {
            if (_helpService == null || _workflowService == null)
            {
                return;
            }

            await _helpService.ShowContextualHelpAsync(_workflowService.CurrentStep);
        }

        protected override void OnNavigatedTo(NavigationEventArgs e)
        {
            base.OnNavigatedTo(e);

            // Check for default mode and skip mode selection if set
            // Only do this if we&apos;re starting fresh (on ModeSelection step)
            var sessionManager = App.GetService&lt;IService_UserSessionManager&gt;();
            var workflowService = App.GetService&lt;IService_ReceivingWorkflow&gt;();

            // Only apply default mode if we&apos;re on the mode selection screen
            // and there&apos;s a valid user session
            if (workflowService.CurrentStep == Enum_ReceivingWorkflowStep.ModeSelection &amp;&amp;
                sessionManager.CurrentSession?.User != null)
            {
                var defaultMode = sessionManager.CurrentSession.User.DefaultReceivingMode;

                if (!string.IsNullOrEmpty(defaultMode))
                {
                    // User has a default mode set - go directly to that mode
                    if (defaultMode == &quot;guided&quot;)
                    {
                        workflowService.GoToStep(Enum_ReceivingWorkflowStep.POEntry);
                    }
                    else if (defaultMode == &quot;manual&quot;)
                    {
                        workflowService.GoToStep(Enum_ReceivingWorkflowStep.ManualEntry);
                    }
                }
            }
            // If defaultMode is null or conditions not met, stay on current step
        }
    }
}</file><file path="Module_Reporting/Services/Service_Reporting.cs">using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Reporting.Contracts;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.Reporting;
using MTM_Receiving_Application.Module_Reporting.Data;

namespace MTM_Receiving_Application.Module_Reporting.Services;

/// &lt;summary&gt;
/// Service implementation for End-of-Day reporting
/// Handles data retrieval, PO normalization, CSV export, and email formatting
/// &lt;/summary&gt;
public class Service_Reporting : IService_Reporting
{
    private readonly Dao_Reporting _dao;
    private readonly IService_LoggingUtility _logger;

    public Service_Reporting(
        Dao_Reporting dao,
        IService_LoggingUtility logger)
    {
        _dao = dao ?? throw new ArgumentNullException(nameof(dao));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_ReportRow&gt;&gt;&gt; GetReceivingHistoryAsync(
        DateTime startDate,
        DateTime endDate)
    {
        _logger.LogInfo($&quot;Retrieving Receiving history from {startDate:yyyy-MM-dd} to {endDate:yyyy-MM-dd}&quot;);
        var result = await _dao.GetReceivingHistoryAsync(startDate, endDate);

        // Normalize PO numbers
        if (result.IsSuccess &amp;&amp; result.Data != null)
        {
            foreach (var row in result.Data)
            {
                row.PONumber = NormalizePONumber(row.PONumber);
            }
        }

        return result;
    }

    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_ReportRow&gt;&gt;&gt; GetDunnageHistoryAsync(
        DateTime startDate,
        DateTime endDate)
    {
        _logger.LogInfo($&quot;Retrieving Dunnage history from {startDate:yyyy-MM-dd} to {endDate:yyyy-MM-dd}&quot;);
        return await _dao.GetDunnageHistoryAsync(startDate, endDate);
    }

    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_ReportRow&gt;&gt;&gt; GetRoutingHistoryAsync(
        DateTime startDate,
        DateTime endDate)
    {
        _logger.LogInfo($&quot;Retrieving Routing history from {startDate:yyyy-MM-dd} to {endDate:yyyy-MM-dd}&quot;);
        var result = await _dao.GetRoutingHistoryAsync(startDate, endDate);

        // Normalize PO numbers
        if (result.IsSuccess &amp;&amp; result.Data != null)
        {
            foreach (var row in result.Data)
            {
                row.PONumber = NormalizePONumber(row.PONumber);
            }
        }

        return result;
    }

    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_ReportRow&gt;&gt;&gt; GetVolvoHistoryAsync(
        DateTime startDate,
        DateTime endDate)
    {
        _logger.LogInfo($&quot;Retrieving Volvo history from {startDate:yyyy-MM-dd} to {endDate:yyyy-MM-dd}&quot;);
        return await _dao.GetVolvoHistoryAsync(startDate, endDate);
    }

    public async Task&lt;Model_Dao_Result&lt;Dictionary&lt;string, int&gt;&gt;&gt; CheckAvailabilityAsync(
        DateTime startDate,
        DateTime endDate)
    {
        _logger.LogInfo($&quot;Checking module availability from {startDate:yyyy-MM-dd} to {endDate:yyyy-MM-dd}&quot;);
        return await _dao.CheckAvailabilityAsync(startDate, endDate);
    }

    /// &lt;summary&gt;
    /// Normalizes PO number to standard format
    /// Matches EndOfDayEmail.js normalizePO() algorithm
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;&lt;/param&gt;
    public string NormalizePONumber(string? poNumber)
    {
        // Handle null or empty
        if (string.IsNullOrWhiteSpace(poNumber))
        {
            return &quot;No PO&quot;;
        }

        poNumber = poNumber.Trim();

        // Pass through specific non-numeric values
        if (poNumber.Equals(&quot;Customer Supplied&quot;, StringComparison.OrdinalIgnoreCase))
        {
            return &quot;Customer Supplied&quot;;
        }

        // Extract numeric part and suffix
        string numericPart = new string(poNumber.TakeWhile(char.IsDigit).ToArray());
        string suffix = poNumber.Substring(numericPart.Length);

        // Validate length (must be at least 5 digits)
        if (numericPart.Length &lt; 5)
        {
            return &quot;Validate PO&quot;;
        }

        // Pad to 6 digits if exactly 5
        if (numericPart.Length == 5)
        {
            numericPart = &quot;0&quot; + numericPart;
        }

        // Format as PO-XXXXXX + optional suffix
        return &quot;PO-&quot; + numericPart + suffix;
    }

    /// &lt;summary&gt;
    /// Exports data to CSV file matching MiniUPSLabel.csv structure
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;data&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;moduleName&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;string&gt;&gt; ExportToCSVAsync(
        List&lt;Model_ReportRow&gt; data,
        string moduleName)
    {
        try
        {
            _logger.LogInfo($&quot;Exporting {data.Count} records to CSV for {moduleName} module&quot;);

            // Create CSV content based on module
            var csv = new StringBuilder();

            switch (moduleName.ToLower())
            {
                case &quot;receiving&quot;:
                    csv.AppendLine(&quot;PO Number,Part,Description,Qty,Weight,Heat/Lot,Date&quot;);
                    foreach (var row in data)
                    {
                        csv.AppendLine($&quot;\&quot;{row.PONumber ?? &quot;&quot;}\&quot;,\&quot;{row.PartNumber ?? &quot;&quot;}\&quot;,\&quot;{row.PartDescription ?? &quot;&quot;}\&quot;,{row.Quantity ?? 0},{row.WeightLbs ?? 0},\&quot;{row.HeatLotNumber ?? &quot;&quot;}\&quot;,{row.CreatedDate:yyyy-MM-dd}&quot;);
                    }
                    break;

                case &quot;dunnage&quot;:
                    csv.AppendLine(&quot;Type,Part,Specs,Qty,Date&quot;);
                    foreach (var row in data)
                    {
                        csv.AppendLine($&quot;\&quot;{row.DunnageType ?? &quot;&quot;}\&quot;,\&quot;{row.PartNumber ?? &quot;&quot;}\&quot;,\&quot;{row.SpecsCombined ?? &quot;&quot;}\&quot;,{row.Quantity ?? 0},{row.CreatedDate:yyyy-MM-dd}&quot;);
                    }
                    break;

                case &quot;routing&quot;:
                    csv.AppendLine(&quot;Deliver To,Department,Package Description,PO Number,Work Order,Date&quot;);
                    foreach (var row in data)
                    {
                        csv.AppendLine($&quot;\&quot;{row.DeliverTo ?? &quot;&quot;}\&quot;,\&quot;{row.Department ?? &quot;&quot;}\&quot;,\&quot;{row.PackageDescription ?? &quot;&quot;}\&quot;,\&quot;{row.PONumber ?? &quot;&quot;}\&quot;,\&quot;{row.WorkOrderNumber ?? &quot;&quot;}\&quot;,{row.CreatedDate:yyyy-MM-dd}&quot;);
                    }
                    break;

                case &quot;volvo&quot;:
                    csv.AppendLine(&quot;Shipment Number,PO Number,Receiver Number,Status,Date,Part Count&quot;);
                    foreach (var row in data)
                    {
                        csv.AppendLine($&quot;{row.ShipmentNumber ?? 0},\&quot;{row.PONumber ?? &quot;&quot;}\&quot;,\&quot;{row.ReceiverNumber ?? &quot;&quot;}\&quot;,\&quot;{row.Status ?? &quot;&quot;}\&quot;,{row.CreatedDate:yyyy-MM-dd},{row.PartCount ?? 0}&quot;);
                    }
                    break;

                default:
                    return Model_Dao_Result_Factory.Failure&lt;string&gt;(&quot;Unknown module name for CSV export&quot;);
            }

            // Save to file
            var timestamp = DateTime.Now.ToString(&quot;yyyyMMdd_HHmmss&quot;);
            var fileName = $&quot;EoD_{moduleName}_{timestamp}.csv&quot;;
            var appDataPath = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
            var mtmFolder = Path.Combine(appDataPath, &quot;MTM_Receiving_Application&quot;, &quot;Reports&quot;);
            Directory.CreateDirectory(mtmFolder);
            var filePath = Path.Combine(mtmFolder, fileName);

            await File.WriteAllTextAsync(filePath, csv.ToString());
            _logger.LogInfo($&quot;CSV exported successfully to {filePath}&quot;);

            return Model_Dao_Result_Factory.Success(filePath);
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error exporting CSV: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;string&gt;($&quot;CSV export failed: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Formats data as HTML table with alternating row colors grouped by date
    /// Matches Google Sheets colorHistory() function behavior
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;data&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;applyDateGrouping&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;string&gt;&gt; FormatForEmailAsync(
        List&lt;Model_ReportRow&gt; data,
        bool applyDateGrouping = true)
    {
        try
        {
            _logger.LogInfo($&quot;Formatting {data.Count} records for email&quot;);

            if (data.Count == 0)
            {
                return Model_Dao_Result_Factory.Success(&quot;&lt;p&gt;No data to display&lt;/p&gt;&quot;);
            }

            var html = new StringBuilder();
            html.AppendLine(&quot;&lt;table style=&apos;border-collapse: collapse; width: 100%;&apos;&gt;&quot;);

            // Determine module type from first row
            var moduleName = data[0].SourceModule;

            // Add header based on module type
            html.AppendLine(&quot;&lt;thead&gt;&quot;);
            html.AppendLine(&quot;&lt;tr style=&apos;background-color: #f0f0f0; font-weight: bold;&apos;&gt;&quot;);

            switch (moduleName.ToLower())
            {
                case &quot;receiving&quot;:
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;PO Number&lt;/th&gt;&quot;);
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;Part&lt;/th&gt;&quot;);
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;Description&lt;/th&gt;&quot;);
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;Qty&lt;/th&gt;&quot;);
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;Weight&lt;/th&gt;&quot;);
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;Heat/Lot&lt;/th&gt;&quot;);
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;Date&lt;/th&gt;&quot;);
                    break;

                case &quot;dunnage&quot;:
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;Type&lt;/th&gt;&quot;);
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;Part&lt;/th&gt;&quot;);
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;Specs&lt;/th&gt;&quot;);
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;Qty&lt;/th&gt;&quot;);
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;Date&lt;/th&gt;&quot;);
                    break;

                case &quot;routing&quot;:
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;Deliver To&lt;/th&gt;&quot;);
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;Department&lt;/th&gt;&quot;);
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;Package Description&lt;/th&gt;&quot;);
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;PO Number&lt;/th&gt;&quot;);
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;Date&lt;/th&gt;&quot;);
                    break;

                default:
                    html.AppendLine(&quot;&lt;th style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;Data&lt;/th&gt;&quot;);
                    break;
            }

            html.AppendLine(&quot;&lt;/tr&gt;&quot;);
            html.AppendLine(&quot;&lt;/thead&gt;&quot;);
            html.AppendLine(&quot;&lt;tbody&gt;&quot;);

            // Add rows with alternating colors (by date if grouping enabled)
            var currentDate = DateTime.MinValue;
            bool isLightRow = true;

            foreach (var row in data)
            {
                // Toggle color when date changes (if grouping enabled)
                if (applyDateGrouping &amp;&amp; row.CreatedDate.Date != currentDate.Date)
                {
                    currentDate = row.CreatedDate.Date;
                    isLightRow = !isLightRow;
                }

                var bgColor = isLightRow ? &quot;#ffffff&quot; : &quot;#f9f9f9&quot;;
                html.AppendLine($&quot;&lt;tr style=&apos;background-color: {bgColor};&apos;&gt;&quot;);

                switch (moduleName.ToLower())
                {
                    case &quot;receiving&quot;:
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.PONumber ?? &quot;&quot;}&lt;/td&gt;&quot;);
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.PartNumber ?? &quot;&quot;}&lt;/td&gt;&quot;);
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.PartDescription ?? &quot;&quot;}&lt;/td&gt;&quot;);
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.Quantity ?? 0}&lt;/td&gt;&quot;);
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.WeightLbs ?? 0}&lt;/td&gt;&quot;);
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.HeatLotNumber ?? &quot;&quot;}&lt;/td&gt;&quot;);
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.CreatedDate:yyyy-MM-dd}&lt;/td&gt;&quot;);
                        break;

                    case &quot;dunnage&quot;:
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.DunnageType ?? &quot;&quot;}&lt;/td&gt;&quot;);
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.PartNumber ?? &quot;&quot;}&lt;/td&gt;&quot;);
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.SpecsCombined ?? &quot;&quot;}&lt;/td&gt;&quot;);
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.Quantity ?? 0}&lt;/td&gt;&quot;);
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.CreatedDate:yyyy-MM-dd}&lt;/td&gt;&quot;);
                        break;

                    case &quot;routing&quot;:
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.DeliverTo ?? &quot;&quot;}&lt;/td&gt;&quot;);
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.Department ?? &quot;&quot;}&lt;/td&gt;&quot;);
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.PackageDescription ?? &quot;&quot;}&lt;/td&gt;&quot;);
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.PONumber ?? &quot;&quot;}&lt;/td&gt;&quot;);
                        html.AppendLine($&quot;&lt;td style=&apos;border: 1px solid #ddd; padding: 8px;&apos;&gt;{row.CreatedDate:yyyy-MM-dd}&lt;/td&gt;&quot;);
                        break;
                }

                html.AppendLine(&quot;&lt;/tr&gt;&quot;);

                // Toggle for next row if not grouping by date
                if (!applyDateGrouping)
                {
                    isLightRow = !isLightRow;
                }
            }

            html.AppendLine(&quot;&lt;/tbody&gt;&quot;);
            html.AppendLine(&quot;&lt;/table&gt;&quot;);

            return Model_Dao_Result_Factory.Success(html.ToString());
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error formatting email: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;string&gt;($&quot;Email formatting failed: {ex.Message}&quot;, ex);
        }
    }
}</file><file path="Module_Reporting/ViewModels/ViewModel_Reporting_Main.cs">using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Reporting.Contracts;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Core.Models.Reporting;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Reporting.ViewModels;

/// &lt;summary&gt;
/// Main ViewModel for Reporting module
/// Handles date range selection, module availability checking, and report generation
/// &lt;/summary&gt;
public partial class ViewModel_Reporting_Main : ViewModel_Shared_Base
{
    private readonly IService_Reporting _reportingService;

    #region Observable Properties

    [ObservableProperty]
    private DateTimeOffset _startDate = DateTimeOffset.Now.AddDays(-7);

    [ObservableProperty]
    private DateTimeOffset _endDate = DateTimeOffset.Now;

    [ObservableProperty]
    private bool _isReceivingChecked;

    [ObservableProperty]
    private bool _isDunnageChecked;

    [ObservableProperty]
    private bool _isRoutingChecked;

    [ObservableProperty]
    private bool _isVolvoChecked;

    [ObservableProperty]
    private bool _isReceivingEnabled = true;

    [ObservableProperty]
    private bool _isDunnageEnabled = true;

    [ObservableProperty]
    private bool _isRoutingEnabled = true;

    [ObservableProperty]
    private bool _isVolvoEnabled = true;

    [ObservableProperty]
    private int _receivingCount;

    [ObservableProperty]
    private int _dunnageCount;

    [ObservableProperty]
    private int _routingCount;

    [ObservableProperty]
    private int _volvoCount;

    [ObservableProperty]
    private ObservableCollection&lt;Model_ReportRow&gt; _reportData = new();

    [ObservableProperty]
    private string _currentModuleName = string.Empty;

    #endregion

    public ViewModel_Reporting_Main(
        IService_Reporting reportingService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger)
        : base(errorHandler, logger)
    {
        _reportingService = reportingService ?? throw new ArgumentNullException(nameof(reportingService));
        Title = &quot;End of Day Reports&quot;;
    }

    /// &lt;summary&gt;
    /// Checks data availability for each module in the selected date range
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task CheckAvailabilityAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            ShowStatus(&quot;Checking data availability...&quot;, InfoBarSeverity.Informational);

            var result = await _reportingService.CheckAvailabilityAsync(
                StartDate.DateTime,
                EndDate.DateTime);

            if (result.IsSuccess &amp;&amp; result.Data != null)
            {
                // Update counts
                ReceivingCount = result.Data.GetValueOrDefault(&quot;Receiving&quot;, 0);
                DunnageCount = result.Data.GetValueOrDefault(&quot;Dunnage&quot;, 0);
                RoutingCount = result.Data.GetValueOrDefault(&quot;Routing&quot;, 0);
                VolvoCount = result.Data.GetValueOrDefault(&quot;Volvo&quot;, 0);

                // Enable/disable checkboxes based on availability
                IsReceivingEnabled = ReceivingCount &gt; 0;
                IsDunnageEnabled = DunnageCount &gt; 0;
                IsRoutingEnabled = RoutingCount &gt; 0;
                IsVolvoEnabled = VolvoCount &gt; 0;

                var totalCount = ReceivingCount + DunnageCount + RoutingCount + VolvoCount;
                ShowStatus($&quot;Found {totalCount} total records&quot;, InfoBarSeverity.Success);
            }
            else
            {
                ShowStatus(result.ErrorMessage ?? &quot;Failed to check availability&quot;, InfoBarSeverity.Error);
            }
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error checking availability: {ex.Message}&quot;, ex);
            ShowStatus(&quot;Error checking data availability&quot;, InfoBarSeverity.Error);
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Generates report for Receiving module
    /// &lt;/summary&gt;
    [RelayCommand(CanExecute = nameof(CanGenerateReceiving))]
    private async Task GenerateReceivingReportAsync()
    {
        await GenerateReportForModuleAsync(&quot;Receiving&quot;,
            () =&gt; _reportingService.GetReceivingHistoryAsync(StartDate.DateTime, EndDate.DateTime));
    }

    private bool CanGenerateReceiving() =&gt; IsReceivingChecked &amp;&amp; IsReceivingEnabled &amp;&amp; !IsBusy;

    /// &lt;summary&gt;
    /// Generates report for Dunnage module
    /// &lt;/summary&gt;
    [RelayCommand(CanExecute = nameof(CanGenerateDunnage))]
    private async Task GenerateDunnageReportAsync()
    {
        await GenerateReportForModuleAsync(&quot;Dunnage&quot;,
            () =&gt; _reportingService.GetDunnageHistoryAsync(StartDate.DateTime, EndDate.DateTime));
    }

    private bool CanGenerateDunnage() =&gt; IsDunnageChecked &amp;&amp; IsDunnageEnabled &amp;&amp; !IsBusy;

    /// &lt;summary&gt;
    /// Generates report for Routing module
    /// &lt;/summary&gt;
    [RelayCommand(CanExecute = nameof(CanGenerateRouting))]
    private async Task GenerateRoutingReportAsync()
    {
        await GenerateReportForModuleAsync(&quot;Routing&quot;,
            () =&gt; _reportingService.GetRoutingHistoryAsync(StartDate.DateTime, EndDate.DateTime));
    }

    private bool CanGenerateRouting() =&gt; IsRoutingChecked &amp;&amp; IsRoutingEnabled &amp;&amp; !IsBusy;

    /// &lt;summary&gt;
    /// Generates report for Volvo module
    /// &lt;/summary&gt;
    [RelayCommand(CanExecute = nameof(CanGenerateVolvo))]
    private async Task GenerateVolvoReportAsync()
    {
        await GenerateReportForModuleAsync(&quot;Volvo&quot;,
            () =&gt; _reportingService.GetVolvoHistoryAsync(StartDate.DateTime, EndDate.DateTime));
    }

    private bool CanGenerateVolvo() =&gt; IsVolvoChecked &amp;&amp; IsVolvoEnabled &amp;&amp; !IsBusy;

    /// &lt;summary&gt;
    /// Exports current report data to CSV
    /// &lt;/summary&gt;
    [RelayCommand(CanExecute = nameof(CanExport))]
    private async Task ExportToCSVAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            ShowStatus(&quot;Exporting to CSV...&quot;, InfoBarSeverity.Informational);

            var result = await _reportingService.ExportToCSVAsync(
                ReportData.ToList(),
                CurrentModuleName);

            if (result.IsSuccess &amp;&amp; !string.IsNullOrEmpty(result.Data))
            {
                ShowStatus($&quot;CSV exported to: {result.Data}&quot;, InfoBarSeverity.Success);
                _logger.LogInfo($&quot;CSV exported: {result.Data}&quot;);
            }
            else
            {
                ShowStatus(result.ErrorMessage ?? &quot;Export failed&quot;, InfoBarSeverity.Error);
            }
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error exporting CSV: {ex.Message}&quot;, ex);
            ShowStatus(&quot;Error exporting CSV&quot;, InfoBarSeverity.Error);
        }
        finally
        {
            IsBusy = false;
        }
    }

    private bool CanExport() =&gt; ReportData.Count &gt; 0 &amp;&amp; !string.IsNullOrEmpty(CurrentModuleName) &amp;&amp; !IsBusy;

    /// &lt;summary&gt;
    /// Formats current report data for email and copies to clipboard
    /// &lt;/summary&gt;
    [RelayCommand(CanExecute = nameof(CanCopyEmail))]
    private async Task CopyEmailFormatAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            ShowStatus(&quot;Formatting for email...&quot;, InfoBarSeverity.Informational);

            var result = await _reportingService.FormatForEmailAsync(
                ReportData.ToList(),
                applyDateGrouping: true);

            if (result.IsSuccess &amp;&amp; !string.IsNullOrEmpty(result.Data))
            {
                // Copy to clipboard
                var dataPackage = new Windows.ApplicationModel.DataTransfer.DataPackage();
                dataPackage.SetHtmlFormat(result.Data);
                dataPackage.SetText(result.Data);
                Windows.ApplicationModel.DataTransfer.Clipboard.SetContent(dataPackage);

                ShowStatus(&quot;Email format copied to clipboard&quot;, InfoBarSeverity.Success);
                _logger.LogInfo(&quot;Email format copied to clipboard&quot;);
            }
            else
            {
                ShowStatus(result.ErrorMessage ?? &quot;Formatting failed&quot;, InfoBarSeverity.Error);
            }
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error copying email format: {ex.Message}&quot;, ex);
            ShowStatus(&quot;Error formatting for email&quot;, InfoBarSeverity.Error);
        }
        finally
        {
            IsBusy = false;
        }
    }

    private bool CanCopyEmail() =&gt; ReportData.Count &gt; 0 &amp;&amp; !IsBusy;

    /// &lt;summary&gt;
    /// Helper method to generate report for a specific module
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;moduleName&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;fetchDataFunc&quot;&gt;&lt;/param&gt;
    private async Task GenerateReportForModuleAsync(
        string moduleName,
        Func&lt;Task&lt;Module_Core.Models.Core.Model_Dao_Result&lt;List&lt;Model_ReportRow&gt;&gt;&gt;&gt; fetchDataFunc)
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            ShowStatus($&quot;Generating {moduleName} report...&quot;, InfoBarSeverity.Informational);

            var result = await fetchDataFunc();

            if (result.IsSuccess &amp;&amp; result.Data != null)
            {
                ReportData.Clear();
                foreach (var row in result.Data)
                {
                    ReportData.Add(row);
                }

                CurrentModuleName = moduleName;
                ShowStatus($&quot;Loaded {ReportData.Count} {moduleName} records&quot;, InfoBarSeverity.Success);
                _logger.LogInfo($&quot;Generated {moduleName} report: {ReportData.Count} records&quot;);

                // Update command availability
                ExportToCSVCommand.NotifyCanExecuteChanged();
                CopyEmailFormatCommand.NotifyCanExecuteChanged();
            }
            else
            {
                ShowStatus(result.ErrorMessage ?? $&quot;Failed to load {moduleName} data&quot;, InfoBarSeverity.Error);
            }
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error generating {moduleName} report: {ex.Message}&quot;, ex);
            ShowStatus($&quot;Error generating {moduleName} report&quot;, InfoBarSeverity.Error);
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Update command availability when checkbox states change
    /// &lt;/summary&gt;
    partial void OnIsReceivingCheckedChanged(bool value)
    {
        GenerateReceivingReportCommand.NotifyCanExecuteChanged();
    }

    partial void OnIsDunnageCheckedChanged(bool value)
    {
        GenerateDunnageReportCommand.NotifyCanExecuteChanged();
    }

    partial void OnIsRoutingCheckedChanged(bool value)
    {
        GenerateRoutingReportCommand.NotifyCanExecuteChanged();
    }

    partial void OnIsVolvoCheckedChanged(bool value)
    {
        GenerateVolvoReportCommand.NotifyCanExecuteChanged();
    }
}</file><file path="Module_Routing/Converters/IntToFontWeightConverter.cs">using System;
using Microsoft.UI.Text;
using Microsoft.UI.Xaml.Data;

namespace MTM_Receiving_Application.Module_Routing.Converters;

public class IntToFontWeightConverter : IValueConverter
{
    public object Convert(object? value, Type targetType, object? parameter, string language)
    {
        if (value is int currentStep &amp;&amp; parameter is string stepStr &amp;&amp; int.TryParse(stepStr, out int step))
        {
            return currentStep == step ? FontWeights.Bold : FontWeights.Normal;
        }
        return FontWeights.Normal;
    }

    public object ConvertBack(object? value, Type targetType, object? parameter, string language)
    {
        throw new NotImplementedException();
    }
}</file><file path="Module_Routing/Converters/IntToProgressBrushConverter.cs">using System;
using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Data;
using Microsoft.UI.Xaml.Media;

namespace MTM_Receiving_Application.Module_Routing.Converters;

public class IntToProgressBrushConverter : IValueConverter
{
    public object Convert(object? value, Type targetType, object? parameter, string language)
    {
        if (value is int currentStep &amp;&amp; parameter is string stepStr &amp;&amp; int.TryParse(stepStr, out int step))
        {
            if (currentStep &gt;= step)
            {
                return Application.Current.Resources[&quot;AccentFillColorDefaultBrush&quot;] as Brush ?? DependencyProperty.UnsetValue;
            }
        }
        return Application.Current.Resources[&quot;SystemControlBackgroundBaseLowBrush&quot;] as Brush ?? DependencyProperty.UnsetValue;
    }

    public object ConvertBack(object? value, Type targetType, object? parameter, string language)
    {
        throw new NotImplementedException();
    }
}</file><file path="Module_Routing/Converters/NullToBooleanConverter.cs">using System;
using Microsoft.UI.Xaml.Data;

namespace MTM_Receiving_Application.Module_Routing.Converters;

public class NullToBooleanConverter : IValueConverter
{
    public object Convert(object? value, Type targetType, object? parameter, string language)
    {
        return value != null;
    }

    public object ConvertBack(object? value, Type targetType, object? parameter, string language)
    {
        throw new NotImplementedException();
    }
}</file><file path="Module_Routing/Data/Dao_RoutingOtherReason.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Models;
using MTM_Receiving_Application.Module_Core.Helpers.Database;

namespace MTM_Receiving_Application.Module_Routing.Data;

/// &lt;summary&gt;
/// Data Access Object for routing_po_alternatives table
/// &lt;/summary&gt;
public class Dao_RoutingOtherReason
{
    private readonly string _connectionString;

    public Dao_RoutingOtherReason(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Retrieves all active other reasons
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingOtherReason&gt;&gt;&gt; GetAllActiveReasonsAsync()
    {
        try
        {
            return await Helper_Database_StoredProcedure.ExecuteListAsync&lt;Model_RoutingOtherReason&gt;(
                _connectionString,
                &quot;sp_routing_other_reason_get_all_active&quot;,
                MapFromReader
            );
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_RoutingOtherReason&gt;&gt;($&quot;Error retrieving other reasons: {ex.Message}&quot;, ex);
        }
    }

    private Model_RoutingOtherReason MapFromReader(IDataReader reader)
    {
        return new Model_RoutingOtherReason
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            ReasonCode = reader.GetString(reader.GetOrdinal(&quot;reason_code&quot;)),
            Description = reader.GetString(reader.GetOrdinal(&quot;description&quot;)),
            IsActive = reader.GetBoolean(reader.GetOrdinal(&quot;is_active&quot;)),
            DisplayOrder = reader.GetInt32(reader.GetOrdinal(&quot;display_order&quot;))
        };
    }
}</file><file path="Module_Routing/Data/Dao_RoutingUsageTracking.cs">using System;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Helpers.Database;

namespace MTM_Receiving_Application.Module_Routing.Data;

/// &lt;summary&gt;
/// Data Access Object for routing_recipient_tracker table
/// &lt;/summary&gt;
public class Dao_RoutingUsageTracking
{
    private readonly string _connectionString;

    public Dao_RoutingUsageTracking(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Increments usage count for employee-recipient pair
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;employeeNumber&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;recipientId&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; IncrementUsageAsync(int employeeNumber, int recipientId)
    {
        try
        {
            var parameters = new MySqlParameter[]
            {
                new MySqlParameter(&quot;@p_employee_number&quot;, employeeNumber),
                new MySqlParameter(&quot;@p_recipient_id&quot;, recipientId),
                new MySqlParameter(&quot;@p_status&quot;, MySqlDbType.Int32) { Direction = System.Data.ParameterDirection.Output },
                new MySqlParameter(&quot;@p_error_msg&quot;, MySqlDbType.VarChar, 500) { Direction = System.Data.ParameterDirection.Output }
            };

            return await Helper_Database_StoredProcedure.ExecuteAsync(
                &quot;sp_routing_usage_increment&quot;,
                parameters,
                _connectionString
            );
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure($&quot;Error incrementing usage: {ex.Message}&quot;, ex);
        }
    }
}</file><file path="Module_Routing/Data/Dao_RoutingUserPreference.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Models;
using MTM_Receiving_Application.Module_Core.Helpers.Database;

namespace MTM_Receiving_Application.Module_Routing.Data;

/// &lt;summary&gt;
/// Data Access Object for settings_routing_personal table
/// &lt;/summary&gt;
public class Dao_RoutingUserPreference
{
    private readonly string _connectionString;

    public Dao_RoutingUserPreference(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Retrieves user preferences by employee number
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;employeeNumber&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_RoutingUserPreference&gt;&gt; GetUserPreferenceAsync(int employeeNumber)
    {
        try
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;p_employee_number&quot;, employeeNumber }
            };

            return await Helper_Database_StoredProcedure.ExecuteSingleAsync&lt;Model_RoutingUserPreference&gt;(
                _connectionString,
                &quot;sp_routing_user_preference_get&quot;,
                MapFromReader,
                parameters
            );
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;Model_RoutingUserPreference&gt;($&quot;Error retrieving user preference: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Saves or updates user preferences
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;preference&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; SaveUserPreferenceAsync(Model_RoutingUserPreference preference)
    {
        try
        {
            var parameters = new MySqlParameter[]
            {
                new MySqlParameter(&quot;@p_employee_number&quot;, preference.EmployeeNumber),
                new MySqlParameter(&quot;@p_default_mode&quot;, preference.DefaultMode),
                new MySqlParameter(&quot;@p_enable_validation&quot;, preference.EnableValidation),
                new MySqlParameter(&quot;@p_status&quot;, MySqlDbType.Int32) { Direction = System.Data.ParameterDirection.Output },
                new MySqlParameter(&quot;@p_error_msg&quot;, MySqlDbType.VarChar, 500) { Direction = System.Data.ParameterDirection.Output }
            };

            return await Helper_Database_StoredProcedure.ExecuteAsync(
                &quot;sp_routing_user_preference_save&quot;,
                parameters,
                _connectionString
            );
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure($&quot;Error saving user preference: {ex.Message}&quot;, ex);
        }
    }

    private Model_RoutingUserPreference MapFromReader(IDataReader reader)
    {
        return new Model_RoutingUserPreference
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            EmployeeNumber = reader.GetInt32(reader.GetOrdinal(&quot;employee_number&quot;)),
            DefaultMode = reader.GetString(reader.GetOrdinal(&quot;default_mode&quot;)),
            EnableValidation = reader.GetBoolean(reader.GetOrdinal(&quot;enable_validation&quot;)),
            UpdatedDate = reader.GetDateTime(reader.GetOrdinal(&quot;updated_date&quot;))
        };
    }
}</file><file path="Module_Routing/Enums/Enum_Routing_WorkflowStep.cs">namespace MTM_Receiving_Application.Module_Routing.Enums;

/// &lt;summary&gt;
/// Workflow steps for the routing label workflow
/// &lt;/summary&gt;
public enum Enum_Routing_WorkflowStep
{
    /// &lt;summary&gt;
    /// Mode selection screen to choose between Wizard, Manual, or History
    /// &lt;/summary&gt;
    ModeSelection = -1,

    /// &lt;summary&gt;
    /// Label entry screen with data grid for creating routing labels (Manual Mode)
    /// &lt;/summary&gt;
    LabelEntry = 0,

    /// &lt;summary&gt;
    /// Wizard mode for step-by-step label creation
    /// &lt;/summary&gt;
    Wizard = 10,

    /// &lt;summary&gt;
    /// Review screen to verify label data before printing
    /// &lt;/summary&gt;
    Review = 1,

    /// &lt;summary&gt;
    /// Print/export screen for generating CSV and printing labels
    /// &lt;/summary&gt;
    Print = 2,

    /// &lt;summary&gt;
    /// History view showing archived labels grouped by date
    /// &lt;/summary&gt;
    History = 3
}</file><file path="Module_Routing/Models/Model_InforVisualPOLine.cs">using System;

namespace MTM_Receiving_Application.Module_Routing.Models;

/// &lt;summary&gt;
/// Represents PO and line information from Infor Visual ERP
/// Used for PO validation and description retrieval
/// This is NOT a database table - it&apos;s returned from Infor Visual queries
/// &lt;/summary&gt;
public class Model_InforVisualPOLine
{
    /// &lt;summary&gt;
    /// Purchase order number
    /// &lt;/summary&gt;
    public string PONumber { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Line item number
    /// &lt;/summary&gt;
    public string LineNumber { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Part/material ID from Visual
    /// &lt;/summary&gt;
    public string PartID { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Part description from Visual
    /// &lt;/summary&gt;
    public string Description { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Ordered quantity
    /// &lt;/summary&gt;
    public decimal QuantityOrdered { get; set; }

    /// &lt;summary&gt;
    /// Received quantity (to date)
    /// &lt;/summary&gt;
    public decimal QuantityReceived { get; set; }

    /// &lt;summary&gt;
    /// Remaining quantity (ordered - received)
    /// &lt;/summary&gt;
    public decimal QuantityRemaining =&gt; QuantityOrdered - QuantityReceived;

    /// &lt;summary&gt;
    /// Formatted quantity for display (trims trailing zeros)
    /// Uses G29 format to strip trailing zeros while preserving up to 29 significant digits
    /// Example: 4.0000 -&gt; 4, 4.6140 -&gt; 4.614
    /// &lt;/summary&gt;
    public string QuantityOrderedDisplay =&gt; QuantityOrdered.ToString(&quot;G29&quot;);

    /// &lt;summary&gt;
    /// Vendor name
    /// &lt;/summary&gt;
    public string VendorName { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Full specification text from PURC_LINE_BINARY
    /// &lt;/summary&gt;
    public string Specifications { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Truncated specification text for grid display (first 50 chars)
    /// &lt;/summary&gt;
    public string SpecificationsPreview =&gt; Specifications.Length &gt; 50 
        ? Specifications.Substring(0, 50) + &quot;...&quot; 
        : Specifications;

    /// &lt;summary&gt;
    /// Expected delivery date (nullable)
    /// &lt;/summary&gt;
    public DateTime? DueDate { get; set; }

    /// &lt;summary&gt;
    /// Work Order ID (if linked)
    /// &lt;/summary&gt;
    public string WorkOrder { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Customer Order ID (if linked)
    /// &lt;/summary&gt;
    public string CustomerOrder { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Formatted reference info for UI (WO or CO)
    /// &lt;/summary&gt;
    public string ReferenceInfo
    {
        get
        {
            if (!string.IsNullOrEmpty(WorkOrder)) return $&quot;WO: {WorkOrder}&quot;;
            if (!string.IsNullOrEmpty(CustomerOrder)) return $&quot;CO: {CustomerOrder}&quot;;
            return string.Empty;
        }
    }
}</file><file path="Module_Routing/Models/Model_RoutingLabel.cs">using System;

namespace MTM_Receiving_Application.Module_Routing.Models;

/// &lt;summary&gt;
/// Represents an internal routing label for packages/materials
/// Maps to routing_label_data database table
/// &lt;/summary&gt;
public class Model_RoutingLabel
{
    /// &lt;summary&gt;
    /// Auto-increment primary key
    /// &lt;/summary&gt;
    public int Id { get; set; }

    /// &lt;summary&gt;
    /// Purchase order number or &quot;OTHER&quot; for non-PO packages
    /// &lt;/summary&gt;
    public string PONumber { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Line item number or &quot;0&quot; for OTHER packages
    /// &lt;/summary&gt;
    public string LineNumber { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Part/material description (from Infor Visual or manual entry)
    /// &lt;/summary&gt;
    public string Description { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Foreign key to routing_recipients table
    /// &lt;/summary&gt;
    public int RecipientId { get; set; }

    /// &lt;summary&gt;
    /// Recipient name (from JOIN, not stored in table)
    /// &lt;/summary&gt;
    public string RecipientName { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Recipient location (from JOIN, not stored in table)
    /// &lt;/summary&gt;
    public string RecipientLocation { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Quantity of items on label
    /// &lt;/summary&gt;
    public int Quantity { get; set; }

    /// &lt;summary&gt;
    /// Employee number who created the label
    /// &lt;/summary&gt;
    public int CreatedBy { get; set; }

    /// &lt;summary&gt;
    /// Label creation timestamp
    /// &lt;/summary&gt;
    public DateTime CreatedDate { get; set; } = DateTime.Now;

    /// &lt;summary&gt;
    /// Foreign key to routing_po_alternatives table (nullable, required if PONumber=&apos;OTHER&apos;)
    /// &lt;/summary&gt;
    public int? OtherReasonId { get; set; }

    /// &lt;summary&gt;
    /// Other reason description (from JOIN, not stored in table)
    /// &lt;/summary&gt;
    public string? OtherReasonDescription { get; set; }

    /// &lt;summary&gt;
    /// Soft delete flag (0=deleted, 1=active)
    /// &lt;/summary&gt;
    public bool IsActive { get; set; } = true;

    /// &lt;summary&gt;
    /// Work Order ID (if linked) - Not stored in DB currently, used for CSV
    /// &lt;/summary&gt;
    public string WorkOrder { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Customer Order ID (if linked) - Not stored in DB currently, used for CSV
    /// &lt;/summary&gt;
    public string CustomerOrder { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Whether label has been exported to CSV file
    /// &lt;/summary&gt;
    public bool CsvExported { get; set; } = false;

    /// &lt;summary&gt;
    /// Timestamp of CSV export (nullable)
    /// &lt;/summary&gt;
    public DateTime? CsvExportDate { get; set; }
}</file><file path="Module_Routing/Services/IRoutingRecipientService.cs">using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Models;

namespace MTM_Receiving_Application.Module_Routing.Services;

/// &lt;summary&gt;
/// Service interface for recipient management: retrieval, sorting, filtering
/// &lt;/summary&gt;
public interface IRoutingRecipientService
{
    /// &lt;summary&gt;
    /// Retrieves all active recipients sorted by usage count (personalized for employee)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;employeeNumber&quot;&gt;Employee number for personalized sorting&lt;/param&gt;
    /// &lt;returns&gt;Result with list of active recipients sorted by usage count DESC&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingRecipient&gt;&gt;&gt; GetActiveRecipientsSortedByUsageAsync(int employeeNumber);

    /// &lt;summary&gt;
    /// Retrieves all recipients (including inactive) for admin purposes
    /// &lt;/summary&gt;
    /// &lt;returns&gt;Result with list of all recipients&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingRecipient&gt;&gt;&gt; GetAllRecipientsAsync();

    /// &lt;summary&gt;
    /// Retrieves a single recipient by ID
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;recipientId&quot;&gt;Recipient ID to retrieve&lt;/param&gt;
    /// &lt;returns&gt;Result with recipient data or error&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;Model_RoutingRecipient&gt;&gt; GetRecipientByIdAsync(int recipientId);

    /// &lt;summary&gt;
    /// Filters recipients by search text (name, location, department)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;recipients&quot;&gt;Full list of recipients to filter&lt;/param&gt;
    /// &lt;param name=&quot;searchText&quot;&gt;Search text (case-insensitive)&lt;/param&gt;
    /// &lt;returns&gt;Filtered list of recipients&lt;/returns&gt;
    public List&lt;Model_RoutingRecipient&gt; FilterRecipients(List&lt;Model_RoutingRecipient&gt; recipients, string searchText);

    /// &lt;summary&gt;
    /// Calculates top 5 Quick Add recipients for employee
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;employeeNumber&quot;&gt;Employee number&lt;/param&gt;
    /// &lt;returns&gt;Result with top 5 recipients (personalized if employee has 20+ labels, otherwise system-wide)&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingRecipient&gt;&gt;&gt; GetQuickAddRecipientsAsync(int employeeNumber);

    /// &lt;summary&gt;
    /// Validates that a recipient ID exists and is active (Issue #9: FK validation)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;recipientId&quot;&gt;Recipient ID to validate&lt;/param&gt;
    /// &lt;returns&gt;Result with true if recipient exists and is active, false otherwise&lt;/returns&gt;
    public Task&lt;Model_Dao_Result&lt;bool&gt;&gt; ValidateRecipientExistsAsync(int recipientId);
}</file><file path="Module_Routing/Services/RoutingRecipientService.cs">using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Data;
using MTM_Receiving_Application.Module_Routing.Models;

namespace MTM_Receiving_Application.Module_Routing.Services;

/// &lt;summary&gt;
/// Service for recipient management with smart sorting and Quick Add logic
/// &lt;/summary&gt;
public class RoutingRecipientService : IRoutingRecipientService
{
    private readonly Dao_RoutingRecipient _daoRecipient;
    private readonly IService_LoggingUtility _logger;

    public RoutingRecipientService(
        Dao_RoutingRecipient daoRecipient,
        IService_LoggingUtility logger)
    {
        _daoRecipient = daoRecipient ?? throw new ArgumentNullException(nameof(daoRecipient));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingRecipient&gt;&gt;&gt; GetActiveRecipientsSortedByUsageAsync(int employeeNumber)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Getting active recipients sorted by usage for employee {employeeNumber}&quot;);
            return await _daoRecipient.GetAllActiveRecipientsAsync();
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error getting active recipients: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_RoutingRecipient&gt;&gt;($&quot;Error getting recipients: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Retrieves all active recipients
    /// &lt;/summary&gt;
    /// &lt;returns&gt;Result with list of all active recipients&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingRecipient&gt;&gt;&gt; GetAllRecipientsAsync()
    {
        try
        {
            await _logger.LogInfoAsync(&quot;Getting all recipients (including inactive)&quot;);
            return await _daoRecipient.GetAllActiveRecipientsAsync(); // Note: DAO only returns active - would need new method for all
        }
        catch (Exception ex)
        {
            // Issue #11: Standardized error handling pattern
            await _logger.LogErrorAsync($&quot;Error getting all recipients: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_RoutingRecipient&gt;&gt;($&quot;Failed to retrieve recipients: {ex.Message}&quot;, ex);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;Model_RoutingRecipient&gt;&gt; GetRecipientByIdAsync(int recipientId)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Getting recipient by ID: {recipientId}&quot;);

            var result = await _daoRecipient.GetAllActiveRecipientsAsync();
            if (result.IsSuccess)
            {
                var recipient = result.Data?.FirstOrDefault(r =&gt; r.Id == recipientId);
                if (recipient != null)
                {
                    return Model_Dao_Result_Factory.Success(recipient);
                }
                else
                {
                    return Model_Dao_Result_Factory.Failure&lt;Model_RoutingRecipient&gt;($&quot;Recipient {recipientId} not found&quot;);
                }
            }

            return Model_Dao_Result_Factory.Failure&lt;Model_RoutingRecipient&gt;(result.ErrorMessage);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error getting recipient {recipientId}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;Model_RoutingRecipient&gt;($&quot;Error getting recipient: {ex.Message}&quot;, ex);
        }
    }

    public List&lt;Model_RoutingRecipient&gt; FilterRecipients(List&lt;Model_RoutingRecipient&gt; recipients, string searchText)
    {
        if (string.IsNullOrWhiteSpace(searchText))
        {
            return recipients;
        }

        var search = searchText.ToLowerInvariant();

        return recipients.Where(r =&gt;
            r.Name.ToLowerInvariant().Contains(search) ||
            (r.Location?.ToLowerInvariant().Contains(search) ?? false) ||
            (r.Department?.ToLowerInvariant().Contains(search) ?? false)
        ).ToList();
    }

    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingRecipient&gt;&gt;&gt; GetQuickAddRecipientsAsync(int employeeNumber)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Getting Quick Add recipients for employee {employeeNumber}&quot;);

            // Dao_RoutingRecipient.GetTopByUsageAsync implements the 20-label threshold logic
            return await _daoRecipient.GetTopRecipientsByUsageAsync(employeeNumber, 5);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error getting Quick Add recipients: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_RoutingRecipient&gt;&gt;($&quot;Error getting Quick Add recipients: {ex.Message}&quot;, ex);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;bool&gt;&gt; ValidateRecipientExistsAsync(int recipientId)
    {
        try
        {
            var recipientResult = await GetRecipientByIdAsync(recipientId);
            return Model_Dao_Result_Factory.Success(recipientResult.IsSuccess);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error validating recipient {recipientId}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;bool&gt;($&quot;Error validating recipient: {ex.Message}&quot;, ex);
        }
    }
}</file><file path="Module_Routing/Services/RoutingUserPreferenceService.cs">using System;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Data;
using MTM_Receiving_Application.Module_Routing.Enums;
using MTM_Receiving_Application.Module_Routing.Models;

namespace MTM_Receiving_Application.Module_Routing.Services;

/// &lt;summary&gt;
/// Service for user preferences (default mode, validation toggle)
/// &lt;/summary&gt;
public class RoutingUserPreferenceService : IRoutingUserPreferenceService
{
    private readonly Dao_RoutingUserPreference _daoUserPreference;
    private readonly IService_LoggingUtility _logger;

    public RoutingUserPreferenceService(
        Dao_RoutingUserPreference daoUserPreference,
        IService_LoggingUtility logger)
    {
        _daoUserPreference = daoUserPreference ?? throw new ArgumentNullException(nameof(daoUserPreference));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// &lt;summary&gt;
    /// Retrieves user preferences for the specified employee
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;employeeNumber&quot;&gt;Employee number&lt;/param&gt;
    /// &lt;returns&gt;Result with user preference or null if not found&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_RoutingUserPreference&gt;&gt; GetUserPreferenceAsync(int employeeNumber)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Getting user preference for employee {employeeNumber}&quot;);

            var result = await _daoUserPreference.GetUserPreferenceAsync(employeeNumber);

            if (result.IsSuccess &amp;&amp; result.Data != null)
            {
                return result;
            }

            // Return defaults if no preference exists
            var defaultPreference = new Model_RoutingUserPreference
            {
                EmployeeNumber = employeeNumber,
                DefaultMode = nameof(Enum_RoutingMode.WIZARD),
                EnableValidation = true
            };

            return Model_Dao_Result_Factory.Success(defaultPreference);
        }
        catch (Exception ex)
        {
            // Issue #11: Standardized error handling pattern
            await _logger.LogErrorAsync($&quot;Error getting user preference for employee {employeeNumber}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;Model_RoutingUserPreference&gt;($&quot;Failed to retrieve user preferences: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Saves or updates user preferences
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;preference&quot;&gt;User preference to save&lt;/param&gt;
    /// &lt;returns&gt;Result indicating success or failure&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&gt; SaveUserPreferenceAsync(Model_RoutingUserPreference preference)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Saving user preference for employee {preference.EmployeeNumber}&quot;);

            // Validate mode
            if (!Enum.TryParse&lt;Enum_RoutingMode&gt;(preference.DefaultMode, out _))
            {
                return Model_Dao_Result_Factory.Failure($&quot;Invalid mode: {preference.DefaultMode}&quot;);
            }

            return await _daoUserPreference.SaveUserPreferenceAsync(preference);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error saving user preference: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure($&quot;Error saving preferences: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Resets user preferences to default values
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;employeeNumber&quot;&gt;Employee number&lt;/param&gt;
    /// &lt;returns&gt;Result indicating success or failure&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&gt; ResetToDefaultsAsync(int employeeNumber)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Resetting preferences to defaults for employee {employeeNumber}&quot;);

            var defaultPreference = new Model_RoutingUserPreference
            {
                EmployeeNumber = employeeNumber,
                DefaultMode = nameof(Enum_RoutingMode.WIZARD),
                EnableValidation = true
            };

            return await _daoUserPreference.SaveUserPreferenceAsync(defaultPreference);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error resetting preferences: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure($&quot;Error resetting preferences: {ex.Message}&quot;, ex);
        }
    }
}</file><file path="Module_Routing/ViewModels/RoutingEditModeViewModel.cs">using System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Routing.Models;
using MTM_Receiving_Application.Module_Routing.Services;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Routing.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Edit Mode - searchable history with edit dialog and reprint
/// &lt;/summary&gt;
public partial class RoutingEditModeViewModel : ViewModel_Shared_Base
{
    private readonly IRoutingService _routingService;
    private readonly IRoutingRecipientService _recipientService;
    private readonly IService_UserSessionManager _sessionManager;

    [ObservableProperty]
    private ObservableCollection&lt;Model_RoutingLabel&gt; _labels = new();

    [ObservableProperty]
    private ObservableCollection&lt;Model_RoutingLabel&gt; _filteredLabels = new();

    [ObservableProperty]
    private ObservableCollection&lt;Model_RoutingRecipient&gt; _allRecipients = new();

    [ObservableProperty]
    private Model_RoutingLabel? _selectedLabel;

    [ObservableProperty]
    private string _searchText = string.Empty;

    public RoutingEditModeViewModel(
        IRoutingService routingService,
        IRoutingRecipientService recipientService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger,
        IService_UserSessionManager sessionManager)
        : base(errorHandler, logger)
    {
        _routingService = routingService;
        _recipientService = recipientService;
        _sessionManager = sessionManager;
    }

    /// &lt;summary&gt;
    /// Initialize by loading labels and recipients
    /// &lt;/summary&gt;
    public async Task InitializeAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading labels...&quot;;

            // Load all labels (limit 1000 for performance)
            var labelsResult = await _routingService.GetAllLabelsAsync(limit: 1000, offset: 0);
            if (labelsResult.IsSuccess)
            {
                Labels.Clear();
                foreach (var label in labelsResult.Data ?? new System.Collections.Generic.List&lt;Model_RoutingLabel&gt;())
                {
                    Labels.Add(label);
                }
            }

            // Load all recipients for edit dialog dropdown
            var recipientsResult = await _recipientService.GetActiveRecipientsSortedByUsageAsync(0);
            if (recipientsResult.IsSuccess)
            {
                AllRecipients.Clear();
                foreach (var recipient in recipientsResult.Data ?? new System.Collections.Generic.List&lt;Model_RoutingRecipient&gt;())
                {
                    AllRecipients.Add(recipient);
                }
            }

            // Initialize filtered collection
            ApplySearchFilter();

            StatusMessage = $&quot;Loaded {Labels.Count} labels&quot;;
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(ex, Module_Core.Models.Enums.Enum_ErrorSeverity.Medium,
                nameof(InitializeAsync), nameof(RoutingEditModeViewModel));
            StatusMessage = &quot;Error loading labels&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Apply search filter to labels collection
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;value&quot;&gt;&lt;/param&gt;
    partial void OnSearchTextChanged(string value)
    {
        ApplySearchFilter();
    }

    private void ApplySearchFilter()
    {
        FilteredLabels.Clear();

        var searchLower = SearchText?.ToLower() ?? string.Empty;

        // Issue #19: Optimized collection filtering - using ToList() to materialize before loop
        var filtered = string.IsNullOrWhiteSpace(searchLower)
            ? Labels.ToList()
            : Labels.Where(l =&gt;
                (l.PONumber?.ToLower().Contains(searchLower) ?? false) ||
                (l.RecipientName?.ToLower().Contains(searchLower) ?? false) ||
                (l.Description?.ToLower().Contains(searchLower) ?? false)
            ).ToList();

        foreach (var label in filtered)
        {
            FilteredLabels.Add(label);
        }

        StatusMessage = $&quot;Showing {FilteredLabels.Count} of {Labels.Count} labels&quot;;
    }

    /// &lt;summary&gt;
    /// Edit selected label - to be called from dialog
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;editedLabel&quot;&gt;&lt;/param&gt;
    [RelayCommand]
    private async Task SaveEditedLabelAsync(Model_RoutingLabel editedLabel)
    {
        if (IsBusy || SelectedLabel == null)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Saving changes...&quot;;

            // Compare and log changes
            await CompareAndLogChangesAsync(SelectedLabel, editedLabel);

            // Issue #13: Update label - Get current employee number from session
            // Issue #7: Implemented using IService_UserSessionManager
            var currentEmployeeNumber = _sessionManager.CurrentSession?.User?.EmployeeNumber ?? 0;
            var updateResult = await _routingService.UpdateLabelAsync(editedLabel, currentEmployeeNumber);

            if (updateResult.IsSuccess)
            {
                // Update in collection
                var index = Labels.IndexOf(SelectedLabel);
                if (index &gt;= 0)
                {
                    Labels[index] = editedLabel;
                }

                ApplySearchFilter();
                StatusMessage = &quot;Label updated successfully&quot;;
            }
            else
            {
                await _errorHandler.ShowUserErrorAsync(updateResult.ErrorMessage, &quot;Update Failed&quot;, nameof(SaveEditedLabelAsync));
                StatusMessage = &quot;Failed to update label&quot;;
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(ex, Module_Core.Models.Enums.Enum_ErrorSeverity.Medium,
                nameof(SaveEditedLabelAsync), nameof(RoutingEditModeViewModel));
            StatusMessage = &quot;Error saving changes&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Compare old and new label - history logging handled by RoutingService.UpdateLabelAsync
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;oldLabel&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;newLabel&quot;&gt;&lt;/param&gt;
    private async Task CompareAndLogChangesAsync(Model_RoutingLabel oldLabel, Model_RoutingLabel newLabel)
    {
        // History logging is now handled automatically by RoutingService.UpdateLabelAsync
        // This method is kept for potential future custom validation before save
        await Task.CompletedTask;
    }

    /// &lt;summary&gt;
    /// Reprint selected label (CSV export only, no DB update)
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task ReprintLabelAsync()
    {
        if (IsBusy || SelectedLabel == null)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Reprinting label...&quot;;

            // Export single label to CSV
            var exportResult = await _routingService.ExportLabelToCsvAsync(SelectedLabel);

            if (exportResult.IsSuccess)
            {
                StatusMessage = &quot;Label reprinted successfully&quot;;
            }
            else
            {
                await _errorHandler.ShowUserErrorAsync(exportResult.ErrorMessage, &quot;Reprint Failed&quot;, nameof(ReprintLabelAsync));
                StatusMessage = &quot;Failed to reprint label&quot;;
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(ex, Module_Core.Models.Enums.Enum_ErrorSeverity.Low,
                nameof(ReprintLabelAsync), nameof(RoutingEditModeViewModel));
            StatusMessage = &quot;Error reprinting label&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }
}</file><file path="Module_Routing/ViewModels/RoutingManualEntryViewModel.cs">using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Routing.Models;
using MTM_Receiving_Application.Module_Routing.Services;
using MTM_Receiving_Application.Module_Shared.ViewModels;


namespace MTM_Receiving_Application.Module_Routing.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Manual Entry mode - batch label creation via DataGrid
/// &lt;/summary&gt;
public partial class RoutingManualEntryViewModel : ViewModel_Shared_Base
{
    private readonly IRoutingService _routingService;
    private readonly IRoutingInforVisualService _inforVisualService;
    private readonly IRoutingRecipientService _recipientService;
    private readonly IRoutingUsageTrackingService _usageTrackingService;

    [ObservableProperty]
    private ObservableCollection&lt;Model_RoutingLabel&gt; _labels = new();

    [ObservableProperty]
    private ObservableCollection&lt;Model_RoutingRecipient&gt; _allRecipients = new();

    [ObservableProperty]
    private Model_RoutingLabel? _selectedLabel;

    [ObservableProperty]
    private int _labelCount;

    public RoutingManualEntryViewModel(
        IRoutingService routingService,
        IRoutingInforVisualService inforVisualService,
        IRoutingRecipientService recipientService,
        IRoutingUsageTrackingService usageTrackingService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger)
        : base(errorHandler, logger)
    {
        _routingService = routingService;
        _inforVisualService = inforVisualService;
        _recipientService = recipientService;
        _usageTrackingService = usageTrackingService;
    }

    /// &lt;summary&gt;
    /// Initialize - load recipients
    /// &lt;/summary&gt;
    public async Task InitializeAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading recipients...&quot;;

            var recipientsResult = await _recipientService.GetAllRecipientsAsync();
            if (recipientsResult.IsSuccess)
            {
                AllRecipients = new ObservableCollection&lt;Model_RoutingRecipient&gt;(recipientsResult.Data ?? new List&lt;Model_RoutingRecipient&gt;());
                StatusMessage = $&quot;{AllRecipients.Count} recipients loaded&quot;;
            }
            else
            {
                await _errorHandler.ShowUserErrorAsync(recipientsResult.ErrorMessage, &quot;Load Failed&quot;, nameof(InitializeAsync));
            }

            // Add initial blank row
            AddNewRow();
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(ex, Module_Core.Models.Enums.Enum_ErrorSeverity.Medium,
                nameof(InitializeAsync), nameof(RoutingManualEntryViewModel));
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Add new blank row to collection
    /// &lt;/summary&gt;
    [RelayCommand]
    private void AddNewRow()
    {
        var newLabel = new Model_RoutingLabel
        {
            CreatedDate = DateTime.Now,
            Quantity = 1
        };
        Labels.Add(newLabel);
        LabelCount = Labels.Count;
        StatusMessage = $&quot;{LabelCount} labels ready to save&quot;;
    }

    /// &lt;summary&gt;
    /// Delete selected row
    /// &lt;/summary&gt;
    [RelayCommand(CanExecute = nameof(CanDeleteRow))]
    private void DeleteSelectedRow()
    {
        if (SelectedLabel != null)
        {
            Labels.Remove(SelectedLabel);
            LabelCount = Labels.Count;
            StatusMessage = $&quot;{LabelCount} labels ready to save&quot;;
        }
    }

    private bool CanDeleteRow() =&gt; SelectedLabel != null &amp;&amp; !IsBusy;

    /// &lt;summary&gt;
    /// Validate PO and populate Part info
    /// Called from View&apos;s CellEditEnding event
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;label&quot;&gt;&lt;/param&gt;
    public async Task ValidatePOAsync(Model_RoutingLabel label)
    {
        if (string.IsNullOrWhiteSpace(label.PONumber))
        {
            return;
        }

        try
        {
            var poResult = await _inforVisualService.ValidatePoNumberAsync(label.PONumber);
            if (poResult.IsSuccess)
            {
                var linesResult = await _inforVisualService.GetPoLinesAsync(label.PONumber);
                if (linesResult.IsSuccess &amp;&amp; linesResult.Data?.Any() == true)
                {
                    // If only one line, auto-populate
                    if (linesResult.Data.Count == 1)
                    {
                        var line = linesResult.Data.First();
                        label.Description = line.PartID;
                        label.LineNumber = line.LineNumber.ToString();
                    }
                    // Issue #13: Multi-line PO selection feature
                    // If PO has multiple lines, show dialog/grid for user to select specific line
                    // Requires: ViewModel_LineSelectionDialog with DataGrid of Model_InforVisualPOLine
                    // Priority: MEDIUM - Manual entry is alternate workflow, single-line POs are common
                    // Current behavior: Auto-selects if 1 line, leaves blank if multiple (user enters manually)
                }
            }
            else
            {
                // PO not found - user can treat as OTHER
                StatusMessage = $&quot;PO {label.PONumber} not found in Infor Visual&quot;;
            }
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error validating PO: {ex.Message}&quot;, ex, nameof(ValidatePOAsync));
        }
    }

    /// &lt;summary&gt;
    /// Save all labels in batch
    /// &lt;/summary&gt;
    [RelayCommand(CanExecute = nameof(CanSaveAll))]
    private async Task SaveAllLabelsAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Validating labels...&quot;;

            // Validate all rows
            var validationErrors = ValidateAllRows();
            if (validationErrors.Count &gt; 0)
            {
                await _errorHandler.ShowUserErrorAsync(string.Join(&quot;\n&quot;, validationErrors), &quot;Validation Failed&quot;, nameof(SaveAllLabelsAsync));
                return;
            }

            StatusMessage = $&quot;Creating {Labels.Count} labels...&quot;;
            int successCount = 0;

            foreach (var label in Labels.ToList())
            {
                // Create label
                var createResult = await _routingService.CreateLabelAsync(label);
                if (createResult.IsSuccess)
                {
                    successCount++;

                    // Increment usage tracking
                    if (label.RecipientId &gt; 0)
                    {
                        await _usageTrackingService.IncrementUsageCountAsync(
                            label.CreatedBy,
                            label.RecipientId);
                    }
                }
                else
                {
                    await _logger.LogErrorAsync($&quot;Failed to create label: {createResult.ErrorMessage}&quot;);
                }
            }

            StatusMessage = $&quot;Created {successCount} of {Labels.Count} labels. Exporting to CSV...&quot;;

            // Issue #13: Batch CSV export after label creation
            // ExportLabelsToCSVAsync method would combine multiple labels into single CSV file
            // Each label is already exported individually via CreateLabelAsync background task
            // Priority: LOW - Individual CSV export is functional, batch is optimization
            // var exportResult = await _routingService.ExportLabelsToCSVAsync(Labels.ToList());
            // if (!exportResult.IsSuccess)
            // {
            //     await _logger.LogWarningAsync($&quot;CSV export failed: {exportResult.ErrorMessage}&quot;);
            // }

            // Clear collection
            Labels.Clear();
            LabelCount = 0;
            StatusMessage = $&quot;Successfully created and exported {successCount} labels!&quot;;

            // Add new blank row for next batch
            AddNewRow();
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(ex, Module_Core.Models.Enums.Enum_ErrorSeverity.Error,
                nameof(SaveAllLabelsAsync), nameof(RoutingManualEntryViewModel));
        }
        finally
        {
            IsBusy = false;
        }
    }

    private bool CanSaveAll() =&gt; !IsBusy &amp;&amp; Labels.Count &gt; 0;

    private System.Collections.Generic.List&lt;string&gt; ValidateAllRows()
    {
        var errors = new System.Collections.Generic.List&lt;string&gt;();

        for (int i = 0; i &lt; Labels.Count; i++)
        {
            var label = Labels[i];
            int rowNum = i + 1;

            if (string.IsNullOrWhiteSpace(label.PONumber) &amp;&amp; !label.OtherReasonId.HasValue)
            {
                errors.Add($&quot;Row {rowNum}: PO Number or OTHER reason required&quot;);
            }

            if (label.RecipientId == 0)
            {
                errors.Add($&quot;Row {rowNum}: Recipient required&quot;);
            }

            if (label.Quantity &lt;= 0)
            {
                errors.Add($&quot;Row {rowNum}: Quantity must be greater than 0&quot;);
            }
        }

        return errors;
    }

    partial void OnSelectedLabelChanged(Model_RoutingLabel? value)
    {
        DeleteSelectedRowCommand.NotifyCanExecuteChanged();
    }

    partial void OnLabelsChanged(ObservableCollection&lt;Model_RoutingLabel&gt; value)
    {
        SaveAllLabelsCommand.NotifyCanExecuteChanged();
    }
}</file><file path="Module_Routing/Views/RoutingModeSelectionView.xaml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;Page
    x:Class=&quot;MTM_Receiving_Application.Module_Routing.Views.RoutingModeSelectionView&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:viewmodels=&quot;using:MTM_Receiving_Application.Module_Routing.ViewModels&quot;
    Loaded=&quot;OnPageLoaded&quot;&gt;

    &lt;Grid&gt;
        &lt;StackPanel Spacing=&quot;32&quot; HorizontalAlignment=&quot;Center&quot; VerticalAlignment=&quot;Center&quot;&gt;
            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;24&quot;&gt;
                
                &lt;!-- Wizard Mode Column --&gt;
                &lt;StackPanel Spacing=&quot;12&quot;&gt;
                    &lt;Button Command=&quot;{x:Bind ViewModel.SelectWizardModeCommand}&quot;
                            Width=&quot;280&quot; Height=&quot;180&quot;
                            Padding=&quot;20&quot;
                            Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                            BorderThickness=&quot;1&quot;
                            CornerRadius=&quot;8&quot;
                            AutomationProperties.Name=&quot;Wizard Mode&quot;&gt;
                        &lt;StackPanel Spacing=&quot;12&quot;&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE82D;&quot; FontSize=&quot;48&quot; Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                            &lt;TextBlock Text=&quot;Wizard Mode&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; HorizontalAlignment=&quot;Center&quot;/&gt;
                            &lt;TextBlock Text=&quot;Step-by-step guided workflow with Quick Add buttons.&quot;
                                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                                       TextWrapping=&quot;Wrap&quot;
                                       TextAlignment=&quot;Center&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Button&gt;

                    &lt;CheckBox 
                        Content=&quot;Set as default mode&quot;
                        IsChecked=&quot;{x:Bind ViewModel.IsWizardDefault, Mode=TwoWay}&quot;
                        Command=&quot;{x:Bind ViewModel.SetWizardAsDefaultCommand}&quot;
                        CommandParameter=&quot;{Binding IsChecked, RelativeSource={RelativeSource Self}}&quot;
                        HorizontalAlignment=&quot;Center&quot;/&gt;
                &lt;/StackPanel&gt;

                &lt;!-- Manual Entry Column --&gt;
                &lt;StackPanel Spacing=&quot;12&quot;&gt;
                    &lt;Button Command=&quot;{x:Bind ViewModel.SelectManualEntryModeCommand}&quot;
                            Width=&quot;280&quot; Height=&quot;180&quot;
                            Padding=&quot;20&quot;
                            Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                            BorderThickness=&quot;1&quot;
                            CornerRadius=&quot;8&quot;
                            AutomationProperties.Name=&quot;Manual Entry Mode&quot;&gt;
                        &lt;StackPanel Spacing=&quot;12&quot;&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE745;&quot; FontSize=&quot;48&quot; Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                            &lt;TextBlock Text=&quot;Manual Entry&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; HorizontalAlignment=&quot;Center&quot;/&gt;
                            &lt;TextBlock Text=&quot;Batch entry using editable grid. Ideal for creating multiple labels quickly.&quot;
                                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                                       TextWrapping=&quot;Wrap&quot;
                                       TextAlignment=&quot;Center&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Button&gt;
                    
                    &lt;CheckBox Content=&quot;Set as default mode&quot;
                              IsChecked=&quot;{x:Bind ViewModel.IsManualDefault, Mode=TwoWay}&quot;
                              Command=&quot;{x:Bind ViewModel.SetManualAsDefaultCommand}&quot;
                              CommandParameter=&quot;{Binding IsChecked, RelativeSource={RelativeSource Self}}&quot;
                              HorizontalAlignment=&quot;Center&quot;/&gt;
                &lt;/StackPanel&gt;

                &lt;!-- Edit Mode Column --&gt;
                &lt;StackPanel Spacing=&quot;12&quot;&gt;
                    &lt;Button Command=&quot;{x:Bind ViewModel.SelectEditModeCommand}&quot;
                            Width=&quot;280&quot; Height=&quot;180&quot;
                            Padding=&quot;20&quot;
                            Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                            BorderThickness=&quot;1&quot;
                            CornerRadius=&quot;8&quot;
                            AutomationProperties.Name=&quot;Edit Mode&quot;&gt;
                        &lt;StackPanel Spacing=&quot;12&quot;&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE70F;&quot; FontSize=&quot;48&quot; Foreground=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;/&gt;
                            &lt;TextBlock Text=&quot;Edit Mode&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; HorizontalAlignment=&quot;Center&quot;/&gt;
                            &lt;TextBlock Text=&quot;Search and edit existing labels. Supports reprinting and audit trail.&quot;
                                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                                       TextWrapping=&quot;Wrap&quot;
                                       TextAlignment=&quot;Center&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Button&gt;

                    &lt;CheckBox Content=&quot;Set as default mode&quot;
                              IsChecked=&quot;{x:Bind ViewModel.IsEditDefault, Mode=TwoWay}&quot;
                              Command=&quot;{x:Bind ViewModel.SetEditAsDefaultCommand}&quot;
                              CommandParameter=&quot;{Binding IsChecked, RelativeSource={RelativeSource Self}}&quot;
                              HorizontalAlignment=&quot;Center&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/StackPanel&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Routing/Views/RoutingWizardContainerView.xaml">&lt;Page
    x:Class=&quot;MTM_Receiving_Application.Module_Routing.Views.RoutingWizardContainerView&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:vm=&quot;using:MTM_Receiving_Application.Module_Routing.ViewModels&quot;
    xmlns:views=&quot;using:MTM_Receiving_Application.Module_Routing.Views&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Routing.Converters&quot;
    xmlns:coreConverters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;&gt;

    &lt;Page.Resources&gt;
        &lt;converters:IntToFontWeightConverter x:Key=&quot;IntToFontWeightConverter&quot;/&gt;
        &lt;converters:IntToProgressBrushConverter x:Key=&quot;IntToProgressBrushConverter&quot;/&gt;
        &lt;coreConverters:Converter_IntToVisibility x:Key=&quot;IntToVisibilityConverter&quot;/&gt;
    &lt;/Page.Resources&gt;

    &lt;Grid Padding=&quot;24&quot; RowSpacing=&quot;16&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header with Cancel Button --&gt;
        &lt;Grid Grid.Row=&quot;0&quot;&gt;
            &lt;Grid.ColumnDefinitions&gt;
                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
            &lt;/Grid.ColumnDefinitions&gt;

            &lt;TextBlock Grid.Column=&quot;0&quot;
                       Text=&quot;Routing Label - Wizard Mode&quot; 
                       Style=&quot;{StaticResource TitleTextBlockStyle}&quot;/&gt;

            &lt;Button Grid.Column=&quot;1&quot;
                    Content=&quot;Cancel&quot;
                    Command=&quot;{x:Bind ViewModel.CancelCommand}&quot;/&gt;
        &lt;/Grid&gt;

        &lt;!-- Progress Indicator --&gt;
        &lt;StackPanel Grid.Row=&quot;1&quot; Spacing=&quot;8&quot;&gt;
            &lt;TextBlock Text=&quot;{x:Bind ViewModel.StatusMessage, Mode=OneWay}&quot; 
                       Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;/&gt;
            
            &lt;Grid&gt;
                &lt;Grid.ColumnDefinitions&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;/Grid.ColumnDefinitions&gt;

                &lt;!-- Step 1 Indicator --&gt;
                &lt;StackPanel Grid.Column=&quot;0&quot; Spacing=&quot;4&quot;&gt;
                    &lt;Border Height=&quot;4&quot; 
                            Background=&quot;{ThemeResource AccentFillColorDefaultBrush}&quot;
                            CornerRadius=&quot;2&quot;/&gt;
                    &lt;TextBlock Text=&quot;1. PO Selection&quot; 
                               HorizontalAlignment=&quot;Center&quot;
                               FontWeight=&quot;{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntToFontWeightConverter}, ConverterParameter=1}&quot;/&gt;
                &lt;/StackPanel&gt;

                &lt;!-- Step 2 Indicator --&gt;
                &lt;StackPanel Grid.Column=&quot;1&quot; Spacing=&quot;4&quot; Margin=&quot;8,0&quot;&gt;
                    &lt;Border Height=&quot;4&quot; 
                            Background=&quot;{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntToProgressBrushConverter}, ConverterParameter=2}&quot;
                            CornerRadius=&quot;2&quot;/&gt;
                    &lt;TextBlock Text=&quot;2. Recipient&quot; 
                               HorizontalAlignment=&quot;Center&quot;
                               FontWeight=&quot;{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntToFontWeightConverter}, ConverterParameter=2}&quot;/&gt;
                &lt;/StackPanel&gt;

                &lt;!-- Step 3 Indicator --&gt;
                &lt;StackPanel Grid.Column=&quot;2&quot; Spacing=&quot;4&quot;&gt;
                    &lt;Border Height=&quot;4&quot; 
                            Background=&quot;{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntToProgressBrushConverter}, ConverterParameter=3}&quot;
                            CornerRadius=&quot;2&quot;/&gt;
                    &lt;TextBlock Text=&quot;3. Review&quot; 
                               HorizontalAlignment=&quot;Center&quot;
                               FontWeight=&quot;{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntToFontWeightConverter}, ConverterParameter=3}&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/Grid&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Step Content (UserControl hosting) --&gt;
        &lt;Grid Grid.Row=&quot;2&quot;&gt;
            &lt;!-- Step 1: PO Selection --&gt;
            &lt;views:RoutingWizardStep1View 
                Visibility=&quot;{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=1}&quot;/&gt;

            &lt;!-- Step 2: Recipient Selection --&gt;
            &lt;views:RoutingWizardStep2View 
                Visibility=&quot;{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=2}&quot;/&gt;

            &lt;!-- Step 3: Review --&gt;
            &lt;views:RoutingWizardStep3View 
                Visibility=&quot;{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=3}&quot;/&gt;
        &lt;/Grid&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Routing/Views/RoutingWizardStep2View.xaml">&lt;Page
    x:Class=&quot;MTM_Receiving_Application.Module_Routing.Views.RoutingWizardStep2View&quot;
    x:Name=&quot;RootPage&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:vm=&quot;using:MTM_Receiving_Application.Module_Routing.ViewModels&quot;
    xmlns:models=&quot;using:MTM_Receiving_Application.Module_Routing.Models&quot;
    xmlns:coreConverters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    Loaded=&quot;OnPageLoaded&quot;&gt;

    &lt;Page.Resources&gt;
        &lt;coreConverters:Converter_BooleanToVisibility x:Key=&quot;BooleanToVisibilityConverter&quot;/&gt;
        &lt;coreConverters:Converter_IntToVisibility x:Key=&quot;IntToVisibilityConverter&quot;/&gt;
    &lt;/Page.Resources&gt;

    &lt;Grid Padding=&quot;20&quot; RowSpacing=&quot;16&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header --&gt;
        &lt;TextBlock Grid.Row=&quot;0&quot; 
                   Text=&quot;Step 2: Recipient Selection&quot; 
                   Style=&quot;{StaticResource TitleTextBlockStyle}&quot;/&gt;

        &lt;!-- Search Box --&gt;
        &lt;StackPanel Grid.Row=&quot;1&quot; Spacing=&quot;8&quot;&gt;
            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                &lt;FontIcon Glyph=&quot;&amp;#xE721;&quot; 
                         FontSize=&quot;16&quot;
                         Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                &lt;TextBlock Text=&quot;Search Recipients&quot; 
                          Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot;/&gt;
            &lt;/StackPanel&gt;
            &lt;TextBox PlaceholderText=&quot;Search by name, location, or department&quot;
                     Text=&quot;{x:Bind ViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Recipients List --&gt;
        &lt;Border Grid.Row=&quot;2&quot; 
                Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                BorderThickness=&quot;1&quot;
                CornerRadius=&quot;8&quot;&gt;
            &lt;ListView ItemsSource=&quot;{x:Bind ViewModel.FilteredRecipients, Mode=OneWay}&quot;
                      SelectedItem=&quot;{x:Bind ViewModel.SelectedRecipient, Mode=TwoWay}&quot;
                      SelectionMode=&quot;Single&quot;
                      KeyDown=&quot;ListView_KeyDown&quot;&gt;
                &lt;ListView.HeaderTemplate&gt;
                    &lt;DataTemplate&gt;
                        &lt;Grid Padding=&quot;8&quot; ColumnSpacing=&quot;12&quot;&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;2*&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            &lt;TextBlock Grid.Column=&quot;0&quot; Text=&quot;Name&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                            &lt;TextBlock Grid.Column=&quot;1&quot; Text=&quot;Location&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                            &lt;TextBlock Grid.Column=&quot;2&quot; Text=&quot;Department&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                        &lt;/Grid&gt;
                    &lt;/DataTemplate&gt;
                &lt;/ListView.HeaderTemplate&gt;
                &lt;ListView.ItemTemplate&gt;
                    &lt;DataTemplate x:DataType=&quot;models:Model_RoutingRecipient&quot;&gt;
                        &lt;Grid Padding=&quot;8&quot; ColumnSpacing=&quot;12&quot;&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;2*&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            &lt;TextBlock Grid.Column=&quot;0&quot; Text=&quot;{x:Bind Name}&quot;/&gt;
                            &lt;TextBlock Grid.Column=&quot;1&quot; Text=&quot;{x:Bind Location}&quot;/&gt;
                            &lt;TextBlock Grid.Column=&quot;2&quot; Text=&quot;{x:Bind Department}&quot;/&gt;
                        &lt;/Grid&gt;
                    &lt;/DataTemplate&gt;
                &lt;/ListView.ItemTemplate&gt;
            &lt;/ListView&gt;
        &lt;/Border&gt;

        &lt;!-- Status Bar --&gt;
        &lt;StackPanel Grid.Row=&quot;3&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot;&gt;
            &lt;ProgressRing IsActive=&quot;{x:Bind ViewModel.IsBusy, Mode=OneWay}&quot;
                          Width=&quot;20&quot; Height=&quot;20&quot;/&gt;
            &lt;TextBlock Text=&quot;{x:Bind ViewModel.StatusMessage, Mode=OneWay}&quot;
                       VerticalAlignment=&quot;Center&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Action Buttons --&gt;
        &lt;StackPanel Grid.Row=&quot;4&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot; HorizontalAlignment=&quot;Right&quot;&gt;
            &lt;Button Content=&quot;Back&quot;
                    Command=&quot;{x:Bind ViewModel.NavigateBackToStep1Command}&quot;
                    Visibility=&quot;{x:Bind ViewModel.IsEditingFromReview, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}&quot;/&gt;
            &lt;Button Content=&quot;{x:Bind ViewModel.NavigationButtonText, Mode=OneWay}&quot;
                    Command=&quot;{x:Bind ViewModel.ProceedToStep3Command}&quot;
                    Style=&quot;{StaticResource AccentButtonStyle}&quot;/&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Settings/Data/Dao_PackageTypeMappings.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Settings.Models;

namespace MTM_Receiving_Application.Module_Settings.Data;

/// &lt;summary&gt;
/// Data Access Object for package type mappings (part prefix  package type)
/// Instance-based pattern with connection string injection
/// &lt;/summary&gt;
public class Dao_PackageTypeMappings
{
    private readonly string _connectionString;

    public Dao_PackageTypeMappings(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Retrieves all active package type mappings
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_PackageTypeMapping&gt;&gt;&gt; GetAllAsync()
    {
        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Receiving_PackageTypeMappings_GetAll&quot;,
            MapFromReader
        );
    }

    /// &lt;summary&gt;
    /// Gets package type for a part prefix (with default fallback)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;partPrefix&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;string&gt;&gt; GetByPrefixAsync(string partPrefix)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_part_prefix&quot;, partPrefix }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Receiving_PackageTypeMappings_GetByPrefix&quot;,
            reader =&gt; reader.IsDBNull(reader.GetOrdinal(&quot;package_type&quot;))
                ? &quot;Skids&quot;
                : reader.GetString(reader.GetOrdinal(&quot;package_type&quot;)),
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Inserts a new package type mapping
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;mapping&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;createdBy&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; InsertAsync(Model_PackageTypeMapping mapping, int createdBy)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_part_prefix&quot;, mapping.PartPrefix },
            { &quot;p_package_type&quot;, mapping.PackageType },
            { &quot;p_is_default&quot;, mapping.IsDefault },
            { &quot;p_display_order&quot;, mapping.DisplayOrder },
            { &quot;p_created_by&quot;, createdBy }
        };

        var result = await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Receiving_PackageTypeMappings_Insert&quot;,
            reader =&gt; reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            parameters
        );

        return result;
    }

    /// &lt;summary&gt;
    /// Updates an existing package type mapping
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;mapping&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; UpdateAsync(Model_PackageTypeMapping mapping)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_id&quot;, mapping.Id },
            { &quot;p_package_type&quot;, mapping.PackageType },
            { &quot;p_is_default&quot;, mapping.IsDefault },
            { &quot;p_display_order&quot;, mapping.DisplayOrder }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Receiving_PackageTypeMappings_Update&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Deletes a package type mapping (soft delete)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; DeleteAsync(int id)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_id&quot;, id }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Receiving_PackageTypeMappings_Delete&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Maps database reader to Model_PackageTypeMapping
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;reader&quot;&gt;&lt;/param&gt;
    private static Model_PackageTypeMapping MapFromReader(IDataReader reader)
    {
        return new Model_PackageTypeMapping
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            PartPrefix = reader.GetString(reader.GetOrdinal(&quot;part_prefix&quot;)),
            PackageType = reader.GetString(reader.GetOrdinal(&quot;package_type&quot;)),
            IsDefault = reader.GetBoolean(reader.GetOrdinal(&quot;is_default&quot;)),
            DisplayOrder = reader.GetInt32(reader.GetOrdinal(&quot;display_order&quot;)),
            IsActive = reader.GetBoolean(reader.GetOrdinal(&quot;is_active&quot;)),
            CreatedAt = reader.GetDateTime(reader.GetOrdinal(&quot;created_at&quot;)),
            UpdatedAt = reader.GetDateTime(reader.GetOrdinal(&quot;updated_at&quot;)),
            CreatedBy = reader.IsDBNull(reader.GetOrdinal(&quot;created_by&quot;)) ? null : reader.GetInt32(reader.GetOrdinal(&quot;created_by&quot;))
        };
    }
}</file><file path="Module_Settings/Data/Dao_ScheduledReport.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Settings.Models;

namespace MTM_Receiving_Application.Module_Settings.Data;

/// &lt;summary&gt;
/// Data Access Object for scheduled reports CRUD operations
/// Instance-based pattern with connection string injection
/// &lt;/summary&gt;
public class Dao_ScheduledReport
{
    private readonly string _connectionString;

    public Dao_ScheduledReport(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Retrieves all active scheduled reports
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_ScheduledReport&gt;&gt;&gt; GetAllAsync()
    {
        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Settings_ScheduledReport_GetAll&quot;,
            MapFromReader
        );
    }

    /// &lt;summary&gt;
    /// Retrieves a scheduled report by ID
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_ScheduledReport&gt;&gt; GetByIdAsync(int id)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_id&quot;, id }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Settings_ScheduledReport_GetById&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Retrieves scheduled reports that are due for execution
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_ScheduledReport&gt;&gt;&gt; GetDueAsync()
    {
        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Settings_ScheduledReport_GetDue&quot;,
            MapFromReader
        );
    }

    /// &lt;summary&gt;
    /// Retrieves active scheduled reports that have a next run date (spec compatibility)
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_ScheduledReport&gt;&gt;&gt; GetActiveAsync()
    {
        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Settings_ScheduledReport_GetActive&quot;,
            MapFromReader
        );
    }

    /// &lt;summary&gt;
    /// Inserts a new scheduled report
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;report&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;createdBy&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; InsertAsync(Model_ScheduledReport report, int createdBy)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_report_type&quot;, report.ReportType },
            { &quot;p_schedule&quot;, report.Schedule },
            { &quot;p_email_recipients&quot;, report.EmailRecipients ?? string.Empty },
            { &quot;p_next_run_date&quot;, report.NextRunDate ?? (object)DBNull.Value },
            { &quot;p_created_by&quot;, createdBy }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Settings_ScheduledReport_Insert&quot;,
            reader =&gt; reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Updates an existing scheduled report
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;report&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; UpdateAsync(Model_ScheduledReport report)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_id&quot;, report.Id },
            { &quot;p_report_type&quot;, report.ReportType },
            { &quot;p_schedule&quot;, report.Schedule },
            { &quot;p_email_recipients&quot;, report.EmailRecipients ?? string.Empty },
            { &quot;p_next_run_date&quot;, report.NextRunDate ?? (object)DBNull.Value }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Settings_ScheduledReport_Update&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Updates the last run date and calculates next run date
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;lastRunDate&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;nextRunDate&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; UpdateLastRunAsync(int id, DateTime lastRunDate, DateTime nextRunDate)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_id&quot;, id },
            { &quot;p_last_run_date&quot;, lastRunDate },
            { &quot;p_next_run_date&quot;, nextRunDate }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Settings_ScheduledReport_UpdateLastRun&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Deletes a scheduled report (soft delete)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; DeleteAsync(int id)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_id&quot;, id }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Settings_ScheduledReport_Delete&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Toggles a scheduled report&apos;s active status
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;isActive&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; ToggleActiveAsync(int id, bool isActive)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_id&quot;, id },
            { &quot;p_is_active&quot;, isActive }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Settings_ScheduledReport_ToggleActive&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Maps database reader to Model_ScheduledReport
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;reader&quot;&gt;&lt;/param&gt;
    private static Model_ScheduledReport MapFromReader(IDataReader reader)
    {
        return new Model_ScheduledReport
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            ReportType = reader.GetString(reader.GetOrdinal(&quot;report_type&quot;)),
            Schedule = reader.GetString(reader.GetOrdinal(&quot;schedule&quot;)),
            EmailRecipients = reader.IsDBNull(reader.GetOrdinal(&quot;email_recipients&quot;)) ? null : reader.GetString(reader.GetOrdinal(&quot;email_recipients&quot;)),
            IsActive = reader.GetBoolean(reader.GetOrdinal(&quot;is_active&quot;)),
            NextRunDate = reader.IsDBNull(reader.GetOrdinal(&quot;next_run_date&quot;)) ? null : reader.GetDateTime(reader.GetOrdinal(&quot;next_run_date&quot;)),
            LastRunDate = reader.IsDBNull(reader.GetOrdinal(&quot;last_run_date&quot;)) ? null : reader.GetDateTime(reader.GetOrdinal(&quot;last_run_date&quot;)),
            CreatedAt = reader.GetDateTime(reader.GetOrdinal(&quot;created_at&quot;)),
            UpdatedAt = reader.GetDateTime(reader.GetOrdinal(&quot;updated_at&quot;)),
            CreatedBy = reader.IsDBNull(reader.GetOrdinal(&quot;created_by&quot;)) ? null : reader.GetInt32(reader.GetOrdinal(&quot;created_by&quot;))
        };
    }
}</file><file path="Module_Settings/Data/Dao_SystemSettings.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Settings.Models;

namespace MTM_Receiving_Application.Module_Settings.Data;

/// &lt;summary&gt;
/// Data Access Object for system settings operations
/// Instance-based pattern with connection string injection
/// &lt;/summary&gt;
public class Dao_SystemSettings
{
    private readonly string _connectionString;

    public Dao_SystemSettings(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Retrieves all system settings ordered by category and UI order
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_SystemSetting&gt;&gt;&gt; GetAllAsync()
    {
        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Settings_System_GetAll&quot;,
            MapFromReader
        );
    }

    /// &lt;summary&gt;
    /// Retrieves system settings for a specific category
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;category&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_SystemSetting&gt;&gt;&gt; GetByCategoryAsync(string category)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_category&quot;, category }
        };

        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Settings_System_GetByCategory&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Retrieves a single system setting by category and key
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;category&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;settingKey&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_SystemSetting&gt;&gt; GetByKeyAsync(string category, string settingKey)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_category&quot;, category },
            { &quot;p_setting_key&quot;, settingKey }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Settings_System_GetByKey&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Updates a system setting value with audit logging
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;settingId&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;newValue&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;changedBy&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;ipAddress&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;workstationName&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; UpdateValueAsync(
        int settingId,
        string newValue,
        int changedBy,
        string ipAddress,
        string workstationName)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_setting_id&quot;, settingId },
            { &quot;p_new_value&quot;, newValue },
            { &quot;p_changed_by&quot;, changedBy },
            { &quot;p_ip_address&quot;, ipAddress ?? string.Empty },
            { &quot;p_workstation_name&quot;, workstationName ?? string.Empty }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Settings_System_UpdateValue&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Resets a system setting to its default value
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;settingId&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;changedBy&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;ipAddress&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;workstationName&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; ResetToDefaultAsync(
        int settingId,
        int changedBy,
        string ipAddress,
        string workstationName)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_setting_id&quot;, settingId },
            { &quot;p_changed_by&quot;, changedBy },
            { &quot;p_ip_address&quot;, ipAddress ?? string.Empty },
            { &quot;p_workstation_name&quot;, workstationName ?? string.Empty }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Settings_System_ResetToDefault&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Locks or unlocks a system setting to prevent modification
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;settingId&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;isLocked&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;changedBy&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;ipAddress&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;workstationName&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; SetLockedAsync(
        int settingId,
        bool isLocked,
        int changedBy,
        string ipAddress,
        string workstationName)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_setting_id&quot;, settingId },
            { &quot;p_is_locked&quot;, isLocked },
            { &quot;p_changed_by&quot;, changedBy },
            { &quot;p_ip_address&quot;, ipAddress ?? string.Empty },
            { &quot;p_workstation_name&quot;, workstationName ?? string.Empty }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Settings_System_SetLocked&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Maps a database reader row to a Model_SystemSetting object
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;reader&quot;&gt;&lt;/param&gt;
    private static Model_SystemSetting MapFromReader(IDataReader reader)
    {
        return new Model_SystemSetting
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            Category = reader.GetString(reader.GetOrdinal(&quot;category&quot;)),
            SubCategory = reader.IsDBNull(reader.GetOrdinal(&quot;sub_category&quot;)) ? null : reader.GetString(reader.GetOrdinal(&quot;sub_category&quot;)),
            SettingKey = reader.GetString(reader.GetOrdinal(&quot;setting_key&quot;)),
            SettingName = reader.GetString(reader.GetOrdinal(&quot;setting_name&quot;)),
            Description = reader.IsDBNull(reader.GetOrdinal(&quot;description&quot;)) ? null : reader.GetString(reader.GetOrdinal(&quot;description&quot;)),
            SettingValue = reader.IsDBNull(reader.GetOrdinal(&quot;setting_value&quot;)) ? null : reader.GetString(reader.GetOrdinal(&quot;setting_value&quot;)),
            DefaultValue = reader.IsDBNull(reader.GetOrdinal(&quot;default_value&quot;)) ? null : reader.GetString(reader.GetOrdinal(&quot;default_value&quot;)),
            DataType = reader.GetString(reader.GetOrdinal(&quot;data_type&quot;)),
            Scope = reader.GetString(reader.GetOrdinal(&quot;scope&quot;)),
            PermissionLevel = reader.GetString(reader.GetOrdinal(&quot;permission_level&quot;)),
            IsLocked = reader.GetBoolean(reader.GetOrdinal(&quot;is_locked&quot;)),
            IsSensitive = reader.GetBoolean(reader.GetOrdinal(&quot;is_sensitive&quot;)),
            ValidationRules = reader.IsDBNull(reader.GetOrdinal(&quot;validation_rules&quot;)) ? null : reader.GetString(reader.GetOrdinal(&quot;validation_rules&quot;)),
            UiControlType = reader.GetString(reader.GetOrdinal(&quot;ui_control_type&quot;)),
            UiOrder = reader.GetInt32(reader.GetOrdinal(&quot;ui_order&quot;)),
            CreatedAt = reader.GetDateTime(reader.GetOrdinal(&quot;created_at&quot;)),
            UpdatedAt = reader.GetDateTime(reader.GetOrdinal(&quot;updated_at&quot;)),
            UpdatedBy = reader.IsDBNull(reader.GetOrdinal(&quot;updated_by&quot;)) ? null : reader.GetInt32(reader.GetOrdinal(&quot;updated_by&quot;))
        };
    }
}</file><file path="Module_Settings/Data/Dao_UserSettings.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Settings.Models;

namespace MTM_Receiving_Application.Module_Settings.Data;

/// &lt;summary&gt;
/// Data Access Object for user settings operations (user preference overrides)
/// Instance-based pattern with connection string injection
/// &lt;/summary&gt;
public class Dao_UserSettings
{
    private readonly string _connectionString;

    public Dao_UserSettings(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Retrieves a user setting with fallback to system default
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;category&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;settingKey&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_SettingValue&gt;&gt; GetAsync(int userId, string category, string settingKey)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_user_id&quot;, userId },
            { &quot;p_category&quot;, category },
            { &quot;p_setting_key&quot;, settingKey }
        };

        var result = await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Settings_User_Get&quot;,
            MapToSettingValue,
            parameters
        );

        return result;
    }

    /// &lt;summary&gt;
    /// Retrieves all user settings for a specific user
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_UserSetting&gt;&gt;&gt; GetAllForUserAsync(int userId)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_user_id&quot;, userId }
        };

        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Settings_User_GetAllForUser&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Sets a user setting override (creates or updates)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;settingId&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;value&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; SetAsync(int userId, int settingId, string value)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_user_id&quot;, userId },
            { &quot;p_setting_id&quot;, settingId },
            { &quot;p_setting_value&quot;, value }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Settings_User_Set&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Resets a user setting to system default (removes override)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;settingId&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; ResetAsync(int userId, int settingId)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_user_id&quot;, userId },
            { &quot;p_setting_id&quot;, settingId }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Settings_User_Reset&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Resets all user settings for a user to system defaults
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;changedBy&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; ResetAllAsync(int userId, int changedBy)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_user_id&quot;, userId },
            { &quot;p_changed_by&quot;, changedBy }
        };

        // Execute and return count of reset settings
        var result = await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Settings_User_ResetAll&quot;,
            reader =&gt; reader.GetInt32(reader.GetOrdinal(&quot;reset_count&quot;)),
            parameters
        );

        return result;
    }

    /// &lt;summary&gt;
    /// Maps database reader to Model_SettingValue for effective value retrieval
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;reader&quot;&gt;&lt;/param&gt;
    private static Model_SettingValue MapToSettingValue(IDataReader reader)
    {
        return new Model_SettingValue
        {
            RawValue = reader.IsDBNull(reader.GetOrdinal(&quot;effective_value&quot;))
                ? string.Empty
                : reader.GetString(reader.GetOrdinal(&quot;effective_value&quot;)),
            DataType = reader.GetString(reader.GetOrdinal(&quot;data_type&quot;))
        };
    }

    /// &lt;summary&gt;
    /// Maps database reader to Model_UserSetting
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;reader&quot;&gt;&lt;/param&gt;
    private static Model_UserSetting MapFromReader(IDataReader reader)
    {
        return new Model_UserSetting
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;setting_id&quot;)),
            UserId = -1, // Will be set from context
            SettingId = reader.GetInt32(reader.GetOrdinal(&quot;setting_id&quot;)),
            SettingValue = reader.IsDBNull(reader.GetOrdinal(&quot;user_override&quot;))
                ? null
                : reader.GetString(reader.GetOrdinal(&quot;user_override&quot;)),
            SystemSetting = new Model_SystemSetting
            {
                Id = reader.GetInt32(reader.GetOrdinal(&quot;setting_id&quot;)),
                Category = reader.GetString(reader.GetOrdinal(&quot;category&quot;)),
                SettingKey = reader.GetString(reader.GetOrdinal(&quot;setting_key&quot;)),
                SettingName = reader.GetString(reader.GetOrdinal(&quot;setting_name&quot;)),
                SettingValue = reader.IsDBNull(reader.GetOrdinal(&quot;system_default&quot;))
                    ? null
                    : reader.GetString(reader.GetOrdinal(&quot;system_default&quot;)),
                DataType = reader.GetString(reader.GetOrdinal(&quot;data_type&quot;)),
                UiControlType = reader.GetString(reader.GetOrdinal(&quot;ui_control_type&quot;))
            }
        };
    }
}</file><file path="Module_Settings/Models/Model_PackageType.cs">using CommunityToolkit.Mvvm.ComponentModel;
using System;

namespace MTM_Receiving_Application.Module_Settings.Models;

/// &lt;summary&gt;
/// Represents a package type definition for receiving operations
/// Database Table: dunnage_types
/// &lt;/summary&gt;
public partial class Model_PackageType : ObservableObject
{
    [ObservableProperty]
    private int _id;

    [ObservableProperty]
    private string _name = string.Empty;

    [ObservableProperty]
    private string _code = string.Empty;

    [ObservableProperty]
    private bool _isActive = true;

    [ObservableProperty]
    private DateTime _createdAt;

    [ObservableProperty]
    private DateTime _updatedAt;

    [ObservableProperty]
    private int? _createdBy;
}</file><file path="Module_Settings/Models/Model_PackageTypeMapping.cs">using CommunityToolkit.Mvvm.ComponentModel;
using System;

namespace MTM_Receiving_Application.Module_Settings.Models;

/// &lt;summary&gt;
/// Represents a mapping from part prefix to package type
/// Database Table: receiving_package_type_mapping
/// &lt;/summary&gt;
public partial class Model_PackageTypeMapping : ObservableObject
{
    [ObservableProperty]
    private int _id;

    [ObservableProperty]
    private string _partPrefix = string.Empty;

    [ObservableProperty]
    private string _packageType = string.Empty;

    [ObservableProperty]
    private bool _isDefault;

    [ObservableProperty]
    private int _displayOrder;

    [ObservableProperty]
    private bool _isActive = true;

    [ObservableProperty]
    private DateTime _createdAt;

    [ObservableProperty]
    private DateTime _updatedAt;

    [ObservableProperty]
    private int? _createdBy;
}</file><file path="Module_Settings/Models/Model_RoutingRule.cs">using CommunityToolkit.Mvvm.ComponentModel;
using System;

namespace MTM_Receiving_Application.Module_Settings.Models;

/// &lt;summary&gt;
/// Represents an auto-routing rule with pattern matching
/// Database Table: routing_home_locations
/// &lt;/summary&gt;
public partial class Model_RoutingRule : ObservableObject
{
    [ObservableProperty]
    private int _id;

    [ObservableProperty]
    private string _matchType = &quot;Part Number&quot;;

    [ObservableProperty]
    private string _pattern = string.Empty;

    [ObservableProperty]
    private string _destinationLocation = string.Empty;

    [ObservableProperty]
    private int _priority = 50;

    [ObservableProperty]
    private bool _isActive = true;

    [ObservableProperty]
    private DateTime _createdAt;

    [ObservableProperty]
    private DateTime _updatedAt;

    [ObservableProperty]
    private int? _createdBy;
}</file><file path="Module_Settings/Models/Model_ScheduledReport.cs">using CommunityToolkit.Mvvm.ComponentModel;
using System;

namespace MTM_Receiving_Application.Module_Settings.Models;

/// &lt;summary&gt;
/// Represents a scheduled report configuration
/// Database Table: reporting_scheduled_reports
/// &lt;/summary&gt;
public partial class Model_ScheduledReport : ObservableObject
{
    [ObservableProperty]
    private int _id;

    [ObservableProperty]
    private string _reportType = string.Empty;

    [ObservableProperty]
    private string _schedule = string.Empty;

    [ObservableProperty]
    private string? _emailRecipients;

    [ObservableProperty]
    private bool _isActive = true;

    [ObservableProperty]
    private DateTime? _nextRunDate;

    [ObservableProperty]
    private DateTime? _lastRunDate;

    [ObservableProperty]
    private DateTime _createdAt;

    [ObservableProperty]
    private DateTime _updatedAt;

    [ObservableProperty]
    private int? _createdBy;
}</file><file path="Module_Settings/Models/Model_SettingsAuditLog.cs">using CommunityToolkit.Mvvm.ComponentModel;
using System;

namespace MTM_Receiving_Application.Module_Settings.Models;

/// &lt;summary&gt;
/// Represents an audit log entry for settings changes
/// Database Table: settings_activity
/// &lt;/summary&gt;
public partial class Model_SettingsAuditLog : ObservableObject
{
    [ObservableProperty]
    private int _id;

    [ObservableProperty]
    private int _settingId;

    [ObservableProperty]
    private int? _userSettingId;

    [ObservableProperty]
    private string? _oldValue;

    [ObservableProperty]
    private string? _newValue;

    [ObservableProperty]
    private string _changeType = &quot;update&quot;;

    [ObservableProperty]
    private int _changedBy;

    [ObservableProperty]
    private DateTime _changedAt;

    [ObservableProperty]
    private string? _ipAddress;

    [ObservableProperty]
    private string? _workstationName;

    // Navigation properties
    [ObservableProperty]
    private string _category = string.Empty;

    [ObservableProperty]
    private string _settingKey = string.Empty;

    [ObservableProperty]
    private string _settingName = string.Empty;
}</file><file path="Module_Settings/Models/Model_SystemSetting.cs">using CommunityToolkit.Mvvm.ComponentModel;
using System;

namespace MTM_Receiving_Application.Module_Settings.Models;

/// &lt;summary&gt;
/// Represents a system-wide configuration setting
/// Database Table: settings_universal
/// &lt;/summary&gt;
public partial class Model_SystemSetting : ObservableObject
{
    [ObservableProperty]
    private int _id;

    [ObservableProperty]
    private string _category = string.Empty;

    [ObservableProperty]
    private string? _subCategory;

    [ObservableProperty]
    private string _settingKey = string.Empty;

    [ObservableProperty]
    private string _settingName = string.Empty;

    [ObservableProperty]
    private string? _description;

    [ObservableProperty]
    private string? _settingValue;

    [ObservableProperty]
    private string? _defaultValue;

    [ObservableProperty]
    private string _dataType = &quot;string&quot;;

    [ObservableProperty]
    private string _scope = &quot;system&quot;;

    [ObservableProperty]
    private string _permissionLevel = &quot;admin&quot;;

    [ObservableProperty]
    private bool _isLocked;

    [ObservableProperty]
    private bool _isSensitive;

    [ObservableProperty]
    private string? _validationRules; // JSON

    [ObservableProperty]
    private string _uiControlType = &quot;textbox&quot;;

    [ObservableProperty]
    private int _uiOrder;

    [ObservableProperty]
    private DateTime _createdAt;

    [ObservableProperty]
    private DateTime _updatedAt;

    [ObservableProperty]
    private int? _updatedBy;
}</file><file path="Module_Settings/Models/Model_UserSetting.cs">using CommunityToolkit.Mvvm.ComponentModel;
using System;

namespace MTM_Receiving_Application.Module_Settings.Models;

/// &lt;summary&gt;
/// Represents a user-specific override for a system setting
/// Database Table: settings_personal
/// &lt;/summary&gt;
public partial class Model_UserSetting : ObservableObject
{
    [ObservableProperty]
    private int _id;

    [ObservableProperty]
    private int _userId;

    [ObservableProperty]
    private int _settingId;

    [ObservableProperty]
    private string? _settingValue;

    [ObservableProperty]
    private DateTime _createdAt;

    [ObservableProperty]
    private DateTime _updatedAt;

    // Navigation property
    [ObservableProperty]
    private Model_SystemSetting? _systemSetting;
}</file><file path="Module_Settings/Views/View_Settings_DatabaseTest.xaml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;Page x:Class=&quot;MTM_Receiving_Application.Module_Settings.Views.View_Settings_DatabaseTest&quot;
      xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
      xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
      xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
      xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
      xmlns:icons=&quot;using:Material.Icons.WinUI3&quot;
      xmlns:viewmodels=&quot;using:MTM_Receiving_Application.Module_Settings.ViewModels&quot;
      xmlns:models=&quot;using:MTM_Receiving_Application.Module_Settings.Models&quot;
      mc:Ignorable=&quot;d&quot;
      Background=&quot;{ThemeResource LayerFillColorDefaultBrush}&quot;&gt;

    &lt;Grid Background=&quot;{ThemeResource LayerFillColorDefaultBrush}&quot;&gt;
        &lt;ScrollViewer VerticalScrollBarVisibility=&quot;Auto&quot;&gt;
            &lt;StackPanel Spacing=&quot;20&quot;
                        Margin=&quot;40,20,40,40&quot;&gt;

                &lt;!-- Header --&gt;
                &lt;Grid&gt;
                    &lt;Grid.ColumnDefinitions&gt;
                        &lt;ColumnDefinition Width=&quot;*&quot; /&gt;
                        &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                    &lt;/Grid.ColumnDefinitions&gt;

                    &lt;StackPanel Grid.Column=&quot;0&quot;
                                Spacing=&quot;4&quot;&gt;
                        &lt;TextBlock Text=&quot;Settings Database Test&quot;
                                   Style=&quot;{StaticResource TitleTextBlockStyle}&quot; /&gt;
                        &lt;TextBlock Text=&quot;Development Tool - Schema &amp;amp; Stored Procedure Validation&quot;
                                   Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                   Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                    &lt;/StackPanel&gt;

                    &lt;Button Grid.Column=&quot;1&quot;
                            Content=&quot;Refresh All Tests&quot;
                            Command=&quot;{Binding RunAllTestsCommand}&quot;
                            Style=&quot;{StaticResource AccentButtonStyle}&quot;
                            Height=&quot;36&quot;
                            Padding=&quot;20,0&quot;
                            VerticalAlignment=&quot;Center&quot;&gt;
                        &lt;Button.KeyboardAccelerators&gt;
                            &lt;KeyboardAccelerator Key=&quot;F5&quot; /&gt;
                        &lt;/Button.KeyboardAccelerators&gt;
                    &lt;/Button&gt;
                &lt;/Grid&gt;

                &lt;!-- Connection Status Card --&gt;
                &lt;Border Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                        BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                        BorderThickness=&quot;1&quot;
                        CornerRadius=&quot;8&quot;
                        Padding=&quot;20&quot;&gt;
                    &lt;StackPanel Spacing=&quot;12&quot;&gt;
                        &lt;TextBlock Text=&quot;Database Connection&quot;
                                   Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; /&gt;

                        &lt;!-- Success Status (use visible when connected) --&gt;
                        &lt;StackPanel Orientation=&quot;Horizontal&quot;
                                    Spacing=&quot;12&quot;&gt;
                            &lt;Border Width=&quot;20&quot;
                                    Height=&quot;20&quot;
                                    CornerRadius=&quot;10&quot;
                                    Background=&quot;#107c10&quot;&gt;
                                &lt;icons:MaterialIcon Kind=&quot;Check&quot;
                                                    Width=&quot;14&quot;
                                                    Height=&quot;14&quot;
                                                    Foreground=&quot;White&quot; /&gt;
                            &lt;/Border&gt;
                            &lt;TextBlock Text=&quot;{x:Bind ViewModel.ConnectionStatus, Mode=OneWay}&quot;
                                       Foreground=&quot;#107c10&quot;
                                       FontWeight=&quot;SemiBold&quot; /&gt;
                        &lt;/StackPanel&gt;

                        &lt;TextBlock Text=&quot;Connection details&quot;
                                   Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                   Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                    &lt;/StackPanel&gt;
                &lt;/Border&gt;

                &lt;!-- Summary Cards Row --&gt;
                &lt;Grid ColumnSpacing=&quot;20&quot;&gt;
                    &lt;Grid.ColumnDefinitions&gt;
                        &lt;ColumnDefinition Width=&quot;*&quot; /&gt;
                        &lt;ColumnDefinition Width=&quot;*&quot; /&gt;
                        &lt;ColumnDefinition Width=&quot;*&quot; /&gt;
                        &lt;ColumnDefinition Width=&quot;*&quot; /&gt;
                    &lt;/Grid.ColumnDefinitions&gt;

                    &lt;!-- Tables Card --&gt;
                    &lt;Border Grid.Column=&quot;0&quot;
                            Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                            BorderThickness=&quot;1&quot;
                            CornerRadius=&quot;8&quot;
                            Padding=&quot;20&quot;
                            MinHeight=&quot;120&quot;&gt;
                        &lt;StackPanel Spacing=&quot;8&quot;&gt;
                            &lt;TextBlock Text=&quot;Tables&quot;
                                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                            &lt;StackPanel Orientation=&quot;Horizontal&quot;
                                        Spacing=&quot;4&quot;&gt;
                                &lt;TextBlock Text=&quot;{x:Bind ViewModel.TablesValidated, Mode=OneWay}&quot;
                                           FontSize=&quot;36&quot;
                                           FontWeight=&quot;SemiBold&quot;
                                           Foreground=&quot;#107c10&quot; /&gt;
                                &lt;TextBlock Text=&quot;/&quot;
                                           FontSize=&quot;28&quot;
                                           FontWeight=&quot;SemiBold&quot;
                                           Foreground=&quot;#107c10&quot;
                                           VerticalAlignment=&quot;Center&quot; /&gt;
                                &lt;TextBlock Text=&quot;{x:Bind ViewModel.TotalTables, Mode=OneWay}&quot;
                                           FontSize=&quot;28&quot;
                                           FontWeight=&quot;SemiBold&quot;
                                           Foreground=&quot;#107c10&quot;
                                           VerticalAlignment=&quot;Center&quot; /&gt;
                            &lt;/StackPanel&gt;
                            &lt;TextBlock Text=&quot;All tables validated&quot;
                                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                            &lt;TextBlock Text=&quot; Indexes OK&quot;
                                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                       Foreground=&quot;#107c10&quot; /&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Border&gt;

                    &lt;!-- Stored Procedures Card --&gt;
                    &lt;Border Grid.Column=&quot;1&quot;
                            Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                            BorderThickness=&quot;1&quot;
                            CornerRadius=&quot;8&quot;
                            Padding=&quot;20&quot;
                            MinHeight=&quot;120&quot;&gt;
                        &lt;StackPanel Spacing=&quot;8&quot;&gt;
                            &lt;TextBlock Text=&quot;Stored Procedures&quot;
                                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                            &lt;StackPanel Orientation=&quot;Horizontal&quot;
                                        Spacing=&quot;4&quot;&gt;
                                &lt;TextBlock Text=&quot;{x:Bind ViewModel.StoredProceduresTested, Mode=OneWay}&quot;
                                           FontSize=&quot;36&quot;
                                           FontWeight=&quot;SemiBold&quot;
                                           Foreground=&quot;#107c10&quot; /&gt;
                                &lt;TextBlock Text=&quot;/&quot;
                                           FontSize=&quot;28&quot;
                                           FontWeight=&quot;SemiBold&quot;
                                           Foreground=&quot;#107c10&quot;
                                           VerticalAlignment=&quot;Center&quot; /&gt;
                                &lt;TextBlock Text=&quot;{x:Bind ViewModel.TotalStoredProcedures, Mode=OneWay}&quot;
                                           FontSize=&quot;28&quot;
                                           FontWeight=&quot;SemiBold&quot;
                                           Foreground=&quot;#107c10&quot;
                                           VerticalAlignment=&quot;Center&quot; /&gt;
                            &lt;/StackPanel&gt;
                            &lt;TextBlock Text=&quot;All procedures tested&quot;
                                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                            &lt;TextBlock Text=&quot; No errors&quot;
                                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                       Foreground=&quot;#107c10&quot; /&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Border&gt;

                    &lt;!-- Data Seeding Card --&gt;
                    &lt;Border Grid.Column=&quot;2&quot;
                            Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                            BorderThickness=&quot;1&quot;
                            CornerRadius=&quot;8&quot;
                            Padding=&quot;20&quot;
                            MinHeight=&quot;120&quot;&gt;
                        &lt;StackPanel Spacing=&quot;8&quot;&gt;
                            &lt;TextBlock Text=&quot;Data Seeding&quot;
                                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                            &lt;TextBlock Text=&quot;{x:Bind ViewModel.SettingsSeeded, Mode=OneWay}&quot;
                                       FontSize=&quot;36&quot;
                                       FontWeight=&quot;SemiBold&quot;
                                       Foreground=&quot;#107c10&quot; /&gt;
                            &lt;TextBlock Text=&quot;Settings inserted&quot;
                                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                            &lt;TextBlock Text=&quot; All categories&quot;
                                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                       Foreground=&quot;#107c10&quot; /&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Border&gt;

                    &lt;!-- DAOs Card --&gt;
                    &lt;Border Grid.Column=&quot;3&quot;
                            Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                            BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                            BorderThickness=&quot;1&quot;
                            CornerRadius=&quot;8&quot;
                            Padding=&quot;20&quot;
                            MinHeight=&quot;120&quot;&gt;
                        &lt;StackPanel Spacing=&quot;8&quot;&gt;
                            &lt;TextBlock Text=&quot;DAO Tests&quot;
                                       Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                            &lt;StackPanel Orientation=&quot;Horizontal&quot;
                                        Spacing=&quot;4&quot;&gt;
                                &lt;TextBlock Text=&quot;{x:Bind ViewModel.DaosTested, Mode=OneWay}&quot;
                                           FontSize=&quot;36&quot;
                                           FontWeight=&quot;SemiBold&quot;
                                           Foreground=&quot;#107c10&quot; /&gt;
                                &lt;TextBlock Text=&quot;/&quot;
                                           FontSize=&quot;28&quot;
                                           FontWeight=&quot;SemiBold&quot;
                                           Foreground=&quot;#107c10&quot;
                                           VerticalAlignment=&quot;Center&quot; /&gt;
                                &lt;TextBlock Text=&quot;{x:Bind ViewModel.TotalDaos, Mode=OneWay}&quot;
                                           FontSize=&quot;28&quot;
                                           FontWeight=&quot;SemiBold&quot;
                                           Foreground=&quot;#107c10&quot;
                                           VerticalAlignment=&quot;Center&quot; /&gt;
                            &lt;/StackPanel&gt;
                            &lt;TextBlock Text=&quot;All DAOs operational&quot;
                                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                            &lt;TextBlock Text=&quot; CRUD verified&quot;
                                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                       Foreground=&quot;#107c10&quot; /&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Border&gt;
                &lt;/Grid&gt;

                &lt;!-- Test Results Tabs --&gt;
                &lt;Border Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                        BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                        BorderThickness=&quot;1&quot;
                        CornerRadius=&quot;8&quot;&gt;
                    &lt;Grid&gt;
                        &lt;Grid.RowDefinitions&gt;
                            &lt;RowDefinition Height=&quot;Auto&quot; /&gt;
                            &lt;RowDefinition Height=&quot;*&quot; /&gt;
                        &lt;/Grid.RowDefinitions&gt;

                        &lt;!-- Tab Header --&gt;
                        &lt;Border Grid.Row=&quot;0&quot;
                                BorderBrush=&quot;{ThemeResource DividerStrokeColorDefaultBrush}&quot;
                                BorderThickness=&quot;0,0,0,1&quot;&gt;
                            &lt;StackPanel Orientation=&quot;Horizontal&quot;
                                        Spacing=&quot;0&quot;
                                        Height=&quot;48&quot;&gt;
                                &lt;Button Content=&quot;Schema Tests&quot;
                                        x:Name=&quot;SchemaTabButton&quot;
                                        MinWidth=&quot;150&quot;
                                        Height=&quot;48&quot;
                                        Background=&quot;Transparent&quot;
                                        BorderThickness=&quot;0&quot;
                                        CornerRadius=&quot;0&quot;
                                        Click=&quot;OnSchemaTabClick&quot; /&gt;
                                &lt;Button Content=&quot;SP Tests&quot;
                                        x:Name=&quot;SpTabButton&quot;
                                        MinWidth=&quot;150&quot;
                                        Height=&quot;48&quot;
                                        Background=&quot;Transparent&quot;
                                        BorderThickness=&quot;0&quot;
                                        CornerRadius=&quot;0&quot;
                                        Click=&quot;OnStoredProceduresTabClick&quot; /&gt;
                                &lt;Button Content=&quot;DAO Tests&quot;
                                        x:Name=&quot;DaoTabButton&quot;
                                        MinWidth=&quot;150&quot;
                                        Height=&quot;48&quot;
                                        Background=&quot;Transparent&quot;
                                        BorderThickness=&quot;0&quot;
                                        CornerRadius=&quot;0&quot;
                                        Click=&quot;OnDaosTabClick&quot; /&gt;
                                &lt;Button Content=&quot;Logs&quot;
                                        x:Name=&quot;LogsTabButton&quot;
                                        MinWidth=&quot;150&quot;
                                        Height=&quot;48&quot;
                                        Background=&quot;Transparent&quot;
                                        BorderThickness=&quot;0&quot;
                                        CornerRadius=&quot;0&quot;
                                        Click=&quot;OnLogsTabClick&quot; /&gt;
                            &lt;/StackPanel&gt;
                        &lt;/Border&gt;

                        &lt;!-- Tab Content --&gt;
                        &lt;ScrollViewer Grid.Row=&quot;1&quot;
                                      MaxHeight=&quot;400&quot;
                                      Padding=&quot;20&quot;&gt;
                            &lt;Grid&gt;
                                &lt;!-- Schema Tab --&gt;
                                &lt;StackPanel x:Name=&quot;SchemaTabContent&quot;
                                            Spacing=&quot;16&quot;&gt;
                                    &lt;TextBlock Text=&quot;Table Validation Results&quot;
                                               Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; /&gt;

                                    &lt;!-- Table Result Items --&gt;
                                    &lt;ItemsControl ItemsSource=&quot;{x:Bind ViewModel.TableResults, Mode=OneWay}&quot;&gt;
                                        &lt;ItemsControl.ItemTemplate&gt;
                                            &lt;DataTemplate x:DataType=&quot;models:Model_TableTestResult&quot;&gt;
                                                &lt;Border Background=&quot;{ThemeResource SubtleFillColorTransparentBrush}&quot;
                                                        BorderBrush=&quot;{ThemeResource DividerStrokeColorDefaultBrush}&quot;
                                                        BorderThickness=&quot;0,0,0,1&quot;
                                                        Padding=&quot;12,8&quot;
                                                        Margin=&quot;0,0,0,12&quot;&gt;
                                                    &lt;Grid&gt;
                                                        &lt;Grid.ColumnDefinitions&gt;
                                                            &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                                                            &lt;ColumnDefinition Width=&quot;*&quot; /&gt;
                                                            &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                                                        &lt;/Grid.ColumnDefinitions&gt;

                                                        &lt;StackPanel Grid.Column=&quot;0&quot;
                                                                    Orientation=&quot;Horizontal&quot;
                                                                    Spacing=&quot;12&quot;
                                                                    VerticalAlignment=&quot;Center&quot;&gt;
                                                            &lt;Border Width=&quot;20&quot;
                                                                    Height=&quot;20&quot;
                                                                    CornerRadius=&quot;10&quot;
                                                                    Background=&quot;#107c10&quot;&gt;
                                                                &lt;icons:MaterialIcon Kind=&quot;Check&quot;
                                                                                    Width=&quot;14&quot;
                                                                                    Height=&quot;14&quot;
                                                                                    Foreground=&quot;White&quot; /&gt;
                                                            &lt;/Border&gt;
                                                            &lt;StackPanel Spacing=&quot;2&quot;&gt;
                                                                &lt;TextBlock Text=&quot;{x:Bind TableName}&quot;
                                                                           FontWeight=&quot;SemiBold&quot; /&gt;
                                                                &lt;TextBlock Text=&quot;{x:Bind Details}&quot;
                                                                           Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                                           Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                                                            &lt;/StackPanel&gt;
                                                        &lt;/StackPanel&gt;

                                                        &lt;Border Grid.Column=&quot;2&quot;
                                                                BorderBrush=&quot;#107c10&quot;
                                                                BorderThickness=&quot;1&quot;
                                                                CornerRadius=&quot;4&quot;
                                                                Padding=&quot;12,4&quot;&gt;
                                                            &lt;TextBlock Text=&quot;{x:Bind StatusText}&quot;
                                                                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                                       Foreground=&quot;#107c10&quot; /&gt;
                                                        &lt;/Border&gt;
                                                    &lt;/Grid&gt;
                                                &lt;/Border&gt;
                                            &lt;/DataTemplate&gt;
                                        &lt;/ItemsControl.ItemTemplate&gt;
                                    &lt;/ItemsControl&gt;

                                    &lt;!-- Legacy hardcoded items removed --&gt;
                                    &lt;StackPanel Spacing=&quot;12&quot;
                                                Visibility=&quot;Collapsed&quot;&gt;

                                        &lt;!-- Table 1: settings_universal --&gt;
                                        &lt;Border Background=&quot;{ThemeResource SubtleFillColorTransparentBrush}&quot;
                                                BorderBrush=&quot;{ThemeResource DividerStrokeColorDefaultBrush}&quot;
                                                BorderThickness=&quot;0,0,0,1&quot;
                                                Padding=&quot;12,8&quot;&gt;
                                            &lt;Grid&gt;
                                                &lt;Grid.ColumnDefinitions&gt;
                                                    &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                                                    &lt;ColumnDefinition Width=&quot;*&quot; /&gt;
                                                    &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                                                &lt;/Grid.ColumnDefinitions&gt;

                                                &lt;StackPanel Grid.Column=&quot;0&quot;
                                                            Orientation=&quot;Horizontal&quot;
                                                            Spacing=&quot;12&quot;
                                                            VerticalAlignment=&quot;Center&quot;&gt;
                                                    &lt;Border Width=&quot;20&quot;
                                                            Height=&quot;20&quot;
                                                            CornerRadius=&quot;10&quot;
                                                            Background=&quot;#107c10&quot;&gt;
                                                        &lt;icons:MaterialIcon Kind=&quot;Check&quot;
                                                                            Width=&quot;14&quot;
                                                                            Height=&quot;14&quot;
                                                                            Foreground=&quot;White&quot; /&gt;
                                                    &lt;/Border&gt;
                                                    &lt;StackPanel Spacing=&quot;2&quot;&gt;
                                                        &lt;TextBlock Text=&quot;settings_universal&quot;
                                                                   FontWeight=&quot;SemiBold&quot; /&gt;
                                                        &lt;TextBlock Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                                   Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;&gt;
                                                            &lt;Run Text=&quot;79 rows | 18 columns | 3 indexes&quot; /&gt;
                                                        &lt;/TextBlock&gt;
                                                    &lt;/StackPanel&gt;
                                                &lt;/StackPanel&gt;

                                                &lt;Border Grid.Column=&quot;2&quot;
                                                        BorderBrush=&quot;#107c10&quot;
                                                        BorderThickness=&quot;1&quot;
                                                        CornerRadius=&quot;4&quot;
                                                        Padding=&quot;12,4&quot;&gt;
                                                    &lt;TextBlock Text=&quot;Validated&quot;
                                                               Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                               Foreground=&quot;#107c10&quot; /&gt;
                                                &lt;/Border&gt;
                                            &lt;/Grid&gt;
                                        &lt;/Border&gt;

                                        &lt;!-- Table 2: settings_personal --&gt;
                                        &lt;Border Background=&quot;{ThemeResource SubtleFillColorTransparentBrush}&quot;
                                                BorderBrush=&quot;{ThemeResource DividerStrokeColorDefaultBrush}&quot;
                                                BorderThickness=&quot;0,0,0,1&quot;
                                                Padding=&quot;12,8&quot;&gt;
                                            &lt;Grid&gt;
                                                &lt;Grid.ColumnDefinitions&gt;
                                                    &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                                                    &lt;ColumnDefinition Width=&quot;*&quot; /&gt;
                                                    &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                                                &lt;/Grid.ColumnDefinitions&gt;

                                                &lt;StackPanel Grid.Column=&quot;0&quot;
                                                            Orientation=&quot;Horizontal&quot;
                                                            Spacing=&quot;12&quot;
                                                            VerticalAlignment=&quot;Center&quot;&gt;
                                                    &lt;Border Width=&quot;20&quot;
                                                            Height=&quot;20&quot;
                                                            CornerRadius=&quot;10&quot;
                                                            Background=&quot;#107c10&quot;&gt;
                                                        &lt;icons:MaterialIcon Kind=&quot;Check&quot;
                                                                            Width=&quot;14&quot;
                                                                            Height=&quot;14&quot;
                                                                            Foreground=&quot;White&quot; /&gt;
                                                    &lt;/Border&gt;
                                                    &lt;StackPanel Spacing=&quot;2&quot;&gt;
                                                        &lt;TextBlock Text=&quot;settings_personal&quot;
                                                                   FontWeight=&quot;SemiBold&quot; /&gt;
                                                        &lt;TextBlock Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                                   Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;&gt;
                                                            &lt;Run Text=&quot;0 rows | 5 columns | 1 unique constraint&quot; /&gt;
                                                        &lt;/TextBlock&gt;
                                                    &lt;/StackPanel&gt;
                                                &lt;/StackPanel&gt;

                                                &lt;Border Grid.Column=&quot;2&quot;
                                                        BorderBrush=&quot;#107c10&quot;
                                                        BorderThickness=&quot;1&quot;
                                                        CornerRadius=&quot;4&quot;
                                                        Padding=&quot;12,4&quot;&gt;
                                                    &lt;TextBlock Text=&quot;Validated&quot;
                                                               Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                               Foreground=&quot;#107c10&quot; /&gt;
                                                &lt;/Border&gt;
                                            &lt;/Grid&gt;
                                        &lt;/Border&gt;

                                        &lt;!-- Table 3: dunnage_types --&gt;
                                        &lt;Border Background=&quot;{ThemeResource SubtleFillColorTransparentBrush}&quot;
                                                BorderBrush=&quot;{ThemeResource DividerStrokeColorDefaultBrush}&quot;
                                                BorderThickness=&quot;0,0,0,1&quot;
                                                Padding=&quot;12,8&quot;&gt;
                                            &lt;Grid&gt;
                                                &lt;Grid.ColumnDefinitions&gt;
                                                    &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                                                    &lt;ColumnDefinition Width=&quot;*&quot; /&gt;
                                                    &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                                                &lt;/Grid.ColumnDefinitions&gt;

                                                &lt;StackPanel Grid.Column=&quot;0&quot;
                                                            Orientation=&quot;Horizontal&quot;
                                                            Spacing=&quot;12&quot;
                                                            VerticalAlignment=&quot;Center&quot;&gt;
                                                    &lt;Border Width=&quot;20&quot;
                                                            Height=&quot;20&quot;
                                                            CornerRadius=&quot;10&quot;
                                                            Background=&quot;#107c10&quot;&gt;
                                                        &lt;icons:MaterialIcon Kind=&quot;Check&quot;
                                                                            Width=&quot;14&quot;
                                                                            Height=&quot;14&quot;
                                                                            Foreground=&quot;White&quot; /&gt;
                                                    &lt;/Border&gt;
                                                    &lt;StackPanel Spacing=&quot;2&quot;&gt;
                                                        &lt;TextBlock Text=&quot;dunnage_types&quot;
                                                                   FontWeight=&quot;SemiBold&quot; /&gt;
                                                        &lt;TextBlock Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                                   Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;&gt;
                                                            &lt;Run Text=&quot;5 rows | 5 columns | 2 unique constraints&quot; /&gt;
                                                        &lt;/TextBlock&gt;
                                                    &lt;/StackPanel&gt;
                                                &lt;/StackPanel&gt;

                                                &lt;Border Grid.Column=&quot;2&quot;
                                                        BorderBrush=&quot;#107c10&quot;
                                                        BorderThickness=&quot;1&quot;
                                                        CornerRadius=&quot;4&quot;
                                                        Padding=&quot;12,4&quot;&gt;
                                                    &lt;TextBlock Text=&quot;Validated&quot;
                                                               Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                               Foreground=&quot;#107c10&quot; /&gt;
                                                &lt;/Border&gt;
                                            &lt;/Grid&gt;
                                        &lt;/Border&gt;

                                        &lt;!-- Table 4: routing_home_locations --&gt;
                                        &lt;Border Background=&quot;{ThemeResource SubtleFillColorTransparentBrush}&quot;
                                                BorderBrush=&quot;{ThemeResource DividerStrokeColorDefaultBrush}&quot;
                                                BorderThickness=&quot;0,0,0,1&quot;
                                                Padding=&quot;12,8&quot;&gt;
                                            &lt;Grid&gt;
                                                &lt;Grid.ColumnDefinitions&gt;
                                                    &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                                                    &lt;ColumnDefinition Width=&quot;*&quot; /&gt;
                                                    &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                                                &lt;/Grid.ColumnDefinitions&gt;

                                                &lt;StackPanel Grid.Column=&quot;0&quot;
                                                            Orientation=&quot;Horizontal&quot;
                                                            Spacing=&quot;12&quot;
                                                            VerticalAlignment=&quot;Center&quot;&gt;
                                                    &lt;Border Width=&quot;20&quot;
                                                            Height=&quot;20&quot;
                                                            CornerRadius=&quot;10&quot;
                                                            Background=&quot;#107c10&quot;&gt;
                                                        &lt;icons:MaterialIcon Kind=&quot;Check&quot;
                                                                            Width=&quot;14&quot;
                                                                            Height=&quot;14&quot;
                                                                            Foreground=&quot;White&quot; /&gt;
                                                    &lt;/Border&gt;
                                                    &lt;StackPanel Spacing=&quot;2&quot;&gt;
                                                        &lt;TextBlock Text=&quot;routing_home_locations&quot;
                                                                   FontWeight=&quot;SemiBold&quot; /&gt;
                                                        &lt;TextBlock Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                                   Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;&gt;
                                                            &lt;Run Text=&quot;3 rows | 7 columns | 1 index on priority&quot; /&gt;
                                                        &lt;/TextBlock&gt;
                                                    &lt;/StackPanel&gt;
                                                &lt;/StackPanel&gt;

                                                &lt;Border Grid.Column=&quot;2&quot;
                                                        BorderBrush=&quot;#107c10&quot;
                                                        BorderThickness=&quot;1&quot;
                                                        CornerRadius=&quot;4&quot;
                                                        Padding=&quot;12,4&quot;&gt;
                                                    &lt;TextBlock Text=&quot;Validated&quot;
                                                               Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                               Foreground=&quot;#107c10&quot; /&gt;
                                                &lt;/Border&gt;
                                            &lt;/Grid&gt;
                                        &lt;/Border&gt;

                                        &lt;!-- Table 5: reporting_scheduled_reports --&gt;
                                        &lt;Border Background=&quot;{ThemeResource SubtleFillColorTransparentBrush}&quot;
                                                BorderBrush=&quot;{ThemeResource DividerStrokeColorDefaultBrush}&quot;
                                                BorderThickness=&quot;0,0,0,1&quot;
                                                Padding=&quot;12,8&quot;&gt;
                                            &lt;Grid&gt;
                                                &lt;Grid.ColumnDefinitions&gt;
                                                    &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                                                    &lt;ColumnDefinition Width=&quot;*&quot; /&gt;
                                                    &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                                                &lt;/Grid.ColumnDefinitions&gt;

                                                &lt;StackPanel Grid.Column=&quot;0&quot;
                                                            Orientation=&quot;Horizontal&quot;
                                                            Spacing=&quot;12&quot;
                                                            VerticalAlignment=&quot;Center&quot;&gt;
                                                    &lt;Border Width=&quot;20&quot;
                                                            Height=&quot;20&quot;
                                                            CornerRadius=&quot;10&quot;
                                                            Background=&quot;#107c10&quot;&gt;
                                                        &lt;icons:MaterialIcon Kind=&quot;Check&quot;
                                                                            Width=&quot;14&quot;
                                                                            Height=&quot;14&quot;
                                                                            Foreground=&quot;White&quot; /&gt;
                                                    &lt;/Border&gt;
                                                    &lt;StackPanel Spacing=&quot;2&quot;&gt;
                                                        &lt;TextBlock Text=&quot;reporting_scheduled_reports&quot;
                                                                   FontWeight=&quot;SemiBold&quot; /&gt;
                                                        &lt;TextBlock Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                                   Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;&gt;
                                                            &lt;Run Text=&quot;2 rows | 8 columns | 2 indexes&quot; /&gt;
                                                        &lt;/TextBlock&gt;
                                                    &lt;/StackPanel&gt;
                                                &lt;/StackPanel&gt;

                                                &lt;Border Grid.Column=&quot;2&quot;
                                                        BorderBrush=&quot;#107c10&quot;
                                                        BorderThickness=&quot;1&quot;
                                                        CornerRadius=&quot;4&quot;
                                                        Padding=&quot;12,4&quot;&gt;
                                                    &lt;TextBlock Text=&quot;Validated&quot;
                                                               Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                               Foreground=&quot;#107c10&quot; /&gt;
                                                &lt;/Border&gt;
                                            &lt;/Grid&gt;
                                        &lt;/Border&gt;

                                    &lt;/StackPanel&gt;
                                    &lt;!-- End of collapsed hardcoded items --&gt;

                                    &lt;!-- Show All Tables Button --&gt;
                                    &lt;Button Content=&quot;Show All Tables (7)&quot;
                                            HorizontalAlignment=&quot;Left&quot;
                                            Margin=&quot;0,8,0,0&quot;
                                            Background=&quot;Transparent&quot;
                                            BorderBrush=&quot;{ThemeResource ControlStrokeColorDefaultBrush}&quot;
                                            BorderThickness=&quot;1&quot; /&gt;
                                &lt;/StackPanel&gt;

                                &lt;!-- Stored Procedures Tab --&gt;
                                &lt;StackPanel x:Name=&quot;StoredProceduresTabContent&quot;
                                            Spacing=&quot;16&quot;
                                            Visibility=&quot;Collapsed&quot;&gt;
                                    &lt;TextBlock Text=&quot;Stored Procedure Results&quot;
                                               Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; /&gt;

                                    &lt;ItemsControl ItemsSource=&quot;{x:Bind ViewModel.StoredProcedureResults, Mode=OneWay}&quot;&gt;
                                        &lt;ItemsControl.ItemTemplate&gt;
                                            &lt;DataTemplate x:DataType=&quot;models:Model_StoredProcedureTestResult&quot;&gt;
                                                &lt;Border Background=&quot;{ThemeResource SubtleFillColorTransparentBrush}&quot;
                                                        BorderBrush=&quot;{ThemeResource DividerStrokeColorDefaultBrush}&quot;
                                                        BorderThickness=&quot;0,0,0,1&quot;
                                                        Padding=&quot;12,8&quot;
                                                        Margin=&quot;0,0,0,12&quot;&gt;
                                                    &lt;Grid&gt;
                                                        &lt;Grid.ColumnDefinitions&gt;
                                                            &lt;ColumnDefinition Width=&quot;*&quot; /&gt;
                                                            &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                                                        &lt;/Grid.ColumnDefinitions&gt;

                                                        &lt;StackPanel Spacing=&quot;2&quot;&gt;
                                                            &lt;TextBlock Text=&quot;{x:Bind ProcedureName}&quot;
                                                                       FontWeight=&quot;SemiBold&quot; /&gt;
                                                            &lt;TextBlock Text=&quot;{x:Bind TestDetails}&quot;
                                                                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                                                        &lt;/StackPanel&gt;

                                                        &lt;TextBlock Grid.Column=&quot;1&quot;
                                                                   Text=&quot;{x:Bind ExecutionTimeMs}&quot;
                                                                   Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                                   Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                                                                   VerticalAlignment=&quot;Center&quot; /&gt;
                                                    &lt;/Grid&gt;
                                                &lt;/Border&gt;
                                            &lt;/DataTemplate&gt;
                                        &lt;/ItemsControl.ItemTemplate&gt;
                                    &lt;/ItemsControl&gt;
                                &lt;/StackPanel&gt;

                                &lt;!-- DAOs Tab --&gt;
                                &lt;StackPanel x:Name=&quot;DaosTabContent&quot;
                                            Spacing=&quot;16&quot;
                                            Visibility=&quot;Collapsed&quot;&gt;
                                    &lt;TextBlock Text=&quot;DAO Results&quot;
                                               Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; /&gt;

                                    &lt;ItemsControl ItemsSource=&quot;{x:Bind ViewModel.DaoResults, Mode=OneWay}&quot;&gt;
                                        &lt;ItemsControl.ItemTemplate&gt;
                                            &lt;DataTemplate x:DataType=&quot;models:Model_DaoTestResult&quot;&gt;
                                                &lt;Border Background=&quot;{ThemeResource SubtleFillColorTransparentBrush}&quot;
                                                        BorderBrush=&quot;{ThemeResource DividerStrokeColorDefaultBrush}&quot;
                                                        BorderThickness=&quot;0,0,0,1&quot;
                                                        Padding=&quot;12,8&quot;
                                                        Margin=&quot;0,0,0,12&quot;&gt;
                                                    &lt;Grid&gt;
                                                        &lt;Grid.ColumnDefinitions&gt;
                                                            &lt;ColumnDefinition Width=&quot;*&quot; /&gt;
                                                            &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                                                        &lt;/Grid.ColumnDefinitions&gt;

                                                        &lt;StackPanel Spacing=&quot;2&quot;&gt;
                                                            &lt;TextBlock Text=&quot;{x:Bind DaoName}&quot;
                                                                       FontWeight=&quot;SemiBold&quot; /&gt;
                                                            &lt;TextBlock Text=&quot;{x:Bind StatusText}&quot;
                                                                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                                                        &lt;/StackPanel&gt;

                                                        &lt;TextBlock Grid.Column=&quot;1&quot;
                                                                   Text=&quot;{x:Bind OperationsTested}&quot;
                                                                   Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                                   Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                                                                   VerticalAlignment=&quot;Center&quot; /&gt;
                                                    &lt;/Grid&gt;
                                                &lt;/Border&gt;
                                            &lt;/DataTemplate&gt;
                                        &lt;/ItemsControl.ItemTemplate&gt;
                                    &lt;/ItemsControl&gt;
                                &lt;/StackPanel&gt;

                                &lt;!-- Logs Tab --&gt;
                                &lt;StackPanel x:Name=&quot;LogsTabContent&quot;
                                            Spacing=&quot;16&quot;
                                            Visibility=&quot;Collapsed&quot;&gt;
                                    &lt;StackPanel Orientation=&quot;Horizontal&quot;
                                                Spacing=&quot;12&quot;&gt;
                                        &lt;TextBlock Text=&quot;Logs&quot;
                                                   Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot; /&gt;
                                        &lt;Button Content=&quot;Load Audit Log&quot;
                                                Command=&quot;{x:Bind ViewModel.LoadAuditLogCommand}&quot; /&gt;
                                    &lt;/StackPanel&gt;

                                    &lt;TextBlock Text=&quot;Runtime Log Messages&quot;
                                               Style=&quot;{StaticResource BodyTextBlockStyle}&quot; /&gt;
                                    &lt;ItemsControl ItemsSource=&quot;{x:Bind ViewModel.LogMessages, Mode=OneWay}&quot;&gt;
                                        &lt;ItemsControl.ItemTemplate&gt;
                                            &lt;DataTemplate x:DataType=&quot;x:String&quot;&gt;
                                                &lt;TextBlock Text=&quot;{x:Bind}&quot;
                                                           Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                           TextWrapping=&quot;WrapWholeWords&quot; /&gt;
                                            &lt;/DataTemplate&gt;
                                        &lt;/ItemsControl.ItemTemplate&gt;
                                    &lt;/ItemsControl&gt;

                                    &lt;TextBlock Text=&quot;Settings Audit Log (Sample)&quot;
                                               Style=&quot;{StaticResource BodyTextBlockStyle}&quot;
                                               Margin=&quot;0,12,0,0&quot; /&gt;
                                    &lt;ItemsControl ItemsSource=&quot;{x:Bind ViewModel.AuditLogEntries, Mode=OneWay}&quot;&gt;
                                        &lt;ItemsControl.ItemTemplate&gt;
                                            &lt;DataTemplate x:DataType=&quot;models:Model_SettingsAuditLog&quot;&gt;
                                                &lt;Border Background=&quot;{ThemeResource SubtleFillColorTransparentBrush}&quot;
                                                        BorderBrush=&quot;{ThemeResource DividerStrokeColorDefaultBrush}&quot;
                                                        BorderThickness=&quot;0,0,0,1&quot;
                                                        Padding=&quot;12,8&quot;
                                                        Margin=&quot;0,0,0,12&quot;&gt;
                                                    &lt;StackPanel Spacing=&quot;2&quot;&gt;
                                                        &lt;TextBlock Text=&quot;{x:Bind SettingName}&quot;
                                                                   FontWeight=&quot;SemiBold&quot; /&gt;
                                                        &lt;TextBlock Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                                                   Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;&gt;
                                                            &lt;Run Text=&quot;{x:Bind ChangeType}&quot; /&gt;
                                                            &lt;Run Text=&quot;  &quot; /&gt;
                                                            &lt;Run Text=&quot;{x:Bind ChangedAt}&quot; /&gt;
                                                        &lt;/TextBlock&gt;
                                                    &lt;/StackPanel&gt;
                                                &lt;/Border&gt;
                                            &lt;/DataTemplate&gt;
                                        &lt;/ItemsControl.ItemTemplate&gt;
                                    &lt;/ItemsControl&gt;
                                &lt;/StackPanel&gt;
                            &lt;/Grid&gt;
                        &lt;/ScrollViewer&gt;
                    &lt;/Grid&gt;
                &lt;/Border&gt;

                &lt;!-- Footer --&gt;
                &lt;Border Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                        BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                        BorderThickness=&quot;1&quot;
                        CornerRadius=&quot;8&quot;
                        Padding=&quot;20&quot;&gt;
                    &lt;Grid&gt;
                        &lt;Grid.ColumnDefinitions&gt;
                            &lt;ColumnDefinition Width=&quot;*&quot; /&gt;
                            &lt;ColumnDefinition Width=&quot;Auto&quot; /&gt;
                        &lt;/Grid.ColumnDefinitions&gt;

                        &lt;StackPanel Grid.Column=&quot;0&quot;
                                    Spacing=&quot;4&quot;&gt;
                            &lt;TextBlock Text=&quot;Last run: Not yet executed&quot;
                                       Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                       Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                            &lt;StackPanel Orientation=&quot;Horizontal&quot;
                                        Spacing=&quot;4&quot;&gt;
                                &lt;TextBlock Text=&quot;Total test duration:&quot;
                                           Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                           Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                                &lt;TextBlock Text=&quot;{x:Bind ViewModel.TotalTestDurationMs, Mode=OneWay}&quot;
                                           Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                           Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                                &lt;TextBlock Text=&quot;ms&quot;
                                           Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;
                                           Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; /&gt;
                            &lt;/StackPanel&gt;
                        &lt;/StackPanel&gt;

                        &lt;StackPanel Grid.Column=&quot;1&quot;
                                    Orientation=&quot;Horizontal&quot;
                                    Spacing=&quot;12&quot;&gt;
                            &lt;Button Content=&quot;Export Results&quot;
                                    Command=&quot;{x:Bind ViewModel.ExportResultsCommand}&quot;
                                    Height=&quot;32&quot;
                                    Padding=&quot;16,0&quot;
                                    Background=&quot;Transparent&quot;
                                    BorderBrush=&quot;{ThemeResource ControlStrokeColorDefaultBrush}&quot;
                                    BorderThickness=&quot;1&quot; /&gt;
                            &lt;Button Content=&quot;Close&quot;
                                    Height=&quot;32&quot;
                                    Padding=&quot;16,0&quot;
                                    Background=&quot;Transparent&quot;
                                    BorderBrush=&quot;{ThemeResource ControlStrokeColorDefaultBrush}&quot;
                                    BorderThickness=&quot;1&quot; /&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Grid&gt;
                &lt;/Border&gt;

            &lt;/StackPanel&gt;
        &lt;/ScrollViewer&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Volvo/Models/Model_VolvoPart.cs">using System;

namespace MTM_Receiving_Application.Module_Volvo.Models;

/// &lt;summary&gt;
/// Represents a Volvo dunnage part in the master catalog
/// Maps to volvo_masterdata database table
/// &lt;/summary&gt;
public class Model_VolvoPart
{
    /// &lt;summary&gt;
    /// Part number (primary key)
    /// Example: V-EMB-1, V-EMB-500, V-EMB-750
    /// &lt;/summary&gt;
    public string PartNumber { get; set; } = string.Empty;

    /// &lt;summary&gt;
    /// Number of pieces per skid for this part
    /// Example: V-EMB-2 = 20 pieces/skid, V-EMB-500 = 88 pieces/skid
    /// &lt;/summary&gt;
    public int QuantityPerSkid { get; set; }

    /// &lt;summary&gt;
    /// Flag indicating if part is active
    /// If false, part is hidden from dropdown lists but still referenced in historical data
    /// &lt;/summary&gt;
    public bool IsActive { get; set; } = true;

    /// &lt;summary&gt;
    /// Timestamp when part was created in the system
    /// &lt;/summary&gt;
    public DateTime CreatedDate { get; set; } = DateTime.Now;

    /// &lt;summary&gt;
    /// Timestamp when part was last modified
    /// &lt;/summary&gt;
    public DateTime ModifiedDate { get; set; } = DateTime.Now;
}</file><file path="Module_Volvo/Models/Model_VolvoSetting.cs">using CommunityToolkit.Mvvm.ComponentModel;
using System;

namespace MTM_Receiving_Application.Module_Volvo.Models;

/// &lt;summary&gt;
/// Represents a configurable setting for the Volvo module
/// Database Table: settings_module_volvo
/// &lt;/summary&gt;
public partial class Model_VolvoSetting : ObservableObject
{
    [ObservableProperty]
    private string _settingKey = string.Empty;

    [ObservableProperty]
    private string _settingValue = string.Empty;

    [ObservableProperty]
    private string _settingType = string.Empty;

    [ObservableProperty]
    private string _category = string.Empty;

    [ObservableProperty]
    private string? _description;

    [ObservableProperty]
    private string _defaultValue = string.Empty;

    [ObservableProperty]
    private int? _minValue;

    [ObservableProperty]
    private int? _maxValue;

    [ObservableProperty]
    private DateTime _modifiedDate = DateTime.Now;

    [ObservableProperty]
    private string? _modifiedBy;
}</file><file path="Module_Volvo/Services/Service_VolvoAuthorization.cs">using System;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Core.Contracts.Services;

namespace MTM_Receiving_Application.Module_Volvo.Services;

/// &lt;summary&gt;
/// Authorization service for Volvo module operations
/// Currently implements basic authorization - can be extended with role-based checks
/// &lt;/summary&gt;
public class Service_VolvoAuthorization : IService_VolvoAuthorization
{
    private readonly IService_LoggingUtility _logger;
    // Issue #6: TODO - Inject IService_UserSessionManager when available
    // Required for proper authentication and role-based authorization

    public Service_VolvoAuthorization(IService_LoggingUtility logger)
    {
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// &lt;summary&gt;
    /// Checks if current user can create/modify Volvo shipments
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&gt; CanManageShipmentsAsync()
    {
        try
        {
            // Issue #6: TODO - Implement actual role check when user session management is available
            // For now, returning true to allow development/testing
            // For now, log the authorization check
            await _logger.LogInfoAsync(&quot;Authorization check: CanManageShipments&quot;);

            // Placeholder: Allow all operations until role-based auth is implemented
            return new Model_Dao_Result
            {
                Success = true
            };
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error checking shipment management authorization: {ex.Message}&quot;, ex);
            return new Model_Dao_Result
            {
                Success = false,
                ErrorMessage = &quot;Authorization check failed&quot;,
                Severity = Enum_ErrorSeverity.Error,
                Exception = ex
            };
        }
    }

    /// &lt;summary&gt;
    /// Checks if current user can manage Volvo master data (parts, components)
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&gt; CanManageMasterDataAsync()
    {
        try
        {
            await _logger.LogInfoAsync(&quot;Authorization check: CanManageMasterData&quot;);

            // TODO: Implement role check - typically restricted to supervisors/admins
            return new Model_Dao_Result
            {
                Success = true
            };
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error checking master data authorization: {ex.Message}&quot;, ex);
            return new Model_Dao_Result
            {
                Success = false,
                ErrorMessage = &quot;Authorization check failed&quot;,
                Severity = Enum_ErrorSeverity.Error,
                Exception = ex
            };
        }
    }

    /// &lt;summary&gt;
    /// Checks if current user can complete/close Volvo shipments
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&gt; CanCompleteShipmentsAsync()
    {
        try
        {
            await _logger.LogInfoAsync(&quot;Authorization check: CanCompleteShipments&quot;);

            // TODO: Implement role check - may require supervisor approval
            return new Model_Dao_Result
            {
                Success = true
            };
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error checking shipment completion authorization: {ex.Message}&quot;, ex);
            return new Model_Dao_Result
            {
                Success = false,
                ErrorMessage = &quot;Authorization check failed&quot;,
                Severity = Enum_ErrorSeverity.Error,
                Exception = ex
            };
        }
    }

    /// &lt;summary&gt;
    /// Checks if current user can generate labels for Volvo shipments
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&gt; CanGenerateLabelsAsync()
    {
        try
        {
            await _logger.LogInfoAsync(&quot;Authorization check: CanGenerateLabels&quot;);

            // TODO: Implement role check
            return new Model_Dao_Result
            {
                Success = true
            };
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error checking label generation authorization: {ex.Message}&quot;, ex);
            return new Model_Dao_Result
            {
                Success = false,
                ErrorMessage = &quot;Authorization check failed&quot;,
                Severity = Enum_ErrorSeverity.Error,
                Exception = ex
            };
        }
    }
}</file><file path="Module_Volvo/Views/View_Volvo_History.xaml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;Page
    x:Class=&quot;MTM_Receiving_Application.Module_Volvo.Views.View_Volvo_History&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    mc:Ignorable=&quot;d&quot;
    Loaded=&quot;OnPageLoaded&quot;&gt;

    &lt;Grid Padding=&quot;24&quot; RowSpacing=&quot;16&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header --&gt;
        &lt;StackPanel Grid.Row=&quot;0&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot;&gt;
            &lt;Button 
                Command=&quot;{x:Bind ViewModel.GoBackCommand}&quot;
                VerticalAlignment=&quot;Center&quot;
                ToolTipService.ToolTip=&quot;Back to Shipment Entry&quot;&gt;
                &lt;SymbolIcon Symbol=&quot;Back&quot;/&gt;
            &lt;/Button&gt;
            &lt;TextBlock 
                Text=&quot;Volvo Shipment History&quot;
                Style=&quot;{StaticResource TitleTextBlockStyle}&quot;
                VerticalAlignment=&quot;Center&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Filters --&gt;
        &lt;StackPanel Grid.Row=&quot;1&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;16&quot;&gt;
            &lt;CalendarDatePicker
                Header=&quot;Start Date&quot;
                Date=&quot;{x:Bind ViewModel.StartDate, Mode=TwoWay}&quot;
                Width=&quot;200&quot;/&gt;
            
            &lt;CalendarDatePicker
                Header=&quot;End Date&quot;
                Date=&quot;{x:Bind ViewModel.EndDate, Mode=TwoWay}&quot;
                Width=&quot;200&quot;/&gt;
            
            &lt;ComboBox
                Header=&quot;Status&quot;
                ItemsSource=&quot;{x:Bind ViewModel.StatusOptions}&quot;
                SelectedItem=&quot;{x:Bind ViewModel.StatusFilter, Mode=TwoWay}&quot;
                Width=&quot;150&quot;/&gt;
            
            &lt;Button
                Content=&quot;Filter&quot;
                Command=&quot;{x:Bind ViewModel.FilterCommand}&quot;
                Style=&quot;{StaticResource AccentButtonStyle}&quot;
                VerticalAlignment=&quot;Bottom&quot;/&gt;
            
            &lt;Button
                Content=&quot;Export CSV&quot;
                Command=&quot;{x:Bind ViewModel.ExportCommand}&quot;
                VerticalAlignment=&quot;Bottom&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- DataGrid --&gt;
        &lt;controls:DataGrid
            Grid.Row=&quot;2&quot;
            ItemsSource=&quot;{x:Bind ViewModel.History, Mode=OneWay}&quot;
            SelectedItem=&quot;{x:Bind ViewModel.SelectedShipment, Mode=TwoWay}&quot;
            AutoGenerateColumns=&quot;False&quot;
            IsReadOnly=&quot;True&quot;
            CanUserReorderColumns=&quot;False&quot;
            GridLinesVisibility=&quot;Horizontal&quot;&gt;
            
            &lt;controls:DataGrid.Columns&gt;
                &lt;controls:DataGridTextColumn 
                    Header=&quot;Shipment #&quot; 
                    Binding=&quot;{Binding ShipmentNumber}&quot;
                    Width=&quot;100&quot;/&gt;
                
                &lt;controls:DataGridTextColumn 
                    Header=&quot;Date&quot; 
                    Binding=&quot;{Binding ShipmentDate}&quot;
                    Width=&quot;120&quot;/&gt;
                
                &lt;controls:DataGridTextColumn 
                    Header=&quot;PO Number&quot; 
                    Binding=&quot;{Binding PONumber}&quot;
                    Width=&quot;120&quot;/&gt;
                
                &lt;controls:DataGridTextColumn 
                    Header=&quot;Receiver&quot; 
                    Binding=&quot;{Binding ReceiverNumber}&quot;
                    Width=&quot;120&quot;/&gt;
                
                &lt;controls:DataGridTextColumn 
                    Header=&quot;Status&quot; 
                    Binding=&quot;{Binding Status}&quot;
                    Width=&quot;120&quot;/&gt;
                
                &lt;controls:DataGridTextColumn 
                    Header=&quot;Notes&quot; 
                    Binding=&quot;{Binding Notes}&quot;
                    Width=&quot;*&quot;/&gt;
            &lt;/controls:DataGrid.Columns&gt;
        &lt;/controls:DataGrid&gt;

        &lt;!-- Status Bar --&gt;
        &lt;StackPanel Grid.Row=&quot;3&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot;&gt;
            &lt;ProgressRing 
                IsActive=&quot;{x:Bind ViewModel.IsBusy, Mode=OneWay}&quot;
                Width=&quot;20&quot; Height=&quot;20&quot;/&gt;
            &lt;TextBlock 
                Text=&quot;{x:Bind ViewModel.StatusMessage, Mode=OneWay}&quot;
                VerticalAlignment=&quot;Center&quot;/&gt;
            &lt;Button
                Content=&quot;View Details&quot;
                Command=&quot;{x:Bind ViewModel.ViewDetailCommand}&quot;
                Margin=&quot;12,0,0,0&quot;/&gt;
            &lt;Button
                Content=&quot;Edit&quot;
                Command=&quot;{x:Bind ViewModel.EditCommand}&quot;/&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Volvo/Views/View_Volvo_Settings.xaml">&lt;Page
    x:Class=&quot;MTM_Receiving_Application.Module_Volvo.Views.View_Volvo_Settings&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:models=&quot;using:MTM_Receiving_Application.Module_Volvo.Models&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    mc:Ignorable=&quot;d&quot;
    Loaded=&quot;OnPageLoaded&quot;&gt;

    &lt;Grid Padding=&quot;24&quot; RowSpacing=&quot;16&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header --&gt;
        &lt;TextBlock 
            Grid.Row=&quot;0&quot;
            Text=&quot;Volvo Dunnage Parts Master Data&quot;
            Style=&quot;{StaticResource TitleTextBlockStyle}&quot;/&gt;

        &lt;!-- Toolbar --&gt;
        &lt;CommandBar Grid.Row=&quot;1&quot; DefaultLabelPosition=&quot;Right&quot;&gt;
            &lt;AppBarButton 
                Icon=&quot;Add&quot; 
                Label=&quot;Add Part&quot; 
                Command=&quot;{x:Bind ViewModel.AddPartCommand, Mode=OneWay}&quot;/&gt;
            &lt;AppBarButton 
                Icon=&quot;Edit&quot; 
                Label=&quot;Edit Part&quot; 
                Command=&quot;{x:Bind ViewModel.EditPartCommand, Mode=OneWay}&quot;/&gt;
            &lt;AppBarButton 
                Icon=&quot;Delete&quot; 
                Label=&quot;Deactivate&quot; 
                Command=&quot;{x:Bind ViewModel.DeactivatePartCommand, Mode=OneWay}&quot;/&gt;
            &lt;AppBarSeparator/&gt;
            &lt;AppBarButton 
                Icon=&quot;PreviewLink&quot; 
                Label=&quot;View Components&quot; 
                Command=&quot;{x:Bind ViewModel.ViewComponentsCommand, Mode=OneWay}&quot;/&gt;
            &lt;AppBarSeparator/&gt;
            &lt;AppBarButton 
                Icon=&quot;Import&quot; 
                Label=&quot;Import CSV&quot; 
                Command=&quot;{x:Bind ViewModel.ImportCsvCommand, Mode=OneWay}&quot;/&gt;
            &lt;AppBarButton 
                Icon=&quot;Save&quot; 
                Label=&quot;Export CSV&quot; 
                Command=&quot;{x:Bind ViewModel.ExportCsvCommand, Mode=OneWay}&quot;/&gt;
            &lt;AppBarSeparator/&gt;
            &lt;AppBarButton 
                Icon=&quot;Refresh&quot; 
                Label=&quot;Refresh&quot; 
                Command=&quot;{x:Bind ViewModel.RefreshCommand, Mode=OneWay}&quot;/&gt;
            &lt;AppBarSeparator/&gt;
            &lt;AppBarToggleButton 
                Icon=&quot;View&quot; 
                Label=&quot;Show Inactive&quot;
                IsChecked=&quot;{x:Bind ViewModel.ShowInactive, Mode=TwoWay}&quot;/&gt;
        &lt;/CommandBar&gt;

        &lt;!-- Data Grid --&gt;
        &lt;Grid Grid.Row=&quot;2&quot;&gt;
            &lt;controls:DataGrid
                ItemsSource=&quot;{x:Bind ViewModel.Parts, Mode=OneWay}&quot;
                SelectedItem=&quot;{x:Bind ViewModel.SelectedPart, Mode=TwoWay}&quot;
                AutoGenerateColumns=&quot;False&quot;
                IsReadOnly=&quot;True&quot;
                GridLinesVisibility=&quot;All&quot;
                HeadersVisibility=&quot;Column&quot;
                AlternatingRowBackground=&quot;{ThemeResource SystemListLowColor}&quot;
                SelectionMode=&quot;Single&quot;&gt;
                &lt;controls:DataGrid.Columns&gt;
                    &lt;controls:DataGridTextColumn Header=&quot;Part Number&quot; Binding=&quot;{Binding PartNumber}&quot; Width=&quot;*&quot;/&gt;
                    &lt;controls:DataGridTextColumn Header=&quot;Qty/Skid&quot; Binding=&quot;{Binding QuantityPerSkid}&quot; Width=&quot;100&quot;/&gt;
                    &lt;controls:DataGridTemplateColumn Header=&quot;Active&quot; Width=&quot;80&quot;&gt;
                        &lt;controls:DataGridTemplateColumn.CellTemplate&gt;
                            &lt;DataTemplate x:DataType=&quot;models:Model_VolvoPart&quot;&gt;
                                &lt;TextBlock 
                                    Text=&quot;{x:Bind IsActive}&quot; 
                                    Foreground=&quot;{x:Bind IsActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter=&apos;Green|Gray&apos;}&quot;/&gt;
                            &lt;/DataTemplate&gt;
                        &lt;/controls:DataGridTemplateColumn.CellTemplate&gt;
                    &lt;/controls:DataGridTemplateColumn&gt;
                &lt;/controls:DataGrid.Columns&gt;
            &lt;/controls:DataGrid&gt;
        &lt;/Grid&gt;

        &lt;!-- Status Bar --&gt;
        &lt;Grid Grid.Row=&quot;3&quot; ColumnSpacing=&quot;12&quot;&gt;
            &lt;Grid.ColumnDefinitions&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
            &lt;/Grid.ColumnDefinitions&gt;

            &lt;ProgressRing 
                Grid.Column=&quot;0&quot;
                IsActive=&quot;{x:Bind ViewModel.IsBusy, Mode=OneWay}&quot;
                Width=&quot;20&quot; 
                Height=&quot;20&quot;
                Visibility=&quot;{x:Bind ViewModel.IsBusy, Mode=OneWay}&quot;/&gt;

            &lt;TextBlock 
                Grid.Column=&quot;1&quot;
                Text=&quot;{x:Bind ViewModel.StatusMessage, Mode=OneWay}&quot;
                VerticalAlignment=&quot;Center&quot;/&gt;
        &lt;/Grid&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Volvo/Views/View_Volvo_ShipmentEntry.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Volvo.ViewModels;
using MTM_Receiving_Application.Module_Volvo.Models;

namespace MTM_Receiving_Application.Module_Volvo.Views;

/// &lt;summary&gt;
/// Page for Volvo shipment entry
/// &lt;/summary&gt;
public sealed partial class View_Volvo_ShipmentEntry : Page
{
    public ViewModel_Volvo_ShipmentEntry ViewModel { get; }

    public View_Volvo_ShipmentEntry()
    {
        ViewModel = App.GetService&lt;ViewModel_Volvo_ShipmentEntry&gt;();
        InitializeComponent();
    }

    private async void OnLoaded(object sender, RoutedEventArgs e)
    {
        await ViewModel.InitializeAsync();
    }

    private void OnPartSearchTextChanged(AutoSuggestBox sender, AutoSuggestBoxTextChangedEventArgs args)
    {
        if (args.Reason == AutoSuggestionBoxTextChangeReason.UserInput)
        {
            ViewModel.UpdatePartSuggestions(sender.Text);
        }
    }

    private void OnPartSuggestionChosen(AutoSuggestBox sender, AutoSuggestBoxSuggestionChosenEventArgs args)
    {
        if (args.SelectedItem is Model_VolvoPart selectedPart)
        {
            ViewModel.OnPartSuggestionChosen(selectedPart);
        }
    }
}</file><file path="Module_Volvo/Views/VolvoPartAddEditDialog.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Volvo.Models;

namespace MTM_Receiving_Application.Module_Volvo.Views;

/// &lt;summary&gt;
/// Dialog for adding or editing a Volvo part
/// &lt;/summary&gt;
public sealed partial class VolvoPartAddEditDialog : ContentDialog
{
    public Model_VolvoPart? Part { get; private set; }
    public bool IsEditMode { get; private set; }

    public VolvoPartAddEditDialog()
    {
        InitializeComponent();
    }

    /// &lt;summary&gt;
    /// Initialize dialog in Add mode
    /// &lt;/summary&gt;
    public void InitializeForAdd()
    {
        IsEditMode = false;
        Title = &quot;Add New Volvo Part&quot;;
        PartNumberTextBox.IsReadOnly = false;
        EditModeWarning.IsOpen = false;

        // Clear fields
        PartNumberTextBox.Text = string.Empty;
        QuantityPerSkidNumberBox.Value = 0;
    }

    /// &lt;summary&gt;
    /// Initialize dialog in Edit mode with existing part data
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;part&quot;&gt;&lt;/param&gt;
    public void InitializeForEdit(Model_VolvoPart part)
    {
        IsEditMode = true;
        Title = $&quot;Edit Part: {part.PartNumber}&quot;;
        PartNumberTextBox.IsReadOnly = true; // Part number cannot be changed
        EditModeWarning.IsOpen = true;

        // Pre-fill fields
        PartNumberTextBox.Text = part.PartNumber;
        QuantityPerSkidNumberBox.Value = part.QuantityPerSkid;
    }

    private void OnSaveClicked(ContentDialog sender, ContentDialogButtonClickEventArgs args)
    {
        // Validate inputs
        if (string.IsNullOrWhiteSpace(PartNumberTextBox.Text))
        {
            args.Cancel = true;
            // In a real implementation, show error message
            return;
        }

        // Create part object
        Part = new Model_VolvoPart
        {
            PartNumber = PartNumberTextBox.Text.Trim().ToUpperInvariant(),
            QuantityPerSkid = (int)QuantityPerSkidNumberBox.Value,
            IsActive = true
        };
    }
}</file><file path="Module_Volvo/Views/VolvoShipmentEditDialog.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Volvo.Models;
using System;
using System.Collections.ObjectModel;

namespace MTM_Receiving_Application.Module_Volvo.Views;

public sealed partial class VolvoShipmentEditDialog : ContentDialog
{
    public Model_VolvoShipment Shipment { get; set; } = null!;
    public ObservableCollection&lt;Model_VolvoShipmentLine&gt; Lines { get; private set; }
    public ObservableCollection&lt;Model_VolvoPart&gt; AvailableParts { get; set; }

    public VolvoShipmentEditDialog()
    {
        InitializeComponent();
        Lines = new ObservableCollection&lt;Model_VolvoShipmentLine&gt;();
        AvailableParts = new ObservableCollection&lt;Model_VolvoPart&gt;();

        // Wire up button events
        AddPartButton.Click += (s, e) =&gt; AddNewLine();
        RemovePartButton.Click += (s, e) =&gt; RemoveSelectedLine();

        // Set DataGrid ItemsSource
        PartsDataGrid.ItemsSource = Lines;
    }

    public void LoadShipment(Model_VolvoShipment shipment, ObservableCollection&lt;Model_VolvoShipmentLine&gt; lines, ObservableCollection&lt;Model_VolvoPart&gt; availableParts)
    {
        Shipment = shipment;
        AvailableParts = availableParts;

        // Populate header fields
        ShipmentDatePicker.Date = shipment.ShipmentDate;
        ShipmentNumberBox.Text = shipment.ShipmentNumber.ToString();
        PONumberBox.Text = shipment.PONumber ?? string.Empty;
        ReceiverNumberBox.Text = shipment.ReceiverNumber ?? string.Empty;
        NotesBox.Text = shipment.Notes ?? string.Empty;

        // Load lines
        Lines.Clear();
        foreach (var line in lines)
        {
            Lines.Add(line);
        }
    }

    public Model_VolvoShipment GetUpdatedShipment()
    {
        Shipment.ShipmentDate = ShipmentDatePicker.Date?.DateTime ?? DateTime.Now;
        Shipment.PONumber = string.IsNullOrWhiteSpace(PONumberBox.Text) ? null : PONumberBox.Text;
        Shipment.ReceiverNumber = string.IsNullOrWhiteSpace(ReceiverNumberBox.Text) ? null : ReceiverNumberBox.Text;
        Shipment.Notes = string.IsNullOrWhiteSpace(NotesBox.Text) ? null : NotesBox.Text;

        return Shipment;
    }

    public ObservableCollection&lt;Model_VolvoShipmentLine&gt; GetUpdatedLines()
    {
        return Lines;
    }

    private void AddNewLine()
    {
        Lines.Add(new Model_VolvoShipmentLine
        {
            ShipmentId = Shipment.Id,
            PartNumber = string.Empty,
            ReceivedSkidCount = 0,
            CalculatedPieceCount = 0,
            HasDiscrepancy = false,
            ExpectedSkidCount = null,
            DiscrepancyNote = null
        });
    }

    private void RemoveSelectedLine()
    {
        if (PartsDataGrid.SelectedItem is Model_VolvoShipmentLine selectedLine)
        {
            Lines.Remove(selectedLine);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/GlobalUsings.cs">global using System;
global using System.Collections.Generic;
global using System.Linq;
global using System.Threading.Tasks;
global using Xunit;
global using FluentAssertions;
global using MTM_Receiving_Application.Module_Dunnage.Models;</file><file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_DecimalToInt_Tests.cs">using MTM_Receiving_Application.Module_Core.Converters;

namespace MTM_Receiving_Application.Tests.Module_Core.Converters
{
    /// &lt;summary&gt;
    /// Unit tests for &lt;see cref=&quot;Converter_DecimalToInt&quot;/&gt;.
    /// Tests conversion of decimal/double/float values to formatted integer strings (N0 format).
    /// ConvertBack parses strings back to decimal.
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Type&quot;, &quot;Converter&quot;)]
    public class Converter_DecimalToInt_Tests
    {
        private readonly Converter_DecimalToInt _sut;

        public Converter_DecimalToInt_Tests()
        {
            _sut = new();
        }

        [Theory]
        [InlineData(42.99, &quot;42&quot;)]
        [InlineData(100.01, &quot;100&quot;)]
        [InlineData(0.0, &quot;0&quot;)]
        [InlineData(1234.56, &quot;1,234&quot;)]
        [InlineData(-50.75, &quot;-50&quot;)]
        public void Convert_WithDecimalValue_ReturnsFormattedIntegerString(decimal input, string expected)
        {
            // Act
            object result = _sut.Convert(input, typeof(string), default(object)!, &quot;en-US&quot;);

            // Assert
            _ = result.Should().Be(expected);
        }

        [Theory]
        [InlineData(42.99, &quot;42&quot;)]
        [InlineData(1234.56, &quot;1,234&quot;)]
        [InlineData(0.0, &quot;0&quot;)]
        public void Convert_WithDoubleValue_ReturnsFormattedIntegerString(double input, string expected)
        {
            // Act
            object result = _sut.Convert(input, typeof(string), default(object)!, &quot;en-US&quot;);

            // Assert
            _ = result.Should().Be(expected);
        }

        [Theory]
        [InlineData(42.99f, &quot;42&quot;)]
        [InlineData(100.5f, &quot;100&quot;)]
        public void Convert_WithFloatValue_ReturnsFormattedIntegerString(float input, string expected)
        {
            // Act
            object result = _sut.Convert(input, typeof(string), default(object)!, &quot;en-US&quot;);

            // Assert
            _ = result.Should().Be(expected);
        }

        [Fact]
        public void Convert_WithNullValue_ReturnsEmptyString()
        {
            // Act
            object result = _sut.Convert(null!, typeof(string), default(object)!, &quot;en-US&quot;);

            // Assert
            _ = result.Should().Be(string.Empty);
        }

        [Theory]
        [InlineData(&quot;true&quot;)]
        [InlineData([&quot;text&quot;])]
        public void Convert_WithNonNumericValue_ReturnsValueToString(object input)
        {
            // Act
            object result = _sut.Convert(input, typeof(string), default(object)!, &quot;en-US&quot;);

            // Assert
            _ = result.Should().Be(input.ToString());
        }

        [Theory]
        [InlineData(&quot;42&quot;, 42)]
        [InlineData(&quot;100&quot;, 100)]
        [InlineData(&quot;0&quot;, 0)]
        [InlineData(&quot;1234&quot;, 1234)]
        [InlineData(&quot;-50&quot;, -50)]
        public void ConvertBack_WithValidString_ReturnsDecimal(string input, decimal expected)
        {
            // Act
            object result = _sut.ConvertBack(input, typeof(decimal), default(object)!, &quot;en-US&quot;);

            // Assert
            _ = result.Should().Be(expected);
        }

        [Theory]
        [InlineData(&quot;&quot;)]
        [InlineData(&quot;abc&quot;)]
        [InlineData(null)]
        public void ConvertBack_WithInvalidString_ReturnsZero(string? input)
        {
            // Act
            object result = _sut.ConvertBack(input!, typeof(decimal), default(object)!, &quot;en-US&quot;);

            // Assert
            _ = result.Should().Be(0m);
        }

        [Fact]
        public void ConvertBack_WithNonStringValue_ReturnsZero()
        {
            // Act
            object result = _sut.ConvertBack(42, typeof(decimal), default(object)!, &quot;en-US&quot;);

            // Assert
            _ = result.Should().Be(0m);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Models/Core/Model_Dao_Result_Factory_Tests.cs">using System;
using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using Xunit;

namespace MTM_Receiving_Application.Tests.Module_Core.Models.Core
{
    /// &lt;summary&gt;
    /// Unit tests for Model_Dao_Result_Factory
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_Dao_Result_Factory_Tests
    {
        [Fact]
        public void Failure_CreatesFailedResult()
        {
            // Act
            var result = Model_Dao_Result_Factory.Failure(&quot;Error!&quot;);

            // Assert
            result.Success.Should().BeFalse();
            result.ErrorMessage.Should().Be(&quot;Error!&quot;);
            result.Severity.Should().Be(Enum_ErrorSeverity.Error);
        }

        [Fact]
        public void Failure_WithNullMessage_UsesDefaultMessage()
        {
            // Act
            var result = Model_Dao_Result_Factory.Failure(null);

            // Assert
            result.Success.Should().BeFalse();
            result.ErrorMessage.Should().Be(&quot;Operation failed.&quot;);
        }

        [Fact]
        public void Failure_WithWhitespaceMessage_UsesDefaultMessage()
        {
            // Act
            var result = Model_Dao_Result_Factory.Failure(&quot;   &quot;);

            // Assert
            result.Success.Should().BeFalse();
            result.ErrorMessage.Should().Be(&quot;Operation failed.&quot;);
        }

        [Fact]
        public void Failure_WithException_CapturesException()
        {
            // Arrange
            var ex = new InvalidOperationException(&quot;Test ex&quot;);

            // Act
            var result = Model_Dao_Result_Factory.Failure(&quot;Error!&quot;, ex);

            // Assert
            result.Success.Should().BeFalse();
            result.Exception.Should().Be(ex);
        }

        [Fact]
        public void Success_CreatesSuccessResult()
        {
            // Act
            var result = Model_Dao_Result_Factory.Success(5);

            // Assert
            result.Success.Should().BeTrue();
            result.AffectedRows.Should().Be(5);
            result.ErrorMessage.Should().BeEmpty();
        }

        [Fact]
        public void Success_WithNegativeAffectedRows_ClampsToZero()
        {
            // Act
            var result = Model_Dao_Result_Factory.Success(-1);

            // Assert
            result.Success.Should().BeTrue();
            result.AffectedRows.Should().Be(0);
        }

        [Fact]
        public void FailureGeneric_CreatesFailedResult()
        {
            // Act
            var result = Model_Dao_Result_Factory.Failure&lt;string&gt;(&quot;Generic Error!&quot;);

            // Assert
            result.Success.Should().BeFalse();
            result.ErrorMessage.Should().Be(&quot;Generic Error!&quot;);
            result.Data.Should().BeNull();
        }

        [Fact]
        public void FailureGeneric_WithNullMessage_UsesDefaultMessage()
        {
            // Act
            var result = Model_Dao_Result_Factory.Failure&lt;string&gt;(null);

            // Assert
            result.Success.Should().BeFalse();
            result.ErrorMessage.Should().Be(&quot;Operation failed.&quot;);
        }

        [Fact]
        public void SuccessGeneric_CreatesSuccessResultWithData()
        {
            // Act
            var result = Model_Dao_Result_Factory.Success(&quot;Test Data&quot;, 1);

            // Assert
            result.Success.Should().BeTrue();
            result.Data.Should().Be(&quot;Test Data&quot;);
            result.AffectedRows.Should().Be(1);
            result.ErrorMessage.Should().BeEmpty();
        }

        [Fact]
        public void SuccessGeneric_WithNegativeAffectedRows_ClampsToZero()
        {
            // Act
            var result = Model_Dao_Result_Factory.Success(&quot;Test Data&quot;, -1);

            // Assert
            result.Success.Should().BeTrue();
            result.AffectedRows.Should().Be(0);
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_UserSession_Tests.cs">using System;
using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Models.Systems;
using Xunit;

namespace MTM_Receiving_Application.Tests.Module_Core.Models.Systems
{
    /// &lt;summary&gt;
    /// Unit tests for Model_UserSession
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_UserSession_Tests
    {
        [Fact]
        public void DefaultConstructor_SetsTimestamps()
        {
            // Arrange
            var before = DateTime.Now;

            // Act
            var session = new Model_UserSession();
            var after = DateTime.Now;

            // Assert
            session.LoginTimestamp.Should().BeOnOrAfter(before);
            session.LoginTimestamp.Should().BeOnOrBefore(after);
            session.LastActivityTimestamp.Should().BeOnOrAfter(before);
            session.LastActivityTimestamp.Should().BeOnOrBefore(after);
        }

        [Fact]
        public void UpdateLastActivity_UpdatesTimestamp()
        {
            // Arrange
            var session = new Model_UserSession();
            session.LastActivityTimestamp = DateTime.Now.AddMinutes(-1);

            // Act
            session.UpdateLastActivity();

            // Assert
            session.LastActivityTimestamp.Should().BeAfter(DateTime.Now.AddSeconds(-5));
        }

        [Fact]
        public void TimeSinceLastActivity_ReturnsCorrectDifference()
        {
            // Arrange
            var session = new Model_UserSession();
            session.LastActivityTimestamp = DateTime.Now.AddMinutes(-5);

            // Act
            var elapsed = session.TimeSinceLastActivity;

            // Assert
            elapsed.Should().BeCloseTo(TimeSpan.FromMinutes(5), TimeSpan.FromSeconds(2));
        }

        [Fact]
        public void IsTimedOut_ReturnsTrueWhenExpired()
        {
            // Arrange
            var session = new Model_UserSession
            {
                TimeoutDuration = TimeSpan.FromMinutes(10),
                LastActivityTimestamp = DateTime.Now.AddMinutes(-11)
            };

            // Act
            var isTimedOut = session.IsTimedOut;

            // Assert
            isTimedOut.Should().BeTrue();
        }

        [Fact]
        public void IsTimedOut_ReturnsFalseWhenActive()
        {
            // Arrange
            var session = new Model_UserSession
            {
                TimeoutDuration = TimeSpan.FromMinutes(10),
                LastActivityTimestamp = DateTime.Now.AddMinutes(-5)
            };

            // Act
            var isTimedOut = session.IsTimedOut;

            // Assert
            isTimedOut.Should().BeFalse();
        }

        [Fact]
        public void HasErpAccess_ReturnsFalseIfUserIsNull()
        {
            // Arrange
            var session = new Model_UserSession { User = null };

            // Act
            var hasAccess = session.HasErpAccess;

            // Assert
            hasAccess.Should().BeFalse();
        }

        [Fact]
        public void HasErpAccess_ReturnsFalseIfUserHasNoVisualUsername()
        {
            // Arrange
            var session = new Model_UserSession
            {
                User = new Model_User { VisualUsername = null }
            };

            // Act
            var hasAccess = session.HasErpAccess;

            // Assert
            hasAccess.Should().BeFalse();
        }

        [Fact]
        public void HasErpAccess_ReturnsTrueIfUserHasVisualUsername()
        {
            // Arrange
            var session = new Model_UserSession
            {
                User = new Model_User { VisualUsername = &quot;user&quot; }
            };

            // Act
            var hasAccess = session.HasErpAccess;

            // Assert
            hasAccess.Should().BeTrue();
        }

        [Fact]
        public void Constructor_WithUser_SetsUser()
        {
            // Arrange
            var user = new Model_User();

            // Act
            var session = new Model_UserSession(user);

            // Assert
            session.User.Should().BeSameAs(user);
        }

        [Fact]
        public void Constructor_WithNullUser_Throws()
        {
            // Act
            var act = static () =&gt; new Model_UserSession(null!);

            // Assert
            act.Should().Throw&lt;ArgumentNullException&gt;();
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_WorkstationConfig_Tests.cs">using System;
using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Defaults;
using MTM_Receiving_Application.Module_Core.Models.Systems;
using Xunit;

namespace MTM_Receiving_Application.Tests.Module_Core.Models.Systems
{
    /// &lt;summary&gt;
    /// Unit tests for Model_WorkstationConfig logic
    /// &lt;/summary&gt;
    [Trait(&quot;Category&quot;, &quot;Unit&quot;)]
    [Trait(&quot;Layer&quot;, &quot;Model&quot;)]
    public class Model_WorkstationConfig_Tests
    {
        [Fact]
        public void Constructor_Default_UsesMachineName()
        {
            var config = new Model_WorkstationConfig();

            config.ComputerName.Should().Be(Environment.MachineName);
        }

        [Fact]
        public void Constructor_WithParameter_SetsComputerName()
        {
            var config = new Model_WorkstationConfig(&quot;TEST-PC&quot;);

            config.ComputerName.Should().Be(&quot;TEST-PC&quot;);
        }

        [Fact]
        public void IsSharedTerminal_ReturnsTrueForSharedType()
        {
            var config = new Model_WorkstationConfig { WorkstationType = WorkstationDefaults.SharedTerminalWorkstationType };

            config.IsSharedTerminal.Should().BeTrue();
        }

        [Fact]
        public void IsSharedTerminal_ReturnsFalseForSharedType()
        {
            var config = new Model_WorkstationConfig { WorkstationType = WorkstationDefaults.SharedTerminalWorkstationType };

            config.IsPersonalWorkstation.Should().BeFalse();
        }

        [Fact]
        public void IsPersonalWorkstation_ReturnsTrueForPersonalType()
        {
            var config = new Model_WorkstationConfig { WorkstationType = WorkstationDefaults.PersonalWorkstationWorkstationType };

            config.IsPersonalWorkstation.Should().BeTrue();
        }

        [Fact]
        public void IsPersonalWorkstation_ReturnsFalseForPersonalType()
        {
            var config = new Model_WorkstationConfig { WorkstationType = WorkstationDefaults.PersonalWorkstationWorkstationType };

            config.IsSharedTerminal.Should().BeFalse();
        }

        [Fact]
        public void TimeoutDuration_SharedTerminal_ReturnsSharedTimeoutMinutes()
        {
            var config = new Model_WorkstationConfig { WorkstationType = WorkstationDefaults.SharedTerminalWorkstationType };

            config.TimeoutDuration.Should().Be(TimeSpan.FromMinutes(WorkstationDefaults.SharedTerminalTimeoutMinutes));
        }

        [Fact]
        public void TimeoutDuration_PersonalWorkstation_ReturnsPersonalTimeoutMinutes()
        {
            var config = new Model_WorkstationConfig { WorkstationType = WorkstationDefaults.PersonalWorkstationWorkstationType };

            config.TimeoutDuration.Should().Be(TimeSpan.FromMinutes(WorkstationDefaults.PersonalWorkstationTimeoutMinutes));
        }

        [Fact]
        public void TimeoutDuration_UnknownType_ReturnsPersonalTimeoutMinutesDefault()
        {
            var config = new Model_WorkstationConfig { WorkstationType = &quot;unknown&quot; };

            config.TimeoutDuration.Should().Be(TimeSpan.FromMinutes(WorkstationDefaults.PersonalWorkstationTimeoutMinutes));
        }
    }
}</file><file path="Module_Core/Models/Systems/Model_WorkstationConfig.cs">using System;
using MTM_Receiving_Application.Module_Core.Defaults;

namespace MTM_Receiving_Application.Module_Core.Models.Systems
{
    /// &lt;summary&gt;
    /// Represents workstation detection and configuration logic.
    /// Maps to &apos;auth_workstation_config&apos; database table.
    /// &lt;/summary&gt;
    public class Model_WorkstationConfig
    {
        // ====================================================================
        // Workstation Information
        // ====================================================================

        /// &lt;summary&gt;
        /// Windows computer name (from Environment.MachineName)
        /// &lt;/summary&gt;
        public string ComputerName { get; set; } = Environment.MachineName;

        /// &lt;summary&gt;
        /// Workstation type: &quot;personal_workstation&quot; or &quot;shared_terminal&quot;
        /// &lt;/summary&gt;
        public string WorkstationType { get; set; } = string.Empty;

        /// &lt;summary&gt;
        /// Optional description of workstation location/purpose
        /// &lt;/summary&gt;
        public string? Description { get; set; }

        // ====================================================================
        // Computed Properties
        // ====================================================================

        /// &lt;summary&gt;
        /// True if workstation is configured as shared terminal (PIN login required)
        /// &lt;/summary&gt;
        public bool IsSharedTerminal =&gt; WorkstationType == WorkstationDefaults.SharedTerminalWorkstationType;

        /// &lt;summary&gt;
        /// True if workstation is personal workstation (automatic Windows login)
        /// &lt;/summary&gt;
        public bool IsPersonalWorkstation =&gt; WorkstationType == WorkstationDefaults.PersonalWorkstationWorkstationType;

        /// &lt;summary&gt;
        /// Session timeout duration based on workstation type
        /// 15 minutes for shared terminals, 30 minutes for personal workstations
        /// &lt;/summary&gt;
        public TimeSpan TimeoutDuration =&gt; IsSharedTerminal
            ? TimeSpan.FromMinutes(WorkstationDefaults.SharedTerminalTimeoutMinutes)
            : TimeSpan.FromMinutes(WorkstationDefaults.PersonalWorkstationTimeoutMinutes);

        // ====================================================================
        // Constructor
        // ====================================================================

        /// &lt;summary&gt;
        /// Default constructor
        /// &lt;/summary&gt;
        public Model_WorkstationConfig()
        {
        }

        /// &lt;summary&gt;
        /// Constructor with computer name detection
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;computerName&quot;&gt;Computer name (defaults to Environment.MachineName)&lt;/param&gt;
        public Model_WorkstationConfig(string? computerName = null)
        {
            ComputerName = computerName ?? Environment.MachineName;
        }
    }
}</file><file path="Module_Core/Services/Authentication/Service_Authentication.cs">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.RegularExpressions;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Data.Authentication;
using MTM_Receiving_Application.Module_Core.Models.Systems;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Core.Services.Authentication
{
    /// &lt;summary&gt;
    /// Service implementation for user authentication operations.
    /// Orchestrates authentication flows and coordinates with data access layer.
    /// &lt;/summary&gt;
    public class Service_Authentication : IService_Authentication
    {
        private readonly Dao_User _daoUser;
        private readonly IService_ErrorHandler _errorHandler;
        private static readonly Regex _regex = new Regex(@&quot;^\d{4}$&quot;);

        /// &lt;summary&gt;
        /// Constructor with dependency injection.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;daoUser&quot;&gt;User data access object&lt;/param&gt;
        /// &lt;param name=&quot;errorHandler&quot;&gt;Error handler for logging&lt;/param&gt;
        public Service_Authentication(Dao_User daoUser, IService_ErrorHandler errorHandler)
        {
            _daoUser = daoUser ?? throw new ArgumentNullException(nameof(daoUser));
            _errorHandler = errorHandler ?? throw new ArgumentNullException(nameof(errorHandler));
        }

        // ====================================================================
        // Authentication Methods
        // ====================================================================

        /// &lt;inheritdoc/&gt;
        public async Task&lt;Model_AuthenticationResult&gt; AuthenticateByWindowsUsernameAsync(
            string windowsUsername,
            IProgress&lt;string&gt;? progress = null)
        {
            try
            {
                progress?.Report(&quot;Authenticating Windows user...&quot;);

                // Validate input
                if (string.IsNullOrWhiteSpace(windowsUsername))
                {
                    return Model_AuthenticationResult.ErrorResult(&quot;Windows username is required&quot;);
                }

                // Query database for user
                var result = await _daoUser.GetUserByWindowsUsernameAsync(windowsUsername);

                if (!result.Success)
                {
                    progress?.Report(&quot;User not found in database&quot;);
                    return Model_AuthenticationResult.ErrorResult(result.ErrorMessage);
                }

                if (result.Data == null)
                {
                    return Model_AuthenticationResult.ErrorResult(&quot;User data is invalid&quot;);
                }

                // Log successful authentication
                await LogUserActivityAsync(
                    &quot;login_success&quot;,
                    windowsUsername,
                    Environment.MachineName,
                    &quot;Windows authentication successful&quot;);

                progress?.Report($&quot;Welcome, {result.Data.FullName}&quot;);
                return Model_AuthenticationResult.SuccessResult(result.Data);
            }
            catch (Exception ex)
            {
                if (_errorHandler != null)
                {
                    await _errorHandler.HandleErrorAsync(&quot;Authentication by Windows username failed&quot;, Enum_ErrorSeverity.Error, ex, false);
                }

                return Model_AuthenticationResult.ErrorResult($&quot;Authentication error: {ex.Message}&quot;);
            }
        }

        /// &lt;inheritdoc/&gt;
        public async Task&lt;Model_AuthenticationResult&gt; AuthenticateByPinAsync(
            string username,
            string pin,
            IProgress&lt;string&gt;? progress = null)
        {
            try
            {
                progress?.Report(&quot;Validating credentials...&quot;);

                // Validate input
                if (string.IsNullOrWhiteSpace(username))
                {
                    return Model_AuthenticationResult.ErrorResult(&quot;Username is required&quot;);
                }

                if (string.IsNullOrWhiteSpace(pin))
                {
                    return Model_AuthenticationResult.ErrorResult(&quot;PIN is required&quot;);
                }

                // Validate PIN format only (not uniqueness - that&apos;s for creation, not authentication)
                if (pin.Length != 4 || !pin.All(char.IsDigit))
                {
                    return Model_AuthenticationResult.ErrorResult(&quot;PIN must be exactly 4 numeric digits&quot;);
                }

                // Query database for user with PIN
                var result = await _daoUser.ValidateUserPinAsync(username, pin);

                if (!result.Success || result.Data == null)
                {
                    // Log failed attempt
                    await LogUserActivityAsync(
                        &quot;login_failed&quot;,
                        username,
                        Environment.MachineName,
                        $&quot;Invalid credentials for user: {username}&quot;);

                    progress?.Report(&quot;Invalid username or PIN&quot;);
                    return Model_AuthenticationResult.ErrorResult(&quot;Invalid username or PIN&quot;);
                }

                // Log successful authentication
                await LogUserActivityAsync(
                    &quot;login_success&quot;,
                    result.Data.WindowsUsername,
                    Environment.MachineName,
                    $&quot;PIN authentication successful for {result.Data.FullName}&quot;);

                progress?.Report($&quot;Welcome, {result.Data.FullName}&quot;);
                return Model_AuthenticationResult.SuccessResult(result.Data);
            }
            catch (Exception ex)
            {
                if (_errorHandler != null)
                {
                    await _errorHandler.HandleErrorAsync(&quot;Authentication by PIN failed&quot;, Enum_ErrorSeverity.Error, ex, false);
                }

                return Model_AuthenticationResult.ErrorResult($&quot;Authentication error: {ex.Message}&quot;);
            }
        }

        // ====================================================================
        // User Management
        // ====================================================================

        /// &lt;inheritdoc/&gt;
        public async Task&lt;Model_CreateUserResult&gt; CreateNewUserAsync(
            Model_User user,
            string createdBy,
            IProgress&lt;string&gt;? progress = null)
        {
            try
            {
                progress?.Report(&quot;Validating user data...&quot;);

                // Validate required fields
                if (string.IsNullOrWhiteSpace(user.WindowsUsername))
                {
                    return Model_CreateUserResult.ErrorResult(&quot;Windows username is required&quot;);
                }

                if (string.IsNullOrWhiteSpace(user.FullName))
                {
                    return Model_CreateUserResult.ErrorResult(&quot;Full name is required&quot;);
                }

                if (string.IsNullOrWhiteSpace(user.Department))
                {
                    return Model_CreateUserResult.ErrorResult(&quot;Department is required&quot;);
                }

                if (string.IsNullOrWhiteSpace(user.Shift))
                {
                    return Model_CreateUserResult.ErrorResult(&quot;Shift is required&quot;);
                }

                // Validate PIN
                var pinValidation = await ValidatePinAsync(user.Pin);
                if (!pinValidation.IsValid)
                {
                    return Model_CreateUserResult.ErrorResult(pinValidation.ErrorMessage);
                }

                progress?.Report(&quot;Creating user account...&quot;);

                // Create user in database
                var result = await _daoUser.CreateNewUserAsync(user, createdBy);

                if (!result.Success || result.Data == 0)
                {
                    return Model_CreateUserResult.ErrorResult(result.ErrorMessage);
                }

                // Log user creation
                await LogUserActivityAsync(
                    &quot;user_created&quot;,
                    user.WindowsUsername,
                    Environment.MachineName,
                    $&quot;New user created: {user.FullName} (Emp #{result.Data}) by {createdBy}&quot;);

                progress?.Report($&quot;Account created successfully. Employee #{result.Data}&quot;);
                return Model_CreateUserResult.SuccessResult(result.Data);
            }
            catch (Exception ex)
            {
                if (_errorHandler != null)
                {
                    await _errorHandler.HandleErrorAsync(&quot;Create new user failed&quot;, Enum_ErrorSeverity.Error, ex, false);
                }

                return Model_CreateUserResult.ErrorResult($&quot;User creation error: {ex.Message}&quot;);
            }
        }

        // ====================================================================
        // Validation Methods
        // ====================================================================

        /// &lt;inheritdoc/&gt;
        public async Task&lt;Model_ValidationResult&gt; ValidatePinAsync(string pin, int? excludeEmployeeNumber = null)
        {
            try
            {
                // Check format (4 digits)
                if (string.IsNullOrWhiteSpace(pin))
                {
                    return Model_ValidationResult.Invalid(&quot;PIN is required&quot;);
                }

                if (pin.Length != 4)
                {
                    return Model_ValidationResult.Invalid(&quot;PIN must be exactly 4 digits&quot;);
                }

                if (!_regex.IsMatch(pin))
                {
                    return Model_ValidationResult.Invalid(&quot;PIN must contain only numeric digits&quot;);
                }

                return Model_ValidationResult.Valid();
            }
            catch (Exception ex)
            {
                if (_errorHandler != null)
                {
                    await _errorHandler.HandleErrorAsync(&quot;PIN validation failed&quot;, Enum_ErrorSeverity.Error, ex, false);
                }

                return Model_ValidationResult.Invalid($&quot;Validation error: {ex.Message}&quot;);
            }
        }

        // ====================================================================
        // Configuration Methods
        // ====================================================================

        /// &lt;inheritdoc/&gt;
        public async Task&lt;Model_WorkstationConfig&gt; DetectWorkstationTypeAsync(string? computerName = null)
        {
            try
            {
                computerName ??= Environment.MachineName;
                computerName = computerName.Trim();

                // Get list of shared terminal names from database
                var sharedTerminalsResult = await _daoUser.GetSharedTerminalNamesAsync();

                var config = new Model_WorkstationConfig(computerName);

                if (sharedTerminalsResult.Success &amp;&amp; sharedTerminalsResult.Data != null)
                {
                    // Check if current computer is in shared terminals list
                    var isShared = sharedTerminalsResult.Data.Any(name =&gt;
                        string.Equals(name?.Trim(), computerName, StringComparison.OrdinalIgnoreCase));
                    config.WorkstationType = isShared ? &quot;shared_terminal&quot; : &quot;personal_workstation&quot;;
                    config.Description = isShared
                        ? &quot;Shared terminal - PIN authentication required&quot;
                        : &quot;Personal workstation - Windows authentication&quot;;
                }
                else
                {
                    // Default to personal workstation if query fails
                    config.WorkstationType = &quot;personal_workstation&quot;;
                    config.Description = &quot;Personal workstation (default)&quot;;
                }

                // Best-effort persistence: ensure this machine exists in auth_workstation_config.
                // If the SP isn&apos;t deployed yet, ignore and proceed.
                try
                {
                    await _daoUser.UpsertWorkstationConfigAsync(
                        config.ComputerName,
                        config.WorkstationType,
                        isActive: true,
                        description: config.Description);
                }
                catch
                {
                    // Swallow: persistence must not block startup.
                }

                return config;
            }
            catch (Exception ex)
            {
                if (_errorHandler != null)
                {
                    await _errorHandler.HandleErrorAsync(&quot;Workstation type detection failed&quot;, Enum_ErrorSeverity.Warning, ex, false);
                }

                // Return safe default
                return new Model_WorkstationConfig(computerName ?? Environment.MachineName)
                {
                    WorkstationType = &quot;personal_workstation&quot;,
                    Description = &quot;Personal workstation (default after error)&quot;
                };
            }
        }

        /// &lt;inheritdoc/&gt;
        public async Task&lt;List&lt;string&gt;&gt; GetActiveDepartmentsAsync()
        {
            try
            {
                var result = await _daoUser.GetActiveDepartmentsAsync();

                if (result.Success &amp;&amp; result.Data != null)
                {
                    return result.Data;
                }

                // Return empty list if query fails
                return new List&lt;string&gt;();
            }
            catch (Exception ex)
            {
                if (_errorHandler != null)
                {
                    await _errorHandler.HandleErrorAsync(&quot;Get active departments failed&quot;, Enum_ErrorSeverity.Warning, ex, false);
                }

                return new List&lt;string&gt;();
            }
        }

        // ====================================================================
        // Activity Logging
        // ====================================================================

        /// &lt;inheritdoc/&gt;
        public async Task LogUserActivityAsync(string eventType, string username, string workstationName, string details)
        {
            try
            {
                await _daoUser.LogUserActivityAsync(eventType, username, workstationName, details);
            }
            catch (Exception ex)
            {
                // Log errors but don&apos;t block application flow
                if (_errorHandler != null)
                {
                    await _errorHandler.HandleErrorAsync(&quot;Activity logging failed&quot;, Enum_ErrorSeverity.Info, ex, false);
                }

                System.Diagnostics.Debug.WriteLine($&quot;Failed to log activity: {ex.Message}&quot;);
            }
        }
    }
}</file><file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_AdminInventoryViewModel.cs">using System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Settings.Interfaces;
using MTM_Receiving_Application.Module_Dunnage.Data;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.ViewModels;

/// &lt;summary&gt;
/// ViewModel for managing the Inventoried Parts List
/// Enables adding, editing, and removing parts that require Visual ERP inventory tracking
/// &lt;/summary&gt;
public partial class ViewModel_Dunnage_AdminInventory : ViewModel_Shared_Base
{
    private readonly Dao_InventoriedDunnage _daoInventory;
    private readonly Dao_DunnagePart _daoPart;
    private readonly IService_DunnageAdminWorkflow _adminWorkflow;
    private readonly IService_Window _windowService;

    [ObservableProperty]
    private ObservableCollection&lt;Model_InventoriedDunnage&gt; _inventoriedParts;

    [ObservableProperty]
    private Model_InventoriedDunnage? _selectedInventoriedPart;

    /// &lt;summary&gt;
    /// Gets whether a part is currently selected
    /// &lt;/summary&gt;
    public bool HasSelection =&gt; SelectedInventoriedPart != null;

    public ViewModel_Dunnage_AdminInventory(
        Dao_InventoriedDunnage daoInventory,
        Dao_DunnagePart daoPart,
        IService_DunnageAdminWorkflow adminWorkflow,
        IService_Window windowService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger)
        : base(errorHandler, logger)
    {
        _daoInventory = daoInventory ?? throw new ArgumentNullException(nameof(daoInventory));
        _daoPart = daoPart ?? throw new ArgumentNullException(nameof(daoPart));
        _adminWorkflow = adminWorkflow ?? throw new ArgumentNullException(nameof(adminWorkflow));
        _windowService = windowService ?? throw new ArgumentNullException(nameof(windowService));

        _inventoriedParts = new ObservableCollection&lt;Model_InventoriedDunnage&gt;();
    }

    /// &lt;summary&gt;
    /// Initialize the view model - loads inventoried parts
    /// &lt;/summary&gt;
    public async Task InitializeAsync()
    {
        await LoadInventoriedPartsAsync();
    }

    /// &lt;summary&gt;
    /// Load all parts from the inventoried list
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task LoadInventoriedPartsAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading inventoried parts...&quot;;

            var result = await _daoInventory.GetAllAsync();

            if (result.IsSuccess &amp;&amp; result.Data != null)
            {
                InventoriedParts.Clear();
                foreach (var part in result.Data)
                {
                    InventoriedParts.Add(part);
                }
                StatusMessage = $&quot;Loaded {InventoriedParts.Count} inventoried parts&quot;;
            }
            else
            {
                await _errorHandler.ShowUserErrorAsync(
                    result.ErrorMessage ?? &quot;Failed to load inventoried parts&quot;,
                    &quot;Load Error&quot;,
                    nameof(LoadInventoriedPartsAsync));
                StatusMessage = &quot;Failed to load inventoried parts&quot;;
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Medium,
                nameof(LoadInventoriedPartsAsync),
                nameof(ViewModel_Dunnage_AdminInventory));
            StatusMessage = &quot;Error loading inventoried parts&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Show dialog to add a new part to the inventoried list
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task ShowAddToListAsync()
    {
        try
        {
            var dialog = App.GetService&lt;Module_Dunnage.Views.View_Dunnage_Dialog_AddToInventoriedListDialog&gt;();

            var result = await dialog.ShowAsync();

            if (result == ContentDialogResult.Primary)
            {
                // Dialog handles the insert, just reload the list
                await LoadInventoriedPartsAsync();
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Medium,
                nameof(ShowAddToListAsync),
                nameof(ViewModel_Dunnage_AdminInventory));
        }
    }

    /// &lt;summary&gt;
    /// Show dialog to edit an existing inventoried entry
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task ShowEditEntryAsync()
    {
        if (SelectedInventoriedPart == null)
        {
            await _errorHandler.ShowUserErrorAsync(
                &quot;Please select a part to edit&quot;,
                &quot;No Selection&quot;,
                nameof(ShowEditEntryAsync));
            return;
        }

        try
        {
            var dialog = new ContentDialog
            {
                Title = $&quot;Edit Inventoried Part: {SelectedInventoriedPart.PartId}&quot;,
                PrimaryButtonText = &quot;Save Changes&quot;,
                CloseButtonText = &quot;Cancel&quot;,
                XamlRoot = _windowService.GetXamlRoot()
            };

            // Create the edit form
            var stackPanel = new StackPanel { Spacing = 12 };

            // Part ID (readonly)
            stackPanel.Children.Add(new TextBlock { Text = &quot;Part ID (read-only)&quot;, FontWeight = Microsoft.UI.Text.FontWeights.SemiBold });
            var partIdBox = new TextBox
            {
                Text = SelectedInventoriedPart.PartId,
                IsReadOnly = true,
                Margin = new Microsoft.UI.Xaml.Thickness(0, 0, 0, 12)
            };
            stackPanel.Children.Add(partIdBox);

            // Inventory Method
            stackPanel.Children.Add(new TextBlock { Text = &quot;Inventory Method&quot;, FontWeight = Microsoft.UI.Text.FontWeights.SemiBold });
            var methodCombo = new ComboBox
            {
                ItemsSource = new[] { &quot;Adjust In&quot;, &quot;Receive In&quot;, &quot;Both&quot; },
                SelectedItem = SelectedInventoriedPart.InventoryMethod ?? &quot;Both&quot;,
                HorizontalAlignment = Microsoft.UI.Xaml.HorizontalAlignment.Stretch,
                Margin = new Microsoft.UI.Xaml.Thickness(0, 0, 0, 12)
            };
            stackPanel.Children.Add(methodCombo);

            // Notes
            stackPanel.Children.Add(new TextBlock { Text = &quot;Notes (optional)&quot;, FontWeight = Microsoft.UI.Text.FontWeights.SemiBold });
            var notesBox = new TextBox
            {
                Text = SelectedInventoriedPart.Notes ?? string.Empty,
                AcceptsReturn = true,
                TextWrapping = Microsoft.UI.Xaml.TextWrapping.Wrap,
                Height = 80,
                Margin = new Microsoft.UI.Xaml.Thickness(0, 0, 0, 12)
            };
            stackPanel.Children.Add(notesBox);

            dialog.Content = stackPanel;

            var dialogResult = await dialog.ShowAsync();

            if (dialogResult == ContentDialogResult.Primary)
            {
                // Save changes
                var updateResult = await _daoInventory.UpdateAsync(
                    SelectedInventoriedPart.Id,
                    methodCombo.SelectedItem?.ToString() ?? &quot;Both&quot;,
                    notesBox.Text,
                    Environment.UserName);

                if (updateResult.IsSuccess)
                {
                    await LoadInventoriedPartsAsync();
                    StatusMessage = &quot;Part updated successfully&quot;;
                }
                else
                {
                    await _errorHandler.ShowUserErrorAsync(
                        updateResult.ErrorMessage ?? &quot;Failed to update part&quot;,
                        &quot;Update Error&quot;,
                        nameof(ShowEditEntryAsync));
                }
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Medium,
                nameof(ShowEditEntryAsync),
                nameof(ViewModel_Dunnage_AdminInventory));
        }
    }

    /// &lt;summary&gt;
    /// Show confirmation dialog before removing a part from the inventoried list
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task ShowRemoveConfirmationAsync()
    {
        if (SelectedInventoriedPart == null)
        {
            await _errorHandler.ShowUserErrorAsync(
                &quot;Please select a part to remove&quot;,
                &quot;No Selection&quot;,
                nameof(ShowRemoveConfirmationAsync));
            return;
        }

        try
        {
            var dialog = new ContentDialog
            {
                Title = &quot;Remove from Inventoried List&quot;,
                Content = $&quot;Are you sure you want to remove &apos;{SelectedInventoriedPart.PartId}&apos; from the inventoried list?\n\n&quot; +
                         &quot;This will not delete the part from the system, but it will no longer trigger inventory tracking notifications during data entry.&quot;,
                PrimaryButtonText = &quot;Remove&quot;,
                CloseButtonText = &quot;Cancel&quot;,
                DefaultButton = ContentDialogButton.Close,
                XamlRoot = _windowService.GetXamlRoot()
            };

            var result = await dialog.ShowAsync();

            if (result == ContentDialogResult.Primary)
            {
                await RemoveFromListAsync();
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Medium,
                nameof(ShowRemoveConfirmationAsync),
                nameof(ViewModel_Dunnage_AdminInventory));
        }
    }

    /// &lt;summary&gt;
    /// Remove the selected part from the inventoried list
    /// &lt;/summary&gt;
    private async Task RemoveFromListAsync()
    {
        if (SelectedInventoriedPart == null)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Removing part from inventoried list...&quot;;

            var result = await _daoInventory.DeleteAsync(SelectedInventoriedPart.Id);

            if (result.IsSuccess)
            {
                await LoadInventoriedPartsAsync();
                StatusMessage = &quot;Part removed from inventoried list&quot;;
                SelectedInventoriedPart = null;
            }
            else
            {
                await _errorHandler.ShowUserErrorAsync(
                    result.ErrorMessage ?? &quot;Failed to remove part from list&quot;,
                    &quot;Remove Error&quot;,
                    nameof(RemoveFromListAsync));
                StatusMessage = &quot;Failed to remove part&quot;;
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Medium,
                nameof(RemoveFromListAsync),
                nameof(ViewModel_Dunnage_AdminInventory));
            StatusMessage = &quot;Error removing part&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Return to main admin navigation hub
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task BackToHubAsync()
    {
        _logger.LogInfo(&quot;Returning to Settings Mode Selection from Admin Inventory&quot;);
        var settingsWorkflow = App.GetService&lt;IService_SettingsWorkflow&gt;();
        settingsWorkflow.GoBack();
    }

    /// &lt;summary&gt;
    /// Notifies dependent properties when selection changes
    /// &lt;/summary&gt;
    partial void OnSelectedInventoriedPartChanged(Model_InventoriedDunnage? value)
    {
        OnPropertyChanged(nameof(HasSelection));
    }
}</file><file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_ModeSelectionViewModel.cs">using System;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Settings.Interfaces;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Dunnage Mode Selection - allows user to choose between Guided Wizard, Manual Entry, or Edit Mode
/// &lt;/summary&gt;
public partial class ViewModel_Dunnage_ModeSelection : ViewModel_Shared_Base
{
    private readonly IService_DunnageWorkflow _workflowService;
    private readonly IService_Help _helpService;
    private readonly IService_UserSessionManager _sessionManager;
    private readonly IService_UserPreferences _userPreferencesService;
    private readonly IService_Window _windowService;

    public ViewModel_Dunnage_ModeSelection(
        IService_DunnageWorkflow workflowService,
        IService_Help helpService,
        IService_UserSessionManager sessionManager,
        IService_UserPreferences userPreferencesService,
        IService_Window windowService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger) : base(errorHandler, logger)
    {
        _workflowService = workflowService;
        _helpService = helpService;
        _sessionManager = sessionManager;
        _userPreferencesService = userPreferencesService;
        _windowService = windowService;

        // Load current default mode
        LoadDefaultMode();
    }

    #region Observable Properties

    [ObservableProperty]
    private bool _isGuidedModeDefault;

    [ObservableProperty]
    private bool _isManualModeDefault;

    [ObservableProperty]
    private bool _isEditModeDefault;

    #endregion

    #region Initialization

    /// &lt;summary&gt;
    /// Load the user&apos;s default dunnage mode preference
    /// &lt;/summary&gt;
    private void LoadDefaultMode()
    {
        var currentUser = _sessionManager.CurrentSession?.User;
        if (currentUser != null)
        {
            IsGuidedModeDefault = currentUser.DefaultDunnageMode == &quot;guided&quot;;
            IsManualModeDefault = currentUser.DefaultDunnageMode == &quot;manual&quot;;
            IsEditModeDefault = currentUser.DefaultDunnageMode == &quot;edit&quot;;
        }
    }

    #endregion

    #region Mode Selection Commands

    [RelayCommand]
    private async Task SelectGuidedModeAsync()
    {
        _logger.LogInfo(&quot;User selected Guided Wizard mode&quot;);

        if (await ConfirmModeChangeAsync())
        {
            ClearWorkflowData();
            _workflowService.GoToStep(Enum_DunnageWorkflowStep.TypeSelection);
        }
    }

    [RelayCommand]
    private async Task SelectManualModeAsync()
    {
        _logger.LogInfo(&quot;User selected Manual Entry mode&quot;);

        if (await ConfirmModeChangeAsync())
        {
            ClearWorkflowData();
            _workflowService.GoToStep(Enum_DunnageWorkflowStep.ManualEntry);
        }
    }

    [RelayCommand]
    private async Task SelectEditModeAsync()
    {
        _logger.LogInfo(&quot;User selected Edit Mode&quot;);

        if (await ConfirmModeChangeAsync())
        {
            ClearWorkflowData();
            _workflowService.GoToStep(Enum_DunnageWorkflowStep.EditMode);
        }
    }

    /// &lt;summary&gt;
    /// Shows confirmation dialog before mode change
    /// &lt;/summary&gt;
    /// &lt;returns&gt;True if user confirmed, false if cancelled&lt;/returns&gt;
    /// &lt;summary&gt;
    /// Checks if there is any unsaved data in the current workflow
    /// &lt;/summary&gt;
    private bool HasUnsavedData()
    {
        if (_workflowService.CurrentSession == null)
        {
            return false;
        }

        // Check if there are any loads in the session
        if (_workflowService.CurrentSession.Loads?.Count &gt; 0)
        {
            return true;
        }

        // Check if there&apos;s any type/part selection
        if (_workflowService.CurrentSession.SelectedTypeId &gt; 0 ||
            _workflowService.CurrentSession.SelectedPart != null ||
            !string.IsNullOrEmpty(_workflowService.CurrentSession.PONumber) ||
            !string.IsNullOrEmpty(_workflowService.CurrentSession.Location))
        {
            return true;
        }

        return false;
    }

    private async Task&lt;bool&gt; ConfirmModeChangeAsync()
    {
        // Skip confirmation if there&apos;s no unsaved data
        if (!HasUnsavedData())
        {
            _logger.LogInfo(&quot;No unsaved data detected, skipping confirmation dialog&quot;);
            return true;
        }

        try
        {
            var xamlRoot = _windowService.GetXamlRoot();
            if (xamlRoot == null)
            {
                _logger.LogWarning(&quot;XamlRoot is null, proceeding without confirmation&quot;);
                return true;
            }

            var dialog = new ContentDialog
            {
                Title = &quot;Confirm Mode Selection&quot;,
                Content = &quot;Selecting a new mode will reset all unsaved data in the current workflow. Do you want to continue?&quot;,
                PrimaryButtonText = &quot;Continue&quot;,
                CloseButtonText = &quot;Cancel&quot;,
                DefaultButton = ContentDialogButton.Close,
                XamlRoot = xamlRoot
            };

            var result = await dialog.ShowAsync();
            return result == ContentDialogResult.Primary;
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error showing confirmation dialog: {ex.Message}&quot;, ex);
            return true; // Proceed if dialog fails
        }
    }

    /// &lt;summary&gt;
    /// Clears all transient workflow data without affecting persisted data
    /// &lt;/summary&gt;
    private void ClearWorkflowData()
    {
        try
        {
            // Clear current session data (in-memory only, not database or CSV)
            if (_workflowService.CurrentSession != null)
            {
                _workflowService.CurrentSession.Loads?.Clear();
            }

            // Clear UI inputs in all connected ViewModels
            ClearAllUIInputs();

            _logger.LogInfo(&quot;Dunnage workflow data and UI inputs cleared for mode change&quot;);
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error clearing dunnage workflow data: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Clears UI input properties across all Dunnage workflow ViewModels
    /// &lt;/summary&gt;
    private void ClearAllUIInputs()
    {
        try
        {
            // Clear TypeSelection ViewModel
            var typeSelectionVM = App.GetService&lt;ViewModel_dunnage_typeselection&gt;();
            if (typeSelectionVM != null)
            {
                typeSelectionVM.SelectedType = null;
            }

            // Clear PartSelection ViewModel
            var partSelectionVM = App.GetService&lt;ViewModel_Dunnage_PartSelection&gt;();
            if (partSelectionVM != null)
            {
                partSelectionVM.SelectedPart = null;
            }

            // Clear DetailsEntry ViewModel
            var detailsEntryVM = App.GetService&lt;ViewModel_Dunnage_DetailsEntry&gt;();
            if (detailsEntryVM != null)
            {
                detailsEntryVM.PoNumber = string.Empty;
                detailsEntryVM.Location = string.Empty;
                detailsEntryVM.SpecInputs?.Clear();
            }

            // Clear QuantityEntry ViewModel
            var quantityEntryVM = App.GetService&lt;ViewModel_Dunnage_QuantityEntry&gt;();
            if (quantityEntryVM != null)
            {
                quantityEntryVM.Quantity = 1;
            }

            _logger.LogInfo(&quot;UI inputs cleared across all Dunnage ViewModels&quot;);
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error clearing UI inputs: {ex.Message}&quot;, ex);
        }
    }

    #endregion

    #region Set Default Mode Commands

    [RelayCommand]
    private async Task SetGuidedAsDefaultAsync(bool isChecked)
    {
        try
        {
            var currentUser = _sessionManager.CurrentSession?.User;
            if (currentUser == null)
            {
                return;
            }

            string? newMode = isChecked ? &quot;guided&quot; : null;

            var result = await _userPreferencesService.UpdateDefaultDunnageModeAsync(currentUser.WindowsUsername, newMode ?? &quot;&quot;);

            if (result.IsSuccess)
            {
                // Update in-memory user object
                currentUser.DefaultDunnageMode = newMode;

                // Update UI state
                IsGuidedModeDefault = isChecked;
                if (isChecked)
                {
                    IsManualModeDefault = false;
                    IsEditModeDefault = false;
                }

                _logger.LogInfo($&quot;Dunnage default mode set to: {newMode ?? &quot;none&quot;}&quot;);
                StatusMessage = isChecked ? &quot;Guided mode set as default&quot; : &quot;Default mode cleared&quot;;
            }
            else
            {
                await _errorHandler.ShowErrorDialogAsync(&quot;Save Error&quot;, result.ErrorMessage, Enum_ErrorSeverity.Error);
                // Revert checkbox
                IsGuidedModeDefault = !isChecked;
            }
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync($&quot;Failed to set default dunnage mode: {ex.Message}&quot;,
                Enum_ErrorSeverity.Error, ex, true);
            // Revert checkbox
            IsGuidedModeDefault = !isChecked;
        }
    }

    [RelayCommand]
    private async Task SetManualAsDefaultAsync(bool isChecked)
    {
        try
        {
            var currentUser = _sessionManager.CurrentSession?.User;
            if (currentUser == null)
            {
                return;
            }

            string? newMode = isChecked ? &quot;manual&quot; : null;

            var result = await _userPreferencesService.UpdateDefaultDunnageModeAsync(currentUser.WindowsUsername, newMode ?? &quot;&quot;);

            if (result.IsSuccess)
            {
                // Update in-memory user object
                currentUser.DefaultDunnageMode = newMode;

                // Update UI state
                IsManualModeDefault = isChecked;
                if (isChecked)
                {
                    IsGuidedModeDefault = false;
                    IsEditModeDefault = false;
                }

                _logger.LogInfo($&quot;Dunnage default mode set to: {newMode ?? &quot;none&quot;}&quot;);
                StatusMessage = isChecked ? &quot;Manual mode set as default&quot; : &quot;Default mode cleared&quot;;
            }
            else
            {
                await _errorHandler.ShowErrorDialogAsync(&quot;Save Error&quot;, result.ErrorMessage, Enum_ErrorSeverity.Error);
                // Revert checkbox
                IsManualModeDefault = !isChecked;
            }
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync($&quot;Failed to set default dunnage mode: {ex.Message}&quot;,
                Enum_ErrorSeverity.Error, ex, true);
            // Revert checkbox
            IsManualModeDefault = !isChecked;
        }
    }

    /// &lt;summary&gt;
    /// Shows contextual help for mode selection
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task ShowHelpAsync()
    {
        await _helpService.ShowHelpAsync(&quot;Dunnage.ModeSelection&quot;);
    }

    [RelayCommand]
    private async Task SetEditAsDefaultAsync(bool isChecked)
    {
        try
        {
            var currentUser = _sessionManager.CurrentSession?.User;
            if (currentUser == null)
            {
                return;
            }

            string? newMode = isChecked ? &quot;edit&quot; : null;

            var result = await _userPreferencesService.UpdateDefaultDunnageModeAsync(currentUser.WindowsUsername, newMode ?? &quot;&quot;);

            if (result.IsSuccess)
            {
                // Update in-memory user object
                currentUser.DefaultDunnageMode = newMode;

                // Update UI state
                IsEditModeDefault = isChecked;
                if (isChecked)
                {
                    IsGuidedModeDefault = false;
                    IsManualModeDefault = false;
                }

                _logger.LogInfo($&quot;Dunnage default mode set to: {newMode ?? &quot;none&quot;}&quot;);
                StatusMessage = isChecked ? &quot;Edit mode set as default&quot; : &quot;Default mode cleared&quot;;
            }
            else
            {
                await _errorHandler.ShowErrorDialogAsync(&quot;Save Error&quot;, result.ErrorMessage, Enum_ErrorSeverity.Error);
                // Revert checkbox
                IsEditModeDefault = !isChecked;
            }
        }
        catch (Exception ex)
        {
            await _errorHandler.HandleErrorAsync($&quot;Failed to set default dunnage mode: {ex.Message}&quot;,
                Enum_ErrorSeverity.Error, ex, true);
            // Revert checkbox
            IsEditModeDefault = !isChecked;
        }
    }

    #endregion

    #region Help Content Helpers

    /// &lt;summary&gt;
    /// Gets a tooltip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);

    /// &lt;summary&gt;
    /// Gets a placeholder by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);

    /// &lt;summary&gt;
    /// Gets a tip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTip(string key) =&gt; _helpService.GetTip(key);

    #endregion
}</file><file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_ReviewViewModel.cs">using System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Shared.ViewModels;

namespace MTM_Receiving_Application.Module_Dunnage.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Dunnage Review &amp; Save
/// &lt;/summary&gt;
public partial class ViewModel_Dunnage_Review : ViewModel_Shared_Base
{
    private readonly IService_DunnageWorkflow _workflowService;
    private readonly IService_MySQL_Dunnage _dunnageService; private readonly IService_Help _helpService; private readonly IService_DunnageCSVWriter _csvWriter;
    private readonly IService_Window _windowService;

    public ViewModel_Dunnage_Review(
        IService_DunnageWorkflow workflowService,
        IService_MySQL_Dunnage dunnageService,
        IService_DunnageCSVWriter csvWriter,
        IService_Help helpService,
        IService_Window windowService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger) : base(errorHandler, logger)
    {
        _workflowService = workflowService;
        _dunnageService = dunnageService;
        _csvWriter = csvWriter;
        _helpService = helpService;
        _windowService = windowService;

        // Subscribe to workflow step changes to re-initialize when this step is reached
        _workflowService.StepChanged += OnWorkflowStepChanged;
    }

    private void OnWorkflowStepChanged(object? sender, EventArgs e)
    {
        if (_workflowService.CurrentStep == Enum_DunnageWorkflowStep.Review)
        {
            LoadSessionLoads();
        }
    }

    #region Observable Properties

    [ObservableProperty]
    private ObservableCollection&lt;Model_DunnageLoad&gt; _sessionLoads = new();

    [ObservableProperty]
    private Model_DunnageLoad? _currentLoad;

    [ObservableProperty]
    private int _currentEntryIndex = 1;

    [ObservableProperty]
    private int _loadCount;

    [ObservableProperty]
    private bool _canSave = true;

    [ObservableProperty]
    private bool _isSuccessMessageVisible = false;

    [ObservableProperty]
    private string _successMessage = string.Empty;

    [ObservableProperty]
    private bool _isSingleView = true;

    [ObservableProperty]
    private bool _isTableView = false;

    [ObservableProperty]
    private bool _canGoBack = false;

    [ObservableProperty]
    private bool _canGoNext = false;

    #endregion

    #region Initialization

    /// &lt;summary&gt;
    /// Load session loads for review
    /// &lt;/summary&gt;
    public void LoadSessionLoads()
    {
        try
        {
            SessionLoads.Clear();

            var loads = _workflowService.CurrentSession.Loads;
            foreach (var load in loads)
            {
                SessionLoads.Add(load);
            }

            LoadCount = SessionLoads.Count;
            CanSave = LoadCount &gt; 0;

            // Set up first entry for single view
            if (LoadCount &gt; 0)
            {
                CurrentEntryIndex = 1;
                CurrentLoad = SessionLoads[0];
                UpdateNavigationButtons();
            }

            _logger.LogInfo($&quot;Loaded {LoadCount} loads for review&quot;, &quot;Review&quot;);
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error loading session loads: {ex.Message}&quot;, ex, &quot;Review&quot;);
        }
    }

    private void UpdateNavigationButtons()
    {
        CanGoBack = CurrentEntryIndex &gt; 1;
        CanGoNext = CurrentEntryIndex &lt; LoadCount;
    }

    #endregion

    #region View Navigation Commands

    [RelayCommand]
    private void SwitchToSingleView()
    {
        IsSingleView = true;
        IsTableView = false;
        _logger.LogInfo(&quot;Switched to Single View&quot;, &quot;Review&quot;);
    }

    [RelayCommand]
    private void SwitchToTableView()
    {
        IsSingleView = false;
        IsTableView = true;
        _logger.LogInfo(&quot;Switched to Table View&quot;, &quot;Review&quot;);
    }

    [RelayCommand]
    private void PreviousEntry()
    {
        if (CurrentEntryIndex &gt; 1)
        {
            CurrentEntryIndex--;
            CurrentLoad = SessionLoads[CurrentEntryIndex - 1];
            UpdateNavigationButtons();
        }
    }

    [RelayCommand]
    private void NextEntry()
    {
        if (CurrentEntryIndex &lt; LoadCount)
        {
            CurrentEntryIndex++;
            CurrentLoad = SessionLoads[CurrentEntryIndex - 1];
            UpdateNavigationButtons();
        }
    }

    #endregion

    #region Commands

    [RelayCommand]
    private async Task AddAnotherAsync()
    {
        _logger.LogInfo(&quot;User requested to add another load&quot;, &quot;Review&quot;);

        try
        {
            // Show confirmation dialog to prevent accidental data loss
            if (!await ConfirmAddAnotherAsync())
            {
                _logger.LogInfo(&quot;User cancelled add another load&quot;, &quot;Review&quot;);
                return;
            }

            // Save current session to CSV before clearing
            IsBusy = true;
            StatusMessage = &quot;Saving to CSV...&quot;;
            var saveResult = await _workflowService.SaveToCSVOnlyAsync();

            if (!saveResult.IsSuccess)
            {
                await _errorHandler.HandleErrorAsync(
                    $&quot;Failed to save CSV backup: {saveResult.ErrorMessage}&quot;,
                    Enum_ErrorSeverity.Warning,
                    null,
                    true);
                IsBusy = false;
                return;
            }
            IsBusy = false;

            // Clear transient workflow data to prepare for new entry
            ClearTransientWorkflowData();

            // Navigate back to Type Selection without clearing session loads
            _workflowService.GoToStep(Enum_DunnageWorkflowStep.TypeSelection);

            _logger.LogInfo(&quot;Navigated to Type Selection for new load, workflow data cleared&quot;, &quot;Review&quot;);
        }
        catch (Exception ex)
        {
            IsBusy = false;
            _logger.LogError($&quot;Error in AddAnotherAsync: {ex.Message}&quot;, ex);
            await _errorHandler.HandleErrorAsync(
                &quot;Failed to prepare for new load entry&quot;,
                Enum_ErrorSeverity.Medium,
                ex,
                true);
        }
    }

    /// &lt;summary&gt;
    /// Shows confirmation dialog before clearing data for new entry
    /// &lt;/summary&gt;
    private async Task&lt;bool&gt; ConfirmAddAnotherAsync()
    {
        try
        {
            var xamlRoot = _windowService.GetXamlRoot();
            if (xamlRoot == null)
            {
                _logger.LogWarning(&quot;XamlRoot is null, proceeding without confirmation&quot;, &quot;Review&quot;);
                return true;
            }

            var dialog = new ContentDialog
            {
                Title = &quot;Add Another Load&quot;,
                Content = &quot;Current form data will be cleared to start a new entry. Your reviewed loads are preserved. Continue?&quot;,
                PrimaryButtonText = &quot;Continue&quot;,
                CloseButtonText = &quot;Cancel&quot;,
                DefaultButton = ContentDialogButton.Primary,
                XamlRoot = xamlRoot
            };

            var result = await dialog.ShowAsync();
            return result == ContentDialogResult.Primary;
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error showing confirmation dialog: {ex.Message}&quot;, ex, &quot;Review&quot;);
            return true; // Proceed if dialog fails
        }
    }

    /// &lt;summary&gt;
    /// Clears transient workflow data from intermediate steps (not the session loads)
    /// This prevents data duplication when adding another load
    /// &lt;/summary&gt;
    private void ClearTransientWorkflowData()
    {
        try
        {
            // Clear the current session properties that hold form data
            // but preserve the Loads collection (already reviewed loads)
            var session = _workflowService.CurrentSession;
            if (session != null)
            {
                // Clear selection properties to start fresh
                session.SelectedTypeId = 0;
                session.SelectedTypeName = string.Empty;
                session.SelectedPart = null;
                session.Quantity = 0;
                session.PONumber = string.Empty;
                session.Location = string.Empty;
                // Preserve Loads collection - these are already reviewed
            }

            // Clear UI inputs in connected ViewModels
            ClearUIInputsForNewEntry();

            _logger.LogInfo(&quot;Transient workflow data and UI inputs cleared for new entry&quot;, &quot;Review&quot;);
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error clearing transient workflow data: {ex.Message}&quot;, ex, &quot;Review&quot;);
        }
    }

    /// &lt;summary&gt;
    /// Clears UI input properties in ViewModels to prepare for new entry
    /// while preserving reviewed loads
    /// &lt;/summary&gt;
    private void ClearUIInputsForNewEntry()
    {
        try
        {
            // Clear TypeSelection ViewModel
            var typeSelectionVM = App.GetService&lt;ViewModel_dunnage_typeselection&gt;();
            if (typeSelectionVM != null)
            {
                typeSelectionVM.SelectedType = null;
            }

            // Clear PartSelection ViewModel
            var partSelectionVM = App.GetService&lt;ViewModel_Dunnage_PartSelection&gt;();
            if (partSelectionVM != null)
            {
                partSelectionVM.SelectedPart = null;
            }

            // Clear DetailsEntry ViewModel
            var detailsEntryVM = App.GetService&lt;ViewModel_Dunnage_DetailsEntry&gt;();
            if (detailsEntryVM != null)
            {
                detailsEntryVM.PoNumber = string.Empty;
                detailsEntryVM.Location = string.Empty;
                detailsEntryVM.SpecInputs?.Clear();
            }

            // Clear QuantityEntry ViewModel
            var quantityEntryVM = App.GetService&lt;ViewModel_Dunnage_QuantityEntry&gt;();
            if (quantityEntryVM != null)
            {
                quantityEntryVM.Quantity = 1;
            }

            _logger.LogInfo(&quot;UI inputs cleared for new entry (loads preserved)&quot;, &quot;Review&quot;);
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error clearing UI inputs: {ex.Message}&quot;, ex, &quot;Review&quot;);
        }
    }

    [RelayCommand]
    private async Task SaveAllAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            CanSave = false;
            StatusMessage = &quot;Saving loads...&quot;;

            await _logger.LogInfoAsync($&quot;Starting SaveAllAsync: {LoadCount} loads to save&quot;);

            // Save loads to database
            var saveResult = await _dunnageService.SaveLoadsAsync(SessionLoads.ToList());

            if (!saveResult.Success)
            {
                await _logger.LogErrorAsync($&quot;Failed to save {LoadCount} loads: {saveResult.ErrorMessage}&quot;);
                await _errorHandler.HandleDaoErrorAsync(saveResult, &quot;SaveAllAsync&quot;, true);
                return;
            }

            await _logger.LogInfoAsync($&quot;Successfully saved {LoadCount} loads to database&quot;);
            StatusMessage = &quot;Exporting to CSV...&quot;;

            // Export to CSV
            var csvResult = await _csvWriter.WriteToCSVAsync(SessionLoads.ToList());

            if (!csvResult.LocalSuccess)
            {
                await _logger.LogWarningAsync($&quot;CSV export failed for {LoadCount} loads: {csvResult.ErrorMessage}&quot;);
                await _errorHandler.HandleErrorAsync(
                    csvResult.ErrorMessage ?? &quot;CSV export failed&quot;,
                    Enum_ErrorSeverity.Warning,
                    null,
                    true);
                // Continue anyway - database save was successful
            }
            else
            {
                await _logger.LogInfoAsync($&quot;Successfully exported {LoadCount} loads to CSV&quot;);
            }

            // Show success message
            SuccessMessage = $&quot;Successfully saved {LoadCount} load(s) to database and exported to CSV&quot;;
            IsSuccessMessageVisible = true;

            await _logger.LogInfoAsync($&quot;Completed SaveAllAsync: {LoadCount} loads processed successfully&quot;);

            // Auto-navigation removed to allow user to see success message and choose next action
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Exception in SaveAllAsync: {ex.Message}&quot;);
            await _errorHandler.HandleErrorAsync(
                &quot;Error saving loads&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                true
            );
        }
        finally
        {
            IsBusy = false;
            CanSave = true;
        }
    }

    [RelayCommand]
    private void StartNewEntry()
    {
        // Clear session and return to Mode Selection
        _workflowService.ClearSession();
        _workflowService.GoToStep(Enum_DunnageWorkflowStep.ModeSelection);
    }

    /// &lt;summary&gt;
    /// Shows contextual help for review
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task ShowHelpAsync()
    {
        await _helpService.ShowHelpAsync(&quot;Dunnage.Review&quot;);
    }

    [RelayCommand]
    private void Cancel()
    {
        _logger.LogInfo(&quot;Cancelling review, clearing session&quot;, &quot;Review&quot;);

        // Clear session and return to Mode Selection
        _workflowService.ClearSession();
        _workflowService.GoToStep(Enum_DunnageWorkflowStep.ModeSelection);
    }

    #endregion

    #region Help Content Helpers

    /// &lt;summary&gt;
    /// Gets a tooltip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);

    /// &lt;summary&gt;
    /// Gets a placeholder by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);

    /// &lt;summary&gt;
    /// Gets a tip by key from the help service
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
    public string GetTip(string key) =&gt; _helpService.GetTip(key);

    #endregion
}</file><file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_WorkFlowViewModel.cs">using System;
using System.Collections.ObjectModel;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Shared.ViewModels;
namespace MTM_Receiving_Application.Module_Dunnage.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Dunnage Label entry page - Orchestrates workflow step visibility
/// &lt;/summary&gt;
public partial class ViewModel_Dunnage_WorkFlowViewModel : ViewModel_Shared_Base
{
    private readonly IService_DunnageWorkflow _workflowService;
    private readonly IService_Window _windowService;

    public ViewModel_Dunnage_WorkFlowViewModel(
        IService_DunnageWorkflow workflowService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger,
        IService_Window windowService)
        : base(errorHandler, logger)
    {
        _workflowService = workflowService;
        _windowService = windowService;
        _workflowService.StepChanged += OnWorkflowStepChanged;

        DunnageLines = new ObservableCollection&lt;Model_DunnageLine&gt;();
        _currentLine = new Model_DunnageLine();

        // Start the workflow - it will check for default mode and navigate accordingly
        _ = InitializeWorkflowAsync();
    }

    /// &lt;summary&gt;
    /// Initialize the workflow - checks for default mode and navigates to appropriate step
    /// &lt;/summary&gt;
    private async Task InitializeWorkflowAsync()
    {
        try
        {
            await _workflowService.StartWorkflowAsync();
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Medium,
                nameof(InitializeWorkflowAsync),
                nameof(ViewModel_Dunnage_WorkFlowViewModel));
        }
    }

    public ObservableCollection&lt;Model_DunnageLine&gt; DunnageLines { get; }

    [ObservableProperty]
    private Model_DunnageLine _currentLine;

    #region Step Visibility Properties

    [ObservableProperty]
    private bool _isModeSelectionVisible;

    [ObservableProperty]
    private bool _isTypeSelectionVisible;

    [ObservableProperty]
    private bool _isPartSelectionVisible;

    [ObservableProperty]
    private bool _isQuantityEntryVisible;

    [ObservableProperty]
    private bool _isDetailsEntryVisible;

    [ObservableProperty]
    private bool _isReviewVisible;

    [ObservableProperty]
    private bool _isManualEntryVisible;

    [ObservableProperty]
    private bool _isEditModeVisible;

    [ObservableProperty]
    private string _currentStepTitle = &quot;Dunnage - Mode Selection&quot;;

    #endregion

    #region Event Handlers

    private void OnWorkflowStepChanged(object? sender, EventArgs e)
    {
        // Hide all steps
        IsModeSelectionVisible = false;
        IsTypeSelectionVisible = false;
        IsPartSelectionVisible = false;
        IsQuantityEntryVisible = false;
        IsDetailsEntryVisible = false;
        IsReviewVisible = false;
        IsManualEntryVisible = false;
        IsEditModeVisible = false;

        // Show current step
        switch (_workflowService.CurrentStep)
        {
            case Enum_DunnageWorkflowStep.ModeSelection:
                IsModeSelectionVisible = true;
                CurrentStepTitle = &quot;Dunnage - Mode Selection&quot;;
                break;
            case Enum_DunnageWorkflowStep.TypeSelection:
                IsTypeSelectionVisible = true;
                CurrentStepTitle = &quot;Dunnage - Select Type&quot;;
                break;
            case Enum_DunnageWorkflowStep.PartSelection:
                IsPartSelectionVisible = true;
                CurrentStepTitle = &quot;Dunnage - Select Part&quot;;
                break;
            case Enum_DunnageWorkflowStep.QuantityEntry:
                IsQuantityEntryVisible = true;
                CurrentStepTitle = &quot;Dunnage - Enter Quantity&quot;;
                break;
            case Enum_DunnageWorkflowStep.DetailsEntry:
                IsDetailsEntryVisible = true;
                CurrentStepTitle = &quot;Dunnage - Enter Details&quot;;
                break;
            case Enum_DunnageWorkflowStep.Review:
                IsReviewVisible = true;
                CurrentStepTitle = &quot;Dunnage - Review &amp; Save&quot;;
                break;
            case Enum_DunnageWorkflowStep.ManualEntry:
                IsManualEntryVisible = true;
                CurrentStepTitle = &quot;Dunnage - Manual Entry&quot;;
                break;
            case Enum_DunnageWorkflowStep.EditMode:
                IsEditModeVisible = true;
                CurrentStepTitle = &quot;Dunnage - Edit Mode&quot;;
                break;
        }
    }

    [RelayCommand]
    private async Task ResetCSVAsync()
    {
        var xamlRoot = _windowService.GetXamlRoot();
        if (xamlRoot == null)
        {
            _logger.LogError(&quot;Cannot show dialog: XamlRoot is null&quot;);
            await _errorHandler.HandleErrorAsync(&quot;Unable to display dialog&quot;, Enum_ErrorSeverity.Error);
            return;
        }

        var dialog = new Microsoft.UI.Xaml.Controls.ContentDialog
        {
            Title = &quot;Reset CSV Files&quot;,
            Content = &quot;Are you sure you want to delete the local and network CSV files? This action cannot be undone.&quot;,
            PrimaryButtonText = &quot;Delete&quot;,
            CloseButtonText = &quot;Cancel&quot;,
            DefaultButton = Microsoft.UI.Xaml.Controls.ContentDialogButton.Close,
            XamlRoot = xamlRoot
        };

        var result = await dialog.ShowAsync();
        if (result == Microsoft.UI.Xaml.Controls.ContentDialogResult.Primary)
        {
            // Try to save to DB first
            var saveResult = await _workflowService.SaveToDatabaseOnlyAsync();
            if (!saveResult.IsSuccess)
            {
                var warnDialog = new Microsoft.UI.Xaml.Controls.ContentDialog
                {
                    Title = &quot;Database Save Failed&quot;,
                    Content = $&quot;Failed to save to database: {saveResult.ErrorMessage}\n\nDo you want to proceed with deleting CSV files anyway?&quot;,
                    PrimaryButtonText = &quot;Delete Anyway&quot;,
                    CloseButtonText = &quot;Cancel&quot;,
                    DefaultButton = Microsoft.UI.Xaml.Controls.ContentDialogButton.Close,
                    XamlRoot = xamlRoot
                };

                var warnResult = await warnDialog.ShowAsync();
                if (warnResult != Microsoft.UI.Xaml.Controls.ContentDialogResult.Primary)
                {
                    return;
                }
            }

            var deleteResult = await _workflowService.ResetCSVFilesAsync();
            if (deleteResult.LocalDeleted || deleteResult.NetworkDeleted)
            {
                StatusMessage = &quot;CSV files deleted successfully.&quot;;
            }
            else
            {
                StatusMessage = &quot;Failed to delete CSV files or files not found.&quot;;
            }
        }
    }

    #endregion

    #region Commands

    [RelayCommand]
    private void ReturnToModeSelection()
    {
        _workflowService.ClearSession();
        _workflowService.GoToStep(Enum_DunnageWorkflowStep.ModeSelection);
    }

    [RelayCommand]
    private async Task AddLineAsync()
    {
        // TODO: Implement when ready
        await Task.CompletedTask;
    }

    #endregion
}</file><file path="Module_Receiving/ViewModels/ViewModel_Receiving_POEntry.cs">using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using MTM_Receiving_Application.Module_Core.Contracts.ViewModels;
using System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.Extensions.Configuration;

namespace MTM_Receiving_Application.Module_Receiving.ViewModels
{
    public partial class ViewModel_Receiving_POEntry : ViewModel_Shared_Base, IResettableViewModel
    {
        private readonly IService_InforVisual _inforVisualService;
        private readonly IService_ReceivingWorkflow _workflowService;
        private readonly IService_Help _helpService;
        private readonly IService_ViewModelRegistry _viewModelRegistry;
        private readonly Microsoft.Extensions.Configuration.IConfiguration _configuration;

        [ObservableProperty]
        private string _poNumber = string.Empty;

        [ObservableProperty]
        private string _partID = string.Empty;

        [ObservableProperty]
        private bool _isLoading;

        [ObservableProperty]
        private bool _isNonPOItem;

        [ObservableProperty]
        private bool _isLoadPOEnabled = false;

        [ObservableProperty]
        private string _poValidationMessage = string.Empty;

        [ObservableProperty]
        private ObservableCollection&lt;Model_InforVisualPart&gt; _parts = new();

        [ObservableProperty]
        private Model_InforVisualPart? _selectedPart;

        [ObservableProperty]
        private string _packageType = &quot;Skids&quot;;  // Default package type

        [ObservableProperty]
        private string _poStatus = string.Empty;

        [ObservableProperty]
        private string _poStatusDescription = string.Empty;

        [ObservableProperty]
        private bool _isPOClosed = false;

        [ObservableProperty]
        private bool _isPartsListVisible;

        public ViewModel_Receiving_POEntry(
            IService_InforVisual inforVisualService,
            IService_ReceivingWorkflow workflowService,
            IService_ErrorHandler errorHandler,
            IService_LoggingUtility logger,
            IService_Help helpService,
            IService_ViewModelRegistry viewModelRegistry,
            Microsoft.Extensions.Configuration.IConfiguration configuration)
            : base(errorHandler, logger)
        {
            _inforVisualService = inforVisualService;
            _workflowService = workflowService;
            _helpService = helpService;
            _viewModelRegistry = viewModelRegistry;
            _configuration = configuration;

            _viewModelRegistry.Register(this);

            // Update visibility when parts collection changes
            Parts.CollectionChanged += (s, e) =&gt; IsPartsListVisible = Parts.Count &gt; 0;

            // Auto-fill PO number if using mock data
            InitializeAsync();
        }

        public void ResetToDefaults()
        {
            PoNumber = string.Empty;
            PartID = string.Empty;
            IsNonPOItem = false;
            IsLoadPOEnabled = false;
            PoValidationMessage = string.Empty;
            Parts.Clear();
            SelectedPart = null;
            PackageType = &quot;Skids&quot;;
            PoStatus = string.Empty;
        }

        [RelayCommand]
        private void PoTextBoxLostFocus()
        {
            // Auto-correction only on LostFocus (not TextChanged)
            if (string.IsNullOrWhiteSpace(PoNumber))
            {
                return;
            }

            // Trim and uppercase first
            string value = PoNumber.Trim().ToUpper();

            // Format the PO number
            if (value.StartsWith(&quot;PO-&quot;, StringComparison.OrdinalIgnoreCase))
            {
                // Extract number part and reformat
                string numberPart = value.Substring(3);
                if (numberPart.All(char.IsDigit) &amp;&amp; numberPart.Length &lt;= 6)
                {
                    PoNumber = $&quot;PO-{numberPart.PadLeft(6, &apos;0&apos;)}&quot;;
                }
            }
            else if (value.All(char.IsDigit) &amp;&amp; value.Length &lt;= 6)
            {
                // Just numbers - add PO- prefix and pad
                PoNumber = $&quot;PO-{value.PadLeft(6, &apos;0&apos;)}&quot;;
            }
            // If invalid format, leave as-is and let validation message show
        }

        [RelayCommand]
        private async Task LoadPOAsync()
        {
            if (string.IsNullOrWhiteSpace(PoNumber))
            {
                await _errorHandler.HandleErrorAsync(&quot;Please enter a PO number.&quot;, Enum_ErrorSeverity.Warning);
                return;
            }

            IsLoading = true;
            try
            {
                var result = await _inforVisualService.GetPOWithPartsAsync(PoNumber);
                if (result.IsSuccess &amp;&amp; result.Data != null)
                {
                    Parts.Clear();

                    // Set PO status
                    PoStatus = result.Data.Status;
                    PoStatusDescription = result.Data.StatusDescription;
                    IsPOClosed = result.Data.IsClosed;

                    // Load parts and populate remaining quantity for each
                    foreach (var part in result.Data.Parts)
                    {
                        // Get remaining quantity for this part
                        var remainingQtyResult = await _inforVisualService.GetRemainingQuantityAsync(PoNumber, part.PartID);
                        if (remainingQtyResult.IsSuccess)
                        {
                            part.RemainingQuantity = remainingQtyResult.Data;
                        }

                        Parts.Add(part);
                    }

                    _workflowService.RaiseStatusMessage($&quot;Purchase Order {PoNumber} loaded with {Parts.Count} parts.&quot;);
                }
                else
                {
                    var errorMessage = !string.IsNullOrWhiteSpace(result.ErrorMessage)
                        ? result.ErrorMessage
                        : &quot;PO not found or contains no parts.&quot;;
                    await _errorHandler.HandleErrorAsync(errorMessage, Enum_ErrorSeverity.Error);
                    Parts.Clear();
                }
            }
            finally
            {
                IsLoading = false;
            }
        }

        [RelayCommand]
        private void ToggleNonPO()
        {
            IsNonPOItem = !IsNonPOItem;
            Parts.Clear();
            SelectedPart = null;
            PoNumber = string.Empty;
            PartID = string.Empty;
            _workflowService.IsNonPOItem = IsNonPOItem;
        }

        [RelayCommand]
        private async Task LookupPartAsync()
        {
            if (string.IsNullOrWhiteSpace(PartID))
            {
                await _errorHandler.HandleErrorAsync(&quot;Please enter a Part ID.&quot;, Enum_ErrorSeverity.Warning);
                return;
            }

            IsLoading = true;
            try
            {
                var result = await _inforVisualService.GetPartByIDAsync(PartID);
                if (result.IsSuccess &amp;&amp; result.Data != null)
                {
                    SelectedPart = result.Data;
                    // For Non-PO items, we might want to show it in the list or just set SelectedPart directly.
                    // Setting SelectedPart directly is enough for the workflow, but the UI might want to show it.
                    Parts.Clear();
                    Parts.Add(result.Data);
                    _workflowService.RaiseStatusMessage($&quot;Part {PartID} found.&quot;);
                }
                else
                {
                    await _errorHandler.HandleErrorAsync(result.ErrorMessage ?? &quot;Part not found.&quot;, Enum_ErrorSeverity.Error);
                    SelectedPart = null;
                    Parts.Clear();
                }
            }
            finally
            {
                IsLoading = false;
            }
        }

        partial void OnPoNumberChanged(string value)
        {
            // Validate PO number format (validation only, no auto-correction)
            // Auto-correction happens only on LostFocus

            if (string.IsNullOrWhiteSpace(value))
            {
                _workflowService.CurrentPONumber = string.Empty;
                IsLoadPOEnabled = false;
                PoValidationMessage = string.Empty;
                return;
            }

            string validatedPO = value.Trim();
            bool isValid = false;

            // Check if value starts with &quot;po-&quot; or &quot;PO-&quot; (case insensitive)
            if (validatedPO.StartsWith(&quot;po-&quot;, StringComparison.OrdinalIgnoreCase))
            {
                // Extract the number part after &quot;PO-&quot;
                string numberPart = validatedPO.Substring(3);

                // Check if it&apos;s all digits and validate length
                if (numberPart.All(char.IsDigit))
                {
                    if (numberPart.Length &lt;= 6)
                    {
                        validatedPO = $&quot;PO-{numberPart.PadLeft(6, &apos;0&apos;)}&quot;;
                        isValid = true;
                    }
                    else
                    {
                        PoValidationMessage = &quot;PO number must be 6 digits or less&quot;;
                        IsLoadPOEnabled = false;
                        return;
                    }
                }
                else
                {
                    PoValidationMessage = &quot;Invalid PO format. Use: PO-NNNNNN (6 digits)&quot;;
                    IsLoadPOEnabled = false;
                    return;
                }
            }
            else if (validatedPO.All(char.IsDigit))
            {
                // Just numbers, no prefix
                if (validatedPO.Length &lt;= 6)
                {
                    validatedPO = $&quot;PO-{validatedPO.PadLeft(6, &apos;0&apos;)}&quot;;
                    isValid = true;
                }
                else
                {
                    PoValidationMessage = &quot;PO number must be 6 digits or less&quot;;
                    IsLoadPOEnabled = false;
                    return;
                }
            }
            else
            {
                PoValidationMessage = &quot;Invalid PO format. Enter: 66868 or PO-066868&quot;;
                IsLoadPOEnabled = false;
                return;
            }

            _workflowService.CurrentPONumber = validatedPO;
            IsLoadPOEnabled = isValid;
            PoValidationMessage = isValid ? string.Empty : &quot;Invalid PO number format&quot;;
        }

        partial void OnPartIDChanged(string value)
        {
            // Auto-detect package type based on Part ID prefix
            if (string.IsNullOrWhiteSpace(value))
            {
                PackageType = &quot;Skids&quot;; // Default
                return;
            }

            var upperPart = value.Trim().ToUpper();

            if (upperPart.StartsWith(&quot;MMC&quot;))
                PackageType = &quot;Coils&quot;;
            else if (upperPart.StartsWith(&quot;MMF&quot;))
                PackageType = &quot;Sheets&quot;;
            else
                PackageType = &quot;Skids&quot;;
        }

        partial void OnSelectedPartChanged(Model_InforVisualPart? value)
        {
            _workflowService.CurrentPart = value;

            // Auto-detect package type when a part is selected from PO
            if (value != null &amp;&amp; !string.IsNullOrWhiteSpace(value.PartID))
            {
                var upperPart = value.PartID.Trim().ToUpper();

                if (upperPart.StartsWith(&quot;MMC&quot;))
                    PackageType = &quot;Coils&quot;;
                else if (upperPart.StartsWith(&quot;MMF&quot;))
                    PackageType = &quot;Sheets&quot;;
                else
                    PackageType = &quot;Skids&quot;;
            }
        }

        /// &lt;summary&gt;
        /// Shows contextual help for PO entry
        /// &lt;/summary&gt;
        [RelayCommand]
        private async Task ShowHelpAsync()
        {
            await _helpService.ShowHelpAsync(&quot;Receiving.POEntry&quot;);
        }

        #region Help Content Helpers

        public string GetTooltip(string key) =&gt; _helpService.GetTooltip(key);
        public string GetPlaceholder(string key) =&gt; _helpService.GetPlaceholder(key);
        public string GetTip(string key) =&gt; _helpService.GetTip(key);

        #endregion

        /// &lt;summary&gt;
        /// Initialize component - autofill PO if mock data enabled
        /// &lt;/summary&gt;
        private async void InitializeAsync()
        {
            try
            {
                var useMockData = _configuration.GetValue&lt;bool&gt;(&quot;AppSettings:UseInforVisualMockData&quot;);

                if (useMockData)
                {
                    var defaultPO = _configuration.GetValue&lt;string&gt;(&quot;AppSettings:DefaultMockPONumber&quot;) ?? &quot;PO-066868&quot;;
                    await _logger.LogInfoAsync($&quot;[MOCK DATA MODE] Auto-filling PO number: {defaultPO}&quot;);

                    PoNumber = defaultPO;
                    _workflowService.RaiseStatusMessage($&quot;[MOCK DATA] Auto-filled PO: {defaultPO}&quot;);

                    // Auto-load mock data
                    await Task.Delay(500); // Small delay for UI update
                    await LoadPOAsync();
                }
            }
            catch (Exception ex)
            {
                await _logger.LogErrorAsync($&quot;Error during initialization: {ex.Message}&quot;, ex);
            }
        }
    }
}</file><file path="Module_Reporting/Data/Dao_Reporting.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.Reporting;

namespace MTM_Receiving_Application.Module_Reporting.Data;

/// &lt;summary&gt;
/// Data Access Object for Reporting module
/// Queries database views for end-of-day reporting
/// Uses raw SQL for read-only reporting queries from views
/// &lt;/summary&gt;
public class Dao_Reporting
{
    private readonly string _connectionString;

    public Dao_Reporting(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Retrieves receiving history from view_receiving_history view
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;startDate&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;endDate&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_ReportRow&gt;&gt;&gt; GetReceivingHistoryAsync(
        DateTime startDate,
        DateTime endDate)
    {
        try
        {
            var query = @&quot;
                SELECT
                    id,
                    po_number,
                    part_number,
                    part_description,
                    quantity,
                    weight_lbs,
                    heat_lot_number,
                    created_date,
                    employee_number,
                    source_module
                FROM view_receiving_history
                WHERE created_date BETWEEN @StartDate AND @EndDate
                ORDER BY created_date DESC, id DESC&quot;;

            await using var connection = new MySqlConnection(_connectionString);
            await connection.OpenAsync();

            await using var command = new MySqlCommand(query, connection);
            command.Parameters.AddWithValue(&quot;@StartDate&quot;, startDate.Date);
            command.Parameters.AddWithValue(&quot;@EndDate&quot;, endDate.Date);

            await using var reader = await command.ExecuteReaderAsync();
            var rows = new List&lt;Model_ReportRow&gt;();

            while (await reader.ReadAsync())
            {
                rows.Add(new Model_ReportRow
                {
                    Id = reader.GetGuid(&quot;id&quot;).ToString(),
                    PONumber = reader.IsDBNull(reader.GetOrdinal(&quot;po_number&quot;)) ? null : reader.GetString(&quot;po_number&quot;),
                    PartNumber = reader.IsDBNull(reader.GetOrdinal(&quot;part_number&quot;)) ? null : reader.GetString(&quot;part_number&quot;),
                    PartDescription = reader.IsDBNull(reader.GetOrdinal(&quot;part_description&quot;)) ? null : reader.GetString(&quot;part_description&quot;),
                    Quantity = reader.IsDBNull(reader.GetOrdinal(&quot;quantity&quot;)) ? null : reader.GetDecimal(&quot;quantity&quot;),
                    WeightLbs = reader.IsDBNull(reader.GetOrdinal(&quot;weight_lbs&quot;)) ? null : reader.GetDecimal(&quot;weight_lbs&quot;),
                    HeatLotNumber = reader.IsDBNull(reader.GetOrdinal(&quot;heat_lot_number&quot;)) ? null : reader.GetString(&quot;heat_lot_number&quot;),
                    CreatedDate = reader.GetDateTime(&quot;created_date&quot;),
                    EmployeeNumber = reader.IsDBNull(reader.GetOrdinal(&quot;employee_number&quot;)) ? null : reader.GetString(&quot;employee_number&quot;),
                    SourceModule = reader.GetString(&quot;source_module&quot;)
                });
            }

            return Model_Dao_Result_Factory.Success(rows);
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_ReportRow&gt;&gt;(
                $&quot;Error retrieving receiving history: {ex.Message}&quot;,
                ex);
        }
    }

    /// &lt;summary&gt;
    /// Retrieves dunnage history from view_dunnage_history view
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;startDate&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;endDate&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_ReportRow&gt;&gt;&gt; GetDunnageHistoryAsync(
        DateTime startDate,
        DateTime endDate)
    {
        try
        {
            var query = @&quot;
                SELECT
                    id,
                    dunnage_type,
                    part_number,
                    specs_combined,
                    quantity,
                    created_date,
                    employee_number,
                    source_module
                FROM view_dunnage_history
                WHERE created_date BETWEEN @StartDate AND @EndDate
                ORDER BY created_date DESC&quot;;

            await using var connection = new MySqlConnection(_connectionString);
            await connection.OpenAsync();

            await using var command = new MySqlCommand(query, connection);
            command.Parameters.AddWithValue(&quot;@StartDate&quot;, startDate.Date);
            command.Parameters.AddWithValue(&quot;@EndDate&quot;, endDate.Date);

            await using var reader = await command.ExecuteReaderAsync();
            var rows = new List&lt;Model_ReportRow&gt;();

            while (await reader.ReadAsync())
            {
                rows.Add(new Model_ReportRow
                {
                    Id = reader.GetGuid(&quot;id&quot;).ToString(),
                    DunnageType = reader.IsDBNull(reader.GetOrdinal(&quot;dunnage_type&quot;)) ? null : reader.GetString(&quot;dunnage_type&quot;),
                    PartNumber = reader.IsDBNull(reader.GetOrdinal(&quot;part_number&quot;)) ? null : reader.GetString(&quot;part_number&quot;),
                    SpecsCombined = reader.IsDBNull(reader.GetOrdinal(&quot;specs_combined&quot;)) ? null : reader.GetString(&quot;specs_combined&quot;),
                    Quantity = reader.IsDBNull(reader.GetOrdinal(&quot;quantity&quot;)) ? null : reader.GetDecimal(&quot;quantity&quot;),
                    CreatedDate = reader.GetDateTime(&quot;created_date&quot;),
                    EmployeeNumber = reader.IsDBNull(reader.GetOrdinal(&quot;employee_number&quot;)) ? null : reader.GetString(&quot;employee_number&quot;),
                    SourceModule = reader.GetString(&quot;source_module&quot;)
                });
            }

            return Model_Dao_Result_Factory.Success(rows);
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_ReportRow&gt;&gt;(
                $&quot;Error retrieving dunnage history: {ex.Message}&quot;,
                ex);
        }
    }

    /// &lt;summary&gt;
    /// Retrieves routing history from view_routing_history view
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;startDate&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;endDate&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_ReportRow&gt;&gt;&gt; GetRoutingHistoryAsync(
        DateTime startDate,
        DateTime endDate)
    {
        try
        {
            var query = @&quot;
                SELECT
                    id,
                    po_number,
                    line_number,
                    package_description,
                    deliver_to,
                    department,
                    location,
                    quantity,
                    employee_number,
                    created_date,
                    other_reason,
                    source_module
                FROM view_routing_history
                WHERE created_date BETWEEN @StartDate AND @EndDate
                ORDER BY created_date DESC, id DESC&quot;;

            await using var connection = new MySqlConnection(_connectionString);
            await connection.OpenAsync();

            await using var command = new MySqlCommand(query, connection);
            command.Parameters.AddWithValue(&quot;@StartDate&quot;, startDate.Date);
            command.Parameters.AddWithValue(&quot;@EndDate&quot;, endDate.Date);

            await using var reader = await command.ExecuteReaderAsync();
            var rows = new List&lt;Model_ReportRow&gt;();

            while (await reader.ReadAsync())
            {
                rows.Add(new Model_ReportRow
                {
                    Id = reader.GetInt32(&quot;id&quot;).ToString(),
                    PONumber = reader.IsDBNull(reader.GetOrdinal(&quot;po_number&quot;)) ? null : reader.GetString(&quot;po_number&quot;),
                    LineNumber = reader.IsDBNull(reader.GetOrdinal(&quot;line_number&quot;)) ? null : reader.GetString(&quot;line_number&quot;),
                    PackageDescription = reader.IsDBNull(reader.GetOrdinal(&quot;package_description&quot;)) ? null : reader.GetString(&quot;package_description&quot;),
                    DeliverTo = reader.IsDBNull(reader.GetOrdinal(&quot;deliver_to&quot;)) ? null : reader.GetString(&quot;deliver_to&quot;),
                    Department = reader.IsDBNull(reader.GetOrdinal(&quot;department&quot;)) ? null : reader.GetString(&quot;department&quot;),
                    Location = reader.IsDBNull(reader.GetOrdinal(&quot;location&quot;)) ? null : reader.GetString(&quot;location&quot;),
                    Quantity = reader.IsDBNull(reader.GetOrdinal(&quot;quantity&quot;)) ? null : reader.GetDecimal(&quot;quantity&quot;),
                    EmployeeNumber = reader.IsDBNull(reader.GetOrdinal(&quot;employee_number&quot;)) ? null : reader.GetInt32(&quot;employee_number&quot;).ToString(),
                    CreatedDate = reader.GetDateTime(&quot;created_date&quot;),
                    OtherReason = reader.IsDBNull(reader.GetOrdinal(&quot;other_reason&quot;)) ? null : reader.GetString(&quot;other_reason&quot;),
                    SourceModule = reader.GetString(&quot;source_module&quot;)
                });
            }

            return Model_Dao_Result_Factory.Success(rows);
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_ReportRow&gt;&gt;(
                $&quot;Error retrieving routing history: {ex.Message}&quot;,
                ex);
        }
    }

    /// &lt;summary&gt;
    /// Retrieves Volvo history from view_volvo_history view
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;startDate&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;endDate&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_ReportRow&gt;&gt;&gt; GetVolvoHistoryAsync(
        DateTime startDate,
        DateTime endDate)
    {
        try
        {
            var query = @&quot;
                SELECT
                    id,
                    shipment_number,
                    shipment_date,
                    po_number,
                    receiver_number,
                    status,
                    employee_number,
                    notes,
                    part_count,
                    created_date,
                    source_module
                FROM view_volvo_history
                WHERE created_date BETWEEN @StartDate AND @EndDate
                ORDER BY created_date DESC&quot;;

            await using var connection = new MySqlConnection(_connectionString);
            await connection.OpenAsync();

            await using var command = new MySqlCommand(query, connection);
            command.Parameters.AddWithValue(&quot;@StartDate&quot;, startDate.Date);
            command.Parameters.AddWithValue(&quot;@EndDate&quot;, endDate.Date);

            await using var reader = await command.ExecuteReaderAsync();
            var rows = new List&lt;Model_ReportRow&gt;();

            while (await reader.ReadAsync())
            {
                rows.Add(new Model_ReportRow
                {
                    Id = reader.GetInt32(&quot;id&quot;).ToString(),
                    ShipmentNumber = reader.IsDBNull(reader.GetOrdinal(&quot;shipment_number&quot;)) ? null : reader.GetInt32(&quot;shipment_number&quot;),
                    PONumber = reader.IsDBNull(reader.GetOrdinal(&quot;po_number&quot;)) ? null : reader.GetString(&quot;po_number&quot;),
                    ReceiverNumber = reader.IsDBNull(reader.GetOrdinal(&quot;receiver_number&quot;)) ? null : reader.GetString(&quot;receiver_number&quot;),
                    Status = reader.IsDBNull(reader.GetOrdinal(&quot;status&quot;)) ? null : reader.GetString(&quot;status&quot;),
                    EmployeeNumber = reader.IsDBNull(reader.GetOrdinal(&quot;employee_number&quot;)) ? null : reader.GetString(&quot;employee_number&quot;),
                    PartCount = reader.IsDBNull(reader.GetOrdinal(&quot;part_count&quot;)) ? null : reader.GetInt32(&quot;part_count&quot;),
                    CreatedDate = reader.GetDateTime(&quot;created_date&quot;),
                    SourceModule = reader.GetString(&quot;source_module&quot;)
                });
            }

            return Model_Dao_Result_Factory.Success(rows);
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_ReportRow&gt;&gt;(
                $&quot;Error retrieving Volvo history: {ex.Message}&quot;,
                ex);
        }
    }

    /// &lt;summary&gt;
    /// Checks data availability for each module in date range
    /// Returns dictionary of module name  record count
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;startDate&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;endDate&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Dictionary&lt;string, int&gt;&gt;&gt; CheckAvailabilityAsync(
        DateTime startDate,
        DateTime endDate)
    {
        try
        {
            var availability = new Dictionary&lt;string, int&gt;();

            await using var connection = new MySqlConnection(_connectionString);
            await connection.OpenAsync();

            // Check Receiving
            var receivingCount = await GetCountAsync(connection, &quot;view_receiving_history&quot;, startDate, endDate);
            availability[&quot;Receiving&quot;] = receivingCount;

            // Check Dunnage
            var dunnageCount = await GetCountAsync(connection, &quot;view_dunnage_history&quot;, startDate, endDate);
            availability[&quot;Dunnage&quot;] = dunnageCount;

            // Check Routing
            var routingCount = await GetCountAsync(connection, &quot;view_routing_history&quot;, startDate, endDate);
            availability[&quot;Routing&quot;] = routingCount;

            // Check Volvo (placeholder)
            availability[&quot;Volvo&quot;] = 0;

            return Model_Dao_Result_Factory.Success(availability);
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;Dictionary&lt;string, int&gt;&gt;(
                $&quot;Error checking availability: {ex.Message}&quot;,
                ex);
        }
    }

    /// &lt;summary&gt;
    /// Helper method to get count from a view
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;connection&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;viewName&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;startDate&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;endDate&quot;&gt;&lt;/param&gt;
    private async Task&lt;int&gt; GetCountAsync(
        MySqlConnection connection,
        string viewName,
        DateTime startDate,
        DateTime endDate)
    {
        var query = $@&quot;
            SELECT COUNT(*)
            FROM {viewName}
            WHERE created_date BETWEEN @StartDate AND @EndDate&quot;;

        await using var command = new MySqlCommand(query, connection);
        command.Parameters.AddWithValue(&quot;@StartDate&quot;, startDate.Date);
        command.Parameters.AddWithValue(&quot;@EndDate&quot;, endDate.Date);

        var result = await command.ExecuteScalarAsync();
        return Convert.ToInt32(result);
    }
}</file><file path="Module_Routing/Services/RoutingUsageTrackingService.cs">using System;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Data;
using MTM_Receiving_Application.Module_Routing.Models;

namespace MTM_Receiving_Application.Module_Routing.Services;

/// &lt;summary&gt;
/// Service for usage tracking to enable personalized Quick Add
/// &lt;/summary&gt;
public class RoutingUsageTrackingService : IRoutingUsageTrackingService
{
    private readonly Dao_RoutingUsageTracking _daoUsageTracking;
    private readonly IService_LoggingUtility _logger;

    public RoutingUsageTrackingService(
        Dao_RoutingUsageTracking daoUsageTracking,
        IService_LoggingUtility logger)
    {
        _daoUsageTracking = daoUsageTracking ?? throw new ArgumentNullException(nameof(daoUsageTracking));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// &lt;summary&gt;
    /// Increments the usage count for a recipient-employee pair
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;employeeNumber&quot;&gt;Employee number creating the label&lt;/param&gt;
    /// &lt;param name=&quot;recipientId&quot;&gt;ID of the recipient&lt;/param&gt;
    /// &lt;returns&gt;Result indicating success or failure&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&gt; IncrementUsageCountAsync(int employeeNumber, int recipientId)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Incrementing usage count for employee {employeeNumber}, recipient {recipientId}&quot;);
            return await _daoUsageTracking.IncrementUsageAsync(employeeNumber, recipientId);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error incrementing usage count: {ex.Message}&quot;, ex);
            return new Model_Dao_Result { Success = false, ErrorMessage = $&quot;Error updating usage tracking: {ex.Message}&quot;, Exception = ex };
        }
    }

    /// &lt;summary&gt;
    /// Gets the usage count for a specific employee-recipient pair
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;employeeNumber&quot;&gt;Employee number&lt;/param&gt;
    /// &lt;param name=&quot;recipientId&quot;&gt;Recipient ID&lt;/param&gt;
    /// &lt;returns&gt;Result with usage count&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetUsageCountAsync(int employeeNumber, int recipientId)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Getting usage count for employee {employeeNumber}, recipient {recipientId}&quot;);

            // Issue #13: GetUsageCountAsync requires new DAO method
            // Would need: sp_routing_recipient_tracker_get_count(p_employee_number, p_recipient_id)
            // Returns: COUNT(*) or SUM(usage_count) from routing_recipient_tracker table
            // Priority: LOW - Feature not critical for production
            // For now, returning success with 0 as fallback
            await Task.CompletedTask;
            return Model_Dao_Result_Factory.Success&lt;int&gt;(0);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error getting usage count: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;int&gt;($&quot;Error getting usage count: {ex.Message}&quot;, ex);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetEmployeeLabelCountAsync(int employeeNumber)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Getting label count for employee {employeeNumber}&quot;);

            // Issue #13: GetEmployeeLabelCountAsync requires aggregation query
            // Would need: sp_routing_recipient_tracker_get_employee_total(p_employee_number)
            // Returns: Total label count for employee across all recipients
            // Issue #28: When implementing, add zero-check guard to prevent division by zero
            // Example: if (totalCount == 0) return 0; before calculating percentages
            // Priority: LOW - Analytics feature, not blocking for core functionality
            // For now, returning success with 0 as fallback
            await Task.CompletedTask;
            return Model_Dao_Result_Factory.Success&lt;int&gt;(0);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error getting employee label count: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;int&gt;($&quot;Error getting label count: {ex.Message}&quot;, ex);
        }
    }
}</file><file path="Module_Routing/ViewModels/RoutingModeSelectionViewModel.cs">using System;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Contracts.Services.Navigation;
using MTM_Receiving_Application.Module_Routing.Services;
using MTM_Receiving_Application.Module_Routing.Enums;
using MTM_Receiving_Application.Module_Routing.Models;
using MTM_Receiving_Application.Module_Shared.ViewModels;


namespace MTM_Receiving_Application.Module_Routing.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Mode Selection - launching Wizard, Manual Entry, or Edit Mode
/// &lt;/summary&gt;
public partial class RoutingModeSelectionViewModel : ViewModel_Shared_Base
{
    private readonly IRoutingUserPreferenceService _userPreferenceService;
    private readonly IService_Navigation _navigationService;
    private readonly IService_UserSessionManager _sessionManager;

    private Frame? _frame;

    // Separate default flags for each mode
    [ObservableProperty] private bool _isWizardDefault;
    [ObservableProperty] private bool _isManualDefault;
    [ObservableProperty] private bool _isEditDefault;

    public RoutingModeSelectionViewModel(
        IRoutingUserPreferenceService userPreferenceService,
        IService_Navigation navigationService,
        IService_ErrorHandler errorHandler,
        IService_UserSessionManager sessionManager,
        IService_LoggingUtility logger)
        : base(errorHandler, logger)
    {
        _sessionManager = sessionManager;
        _userPreferenceService = userPreferenceService;
        _navigationService = navigationService;
    }

    /// &lt;summary&gt;
    /// Sets the navigation frame
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;frame&quot;&gt;&lt;/param&gt;
    public void SetNavigationFrame(Frame frame)
    {
        _frame = frame;
    }

    /// &lt;summary&gt;
    /// Initialize - load user preferences
    /// &lt;/summary&gt;
    public async Task InitializeAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading preferences...&quot;;

            // Issue #7: Get current user from session
            var employeeNumber = _sessionManager.CurrentSession?.User?.EmployeeNumber ?? 0;

            var prefsResult = await _userPreferenceService.GetUserPreferenceAsync(employeeNumber);
            if (prefsResult.IsSuccess &amp;&amp; prefsResult.Data != null)
            {
                if (Enum.TryParse&lt;Enum_RoutingMode&gt;(prefsResult.Data.DefaultMode, out var mode))
                {
                    // Set checkbox state based on preference
                    IsWizardDefault = mode == Enum_RoutingMode.WIZARD;
                    IsManualDefault = mode == Enum_RoutingMode.MANUAL;
                    IsEditDefault = mode == Enum_RoutingMode.EDIT;

                    // If default mode is set and not Wizard (which might be the landing page), auto-nav
                    // Revisit this logic if Wizard SHOULD technically be skipped to Step 1 directly. 
                    // For now keeping existing logic but fixing navigation.
                    if (mode != Enum_RoutingMode.WIZARD)
                    {
                        await NavigateToModeAsync(mode);
                    }
                }
            }

            StatusMessage = &quot;Select a mode to continue&quot;;
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(ex, Module_Core.Models.Enums.Enum_ErrorSeverity.Low,
                nameof(InitializeAsync), nameof(RoutingModeSelectionViewModel));
            StatusMessage = &quot;Error loading preferences&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }

    [RelayCommand]
    private async Task SelectWizardModeAsync() =&gt; await NavigateToModeAsync(Enum_RoutingMode.WIZARD);

    [RelayCommand]
    private async Task SelectManualEntryModeAsync() =&gt; await NavigateToModeAsync(Enum_RoutingMode.MANUAL);

    [RelayCommand]
    private async Task SelectEditModeAsync() =&gt; await NavigateToModeAsync(Enum_RoutingMode.EDIT);

    [RelayCommand]
    private async Task SetWizardAsDefaultAsync(bool isChecked)
    {
        if (isChecked)
        {
            IsManualDefault = false;
            IsEditDefault = false;
            await SavePreferenceAsync(Enum_RoutingMode.WIZARD);
        }
    }

    [RelayCommand]
    private async Task SetManualAsDefaultAsync(bool isChecked)
    {
        if (isChecked)
        {
            IsWizardDefault = false;
            IsEditDefault = false;
            await SavePreferenceAsync(Enum_RoutingMode.MANUAL);
        }
    }

    [RelayCommand]
    private async Task SetEditAsDefaultAsync(bool isChecked)
    {
        if (isChecked)
        {
            IsWizardDefault = false;
            IsManualDefault = false;
            await SavePreferenceAsync(Enum_RoutingMode.EDIT);
        }
    }

    private async Task SavePreferenceAsync(Enum_RoutingMode mode)
    {
        try
        {
            // Issue #7: Get current user from session
            var employeeNumber = _sessionManager.CurrentSession?.User?.EmployeeNumber ?? 0;

            var preference = new Model_RoutingUserPreference
            {
                EmployeeNumber = employeeNumber,
                DefaultMode = mode.ToString(),
                EnableValidation = true
            };

            var result = await _userPreferenceService.SaveUserPreferenceAsync(preference);

            if (result.IsSuccess)
            {
                await _logger.LogInfoAsync($&quot;Default mode set to {mode} for employee {employeeNumber}&quot;);
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(ex, Module_Core.Models.Enums.Enum_ErrorSeverity.Low,
                nameof(SavePreferenceAsync), nameof(RoutingModeSelectionViewModel));
        }
    }

    private async Task NavigateToModeAsync(Enum_RoutingMode mode)
    {
        try
        {
            if (_frame == null)
            {
                // Fallback attempt to find frame if not explicitly set? 
                // For now just log usage error
                _errorHandler.HandleException(new InvalidOperationException(&quot;Navigation Frame not set&quot;),
                    Module_Core.Models.Enums.Enum_ErrorSeverity.Error,
                    nameof(NavigateToModeAsync), nameof(RoutingModeSelectionViewModel));
                return;
            }

            string viewName = mode switch
            {
                Enum_RoutingMode.WIZARD =&gt; typeof(Views.RoutingWizardContainerView).FullName!,
                Enum_RoutingMode.MANUAL =&gt; typeof(Views.RoutingManualEntryView).FullName!,
                Enum_RoutingMode.EDIT =&gt; typeof(Views.RoutingEditModeView).FullName!,
                _ =&gt; throw new ArgumentException($&quot;Unknown mode: {mode}&quot;)
            };

            _navigationService.NavigateTo(_frame, viewName);
            await _logger.LogInfoAsync($&quot;Navigated to {viewName}&quot;);
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(ex, Module_Core.Models.Enums.Enum_ErrorSeverity.Medium,
                nameof(NavigateToModeAsync), nameof(RoutingModeSelectionViewModel));
        }
    }
}</file><file path="Module_Routing/ViewModels/RoutingWizardStep2ViewModel.cs">using System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Routing.Models;
using MTM_Receiving_Application.Module_Routing.Services;

namespace MTM_Receiving_Application.Module_Routing.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Wizard Step 2: Recipient Selection with Quick Add
/// &lt;/summary&gt;
public partial class RoutingWizardStep2ViewModel : ObservableObject
{
    private readonly IRoutingRecipientService _recipientService;
    private readonly IService_ErrorHandler _errorHandler;
    private readonly IService_LoggingUtility _logger;
    private readonly IService_UserSessionManager _sessionManager;
    private readonly RoutingWizardContainerViewModel _containerViewModel;

    // Full list for filtering
    private ObservableCollection&lt;Model_RoutingRecipient&gt; _allRecipients = new();

    #region Constructor
    public RoutingWizardStep2ViewModel(
        IRoutingRecipientService recipientService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger,
        IService_UserSessionManager sessionManager,
        RoutingWizardContainerViewModel containerViewModel)
    {
        _recipientService = recipientService;
        _errorHandler = errorHandler;
        _logger = logger;
        _sessionManager = sessionManager;
        _containerViewModel = containerViewModel;

        // Subscribe to container property changes to update button text
        _containerViewModel.PropertyChanged += (s, e) =&gt;
        {
            if (e.PropertyName == nameof(_containerViewModel.IsEditingFromReview))
            {
                OnPropertyChanged(nameof(IsEditingFromReview));
                OnPropertyChanged(nameof(NavigationButtonText));
            }
        };
    }
    #endregion

    #region Observable Properties
    /// &lt;summary&gt;
    /// Quick Add buttons (top 5 most-used recipients)
    /// &lt;/summary&gt;
    [ObservableProperty]
    private ObservableCollection&lt;Model_RoutingRecipient&gt; _quickAddRecipients = new();

    /// &lt;summary&gt;
    /// Filtered recipient list for DataGrid
    /// &lt;/summary&gt;
    [ObservableProperty]
    private ObservableCollection&lt;Model_RoutingRecipient&gt; _filteredRecipients = new();

    /// &lt;summary&gt;
    /// Selected recipient from DataGrid
    /// &lt;/summary&gt;
    [ObservableProperty]
    private Model_RoutingRecipient? _selectedRecipient;

    /// &lt;summary&gt;
    /// Search text for real-time filtering
    /// &lt;/summary&gt;
    [ObservableProperty]
    private string _searchText = string.Empty;

    /// &lt;summary&gt;
    /// Busy indicator
    /// &lt;/summary&gt;
    [ObservableProperty]
    private bool _isBusy;

    /// &lt;summary&gt;
    /// Status message
    /// &lt;/summary&gt;
    [ObservableProperty]
    private string _statusMessage = &quot;Select a recipient&quot;;

    /// &lt;summary&gt;
    /// Is user editing from review (Step 3)
    /// &lt;/summary&gt;
    public bool IsEditingFromReview =&gt; _containerViewModel.IsEditingFromReview;

    /// &lt;summary&gt;
    /// Button text for navigation (changes when editing from review)
    /// &lt;/summary&gt;
    public string NavigationButtonText =&gt; IsEditingFromReview ? &quot;Back to Review&quot; : &quot;Next: Review&quot;;
    #endregion

    #region Initialization
    /// &lt;summary&gt;
    /// Load recipients and populate Quick Add buttons
    /// &lt;/summary&gt;
    [RelayCommand]
    public async Task LoadRecipientsAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading recipients...&quot;;

            // Load Quick Add recipients (top 5 for current employee)
            var quickAddResult = await _recipientService.GetQuickAddRecipientsAsync(
                GetCurrentEmployeeNumber());

            if (quickAddResult.IsSuccess &amp;&amp; quickAddResult.Data != null)
            {
                QuickAddRecipients.Clear();
                foreach (var recipient in quickAddResult.Data)
                {
                    QuickAddRecipients.Add(recipient);
                }
            }

            // Load all active recipients for searchable list
            var allRecipientsResult = await _recipientService.GetActiveRecipientsSortedByUsageAsync(0);

            if (allRecipientsResult.IsSuccess &amp;&amp; allRecipientsResult.Data != null)
            {
                _allRecipients.Clear();
                foreach (var recipient in allRecipientsResult.Data)
                {
                    _allRecipients.Add(recipient);
                }

                // Initially show all
                ApplyFilter();
                StatusMessage = $&quot;Loaded {_allRecipients.Count} recipients ({QuickAddRecipients.Count} Quick Add)&quot;;
            }
            else
            {
                await _errorHandler.ShowUserErrorAsync(
                    &quot;Failed to load recipients&quot;,
                    &quot;Data Load Error&quot;,
                    nameof(LoadRecipientsAsync));
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Medium,
                nameof(LoadRecipientsAsync),
                nameof(RoutingWizardStep2ViewModel));
        }
        finally
        {
            IsBusy = false;
        }
    }
    #endregion

    #region Quick Add Commands
    /// &lt;summary&gt;
    /// Quick Add button clicked - auto-select recipient and navigate to Step 3
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;recipient&quot;&gt;&lt;/param&gt;
    [RelayCommand]
    private void QuickAddRecipient(Model_RoutingRecipient recipient)
    {
        if (recipient == null)
        {
            return;
        }

        SelectedRecipient = recipient;
        StatusMessage = $&quot;Quick Add selected: {recipient.Name}&quot;;

        // Immediately proceed to Step 3
        ProceedToStep3();
    }
    #endregion

    #region Search and Filter
    /// &lt;summary&gt;
    /// Apply real-time search filter to recipient list
    /// &lt;/summary&gt;
    private void ApplyFilter()
    {
        FilteredRecipients.Clear();

        if (string.IsNullOrWhiteSpace(SearchText))
        {
            // Show all when no search text
            foreach (var recipient in _allRecipients)
            {
                FilteredRecipients.Add(recipient);
            }
        }
        else
        {
            // Filter by name, location, or department (case-insensitive)
            // Issue #19: Optimized collection filtering - materialize before iteration
            var searchLower = SearchText.ToLower();
            var filtered = _allRecipients.Where(r =&gt;
                r.Name.ToLower().Contains(searchLower) ||
                (r.Location?.ToLower().Contains(searchLower) ?? false) ||
                (r.Department?.ToLower().Contains(searchLower) ?? false)).ToList();

            foreach (var recipient in filtered)
            {
                FilteredRecipients.Add(recipient);
            }
        }

        StatusMessage = $&quot;Showing {FilteredRecipients.Count} of {_allRecipients.Count} recipients&quot;;
    }

    /// &lt;summary&gt;
    /// Trigger filter when search text changes
    /// &lt;/summary&gt;
    partial void OnSearchTextChanged(string value)
    {
        ApplyFilter();
    }
    #endregion

    #region Navigation Commands
    /// &lt;summary&gt;
    /// Proceed to Step 3 (Review)
    /// &lt;/summary&gt;
    [RelayCommand(CanExecute = nameof(CanProceedToStep3))]
    private void ProceedToStep3()
    {
        try
        {
            _logger.LogInfo($&quot;ProceedToStep3 called with recipient: {SelectedRecipient?.Name ?? &quot;null&quot;}&quot;);

            if (SelectedRecipient == null)
            {
                _logger.LogWarning(&quot;ProceedToStep3: No recipient selected&quot;);
                StatusMessage = &quot;Please select a recipient before proceeding&quot;;
                return;
            }

            // Update container with selected recipient
            _containerViewModel.SelectedRecipient = SelectedRecipient;
            _logger.LogInfo($&quot;Updated container with recipient: {SelectedRecipient.Name}&quot;);

            // Navigate to Step 3 (always goes to Step 3 whether editing or not)
            _containerViewModel.NavigateToStep3Command.Execute(null);
            _logger.LogInfo(&quot;Navigation to Step 3 triggered&quot;);
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error in ProceedToStep3: {ex.Message}&quot;, ex);
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Error,
                nameof(ProceedToStep3),
                nameof(RoutingWizardStep2ViewModel));
        }
    }

    /// &lt;summary&gt;
    /// Can proceed if recipient is selected
    /// &lt;/summary&gt;
    private bool CanProceedToStep3()
    {
        var canProceed = SelectedRecipient != null;
        _logger.LogInfo($&quot;CanProceedToStep3: {canProceed} (SelectedRecipient: {SelectedRecipient?.Name ?? &quot;null&quot;})&quot;);
        return canProceed;
    }

    /// &lt;summary&gt;
    /// Go back to Step 1
    /// &lt;/summary&gt;
    [RelayCommand]
    private void NavigateBackToStep1()
    {
        _containerViewModel.NavigateToStep1Command.Execute(null);
    }
    #endregion

    #region Helper Methods
    /// &lt;summary&gt;
    /// Get current employee number from session
    /// Issue #7: Implemented using IService_UserSessionManager
    /// &lt;/summary&gt;
    private int GetCurrentEmployeeNumber()
    {
        return _sessionManager.CurrentSession?.User?.EmployeeNumber ?? 0;
    }

    /// &lt;summary&gt;
    /// Notify command can execute changed when selection changes
    /// &lt;/summary&gt;
    partial void OnSelectedRecipientChanged(Model_RoutingRecipient? value)
    {
        _logger.LogInfo($&quot;Selected recipient changed to: {value?.Name ?? &quot;null&quot;}&quot;);
        ProceedToStep3Command.NotifyCanExecuteChanged();

        if (value != null)
        {
            StatusMessage = $&quot;Selected: {value.Name} - Click &apos;Next&apos; to continue&quot;;
        }
    }
    #endregion
}</file><file path="Module_Routing/ViewModels/RoutingWizardStep3ViewModel.cs">using System;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Routing.Models;
using MTM_Receiving_Application.Module_Routing.Services;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using Microsoft.UI.Xaml.Controls;

namespace MTM_Receiving_Application.Module_Routing.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Wizard Step 3: Review and Confirm
/// &lt;/summary&gt;
public partial class RoutingWizardStep3ViewModel : ObservableObject
{
    private readonly IRoutingService _routingService;
    private readonly IService_ErrorHandler _errorHandler;
    private readonly IService_LoggingUtility _logger;
    private readonly RoutingWizardContainerViewModel _containerViewModel;

    #region Constructor
    public RoutingWizardStep3ViewModel(
        IRoutingService routingService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger,
        RoutingWizardContainerViewModel containerViewModel)
    {
        _routingService = routingService;
        _errorHandler = errorHandler;
        _logger = logger;
        _containerViewModel = containerViewModel;

        // Register with container so it can trigger LoadReviewData
        _containerViewModel.RegisterStep3ViewModel(this);
        _logger.LogInfo(&quot;Step3ViewModel initialized and registered&quot;);
    }
    #endregion

    #region Observable Properties
    /// &lt;summary&gt;
    /// Summary of label data for review
    /// &lt;/summary&gt;
    [ObservableProperty]
    private string _poNumber = string.Empty;

    [ObservableProperty]
    private int _poLine;

    [ObservableProperty]
    private string _partID = string.Empty;

    [ObservableProperty]
    private string _partDescription = string.Empty;

    [ObservableProperty]
    private string _recipientName = string.Empty;

    [ObservableProperty]
    private string _recipientLocation = string.Empty;

    [ObservableProperty]
    private int _quantity;

    [ObservableProperty]
    private string _otherReason = string.Empty;

    [ObservableProperty]
    private bool _isOtherWorkflow;

    /// &lt;summary&gt;
    /// Busy indicator
    /// &lt;/summary&gt;
    [ObservableProperty]
    private bool _isBusy;

    /// &lt;summary&gt;
    /// Status message
    /// &lt;/summary&gt;
    [ObservableProperty]
    private string _statusMessage = &quot;Review label details&quot;;
    #endregion

    #region Initialization
    /// &lt;summary&gt;
    /// Load review data from container ViewModel
    /// &lt;/summary&gt;
    public void LoadReviewData()
    {
        _logger.LogInfo(&quot;LoadReviewData called&quot;);
        _logger.LogInfo($&quot;Container state - SelectedPOLine: {_containerViewModel.SelectedPOLine?.PartID ?? &quot;null&quot;}, SelectedRecipient: {_containerViewModel.SelectedRecipient?.Name ?? &quot;null&quot;}, FinalQuantity: {_containerViewModel.FinalQuantity}&quot;);

        // Load from container state
        if (_containerViewModel.SelectedPOLine != null)
        {
            // PO workflow
            IsOtherWorkflow = false;
            PoNumber = _containerViewModel.SelectedPOLine.PONumber;
            PoLine = int.TryParse(_containerViewModel.SelectedPOLine.LineNumber, out var lineNum) ? lineNum : 0;
            PartID = _containerViewModel.SelectedPOLine.PartID;
            PartDescription = _containerViewModel.SelectedPOLine.Description;
            _logger.LogInfo($&quot;Loaded PO data - PO: {PoNumber}, Line: {PoLine}, Part: {PartID}&quot;);
        }
        else if (_containerViewModel.SelectedOtherReason != null)
        {
            // OTHER workflow
            IsOtherWorkflow = true;
            PoNumber = &quot;OTHER&quot;;
            PoLine = 0;
            PartID = $&quot;OTHER-{_containerViewModel.SelectedOtherReason.ReasonCode}&quot;;
            PartDescription = _containerViewModel.SelectedOtherReason.Description;
            OtherReason = _containerViewModel.SelectedOtherReason.Description;
            _logger.LogInfo($&quot;Loaded OTHER data - Reason: {OtherReason}&quot;);
        }
        else
        {
            _logger.LogWarning(&quot;LoadReviewData: No PO line or OTHER reason in container!&quot;);
        }

        // Load recipient
        if (_containerViewModel.SelectedRecipient != null)
        {
            RecipientName = _containerViewModel.SelectedRecipient.Name;
            RecipientLocation = _containerViewModel.SelectedRecipient.Location ?? string.Empty;
            _logger.LogInfo($&quot;Loaded recipient - Name: {RecipientName}, Location: {RecipientLocation}&quot;);
        }
        else
        {
            _logger.LogWarning(&quot;LoadReviewData: No recipient in container!&quot;);
        }

        // Load quantity
        Quantity = _containerViewModel.FinalQuantity;
        _logger.LogInfo($&quot;Final quantity: {Quantity}&quot;);

        StatusMessage = &quot;Review and confirm label details&quot;;
    }
    #endregion

    #region Edit Commands
    /// &lt;summary&gt;
    /// Edit PO/Line selection (go back to Step 1)
    /// &lt;/summary&gt;
    [RelayCommand]
    private void EditPOSelection()
    {
        _logger.LogInfo(&quot;EditPOSelection - Navigating to Step 1 in edit mode&quot;);
        _containerViewModel.NavigateToStep1ForEditCommand.Execute(null);
    }

    /// &lt;summary&gt;
    /// Edit recipient selection (go back to Step 2)
    /// &lt;/summary&gt;
    [RelayCommand]
    private void EditRecipientSelection()
    {
        _logger.LogInfo(&quot;EditRecipientSelection - Navigating to Step 2 in edit mode&quot;);
        _containerViewModel.NavigateToStep2ForEditCommand.Execute(null);
    }

    /// &lt;summary&gt;
    /// Navigate back to Step 2 (standard back navigation)
    /// &lt;/summary&gt;
    [RelayCommand]
    private void NavigateBack()
    {
        _logger.LogInfo(&quot;NavigateBack - Navigating back to Step 2&quot;);
        _containerViewModel.NavigateBackToStep2Command.Execute(null);
    }
    #endregion

    #region Create Label Command
    /// &lt;summary&gt;
    /// Create the routing label with duplicate check
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task CreateLabelAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Checking for duplicates...&quot;;

            // Check for duplicate labels (24-hour window)
            var duplicateCheckResult = await _routingService.CheckDuplicateLabelAsync(
                PoNumber,
                PoLine.ToString(),
                _containerViewModel.SelectedRecipient?.Id ?? 0,
                DateTime.Now);

            if (duplicateCheckResult.IsSuccess &amp;&amp; duplicateCheckResult.Data.Exists)
            {
                // Duplicate found - show confirmation
                var continueAnyway = await ShowDuplicateConfirmationAsync();
                if (!continueAnyway)
                {
                    StatusMessage = &quot;Label creation cancelled&quot;;
                    return;
                }
            }

            // Proceed with label creation via container ViewModel
            StatusMessage = &quot;Creating label...&quot;;
            await _containerViewModel.CreateLabelCommand.ExecuteAsync(null);
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Medium,
                nameof(CreateLabelAsync),
                nameof(RoutingWizardStep3ViewModel));
            StatusMessage = &quot;Error creating label&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }
    #endregion

    #region Helper Methods
    /// &lt;summary&gt;
    /// Show duplicate confirmation dialog
    /// &lt;/summary&gt;
    private async Task&lt;bool&gt; ShowDuplicateConfirmationAsync()
    {
        var dialog = new ContentDialog
        {
            Title = &quot;Duplicate Label Detected&quot;,
            Content = $&quot;A similar label was created within the last 24 hours.\n\n&quot; +
                     $&quot;PO: {PoNumber} Line: {PoLine}\n&quot; +
                     $&quot;Part: {PartID}\n&quot; +
                     $&quot;Recipient: {RecipientName}\n\n&quot; +
                     $&quot;Do you want to create this label anyway?&quot;,
            PrimaryButtonText = &quot;Yes, create anyway&quot;,
            CloseButtonText = &quot;No, cancel&quot;,
            DefaultButton = ContentDialogButton.Close
        };

        // Set XamlRoot for dialog
        dialog.XamlRoot = App.MainWindow?.Content?.XamlRoot;

        var result = await dialog.ShowAsync();
        return result == ContentDialogResult.Primary;
    }
    #endregion
}</file><file path="Module_Routing/Views/RoutingEditModeView.xaml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;Page
    x:Class=&quot;MTM_Receiving_Application.Module_Routing.Views.RoutingEditModeView&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    xmlns:viewmodels=&quot;using:MTM_Receiving_Application.Module_Routing.ViewModels&quot;
    xmlns:models=&quot;using:MTM_Receiving_Application.Module_Routing.Models&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Routing.Converters&quot;
    Loaded=&quot;OnPageLoaded&quot;&gt;

    &lt;Page.Resources&gt;
        &lt;converters:NullToBooleanConverter x:Key=&quot;NullToBooleanConverter&quot;/&gt;
    &lt;/Page.Resources&gt;

    &lt;Grid Padding=&quot;24&quot; RowSpacing=&quot;16&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header --&gt;
        &lt;TextBlock 
            Grid.Row=&quot;0&quot;
            Text=&quot;Edit Mode - Label History&quot;
            Style=&quot;{StaticResource TitleTextBlockStyle}&quot;/&gt;

        &lt;!-- Search Bar --&gt;
        &lt;Grid Grid.Row=&quot;1&quot; ColumnSpacing=&quot;12&quot;&gt;
            &lt;Grid.ColumnDefinitions&gt;
                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
            &lt;/Grid.ColumnDefinitions&gt;

            &lt;TextBox
                Grid.Column=&quot;0&quot;
                PlaceholderText=&quot;Search by PO, Recipient, or Part ID...&quot;
                Text=&quot;{x:Bind ViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}&quot;/&gt;

            &lt;Button
                Grid.Column=&quot;1&quot;
                Content=&quot;Edit Selected&quot;
                Command=&quot;{x:Bind EditSelectedLabelCommand}&quot;
                IsEnabled=&quot;{x:Bind ViewModel.SelectedLabel, Mode=OneWay, Converter={StaticResource NullToBooleanConverter}}&quot;/&gt;

            &lt;Button
                Grid.Column=&quot;2&quot;
                Content=&quot;Reprint&quot;
                Command=&quot;{x:Bind ViewModel.ReprintLabelCommand}&quot;
                IsEnabled=&quot;{x:Bind ViewModel.SelectedLabel, Mode=OneWay, Converter={StaticResource NullToBooleanConverter}}&quot;/&gt;
        &lt;/Grid&gt;

        &lt;!-- Labels DataGrid --&gt;
        &lt;controls:DataGrid
            Grid.Row=&quot;2&quot;
            ItemsSource=&quot;{x:Bind ViewModel.FilteredLabels, Mode=OneWay}&quot;
            SelectedItem=&quot;{x:Bind ViewModel.SelectedLabel, Mode=TwoWay}&quot;
            AutoGenerateColumns=&quot;False&quot;
            IsReadOnly=&quot;True&quot;
            AlternatingRowBackground=&quot;{ThemeResource LayerFillColorDefaultBrush}&quot;
            SelectionMode=&quot;Single&quot;
            DoubleTapped=&quot;OnDataGridDoubleTapped&quot;&gt;
            
            &lt;controls:DataGrid.Columns&gt;
                &lt;controls:DataGridTextColumn Header=&quot;ID&quot; Binding=&quot;{Binding Id}&quot; Width=&quot;60&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;PO #&quot; Binding=&quot;{Binding PONumber}&quot; Width=&quot;100&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Line&quot; Binding=&quot;{Binding POLine}&quot; Width=&quot;60&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Part ID&quot; Binding=&quot;{Binding PartID}&quot; Width=&quot;120&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Recipient&quot; Binding=&quot;{Binding RecipientName}&quot; Width=&quot;150&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Quantity&quot; Binding=&quot;{Binding Quantity}&quot; Width=&quot;80&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Date&quot; Binding=&quot;{Binding CreatedDate}&quot; Width=&quot;120&quot;/&gt;
                &lt;controls:DataGridTextColumn Header=&quot;Creator&quot; Binding=&quot;{Binding EmployeeNumber}&quot; Width=&quot;80&quot;/&gt;
            &lt;/controls:DataGrid.Columns&gt;
        &lt;/controls:DataGrid&gt;

        &lt;!-- Status Bar --&gt;
        &lt;StackPanel Grid.Row=&quot;3&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot;&gt;
            &lt;ProgressRing 
                IsActive=&quot;{x:Bind ViewModel.IsBusy, Mode=OneWay}&quot;
                Width=&quot;20&quot; Height=&quot;20&quot;/&gt;
            &lt;TextBlock 
                Text=&quot;{x:Bind ViewModel.StatusMessage, Mode=OneWay}&quot;
                VerticalAlignment=&quot;Center&quot;/&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Settings/Data/Dao_PackageType.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Settings.Models;

namespace MTM_Receiving_Application.Module_Settings.Data;

/// &lt;summary&gt;
/// Data Access Object for package types CRUD operations
/// Instance-based pattern with connection string injection
/// &lt;/summary&gt;
public class Dao_PackageType
{
    private readonly string _connectionString;

    public Dao_PackageType(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Retrieves all active package types
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_PackageType&gt;&gt;&gt; GetAllAsync()
    {
        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Dunnage_Types_GetAll&quot;,
            MapFromReader
        );
    }

    /// &lt;summary&gt;
    /// Retrieves a package type by ID
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_PackageType&gt;&gt; GetByIdAsync(int id)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_id&quot;, id }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Dunnage_Types_GetById&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Inserts a new package type with validation
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;packageType&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;createdBy&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; InsertAsync(Model_PackageType packageType, int createdBy)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_name&quot;, packageType.Name },
            { &quot;p_code&quot;, packageType.Code },
            { &quot;p_created_by&quot;, createdBy }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Dunnage_Types_Insert&quot;,
            reader =&gt; reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Updates an existing package type
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;packageType&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; UpdateAsync(Model_PackageType packageType)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_id&quot;, packageType.Id },
            { &quot;p_name&quot;, packageType.Name },
            { &quot;p_code&quot;, packageType.Code }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Dunnage_Types_Update&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Deletes a package type (validates not in use)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; DeleteAsync(int id)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_id&quot;, id }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Receiving_PackageTypes_Delete&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Gets usage count for a package type
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; GetUsageCountAsync(int id)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_id&quot;, id }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Dunnage_Types_GetUsageCount&quot;,
            reader =&gt; reader.GetInt32(reader.GetOrdinal(&quot;usage_count&quot;)),
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Maps database reader to Model_PackageType
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;reader&quot;&gt;&lt;/param&gt;
    private static Model_PackageType MapFromReader(IDataReader reader)
    {
        return new Model_PackageType
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            Name = reader.GetString(reader.GetOrdinal(&quot;name&quot;)),
            Code = reader.GetString(reader.GetOrdinal(&quot;code&quot;)),
            IsActive = reader.GetBoolean(reader.GetOrdinal(&quot;is_active&quot;)),
            CreatedAt = reader.GetDateTime(reader.GetOrdinal(&quot;created_at&quot;)),
            UpdatedAt = reader.GetDateTime(reader.GetOrdinal(&quot;updated_at&quot;)),
            CreatedBy = reader.IsDBNull(reader.GetOrdinal(&quot;created_by&quot;)) ? null : reader.GetInt32(reader.GetOrdinal(&quot;created_by&quot;))
        };
    }
}</file><file path="Module_Settings/Data/Dao_RoutingRule.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Settings.Models;

namespace MTM_Receiving_Application.Module_Settings.Data;

/// &lt;summary&gt;
/// Data Access Object for routing rules CRUD operations
/// Instance-based pattern with connection string injection
/// &lt;/summary&gt;
public class Dao_RoutingRule
{
    private readonly string _connectionString;

    public Dao_RoutingRule(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Retrieves all active routing rules ordered by priority
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingRule&gt;&gt;&gt; GetAllAsync()
    {
        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Settings_RoutingRule_GetAll&quot;,
            MapFromReader
        );
    }

    /// &lt;summary&gt;
    /// Retrieves a routing rule by ID
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_RoutingRule&gt;&gt; GetByIdAsync(int id)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_id&quot;, id }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Settings_RoutingRule_GetById&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Inserts a new routing rule with pattern matching
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;rule&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;createdBy&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; InsertAsync(Model_RoutingRule rule, int createdBy)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_match_type&quot;, rule.MatchType },
            { &quot;p_pattern&quot;, rule.Pattern },
            { &quot;p_destination_location&quot;, rule.DestinationLocation },
            { &quot;p_priority&quot;, rule.Priority },
            { &quot;p_created_by&quot;, createdBy }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Settings_RoutingRule_Insert&quot;,
            reader =&gt; reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Updates an existing routing rule
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;rule&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; UpdateAsync(Model_RoutingRule rule)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_id&quot;, rule.Id },
            { &quot;p_match_type&quot;, rule.MatchType },
            { &quot;p_pattern&quot;, rule.Pattern },
            { &quot;p_destination_location&quot;, rule.DestinationLocation },
            { &quot;p_priority&quot;, rule.Priority }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Settings_RoutingRule_Update&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Deletes a routing rule (soft delete)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; DeleteAsync(int id)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_id&quot;, id }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Settings_RoutingRule_Delete&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Finds the first matching routing rule for a value
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;matchType&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;value&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_RoutingRule&gt;&gt; FindMatchAsync(string matchType, string value)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_match_type&quot;, matchType },
            { &quot;p_value&quot;, value }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Settings_RoutingRule_FindMatch&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Finds the first matching routing rule for a part number (spec compatibility)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;partNumber&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_RoutingRule&gt;&gt; GetByPartNumberAsync(string partNumber)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_part_number&quot;, partNumber }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Settings_RoutingRule_GetByPartNumber&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Maps database reader to Model_RoutingRule
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;reader&quot;&gt;&lt;/param&gt;
    private static Model_RoutingRule MapFromReader(IDataReader reader)
    {
        return new Model_RoutingRule
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            MatchType = reader.GetString(reader.GetOrdinal(&quot;match_type&quot;)),
            Pattern = reader.GetString(reader.GetOrdinal(&quot;pattern&quot;)),
            DestinationLocation = reader.GetString(reader.GetOrdinal(&quot;destination_location&quot;)),
            Priority = reader.GetInt32(reader.GetOrdinal(&quot;priority&quot;)),
            IsActive = reader.GetBoolean(reader.GetOrdinal(&quot;is_active&quot;)),
            CreatedAt = reader.GetDateTime(reader.GetOrdinal(&quot;created_at&quot;)),
            UpdatedAt = reader.GetDateTime(reader.GetOrdinal(&quot;updated_at&quot;)),
            CreatedBy = reader.IsDBNull(reader.GetOrdinal(&quot;created_by&quot;)) ? null : reader.GetInt32(reader.GetOrdinal(&quot;created_by&quot;))
        };
    }
}</file><file path="Module_Settings/Data/Dao_SettingsAuditLog.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Settings.Models;

namespace MTM_Receiving_Application.Module_Settings.Data;

/// &lt;summary&gt;
/// Data Access Object for settings audit log operations
/// Instance-based pattern with connection string injection
/// &lt;/summary&gt;
public class Dao_SettingsAuditLog
{
    private readonly string _connectionString;

    public Dao_SettingsAuditLog(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Retrieves audit log entries for a setting (most recent first)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;settingId&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;limit&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_SettingsAuditLog&gt;&gt;&gt; GetAsync(int settingId, int limit)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_setting_id&quot;, settingId },
            { &quot;p_limit&quot;, limit }
        };

        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Settings_AuditLog_Get&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Retrieves audit log entries for a specific setting (spec compatibility)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;settingId&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;limit&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_SettingsAuditLog&gt;&gt;&gt; GetBySettingAsync(int settingId, int limit)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_setting_id&quot;, settingId },
            { &quot;p_limit&quot;, limit }
        };

        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Settings_AuditLog_GetBySetting&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Retrieves audit log entries by user (spec compatibility)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;changedBy&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;limit&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_SettingsAuditLog&gt;&gt;&gt; GetByUserAsync(int changedBy, int limit)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;p_changed_by&quot;, changedBy },
            { &quot;p_limit&quot;, limit }
        };

        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Settings_AuditLog_GetByUser&quot;,
            MapFromReader,
            parameters
        );
    }

    private static Model_SettingsAuditLog MapFromReader(IDataReader reader)
    {
        return new Model_SettingsAuditLog
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            SettingId = reader.GetInt32(reader.GetOrdinal(&quot;setting_id&quot;)),
            Category = reader.GetString(reader.GetOrdinal(&quot;category&quot;)),
            SettingKey = reader.GetString(reader.GetOrdinal(&quot;setting_key&quot;)),
            SettingName = reader.GetString(reader.GetOrdinal(&quot;setting_name&quot;)),
            UserSettingId = reader.IsDBNull(reader.GetOrdinal(&quot;user_setting_id&quot;))
                ? null
                : reader.GetInt32(reader.GetOrdinal(&quot;user_setting_id&quot;)),
            OldValue = reader.IsDBNull(reader.GetOrdinal(&quot;old_value&quot;))
                ? null
                : reader.GetString(reader.GetOrdinal(&quot;old_value&quot;)),
            NewValue = reader.IsDBNull(reader.GetOrdinal(&quot;new_value&quot;))
                ? null
                : reader.GetString(reader.GetOrdinal(&quot;new_value&quot;)),
            ChangeType = reader.GetString(reader.GetOrdinal(&quot;change_type&quot;)),
            ChangedBy = reader.GetInt32(reader.GetOrdinal(&quot;changed_by&quot;)),
            ChangedAt = reader.GetDateTime(reader.GetOrdinal(&quot;changed_at&quot;)),
            IpAddress = reader.IsDBNull(reader.GetOrdinal(&quot;ip_address&quot;))
                ? null
                : reader.GetString(reader.GetOrdinal(&quot;ip_address&quot;)),
            WorkstationName = reader.IsDBNull(reader.GetOrdinal(&quot;workstation_name&quot;))
                ? null
                : reader.GetString(reader.GetOrdinal(&quot;workstation_name&quot;))
        };
    }
}</file><file path="Module_Volvo/Data/Dao_VolvoPartComponent.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Volvo.Models;
using MTM_Receiving_Application.Module_Core.Helpers.Database;

namespace MTM_Receiving_Application.Module_Volvo.Data;

/// &lt;summary&gt;
/// Data Access Object for volvo_part_components table
/// Provides CRUD operations using stored procedures
/// &lt;/summary&gt;
public class Dao_VolvoPartComponent
{
    private readonly string _connectionString;

    public Dao_VolvoPartComponent(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Gets all components for a parent part (for component explosion)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;parentPartNumber&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoPartComponent&gt;&gt;&gt; GetByParentPartAsync(string parentPartNumber)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;parent_part_number&quot;, parentPartNumber }
        };

        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Volvo_PartComponent_Get&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Inserts a new component relationship
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;component&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; InsertAsync(Model_VolvoPartComponent component)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;parent_part_number&quot;, component.ParentPartNumber },
            { &quot;component_part_number&quot;, component.ComponentPartNumber },
            { &quot;quantity&quot;, component.Quantity }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Volvo_PartComponent_Insert&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Deletes all components for a parent part (used before updating component list)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;parentPartNumber&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; DeleteByParentPartAsync(string parentPartNumber)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;parent_part_number&quot;, parentPartNumber }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Volvo_PartComponent_DeleteByParent&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Gets components for multiple parent parts (batch query to avoid N+1)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;parentPartNumbers&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Dictionary&lt;string, List&lt;Model_VolvoPartComponent&gt;&gt;&gt;&gt; GetComponentsByParentPartsAsync(
        List&lt;string&gt; parentPartNumbers)
    {
        if (parentPartNumbers == null || parentPartNumbers.Count == 0)
        {
            return new Model_Dao_Result&lt;Dictionary&lt;string, List&lt;Model_VolvoPartComponent&gt;&gt;&gt;
            {
                Success = true,
                Data = new Dictionary&lt;string, List&lt;Model_VolvoPartComponent&gt;&gt;()
            };
        }

        try
        {
            var result = new Dictionary&lt;string, List&lt;Model_VolvoPartComponent&gt;&gt;();

            // Batch query optimization - can be improved with stored proc
            foreach (var parentPart in parentPartNumbers)
            {
                var componentsResult = await GetByParentPartAsync(parentPart);
                if (componentsResult.IsSuccess &amp;&amp; componentsResult.Data != null)
                {
                    result[parentPart] = componentsResult.Data;
                }
                else
                {
                    result[parentPart] = new List&lt;Model_VolvoPartComponent&gt;();
                }
            }

            return new Model_Dao_Result&lt;Dictionary&lt;string, List&lt;Model_VolvoPartComponent&gt;&gt;&gt;
            {
                Success = true,
                Data = result
            };
        }
        catch (Exception ex)
        {
            return new Model_Dao_Result&lt;Dictionary&lt;string, List&lt;Model_VolvoPartComponent&gt;&gt;&gt;
            {
                Success = false,
                ErrorMessage = $&quot;Error retrieving components batch: {ex.Message}&quot;,
                Severity = Enum_ErrorSeverity.Error,
                Exception = ex
            };
        }
    }

    private static Model_VolvoPartComponent MapFromReader(IDataReader reader)
    {
        return new Model_VolvoPartComponent
        {
            ComponentPartNumber = reader.GetString(reader.GetOrdinal(&quot;component_part_number&quot;)),
            Quantity = reader.GetInt32(reader.GetOrdinal(&quot;quantity&quot;)),
            ComponentQuantityPerSkid = reader.GetInt32(reader.GetOrdinal(&quot;component_quantity_per_skid&quot;))
        };
    }
}</file><file path="Module_Volvo/ViewModels/ViewModel_Volvo_Settings.cs">using System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using System.Windows.Input;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Volvo.Contracts;
using MTM_Receiving_Application.Module_Volvo.Models;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using Windows.Storage;
using Windows.Storage.Pickers;

namespace MTM_Receiving_Application.Module_Volvo.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Volvo master data settings (parts catalog management)
/// &lt;/summary&gt;
public partial class ViewModel_Volvo_Settings : ViewModel_Shared_Base
{
    private readonly IService_VolvoMasterData _masterDataService;

    [ObservableProperty]
    private ObservableCollection&lt;Model_VolvoPart&gt; _parts = new();

    [ObservableProperty]
    private Model_VolvoPart? _selectedPart;

    [ObservableProperty]
    private bool _showInactive = false;

    [ObservableProperty]
    private int _totalPartsCount;

    [ObservableProperty]
    private int _activePartsCount;

    public ViewModel_Volvo_Settings(
        IService_VolvoMasterData masterDataService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger)
        : base(errorHandler, logger)
    {
        _masterDataService = masterDataService ?? throw new ArgumentNullException(nameof(masterDataService));
    }

    [RelayCommand]
    private async Task RefreshAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading parts catalog...&quot;;

            var result = await _masterDataService.GetAllPartsAsync(ShowInactive);

            if (result.IsSuccess &amp;&amp; result.Data != null)
            {
                Parts.Clear();
                foreach (var part in result.Data.OrderBy(p =&gt; p.PartNumber))
                {
                    Parts.Add(part);
                }

                TotalPartsCount = Parts.Count;
                ActivePartsCount = Parts.Count(p =&gt; p.IsActive);
                StatusMessage = $&quot;Loaded {ActivePartsCount} active parts (Total: {TotalPartsCount})&quot;;
            }
            else
            {
                await _errorHandler.ShowUserErrorAsync(
                    result.ErrorMessage ?? &quot;Failed to load parts catalog&quot;,
                    &quot;Load Error&quot;,
                    nameof(RefreshAsync));
                StatusMessage = &quot;Failed to load parts&quot;;
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Module_Core.Models.Enums.Enum_ErrorSeverity.Medium,
                nameof(RefreshAsync),
                nameof(ViewModel_Volvo_Settings));
            StatusMessage = &quot;Error loading parts&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }

    [RelayCommand]
    private async Task AddPartAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            StatusMessage = &quot;Opening add part dialog...&quot;;

            var dialog = new Views.VolvoPartAddEditDialog();
            dialog.InitializeForAdd();

            var windowService = App.GetService&lt;IService_Window&gt;();
            if (windowService != null)
            {
                dialog.XamlRoot = windowService.GetXamlRoot();
            }

            var result = await dialog.ShowAsync();

            if (result == ContentDialogResult.Primary &amp;&amp; dialog.Part != null)
            {
                IsBusy = true;
                StatusMessage = $&quot;Adding part {dialog.Part.PartNumber}...&quot;;

                // No components for now (simplified version)
                var saveResult = await _masterDataService.AddPartAsync(dialog.Part, new System.Collections.Generic.List&lt;Model_VolvoPartComponent&gt;());

                if (saveResult.IsSuccess)
                {
                    StatusMessage = $&quot;Part {dialog.Part.PartNumber} added successfully&quot;;
                    await RefreshAsync();
                }
                else
                {
                    await _errorHandler.ShowUserErrorAsync(
                        saveResult.ErrorMessage ?? &quot;Failed to add part&quot;,
                        &quot;Add Error&quot;,
                        nameof(AddPartAsync));
                    StatusMessage = &quot;Failed to add part&quot;;
                }

                IsBusy = false;
            }
            else
            {
                StatusMessage = &quot;Add part cancelled&quot;;
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Module_Core.Models.Enums.Enum_ErrorSeverity.Medium,
                nameof(AddPartAsync),
                nameof(ViewModel_Volvo_Settings));
            StatusMessage = &quot;Error adding part&quot;;
        }
    }

    [RelayCommand(CanExecute = nameof(CanEditPart))]
    private async Task EditPartAsync()
    {
        if (IsBusy || SelectedPart == null)
        {
            return;
        }

        try
        {
            StatusMessage = $&quot;Opening edit dialog for {SelectedPart.PartNumber}...&quot;;

            var dialog = new Views.VolvoPartAddEditDialog();
            dialog.InitializeForEdit(SelectedPart);

            var windowService = App.GetService&lt;IService_Window&gt;();
            if (windowService != null)
            {
                dialog.XamlRoot = windowService.GetXamlRoot();
            }

            var result = await dialog.ShowAsync();

            if (result == ContentDialogResult.Primary &amp;&amp; dialog.Part != null)
            {
                IsBusy = true;
                StatusMessage = $&quot;Updating part {dialog.Part.PartNumber}...&quot;;

                // No components for now (simplified version)
                var saveResult = await _masterDataService.UpdatePartAsync(dialog.Part, new System.Collections.Generic.List&lt;Model_VolvoPartComponent&gt;());

                if (saveResult.IsSuccess)
                {
                    StatusMessage = $&quot;Part {dialog.Part.PartNumber} updated successfully&quot;;
                    await RefreshAsync();
                }
                else
                {
                    await _errorHandler.ShowUserErrorAsync(
                        saveResult.ErrorMessage ?? &quot;Failed to update part&quot;,
                        &quot;Update Error&quot;,
                        nameof(EditPartAsync));
                    StatusMessage = &quot;Failed to update part&quot;;
                }

                IsBusy = false;
            }
            else
            {
                StatusMessage = &quot;Edit cancelled&quot;;
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Module_Core.Models.Enums.Enum_ErrorSeverity.Medium,
                nameof(EditPartAsync),
                nameof(ViewModel_Volvo_Settings));
            StatusMessage = &quot;Error editing part&quot;;
        }
    }

    private bool CanEditPart() =&gt; SelectedPart != null &amp;&amp; !IsBusy;

    [RelayCommand(CanExecute = nameof(CanDeactivatePart))]
    private async Task DeactivatePartAsync()
    {
        if (IsBusy || SelectedPart == null)
        {
            return;
        }

        try
        {
            // Confirmation dialog
            var dialog = new ContentDialog
            {
                Title = &quot;Deactivate Part&quot;,
                Content = $&quot;Are you sure you want to deactivate part {SelectedPart.PartNumber}?\n\n&quot; +
                          &quot;This will hide the part from active lists, but it will remain in historical shipments.&quot;,
                PrimaryButtonText = &quot;Deactivate&quot;,
                CloseButtonText = &quot;Cancel&quot;,
                DefaultButton = ContentDialogButton.Close
            };

            // Get XamlRoot from service
            var windowService = App.GetService&lt;IService_Window&gt;();
            if (windowService != null)
            {
                dialog.XamlRoot = windowService.GetXamlRoot();
            }

            var result = await dialog.ShowAsync();

            if (result == ContentDialogResult.Primary)
            {
                IsBusy = true;
                StatusMessage = $&quot;Deactivating part {SelectedPart.PartNumber}...&quot;;

                var deactivateResult = await _masterDataService.DeactivatePartAsync(SelectedPart.PartNumber);

                if (deactivateResult.IsSuccess)
                {
                    StatusMessage = $&quot;Part {SelectedPart.PartNumber} deactivated&quot;;
                    await RefreshAsync();
                }
                else
                {
                    await _errorHandler.ShowUserErrorAsync(
                        deactivateResult.ErrorMessage ?? &quot;Failed to deactivate part&quot;,
                        &quot;Deactivate Error&quot;,
                        nameof(DeactivatePartAsync));
                    StatusMessage = &quot;Failed to deactivate part&quot;;
                }

                IsBusy = false;
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Module_Core.Models.Enums.Enum_ErrorSeverity.Medium,
                nameof(DeactivatePartAsync),
                nameof(ViewModel_Volvo_Settings));
            IsBusy = false;
        }
    }

    private bool CanDeactivatePart() =&gt; SelectedPart?.IsActive == true &amp;&amp; !IsBusy;

    [RelayCommand(CanExecute = nameof(CanViewComponents))]
    private async Task ViewComponentsAsync()
    {
        if (IsBusy || SelectedPart == null)
        {
            return;
        }

        try
        {
            StatusMessage = $&quot;Loading components for {SelectedPart.PartNumber}...&quot;;

            var result = await _masterDataService.GetComponentsAsync(SelectedPart.PartNumber);

            if (result.IsSuccess &amp;&amp; result.Data != null)
            {
                var componentsList = result.Data.Count &gt; 0
                    ? string.Join(&quot;\n&quot;, result.Data.Select(c =&gt; $&quot; {c.ComponentPartNumber} (Qty: {c.Quantity})&quot;))
                    : &quot;No components defined&quot;;

                var dialog = new ContentDialog
                {
                    Title = $&quot;Components for {SelectedPart.PartNumber}&quot;,
                    Content = componentsList,
                    CloseButtonText = &quot;Close&quot;
                };

                var windowService = App.GetService&lt;IService_Window&gt;();
                if (windowService != null)
                {
                    dialog.XamlRoot = windowService.GetXamlRoot();
                }

                await dialog.ShowAsync();
                StatusMessage = $&quot;Showing {result.Data.Count} components&quot;;
            }
            else
            {
                await _errorHandler.ShowUserErrorAsync(
                    result.ErrorMessage ?? &quot;Failed to load components&quot;,
                    &quot;Load Error&quot;,
                    nameof(ViewComponentsAsync));
                StatusMessage = &quot;Failed to load components&quot;;
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Module_Core.Models.Enums.Enum_ErrorSeverity.Low,
                nameof(ViewComponentsAsync),
                nameof(ViewModel_Volvo_Settings));
        }
    }

    private bool CanViewComponents() =&gt; SelectedPart != null &amp;&amp; !IsBusy;

    [RelayCommand]
    private async Task ImportCsvAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            // File picker
            var picker = new FileOpenPicker();
            picker.FileTypeFilter.Add(&quot;.csv&quot;);
            picker.SuggestedStartLocation = PickerLocationId.DocumentsLibrary;

            // Get window handle
            var hwnd = WinRT.Interop.WindowNative.GetWindowHandle(App.MainWindow);
            WinRT.Interop.InitializeWithWindow.Initialize(picker, hwnd);

            var file = await picker.PickSingleFileAsync();
            if (file == null)
            {
                return;
            }

            IsBusy = true;
            StatusMessage = &quot;Importing CSV...&quot;;

            var csvContent = await FileIO.ReadTextAsync(file);
            var result = await _masterDataService.ImportCsvAsync(csvContent);

            if (result.IsSuccess)
            {
                var (newCount, updatedCount, unchangedCount) = result.Data;
                var summary = $&quot;Import complete: {newCount} new, {updatedCount} updated, {unchangedCount} unchanged&quot;;
                StatusMessage = summary;
                await RefreshAsync();

                // Show summary dialog
                var dialog = new ContentDialog
                {
                    Title = &quot;Import Complete&quot;,
                    Content = summary,
                    CloseButtonText = &quot;OK&quot;
                };

                var windowService = App.GetService&lt;IService_Window&gt;();
                if (windowService != null)
                {
                    dialog.XamlRoot = windowService.GetXamlRoot();
                }

                await dialog.ShowAsync();
            }
            else
            {
                await _errorHandler.ShowUserErrorAsync(
                    result.ErrorMessage ?? &quot;Failed to import CSV&quot;,
                    &quot;Import Error&quot;,
                    nameof(ImportCsvAsync));
                StatusMessage = &quot;Import failed&quot;;
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Module_Core.Models.Enums.Enum_ErrorSeverity.Medium,
                nameof(ImportCsvAsync),
                nameof(ViewModel_Volvo_Settings));
            StatusMessage = &quot;Error importing CSV&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }

    [RelayCommand]
    private async Task ExportCsvAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            // File picker
            var picker = new FileSavePicker();
            picker.FileTypeChoices.Add(&quot;CSV File&quot;, new[] { &quot;.csv&quot; });
            picker.SuggestedFileName = $&quot;volvo_parts_{DateTime.Now:yyyyMMdd}.csv&quot;;
            picker.SuggestedStartLocation = PickerLocationId.DocumentsLibrary;

            // Get window handle
            var hwnd = WinRT.Interop.WindowNative.GetWindowHandle(App.MainWindow);
            WinRT.Interop.InitializeWithWindow.Initialize(picker, hwnd);

            var file = await picker.PickSaveFileAsync();
            if (file == null)
            {
                return;
            }

            IsBusy = true;
            StatusMessage = &quot;Exporting to CSV...&quot;;

            var result = await _masterDataService.ExportCsvAsync(file.Path, ShowInactive);

            if (result.IsSuccess &amp;&amp; result.Data != null)
            {
                await FileIO.WriteTextAsync(file, result.Data);
                StatusMessage = $&quot;Exported to {file.Path}&quot;;
            }
            else
            {
                await _errorHandler.ShowUserErrorAsync(
                    result.ErrorMessage ?? &quot;Failed to export CSV&quot;,
                    &quot;Export Error&quot;,
                    nameof(ExportCsvAsync));
                StatusMessage = &quot;Export failed&quot;;
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Module_Core.Models.Enums.Enum_ErrorSeverity.Medium,
                nameof(ExportCsvAsync),
                nameof(ViewModel_Volvo_Settings));
            StatusMessage = &quot;Error exporting CSV&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }

    partial void OnShowInactiveChanged(bool value)
    {
        // Refresh when toggle changes
        _ = RefreshAsync();
    }

    partial void OnSelectedPartChanged(Model_VolvoPart? value)
    {
        // Notify commands that depend on selection
        EditPartCommand.NotifyCanExecuteChanged();
        DeactivatePartCommand.NotifyCanExecuteChanged();
        ViewComponentsCommand.NotifyCanExecuteChanged();
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Core/Data/Authentication/Dao_User_Tests.cs">using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Data.Authentication;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Models.Systems;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Core.Data.Authentication
{
    /// &lt;summary&gt;
    /// Unit tests for Dao_User data access object.
    /// Tests authentication, CRUD operations, validation, and configuration methods.
    /// &lt;/summary&gt;
    public class Dao_User_Tests
    {
        private static string TestConnectionString =&gt;
            Helper_Database_Variables.GetConnectionString(useProduction: false);

        // ====================================================================
        // Constructor Tests
        // ====================================================================

        [Fact]
        public void Constructor_ValidConnectionString_CreatesInstance()
        {
            // Act
            var dao = new Dao_User(TestConnectionString);

            // Assert
            dao.Should().NotBeNull();
        }

        [Fact]
        public void Constructor_NullConnectionString_ThrowsArgumentNullException()
        {
            // Act
            Action act = () =&gt; new Dao_User(null!);

            // Assert
            act.Should().Throw&lt;ArgumentNullException&gt;().WithMessage(&quot;*connectionString*&quot;);
        }

        [Fact]
        public void Constructor_EmptyConnectionString_DoesNotThrow()
        {
            // Act
            Action act = () =&gt; new Dao_User(string.Empty);

            // Assert - Constructor doesn&apos;t validate empty strings, only null
            act.Should().NotThrow();
        }

        // ====================================================================
        // GetUserByWindowsUsernameAsync Tests
        // ====================================================================

        [Fact]
        public async Task GetUserByWindowsUsernameAsync_ValidUsername_CallsStoredProcedure_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var username = &quot;jdoe&quot;;

            // Act &amp; Assert
            // Note: This will fail without a real database connection
            // In a real test environment, you would use a test database or mock the Helper class
            var result = await dao.GetUserByWindowsUsernameAsync(username);

            // Basic assertion - detailed testing requires database/mocking infrastructure
            result.Should().NotBeNull();
        }

        [Theory]
        [InlineData(&quot;&quot;)]
        [InlineData(&quot;   &quot;)]
        [InlineData(&quot;valid_user&quot;)]
        [InlineData(&quot;UPPERCASE_USER&quot;)]
        public async Task GetUserByWindowsUsernameAsync_VariousUsernames_AcceptsInput_Async(
            string username
        )
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);

            // Act
            var result = await dao.GetUserByWindowsUsernameAsync(username);

            // Assert
            result.Should().NotBeNull();
        }

        // ====================================================================
        // ValidateUserPinAsync Tests
        // ====================================================================

        [Fact]
        public async Task ValidateUserPinAsync_ValidCredentials_CallsStoredProcedure_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var username = &quot;jdoe&quot;;
            var pin = &quot;1234&quot;;

            // Act
            var result = await dao.ValidateUserPinAsync(username, pin);

            // Assert
            result.Should().NotBeNull();
        }

        [Theory]
        [InlineData(&quot;user&quot;, &quot;0000&quot;)]
        [InlineData(&quot;user&quot;, &quot;9999&quot;)]
        [InlineData(&quot;user&quot;, &quot;1234&quot;)]
        [InlineData(&quot;&quot;, &quot;1234&quot;)]
        [InlineData(&quot;user&quot;, &quot;&quot;)]
        public async Task ValidateUserPinAsync_VariousInputs_AcceptsAllCombinations_Async(
            string username,
            string pin
        )
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);

            // Act
            var result = await dao.ValidateUserPinAsync(username, pin);

            // Assert
            result.Should().NotBeNull();
        }

        // ====================================================================
        // CreateNewUserAsync Tests
        // ====================================================================

        [Fact]
        public async Task CreateNewUserAsync_ValidUser_ReturnsEmployeeNumber_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var user = CreateValidTestUser();
            var createdBy = &quot;admin&quot;;

            // Act
            var result = await dao.CreateNewUserAsync(user, createdBy);

            // Assert
            result.Should().NotBeNull();
            // Success depends on database availability and stored procedure existence
        }

        [Fact]
        public async Task CreateNewUserAsync_NullVisualCredentials_HandlesGracefully_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var user = CreateValidTestUser();
            user.VisualUsername = null;
            user.VisualPassword = null;
            var createdBy = &quot;admin&quot;;

            // Act
            var result = await dao.CreateNewUserAsync(user, createdBy);

            // Assert
            result.Should().NotBeNull();
        }

        [Fact]
        public async Task CreateNewUserAsync_WithVisualCredentials_PassesParameters_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var user = CreateValidTestUser();
            user.VisualUsername = &quot;visual_user&quot;;
            user.VisualPassword = &quot;visual_pass&quot;;
            var createdBy = &quot;admin&quot;;

            // Act
            var result = await dao.CreateNewUserAsync(user, createdBy);

            // Assert
            result.Should().NotBeNull();
        }

        // ====================================================================
        // IsWindowsUsernameUniqueAsync Tests
        // ====================================================================

        [Fact]
        public async Task IsWindowsUsernameUniqueAsync_WithoutExclusion_ChecksAllUsers_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var username = &quot;new_user&quot;;

            // Act
            var result = await dao.IsWindowsUsernameUniqueAsync(username);

            // Assert
            result.Should().NotBeNull();
        }

        [Fact]
        public async Task IsWindowsUsernameUniqueAsync_WithExclusion_ExcludesSpecificEmployee_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var username = &quot;existing_user&quot;;
            var excludeEmployeeNumber = 12345;

            // Act
            var result = await dao.IsWindowsUsernameUniqueAsync(username, excludeEmployeeNumber);

            // Assert
            result.Should().NotBeNull();
        }

        [Theory]
        [InlineData(&quot;user1&quot;, null)]
        [InlineData(&quot;user2&quot;, 100)]
        [InlineData(&quot;user3&quot;, 999)]
        [InlineData(&quot;&quot;, null)]
        public async Task IsWindowsUsernameUniqueAsync_VariousScenarios_HandlesAllCases_Async(
            string username,
            int? excludeId
        )
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);

            // Act
            var result = await dao.IsWindowsUsernameUniqueAsync(username, excludeId);

            // Assert
            result.Should().NotBeNull();
        }

        // ====================================================================
        // LogUserActivityAsync Tests
        // ====================================================================

        [Fact]
        public async Task LogUserActivityAsync_ValidData_LogsActivity_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var eventType = &quot;login_success&quot;;
            var username = &quot;jdoe&quot;;
            var workstation = &quot;WORKSTATION-01&quot;;
            var details = &quot;Successful login&quot;;

            // Act
            var result = await dao.LogUserActivityAsync(eventType, username, workstation, details);

            // Assert
            result.Should().NotBeNull();
        }

        [Theory]
        [InlineData(&quot;login_success&quot;, &quot;user&quot;, &quot;WS01&quot;, &quot;Details&quot;)]
        [InlineData(&quot;login_failed&quot;, &quot;user&quot;, &quot;WS02&quot;, &quot;Failed attempt&quot;)]
        [InlineData(&quot;session_timeout&quot;, &quot;user&quot;, &quot;WS03&quot;, &quot;Timeout&quot;)]
        [InlineData(&quot;user_created&quot;, &quot;admin&quot;, &quot;WS04&quot;, &quot;New user&quot;)]
        public async Task LogUserActivityAsync_DifferentEventTypes_LogsCorrectly_Async(
            string eventType,
            string username,
            string workstation,
            string details
        )
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);

            // Act
            var result = await dao.LogUserActivityAsync(eventType, username, workstation, details);

            // Assert
            result.Should().NotBeNull();
        }

        [Fact]
        public async Task LogUserActivityAsync_NullParameters_HandlesGracefully_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);

            // Act
            var result = await dao.LogUserActivityAsync(&quot;event&quot;, null!, null!, null!);

            // Assert
            result.Should().NotBeNull();
        }

        // ====================================================================
        // GetSharedTerminalNamesAsync Tests
        // ====================================================================

        [Fact]
        public async Task GetSharedTerminalNamesAsync_NoParameters_ReturnsTerminalList_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);

            // Act
            var result = await dao.GetSharedTerminalNamesAsync();

            // Assert
            result.Should().NotBeNull();
        }

        // ====================================================================
        // UpsertWorkstationConfigAsync Tests
        // ====================================================================

        [Fact]
        public async Task UpsertWorkstationConfigAsync_ValidData_InsertsOrUpdates_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var workstationName = &quot;WORKSTATION-01&quot;;
            var workstationType = &quot;shared&quot;;
            var isActive = true;
            var description = &quot;Shared terminal in warehouse&quot;;

            // Act
            var result = await dao.UpsertWorkstationConfigAsync(
                workstationName,
                workstationType,
                isActive,
                description
            );

            // Assert
            result.Should().NotBeNull();
        }

        [Fact]
        public async Task UpsertWorkstationConfigAsync_NullDescription_HandlesGracefully_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);

            // Act
            var result = await dao.UpsertWorkstationConfigAsync(&quot;WS-01&quot;, &quot;dedicated&quot;, true, null);

            // Assert
            result.Should().NotBeNull();
        }

        [Theory]
        [InlineData(&quot;WS-01&quot;, &quot;shared&quot;, true, &quot;Description 1&quot;)]
        [InlineData(&quot;WS-02&quot;, &quot;dedicated&quot;, false, &quot;Description 2&quot;)]
        [InlineData(&quot;WS-03&quot;, &quot;shared&quot;, true, null)]
        public async Task UpsertWorkstationConfigAsync_VariousConfigurations_HandlesAll_Async(
            string name,
            string type,
            bool active,
            string? description
        )
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);

            // Act
            var result = await dao.UpsertWorkstationConfigAsync(name, type, active, description);

            // Assert
            result.Should().NotBeNull();
        }

        // ====================================================================
        // GetActiveDepartmentsAsync Tests
        // ====================================================================

        [Fact]
        public async Task GetActiveDepartmentsAsync_NoParameters_ReturnsDepartmentList_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);

            // Act
            var result = await dao.GetActiveDepartmentsAsync();

            // Assert
            result.Should().NotBeNull();
        }

        // ====================================================================
        // UpdateDefaultModeAsync Tests
        // ====================================================================

        [Fact]
        public async Task UpdateDefaultModeAsync_ValidData_UpdatesMode_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var userId = 12345;
            var defaultMode = &quot;guided&quot;;

            // Act
            var result = await dao.UpdateDefaultModeAsync(userId, defaultMode);

            // Assert
            result.Should().NotBeNull();
        }

        [Fact]
        public async Task UpdateDefaultModeAsync_NullMode_HandlesGracefully_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var userId = 12345;

            // Act
            var result = await dao.UpdateDefaultModeAsync(userId, null);

            // Assert
            result.Should().NotBeNull();
        }

        [Theory]
        [InlineData(100, &quot;guided&quot;)]
        [InlineData(200, &quot;manual&quot;)]
        [InlineData(300, null)]
        public async Task UpdateDefaultModeAsync_VariousInputs_HandlesAll_Async(int userId, string? mode)
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);

            // Act
            var result = await dao.UpdateDefaultModeAsync(userId, mode);

            // Assert
            result.Should().NotBeNull();
        }

        // ====================================================================
        // UpdateDefaultReceivingModeAsync Tests
        // ====================================================================

        [Fact]
        public async Task UpdateDefaultReceivingModeAsync_ValidData_UpdatesMode_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var userId = 12345;
            var defaultMode = &quot;guided&quot;;

            // Act
            var result = await dao.UpdateDefaultReceivingModeAsync(userId, defaultMode);

            // Assert
            result.Should().NotBeNull();
        }

        [Theory]
        [InlineData(100, &quot;guided&quot;)]
        [InlineData(200, &quot;manual&quot;)]
        [InlineData(300, &quot;edit&quot;)]
        [InlineData(400, null)]
        public async Task UpdateDefaultReceivingModeAsync_DifferentModes_HandlesAll_Async(
            int userId,
            string? mode
        )
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);

            // Act
            var result = await dao.UpdateDefaultReceivingModeAsync(userId, mode);

            // Assert
            result.Should().NotBeNull();
        }

        // ====================================================================
        // UpdateDefaultDunnageModeAsync Tests
        // ====================================================================

        [Fact]
        public async Task UpdateDefaultDunnageModeAsync_ValidData_UpdatesMode_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var userId = 12345;
            var defaultMode = &quot;guided&quot;;

            // Act
            var result = await dao.UpdateDefaultDunnageModeAsync(userId, defaultMode);

            // Assert
            result.Should().NotBeNull();
        }

        [Theory]
        [InlineData(100, &quot;standard&quot;)]
        [InlineData(200, &quot;quick&quot;)]
        [InlineData(300, null)]
        public async Task UpdateDefaultDunnageModeAsync_VariousModes_HandlesAll_Async(
            int userId,
            string? mode
        )
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);

            // Act
            var result = await dao.UpdateDefaultDunnageModeAsync(userId, mode);

            // Assert
            result.Should().NotBeNull();
        }

        // ====================================================================
        // Edge Cases and Error Handling Tests
        // ====================================================================

        [Fact]
        public async Task GetUserByWindowsUsernameAsync_EmptyString_DoesNotThrow_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);

            // Act
            Func&lt;Task&gt; act = async () =&gt; await dao.GetUserByWindowsUsernameAsync(string.Empty);

            // Assert
            await act.Should().NotThrowAsync();
        }

        [Fact]
        public async Task ValidateUserPinAsync_SpecialCharactersInUsername_HandlesGracefully_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var username = &quot;user@domain.com&quot;;
            var pin = &quot;1234&quot;;

            // Act
            Func&lt;Task&gt; act = async () =&gt; await dao.ValidateUserPinAsync(username, pin);

            // Assert
            await act.Should().NotThrowAsync();
        }

        [Fact]
        public async Task CreateNewUserAsync_AllFieldsPopulated_PassesAllParameters_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var user = new Model_User
            {
                EmployeeNumber = 99999,
                WindowsUsername = &quot;testuser&quot;,
                FullName = &quot;Test User&quot;,
                Pin = &quot;9999&quot;,
                Department = &quot;IT&quot;,
                Shift = &quot;Day&quot;,
                VisualUsername = &quot;visual_test&quot;,
                VisualPassword = &quot;visual_pass123&quot;,
                IsActive = true,
            };
            var createdBy = &quot;admin&quot;;

            // Act
            Func&lt;Task&gt; act = async () =&gt; await dao.CreateNewUserAsync(user, createdBy);

            // Assert
            await act.Should().NotThrowAsync();
        }

        [Fact]
        public async Task IsWindowsUsernameUniqueAsync_VeryLongUsername_HandlesGracefully_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var longUsername = new string(&apos;a&apos;, 500);

            // Act
            Func&lt;Task&gt; act = async () =&gt; await dao.IsWindowsUsernameUniqueAsync(longUsername);

            // Assert
            await act.Should().NotThrowAsync();
        }

        [Fact]
        public async Task LogUserActivityAsync_LongDetails_HandlesGracefully_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var longDetails = new string(&apos;x&apos;, 1000);

            // Act
            Func&lt;Task&gt; act = async () =&gt;
                await dao.LogUserActivityAsync(&quot;test_event&quot;, &quot;user&quot;, &quot;workstation&quot;, longDetails);

            // Assert
            await act.Should().NotThrowAsync();
        }

        [Fact]
        public async Task UpsertWorkstationConfigAsync_VeryLongDescription_HandlesGracefully_Async()
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);
            var longDescription = new string(&apos;d&apos;, 2000);

            // Act
            Func&lt;Task&gt; act = async () =&gt;
                await dao.UpsertWorkstationConfigAsync(&quot;WS-01&quot;, &quot;shared&quot;, true, longDescription);

            // Assert
            await act.Should().NotThrowAsync();
        }

        // ====================================================================
        // Boundary Value Tests
        // ====================================================================

        [Theory]
        [InlineData(0)]
        [InlineData(1)]
        [InlineData(int.MaxValue)]
        [InlineData(int.MinValue)]
        public async Task UpdateDefaultModeAsync_BoundaryUserIds_HandlesAll_Async(int userId)
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);

            // Act
            Func&lt;Task&gt; act = async () =&gt; await dao.UpdateDefaultModeAsync(userId, &quot;mode&quot;);

            // Assert
            await act.Should().NotThrowAsync();
        }

        [Theory]
        [InlineData(null)]
        [InlineData(0)]
        [InlineData(-1)]
        [InlineData(1)]
        [InlineData(int.MaxValue)]
        public async Task IsWindowsUsernameUniqueAsync_BoundaryExclusionValues_HandlesAll_Async(
            int? excludeId
        )
        {
            // Arrange
            var dao = new Dao_User(TestConnectionString);

            // Act
            Func&lt;Task&gt; act = async () =&gt; await dao.IsWindowsUsernameUniqueAsync(&quot;user&quot;, excludeId);

            // Assert
            await act.Should().NotThrowAsync();
        }

        // ====================================================================
        // Helper Methods
        // ====================================================================

        /// &lt;summary&gt;
        /// Creates a valid test user model with all required fields populated.
        /// &lt;/summary&gt;
        private static Model_User CreateValidTestUser()
        {
            return new Model_User
            {
                EmployeeNumber = 12345,
                WindowsUsername = &quot;testuser&quot;,
                FullName = &quot;Test User&quot;,
                Pin = &quot;1234&quot;,
                Department = &quot;Engineering&quot;,
                Shift = &quot;Day&quot;,
                IsActive = true,
            };
        }
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Dunnage/Data/Dao_DunnageLoad_Tests.cs">using FluentAssertions;
using Xunit;
using MTM_Receiving_Application.Module_Dunnage.Data;
using MTM_Receiving_Application.Module_Dunnage.Models;
using MTM_Receiving_Application.Module_Core.Helpers.Database;

namespace MTM_Receiving_Application.Tests.Unit.Module_Dunnage.Data;

/// &lt;summary&gt;
/// Unit tests for Dao_DunnageLoad data access object.
/// Tests CRUD operations, batch processing, and date range queries for dunnage loads.
/// Uses the mtm_receiving_application_test database.
/// &lt;/summary&gt;
public class Dao_DunnageLoad_Tests
{
    private static string TestConnectionString =&gt; Helper_Database_Variables.GetConnectionString(useProduction: false);

    // ====================================================================
    // Constructor Tests
    // ====================================================================

    [Fact]
    public void Constructor_ValidConnectionString_CreatesInstance()
    {
        // Act
        var dao = new Dao_DunnageLoad(TestConnectionString);

        // Assert
        dao.Should().NotBeNull();
    }

    [Fact]
    public void Constructor_NullConnectionString_DoesNotThrow()
    {
        // Act
        Action act = () =&gt; new Dao_DunnageLoad(null!);

        // Assert
        act.Should().NotThrow();
    }

    // ====================================================================
    // GetAllAsync Tests
    // ====================================================================

    [Fact]
    public async Task GetAllAsync_NoParameters_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);

        // Act
        var result = await dao.GetAllAsync();

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // GetByDateRangeAsync Tests
    // ====================================================================

    [Fact]
    public async Task GetByDateRangeAsync_ValidDateRange_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var startDate = DateTime.Now.AddDays(-30);
        var endDate = DateTime.Now;

        // Act
        var result = await dao.GetByDateRangeAsync(startDate, endDate);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task GetByDateRangeAsync_StartDateAfterEndDate_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var startDate = DateTime.Now;
        var endDate = DateTime.Now.AddDays(-30);

        // Act
        var result = await dao.GetByDateRangeAsync(startDate, endDate);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task GetByDateRangeAsync_SameDates_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var date = DateTime.Now;

        // Act
        var result = await dao.GetByDateRangeAsync(date, date);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task GetByDateRangeAsync_VeryOldDates_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var startDate = new DateTime(1900, 1, 1);
        var endDate = new DateTime(1900, 12, 31);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.GetByDateRangeAsync(startDate, endDate);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task GetByDateRangeAsync_FutureDates_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var startDate = DateTime.Now.AddYears(1);
        var endDate = DateTime.Now.AddYears(2);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.GetByDateRangeAsync(startDate, endDate);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task GetByDateRangeAsync_VeryLargeRange_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var startDate = DateTime.MinValue;
        var endDate = DateTime.MaxValue;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.GetByDateRangeAsync(startDate, endDate);

        // Assert
        await act.Should().NotThrowAsync();
    }

    // ====================================================================
    // GetByIdAsync Tests
    // ====================================================================

    [Fact]
    public async Task GetByIdAsync_ValidGuid_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.NewGuid();

        // Act
        var result = await dao.GetByIdAsync(loadUuid);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task GetByIdAsync_EmptyGuid_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.Empty;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.GetByIdAsync(loadUuid);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task GetByIdAsync_DifferentGuids_HandlesAll_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);

        // Act &amp; Assert
        for (int i = 0; i &lt; 5; i++)
        {
            var guid = Guid.NewGuid();
            Func&lt;Task&gt; act = async () =&gt; await dao.GetByIdAsync(guid);
            await act.Should().NotThrowAsync();
        }
    }

    // ====================================================================
    // InsertAsync Tests
    // ====================================================================

    [Fact]
    public async Task InsertAsync_ValidParameters_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.NewGuid();
        var partId = &quot;DUNNAGE-001&quot;;
        var quantity = 100.5m;
        var user = &quot;testuser&quot;;

        // Act
        var result = await dao.InsertAsync(loadUuid, partId, quantity, user);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(&quot;PART-001&quot;, 100.0)]
    [InlineData(&quot;DUNNAGE-123&quot;, 50.5)]
    [InlineData(&quot;SKD-456&quot;, 1000.99)]
    public async Task InsertAsync_DifferentParts_HandlesAll_Async(string partId, decimal quantity)
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.NewGuid();
        var user = &quot;testuser&quot;;

        // Act
        var result = await dao.InsertAsync(loadUuid, partId, quantity, user);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(0.0)]
    [InlineData(0.001)]
    [InlineData(1.0)]
    [InlineData(999999.99)]
    public async Task InsertAsync_DifferentQuantities_HandlesAll_Async(decimal quantity)
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.NewGuid();
        var partId = &quot;PART-001&quot;;
        var user = &quot;testuser&quot;;

        // Act
        var result = await dao.InsertAsync(loadUuid, partId, quantity, user);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(&quot;user1&quot;)]
    [InlineData(&quot;admin&quot;)]
    [InlineData(&quot;testuser&quot;)]
    [InlineData(&quot;&quot;)]
    public async Task InsertAsync_DifferentUsers_HandlesAll_Async(string user)
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.NewGuid();
        var partId = &quot;PART-001&quot;;
        var quantity = 100m;

        // Act
        var result = await dao.InsertAsync(loadUuid, partId, quantity, user);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // InsertBatchAsync Tests
    // ====================================================================

    [Fact]
    public async Task InsertBatchAsync_ValidSingleLoad_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loads = new List&lt;Model_DunnageLoad&gt; { CreateValidDunnageLoad() };
        var user = &quot;testuser&quot;;

        // Act
        var result = await dao.InsertBatchAsync(loads, user);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task InsertBatchAsync_MultipleLoads_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loads = new List&lt;Model_DunnageLoad&gt;
        {
            CreateValidDunnageLoad(),
            CreateValidDunnageLoad(),
            CreateValidDunnageLoad()
        };
        var user = &quot;testuser&quot;;

        // Act
        var result = await dao.InsertBatchAsync(loads, user);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(1)]
    [InlineData(5)]
    [InlineData(10)]
    [InlineData(50)]
    public async Task InsertBatchAsync_VariousBatchSizes_HandlesAll_Async(int batchSize)
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loads = new List&lt;Model_DunnageLoad&gt;();
        for (int i = 0; i &lt; batchSize; i++)
        {
            loads.Add(CreateValidDunnageLoad());
        }
        var user = &quot;testuser&quot;;

        // Act
        var result = await dao.InsertBatchAsync(loads, user);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // UpdateAsync Tests
    // ====================================================================

    [Fact]
    public async Task UpdateAsync_ValidParameters_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.NewGuid();
        var quantity = 150.5m;
        var user = &quot;testuser&quot;;

        // Act
        var result = await dao.UpdateAsync(loadUuid, quantity, user);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(0.0)]
    [InlineData(0.001)]
    [InlineData(100.5)]
    [InlineData(9999.99)]
    public async Task UpdateAsync_DifferentQuantities_HandlesAll_Async(decimal quantity)
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.NewGuid();
        var user = &quot;testuser&quot;;

        // Act
        var result = await dao.UpdateAsync(loadUuid, quantity, user);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task UpdateAsync_EmptyGuid_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.Empty;
        var quantity = 100m;
        var user = &quot;testuser&quot;;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.UpdateAsync(loadUuid, quantity, user);

        // Assert
        await act.Should().NotThrowAsync();
    }

    // ====================================================================
    // DeleteAsync Tests
    // ====================================================================

    [Fact]
    public async Task DeleteAsync_ValidGuid_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.NewGuid();

        // Act
        var result = await dao.DeleteAsync(loadUuid);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task DeleteAsync_EmptyGuid_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.Empty;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.DeleteAsync(loadUuid);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task DeleteAsync_MultipleDeletes_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);

        // Act &amp; Assert
        for (int i = 0; i &lt; 5; i++)
        {
            var guid = Guid.NewGuid();
            Func&lt;Task&gt; act = async () =&gt; await dao.DeleteAsync(guid);
            await act.Should().NotThrowAsync();
        }
    }

    // ====================================================================
    // Edge Cases and Boundary Value Tests
    // ====================================================================

    [Fact]
    public async Task InsertAsync_VeryLongPartId_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.NewGuid();
        var partId = new string(&apos;P&apos;, 500);
        var quantity = 100m;
        var user = &quot;testuser&quot;;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertAsync(loadUuid, partId, quantity, user);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertAsync_VeryLongUsername_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.NewGuid();
        var partId = &quot;PART-001&quot;;
        var quantity = 100m;
        var user = new string(&apos;U&apos;, 500);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertAsync(loadUuid, partId, quantity, user);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertAsync_SpecialCharactersInPartId_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.NewGuid();
        var partId = &quot;PART-@#$%^&amp;*()&quot;;
        var quantity = 100m;
        var user = &quot;testuser&quot;;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertAsync(loadUuid, partId, quantity, user);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertAsync_NegativeQuantity_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.NewGuid();
        var partId = &quot;PART-001&quot;;
        var quantity = -100m;
        var user = &quot;testuser&quot;;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertAsync(loadUuid, partId, quantity, user);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertBatchAsync_EmptyList_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loads = new List&lt;Model_DunnageLoad&gt;();
        var user = &quot;testuser&quot;;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertBatchAsync(loads, user);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertBatchAsync_DuplicatePartIds_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var load = CreateValidDunnageLoad();
        var loads = new List&lt;Model_DunnageLoad&gt; { load, load, load };
        var user = &quot;testuser&quot;;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertBatchAsync(loads, user);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task UpdateAsync_VeryLargeQuantity_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.NewGuid();
        var quantity = decimal.MaxValue;
        var user = &quot;testuser&quot;;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.UpdateAsync(loadUuid, quantity, user);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task UpdateAsync_VerySmallQuantity_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_DunnageLoad(TestConnectionString);
        var loadUuid = Guid.NewGuid();
        var quantity = 0.000001m;
        var user = &quot;testuser&quot;;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.UpdateAsync(loadUuid, quantity, user);

        // Assert
        await act.Should().NotThrowAsync();
    }

    // ====================================================================
    // Helper Methods
    // ====================================================================

    /// &lt;summary&gt;
    /// Creates a valid test dunnage load with all required fields populated.
    /// &lt;/summary&gt;
    private static Model_DunnageLoad CreateValidDunnageLoad()
    {
        return new Model_DunnageLoad
        {
            LoadUuid = Guid.NewGuid(),
            PartId = &quot;DUNNAGE-001&quot;,
            Quantity = 100.5m,
            ReceivedDate = DateTime.Now,
            CreatedBy = &quot;testuser&quot;,
            CreatedDate = DateTime.Now,
            ModifiedBy = null,
            ModifiedDate = null
        };
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Data/Dao_ReceivingLine_Tests.cs">using FluentAssertions;
using Xunit;
using MTM_Receiving_Application.Module_Receiving.Data;
using MTM_Receiving_Application.Module_Receiving.Models;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Core.Helpers.Database;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Data;

/// &lt;summary&gt;
/// Unit tests for Dao_ReceivingLine data access object.
/// Tests constructor validation and parameter handling without requiring database connection.
/// NOTE: These are UNIT tests, not integration tests. Database operations are tested separately.
/// &lt;/summary&gt;
public class Dao_ReceivingLine_Tests
{
    private static string TestConnectionString =&gt; Helper_Database_Variables.GetConnectionString(useProduction: false);

    // ====================================================================
    // Constructor Tests
    // ====================================================================

    [Fact]
    public void Constructor_ValidConnectionString_CreatesInstance()
    {
        // Act
        var dao = new Dao_ReceivingLine(TestConnectionString);

        // Assert
        dao.Should().NotBeNull();
    }

    [Fact]
    public void Constructor_NullConnectionString_ThrowsArgumentNullException()
    {
        // Act
        Action act = () =&gt; new Dao_ReceivingLine(null!);

        // Assert
        act.Should().Throw&lt;ArgumentNullException&gt;()
            .WithParameterName(&quot;connectionString&quot;);
    }

    [Fact]
    public void Constructor_EmptyConnectionString_DoesNotThrow()
    {
        // NOTE: Constructor accepts empty string, but database operations will fail gracefully
        // Act
        Action act = () =&gt; new Dao_ReceivingLine(string.Empty);

        // Assert
        act.Should().NotThrow();
    }

    // ====================================================================
    // InsertReceivingLineAsync Tests - Database Connection Failures
    // ====================================================================

    [Fact]
    public async Task InsertReceivingLineAsync_InvalidConnectionString_ReturnsFailureResult_Async()
    {
        // Arrange - Use invalid connection string to simulate connection failure
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;Database=nonexistent;&quot;);
        var line = CreateValidReceivingLine();

        // Act
        var result = await dao.InsertReceivingLineAsync(line);

        // Assert - DAO MUST return failure result, NOT throw exception (Constitutional requirement)
        result.Should().NotBeNull();
        result.Success.Should().BeFalse(&quot;DAO must return failure result instead of throwing exception&quot;);
        result.ErrorMessage.Should().NotBeNullOrEmpty();
        result.Severity.Should().Be(Enum_ErrorSeverity.Error);
    }

    // ====================================================================
    // InsertReceivingLineAsync Tests - Parameter Handling
    // ====================================================================

    [Fact]
    public async Task InsertReceivingLineAsync_NullPartID_ReturnsResult_Async()
    {
        // Arrange - Invalid connection ensures we&apos;re testing parameter construction, not DB
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = CreateValidReceivingLine();
        line.PartID = null!;

        // Act
        var result = await dao.InsertReceivingLineAsync(line);

        // Assert - DAO handles null PartID by converting to empty string per implementation
        result.Should().NotBeNull();
        // Will fail due to connection, but that&apos;s expected - we&apos;re testing it doesn&apos;t throw
    }

    [Fact]
    public async Task InsertReceivingLineAsync_NullHeat_ReturnsResult_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = CreateValidReceivingLine();
        line.Heat = null!;

        // Act
        var result = await dao.InsertReceivingLineAsync(line);

        // Assert - DAO handles null Heat by converting to empty string per implementation
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task InsertReceivingLineAsync_NullInitialLocation_ReturnsResult_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = CreateValidReceivingLine();
        line.InitialLocation = null!;

        // Act
        var result = await dao.InsertReceivingLineAsync(line);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task InsertReceivingLineAsync_NullCoilsOnSkid_ReturnsResult_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = CreateValidReceivingLine();
        line.CoilsOnSkid = null;

        // Act
        var result = await dao.InsertReceivingLineAsync(line);

        // Assert - DAO handles null CoilsOnSkid by converting to DBNull.Value per implementation
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task InsertReceivingLineAsync_NullVendorName_ReturnsResult_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = CreateValidReceivingLine();
        line.VendorName = null!;

        // Act
        var result = await dao.InsertReceivingLineAsync(line);

        // Assert - DAO handles null VendorName by using &quot;Unknown&quot; per implementation
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task InsertReceivingLineAsync_NullPartDescription_ReturnsResult_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = CreateValidReceivingLine();
        line.PartDescription = null!;

        // Act
        var result = await dao.InsertReceivingLineAsync(line);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // InsertReceivingLineAsync Tests - Value Range Handling
    // ====================================================================

    [Theory]
    [InlineData(1)]
    [InlineData(100)]
    [InlineData(1000)]
    [InlineData(0)]
    [InlineData(-1)]
    public async Task InsertReceivingLineAsync_DifferentQuantities_HandlesAllValues_Async(int quantity)
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = CreateValidReceivingLine();
        line.Quantity = quantity;

        // Act
        var result = await dao.InsertReceivingLineAsync(line);

        // Assert - DAO accepts all quantity values (validation is Service layer responsibility)
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(0)]
    [InlineData(12345)]
    [InlineData(67890)]
    [InlineData(999999)]
    [InlineData(-1)]
    public async Task InsertReceivingLineAsync_DifferentPONumbers_HandlesAllValues_Async(int poNumber)
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = CreateValidReceivingLine();
        line.PONumber = poNumber;

        // Act
        var result = await dao.InsertReceivingLineAsync(line);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task InsertReceivingLineAsync_AllFieldsPopulated_DoesNotThrow_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = new Model_ReceivingLine
        {
            Quantity = 500,
            PartID = &quot;PART-12345&quot;,
            PONumber = 67890,
            EmployeeNumber = 1001,
            Heat = &quot;HEAT-ABC123&quot;,
            Date = DateTime.Now,
            InitialLocation = &quot;A-01-B&quot;,
            CoilsOnSkid = 10,
            VendorName = &quot;Acme Corp&quot;,
            PartDescription = &quot;Steel Coil 1.5mm x 48in&quot;
        };

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertReceivingLineAsync(line);

        // Assert - DAO must not throw exceptions (Constitutional requirement)
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertReceivingLineAsync_MinimalFields_DoesNotThrow_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = new Model_ReceivingLine
        {
            Quantity = 1,
            PONumber = 1,
            EmployeeNumber = 100,
            Date = DateTime.Now
        };

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertReceivingLineAsync(line);

        // Assert - DAO must not throw exceptions
        await act.Should().NotThrowAsync();
    }

    // ====================================================================
    // Edge Cases and Boundary Value Tests
    // ====================================================================

    [Fact]
    public async Task InsertReceivingLineAsync_VeryLongPartID_DoesNotThrow_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = CreateValidReceivingLine();
        line.PartID = new string(&apos;A&apos;, 500);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertReceivingLineAsync(line);

        // Assert - DAO passes value to DB, which will enforce length constraints
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertReceivingLineAsync_VeryLongHeat_DoesNotThrow_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = CreateValidReceivingLine();
        line.Heat = new string(&apos;H&apos;, 1000);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertReceivingLineAsync(line);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertReceivingLineAsync_VeryLongPartDescription_DoesNotThrow_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = CreateValidReceivingLine();
        line.PartDescription = new string(&apos;D&apos;, 2000);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertReceivingLineAsync(line);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertReceivingLineAsync_FutureDate_DoesNotThrow_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = CreateValidReceivingLine();
        line.Date = DateTime.Now.AddYears(1);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertReceivingLineAsync(line);

        // Assert - Date validation is business logic, DAO just passes it through
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertReceivingLineAsync_PastDate_DoesNotThrow_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = CreateValidReceivingLine();
        line.Date = DateTime.Now.AddYears(-10);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertReceivingLineAsync(line);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Theory]
    [InlineData(int.MinValue)]
    [InlineData(-1)]
    [InlineData(0)]
    [InlineData(1)]
    [InlineData(int.MaxValue)]
    public async Task InsertReceivingLineAsync_BoundaryCoilsOnSkid_DoesNotThrow_Async(int? coilsOnSkid)
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = CreateValidReceivingLine();
        line.CoilsOnSkid = coilsOnSkid;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertReceivingLineAsync(line);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Theory]
    [InlineData(int.MinValue)]
    [InlineData(-1000)]
    [InlineData(0)]
    [InlineData(1)]
    [InlineData(99999)]
    [InlineData(int.MaxValue)]
    public async Task InsertReceivingLineAsync_BoundaryEmployeeNumbers_DoesNotThrow_Async(int employeeNumber)
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = CreateValidReceivingLine();
        line.EmployeeNumber = employeeNumber;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertReceivingLineAsync(line);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertReceivingLineAsync_SpecialCharactersInFields_DoesNotThrow_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLine(&quot;Server=invalid;&quot;);
        var line = CreateValidReceivingLine();
        line.PartID = &quot;PART-@#$%^&amp;*()&quot;;
        line.Heat = &quot;HEAT-&lt;&gt;{}[]&quot;;
        line.VendorName = &quot;Vendor&apos;s \&quot;Company\&quot;&quot;;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertReceivingLineAsync(line);

        // Assert - DAO should pass special characters safely (parameterized queries prevent SQL injection)
        await act.Should().NotThrowAsync();
    }

    // ====================================================================
    // Constitutional Compliance Tests
    // ====================================================================

    [Fact]
    public async Task InsertReceivingLineAsync_DatabaseException_ReturnsFailureNotThrow_Async()
    {
        // Arrange - Empty connection string will cause connection failure
        var dao = new Dao_ReceivingLine(string.Empty);
        var line = CreateValidReceivingLine();

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertReceivingLineAsync(line);

        // Assert - CRITICAL: DAO MUST NOT throw exceptions per Constitutional Rule II
        await act.Should().NotThrowAsync(&quot;DAO must return failure result instead of throwing exception&quot;);

        var result = await dao.InsertReceivingLineAsync(line);
        result.Success.Should().BeFalse();
        result.ErrorMessage.Should().NotBeNullOrEmpty();
    }

    // ====================================================================
    // Helper Methods
    // ====================================================================

    /// &lt;summary&gt;
    /// Creates a valid test receiving line with all required fields populated.
    /// &lt;/summary&gt;
    private static Model_ReceivingLine CreateValidReceivingLine()
    {
        return new Model_ReceivingLine
        {
            Quantity = 100,
            PartID = &quot;PART-001&quot;,
            PONumber = 12345,
            EmployeeNumber = 1001,
            Heat = &quot;HEAT-123&quot;,
            Date = DateTime.Now,
            InitialLocation = &quot;A-01&quot;,
            CoilsOnSkid = 5,
            VendorName = &quot;Test Vendor&quot;,
            PartDescription = &quot;Test Part Description&quot;
        };
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Receiving/Data/Dao_ReceivingLoad_Tests.cs">using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Receiving.Data;
using MTM_Receiving_Application.Module_Receiving.Models;
using Xunit;

namespace MTM_Receiving_Application.Tests.Unit.Module_Receiving.Data;

/// &lt;summary&gt;
/// Unit tests for Dao_ReceivingLoad data access object.
/// Tests CRUD operations, transactions, and batch processing for receiving loads.
/// &lt;/summary&gt;
public class Dao_ReceivingLoad_Tests
{

    private static string TestConnectionString =&gt; Helper_Database_Variables.GetConnectionString(useProduction: false);

    // ====================================================================
    // Constructor Tests
    // ====================================================================

    [Fact]
    public void Constructor_ValidConnectionString_CreatesInstance()
    {
        // Act
        var dao = new Dao_ReceivingLoad(TestConnectionString);

        // Assert
        dao.Should().NotBeNull();
    }

    [Fact]
    public void Constructor_NullConnectionString_ThrowsArgumentNullException()
    {
        // Act
        Action act = () =&gt; new Dao_ReceivingLoad(null!);

        // Assert
        act.Should().Throw&lt;ArgumentNullException&gt;()
            .WithMessage(&quot;*connectionString*&quot;);
    }

    // ====================================================================
    // SaveLoadsAsync Tests
    // ====================================================================

    [Fact]
    public async Task SaveLoadsAsync_NullList_ReturnsFailure_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);

        // Act
        var result = await dao.SaveLoadsAsync(null!);

        // Assert
        result.Should().NotBeNull();
        result.Success.Should().BeFalse();
        result.ErrorMessage.Should().Contain(&quot;null or empty&quot;);
    }

    [Fact]
    public async Task SaveLoadsAsync_EmptyList_ReturnsFailure_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var loads = new List&lt;Model_ReceivingLoad&gt;();

        // Act
        var result = await dao.SaveLoadsAsync(loads);

        // Assert
        result.Should().NotBeNull();
        result.Success.Should().BeFalse();
        result.ErrorMessage.Should().Contain(&quot;null or empty&quot;);
    }

    [Fact]
    public async Task SaveLoadsAsync_ValidSingleLoad_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var loads = new List&lt;Model_ReceivingLoad&gt; { CreateValidLoad() };

        // Act
        var result = await dao.SaveLoadsAsync(loads);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task SaveLoadsAsync_MultipleValidLoads_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var loads = new List&lt;Model_ReceivingLoad&gt;
        {
            CreateValidLoad(),
            CreateValidLoad(),
            CreateValidLoad()
        };

        // Act
        var result = await dao.SaveLoadsAsync(loads);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task SaveLoadsAsync_NullPONumber_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var load = CreateValidLoad();
        load.PoNumber = null;
        var loads = new List&lt;Model_ReceivingLoad&gt; { load };

        // Act
        var result = await dao.SaveLoadsAsync(loads);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(&quot;PO-12345&quot;)]
    [InlineData(&quot;12345&quot;)]
    [InlineData(&quot;PO12345&quot;)]
    public async Task SaveLoadsAsync_CleansPONumberPrefix_HandlesAll_Async(string poNumber)
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var load = CreateValidLoad();
        load.PoNumber = poNumber;
        var loads = new List&lt;Model_ReceivingLoad&gt; { load };

        // Act
        var result = await dao.SaveLoadsAsync(loads);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task SaveLoadsAsync_NonPOItem_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var load = CreateValidLoad();
        load.IsNonPOItem = true;
        load.PoNumber = null;
        var loads = new List&lt;Model_ReceivingLoad&gt; { load };

        // Act
        var result = await dao.SaveLoadsAsync(loads);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // UpdateLoadsAsync Tests
    // ====================================================================

    [Fact]
    public async Task UpdateLoadsAsync_NullList_ReturnsFailure_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);

        // Act
        var result = await dao.UpdateLoadsAsync(null!);

        // Assert
        result.Should().NotBeNull();
        result.Success.Should().BeFalse();
        result.ErrorMessage.Should().Contain(&quot;null or empty&quot;);
    }

    [Fact]
    public async Task UpdateLoadsAsync_EmptyList_ReturnsFailure_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var loads = new List&lt;Model_ReceivingLoad&gt;();

        // Act
        var result = await dao.UpdateLoadsAsync(loads);

        // Assert
        result.Should().NotBeNull();
        result.Success.Should().BeFalse();
    }

    [Fact]
    public async Task UpdateLoadsAsync_ValidSingleLoad_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var loads = new List&lt;Model_ReceivingLoad&gt; { CreateValidLoad() };

        // Act
        var result = await dao.UpdateLoadsAsync(loads);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task UpdateLoadsAsync_MultipleLoads_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var loads = new List&lt;Model_ReceivingLoad&gt;
        {
            CreateValidLoad(),
            CreateValidLoad()
        };

        // Act
        var result = await dao.UpdateLoadsAsync(loads);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // DeleteLoadsAsync Tests
    // ====================================================================

    [Fact]
    public async Task DeleteLoadsAsync_NullList_ReturnsSuccess_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);

        // Act
        var result = await dao.DeleteLoadsAsync(null!);

        // Assert
        result.Should().NotBeNull();
        result.Success.Should().BeTrue();
        result.Data.Should().Be(0);
    }

    [Fact]
    public async Task DeleteLoadsAsync_EmptyList_ReturnsSuccess_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var loads = new List&lt;Model_ReceivingLoad&gt;();

        // Act
        var result = await dao.DeleteLoadsAsync(loads);

        // Assert
        result.Should().NotBeNull();
        result.Success.Should().BeTrue();
        result.Data.Should().Be(0);
    }

    [Fact]
    public async Task DeleteLoadsAsync_ValidSingleLoad_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var loads = new List&lt;Model_ReceivingLoad&gt; { CreateValidLoad() };

        // Act
        var result = await dao.DeleteLoadsAsync(loads);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task DeleteLoadsAsync_MultipleLoads_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var loads = new List&lt;Model_ReceivingLoad&gt;
        {
            CreateValidLoad(),
            CreateValidLoad(),
            CreateValidLoad()
        };

        // Act
        var result = await dao.DeleteLoadsAsync(loads);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // GetHistoryAsync Tests
    // ====================================================================

    [Fact]
    public async Task GetHistoryAsync_ValidParameters_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var partID = &quot;PART-001&quot;;
        var startDate = DateTime.Now.AddDays(-30);
        var endDate = DateTime.Now;

        // Act
        var result = await dao.GetHistoryAsync(partID, startDate, endDate);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(&quot;&quot;)]
    [InlineData(&quot;PART-001&quot;)]
    [InlineData(&quot;ABC123&quot;)]
    public async Task GetHistoryAsync_DifferentPartIDs_HandlesAll_Async(string partID)
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var startDate = DateTime.Now.AddDays(-30);
        var endDate = DateTime.Now;

        // Act
        var result = await dao.GetHistoryAsync(partID, startDate, endDate);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task GetHistoryAsync_StartDateAfterEndDate_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var partID = &quot;PART-001&quot;;
        var startDate = DateTime.Now;
        var endDate = DateTime.Now.AddDays(-30);

        // Act
        var result = await dao.GetHistoryAsync(partID, startDate, endDate);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task GetHistoryAsync_SameDateRange_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var partID = &quot;PART-001&quot;;
        var date = DateTime.Now;

        // Act
        var result = await dao.GetHistoryAsync(partID, date, date);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // GetAllAsync Tests
    // ====================================================================

    [Fact]
    public async Task GetAllAsync_ValidDateRange_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var startDate = DateTime.Now.AddDays(-30);
        var endDate = DateTime.Now;

        // Act
        var result = await dao.GetAllAsync(startDate, endDate);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task GetAllAsync_WideRange_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var startDate = DateTime.Now.AddYears(-10);
        var endDate = DateTime.Now.AddYears(1);

        // Act
        var result = await dao.GetAllAsync(startDate, endDate);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // Edge Cases and Boundary Value Tests
    // ====================================================================

    [Theory]
    [InlineData(0)]
    [InlineData(0.001)]
    [InlineData(1.5)]
    [InlineData(1000000.99)]
    public async Task SaveLoadsAsync_DifferentWeights_HandlesAll_Async(decimal weight)
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var load = CreateValidLoad();
        load.WeightQuantity = weight;
        load.WeightPerPackage = weight / load.PackagesPerLoad;
        var loads = new List&lt;Model_ReceivingLoad&gt; { load };

        // Act
        var result = await dao.SaveLoadsAsync(loads);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(1)]
    [InlineData(10)]
    [InlineData(100)]
    [InlineData(1000)]
    public async Task SaveLoadsAsync_DifferentPackageCounts_HandlesAll_Async(int packageCount)
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var load = CreateValidLoad();
        load.PackagesPerLoad = packageCount;
        var loads = new List&lt;Model_ReceivingLoad&gt; { load };

        // Act
        var result = await dao.SaveLoadsAsync(loads);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task SaveLoadsAsync_VeryLongPartID_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var load = CreateValidLoad();
        load.PartID = new string(&apos;A&apos;, 500);
        var loads = new List&lt;Model_ReceivingLoad&gt; { load };

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.SaveLoadsAsync(loads);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task SaveLoadsAsync_VeryLongHeatNumber_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var load = CreateValidLoad();
        load.HeatLotNumber = new string(&apos;H&apos;, 1000);
        var loads = new List&lt;Model_ReceivingLoad&gt; { load };

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.SaveLoadsAsync(loads);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task SaveLoadsAsync_SpecialCharactersInFields_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var load = CreateValidLoad();
        load.PartID = &quot;PART-@#$%&quot;;
        load.HeatLotNumber = &quot;HEAT-&lt;&gt;{}&quot;;
        load.PackageTypeName = &quot;Package&apos;s \&quot;Type\&quot;&quot;;
        var loads = new List&lt;Model_ReceivingLoad&gt; { load };

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.SaveLoadsAsync(loads);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Theory]
    [InlineData(1)]
    [InlineData(5)]
    [InlineData(10)]
    [InlineData(50)]
    public async Task SaveLoadsAsync_VariousBatchSizes_HandlesAll_Async(int batchSize)
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var loads = new List&lt;Model_ReceivingLoad&gt;();
        for (int i = 0; i &lt; batchSize; i++)
        {
            loads.Add(CreateValidLoad());
        }

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.SaveLoadsAsync(loads);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task GetHistoryAsync_VeryOldDates_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var startDate = new DateTime(1900, 1, 1);
        var endDate = new DateTime(1900, 12, 31);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.GetHistoryAsync(&quot;PART-001&quot;, startDate, endDate);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task GetAllAsync_FutureDates_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_ReceivingLoad(TestConnectionString);
        var startDate = DateTime.Now.AddYears(1);
        var endDate = DateTime.Now.AddYears(2);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.GetAllAsync(startDate, endDate);

        // Assert
        await act.Should().NotThrowAsync();
    }

    // ====================================================================
    // Helper Methods
    // ====================================================================

    /// &lt;summary&gt;
    /// Creates a valid test receiving load with all required fields populated.
    /// &lt;/summary&gt;
    private static Model_ReceivingLoad CreateValidLoad()
    {
        return new Model_ReceivingLoad
        {
            LoadID = Guid.NewGuid(),
            PartID = &quot;PART-001&quot;,
            PartType = &quot;Steel Coil&quot;,
            PoNumber = &quot;PO-12345&quot;,
            PoLineNumber = &quot;001&quot;,
            LoadNumber = 1,
            WeightQuantity = 1000.50m,
            HeatLotNumber = &quot;HEAT-ABC123&quot;,
            PackagesPerLoad = 10,
            PackageTypeName = &quot;Skid&quot;,
            WeightPerPackage = 100.05m,
            IsNonPOItem = false,
            ReceivedDate = DateTime.Now
        };
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Routing/Data/Dao_RoutingLabel_Tests.cs">using FluentAssertions;
using Xunit;
using MTM_Receiving_Application.Module_Routing.Data;
using MTM_Receiving_Application.Module_Routing.Models;
using MTM_Receiving_Application.Module_Core.Helpers.Database;

namespace MTM_Receiving_Application.Tests.Unit.Module_Routing.Data;

/// &lt;summary&gt;
/// Unit tests for Dao_RoutingLabel data access object.
/// Tests CRUD operations, duplicate detection, and export tracking for routing labels.
/// &lt;/summary&gt;
public class Dao_RoutingLabel_Tests
{
private static string TestConnectionString =&gt; Helper_Database_Variables.GetConnectionString(useProduction: false);

    // ====================================================================
    // Constructor Tests
    // ====================================================================

    [Fact]
    public void Constructor_ValidConnectionString_CreatesInstance()
    {
        // Act
        var dao = new Dao_RoutingLabel(TestConnectionString);

        // Assert
        dao.Should().NotBeNull();
    }

    [Fact]
    public void Constructor_NullConnectionString_ThrowsArgumentNullException()
    {
        // Act
        Action act = () =&gt; new Dao_RoutingLabel(null!);

        // Assert
        act.Should().Throw&lt;ArgumentNullException&gt;()
            .WithMessage(&quot;*connectionString*&quot;);
    }

    // ====================================================================
    // InsertLabelAsync Tests
    // ====================================================================

    [Fact]
    public async Task InsertLabelAsync_ValidLabel_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var label = CreateValidRoutingLabel();

        // Act
        var result = await dao.InsertLabelAsync(label);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task InsertLabelAsync_NullOtherReasonId_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var label = CreateValidRoutingLabel();
        label.OtherReasonId = null;

        // Act
        var result = await dao.InsertLabelAsync(label);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task InsertLabelAsync_WithOtherReasonId_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var label = CreateValidRoutingLabel();
        label.OtherReasonId = 5;

        // Act
        var result = await dao.InsertLabelAsync(label);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(1)]
    [InlineData(10)]
    [InlineData(100)]
    [InlineData(1000)]
    public async Task InsertLabelAsync_DifferentQuantities_HandlesAll_Async(int quantity)
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var label = CreateValidRoutingLabel();
        label.Quantity = quantity;

        // Act
        var result = await dao.InsertLabelAsync(label);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(&quot;PO-12345&quot;, &quot;001&quot;)]
    [InlineData(&quot;12345&quot;, &quot;002&quot;)]
    [InlineData(&quot;PO12345&quot;, &quot;999&quot;)]
    public async Task InsertLabelAsync_DifferentPONumbers_HandlesAll_Async(string poNumber, string lineNumber)
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var label = CreateValidRoutingLabel();
        label.PONumber = poNumber;
        label.LineNumber = lineNumber;

        // Act
        var result = await dao.InsertLabelAsync(label);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(1)]
    [InlineData(100)]
    [InlineData(999)]
    [InlineData(int.MaxValue)]
    public async Task InsertLabelAsync_DifferentCreatedBy_HandlesAll_Async(int createdBy)
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var label = CreateValidRoutingLabel();
        label.CreatedBy = createdBy;

        // Act
        var result = await dao.InsertLabelAsync(label);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // UpdateLabelAsync Tests
    // ====================================================================

    [Fact]
    public async Task UpdateLabelAsync_ValidLabel_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var label = CreateValidRoutingLabel();
        label.Id = 1;

        // Act
        var result = await dao.UpdateLabelAsync(label);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task UpdateLabelAsync_UpdatedQuantity_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var label = CreateValidRoutingLabel();
        label.Id = 1;
        label.Quantity = 999;

        // Act
        var result = await dao.UpdateLabelAsync(label);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task UpdateLabelAsync_NullOtherReasonId_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var label = CreateValidRoutingLabel();
        label.Id = 1;
        label.OtherReasonId = null;

        // Act
        var result = await dao.UpdateLabelAsync(label);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(0)]
    [InlineData(1)]
    [InlineData(100)]
    [InlineData(-1)]
    public async Task UpdateLabelAsync_DifferentIds_HandlesAll_Async(int id)
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var label = CreateValidRoutingLabel();
        label.Id = id;

        // Act
        var result = await dao.UpdateLabelAsync(label);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // GetLabelByIdAsync Tests
    // ====================================================================

    [Fact]
    public async Task GetLabelByIdAsync_ValidId_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var labelId = 1;

        // Act
        var result = await dao.GetLabelByIdAsync(labelId);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(0)]
    [InlineData(1)]
    [InlineData(100)]
    [InlineData(int.MaxValue)]
    public async Task GetLabelByIdAsync_DifferentIds_HandlesAll_Async(int labelId)
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);

        // Act
        var result = await dao.GetLabelByIdAsync(labelId);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task GetLabelByIdAsync_NegativeId_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var labelId = -1;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.GetLabelByIdAsync(labelId);

        // Assert
        await act.Should().NotThrowAsync();
    }

    // ====================================================================
    // GetAllLabelsAsync Tests
    // ====================================================================

    [Fact]
    public async Task GetAllLabelsAsync_DefaultParameters_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);

        // Act
        var result = await dao.GetAllLabelsAsync();

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(10, 0)]
    [InlineData(50, 0)]
    [InlineData(100, 0)]
    [InlineData(100, 100)]
    [InlineData(100, 500)]
    public async Task GetAllLabelsAsync_DifferentPagination_HandlesAll_Async(int limit, int offset)
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);

        // Act
        var result = await dao.GetAllLabelsAsync(limit, offset);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task GetAllLabelsAsync_ZeroLimit_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.GetAllLabelsAsync(0, 0);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task GetAllLabelsAsync_NegativeOffset_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.GetAllLabelsAsync(100, -10);

        // Assert
        await act.Should().NotThrowAsync();
    }

    // ====================================================================
    // DeleteLabelAsync Tests
    // ====================================================================

    [Fact]
    public async Task DeleteLabelAsync_ValidId_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var labelId = 1;

        // Act
        var result = await dao.DeleteLabelAsync(labelId);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(0)]
    [InlineData(1)]
    [InlineData(100)]
    [InlineData(int.MaxValue)]
    public async Task DeleteLabelAsync_DifferentIds_HandlesAll_Async(int labelId)
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);

        // Act
        var result = await dao.DeleteLabelAsync(labelId);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // MarkLabelExportedAsync Tests
    // ====================================================================

    [Fact]
    public async Task MarkLabelExportedAsync_ValidId_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var labelId = 1;

        // Act
        var result = await dao.MarkLabelExportedAsync(labelId);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(1)]
    [InlineData(100)]
    [InlineData(int.MaxValue)]
    public async Task MarkLabelExportedAsync_DifferentIds_HandlesAll_Async(int labelId)
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);

        // Act
        var result = await dao.MarkLabelExportedAsync(labelId);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // CheckDuplicateLabelAsync Tests
    // ====================================================================

    [Fact]
    public async Task CheckDuplicateLabelAsync_ValidParameters_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var poNumber = &quot;PO-12345&quot;;
        var lineNumber = &quot;001&quot;;
        var recipientId = 10;
        var hoursWindow = 24;

        // Act
        var result = await dao.CheckDuplicateLabelAsync(poNumber, lineNumber, recipientId, hoursWindow);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(1)]
    [InlineData(24)]
    [InlineData(48)]
    [InlineData(168)]
    public async Task CheckDuplicateLabelAsync_DifferentTimeWindows_HandlesAll_Async(int hoursWindow)
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var poNumber = &quot;PO-12345&quot;;
        var lineNumber = &quot;001&quot;;
        var recipientId = 10;

        // Act
        var result = await dao.CheckDuplicateLabelAsync(poNumber, lineNumber, recipientId, hoursWindow);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task CheckDuplicateLabelAsync_ZeroHoursWindow_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var poNumber = &quot;PO-12345&quot;;
        var lineNumber = &quot;001&quot;;
        var recipientId = 10;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.CheckDuplicateLabelAsync(poNumber, lineNumber, recipientId, 0);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Theory]
    [InlineData(&quot;PO-12345&quot;, &quot;001&quot;)]
    [InlineData(&quot;12345&quot;, &quot;002&quot;)]
    [InlineData(&quot;&quot;, &quot;003&quot;)]
    public async Task CheckDuplicateLabelAsync_DifferentPONumbers_HandlesAll_Async(string poNumber, string lineNumber)
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var recipientId = 10;

        // Act
        var result = await dao.CheckDuplicateLabelAsync(poNumber, lineNumber, recipientId, 24);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // CheckDuplicateAsync Helper Tests
    // ====================================================================

    [Fact]
    public async Task CheckDuplicateAsync_ValidParameters_CallsCheckDuplicate_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var poNumber = &quot;PO-12345&quot;;
        var lineNumber = &quot;001&quot;;
        var recipientId = 10;
        var createdWithinDate = DateTime.Now.AddHours(-12);

        // Act
        var result = await dao.CheckDuplicateAsync(poNumber, lineNumber, recipientId, createdWithinDate);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task CheckDuplicateAsync_DefaultDateTime_UsesDefault24Hours_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var poNumber = &quot;PO-12345&quot;;
        var lineNumber = &quot;001&quot;;
        var recipientId = 10;

        // Act
        var result = await dao.CheckDuplicateAsync(poNumber, lineNumber, recipientId, default);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task CheckDuplicateAsync_FutureDate_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var poNumber = &quot;PO-12345&quot;;
        var lineNumber = &quot;001&quot;;
        var recipientId = 10;
        var futureDate = DateTime.Now.AddDays(1);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.CheckDuplicateAsync(poNumber, lineNumber, recipientId, futureDate);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task CheckDuplicateAsync_OldDate_CapsAtOneWeek_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var poNumber = &quot;PO-12345&quot;;
        var lineNumber = &quot;001&quot;;
        var recipientId = 10;
        var oldDate = DateTime.Now.AddDays(-30);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.CheckDuplicateAsync(poNumber, lineNumber, recipientId, oldDate);

        // Assert
        await act.Should().NotThrowAsync();
    }

    // ====================================================================
    // MarkExportedAsync Helper Tests
    // ====================================================================

    [Fact]
    public async Task MarkExportedAsync_EmptyList_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var labelIds = new List&lt;int&gt;();

        // Act
        var result = await dao.MarkExportedAsync(labelIds);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task MarkExportedAsync_SingleId_CallsMarkExported_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var labelIds = new List&lt;int&gt; { 1 };

        // Act
        var result = await dao.MarkExportedAsync(labelIds);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task MarkExportedAsync_MultipleIds_CallsMarkExportedForEach_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var labelIds = new List&lt;int&gt; { 1, 2, 3, 4, 5 };

        // Act
        var result = await dao.MarkExportedAsync(labelIds);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // Edge Cases and Boundary Value Tests
    // ====================================================================

    [Fact]
    public async Task InsertLabelAsync_VeryLongDescription_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var label = CreateValidRoutingLabel();
        label.Description = new string(&apos;D&apos;, 2000);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertLabelAsync(label);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertLabelAsync_SpecialCharactersInFields_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var label = CreateValidRoutingLabel();
        label.PONumber = &quot;PO-@#$%&quot;;
        label.Description = &quot;Description with &lt;special&gt; \&quot;characters\&quot;&quot;;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertLabelAsync(label);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertLabelAsync_ZeroQuantity_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var label = CreateValidRoutingLabel();
        label.Quantity = 0;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertLabelAsync(label);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertLabelAsync_NegativeQuantity_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var label = CreateValidRoutingLabel();
        label.Quantity = -10;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertLabelAsync(label);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Theory]
    [InlineData(int.MinValue)]
    [InlineData(-1)]
    [InlineData(0)]
    [InlineData(1)]
    [InlineData(int.MaxValue)]
    public async Task InsertLabelAsync_BoundaryRecipientIds_HandlesAll_Async(int recipientId)
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);
        var label = CreateValidRoutingLabel();
        label.RecipientId = recipientId;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertLabelAsync(label);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task GetAllLabelsAsync_VeryLargeLimit_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.GetAllLabelsAsync(int.MaxValue, 0);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task CheckDuplicateLabelAsync_VeryLargeTimeWindow_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.CheckDuplicateLabelAsync(&quot;PO-123&quot;, &quot;001&quot;, 10, 99999);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task CheckDuplicateLabelAsync_NegativeTimeWindow_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_RoutingLabel(TestConnectionString);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.CheckDuplicateLabelAsync(&quot;PO-123&quot;, &quot;001&quot;, 10, -24);

        // Assert
        await act.Should().NotThrowAsync();
    }

    // ====================================================================
    // Helper Methods
    // ====================================================================

    /// &lt;summary&gt;
    /// Creates a valid test routing label with all required fields populated.
    /// &lt;/summary&gt;
    private static Model_RoutingLabel CreateValidRoutingLabel()
    {
        return new Model_RoutingLabel
        {
            PONumber = &quot;PO-12345&quot;,
            LineNumber = &quot;001&quot;,
            Description = &quot;Test Part Description&quot;,
            RecipientId = 10,
            RecipientName = &quot;Test Recipient&quot;,
            RecipientLocation = &quot;Building A&quot;,
            Quantity = 100,
            CreatedBy = 1001,
            CreatedDate = DateTime.Now,
            OtherReasonId = null,
            IsActive = true,
            CsvExported = false
        };
    }
}</file><file path="MTM_Receiving_Application.Tests/Module_Settings/Data/Dao_PackageType_Tests.cs">using FluentAssertions;
using Xunit;
using MTM_Receiving_Application.Module_Settings.Data;
using MTM_Receiving_Application.Module_Settings.Models;
using MTM_Receiving_Application.Module_Core.Helpers.Database;

namespace MTM_Receiving_Application.Tests.Unit.Module_Settings.Data;

/// &lt;summary&gt;
/// Unit tests for Dao_PackageType data access object.
/// Tests CRUD operations for package type management.
/// &lt;/summary&gt;
public class Dao_PackageType_Tests
{
private static string TestConnectionString =&gt; Helper_Database_Variables.GetConnectionString(useProduction: false);

    // ====================================================================
    // Constructor Tests
    // ====================================================================

    [Fact]
    public void Constructor_ValidConnectionString_CreatesInstance()
    {
        // Act
        var dao = new Dao_PackageType(TestConnectionString);

        // Assert
        dao.Should().NotBeNull();
    }

    [Fact]
    public void Constructor_NullConnectionString_ThrowsArgumentNullException()
    {
        // Act
        Action act = () =&gt; new Dao_PackageType(null!);

        // Assert
        act.Should().Throw&lt;ArgumentNullException&gt;()
            .WithMessage(&quot;*connectionString*&quot;);
    }

    // ====================================================================
    // GetAllAsync Tests
    // ====================================================================

    [Fact]
    public async Task GetAllAsync_NoParameters_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);

        // Act
        var result = await dao.GetAllAsync();

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // GetByIdAsync Tests
    // ====================================================================

    [Fact]
    public async Task GetByIdAsync_ValidId_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var id = 1;

        // Act
        var result = await dao.GetByIdAsync(id);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(0)]
    [InlineData(1)]
    [InlineData(100)]
    [InlineData(int.MaxValue)]
    public async Task GetByIdAsync_DifferentIds_HandlesAll_Async(int id)
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);

        // Act
        var result = await dao.GetByIdAsync(id);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task GetByIdAsync_NegativeId_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var id = -1;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.GetByIdAsync(id);

        // Assert
        await act.Should().NotThrowAsync();
    }

    // ====================================================================
    // InsertAsync Tests
    // ====================================================================

    [Fact]
    public async Task InsertAsync_ValidPackageType_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var packageType = CreateValidPackageType();
        var createdBy = 1001;

        // Act
        var result = await dao.InsertAsync(packageType, createdBy);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task InsertAsync_MinimalData_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var packageType = new Model_PackageType
        {
            Name = &quot;Test&quot;,
            Code = &quot;TST&quot;
        };
        var createdBy = 1;

        // Act
        var result = await dao.InsertAsync(packageType, createdBy);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(&quot;Skid&quot;, &quot;SKD&quot;)]
    [InlineData(&quot;Pallet&quot;, &quot;PLT&quot;)]
    [InlineData(&quot;Box&quot;, &quot;BOX&quot;)]
    [InlineData(&quot;Crate&quot;, &quot;CRT&quot;)]
    public async Task InsertAsync_DifferentTypes_HandlesAll_Async(string name, string code)
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var packageType = new Model_PackageType
        {
            Name = name,
            Code = code
        };
        var createdBy = 1001;

        // Act
        var result = await dao.InsertAsync(packageType, createdBy);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(0)]
    [InlineData(1)]
    [InlineData(999)]
    [InlineData(int.MaxValue)]
    public async Task InsertAsync_DifferentCreatedBy_HandlesAll_Async(int createdBy)
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var packageType = CreateValidPackageType();

        // Act
        var result = await dao.InsertAsync(packageType, createdBy);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // UpdateAsync Tests
    // ====================================================================

    [Fact]
    public async Task UpdateAsync_ValidPackageType_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var packageType = CreateValidPackageType();
        packageType.Id = 1;

        // Act
        var result = await dao.UpdateAsync(packageType);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task UpdateAsync_AllFieldsChanged_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var packageType = new Model_PackageType
        {
            Id = 1,
            Name = &quot;Updated Name&quot;,
            Code = &quot;UPD&quot;
        };

        // Act
        var result = await dao.UpdateAsync(packageType);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(0)]
    [InlineData(1)]
    [InlineData(100)]
    [InlineData(-1)]
    public async Task UpdateAsync_DifferentIds_HandlesAll_Async(int id)
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var packageType = CreateValidPackageType();
        packageType.Id = id;

        // Act
        var result = await dao.UpdateAsync(packageType);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // DeleteAsync Tests
    // ====================================================================

    [Fact]
    public async Task DeleteAsync_ValidId_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var id = 1;

        // Act
        var result = await dao.DeleteAsync(id);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(0)]
    [InlineData(1)]
    [InlineData(100)]
    [InlineData(int.MaxValue)]
    public async Task DeleteAsync_DifferentIds_HandlesAll_Async(int id)
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);

        // Act
        var result = await dao.DeleteAsync(id);

        // Assert
        result.Should().NotBeNull();
    }

    [Fact]
    public async Task DeleteAsync_NegativeId_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var id = -1;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.DeleteAsync(id);

        // Assert
        await act.Should().NotThrowAsync();
    }

    // ====================================================================
    // GetUsageCountAsync Tests
    // ====================================================================

    [Fact]
    public async Task GetUsageCountAsync_ValidId_CallsStoredProcedure_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var id = 1;

        // Act
        var result = await dao.GetUsageCountAsync(id);

        // Assert
        result.Should().NotBeNull();
    }

    [Theory]
    [InlineData(0)]
    [InlineData(1)]
    [InlineData(100)]
    [InlineData(int.MaxValue)]
    public async Task GetUsageCountAsync_DifferentIds_HandlesAll_Async(int id)
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);

        // Act
        var result = await dao.GetUsageCountAsync(id);

        // Assert
        result.Should().NotBeNull();
    }

    // ====================================================================
    // Edge Cases and Boundary Value Tests
    // ====================================================================

    [Fact]
    public async Task InsertAsync_VeryLongName_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var packageType = new Model_PackageType
        {
            Name = new string(&apos;N&apos;, 500),
            Code = &quot;TST&quot;
        };
        var createdBy = 1001;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertAsync(packageType, createdBy);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertAsync_VeryLongCode_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var packageType = new Model_PackageType
        {
            Name = &quot;Test&quot;,
            Code = new string(&apos;C&apos;, 100)
        };
        var createdBy = 1001;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertAsync(packageType, createdBy);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertAsync_SpecialCharactersInName_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var packageType = new Model_PackageType
        {
            Name = &quot;Package&apos;s \&quot;Special\&quot; Type @#$%&quot;,
            Code = &quot;SPC&quot;
        };
        var createdBy = 1001;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertAsync(packageType, createdBy);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertAsync_EmptyStrings_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var packageType = new Model_PackageType
        {
            Name = string.Empty,
            Code = string.Empty
        };
        var createdBy = 1001;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertAsync(packageType, createdBy);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task UpdateAsync_VeryLongName_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var packageType = new Model_PackageType
        {
            Id = 1,
            Name = new string(&apos;N&apos;, 1000),
            Code = &quot;UPD&quot;
        };

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.UpdateAsync(packageType);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task UpdateAsync_SpecialCharactersInCode_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var packageType = new Model_PackageType
        {
            Id = 1,
            Name = &quot;Test&quot;,
            Code = &quot;@#$%^&amp;*()&quot;
        };

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.UpdateAsync(packageType);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Theory]
    [InlineData(int.MinValue)]
    [InlineData(-999)]
    [InlineData(-1)]
    [InlineData(0)]
    [InlineData(1)]
    [InlineData(999)]
    [InlineData(int.MaxValue)]
    public async Task GetUsageCountAsync_BoundaryValues_HandlesAll_Async(int id)
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.GetUsageCountAsync(id);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task InsertAsync_NegativeCreatedBy_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var packageType = CreateValidPackageType();
        var createdBy = -1;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.InsertAsync(packageType, createdBy);

        // Assert
        await act.Should().NotThrowAsync();
    }

    [Fact]
    public async Task UpdateAsync_WithIdZero_HandlesGracefully_Async()
    {
        // Arrange
        var dao = new Dao_PackageType(TestConnectionString);
        var packageType = CreateValidPackageType();
        packageType.Id = 0;

        // Act
        Func&lt;Task&gt; act = async () =&gt; await dao.UpdateAsync(packageType);

        // Assert
        await act.Should().NotThrowAsync();
    }

    // ====================================================================
    // Helper Methods
    // ====================================================================

    /// &lt;summary&gt;
    /// Creates a valid test package type with required fields populated.
    /// &lt;/summary&gt;
    private static Model_PackageType CreateValidPackageType()
    {
        return new Model_PackageType
        {
            Name = &quot;Test Package&quot;,
            Code = &quot;TST&quot;,
            IsActive = true,
            CreatedAt = DateTime.Now,
            UpdatedAt = DateTime.Now
        };
    }
}</file><file path="MTM_Receiving_Application.Tests/UnitTest1.cs">using Xunit;
using FluentAssertions;

namespace MTM_Receiving_Application.Tests;

public class UnitTest1
{
    [Fact]
    public void Test_BasicMath_ShouldPass()
    {
        // Arrange
        var expected = 4;

        // Act
        var result = 2 + 2;

        // Assert
        result.Should().Be(expected);
    }

    [Fact]
    public void Test_StringOperation_ShouldPass()
    {
        // Arrange
        var testString = &quot;Hello, World!&quot;;

        // Act
        var result = testString.ToUpper();

        // Assert
        result.Should().Be(&quot;HELLO, WORLD!&quot;);
    }
}</file><file path="Module_Core/Helpers/Database/Helper_Database_Variables.cs">namespace MTM_Receiving_Application.Module_Core.Helpers.Database;

/// &lt;summary&gt;
/// Manages database connection strings for different environments
/// &lt;/summary&gt;
public static class Helper_Database_Variables
{
    /// &lt;summary&gt;
    /// Production MySQL connection string
    /// Server: localhost, Port: 3306, Database: mtm_receiving_application
    /// &lt;/summary&gt;
    public static string ProductionConnectionString { get; } =
        &quot;Server=localhost;Port=3306;Database=mtm_receiving_application;Uid=root;Pwd=root;CharSet=utf8mb4;&quot;;

    /// &lt;summary&gt;
    /// Test MySQL connection string (same as production for now)
    /// &lt;/summary&gt;
    public static string TestConnectionString { get; } =
        &quot;Server=localhost;Port=3306;Database=mtm_receiving_application_test;Uid=root;Pwd=root;CharSet=utf8mb4;&quot;;

    /// &lt;summary&gt;
    /// Gets the connection string based on current environment
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;useProduction&quot;&gt;True for production, false for test&lt;/param&gt;
    /// &lt;returns&gt;MySQL connection string&lt;/returns&gt;
    public static string GetConnectionString(bool useProduction = true)
    {
        return useProduction ? ProductionConnectionString : TestConnectionString;
    }

    /// &lt;summary&gt;
    /// Gets the Infor Visual connection string (READ ONLY)
    /// &lt;/summary&gt;
    public static string GetInforVisualConnectionString()
    {
        return &quot;Server=VISUAL;Database=MTMFG;User Id=SHOP2;Password=SHOP;TrustServerCertificate=True;ApplicationIntent=ReadOnly;&quot;;
    }
}</file><file path="Module_Dunnage/Views/View_Dunnage_WorkflowView.xaml.cs">using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Dunnage.ViewModels;
using MTM_Receiving_Application.Module_Dunnage.Enums;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using System;
using Microsoft.UI.Xaml;

namespace MTM_Receiving_Application.Module_Dunnage.Views;

public sealed partial class View_Dunnage_WorkflowView : Page
{
    public ViewModel_Dunnage_WorkFlowViewModel ViewModel { get; }
    private IService_DunnageWorkflow? _workflowService;
    private IService_Help? _helpService;
    private readonly IService_Focus _focusService;

    public View_Dunnage_WorkflowView()
    {
        ViewModel = App.GetService&lt;ViewModel_Dunnage_WorkFlowViewModel&gt;();
        _focusService = App.GetService&lt;IService_Focus&gt;();
        InitializeComponent();

        // Subscribe to workflow step changes
        _workflowService = App.GetService&lt;IService_DunnageWorkflow&gt;();
        _helpService = App.GetService&lt;IService_Help&gt;();
        _workflowService.StepChanged += OnWorkflowStepChanged;

        _focusService.AttachFocusOnVisibility(this);
    }

    private void OnWorkflowStepChanged(object? sender, EventArgs e)
    {
        // No need to update flyout content anymore - help dialog shows current step
    }

    private async void HelpButton_Click(object sender, RoutedEventArgs e)
    {
        // Show help dialog for current step
        await ShowHelpForCurrentStepAsync();
    }

    private async System.Threading.Tasks.Task ShowHelpForCurrentStepAsync()
    {
        if (_helpService == null || _workflowService == null)
        {
            return;
        }

        await _helpService.ShowContextualHelpAsync(_workflowService.CurrentStep);
    }

    private async void OnNextClick(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
    {
        var workflowService = App.GetService&lt;IService_DunnageWorkflow&gt;();
        var result = await workflowService.AdvanceToNextStepAsync();

        if (!result.IsSuccess)
        {
            // Show error message
            var dialog = new ContentDialog
            {
                Title = &quot;Cannot Proceed&quot;,
                Content = result.ErrorMessage,
                CloseButtonText = &quot;OK&quot;,
                XamlRoot = this.XamlRoot
            };
            var dialogResult = await dialog.ShowAsync();
        }
    }

    private async void OnSaveAndReviewClick(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
    {
        // Show confirmation dialog
        var confirmDialog = new ContentDialog
        {
            Title = &quot;Save and Review&quot;,
            Content = &quot;Are you ready to save this load and proceed to review?\n\nYou will be able to add more loads from the review screen.&quot;,
            PrimaryButtonText = &quot;Save &amp; Review&quot;,
            CloseButtonText = &quot;Cancel&quot;,
            DefaultButton = ContentDialogButton.Primary,
            XamlRoot = this.XamlRoot
        };

        var confirmResult = await confirmDialog.ShowAsync();

        if (confirmResult == ContentDialogResult.Primary)
        {
            // User confirmed, proceed to next step
            var workflowService = App.GetService&lt;IService_DunnageWorkflow&gt;();
            var result = await workflowService.AdvanceToNextStepAsync();

            if (!result.IsSuccess)
            {
                // Show error message
                var errorDialog = new ContentDialog
                {
                    Title = &quot;Cannot Proceed&quot;,
                    Content = result.ErrorMessage,
                    CloseButtonText = &quot;OK&quot;,
                    XamlRoot = this.XamlRoot
                };
                await errorDialog.ShowAsync();
            }
        }
    }

    private void OnBackClick(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
    {
        var workflowService = App.GetService&lt;IService_DunnageWorkflow&gt;();

        // Navigate back based on current step
        switch (workflowService.CurrentStep)
        {
            case Enum_DunnageWorkflowStep.PartSelection:
                workflowService.GoToStep(Enum_DunnageWorkflowStep.TypeSelection);
                break;
            case Enum_DunnageWorkflowStep.QuantityEntry:
                workflowService.GoToStep(Enum_DunnageWorkflowStep.PartSelection);
                break;
            case Enum_DunnageWorkflowStep.DetailsEntry:
                workflowService.GoToStep(Enum_DunnageWorkflowStep.QuantityEntry);
                break;
            case Enum_DunnageWorkflowStep.Review:
                workflowService.GoToStep(Enum_DunnageWorkflowStep.DetailsEntry);
                break;
        }
    }
}</file><file path="Module_Routing/Data/Dao_RoutingLabel.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Routing.Models;
using MTM_Receiving_Application.Module_Core.Helpers.Database;

namespace MTM_Receiving_Application.Module_Routing.Data;

/// &lt;summary&gt;
/// Data Access Object for routing_label_data table
/// Provides CRUD operations using stored procedures
/// &lt;/summary&gt;
public class Dao_RoutingLabel
{
    private readonly string _connectionString;

    public Dao_RoutingLabel(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Inserts a new routing label record
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;label&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; InsertLabelAsync(Model_RoutingLabel label)
    {
        try
        {
            // Issue #32: Enhanced logging
            Console.WriteLine($&quot;[DAO] Inserting label: PO={label.PONumber}, Recipient={label.RecipientId}&quot;);

            var parameters = new MySqlParameter[]
            {
                new MySqlParameter(&quot;@p_po_number&quot;, label.PONumber),
                new MySqlParameter(&quot;@p_line_number&quot;, label.LineNumber),
                new MySqlParameter(&quot;@p_description&quot;, label.Description),
                new MySqlParameter(&quot;@p_recipient_id&quot;, label.RecipientId),
                new MySqlParameter(&quot;@p_quantity&quot;, label.Quantity),
                new MySqlParameter(&quot;@p_created_by&quot;, label.CreatedBy),
                new MySqlParameter(&quot;@p_other_reason_id&quot;, (object?)label.OtherReasonId ?? DBNull.Value),
                new MySqlParameter(&quot;@p_new_label_id&quot;, MySqlDbType.Int32) { Direction = ParameterDirection.Output },
                new MySqlParameter(&quot;@p_error_message&quot;, MySqlDbType.VarChar, 500) { Direction = ParameterDirection.Output }
            };

            var result = await Helper_Database_StoredProcedure.ExecuteAsync(
                &quot;sp_routing_label_insert&quot;,
                parameters,
                _connectionString
            );

            if (result.Success)
            {
                var newIdParam = Array.Find(parameters, p =&gt; p.ParameterName == &quot;@p_new_label_id&quot;);
                int newId = newIdParam?.Value != DBNull.Value ? Convert.ToInt32(newIdParam?.Value) : 0;

                // Issue #12: Extract output parameters for better error reporting
                var errorMsgParam = Array.Find(parameters, p =&gt; p.ParameterName == &quot;@p_error_message&quot;);
                string spErrorMsg = errorMsgParam?.Value?.ToString() ?? string.Empty;

                if (!string.IsNullOrEmpty(spErrorMsg))
                {
                    return new Model_Dao_Result&lt;int&gt;
                    {
                        Success = false,
                        ErrorMessage = $&quot;Stored procedure error: {spErrorMsg}&quot;,
                        Severity = Enum_ErrorSeverity.Medium
                    };
                }

                if (newId &lt;= 0)
                {
                    return new Model_Dao_Result&lt;int&gt;
                    {
                        Success = false,
                        ErrorMessage = &quot;Failed to retrieve new ID from stored procedure (ID was 0 or NULL)&quot;,
                        Severity = Enum_ErrorSeverity.Medium
                    };
                }

                return new Model_Dao_Result&lt;int&gt;
                {
                    Success = true,
                    Data = newId,
                    AffectedRows = 1,
                    ExecutionTimeMs = result.ExecutionTimeMs
                };
            }

            return new Model_Dao_Result&lt;int&gt;
            {
                Success = false,
                ErrorMessage = result.ErrorMessage,
                Severity = result.Severity
            };
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;int&gt;($&quot;Error inserting routing label: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Updates an existing routing label
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;label&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; UpdateLabelAsync(Model_RoutingLabel label)
    {
        try
        {            // Issue #32: Enhanced logging
            Console.WriteLine($&quot;[DAO] Updating label {label.Id}&quot;);
            var parameters = new MySqlParameter[]
{
                new MySqlParameter(&quot;@p_label_id&quot;, label.Id),
                new MySqlParameter(&quot;@p_po_number&quot;, label.PONumber),
                new MySqlParameter(&quot;@p_line_number&quot;, label.LineNumber),
                new MySqlParameter(&quot;@p_description&quot;, label.Description),
                new MySqlParameter(&quot;@p_recipient_id&quot;, label.RecipientId),
                new MySqlParameter(&quot;@p_quantity&quot;, label.Quantity),
                new MySqlParameter(&quot;@p_other_reason_id&quot;, (object?)label.OtherReasonId ?? DBNull.Value),
                new MySqlParameter(&quot;@p_status&quot;, MySqlDbType.Int32) { Direction = ParameterDirection.Output },
                new MySqlParameter(&quot;@p_error_msg&quot;, MySqlDbType.VarChar, 500) { Direction = ParameterDirection.Output }
};

            return await Helper_Database_StoredProcedure.ExecuteAsync(
                &quot;sp_routing_label_update&quot;,
                parameters,
                _connectionString
            );
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure($&quot;Error updating routing label: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Retrieves a single label by ID
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;labelId&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_RoutingLabel&gt;&gt; GetLabelByIdAsync(int labelId)
    {
        try
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;p_label_id&quot;, labelId }
            };

            return await Helper_Database_StoredProcedure.ExecuteSingleAsync&lt;Model_RoutingLabel&gt;(
                _connectionString,
                &quot;sp_routing_label_get_by_id&quot;,
                MapFromReader,
                parameters
            );
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;Model_RoutingLabel&gt;($&quot;Error retrieving routing label: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Retrieves all labels with pagination
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;limit&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;offset&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingLabel&gt;&gt;&gt; GetAllLabelsAsync(int limit = 100, int offset = 0)
    {
        try
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;p_limit&quot;, limit },
                { &quot;p_offset&quot;, offset }
            };

            return await Helper_Database_StoredProcedure.ExecuteListAsync&lt;Model_RoutingLabel&gt;(
                _connectionString,
                &quot;sp_routing_label_get_all&quot;,
                MapFromReader,
                parameters
            );
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_RoutingLabel&gt;&gt;($&quot;Error retrieving routing labels: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Soft deletes a label
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;labelId&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; DeleteLabelAsync(int labelId)
    {
        try
        {
            var parameters = new MySqlParameter[]
            {
                new MySqlParameter(&quot;@p_label_id&quot;, labelId),
                new MySqlParameter(&quot;@p_status&quot;, MySqlDbType.Int32) { Direction = ParameterDirection.Output },
                new MySqlParameter(&quot;@p_error_msg&quot;, MySqlDbType.VarChar, 500) { Direction = ParameterDirection.Output }
            };

            return await Helper_Database_StoredProcedure.ExecuteAsync(
                &quot;sp_routing_label_delete&quot;,
                parameters,
                _connectionString
            );
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure($&quot;Error deleting routing label: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Marks label as CSV exported
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;labelId&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; MarkLabelExportedAsync(int labelId)
    {
        try
        {
            var parameters = new MySqlParameter[]
            {
                new MySqlParameter(&quot;@p_label_id&quot;, labelId),
                new MySqlParameter(&quot;@p_status&quot;, MySqlDbType.Int32) { Direction = ParameterDirection.Output },
                new MySqlParameter(&quot;@p_error_msg&quot;, MySqlDbType.VarChar, 500) { Direction = ParameterDirection.Output }
            };

            return await Helper_Database_StoredProcedure.ExecuteAsync(
                &quot;sp_routing_label_mark_exported&quot;,
                parameters,
                _connectionString
            );
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure($&quot;Error marking label as exported: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Checks for duplicate labels within time window
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;lineNumber&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;recipientId&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;hoursWindow&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_RoutingLabel&gt;&gt; CheckDuplicateLabelAsync(
        string poNumber, string lineNumber, int recipientId, int hoursWindow = 24)
    {
        try
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;p_po_number&quot;, poNumber },
                { &quot;p_line_number&quot;, lineNumber },
                { &quot;p_recipient_id&quot;, recipientId },
                { &quot;p_hours_window&quot;, hoursWindow }
            };

            return await Helper_Database_StoredProcedure.ExecuteSingleAsync&lt;Model_RoutingLabel&gt;(
                _connectionString,
                &quot;sp_routing_label_check_duplicate&quot;,
                MapFromReader,
                parameters
            );
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;Model_RoutingLabel&gt;($&quot;Error checking duplicate label: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Maps IDataReader to Model_RoutingLabel
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;reader&quot;&gt;&lt;/param&gt;
    private Model_RoutingLabel MapFromReader(IDataReader reader)
    {
        // Issue #17: Standardized null handling - use IsDBNull consistently
        return new Model_RoutingLabel
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            PONumber = reader.IsDBNull(reader.GetOrdinal(&quot;po_number&quot;)) ? string.Empty : reader.GetString(reader.GetOrdinal(&quot;po_number&quot;)),
            LineNumber = reader.IsDBNull(reader.GetOrdinal(&quot;line_number&quot;)) ? string.Empty : reader.GetString(reader.GetOrdinal(&quot;line_number&quot;)),
            Description = reader.IsDBNull(reader.GetOrdinal(&quot;description&quot;)) ? string.Empty : reader.GetString(reader.GetOrdinal(&quot;description&quot;)),
            RecipientId = reader.GetInt32(reader.GetOrdinal(&quot;recipient_id&quot;)),
            RecipientName = reader.IsDBNull(reader.GetOrdinal(&quot;recipient_name&quot;)) ? string.Empty : reader.GetString(reader.GetOrdinal(&quot;recipient_name&quot;)),
            RecipientLocation = reader.IsDBNull(reader.GetOrdinal(&quot;recipient_location&quot;)) ? string.Empty : reader.GetString(reader.GetOrdinal(&quot;recipient_location&quot;)),
            Quantity = reader.GetInt32(reader.GetOrdinal(&quot;quantity&quot;)),
            CreatedBy = reader.GetInt32(reader.GetOrdinal(&quot;created_by&quot;)),
            CreatedDate = reader.GetDateTime(reader.GetOrdinal(&quot;created_date&quot;)),
            OtherReasonId = reader.IsDBNull(reader.GetOrdinal(&quot;other_reason_id&quot;)) ? null : reader.GetInt32(reader.GetOrdinal(&quot;other_reason_id&quot;)),
            OtherReasonDescription = reader.IsDBNull(reader.GetOrdinal(&quot;other_reason_description&quot;)) ? null : reader.GetString(reader.GetOrdinal(&quot;other_reason_description&quot;)),
            IsActive = true,  // Always true from query (WHERE is_active = 1)
            CsvExported = reader.GetBoolean(reader.GetOrdinal(&quot;csv_exported&quot;)),
            CsvExportDate = reader.IsDBNull(reader.GetOrdinal(&quot;csv_export_date&quot;)) ? null : reader.GetDateTime(reader.GetOrdinal(&quot;csv_export_date&quot;))
        };
    }

    #region Helper Methods for Duplicate Detection
    public async Task&lt;Model_Dao_Result&lt;(bool Exists, int? ExistingLabelId)&gt;&gt; CheckDuplicateAsync(string poNumber, string lineNumber, int recipientId, DateTime createdWithinDate)
    {
        // Issue #8: Use DateTime parameter to calculate hours window
        int hours = createdWithinDate == default(DateTime)
            ? 24  // Default to 24 hours if no date provided
            : (int)(DateTime.Now - createdWithinDate).TotalHours;

        // Ensure positive hours value
        if (hours &lt; 0)
            hours = 0;
        if (hours &gt; 168)
            hours = 168; // Cap at 1 week

        var result = await CheckDuplicateLabelAsync(poNumber, lineNumber, recipientId, hours);
        if (result.IsSuccess &amp;&amp; result.Data != null)
        {
            return Model_Dao_Result_Factory.Success((Exists: true, ExistingLabelId: (int?)result.Data.Id));
        }
        return Model_Dao_Result_Factory.Success((Exists: false, ExistingLabelId: (int?)null));
    }

    public async Task&lt;Model_Dao_Result&gt; MarkExportedAsync(List&lt;int&gt; labelIds)
    {
        foreach (var id in labelIds)
        {
            var result = await MarkLabelExportedAsync(id);
            if (!result.IsSuccess)
                return result;
        }
        return Model_Dao_Result_Factory.Success();
    }
    #endregion
}</file><file path="Module_Routing/Data/Dao_RoutingLabelHistory.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Models;
using MTM_Receiving_Application.Module_Core.Helpers.Database;

namespace MTM_Receiving_Application.Module_Routing.Data;

/// &lt;summary&gt;
/// Data Access Object for routing_history table
/// &lt;/summary&gt;
public class Dao_RoutingLabelHistory
{
    private readonly string _connectionString;

    public Dao_RoutingLabelHistory(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Inserts a history entry for label edit
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;history&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; InsertHistoryAsync(Model_RoutingLabelHistory history)
    {
        try
        {
            var parameters = new MySqlParameter[]
            {
                new MySqlParameter(&quot;@p_label_id&quot;, history.LabelId),
                new MySqlParameter(&quot;@p_field_changed&quot;, history.FieldChanged),
                new MySqlParameter(&quot;@p_old_value&quot;, (object?)history.OldValue ?? DBNull.Value),
                new MySqlParameter(&quot;@p_new_value&quot;, (object?)history.NewValue ?? DBNull.Value),
                new MySqlParameter(&quot;@p_edited_by&quot;, history.EditedBy),
                new MySqlParameter(&quot;@p_status&quot;, MySqlDbType.Int32) { Direction = System.Data.ParameterDirection.Output },
                new MySqlParameter(&quot;@p_error_msg&quot;, MySqlDbType.VarChar, 500) { Direction = System.Data.ParameterDirection.Output }
            };

            return await Helper_Database_StoredProcedure.ExecuteAsync(
                &quot;sp_routing_history_insert&quot;,
                parameters,
                _connectionString
            );
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure($&quot;Error inserting history: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Issue #18: Batch inserts multiple history entries to avoid N+1 query problem
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;historyEntries&quot;&gt;List of history entries to insert&lt;/param&gt;
    /// &lt;returns&gt;Result indicating success or failure&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&gt; InsertHistoryBatchAsync(List&lt;Model_RoutingLabelHistory&gt; historyEntries)
    {
        if (historyEntries == null || historyEntries.Count == 0)
        {
            return Model_Dao_Result_Factory.Success(&quot;No history entries to insert&quot;, 0);
        }

        try
        {
            int successCount = 0;
            foreach (var history in historyEntries)
            {
                var result = await InsertHistoryAsync(history);
                if (!result.IsSuccess)
                {
                    return Model_Dao_Result_Factory.Failure($&quot;Batch insert failed at entry {successCount + 1}: {result.ErrorMessage}&quot;);
                }
                successCount++;
            }

            return Model_Dao_Result_Factory.Success($&quot;Inserted {successCount} history entries&quot;, successCount);
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure($&quot;Error in batch insert: {ex.Message}&quot;, ex);
        }
    }

}</file><file path="Module_Routing/Services/RoutingInforVisualService.cs">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Data;
using MTM_Receiving_Application.Module_Routing.Models;

namespace MTM_Receiving_Application.Module_Routing.Services;

/// &lt;summary&gt;
/// Service for Infor Visual ERP integration (READ ONLY)
/// Provides PO validation and line retrieval with graceful degradation
/// &lt;/summary&gt;
public class RoutingInforVisualService : IRoutingInforVisualService
{
    private readonly Dao_InforVisualPO _daoInforVisualPO;
    private readonly IService_LoggingUtility _logger;
    private readonly bool _useMockData;

    public RoutingInforVisualService(
        Dao_InforVisualPO daoInforVisualPO,
        IService_LoggingUtility logger,
        bool useMockData = false)
    {
        _daoInforVisualPO = daoInforVisualPO ?? throw new ArgumentNullException(nameof(daoInforVisualPO));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
        _useMockData = useMockData;
    }

    /// &lt;summary&gt;
    /// Validates that a PO number exists in Infor Visual ERP
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;PO number to validate&lt;/param&gt;
    /// &lt;returns&gt;Result with true if PO exists, false otherwise&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;bool&gt;&gt; ValidatePoNumberAsync(string poNumber)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Validating PO number: {poNumber}&quot;);

            if (_useMockData)
            {
                await _logger.LogInfoAsync($&quot;[MOCK DATA MODE] Validating PO {poNumber}&quot;);
                return Model_Dao_Result_Factory.Success(true);
            }

            // Check connection first (graceful degradation)
            var connectionResult = await _daoInforVisualPO.CheckConnectionAsync();
            if (!connectionResult.IsSuccess || !connectionResult.Data)
            {
                await _logger.LogWarningAsync($&quot;Infor Visual unavailable: {connectionResult.ErrorMessage}&quot;);
                // Graceful degradation: return success but log the issue
                return Model_Dao_Result_Factory.Success(true);
            }

            return await _daoInforVisualPO.ValidatePOAsync(poNumber);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error validating PO {poNumber}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;bool&gt;($&quot;Error validating PO: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Retrieves all line items for a purchase order from Infor Visual
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;PO number&lt;/param&gt;
    /// &lt;returns&gt;Result with list of PO lines&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_InforVisualPOLine&gt;&gt;&gt; GetPoLinesAsync(string poNumber)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Getting PO lines for: {poNumber}&quot;);

            if (_useMockData)
            {
                await _logger.LogInfoAsync($&quot;[MOCK DATA MODE] Returning mock lines for PO {poNumber}&quot;);
                var mockLines = new List&lt;Model_InforVisualPOLine&gt;
                {
                    new Model_InforVisualPOLine
                    {
                        PONumber = poNumber,
                        LineNumber = &quot;1&quot;,
                        PartID = &quot;MOCK-PART-001&quot;,
                        Description = &quot;Mock Part 1 Description&quot;,
                        QuantityOrdered = 100,
                        QuantityReceived = 0,
                        VendorName = &quot;MOCK VENDOR&quot;,
                        Specifications = &quot;These are mock specifications for part 1. They are long enough to be truncated in the display.&quot;
                    },
                    new Model_InforVisualPOLine
                    {
                        PONumber = poNumber,
                        LineNumber = &quot;2&quot;,
                        PartID = &quot;MOCK-PART-002&quot;,
                        Description = &quot;Mock Part 2 Description&quot;,
                        QuantityOrdered = 50,
                        QuantityReceived = 10,
                        VendorName = &quot;MOCK VENDOR&quot;,
                        Specifications = &quot;Short specs.&quot;
                    }
                };
                return Model_Dao_Result_Factory.Success(mockLines);
            }

            return await _daoInforVisualPO.GetLinesAsync(poNumber);
        }
        catch (Exception ex)
        {
            // Issue #11: Standardized error handling pattern
            await _logger.LogErrorAsync($&quot;Error getting PO lines for {poNumber}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_InforVisualPOLine&gt;&gt;($&quot;Failed to retrieve PO lines: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Retrieves a specific line item from a purchase order
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;PO number&lt;/param&gt;
    /// &lt;param name=&quot;lineNumber&quot;&gt;Line number&lt;/param&gt;
    /// &lt;returns&gt;Result with PO line data&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_InforVisualPOLine&gt;&gt; GetPoLineAsync(string poNumber, string lineNumber)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Getting PO line {poNumber}-{lineNumber}&quot;);

            if (_useMockData)
            {
                await _logger.LogInfoAsync($&quot;[MOCK DATA MODE] Returning mock data for line {lineNumber}&quot;);
                var mockLine = new Model_InforVisualPOLine
                {
                    PONumber = poNumber,
                    LineNumber = lineNumber,
                    PartID = $&quot;MOCK-PART-{lineNumber.PadLeft(3, &apos;0&apos;)}&quot;,
                    Description = $&quot;Mock Part {lineNumber} Description&quot;,
                    QuantityOrdered = 100,
                    QuantityReceived = 0,
                    VendorName = &quot;MOCK VENDOR&quot;
                };
                return Model_Dao_Result_Factory.Success(mockLine);
            }

            if (!int.TryParse(lineNumber, out int lineNum))
            {
                return Model_Dao_Result_Factory.Failure&lt;Model_InforVisualPOLine&gt;(&quot;Invalid line number format&quot;);
            }

            return await _daoInforVisualPO.GetLineAsync(poNumber, lineNum);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error getting PO line {poNumber}-{lineNumber}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;Model_InforVisualPOLine&gt;($&quot;Error getting PO line: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Tests connection to Infor Visual database
    /// &lt;/summary&gt;
    /// &lt;returns&gt;Result with true if connection successful&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;bool&gt;&gt; CheckConnectionAsync()
    {
        try
        {
            return await _daoInforVisualPO.CheckConnectionAsync();
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error checking Infor Visual connection: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Success(false);
        }
    }
}</file><file path="Module_Routing/Views/RoutingWizardStep3View.xaml">&lt;Page
    x:Class=&quot;MTM_Receiving_Application.Module_Routing.Views.RoutingWizardStep3View&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:vm=&quot;using:MTM_Receiving_Application.Module_Routing.ViewModels&quot;
    xmlns:coreConverters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    Loaded=&quot;OnPageLoaded&quot;&gt;

    &lt;Page.Resources&gt;
        &lt;coreConverters:Converter_BooleanToVisibility x:Key=&quot;BooleanToVisibilityConverter&quot;/&gt;
    &lt;/Page.Resources&gt;

    &lt;Grid Padding=&quot;24&quot; RowSpacing=&quot;16&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header --&gt;
        &lt;TextBlock Grid.Row=&quot;0&quot; 
                   Text=&quot;Step 3: Review and Confirm&quot; 
                   Style=&quot;{StaticResource TitleTextBlockStyle}&quot;/&gt;

        &lt;!-- Review Cards --&gt;
        &lt;ScrollViewer Grid.Row=&quot;1&quot; VerticalScrollBarVisibility=&quot;Auto&quot;&gt;
            &lt;Grid ColumnSpacing=&quot;24&quot; RowSpacing=&quot;24&quot;&gt;
                &lt;Grid.ColumnDefinitions&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                &lt;/Grid.ColumnDefinitions&gt;
                &lt;Grid.RowDefinitions&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                    &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                &lt;/Grid.RowDefinitions&gt;

                &lt;!-- Source Card (PO &amp; Part) --&gt;
                &lt;Border Grid.Column=&quot;0&quot; Grid.Row=&quot;0&quot;
                        Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                        BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                        BorderThickness=&quot;1&quot;
                        CornerRadius=&quot;8&quot;
                        Padding=&quot;20&quot;&gt;
                    &lt;StackPanel Spacing=&quot;16&quot;&gt;
                        &lt;Grid&gt;
                            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                &lt;FontIcon Glyph=&quot;&amp;#xE8B9;&quot; FontSize=&quot;16&quot; Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                                &lt;TextBlock Text=&quot;Source&quot; Style=&quot;{ThemeResource SubtitleTextBlockStyle}&quot;/&gt;
                            &lt;/StackPanel&gt;
                            &lt;Button HorizontalAlignment=&quot;Right&quot;
                                    Command=&quot;{x:Bind ViewModel.EditPOSelectionCommand}&quot;
                                    Style=&quot;{StaticResource SubtleButtonStyle}&quot; 
                                    ToolTipService.ToolTip=&quot;Edit Source&quot;&gt;
                                &lt;FontIcon Glyph=&quot;&amp;#xE70F;&quot; FontSize=&quot;14&quot;/&gt;
                            &lt;/Button&gt;
                        &lt;/Grid&gt;
                        
                        &lt;MenuFlyoutSeparator/&gt;

                        &lt;!-- PO Info --&gt;
                        &lt;Grid ColumnSpacing=&quot;12&quot; RowSpacing=&quot;8&quot;&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            &lt;Grid.RowDefinitions&gt;
                                &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                                &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                            &lt;/Grid.RowDefinitions&gt;

                            &lt;TextBlock Text=&quot;PO:&quot; FontWeight=&quot;SemiBold&quot; Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                            &lt;TextBlock Grid.Column=&quot;1&quot; Text=&quot;{x:Bind ViewModel.PoNumber, Mode=OneWay}&quot; FontWeight=&quot;SemiBold&quot;/&gt;

                            &lt;TextBlock Grid.Row=&quot;1&quot; Text=&quot;Line:&quot; FontWeight=&quot;SemiBold&quot; Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                                       Visibility=&quot;{x:Bind ViewModel.IsOtherWorkflow, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}&quot;/&gt;
                            &lt;TextBlock Grid.Row=&quot;1&quot; Grid.Column=&quot;1&quot; Text=&quot;{x:Bind ViewModel.PoLine, Mode=OneWay}&quot;
                                       Visibility=&quot;{x:Bind ViewModel.IsOtherWorkflow, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}&quot;/&gt;
                                       
                            &lt;TextBlock Grid.Row=&quot;1&quot; Text=&quot;Reason:&quot; FontWeight=&quot;SemiBold&quot; Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                                       Visibility=&quot;{x:Bind ViewModel.IsOtherWorkflow, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;
                            &lt;TextBlock Grid.Row=&quot;1&quot; Grid.Column=&quot;1&quot; Text=&quot;{x:Bind ViewModel.OtherReason, Mode=OneWay}&quot;
                                       Visibility=&quot;{x:Bind ViewModel.IsOtherWorkflow, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;
                        &lt;/Grid&gt;
                        
                        &lt;!-- Part Info --&gt;
                        &lt;Grid Background=&quot;{ThemeResource LayerFillColorDefaultBrush}&quot; CornerRadius=&quot;4&quot; Padding=&quot;12&quot;&gt;
                             &lt;StackPanel Spacing=&quot;4&quot;&gt;
                                &lt;TextBlock Text=&quot;{x:Bind ViewModel.PartID, Mode=OneWay}&quot; Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot;/&gt;
                                &lt;TextBlock Text=&quot;{x:Bind ViewModel.PartDescription, Mode=OneWay}&quot; TextWrapping=&quot;Wrap&quot; Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;/&gt;
                                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;4&quot; Margin=&quot;0,8,0,0&quot;&gt;
                                    &lt;TextBlock Text=&quot;Qty:&quot; FontWeight=&quot;SemiBold&quot;/&gt;
                                    &lt;TextBlock Text=&quot;{x:Bind ViewModel.Quantity, Mode=OneWay}&quot;/&gt;
                                &lt;/StackPanel&gt;
                             &lt;/StackPanel&gt;
                        &lt;/Grid&gt;
                    &lt;/StackPanel&gt;
                &lt;/Border&gt;

                &lt;!-- Destination Card (Recipient) --&gt;
                &lt;Border Grid.Column=&quot;1&quot; Grid.Row=&quot;0&quot;
                        Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                        BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                        BorderThickness=&quot;1&quot;
                        CornerRadius=&quot;8&quot;
                        Padding=&quot;20&quot;&gt;
                     &lt;StackPanel Spacing=&quot;16&quot;&gt;
                        &lt;Grid&gt;
                            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                                &lt;FontIcon Glyph=&quot;&amp;#xE77B;&quot; FontSize=&quot;16&quot; Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                                &lt;TextBlock Text=&quot;Destination&quot; Style=&quot;{ThemeResource SubtitleTextBlockStyle}&quot;/&gt;
                            &lt;/StackPanel&gt;
                            &lt;Button HorizontalAlignment=&quot;Right&quot;
                                    Command=&quot;{x:Bind ViewModel.EditRecipientSelectionCommand}&quot;
                                    Style=&quot;{StaticResource SubtleButtonStyle}&quot;
                                    ToolTipService.ToolTip=&quot;Edit Destination&quot;&gt;
                                &lt;FontIcon Glyph=&quot;&amp;#xE70F;&quot; FontSize=&quot;14&quot;/&gt;
                            &lt;/Button&gt;
                        &lt;/Grid&gt;

                        &lt;MenuFlyoutSeparator/&gt;

                        &lt;StackPanel Spacing=&quot;12&quot;&gt;
                            &lt;StackPanel Spacing=&quot;4&quot;&gt;
                                &lt;TextBlock Text=&quot;Recipient&quot; Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; FontSize=&quot;12&quot;/&gt;
                                &lt;TextBlock Text=&quot;{x:Bind ViewModel.RecipientName, Mode=OneWay}&quot; Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot; FontSize=&quot;16&quot;/&gt;
                            &lt;/StackPanel&gt;
                            
                            &lt;StackPanel Spacing=&quot;4&quot;&gt;
                                &lt;TextBlock Text=&quot;Location / Department&quot; Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; FontSize=&quot;12&quot;/&gt;
                                &lt;TextBlock Text=&quot;{x:Bind ViewModel.RecipientLocation, Mode=OneWay}&quot;/&gt;
                            &lt;/StackPanel&gt;
                        &lt;/StackPanel&gt;
                        
                        &lt;!-- Placeholder for Label Preview --&gt;
                        &lt;Border Height=&quot;60&quot; Background=&quot;{ThemeResource LayerFillColorDefaultBrush}&quot; CornerRadius=&quot;4&quot; VerticalAlignment=&quot;Bottom&quot; Margin=&quot;0,16,0,0&quot;&gt;
                            &lt;StackPanel Orientation=&quot;Horizontal&quot; HorizontalAlignment=&quot;Center&quot; VerticalAlignment=&quot;Center&quot; Spacing=&quot;8&quot;&gt;
                                &lt;FontIcon Glyph=&quot;&amp;#xE743;&quot; FontSize=&quot;16&quot; Foreground=&quot;{ThemeResource TextFillColorTertiaryBrush}&quot;/&gt;
                                &lt;TextBlock Text=&quot;Ready to Print&quot; Foreground=&quot;{ThemeResource TextFillColorTertiaryBrush}&quot;/&gt;
                            &lt;/StackPanel&gt;
                        &lt;/Border&gt;
                    &lt;/StackPanel&gt;
                &lt;/Border&gt;
            &lt;/Grid&gt;
        &lt;/ScrollViewer&gt;

        &lt;!-- Status Bar --&gt;
        &lt;StackPanel Grid.Row=&quot;2&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot;&gt;
            &lt;ProgressRing IsActive=&quot;{x:Bind ViewModel.IsBusy, Mode=OneWay}&quot;
                          Width=&quot;20&quot; Height=&quot;20&quot;/&gt;
            &lt;TextBlock Text=&quot;{x:Bind ViewModel.StatusMessage, Mode=OneWay}&quot;
                       VerticalAlignment=&quot;Center&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Action Buttons --&gt;
        &lt;StackPanel Grid.Row=&quot;3&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot; HorizontalAlignment=&quot;Right&quot;&gt;
            &lt;Button Content=&quot;Back&quot;
                    Command=&quot;{x:Bind ViewModel.NavigateBackCommand}&quot;/&gt;
            &lt;Button Content=&quot;Create Label&quot;
                    Command=&quot;{x:Bind ViewModel.CreateLabelCommand}&quot;
                    Style=&quot;{StaticResource AccentButtonStyle}&quot;/&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Volvo/Data/Dao_VolvoPart.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Volvo.Models;
using MTM_Receiving_Application.Module_Core.Helpers.Database;

namespace MTM_Receiving_Application.Module_Volvo.Data;

/// &lt;summary&gt;
/// Data Access Object for volvo_masterdata table
/// Provides CRUD operations using stored procedures
/// &lt;/summary&gt;
public class Dao_VolvoPart
{
    private readonly string _connectionString;

    public Dao_VolvoPart(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Gets all Volvo parts (optionally including inactive)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;includeInactive&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoPart&gt;&gt;&gt; GetAllAsync(bool includeInactive = false)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;include_inactive&quot;, includeInactive ? 1 : 0 }
        };

        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Volvo_PartMaster_GetAll&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Gets a part by part number
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;partNumber&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_VolvoPart&gt;&gt; GetByIdAsync(string partNumber)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;part_number&quot;, partNumber }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Volvo_PartMaster_GetById&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Inserts a new Volvo part
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;part&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; InsertAsync(Model_VolvoPart part)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;part_number&quot;, part.PartNumber },
            { &quot;quantity_per_skid&quot;, part.QuantityPerSkid },
            { &quot;is_active&quot;, part.IsActive ? 1 : 0 }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Volvo_PartMaster_Insert&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Updates an existing Volvo part
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;part&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; UpdateAsync(Model_VolvoPart part)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;part_number&quot;, part.PartNumber },
            { &quot;quantity_per_skid&quot;, part.QuantityPerSkid }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Volvo_PartMaster_Update&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Deactivates a Volvo part (soft delete)
    /// Checks for active shipment references before deactivation
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;partNumber&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; DeactivateAsync(string partNumber)
    {
        // Check for active references
        var checkParams = new Dictionary&lt;string, object&gt;
        {
            { &quot;part_number&quot;, partNumber },
            { &quot;active_reference_count&quot;, 0 } // OUT parameter
        };

        var checkResult = await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_volvo_part_check_references&quot;,
            checkParams
        );

        // Note: Output parameters not yet supported by helper - skip check for now
        // TODO: Implement when stored proc helper supports OUT parameters
        // For now, cascade protection is logged but not enforced

        // Safe to deactivate
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;part_number&quot;, partNumber },
            { &quot;is_active&quot;, 0 }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Volvo_PartMaster_SetActive&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Gets multiple parts by part numbers (batch query to avoid N+1)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;partNumbers&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Dictionary&lt;string, Model_VolvoPart&gt;&gt;&gt; GetPartsByNumbersAsync(List&lt;string&gt; partNumbers)
    {
        if (partNumbers == null || partNumbers.Count == 0)
        {
            return new Model_Dao_Result&lt;Dictionary&lt;string, Model_VolvoPart&gt;&gt;
            {
                Success = true,
                Data = new Dictionary&lt;string, Model_VolvoPart&gt;()
            };
        }

        try
        {
            var result = new Dictionary&lt;string, Model_VolvoPart&gt;();

            // For now, use multiple queries (better than N+1, can be optimized with stored proc)
            foreach (var partNumber in partNumbers)
            {
                var partResult = await GetByIdAsync(partNumber);
                if (partResult.IsSuccess &amp;&amp; partResult.Data != null)
                {
                    result[partNumber] = partResult.Data;
                }
            }

            return new Model_Dao_Result&lt;Dictionary&lt;string, Model_VolvoPart&gt;&gt;
            {
                Success = true,
                Data = result
            };
        }
        catch (Exception ex)
        {
            return new Model_Dao_Result&lt;Dictionary&lt;string, Model_VolvoPart&gt;&gt;
            {
                Success = false,
                ErrorMessage = $&quot;Error retrieving parts batch: {ex.Message}&quot;,
                Severity = Enum_ErrorSeverity.Error,
                Exception = ex
            };
        }
    }

    private static Model_VolvoPart MapFromReader(IDataReader reader)
    {
        return new Model_VolvoPart
        {
            PartNumber = reader.GetString(reader.GetOrdinal(&quot;part_number&quot;)),
            QuantityPerSkid = reader.GetInt32(reader.GetOrdinal(&quot;quantity_per_skid&quot;)),
            IsActive = reader.GetBoolean(reader.GetOrdinal(&quot;is_active&quot;)),
            CreatedDate = reader.GetDateTime(reader.GetOrdinal(&quot;created_date&quot;)),
            ModifiedDate = reader.GetDateTime(reader.GetOrdinal(&quot;modified_date&quot;))
        };
    }
}</file><file path="Module_Volvo/Data/Dao_VolvoSettings.cs">using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Volvo.Models;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Volvo.Data;

/// &lt;summary&gt;
/// Data Access Object for Volvo settings operations
/// &lt;/summary&gt;
public class Dao_VolvoSettings
{
    private readonly string _connectionString;

    public Dao_VolvoSettings(string connectionString)
    {
        _connectionString = connectionString;
    }

    /// &lt;summary&gt;
    /// Gets a specific setting by key
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;settingKey&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_VolvoSetting&gt;&gt; GetSettingAsync(string settingKey)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;setting_key&quot;, settingKey }
        };

        return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Volvo_Settings_Get&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Gets all settings, optionally filtered by category
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;category&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoSetting&gt;&gt;&gt; GetAllSettingsAsync(string? category = null)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;category&quot;, category ?? string.Empty }
        };

        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Volvo_Settings_GetAll&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Inserts or updates a setting value
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;settingKey&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;settingValue&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;modifiedBy&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; UpsertSettingAsync(string settingKey, string settingValue, string modifiedBy)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;setting_key&quot;, settingKey },
            { &quot;setting_value&quot;, settingValue },
            { &quot;modified_by&quot;, modifiedBy }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Volvo_Settings_Upsert&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Resets a setting to its default value
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;settingKey&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;modifiedBy&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; ResetSettingAsync(string settingKey, string modifiedBy)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;setting_key&quot;, settingKey },
            { &quot;modified_by&quot;, modifiedBy }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Volvo_Settings_Reset&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Maps DataReader to Model_VolvoSetting
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;reader&quot;&gt;&lt;/param&gt;
    private static Model_VolvoSetting MapFromReader(IDataReader reader)
    {
        return new Model_VolvoSetting
        {
            SettingKey = reader.GetString(reader.GetOrdinal(&quot;setting_key&quot;)),
            SettingValue = reader.GetString(reader.GetOrdinal(&quot;setting_value&quot;)),
            SettingType = reader.GetString(reader.GetOrdinal(&quot;setting_type&quot;)),
            Category = reader.GetString(reader.GetOrdinal(&quot;category&quot;)),
            Description = reader.IsDBNull(reader.GetOrdinal(&quot;description&quot;))
                ? null
                : reader.GetString(reader.GetOrdinal(&quot;description&quot;)),
            DefaultValue = reader.GetString(reader.GetOrdinal(&quot;default_value&quot;)),
            MinValue = reader.IsDBNull(reader.GetOrdinal(&quot;min_value&quot;))
                ? null
                : reader.GetInt32(reader.GetOrdinal(&quot;min_value&quot;)),
            MaxValue = reader.IsDBNull(reader.GetOrdinal(&quot;max_value&quot;))
                ? null
                : reader.GetInt32(reader.GetOrdinal(&quot;max_value&quot;)),
            ModifiedDate = reader.GetDateTime(reader.GetOrdinal(&quot;modified_date&quot;)),
            ModifiedBy = reader.IsDBNull(reader.GetOrdinal(&quot;modified_by&quot;))
                ? null
                : reader.GetString(reader.GetOrdinal(&quot;modified_by&quot;))
        };
    }
}</file><file path="Module_Volvo/Data/Dao_VolvoShipmentLine.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Volvo.Models;
using MTM_Receiving_Application.Module_Core.Helpers.Database;

namespace MTM_Receiving_Application.Module_Volvo.Data;

/// &lt;summary&gt;
/// Data Access Object for volvo_line_data table
/// Provides CRUD operations using stored procedures
/// &lt;/summary&gt;
public class Dao_VolvoShipmentLine
{
    private readonly string _connectionString;

    public Dao_VolvoShipmentLine(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Inserts a new shipment line
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;line&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; InsertAsync(Model_VolvoShipmentLine line)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;shipment_id&quot;, line.ShipmentId },
            { &quot;part_number&quot;, line.PartNumber },
            { &quot;quantity_per_skid&quot;, line.QuantityPerSkid },
            { &quot;received_skid_count&quot;, line.ReceivedSkidCount },
            { &quot;calculated_piece_count&quot;, line.CalculatedPieceCount },
            { &quot;has_discrepancy&quot;, line.HasDiscrepancy ? 1 : 0 },
            { &quot;expected_skid_count&quot;, line.ExpectedSkidCount ?? (object)DBNull.Value },
            { &quot;discrepancy_note&quot;, line.DiscrepancyNote ?? (object)DBNull.Value }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Volvo_ShipmentLine_Insert&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Gets all lines for a shipment
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipmentId&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoShipmentLine&gt;&gt;&gt; GetByShipmentIdAsync(int shipmentId)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;shipment_id&quot;, shipmentId }
        };

        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Volvo_ShipmentLine_GetByShipment&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Updates a shipment line
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;line&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; UpdateAsync(Model_VolvoShipmentLine line)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;id&quot;, line.Id },
            { &quot;received_skid_count&quot;, line.ReceivedSkidCount },
            { &quot;calculated_piece_count&quot;, line.CalculatedPieceCount },
            { &quot;has_discrepancy&quot;, line.HasDiscrepancy ? 1 : 0 },
            { &quot;expected_skid_count&quot;, line.ExpectedSkidCount ?? (object)DBNull.Value },
            { &quot;discrepancy_note&quot;, line.DiscrepancyNote ?? (object)DBNull.Value }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Volvo_ShipmentLine_Update&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Deletes a shipment line
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;lineId&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; DeleteAsync(int lineId)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;id&quot;, lineId }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_Volvo_ShipmentLine_Delete&quot;,
            parameters
        );
    }

    private static Model_VolvoShipmentLine MapFromReader(IDataReader reader)
    {
        return new Model_VolvoShipmentLine
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            ShipmentId = reader.GetInt32(reader.GetOrdinal(&quot;shipment_id&quot;)),
            PartNumber = reader.GetString(reader.GetOrdinal(&quot;part_number&quot;)),
            QuantityPerSkid = reader.GetInt32(reader.GetOrdinal(&quot;quantity_per_skid&quot;)),
            ReceivedSkidCount = reader.GetInt32(reader.GetOrdinal(&quot;received_skid_count&quot;)),
            CalculatedPieceCount = reader.GetInt32(reader.GetOrdinal(&quot;calculated_piece_count&quot;)),
            HasDiscrepancy = reader.GetBoolean(reader.GetOrdinal(&quot;has_discrepancy&quot;)),
            ExpectedSkidCount = reader.IsDBNull(reader.GetOrdinal(&quot;expected_skid_count&quot;))
                ? null
                : reader.GetInt32(reader.GetOrdinal(&quot;expected_skid_count&quot;)),
            DiscrepancyNote = reader.IsDBNull(reader.GetOrdinal(&quot;discrepancy_note&quot;))
                ? null
                : reader.GetString(reader.GetOrdinal(&quot;discrepancy_note&quot;))
        };
    }
}</file><file path="Module_Volvo/Services/Service_VolvoMasterData.cs">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Volvo.Contracts;
using MTM_Receiving_Application.Module_Volvo.Data;
using MTM_Receiving_Application.Module_Volvo.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Volvo.Services;

/// &lt;summary&gt;
/// Service for managing Volvo parts master data including CRUD operations and CSV import/export
/// &lt;/summary&gt;
public class Service_VolvoMasterData : IService_VolvoMasterData
{
    private readonly Dao_VolvoPart _daoPart;
    private readonly Dao_VolvoPartComponent _daoComponent;
    private readonly IService_LoggingUtility _logger;
    private readonly IService_ErrorHandler _errorHandler;

    public Service_VolvoMasterData(
        Dao_VolvoPart daoPart,
        Dao_VolvoPartComponent daoComponent,
        IService_LoggingUtility logger,
        IService_ErrorHandler errorHandler)
    {
        _daoPart = daoPart ?? throw new ArgumentNullException(nameof(daoPart));
        _daoComponent = daoComponent ?? throw new ArgumentNullException(nameof(daoComponent));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
        _errorHandler = errorHandler ?? throw new ArgumentNullException(nameof(errorHandler));
    }

    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoPart&gt;&gt;&gt; GetAllPartsAsync(bool includeInactive)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Getting all Volvo parts (includeInactive={includeInactive})&quot;);
            var result = await _daoPart.GetAllAsync(includeInactive);

            if (!result.IsSuccess)
            {
                await _logger.LogErrorAsync($&quot;Failed to get parts: {result.ErrorMessage}&quot;);
            }

            return result;
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error getting all parts: {ex.Message}&quot;, ex);
            await _errorHandler.HandleErrorAsync(
                &quot;Failed to retrieve parts catalog&quot;,
                Enum_ErrorSeverity.Medium,
                ex,
                showDialog: false);
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_VolvoPart&gt;&gt;($&quot;Error retrieving parts: {ex.Message}&quot;);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;Model_VolvoPart?&gt;&gt; GetPartByNumberAsync(string partNumber)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Getting part by number: {partNumber}&quot;);
            var result = await _daoPart.GetByIdAsync(partNumber);

            if (!result.IsSuccess)
            {
                await _logger.LogErrorAsync($&quot;Failed to get part {partNumber}: {result.ErrorMessage}&quot;);
                return Model_Dao_Result_Factory.Failure&lt;Model_VolvoPart?&gt;(result.ErrorMessage);
            }

            return Model_Dao_Result_Factory.Success&lt;Model_VolvoPart?&gt;(result.Data);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error getting part {partNumber}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;Model_VolvoPart?&gt;($&quot;Error retrieving part: {ex.Message}&quot;);
        }
    }

    public async Task&lt;Model_Dao_Result&gt; AddPartAsync(Model_VolvoPart part, List&lt;Model_VolvoPartComponent&gt;? components = null)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Adding new part: {part.PartNumber}&quot;);

            // Validate input
            if (string.IsNullOrWhiteSpace(part.PartNumber))
            {
                return Model_Dao_Result_Factory.Failure(&quot;Part number is required&quot;);
            }

            if (part.QuantityPerSkid &lt; 0)
            {
                return Model_Dao_Result_Factory.Failure(&quot;Quantity per skid must be non-negative&quot;);
            }

            // Insert new part
            var insertResult = await _daoPart.InsertAsync(part);
            if (!insertResult.IsSuccess)
            {
                await _logger.LogErrorAsync($&quot;Failed to insert part {part.PartNumber}: {insertResult.ErrorMessage}&quot;);
                return Model_Dao_Result_Factory.Failure(insertResult.ErrorMessage);
            }

            // Insert components if provided
            if (components?.Any() == true)
            {
                foreach (var component in components)
                {
                    component.ParentPartNumber = part.PartNumber;
                    var componentResult = await _daoComponent.InsertAsync(component);
                    if (!componentResult.IsSuccess)
                    {
                        await _logger.LogErrorAsync($&quot;Failed to insert component {component.ComponentPartNumber}: {componentResult.ErrorMessage}&quot;);
                        return Model_Dao_Result_Factory.Failure($&quot;Failed to save component {component.ComponentPartNumber}&quot;);
                    }
                }
            }

            await _logger.LogInfoAsync($&quot;Successfully added part {part.PartNumber} with {components?.Count ?? 0} components&quot;);
            return Model_Dao_Result_Factory.Success(&quot;Part added successfully&quot;);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error adding part {part.PartNumber}: {ex.Message}&quot;, ex);
            await _errorHandler.HandleErrorAsync(
                $&quot;Failed to add part {part.PartNumber}&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                showDialog: false);
            return Model_Dao_Result_Factory.Failure($&quot;Error adding part: {ex.Message}&quot;);
        }
    }

    public async Task&lt;Model_Dao_Result&gt; UpdatePartAsync(Model_VolvoPart part, List&lt;Model_VolvoPartComponent&gt;? components = null)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Updating part: {part.PartNumber}&quot;);

            // Validate input
            if (string.IsNullOrWhiteSpace(part.PartNumber))
            {
                return Model_Dao_Result_Factory.Failure(&quot;Part number is required&quot;);
            }

            if (part.QuantityPerSkid &lt; 0)
            {
                return Model_Dao_Result_Factory.Failure(&quot;Quantity per skid must be non-negative&quot;);
            }

            // Update existing part
            var updateResult = await _daoPart.UpdateAsync(part);
            if (!updateResult.IsSuccess)
            {
                await _logger.LogErrorAsync($&quot;Failed to update part {part.PartNumber}: {updateResult.ErrorMessage}&quot;);
                return Model_Dao_Result_Factory.Failure(updateResult.ErrorMessage);
            }

            // Update components (delete existing and re-insert)
            if (components?.Any() == true)
            {
                // Delete existing components
                var deleteResult = await _daoComponent.DeleteByParentPartAsync(part.PartNumber);
                if (!deleteResult.IsSuccess)
                {
                    await _logger.LogErrorAsync($&quot;Failed to delete components for {part.PartNumber}: {deleteResult.ErrorMessage}&quot;);
                    return Model_Dao_Result_Factory.Failure($&quot;Failed to update components: {deleteResult.ErrorMessage}&quot;);
                }

                // Insert new components
                foreach (var component in components)
                {
                    component.ParentPartNumber = part.PartNumber;
                    var insertResult = await _daoComponent.InsertAsync(component);
                    if (!insertResult.IsSuccess)
                    {
                        await _logger.LogErrorAsync($&quot;Failed to insert component {component.ComponentPartNumber}: {insertResult.ErrorMessage}&quot;);
                        return Model_Dao_Result_Factory.Failure($&quot;Failed to save component {component.ComponentPartNumber}&quot;);
                    }
                }
            }
            else
            {
                // No components - delete any existing ones
                await _daoComponent.DeleteByParentPartAsync(part.PartNumber);
            }

            await _logger.LogInfoAsync($&quot;Successfully updated part {part.PartNumber} with {components?.Count ?? 0} components&quot;);
            return Model_Dao_Result_Factory.Success(&quot;Part updated successfully&quot;);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error updating part {part.PartNumber}: {ex.Message}&quot;, ex);
            await _errorHandler.HandleErrorAsync(
                $&quot;Failed to update part {part.PartNumber}&quot;,
                Enum_ErrorSeverity.Error,
                ex,
                showDialog: false);
            return Model_Dao_Result_Factory.Failure($&quot;Error updating part: {ex.Message}&quot;);
        }
    }

    public async Task&lt;Model_Dao_Result&gt; DeactivatePartAsync(string partNumber)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Deactivating part: {partNumber}&quot;);

            var result = await _daoPart.DeactivateAsync(partNumber);

            if (!result.IsSuccess)
            {
                await _logger.LogErrorAsync($&quot;Failed to deactivate part {partNumber}: {result.ErrorMessage}&quot;);
            }
            else
            {
                await _logger.LogInfoAsync($&quot;Successfully deactivated part {partNumber}&quot;);
            }

            return result;
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error deactivating part {partNumber}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure($&quot;Error deactivating part: {ex.Message}&quot;);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoPartComponent&gt;&gt;&gt; GetComponentsAsync(string partNumber)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Getting components for part: {partNumber}&quot;);
            var result = await _daoComponent.GetByParentPartAsync(partNumber);

            if (!result.IsSuccess)
            {
                await _logger.LogErrorAsync($&quot;Failed to get components for {partNumber}: {result.ErrorMessage}&quot;);
            }

            return result;
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error getting components for {partNumber}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_VolvoPartComponent&gt;&gt;($&quot;Error retrieving components: {ex.Message}&quot;);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;(int New, int Updated, int Unchanged)&gt;&gt; ImportCsvAsync(string csvFilePath)
    {
        try
        {
            await _logger.LogInfoAsync(&quot;Starting CSV import&quot;);

            if (string.IsNullOrWhiteSpace(csvFilePath))
            {
                return Model_Dao_Result_Factory.Failure&lt;(int, int, int)&gt;(&quot;CSV content is empty&quot;);
            }

            var lines = csvFilePath.Split(&apos;\n&apos;).Select(l =&gt; l.Trim()).Where(l =&gt; !string.IsNullOrEmpty(l)).ToList();

            if (lines.Count &lt; 2)
            {
                return Model_Dao_Result_Factory.Failure&lt;(int, int, int)&gt;(&quot;CSV file must contain header and at least one data row&quot;);
            }

            // Validate header
            var header = lines[0];
            if (!header.Contains(&quot;PartNumber&quot;) || !header.Contains(&quot;QuantityPerSkid&quot;))
            {
                return Model_Dao_Result_Factory.Failure&lt;(int, int, int)&gt;(&quot;CSV must contain columns: PartNumber, QuantityPerSkid, Components&quot;);
            }

            int newCount = 0;
            int updatedCount = 0;
            int errorCount = 0;
            var errors = new List&lt;string&gt;();

            for (int i = 1; i &lt; lines.Count; i++)
            {
                try
                {
                    var fields = ParseCsvLine(lines[i]);

                    if (fields.Length &lt; 3)
                    {
                        errors.Add($&quot;Line {i + 1}: Invalid format - expected at least 3 fields&quot;);
                        errorCount++;
                        continue;
                    }

                    var partNumber = fields[0].Trim();
                    var quantityStr = fields[1].Trim();
                    var componentsStr = fields.Length &gt; 2 ? fields[2].Trim() : &quot;&quot;;

                    if (!int.TryParse(quantityStr, out int quantity))
                    {
                        errors.Add($&quot;Line {i + 1}: Invalid quantity &apos;{quantityStr}&apos;&quot;);
                        errorCount++;
                        continue;
                    }

                    var part = new Model_VolvoPart
                    {
                        PartNumber = partNumber,
                        QuantityPerSkid = quantity,
                        IsActive = true
                    };

                    // Parse components (format: &quot;PART1:QTY1;PART2:QTY2&quot;)
                    var components = new List&lt;Model_VolvoPartComponent&gt;();
                    if (!string.IsNullOrWhiteSpace(componentsStr))
                    {
                        var componentPairs = componentsStr.Split(&apos;;&apos;);
                        foreach (var pair in componentPairs)
                        {
                            var parts = pair.Split(&apos;:&apos;);
                            if (parts.Length == 2)
                            {
                                if (int.TryParse(parts[1], out int compQty))
                                {
                                    components.Add(new Model_VolvoPartComponent
                                    {
                                        ComponentPartNumber = parts[0].Trim(),
                                        Quantity = compQty
                                    });
                                }
                            }
                        }
                    }

                    // Check if exists
                    var existing = await _daoPart.GetByIdAsync(partNumber);
                    bool isNew = !existing.IsSuccess || existing.Data == null;

                    Model_Dao_Result saveResult;
                    if (isNew)
                    {
                        saveResult = await AddPartAsync(part, components);
                    }
                    else
                    {
                        saveResult = await UpdatePartAsync(part, components);
                    }

                    if (saveResult.IsSuccess)
                    {
                        if (isNew)
                        {
                            newCount++;
                        }
                        else
                        {
                            updatedCount++;
                        }
                    }
                    else
                    {
                        errors.Add($&quot;Line {i + 1}: {saveResult.ErrorMessage}&quot;);
                        errorCount++;
                    }
                }
                catch (Exception ex)
                {
                    errors.Add($&quot;Line {i + 1}: {ex.Message}&quot;);
                    errorCount++;
                }
            }

            var summary = $&quot;Import complete: {newCount} new, {updatedCount} updated, {errorCount} errors&quot;;
            await _logger.LogInfoAsync(summary);

            if (errors.Count &gt; 0)
            {
                summary += &quot;\nErrors:\n&quot; + string.Join(&quot;\n&quot;, errors);
            }

            return Model_Dao_Result_Factory.Success((newCount, updatedCount, errorCount));
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error importing CSV: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;(int, int, int)&gt;($&quot;Import failed: {ex.Message}&quot;);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;string&gt;&gt; ExportCsvAsync(string csvFilePath, bool includeInactive = false)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Exporting parts to CSV (includeInactive={includeInactive})&quot;);

            var partsResult = await GetAllPartsAsync(includeInactive);
            if (!partsResult.IsSuccess)
            {
                return Model_Dao_Result_Factory.Failure&lt;string&gt;(partsResult.ErrorMessage);
            }

            var csv = new StringBuilder();
            csv.AppendLine(&quot;PartNumber,QuantityPerSkid,Components&quot;);

            foreach (var part in partsResult.Data ?? new List&lt;Model_VolvoPart&gt;())
            {
                var componentsResult = await GetComponentsAsync(part.PartNumber ?? string.Empty);
                var componentsStr = &quot;&quot;;

                if (componentsResult.IsSuccess &amp;&amp; componentsResult.Data?.Any() == true)
                {
                    componentsStr = string.Join(&quot;;&quot;, componentsResult.Data.Select(c =&gt; $&quot;{c.ComponentPartNumber}:{c.Quantity}&quot;));
                }

                csv.AppendLine($&quot;{EscapeCsvField(part.PartNumber ?? string.Empty)},{part.QuantityPerSkid},{EscapeCsvField(componentsStr)}&quot;);
            }

            await _logger.LogInfoAsync($&quot;Export complete: {partsResult.Data?.Count ?? 0} parts&quot;);
            return Model_Dao_Result_Factory.Success(csv.ToString());
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error exporting CSV: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;string&gt;($&quot;Export failed: {ex.Message}&quot;);
        }
    }

    private string[] ParseCsvLine(string line)
    {
        var fields = new List&lt;string&gt;();
        var currentField = new StringBuilder();
        bool inQuotes = false;

        for (int i = 0; i &lt; line.Length; i++)
        {
            char c = line[i];

            if (c == &apos;&quot;&apos;)
            {
                inQuotes = !inQuotes;
            }
            else if (c == &apos;,&apos; &amp;&amp; !inQuotes)
            {
                fields.Add(currentField.ToString());
                currentField.Clear();
            }
            else
            {
                currentField.Append(c);
            }
        }

        fields.Add(currentField.ToString());
        return fields.ToArray();
    }

    private string EscapeCsvField(string field)
    {
        if (field == null)
        {
            return &quot;&quot;;
        }

        if (field.Contains(&quot;,&quot;) || field.Contains(&quot;\&quot;&quot;) || field.Contains(&quot;\n&quot;))
        {
            return &quot;\&quot;&quot; + field.Replace(&quot;\&quot;&quot;, &quot;\&quot;\&quot;&quot;) + &quot;\&quot;&quot;;
        }

        return field;
    }
}</file><file path="Module_Volvo/ViewModels/ViewModel_Volvo_History.cs">using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Volvo.Contracts;
using MTM_Receiving_Application.Module_Volvo.Models;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using System;
using System.Collections.ObjectModel;
using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Volvo.ViewModels;

/// &lt;summary&gt;
/// ViewModel for viewing and managing Volvo shipment history
/// &lt;/summary&gt;
public partial class ViewModel_Volvo_History : ViewModel_Shared_Base
{
    private readonly IService_Volvo _volvoService;

    #region Observable Properties

    [ObservableProperty]
    private ObservableCollection&lt;Model_VolvoShipment&gt; _history = new();

    [ObservableProperty]
    private Model_VolvoShipment? _selectedShipment;

    [ObservableProperty]
    private DateTimeOffset? _startDate = DateTimeOffset.Now.AddDays(-30);

    [ObservableProperty]
    private DateTimeOffset? _endDate = DateTimeOffset.Now;

    [ObservableProperty]
    private string _statusFilter = &quot;All&quot;;

    [ObservableProperty]
    private ObservableCollection&lt;string&gt; _statusOptions = new() { &quot;All&quot;, &quot;Pending PO&quot;, &quot;Completed&quot; };

    #endregion

    #region Constructor

    public ViewModel_Volvo_History(
        IService_Volvo volvoService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger)
        : base(errorHandler, logger)
    {
        _volvoService = volvoService ?? throw new ArgumentNullException(nameof(volvoService));
    }

    #endregion

    #region Navigation Commands

    [RelayCommand]
    private void GoBack()
    {
        if (App.MainWindow is MainWindow mainWindow)
        {
            var contentFrame = mainWindow.GetContentFrame();
            if (contentFrame != null &amp;&amp; contentFrame.CanGoBack)
            {
                contentFrame.GoBack();
            }
        }
    }

    #endregion

    #region Commands

    /// &lt;summary&gt;
    /// Loads shipment history based on current filters
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task FilterAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading history...&quot;;

            var result = await _volvoService.GetHistoryAsync(
                StartDate?.DateTime ?? DateTime.Now.AddDays(-30),
                EndDate?.DateTime ?? DateTime.Now,
                StatusFilter);

            if (result.IsSuccess &amp;&amp; result.Data != null)
            {
                History.Clear();
                foreach (var shipment in result.Data)
                {
                    History.Add(shipment);
                }
                StatusMessage = $&quot;Loaded {History.Count} shipment(s)&quot;;
            }
            else
            {
                await _errorHandler.ShowUserErrorAsync(
                    result.ErrorMessage ?? &quot;Failed to load history&quot;,
                    &quot;Load Error&quot;,
                    nameof(FilterAsync));
                StatusMessage = &quot;Failed to load history&quot;;
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Medium,
                nameof(FilterAsync),
                nameof(ViewModel_Volvo_History));
            StatusMessage = &quot;Error loading history&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Views details for the selected shipment
    /// &lt;/summary&gt;
    [RelayCommand(CanExecute = nameof(CanViewDetail))]
    private async Task ViewDetailAsync()
    {
        if (SelectedShipment == null)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = $&quot;Loading details for shipment #{SelectedShipment.ShipmentNumber}...&quot;;
            await _logger.LogInfoAsync($&quot;Loading details for shipment ID: {SelectedShipment.Id}&quot;);

            // Get shipment lines
            var result = await _volvoService.GetShipmentLinesAsync(SelectedShipment.Id);

            if (result.IsSuccess &amp;&amp; result.Data != null)
            {
                // Build detail message
                var details = new System.Text.StringBuilder();
                details.AppendLine($&quot;Shipment #{SelectedShipment.ShipmentNumber}&quot;);
                details.AppendLine($&quot;Date: {SelectedShipment.ShipmentDate:d}&quot;);
                details.AppendLine($&quot;PO Number: {SelectedShipment.PONumber ?? &quot;N/A&quot;}&quot;);
                details.AppendLine($&quot;Receiver: {SelectedShipment.ReceiverNumber ?? &quot;N/A&quot;}&quot;);
                details.AppendLine($&quot;Status: {SelectedShipment.Status}&quot;);
                details.AppendLine();
                details.AppendLine($&quot;Parts ({result.Data.Count}):&quot;);
                foreach (var line in result.Data)
                {
                    details.AppendLine($&quot;   {line.PartNumber}: {line.ReceivedSkidCount} skids ({line.CalculatedPieceCount} pieces)&quot;);
                    if (line.HasDiscrepancy)
                    {
                        details.AppendLine($&quot;     Discrepancy: Expected {line.ExpectedSkidCount} skids&quot;);
                    }
                }
                if (!string.IsNullOrWhiteSpace(SelectedShipment.Notes))
                {
                    details.AppendLine();
                    details.AppendLine($&quot;Notes: {SelectedShipment.Notes}&quot;);
                }

                // Show dialog
                var dialog = new ContentDialog
                {
                    Title = $&quot;Shipment #{SelectedShipment.ShipmentNumber} Details&quot;,
                    Content = new ScrollViewer
                    {
                        Content = new TextBlock
                        {
                            Text = details.ToString(),
                            TextWrapping = Microsoft.UI.Xaml.TextWrapping.Wrap,
                            FontFamily = new Microsoft.UI.Xaml.Media.FontFamily(&quot;Consolas&quot;)
                        },
                        MaxHeight = 500
                    },
                    CloseButtonText = &quot;Close&quot;,
                    XamlRoot = App.MainWindow?.Content?.XamlRoot
                };
                await dialog.ShowAsync();

                StatusMessage = $&quot;Viewed details for shipment #{SelectedShipment.ShipmentNumber}&quot;;
                await _logger.LogInfoAsync($&quot;Successfully loaded {result.Data.Count} lines&quot;);
            }
            else
            {
                await _errorHandler.ShowUserErrorAsync(
                    result.ErrorMessage ?? &quot;Failed to load shipment details&quot;,
                    &quot;Load Error&quot;,
                    nameof(ViewDetailAsync));
                StatusMessage = &quot;Failed to load details&quot;;
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Medium,
                nameof(ViewDetailAsync),
                nameof(ViewModel_Volvo_History));
            StatusMessage = &quot;Error loading details&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }

    private bool CanViewDetail() =&gt; SelectedShipment != null &amp;&amp; !IsBusy;

    /// &lt;summary&gt;
    /// Opens edit dialog for the selected shipment
    /// &lt;/summary&gt;
    [RelayCommand(CanExecute = nameof(CanEdit))]
    private async Task EditAsync()
    {
        if (SelectedShipment == null)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading shipment data...&quot;;

            // Get shipment lines
            var linesResult = await _volvoService.GetShipmentLinesAsync(SelectedShipment.Id);
            if (!linesResult.IsSuccess || linesResult.Data == null)
            {
                await _errorHandler.ShowUserErrorAsync(
                    linesResult.ErrorMessage ?? &quot;Failed to load shipment lines&quot;,
                    &quot;Load Error&quot;,
                    nameof(EditAsync));
                return;
            }

            // Get available parts for dropdown
            // Note: This would normally come from a master data service
            // For now, we&apos;ll create a placeholder collection
            var availableParts = new ObservableCollection&lt;Model_VolvoPart&gt;();

            // Create and show edit dialog
            var dialog = new Views.VolvoShipmentEditDialog
            {
                XamlRoot = App.MainWindow?.Content?.XamlRoot
            };

            // Convert List to ObservableCollection for binding
            var linesCollection = new ObservableCollection&lt;Model_VolvoShipmentLine&gt;(linesResult.Data);
            dialog.LoadShipment(SelectedShipment, linesCollection, availableParts);

            var result = await dialog.ShowAsync();

            if (result == Microsoft.UI.Xaml.Controls.ContentDialogResult.Primary)
            {
                StatusMessage = &quot;Saving changes...&quot;;

                // Get updated data from dialog
                var updatedShipment = dialog.GetUpdatedShipment();
                var updatedLines = dialog.GetUpdatedLines();

                // Call service to update shipment
                var updateResult = await _volvoService.UpdateShipmentAsync(
                    updatedShipment,
                    new System.Collections.Generic.List&lt;Model_VolvoShipmentLine&gt;(updatedLines));

                if (updateResult.IsSuccess)
                {
                    StatusMessage = $&quot;Shipment #{SelectedShipment.ShipmentNumber} updated successfully&quot;;

                    // Refresh history
                    await FilterAsync();
                }
                else
                {
                    await _errorHandler.ShowUserErrorAsync(
                        updateResult.ErrorMessage ?? &quot;Failed to update shipment&quot;,
                        &quot;Update Error&quot;,
                        nameof(EditAsync));
                    StatusMessage = &quot;Update failed&quot;;
                }
            }
            else
            {
                StatusMessage = &quot;Edit cancelled&quot;;
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Medium,
                nameof(EditAsync),
                nameof(ViewModel_Volvo_History));
            StatusMessage = &quot;Error editing shipment&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }

    private bool CanEdit() =&gt; SelectedShipment != null &amp;&amp; !IsBusy;

    /// &lt;summary&gt;
    /// Exports history to CSV file
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task ExportAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Exporting history...&quot;;

            var result = await _volvoService.ExportHistoryToCsvAsync(
                StartDate?.DateTime ?? DateTime.Now.AddDays(-30),
                EndDate?.DateTime ?? DateTime.Now,
                StatusFilter);

            if (result.IsSuccess &amp;&amp; !string.IsNullOrEmpty(result.Data))
            {
                // Save file picker would go here
                StatusMessage = $&quot;Exported {History.Count} record(s) to CSV&quot;;
            }
            else
            {
                await _errorHandler.ShowUserErrorAsync(
                    result.ErrorMessage ?? &quot;Failed to export history&quot;,
                    &quot;Export Error&quot;,
                    nameof(ExportAsync));
                StatusMessage = &quot;Export failed&quot;;
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Medium,
                nameof(ExportAsync),
                nameof(ViewModel_Volvo_History));
            StatusMessage = &quot;Error exporting history&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }

    #endregion

    #region Property Changed Handlers

    partial void OnSelectedShipmentChanged(Model_VolvoShipment? value)
    {
        ViewDetailCommand.NotifyCanExecuteChanged();
        EditCommand.NotifyCanExecuteChanged();
    }

    #endregion
}</file><file path="Module_Volvo/Views/VolvoShipmentEditDialog.xaml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;ContentDialog
    x:Class=&quot;MTM_Receiving_Application.Module_Volvo.Views.VolvoShipmentEditDialog&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:models=&quot;using:MTM_Receiving_Application.Module_Volvo.Models&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    Title=&quot;Edit Shipment&quot;
    PrimaryButtonText=&quot;Save Changes&quot;
    CloseButtonText=&quot;Cancel&quot;
    DefaultButton=&quot;Primary&quot;&gt;
    
    &lt;ContentDialog.Resources&gt;
        &lt;x:Double x:Key=&quot;ContentDialogMaxWidth&quot;&gt;1200&lt;/x:Double&gt;
        &lt;x:Double x:Key=&quot;ContentDialogMinWidth&quot;&gt;1200&lt;/x:Double&gt;
        &lt;converters:NullableDoubleToDoubleConverter x:Key=&quot;NullableDoubleToDoubleConverter&quot;/&gt;
    &lt;/ContentDialog.Resources&gt;

    &lt;ScrollViewer MaxHeight=&quot;600&quot;&gt;
        &lt;StackPanel Spacing=&quot;16&quot; Padding=&quot;24&quot;&gt;
            
            &lt;!-- Shipment Header --&gt;
            &lt;StackPanel Spacing=&quot;8&quot;&gt;
                &lt;TextBlock Text=&quot;Shipment Details&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;/&gt;
                
                &lt;Grid ColumnSpacing=&quot;12&quot; RowSpacing=&quot;8&quot;&gt;
                    &lt;Grid.ColumnDefinitions&gt;
                        &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                        &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;/Grid.ColumnDefinitions&gt;
                    &lt;Grid.RowDefinitions&gt;
                        &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                        &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                        &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                    &lt;/Grid.RowDefinitions&gt;
                    
                    &lt;!-- Shipment Date --&gt;
                    &lt;CalendarDatePicker
                        Grid.Row=&quot;0&quot; Grid.Column=&quot;0&quot;
                        Header=&quot;Shipment Date&quot;
                        x:Name=&quot;ShipmentDatePicker&quot;
                        HorizontalAlignment=&quot;Stretch&quot; /&gt;
                    
                    &lt;!-- Shipment Number (Read-only) --&gt;
                    &lt;TextBox
                        Grid.Row=&quot;0&quot; Grid.Column=&quot;1&quot;
                        Header=&quot;Shipment Number&quot;
                        x:Name=&quot;ShipmentNumberBox&quot;
                        IsReadOnly=&quot;True&quot;
                        HorizontalAlignment=&quot;Stretch&quot; /&gt;
                    
                    &lt;!-- PO Number --&gt;
                    &lt;TextBox
                        Grid.Row=&quot;1&quot; Grid.Column=&quot;0&quot;
                        Header=&quot;PO Number&quot;
                        PlaceholderText=&quot;Optional&quot;
                        x:Name=&quot;PONumberBox&quot;
                        HorizontalAlignment=&quot;Stretch&quot; /&gt;
                    
                    &lt;!-- Receiver Number --&gt;
                    &lt;TextBox
                        Grid.Row=&quot;1&quot; Grid.Column=&quot;1&quot;
                        Header=&quot;Receiver Number&quot;
                        PlaceholderText=&quot;Optional&quot;
                        x:Name=&quot;ReceiverNumberBox&quot;
                        HorizontalAlignment=&quot;Stretch&quot; /&gt;
                    
                    &lt;!-- Notes --&gt;
                    &lt;TextBox
                        Grid.Row=&quot;2&quot; Grid.Column=&quot;0&quot; Grid.ColumnSpan=&quot;2&quot;
                        Header=&quot;Notes&quot;
                        PlaceholderText=&quot;Optional notes&quot;
                        x:Name=&quot;NotesBox&quot;
                        TextWrapping=&quot;Wrap&quot;
                        AcceptsReturn=&quot;True&quot;
                        Height=&quot;80&quot;
                        HorizontalAlignment=&quot;Stretch&quot; /&gt;
                &lt;/Grid&gt;
            &lt;/StackPanel&gt;
            
            &lt;!-- Parts DataGrid --&gt;
            &lt;StackPanel Spacing=&quot;8&quot;&gt;
                &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;TextBlock Text=&quot;Parts&quot; Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;/&gt;
                    &lt;Button x:Name=&quot;AddPartButton&quot; Content=&quot;Add Part&quot; Style=&quot;{StaticResource AccentButtonStyle}&quot; Height=&quot;32&quot;/&gt;
                    &lt;Button x:Name=&quot;RemovePartButton&quot; Content=&quot;Remove Part&quot; Height=&quot;32&quot;/&gt;
                &lt;/StackPanel&gt;
                
                &lt;controls:DataGrid
                    x:Name=&quot;PartsDataGrid&quot;
                    Height=&quot;300&quot;
                    AutoGenerateColumns=&quot;False&quot;
                    CanUserReorderColumns=&quot;False&quot;
                    CanUserSortColumns=&quot;False&quot;
                    SelectionMode=&quot;Single&quot;
                    GridLinesVisibility=&quot;All&quot;
                    HorizontalScrollBarVisibility=&quot;Auto&quot;&gt;
                    
                    &lt;controls:DataGrid.Columns&gt;
                        &lt;!-- Part Number --&gt;
                        &lt;controls:DataGridTextColumn
                            Header=&quot;Part Number&quot;
                            Binding=&quot;{Binding PartNumber}&quot;
                            Width=&quot;150&quot;/&gt;
                        
                        &lt;!-- Received Skids --&gt;
                        &lt;controls:DataGridTemplateColumn Header=&quot;Received Skids&quot; Width=&quot;120&quot;&gt;
                            &lt;controls:DataGridTemplateColumn.CellTemplate&gt;
                                &lt;DataTemplate x:DataType=&quot;models:Model_VolvoShipmentLine&quot;&gt;
                                    &lt;NumberBox
                                        Value=&quot;{x:Bind ReceivedSkidCount, Mode=TwoWay}&quot;
                                        Minimum=&quot;0&quot;
                                        SpinButtonPlacementMode=&quot;Compact&quot;
                                        HorizontalAlignment=&quot;Stretch&quot; /&gt;
                                &lt;/DataTemplate&gt;
                            &lt;/controls:DataGridTemplateColumn.CellTemplate&gt;
                        &lt;/controls:DataGridTemplateColumn&gt;
                        
                        &lt;!-- Calculated Pieces (Read-only) --&gt;
                        &lt;controls:DataGridTextColumn
                            Header=&quot;Calculated Pieces&quot;
                            Binding=&quot;{Binding CalculatedPieceCount}&quot;
                            IsReadOnly=&quot;True&quot;
                            Width=&quot;120&quot;/&gt;
                        
                        &lt;!-- Has Discrepancy --&gt;
                        &lt;controls:DataGridCheckBoxColumn
                            Header=&quot;Discrepancy?&quot;
                            Binding=&quot;{Binding HasDiscrepancy, Mode=TwoWay}&quot;
                            Width=&quot;100&quot;/&gt;
                        
                        &lt;!-- Expected Skids --&gt;
                        &lt;controls:DataGridTemplateColumn Header=&quot;Expected Skids&quot; Width=&quot;120&quot;&gt;
                            &lt;controls:DataGridTemplateColumn.CellTemplate&gt;
                                &lt;DataTemplate x:DataType=&quot;models:Model_VolvoShipmentLine&quot;&gt;
                                    &lt;NumberBox
                                        Value=&quot;{Binding ExpectedSkidCount, Mode=TwoWay, Converter={StaticResource NullableDoubleToDoubleConverter}}&quot;
                                        Minimum=&quot;0&quot;
                                        SpinButtonPlacementMode=&quot;Compact&quot;
                                        HorizontalAlignment=&quot;Stretch&quot;
                                        IsEnabled=&quot;{x:Bind HasDiscrepancy, Mode=OneWay}&quot; /&gt;
                                &lt;/DataTemplate&gt;
                            &lt;/controls:DataGridTemplateColumn.CellTemplate&gt;
                        &lt;/controls:DataGridTemplateColumn&gt;
                        
                        &lt;!-- Expected Pieces Column --&gt;
                        &lt;controls:DataGridTextColumn Header=&quot;Expected Pieces&quot;
                                                      Width=&quot;120&quot;
                                                      Binding=&quot;{Binding ExpectedPieceCount, Mode=OneWay}&quot;
                                                      IsReadOnly=&quot;True&quot;/&gt;
                        
                        &lt;!-- Difference Column --&gt;
                        &lt;controls:DataGridTextColumn Header=&quot;Difference&quot;
                                                      Width=&quot;100&quot;
                                                      Binding=&quot;{Binding PieceDifference, Mode=OneWay}&quot;
                                                      IsReadOnly=&quot;True&quot;/&gt;
                        
                        &lt;!-- Discrepancy Note --&gt;
                        &lt;controls:DataGridTemplateColumn Header=&quot;Discrepancy Note&quot; Width=&quot;*&quot; MinWidth=&quot;200&quot;&gt;
                            &lt;controls:DataGridTemplateColumn.CellTemplate&gt;
                                &lt;DataTemplate x:DataType=&quot;models:Model_VolvoShipmentLine&quot;&gt;
                                    &lt;TextBox
                                        Text=&quot;{x:Bind DiscrepancyNote, Mode=TwoWay}&quot;
                                        IsEnabled=&quot;{x:Bind HasDiscrepancy, Mode=OneWay}&quot;
                                        PlaceholderText=&quot;Enter note&quot;
                                        HorizontalAlignment=&quot;Stretch&quot; /&gt;
                                &lt;/DataTemplate&gt;
                            &lt;/controls:DataGridTemplateColumn.CellTemplate&gt;
                        &lt;/controls:DataGridTemplateColumn&gt;
                    &lt;/controls:DataGrid.Columns&gt;
                &lt;/controls:DataGrid&gt;
            &lt;/StackPanel&gt;
            
        &lt;/StackPanel&gt;
    &lt;/ScrollViewer&gt;
&lt;/ContentDialog&gt;</file><file path="Module_Routing/Data/Dao_InforVisualPO.cs">using System;
using System.Collections.Generic;
using System.Data;
using Microsoft.Data.SqlClient;
using System.Threading.Tasks;
using MTM_Receiving_Application.Module_Core.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Models;

namespace MTM_Receiving_Application.Module_Routing.Data;

/// &lt;summary&gt;
/// Data Access Object for Infor Visual PO data (READ ONLY)
/// Provides read-only access to purchase order data from SQL Server
/// &lt;/summary&gt;
public class Dao_InforVisualPO
{
    private readonly string _connectionString;

    /// &lt;summary&gt;
    /// Constructor with connection string injection
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;connectionString&quot;&gt;SQL Server connection string (should include ApplicationIntent=ReadOnly for safety)&lt;/param&gt;
    public Dao_InforVisualPO(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Validates that a PO exists and is active in Infor Visual
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;Purchase order number&lt;/param&gt;
    /// &lt;returns&gt;Model_Dao_Result with true if PO exists and is open, false otherwise&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;bool&gt;&gt; ValidatePOAsync(string poNumber)
    {
        try
        {
            Console.WriteLine($&quot;[DAO] Validating PO: {poNumber}&quot;);
            await using (var connection = new SqlConnection(_connectionString))
            {
                await connection.OpenAsync();

                var query = @&quot;
                    SELECT COUNT(*)
                    FROM PURCHASE_ORDER WITH (NOLOCK)
                    WHERE ID = @PoNumber;&quot;;

                await using (var command = new SqlCommand(query, connection))
                {
                    command.Parameters.AddWithValue(&quot;@PoNumber&quot;, poNumber);

                    var count = (int)(await command.ExecuteScalarAsync() ?? 0);

                    return Model_Dao_Result_Factory.Success(count &gt; 0);
                }
            }
        }
        catch (SqlException ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;bool&gt;($&quot;Database error validating PO: {ex.Message}&quot;, ex);
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;bool&gt;($&quot;Unexpected error validating PO: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Gets all line items for a specific purchase order
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;Purchase order number&lt;/param&gt;
    /// &lt;returns&gt;Model_Dao_Result with list of PO lines&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_InforVisualPOLine&gt;&gt;&gt; GetLinesAsync(string poNumber)
    {
        try
        {
            // Issue #32: Enhanced logging
            Console.WriteLine($&quot;[DAO] Fetching lines for PO: {poNumber}&quot;);

            // Issue #21: Reduced nesting by extracting query execution
            await using var connection = new SqlConnection(_connectionString);
            await connection.OpenAsync();

            var query = @&quot;
                SELECT 
                    pol.PURC_ORDER_ID AS PO_ID,
                    pol.LINE_NO AS PO_LINE,
                    pol.PART_ID,
                    pol.ORDER_QTY AS QTY_ORDERED,
                    pol.TOTAL_RECEIVED_QTY AS QTY_RECEIVED,
                    pol.UNIT_PRICE,
                    pol.LINE_STATUS AS STATUS,
                    p.DESCRIPTION AS PART_NAME,
                    po.VENDOR_ID,
                    COALESCE(wo.DEMAND_BASE_ID, &apos;&apos;) AS WORK_ORDER_ID,
                    COALESCE(co.DEMAND_BASE_ID, &apos;&apos;) AS CUST_ORDER_ID,
                    CONVERT(NVARCHAR(MAX), CONVERT(VARBINARY(MAX), plb.BITS)) AS SPECS
                FROM PURC_ORDER_LINE pol WITH (NOLOCK)
                INNER JOIN PURCHASE_ORDER po WITH (NOLOCK) ON pol.PURC_ORDER_ID = po.ID
                LEFT JOIN PART p WITH (NOLOCK) ON pol.PART_ID = p.ID
                LEFT JOIN PURC_LINE_BINARY plb WITH (NOLOCK) ON pol.PURC_ORDER_ID = plb.PURC_ORDER_ID 
                    AND pol.LINE_NO = plb.PURC_ORDER_LINE_NO 
                    AND plb.TYPE = &apos;D&apos;
                OUTER APPLY (
                    SELECT TOP 1 DEMAND_BASE_ID
                    FROM DEMAND_SUPPLY_LINK dsl WITH (NOLOCK)
                    WHERE dsl.SUPPLY_BASE_ID = pol.PURC_ORDER_ID
                      AND (dsl.SUPPLY_NO = pol.LINE_NO OR dsl.SUPPLY_NO IS NULL)
                      AND dsl.SUPPLY_TYPE = &apos;PO&apos;
                      AND (dsl.DEMAND_TYPE = &apos;WO&apos; OR dsl.DEMAND_TYPE = &apos;RQ&apos;)
                ) wo
                OUTER APPLY (
                    SELECT TOP 1 DEMAND_BASE_ID
                    FROM DEMAND_SUPPLY_LINK dsl WITH (NOLOCK)
                    WHERE dsl.SUPPLY_BASE_ID = pol.PURC_ORDER_ID
                      AND dsl.SUPPLY_NO = pol.LINE_NO
                      AND dsl.SUPPLY_TYPE = &apos;PO&apos;
                      AND dsl.DEMAND_TYPE = &apos;CO&apos;
                ) co
                WHERE pol.PURC_ORDER_ID = @PoNumber
                ORDER BY pol.LINE_NO&quot;;

            await using var command = new SqlCommand(query, connection);
            command.Parameters.AddWithValue(&quot;@PoNumber&quot;, poNumber);

            var lines = new List&lt;Model_InforVisualPOLine&gt;();
            await using var reader = await command.ExecuteReaderAsync();

            while (await reader.ReadAsync())
            {
                lines.Add(MapFromReader(reader));
            }

            return Model_Dao_Result_Factory.Success(lines);
        }
        catch (SqlException ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_InforVisualPOLine&gt;&gt;($&quot;Database error getting PO lines: {ex.Message}&quot;, ex);
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_InforVisualPOLine&gt;&gt;($&quot;Unexpected error getting PO lines: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Gets a specific line item from a purchase order
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;Purchase order number&lt;/param&gt;
    /// &lt;param name=&quot;lineNumber&quot;&gt;Line number&lt;/param&gt;
    /// &lt;returns&gt;Model_Dao_Result with PO line data&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_InforVisualPOLine&gt;&gt; GetLineAsync(string poNumber, int lineNumber)
    {
        try
        {
            await using (var connection = new SqlConnection(_connectionString))
            {
                await connection.OpenAsync();

                var query = @&quot;
                    SELECT 
                        pol.PURC_ORDER_ID AS PO_ID,
                        pol.LINE_NO AS PO_LINE,
                        pol.PART_ID,
                        pol.ORDER_QTY AS QTY_ORDERED,
                        pol.TOTAL_RECEIVED_QTY AS QTY_RECEIVED,
                        pol.UNIT_PRICE,
                        pol.LINE_STATUS AS STATUS,
                        p.DESCRIPTION AS PART_NAME,
                        po.VENDOR_ID,
                        COALESCE(wo.DEMAND_BASE_ID, &apos;&apos;) AS WORK_ORDER_ID,
                        COALESCE(co.DEMAND_BASE_ID, &apos;&apos;) AS CUST_ORDER_ID,
                        CONVERT(NVARCHAR(MAX), CONVERT(VARBINARY(MAX), plb.BITS)) AS SPECS
                    FROM PURC_ORDER_LINE pol WITH (NOLOCK)
                    INNER JOIN PURCHASE_ORDER po WITH (NOLOCK) ON pol.PURC_ORDER_ID = po.ID
                    LEFT JOIN PART p WITH (NOLOCK) ON pol.PART_ID = p.ID
                    LEFT JOIN PURC_LINE_BINARY plb WITH (NOLOCK) ON pol.PURC_ORDER_ID = plb.PURC_ORDER_ID 
                        AND pol.LINE_NO = plb.PURC_ORDER_LINE_NO 
                        AND plb.TYPE = &apos;D&apos;
                    OUTER APPLY (
                        SELECT TOP 1 DEMAND_BASE_ID
                        FROM DEMAND_SUPPLY_LINK dsl WITH (NOLOCK)
                        WHERE dsl.SUPPLY_BASE_ID = pol.PURC_ORDER_ID
                          AND (dsl.SUPPLY_NO = pol.LINE_NO OR dsl.SUPPLY_NO IS NULL)
                          AND dsl.SUPPLY_TYPE = &apos;PO&apos;
                          AND (dsl.DEMAND_TYPE = &apos;WO&apos; OR dsl.DEMAND_TYPE = &apos;RQ&apos;)
                    ) wo
                    OUTER APPLY (
                        SELECT TOP 1 DEMAND_BASE_ID
                        FROM DEMAND_SUPPLY_LINK dsl WITH (NOLOCK)
                        WHERE dsl.SUPPLY_BASE_ID = pol.PURC_ORDER_ID
                          AND dsl.SUPPLY_NO = pol.LINE_NO
                          AND dsl.SUPPLY_TYPE = &apos;PO&apos;
                          AND dsl.DEMAND_TYPE = &apos;CO&apos;
                    ) co
                    WHERE pol.PURC_ORDER_ID = @PoNumber
                      AND pol.LINE_NO = @LineNumber&quot;;

                await using (var command = new SqlCommand(query, connection))
                {
                    command.Parameters.AddWithValue(&quot;@PoNumber&quot;, poNumber);
                    command.Parameters.AddWithValue(&quot;@LineNumber&quot;, lineNumber);

                    await using (var reader = await command.ExecuteReaderAsync())
                    {
                        if (await reader.ReadAsync())
                        {
                            var line = MapFromReader(reader);
                            return Model_Dao_Result_Factory.Success(line);
                        }
                        else
                        {
                            return Model_Dao_Result_Factory.Failure&lt;Model_InforVisualPOLine&gt;(
                                $&quot;PO line {poNumber}-{lineNumber} not found&quot;
                            );
                        }
                    }
                }
            }
        }
        catch (SqlException ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;Model_InforVisualPOLine&gt;($&quot;Database error getting PO line: {ex.Message}&quot;, ex);
        }
        catch (Exception ex)
        {
            return Model_Dao_Result_Factory.Failure&lt;Model_InforVisualPOLine&gt;($&quot;Unexpected error getting PO line: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Checks if Infor Visual connection is available
    /// &lt;/summary&gt;
    /// &lt;returns&gt;Model_Dao_Result with true if connection successful, false otherwise&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;bool&gt;&gt; CheckConnectionAsync()
    {
        try
        {
            await using (var connection = new SqlConnection(_connectionString))
            {
                await connection.OpenAsync();

                return Model_Dao_Result_Factory.Success(true);
            }
        }
        catch (SqlException)
        {
            return Model_Dao_Result_Factory.Success(false);
        }
        catch (Exception)
        {
            return Model_Dao_Result_Factory.Success(false);
        }
    }

    /// &lt;summary&gt;
    /// Maps SqlDataReader row to Model_InforVisualPOLine
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;reader&quot;&gt;&lt;/param&gt;
    private Model_InforVisualPOLine MapFromReader(IDataReader reader)
    {
        return new Model_InforVisualPOLine
        {
            PONumber = reader[&quot;PO_ID&quot;].ToString() ?? string.Empty,
            // Use indexer + ToString() to safely handle smallint (Int16) vs int (Int32) mismatch
            // reader.GetInt32() throws on smallint columns
            LineNumber = reader[&quot;PO_LINE&quot;].ToString() ?? string.Empty,
            PartID = reader[&quot;PART_ID&quot;].ToString() ?? string.Empty,
            Description = reader.IsDBNull(reader.GetOrdinal(&quot;PART_NAME&quot;))
                ? string.Empty
                : reader.GetString(reader.GetOrdinal(&quot;PART_NAME&quot;)),
            Specifications = reader.IsDBNull(reader.GetOrdinal(&quot;SPECS&quot;))
                ? string.Empty
                : reader.GetString(reader.GetOrdinal(&quot;SPECS&quot;)),
            // Handle potentially nullable decimals safely
            QuantityOrdered = reader.IsDBNull(reader.GetOrdinal(&quot;QTY_ORDERED&quot;))
                ? 0m
                : reader.GetDecimal(reader.GetOrdinal(&quot;QTY_ORDERED&quot;)),
            QuantityReceived = reader.IsDBNull(reader.GetOrdinal(&quot;QTY_RECEIVED&quot;))
                ? 0m
                : reader.GetDecimal(reader.GetOrdinal(&quot;QTY_RECEIVED&quot;)),
            WorkOrder = HasColumn(reader, &quot;WORK_ORDER_ID&quot;) &amp;&amp; !reader.IsDBNull(reader.GetOrdinal(&quot;WORK_ORDER_ID&quot;))
                ? reader.GetString(reader.GetOrdinal(&quot;WORK_ORDER_ID&quot;)) 
                : string.Empty,
            CustomerOrder = HasColumn(reader, &quot;CUST_ORDER_ID&quot;) &amp;&amp; !reader.IsDBNull(reader.GetOrdinal(&quot;CUST_ORDER_ID&quot;))
                ? reader.GetString(reader.GetOrdinal(&quot;CUST_ORDER_ID&quot;)) 
                : string.Empty
        };
    }

    /// &lt;summary&gt;
    /// Helper to check if column exists in reader
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;reader&quot;&gt;The data reader&lt;/param&gt;
    /// &lt;param name=&quot;columnName&quot;&gt;Name of the column to check&lt;/param&gt;
    private bool HasColumn(IDataReader reader, string columnName)
    {
        for (int i = 0; i &lt; reader.FieldCount; i++)
        {
            if (reader.GetName(i).Equals(columnName, StringComparison.InvariantCultureIgnoreCase))
            {
                return true;
            }
        }
        return false;
    }
}</file><file path="Module_Routing/Services/RoutingService.cs">using System;
using System.Collections.Generic;
using System.IO;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.Extensions.Configuration;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Models;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Routing.Constants;
using MTM_Receiving_Application.Module_Routing.Data;
using MTM_Receiving_Application.Module_Routing.Models;

namespace MTM_Receiving_Application.Module_Routing.Services;

/// &lt;summary&gt;
/// Core service for routing label operations: creation, editing, CSV export, validation
/// &lt;/summary&gt;
public class RoutingService : IRoutingService
{
    private readonly Dao_RoutingLabel _daoLabel;
    private readonly Dao_RoutingLabelHistory _daoHistory;
    private readonly IRoutingInforVisualService _inforVisualService;
    private readonly IRoutingUsageTrackingService _usageTrackingService;
    private readonly IRoutingRecipientService _recipientService;
    private readonly IService_LoggingUtility _logger;
    private readonly IConfiguration _configuration;

    // Static semaphore for CSV file write synchronization (fixes Issue #3: race condition)
    private static readonly SemaphoreSlim _csvFileLock = new SemaphoreSlim(1, 1);

    public RoutingService(
        Dao_RoutingLabel daoLabel,
        Dao_RoutingLabelHistory daoHistory,
        IRoutingInforVisualService inforVisualService,
        IRoutingUsageTrackingService usageTrackingService,
        IRoutingRecipientService recipientService,
        IService_LoggingUtility logger,
        IConfiguration configuration)
    {
        _daoLabel = daoLabel ?? throw new ArgumentNullException(nameof(daoLabel));
        _daoHistory = daoHistory ?? throw new ArgumentNullException(nameof(daoHistory));
        _inforVisualService = inforVisualService ?? throw new ArgumentNullException(nameof(inforVisualService));
        _usageTrackingService = usageTrackingService ?? throw new ArgumentNullException(nameof(usageTrackingService));
        _recipientService = recipientService ?? throw new ArgumentNullException(nameof(recipientService));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
        _configuration = configuration ?? throw new ArgumentNullException(nameof(configuration));
    }

    /// &lt;summary&gt;
    /// Creates a new routing label with validation, CSV export, and usage tracking
    /// Issue #20: Refactored for clarity - extracted validation and background tasks
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;label&quot;&gt;Label to create&lt;/param&gt;
    /// &lt;returns&gt;Result with new label ID&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;int&gt;&gt; CreateLabelAsync(Model_RoutingLabel label)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Creating routing label for PO {label.PONumber}, Recipient {label.RecipientId}&quot;);

            // Step 1: Validate label and check for duplicates
            var validationResult = await ValidateAndCheckDuplicatesAsync(label);
            if (!validationResult.IsSuccess)
            {
                return Model_Dao_Result_Factory.Failure&lt;int&gt;(validationResult.ErrorMessage);
            }

            // Step 2: Insert label into database
            var insertResult = await _daoLabel.InsertLabelAsync(label);
            if (!insertResult.IsSuccess)
            {
                return insertResult;
            }

            int labelId = insertResult.Data;
            label.Id = labelId;

            // Step 3: Execute non-critical background tasks (CSV export, usage tracking)
            ExecuteBackgroundTasks(label, labelId);

            return Model_Dao_Result_Factory.Success&lt;int&gt;(labelId);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error creating label: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;int&gt;($&quot;Error creating label: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Issue #20: Validates label and checks for duplicates (extracted from CreateLabelAsync)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;label&quot;&gt;&lt;/param&gt;
    private async Task&lt;Model_Dao_Result&gt; ValidateAndCheckDuplicatesAsync(Model_RoutingLabel label)
    {
        // Basic validation
        var validationResult = ValidateLabel(label);
        if (!validationResult.IsSuccess)
        {
            return validationResult;
        }

        // Issue #9: Validate recipient exists
        var recipientValidation = await _recipientService.ValidateRecipientExistsAsync(label.RecipientId);
        if (!recipientValidation.IsSuccess || !recipientValidation.Data)
        {
            return Model_Dao_Result_Factory.Failure($&quot;Invalid recipient ID: {label.RecipientId}&quot;);
        }

        // Check for duplicates
        var duplicateResult = await CheckDuplicateLabelAsync(
            label.PONumber,
            label.LineNumber,
            label.RecipientId,
            label.CreatedDate
        );

        if (duplicateResult.IsSuccess &amp;&amp; duplicateResult.Data.Exists)
        {
            return Model_Dao_Result_Factory.Failure(
                $&quot;Duplicate label exists (ID: {duplicateResult.Data.ExistingLabelId})&quot;
            );
        }

        return Model_Dao_Result_Factory.Success();
    }

    /// &lt;summary&gt;
    /// Issue #20: Executes CSV export and usage tracking in background (extracted from CreateLabelAsync)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;label&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;labelId&quot;&gt;&lt;/param&gt;
    private void ExecuteBackgroundTasks(Model_RoutingLabel label, int labelId)
    {
        // Issue #2: CSV export and usage tracking are non-critical operations
        _ = Task.Run(async () =&gt;
        {
            try
            {
                var csvResult = await ExportLabelToCsvAsync(label);
                if (!csvResult.IsSuccess)
                {
                    await _logger.LogWarningAsync($&quot;CSV export failed for label {labelId}: {csvResult.ErrorMessage}&quot;);
                }

                var usageResult = await _usageTrackingService.IncrementUsageCountAsync(
                    label.CreatedBy,
                    label.RecipientId
                );
                if (!usageResult.IsSuccess)
                {
                    await _logger.LogWarningAsync($&quot;Usage tracking failed for label {labelId}: {usageResult.ErrorMessage}&quot;);
                }
            }
            catch (Exception ex)
            {
                await _logger.LogErrorAsync($&quot;Background task error for label {labelId}: {ex.Message}&quot;, ex);
            }
        });
    }

    /// &lt;summary&gt;
    /// Updates an existing label and logs changes to history
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;label&quot;&gt;Updated label data&lt;/param&gt;
    /// &lt;param name=&quot;editedByEmployeeNumber&quot;&gt;Employee number making the edit&lt;/param&gt;
    /// &lt;returns&gt;Result indicating success or failure&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&gt; UpdateLabelAsync(Model_RoutingLabel label, int editedByEmployeeNumber)
    {
        try
        {
            await _logger.LogInfoAsync($&quot;Updating label {label.Id} by employee {editedByEmployeeNumber}&quot;);

            // Get original label for history tracking
            var originalResult = await _daoLabel.GetLabelByIdAsync(label.Id);
            if (!originalResult.IsSuccess)
            {
                return Model_Dao_Result_Factory.Failure($&quot;Original label not found: {originalResult.ErrorMessage}&quot;);
            }

            var original = originalResult.Data;

            // Validate updated label
            var validationResult = ValidateLabel(label);
            if (!validationResult.IsSuccess)
            {
                return validationResult;
            }

            // Update label
            var updateResult = await _daoLabel.UpdateLabelAsync(label);
            if (!updateResult.IsSuccess)
            {
                return updateResult;
            }

            // Log changes to history
            if (original != null)
            {
                var changes = GetLabelChanges(original, label);

                // Issue #18: Use batch insert to avoid N+1 query problem
                var historyEntries = new List&lt;Model_RoutingLabelHistory&gt;();
                foreach (var (fieldName, oldValue, newValue) in changes)
                {
                    historyEntries.Add(new Model_RoutingLabelHistory
                    {
                        LabelId = label.Id,
                        FieldChanged = fieldName,
                        OldValue = oldValue,
                        NewValue = newValue,
                        EditedBy = editedByEmployeeNumber,
                        EditDate = DateTime.Now
                    });
                }

                if (historyEntries.Count &gt; 0)
                {
                    var historyResult = await _daoHistory.InsertHistoryBatchAsync(historyEntries);
                    if (!historyResult.IsSuccess)
                    {
                        await _logger.LogWarningAsync($&quot;Failed to log history: {historyResult.ErrorMessage}&quot;);
                    }
                }
            }

            return Model_Dao_Result_Factory.Success(&quot;Label updated successfully&quot;, 1);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error updating label: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure($&quot;Error updating label: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Retrieves a specific label by ID
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;labelId&quot;&gt;Label ID to retrieve&lt;/param&gt;
    /// &lt;returns&gt;Result with label data or error&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_RoutingLabel&gt;&gt; GetLabelByIdAsync(int labelId)
    {
        try
        {
            return await _daoLabel.GetLabelByIdAsync(labelId);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error getting label {labelId}: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;Model_RoutingLabel&gt;($&quot;Error getting label: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Retrieves all labels with optional pagination
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;limit&quot;&gt;Maximum number of records to return&lt;/param&gt;
    /// &lt;param name=&quot;offset&quot;&gt;Number of records to skip&lt;/param&gt;
    /// &lt;returns&gt;Result with list of labels&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_RoutingLabel&gt;&gt;&gt; GetAllLabelsAsync(int limit = 100, int offset = 0)
    {
        try
        {
            // Issue #13: Pagination support requires DAO updates
            // Would need: sp_routing_label_search_paginated(p_search, p_limit, p_offset)
            // Returns: Subset of results + total count for UI paging controls
            // Priority: MEDIUM - Useful for large datasets (1000+ labels)
            // Current implementation returns all matching labels (acceptable for &lt;500 records)
            // Current: DAO method accepts params but doesn&apos;t implement pagination
            // Impact: Performance issue when loading large label sets
            return await _daoLabel.GetAllLabelsAsync(limit, offset);
        }
        catch (Exception ex)
        {
            // Issue #11: Standardized error handling pattern
            await _logger.LogErrorAsync($&quot;Error retrieving labels: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;List&lt;Model_RoutingLabel&gt;&gt;($&quot;Failed to retrieve labels: {ex.Message}&quot;, ex);
        }
    }

    public async Task&lt;Model_Dao_Result&lt;(bool Exists, int? ExistingLabelId)&gt;&gt; CheckDuplicateLabelAsync(
        string poNumber,
        string lineNumber,
        int recipientId,
        DateTime createdDate)
    {
        try
        {
            var result = await _daoLabel.CheckDuplicateAsync(poNumber, lineNumber, recipientId, createdDate);

            if (result.IsSuccess)
            {
                return result;
            }

            return Model_Dao_Result_Factory.Failure&lt;(bool Exists, int? ExistingLabelId)&gt;(result.ErrorMessage);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error checking duplicate: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure&lt;(bool Exists, int? ExistingLabelId)&gt;($&quot;Error checking duplicate: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Exports a label to CSV file with retry logic and fallback paths
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;label&quot;&gt;Label to export&lt;/param&gt;
    /// &lt;returns&gt;Result indicating success or failure&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&gt; ExportLabelToCsvAsync(Model_RoutingLabel label)
    {
        try
        {
            // Get CSV export paths from configuration
            var networkPath = _configuration[Constant_RoutingConfiguration.CsvExportPathNetwork];
            var localPath = _configuration[Constant_RoutingConfiguration.CsvExportPathLocal];
            var retryCount = _configuration.GetValue&lt;int&gt;(
                Constant_RoutingConfiguration.CsvRetryMaxAttempts,
                Constant_RoutingConfiguration.DefaultCsvRetryMaxAttempts);
            var retryDelay = _configuration.GetValue&lt;int&gt;(
                Constant_RoutingConfiguration.CsvRetryDelayMs,
                Constant_RoutingConfiguration.DefaultCsvRetryDelayMs);

            // Format CSV line
            var csvLine = FormatCsvLine(label);

            // Validate and sanitize paths (Issue #5)
            var validatedNetworkPath = string.IsNullOrEmpty(networkPath) ? string.Empty : ValidateCsvPath(networkPath);
            var validatedLocalPath = string.IsNullOrEmpty(localPath) ? string.Empty : ValidateCsvPath(localPath);

            // Try network path first with retry
            bool networkSuccess = await TryWriteCsvAsync(validatedNetworkPath, csvLine, retryCount, retryDelay);

            // Try local path as fallback
            bool localSuccess = false;
            if (!networkSuccess)
            {
                await _logger.LogWarningAsync($&quot;Network CSV export failed, using local path: {validatedLocalPath}&quot;);
                localSuccess = await TryWriteCsvAsync(validatedLocalPath, csvLine, retryCount, retryDelay);
            }

            if (networkSuccess || localSuccess)
            {
                // Mark as exported in database
                await _daoLabel.MarkExportedAsync(new List&lt;int&gt; { label.Id });

                return Model_Dao_Result_Factory.Success(
                    networkSuccess ? &quot;Exported to network CSV&quot; : &quot;Exported to local CSV&quot;,
                    1
                );
            }

            return Model_Dao_Result_Factory.Failure(&quot;CSV export failed (both network and local paths)&quot;);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error exporting to CSV: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure($&quot;CSV export error: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Regenerates CSV export for a specific label (e.g., after export failure)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;labelId&quot;&gt;Label ID to regenerate&lt;/param&gt;
    /// &lt;returns&gt;Result indicating success or failure&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&gt; RegenerateLabelCsvAsync(int labelId)
    {
        try
        {
            var labelResult = await GetLabelByIdAsync(labelId);
            if (!labelResult.IsSuccess || labelResult.Data == null)
            {
                return Model_Dao_Result_Factory.Failure($&quot;Label not found: {labelResult.ErrorMessage}&quot;);
            }

            return await ExportLabelToCsvAsync(labelResult.Data);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error regenerating CSV: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure($&quot;Error regenerating CSV: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Resets CSV exported flag for all labels (administrative operation)
    /// &lt;/summary&gt;
    /// &lt;returns&gt;Result indicating success or failure&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&gt; ResetCsvFileAsync()
    {
        try
        {
            var networkPath = _configuration[&quot;RoutingModule:CsvExportPath:Network&quot;];
            var localPath = _configuration[&quot;RoutingModule:CsvExportPath:Local&quot;];

            bool networkDeleted = false;
            bool localDeleted = false;

            if (File.Exists(networkPath))
            {
                File.Delete(networkPath);
                networkDeleted = true;
            }

            if (File.Exists(localPath))
            {
                File.Delete(localPath);
                localDeleted = true;
            }

            await _logger.LogInfoAsync($&quot;CSV files reset (network: {networkDeleted}, local: {localDeleted})&quot;);

            return Model_Dao_Result_Factory.Success(&quot;CSV files reset successfully&quot;, 1);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error resetting CSV: {ex.Message}&quot;, ex);
            return Model_Dao_Result_Factory.Failure($&quot;Error resetting CSV: {ex.Message}&quot;, ex);
        }
    }

    /// &lt;summary&gt;
    /// Validates label data before database operations
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;label&quot;&gt;Label to validate&lt;/param&gt;
    /// &lt;returns&gt;Result indicating if validation passed&lt;/returns&gt;
    public Model_Dao_Result ValidateLabel(Model_RoutingLabel label)
    {
        if (label == null)
        {
            return Model_Dao_Result_Factory.Failure(&quot;Label cannot be null&quot;);
        }

        if (string.IsNullOrWhiteSpace(label.PONumber))
        {
            return Model_Dao_Result_Factory.Failure(&quot;PO Number is required&quot;);
        }

        // Issue #6: String length validation
        if (label.PONumber.Length &gt; 50)
        {
            return Model_Dao_Result_Factory.Failure(&quot;PO Number cannot exceed 50 characters&quot;);
        }

        if (string.IsNullOrWhiteSpace(label.LineNumber))
        {
            return Model_Dao_Result_Factory.Failure(&quot;Line Number is required&quot;);
        }

        if (label.LineNumber.Length &gt; 20)
        {
            return Model_Dao_Result_Factory.Failure(&quot;Line Number cannot exceed 20 characters&quot;);
        }

        if (label.Description != null &amp;&amp; label.Description.Length &gt; 255)
        {
            return Model_Dao_Result_Factory.Failure(&quot;Description cannot exceed 255 characters&quot;);
        }

        if (label.Quantity &lt;= 0)
        {
            return Model_Dao_Result_Factory.Failure(&quot;Quantity must be greater than zero&quot;);
        }

        if (label.RecipientId &lt;= 0)
        {
            return Model_Dao_Result_Factory.Failure(&quot;Recipient must be selected&quot;);
        }

        if (label.CreatedBy &lt;= 0)
        {
            return Model_Dao_Result_Factory.Failure(&quot;Employee Number is required&quot;);
        }

        // Validate that either PO is valid OR an OTHER reason is provided
        if (label.PONumber.Equals(&quot;OTHER&quot;, StringComparison.OrdinalIgnoreCase))
        {
            if (!label.OtherReasonId.HasValue || label.OtherReasonId.Value &lt;= 0)
            {
                return Model_Dao_Result_Factory.Failure(&quot;OTHER reason must be selected when PO is OTHER&quot;);
            }
        }

        return Model_Dao_Result_Factory.Success(&quot;Validation passed&quot;, 1);
    }

    // Private helper methods

    /// &lt;summary&gt;
    /// Validates CSV file path to prevent directory traversal attacks
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;path&quot;&gt;Path to validate&lt;/param&gt;
    /// &lt;returns&gt;Validated full path&lt;/returns&gt;
    /// &lt;exception cref=&quot;ArgumentException&quot;&gt;If path is invalid&lt;/exception&gt;
    /// &lt;exception cref=&quot;SecurityException&quot;&gt;If path contains traversal attempts&lt;/exception&gt;
    private string ValidateCsvPath(string path)
    {
        // Issue #5: Path traversal validation
        if (string.IsNullOrWhiteSpace(path))
        {
            throw new ArgumentException(&quot;CSV path cannot be empty&quot;, nameof(path));
        }

        var fullPath = Path.GetFullPath(path);

        // Ensure path doesn&apos;t contain traversal attempts
        if (path.Contains(&quot;..&quot;) || path.Contains(&quot;~&quot;))
        {
            throw new System.Security.SecurityException(&quot;CSV path contains invalid characters&quot;);
        }

        return fullPath;
    }

    /// &lt;summary&gt;
    /// Formats label data as CSV line
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;label&quot;&gt;Label to format&lt;/param&gt;
    /// &lt;returns&gt;CSV-formatted string&lt;/returns&gt;
    private string FormatCsvLine(Model_RoutingLabel label)
    {
        // CSV format: PO,Line,Part,Quantity,Recipient,Location,Date,WorkOrder,CustomerOrder
        return $&quot;{label.PONumber},{label.LineNumber},{label.Description ?? &quot;&quot;},{label.Quantity},{label.RecipientName ?? &quot;&quot;},{label.RecipientLocation ?? &quot;&quot;},{label.CreatedDate:yyyy-MM-dd HH:mm:ss},{label.WorkOrder},{label.CustomerOrder}&quot;;
    }

    private async Task&lt;bool&gt; TryWriteCsvAsync(string filePath, string csvLine, int retryCount, int retryDelayMs)
    {
        for (int attempt = 1; attempt &lt;= retryCount; attempt++)
        {
            try
            {
                // Acquire lock to prevent concurrent CSV writes (fixes Issue #3)
                await _csvFileLock.WaitAsync();

                try
                {
                    // Ensure directory exists
                    var directory = Path.GetDirectoryName(filePath);
                    if (!string.IsNullOrEmpty(directory) &amp;&amp; !Directory.Exists(directory))
                    {
                        Directory.CreateDirectory(directory);
                    }

                    // Append to CSV file
                    await File.AppendAllTextAsync(filePath, csvLine + Environment.NewLine);

                    return true;
                }
                finally
                {
                    _csvFileLock.Release();
                }
            }
            catch (IOException ex)
            {
                await _logger.LogWarningAsync($&quot;CSV write attempt {attempt}/{retryCount} failed: {ex.Message}&quot;);

                if (attempt &lt; retryCount)
                {
                    await Task.Delay(retryDelayMs);
                }
            }
            catch (Exception ex)
            {
                await _logger.LogErrorAsync($&quot;Unexpected CSV write error: {ex.Message}&quot;, ex);
                return false;
            }
        }

        return false;
    }

    /// &lt;summary&gt;
    /// Compares two labels and returns list of changed fields
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;original&quot;&gt;Original label&lt;/param&gt;
    /// &lt;param name=&quot;updated&quot;&gt;Updated label&lt;/param&gt;
    /// &lt;returns&gt;List of tuples containing field name, old value, and new value&lt;/returns&gt;
    private List&lt;(string FieldName, string OldValue, string NewValue)&gt; GetLabelChanges(
        Model_RoutingLabel original,
        Model_RoutingLabel updated)
    {
        var changes = new List&lt;(string, string, string)&gt;();

        if (original.PONumber != updated.PONumber)
        {
            changes.Add((&quot;PONumber&quot;, original.PONumber, updated.PONumber));
        }

        if (original.LineNumber != updated.LineNumber)
        {
            changes.Add((&quot;LineNumber&quot;, original.LineNumber, updated.LineNumber));
        }

        if (original.Description != updated.Description)
        {
            changes.Add((&quot;Description&quot;, original.Description ?? &quot;&quot;, updated.Description ?? &quot;&quot;));
        }

        if (original.Quantity != updated.Quantity)
        {
            changes.Add((&quot;Quantity&quot;, original.Quantity.ToString(), updated.Quantity.ToString()));
        }

        if (original.RecipientId != updated.RecipientId)
        {
            changes.Add((&quot;RecipientId&quot;, original.RecipientId.ToString(), updated.RecipientId.ToString()));
        }

        if (original.OtherReasonId != updated.OtherReasonId)
        {
            changes.Add((&quot;OtherReasonId&quot;,
                original.OtherReasonId?.ToString() ?? &quot;null&quot;,
                updated.OtherReasonId?.ToString() ?? &quot;null&quot;));
        }

        return changes;
    }
}</file><file path="Module_Routing/ViewModels/RoutingWizardContainerViewModel.cs">using System;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Routing.Enums;
using MTM_Receiving_Application.Module_Routing.Models;
using MTM_Receiving_Application.Module_Routing.Services;
using MTM_Receiving_Application.Module_Core.Models.Enums;

namespace MTM_Receiving_Application.Module_Routing.ViewModels;

/// &lt;summary&gt;
/// Container ViewModel managing wizard state and navigation between steps
/// &lt;/summary&gt;
public partial class RoutingWizardContainerViewModel : ObservableObject
{
    private readonly IRoutingService _routingService;
    private readonly IRoutingInforVisualService _inforVisualService;
    private readonly IRoutingUsageTrackingService _usageTrackingService;
    private readonly IService_ErrorHandler _errorHandler;
    private readonly IService_LoggingUtility _logger;
    private readonly IService_UserSessionManager _sessionManager;

    // Lazy-loaded Step3 ViewModel for triggering data refresh
    private RoutingWizardStep3ViewModel? _step3ViewModel;

    #region Constructor
    public RoutingWizardContainerViewModel(
        IRoutingService routingService,
        IRoutingInforVisualService inforVisualService,
        IRoutingUsageTrackingService usageTrackingService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger,
        IService_UserSessionManager sessionManager)
    {
        _routingService = routingService;
        _inforVisualService = inforVisualService;
        _usageTrackingService = usageTrackingService;
        _errorHandler = errorHandler;
        _logger = logger;
        _sessionManager = sessionManager;
    }
    #endregion

    #region Observable Properties
    /// &lt;summary&gt;
    /// Current wizard step (1, 2, or 3)
    /// &lt;/summary&gt;
    [ObservableProperty]
    private int _currentStep = 1;

    /// &lt;summary&gt;
    /// Busy indicator for async operations
    /// &lt;/summary&gt;
    [ObservableProperty]
    private bool _isBusy;

    /// &lt;summary&gt;
    /// Status message for user feedback
    /// &lt;/summary&gt;
    [ObservableProperty]
    private string _statusMessage = string.Empty;

    /// &lt;summary&gt;
    /// Selected PO line from Step 1 (null if OTHER workflow)
    /// &lt;/summary&gt;
    [ObservableProperty]
    private Model_InforVisualPOLine? _selectedPOLine;

    /// &lt;summary&gt;
    /// Selected OTHER reason from Step 1 (null if PO workflow)
    /// &lt;/summary&gt;
    [ObservableProperty]
    private Model_RoutingOtherReason? _selectedOtherReason;

    /// &lt;summary&gt;
    /// Manual quantity for OTHER workflow
    /// &lt;/summary&gt;
    [ObservableProperty]
    private int _otherQuantity = 1;

    /// &lt;summary&gt;
    /// Selected recipient from Step 2
    /// &lt;/summary&gt;
    [ObservableProperty]
    private Model_RoutingRecipient? _selectedRecipient;

    /// &lt;summary&gt;
    /// Final label quantity (from PO line or manual entry)
    /// &lt;/summary&gt;
    [ObservableProperty]
    private int _finalQuantity;

    /// &lt;summary&gt;
    /// Indicates if we&apos;re in edit mode from Step 3 review
    /// &lt;/summary&gt;
    [ObservableProperty]
    private bool _isEditingFromReview;
    #endregion

    #region Navigation Commands
    /// &lt;summary&gt;
    /// Navigate to Step 2 (Recipient Selection)
    /// &lt;/summary&gt;
    [RelayCommand]
    private void NavigateToStep2()
    {
        _logger.LogInfo($&quot;NavigateToStep2 called - CurrentStep: {CurrentStep}, SelectedPOLine: {SelectedPOLine?.PartID ?? &quot;null&quot;}, SelectedOtherReason: {SelectedOtherReason?.Description ?? &quot;null&quot;}&quot;);

        // Validation: Must have either PO line or OTHER reason
        if (SelectedPOLine == null &amp;&amp; SelectedOtherReason == null)
        {
            _logger.LogWarning(&quot;NavigateToStep2: No PO line or OTHER reason selected&quot;);
            StatusMessage = &quot;Please select a PO line or OTHER reason&quot;;
            return;
        }

        // Set quantity from PO line if applicable
        if (SelectedPOLine != null)
        {
            FinalQuantity = (int)SelectedPOLine.QuantityOrdered;
            _logger.LogInfo($&quot;Set FinalQuantity from PO line: {FinalQuantity}&quot;);
        }
        else
        {
            FinalQuantity = OtherQuantity;
            _logger.LogInfo($&quot;Set FinalQuantity from OTHER: {FinalQuantity}&quot;);
        }

        _logger.LogInfo($&quot;Changing CurrentStep from {CurrentStep} to 2&quot;);
        CurrentStep = 2;
        StatusMessage = &quot;Select recipient&quot;;
        _logger.LogInfo($&quot;CurrentStep is now: {CurrentStep}&quot;);
    }

    /// &lt;summary&gt;
    /// Navigate to Step 3 (Review)
    /// &lt;/summary&gt;
    [RelayCommand]
    private void NavigateToStep3()
    {
        _logger.LogInfo($&quot;NavigateToStep3 called - SelectedRecipient: {SelectedRecipient?.Name ?? &quot;null&quot;}&quot;);

        // Validation: Must have recipient
        if (SelectedRecipient == null)
        {
            _logger.LogWarning(&quot;NavigateToStep3: No recipient selected&quot;);
            StatusMessage = &quot;Please select a recipient&quot;;
            return;
        }

        _logger.LogInfo($&quot;Navigating to Step 3 - Recipient: {SelectedRecipient.Name}, CurrentStep changing from {CurrentStep} to 3&quot;);
        CurrentStep = 3;
        StatusMessage = &quot;Review label details&quot;;
        _logger.LogInfo($&quot;CurrentStep is now: {CurrentStep}&quot;);

        // Trigger Step3 to reload data
        if (_step3ViewModel != null)
        {
            _logger.LogInfo(&quot;Calling Step3ViewModel.LoadReviewData()&quot;);
            _step3ViewModel.LoadReviewData();
        }
        else
        {
            _logger.LogWarning(&quot;Step3ViewModel not yet initialized&quot;);
        }
    }

    /// &lt;summary&gt;
    /// Register Step 3 ViewModel for data refresh coordination
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;step3ViewModel&quot;&gt;&lt;/param&gt;
    public void RegisterStep3ViewModel(RoutingWizardStep3ViewModel step3ViewModel)
    {
        _step3ViewModel = step3ViewModel;
        _logger.LogInfo(&quot;Step3ViewModel registered with Container&quot;);
    }

    /// &lt;summary&gt;
    /// Navigate back to Step 1
    /// &lt;/summary&gt;
    [RelayCommand]
    private void NavigateToStep1()
    {
        IsEditingFromReview = false;
        CurrentStep = 1;
        StatusMessage = &quot;Enter PO or select OTHER&quot;;
    }

    /// &lt;summary&gt;
    /// Navigate to Step 1 for editing (from Step 3)
    /// &lt;/summary&gt;
    [RelayCommand]
    private void NavigateToStep1ForEdit()
    {
        _logger.LogInfo(&quot;NavigateToStep1ForEdit called - Setting edit mode&quot;);
        IsEditingFromReview = true;
        CurrentStep = 1;
        StatusMessage = &quot;Edit PO selection&quot;;
    }

    /// &lt;summary&gt;
    /// Navigate back to Step 2
    /// &lt;/summary&gt;
    [RelayCommand]
    private void NavigateBackToStep2()
    {
        IsEditingFromReview = false;
        CurrentStep = 2;
        StatusMessage = &quot;Select recipient&quot;;
    }

    /// &lt;summary&gt;
    /// Navigate to Step 2 for editing (from Step 3)
    /// &lt;/summary&gt;
    [RelayCommand]
    private void NavigateToStep2ForEdit()
    {
        _logger.LogInfo(&quot;NavigateToStep2ForEdit called - Setting edit mode&quot;);
        IsEditingFromReview = true;
        CurrentStep = 2;
        StatusMessage = &quot;Edit recipient selection&quot;;
    }
    #endregion

    #region Create Label Command
    /// &lt;summary&gt;
    /// Create the routing label (final step)
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task CreateLabelAsync()
    {
        if (IsBusy)
        {
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Creating label...&quot;;

            // Build label model
            var label = new Model_RoutingLabel
            {
                PONumber = SelectedPOLine?.PONumber ?? &quot;OTHER&quot;,
                LineNumber = SelectedPOLine?.LineNumber.ToString() ?? &quot;0&quot;,
                Description = SelectedPOLine?.Description ?? SelectedOtherReason?.Description ?? string.Empty,
                RecipientId = SelectedRecipient?.Id ?? 0,
                Quantity = FinalQuantity,
                OtherReasonId = SelectedOtherReason?.Id,
                CreatedBy = GetCurrentEmployeeNumber(),
                CreatedDate = DateTime.Now,
                WorkOrder = SelectedPOLine?.WorkOrder ?? string.Empty,
                CustomerOrder = SelectedPOLine?.CustomerOrder ?? string.Empty
            };

            // Create label via service
            var result = await _routingService.CreateLabelAsync(label);

            if (result.IsSuccess)
            {
                // Increment usage tracking for personalization
                await _usageTrackingService.IncrementUsageCountAsync(
                    label.CreatedBy,
                    label.RecipientId);

                StatusMessage = &quot;Label created successfully!&quot;;

                // Log success
                await _logger.LogInfoAsync(
                    $&quot;Routing label created: PO={label.PONumber}, Recipient={SelectedRecipient?.Name}&quot;,
                    context: nameof(CreateLabelAsync));

                // Issue #13: Navigate back to Mode Selection after successful creation
                // Requires: INavigationService.NavigateTo(typeof(RoutingModeSelectionViewModel))
                // Or: Raise NavigationRequested event handled by parent window
                // Priority: LOW - User can manually navigate, auto-return is convenience feature
                // Navigation flow not yet implemented
                ResetWizard();
            }
            else
            {
                await _errorHandler.ShowUserErrorAsync(
                    result.ErrorMessage,
                    &quot;Create Label Failed&quot;,
                    nameof(CreateLabelAsync));
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Medium,
                nameof(CreateLabelAsync),
                nameof(RoutingWizardContainerViewModel));
        }
        finally
        {
            IsBusy = false;
        }
    }
    #endregion

    #region Cancel Command
    /// &lt;summary&gt;
    /// Cancel wizard with confirmation
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task CancelAsync()
    {
        // Show confirmation dialog
        var dialog = new Microsoft.UI.Xaml.Controls.ContentDialog
        {
            Title = &quot;Cancel Wizard&quot;,
            Content = &quot;Are you sure you want to cancel? All progress will be lost.&quot;,
            PrimaryButtonText = &quot;Yes, cancel&quot;,
            CloseButtonText = &quot;No, continue&quot;,
            DefaultButton = Microsoft.UI.Xaml.Controls.ContentDialogButton.Close
        };

        // Set XamlRoot for dialog
        dialog.XamlRoot = App.MainWindow?.Content?.XamlRoot;

        var result = await dialog.ShowAsync();

        if (result == Microsoft.UI.Xaml.Controls.ContentDialogResult.Primary)
        {
            // User confirmed cancel
            ResetWizard();
            // Navigate back to Mode Selection after cancel
            // Requires: INavigationService integration or parent window event handling
            // Priority: LOW - Manual navigation available
        }
    }
    #endregion

    #region Helper Methods
    /// &lt;summary&gt;
    /// Reset wizard to initial state
    /// &lt;/summary&gt;
    private void ResetWizard()
    {
        CurrentStep = 1;
        SelectedPOLine = null;
        SelectedOtherReason = null;
        SelectedRecipient = null;
        OtherQuantity = 1;
        FinalQuantity = 0;
        StatusMessage = &quot;Enter PO or select OTHER&quot;;
    }

    /// &lt;summary&gt;
    /// Get current employee number from session
    /// Issue #7: Implemented using IService_UserSessionManager
    /// &lt;/summary&gt;
    private int GetCurrentEmployeeNumber()
    {
        return _sessionManager.CurrentSession?.User?.EmployeeNumber ?? 0;
    }
    #endregion
}</file><file path="Module_Routing/Views/RoutingWizardStep1View.xaml">&lt;Page
    x:Class=&quot;MTM_Receiving_Application.Module_Routing.Views.RoutingWizardStep1View&quot;
    x:Name=&quot;RootPage&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:vm=&quot;using:MTM_Receiving_Application.Module_Routing.ViewModels&quot;
    xmlns:models=&quot;using:MTM_Receiving_Application.Module_Routing.Models&quot;
    xmlns:coreConverters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;&gt;

    &lt;Page.Resources&gt;
        &lt;coreConverters:Converter_BooleanToVisibility x:Key=&quot;BooleanToVisibilityConverter&quot;/&gt;
        &lt;coreConverters:Converter_IntToVisibility x:Key=&quot;IntToVisibilityConverter&quot;/&gt;
    &lt;/Page.Resources&gt;

    &lt;Grid Padding=&quot;12&quot; RowSpacing=&quot;8&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Header --&gt;
        &lt;TextBlock Grid.Row=&quot;0&quot; 
                   Text=&quot;Step 1: PO and Line Selection&quot; 
                   Style=&quot;{StaticResource TitleTextBlockStyle}&quot;
                   Margin=&quot;0,0,0,4&quot;/&gt;

        &lt;!-- PO Input Section (visible when NOT in OTHER mode) --&gt;
        &lt;Border Grid.Row=&quot;1&quot; 
                Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                BorderThickness=&quot;1&quot;
                CornerRadius=&quot;8&quot;
                Padding=&quot;12&quot;
                Visibility=&quot;{x:Bind ViewModel.IsOtherMode, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}&quot;&gt;
            &lt;Grid ColumnSpacing=&quot;16&quot;&gt;
                &lt;Grid.ColumnDefinitions&gt;
                    &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                &lt;/Grid.ColumnDefinitions&gt;

                &lt;!-- Label --&gt;
                &lt;StackPanel Grid.Column=&quot;0&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot; VerticalAlignment=&quot;Center&quot;&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE8A5;&quot; 
                                FontSize=&quot;16&quot;
                                Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                    &lt;TextBlock Text=&quot;PO Number:&quot; 
                                Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot;
                                VerticalAlignment=&quot;Center&quot;/&gt;
                &lt;/StackPanel&gt;
                
                &lt;!-- Input --&gt;
                &lt;TextBox Grid.Column=&quot;1&quot;
                            Text=&quot;{x:Bind ViewModel.PoNumber, Mode=TwoWay}&quot;
                            PlaceholderText=&quot;Enter PO number&quot;
                            VerticalAlignment=&quot;Center&quot;/&gt;

                &lt;!-- Actions --&gt;
                &lt;StackPanel Grid.Column=&quot;2&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                    &lt;Button Command=&quot;{x:Bind ViewModel.ValidatePOCommand}&quot;
                            Style=&quot;{StaticResource AccentButtonStyle}&quot;&gt;
                        &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                            &lt;FontIcon Glyph=&quot;&amp;#xE896;&quot; FontSize=&quot;16&quot;/&gt;
                            &lt;TextBlock Text=&quot;Validate&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Button&gt;
                    
                    &lt;Button Content=&quot;Other (Non-PO)&quot;
                            Command=&quot;{x:Bind ViewModel.SwitchToOtherModeCommand}&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/Grid&gt;
        &lt;/Border&gt;

        &lt;!-- OTHER Mode Section (visible when in OTHER mode) --&gt;
        &lt;Border Grid.Row=&quot;1&quot; 
                Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                BorderThickness=&quot;1&quot;
                CornerRadius=&quot;8&quot;
                Padding=&quot;20&quot;
                Visibility=&quot;{x:Bind ViewModel.IsOtherMode, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;&gt;
            &lt;StackPanel Spacing=&quot;16&quot;&gt;
                &lt;TextBlock Text=&quot;OTHER Package (Non-PO)&quot; 
                           Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;/&gt;

                &lt;StackPanel Spacing=&quot;8&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE8B4;&quot; 
                                 FontSize=&quot;16&quot;
                                 Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                        &lt;TextBlock Text=&quot;Reason&quot; 
                                  Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot;/&gt;
                    &lt;/StackPanel&gt;
                    
                    &lt;ComboBox PlaceholderText=&quot;Select reason&quot;
                              ItemsSource=&quot;{x:Bind ViewModel.OtherReasons, Mode=OneWay}&quot;
                              SelectedItem=&quot;{x:Bind ViewModel.SelectedOtherReason, Mode=TwoWay}&quot;
                              DisplayMemberPath=&quot;Description&quot;
                              HorizontalAlignment=&quot;Stretch&quot;
                              MaxWidth=&quot;400&quot;/&gt;
                &lt;/StackPanel&gt;

                &lt;StackPanel Spacing=&quot;8&quot;&gt;
                    &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE9F9;&quot; 
                                 FontSize=&quot;16&quot;
                                 Foreground=&quot;{ThemeResource AccentTextFillColorPrimaryBrush}&quot;/&gt;
                        &lt;TextBlock Text=&quot;Quantity&quot; 
                                  Style=&quot;{ThemeResource BodyStrongTextBlockStyle}&quot;/&gt;
                    &lt;/StackPanel&gt;
                    
                    &lt;NumberBox Minimum=&quot;1&quot;
                               SpinButtonPlacementMode=&quot;Inline&quot;
                               Value=&quot;{x:Bind ViewModel.OtherQuantity, Mode=TwoWay}&quot;
                               MaxWidth=&quot;200&quot;
                               HorizontalAlignment=&quot;Left&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/StackPanel&gt;
        &lt;/Border&gt;

        &lt;!-- PO Lines DataGrid + Specs (visible when NOT in OTHER mode) --&gt;
        &lt;Grid Grid.Row=&quot;2&quot; ColumnSpacing=&quot;16&quot;
              Visibility=&quot;{x:Bind ViewModel.IsOtherMode, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}&quot;&gt;
            &lt;Grid.ColumnDefinitions&gt;
                &lt;ColumnDefinition Width=&quot;3*&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
            &lt;/Grid.ColumnDefinitions&gt;

            &lt;!-- Lines List --&gt;
            &lt;Border Grid.Column=&quot;0&quot; 
                    Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                    BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                    BorderThickness=&quot;1&quot;
                    CornerRadius=&quot;8&quot;
                    Padding=&quot;16&quot;&gt;
                &lt;Grid&gt;
                    &lt;TextBlock Text=&quot;Select a line from the PO&quot;
                               HorizontalAlignment=&quot;Center&quot;
                               VerticalAlignment=&quot;Center&quot;
                               Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot;
                               Visibility=&quot;{x:Bind ViewModel.PoLines.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=Inverse}&quot;/&gt;

                    &lt;ListView ItemsSource=&quot;{x:Bind ViewModel.PoLines, Mode=OneWay}&quot;
                              SelectedItem=&quot;{x:Bind ViewModel.SelectedPOLine, Mode=TwoWay}&quot;
                              SelectionMode=&quot;Single&quot;
                              Visibility=&quot;{x:Bind ViewModel.PoLines.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}}&quot;&gt;
                        &lt;ListView.HeaderTemplate&gt;
                            &lt;DataTemplate&gt;
                                &lt;Grid Padding=&quot;8&quot; ColumnSpacing=&quot;0&quot;&gt;
                                    &lt;Grid.ColumnDefinitions&gt;
                                        &lt;ColumnDefinition Width=&quot;50&quot;/&gt;
                                        &lt;ColumnDefinition Width=&quot;120&quot;/&gt;
                                        &lt;ColumnDefinition Width=&quot;150&quot;/&gt;
                                        &lt;ColumnDefinition Width=&quot;{Binding ViewModel.ReferenceColumnWidth, ElementName=RootPage}&quot;/&gt;
                                        &lt;ColumnDefinition Width=&quot;{Binding ViewModel.SpecsColumnWidth, ElementName=RootPage}&quot;/&gt;
                                        &lt;ColumnDefinition Width=&quot;80&quot;/&gt;
                                    &lt;/Grid.ColumnDefinitions&gt;
                                    &lt;TextBlock Grid.Column=&quot;0&quot; Text=&quot;Line&quot; FontWeight=&quot;SemiBold&quot; Margin=&quot;0,0,12,0&quot;/&gt;
                                    &lt;TextBlock Grid.Column=&quot;1&quot; Text=&quot;Part ID&quot; FontWeight=&quot;SemiBold&quot; Margin=&quot;0,0,12,0&quot;/&gt;
                                    &lt;TextBlock Grid.Column=&quot;2&quot; Text=&quot;Description&quot; FontWeight=&quot;SemiBold&quot; Margin=&quot;0,0,12,0&quot;/&gt;
                                    &lt;TextBlock Grid.Column=&quot;3&quot; Text=&quot;Ref (CO/WO)&quot; FontWeight=&quot;SemiBold&quot; Margin=&quot;0,0,12,0&quot;/&gt;
                                    &lt;TextBlock Grid.Column=&quot;4&quot; Text=&quot;Specs (Preview)&quot; FontWeight=&quot;SemiBold&quot; Margin=&quot;0,0,12,0&quot;/&gt;
                                    &lt;TextBlock Grid.Column=&quot;5&quot; Text=&quot;Qty&quot; FontWeight=&quot;SemiBold&quot; HorizontalAlignment=&quot;Right&quot;/&gt;
                                &lt;/Grid&gt;
                            &lt;/DataTemplate&gt;
                        &lt;/ListView.HeaderTemplate&gt;
                        &lt;ListView.ItemTemplate&gt;
                            &lt;DataTemplate x:DataType=&quot;models:Model_InforVisualPOLine&quot;&gt;
                                &lt;Grid Padding=&quot;8&quot; ColumnSpacing=&quot;0&quot;&gt;
                                    &lt;Grid.ColumnDefinitions&gt;
                                         &lt;ColumnDefinition Width=&quot;50&quot;/&gt;
                                         &lt;ColumnDefinition Width=&quot;120&quot;/&gt;
                                         &lt;ColumnDefinition Width=&quot;150&quot;/&gt;
                                         &lt;ColumnDefinition Width=&quot;{Binding ViewModel.ReferenceColumnWidth, ElementName=RootPage}&quot;/&gt;
                                         &lt;ColumnDefinition Width=&quot;{Binding ViewModel.SpecsColumnWidth, ElementName=RootPage}&quot;/&gt;
                                         &lt;ColumnDefinition Width=&quot;80&quot;/&gt;
                                    &lt;/Grid.ColumnDefinitions&gt;
                                    &lt;TextBlock Grid.Column=&quot;0&quot; Text=&quot;{x:Bind LineNumber}&quot; Margin=&quot;0,0,12,0&quot;/&gt;
                                    &lt;TextBlock Grid.Column=&quot;1&quot; Text=&quot;{x:Bind PartID}&quot; Margin=&quot;0,0,12,0&quot;/&gt;
                                    &lt;TextBlock Grid.Column=&quot;2&quot; Text=&quot;{x:Bind Description}&quot; TextTrimming=&quot;CharacterEllipsis&quot; Margin=&quot;0,0,12,0&quot;/&gt;
                                    &lt;TextBlock Grid.Column=&quot;3&quot; Text=&quot;{x:Bind ReferenceInfo}&quot; TextTrimming=&quot;CharacterEllipsis&quot; Margin=&quot;0,0,12,0&quot;/&gt;
                                    &lt;TextBlock Grid.Column=&quot;4&quot; Text=&quot;{x:Bind SpecificationsPreview}&quot; TextTrimming=&quot;CharacterEllipsis&quot; Foreground=&quot;{ThemeResource TextFillColorSecondaryBrush}&quot; Margin=&quot;0,0,12,0&quot;/&gt;
                                    &lt;TextBlock Grid.Column=&quot;5&quot; Text=&quot;{x:Bind QuantityOrderedDisplay}&quot; HorizontalAlignment=&quot;Right&quot;/&gt;
                                &lt;/Grid&gt;
                            &lt;/DataTemplate&gt;
                        &lt;/ListView.ItemTemplate&gt;
                    &lt;/ListView&gt;
                &lt;/Grid&gt;
            &lt;/Border&gt;

            &lt;!-- Specs Detail Panel --&gt;
            &lt;Border Grid.Column=&quot;1&quot; 
                    Background=&quot;{ThemeResource CardBackgroundFillColorDefaultBrush}&quot;
                    BorderBrush=&quot;{ThemeResource CardStrokeColorDefaultBrush}&quot;
                    BorderThickness=&quot;1&quot;
                    CornerRadius=&quot;8&quot;
                    Padding=&quot;16&quot;
                    Visibility=&quot;{x:Bind ViewModel.IsLineSelected, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;&gt;
                &lt;Grid RowSpacing=&quot;12&quot;&gt;
                    &lt;Grid.RowDefinitions&gt;
                        &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                        &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                        &lt;RowDefinition Height=&quot;*&quot;/&gt;
                    &lt;/Grid.RowDefinitions&gt;
                    
                    &lt;!-- Title --&gt;
                    &lt;TextBlock Grid.Row=&quot;0&quot; 
                               Text=&quot;{x:Bind ViewModel.SelectedPOLineTitle, Mode=OneWay}&quot; 
                               Style=&quot;{ThemeResource SubtitleTextBlockStyle}&quot;
                               HorizontalAlignment=&quot;Center&quot;
                               TextAlignment=&quot;Center&quot;/&gt;

                    &lt;!-- Fields --&gt;
                    &lt;StackPanel Grid.Row=&quot;1&quot; Spacing=&quot;8&quot;&gt;
                        &lt;!-- Part ID --&gt;
                        &lt;Grid&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            &lt;TextBlock Text=&quot;Part ID:&quot; FontWeight=&quot;SemiBold&quot; Margin=&quot;0,0,8,0&quot;/&gt;
                            &lt;TextBlock Grid.Column=&quot;1&quot; Text=&quot;{x:Bind ViewModel.SelectedPOLine.PartID, Mode=OneWay}&quot; TextWrapping=&quot;Wrap&quot;/&gt;
                        &lt;/Grid&gt;

                        &lt;!-- Description --&gt;
                        &lt;Grid&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            &lt;TextBlock Text=&quot;Desc:&quot; FontWeight=&quot;SemiBold&quot; Margin=&quot;0,0,8,0&quot;/&gt;
                            &lt;TextBlock Grid.Column=&quot;1&quot; Text=&quot;{x:Bind ViewModel.SelectedPOLine.Description, Mode=OneWay}&quot; TextWrapping=&quot;Wrap&quot;/&gt;
                        &lt;/Grid&gt;

                        &lt;!-- Quantity --&gt;
                        &lt;Grid&gt;
                            &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            &lt;TextBlock Text=&quot;Qty:&quot; FontWeight=&quot;SemiBold&quot; Margin=&quot;0,0,8,0&quot;/&gt;
                            &lt;TextBlock Grid.Column=&quot;1&quot; Text=&quot;{x:Bind ViewModel.SelectedPOLine.QuantityOrderedDisplay, Mode=OneWay}&quot;/&gt;
                        &lt;/Grid&gt;

                        &lt;!-- WO/CO (Hide if empty) --&gt;
                        &lt;Grid Visibility=&quot;{x:Bind ViewModel.HasReferenceInfo, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;&gt;
                             &lt;Grid.ColumnDefinitions&gt;
                                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                            &lt;/Grid.ColumnDefinitions&gt;
                            &lt;TextBlock Text=&quot;Ref:&quot; FontWeight=&quot;SemiBold&quot; Margin=&quot;0,0,8,0&quot;/&gt;
                            &lt;TextBlock Grid.Column=&quot;1&quot; Text=&quot;{x:Bind ViewModel.SelectedPOLine.ReferenceInfo, Mode=OneWay}&quot; TextWrapping=&quot;Wrap&quot;/&gt;
                        &lt;/Grid&gt;
                    &lt;/StackPanel&gt;

                    &lt;!-- Specs --&gt;
                    &lt;Border Grid.Row=&quot;2&quot; Background=&quot;{ThemeResource LayerFillColorDefaultBrush}&quot; CornerRadius=&quot;4&quot; Padding=&quot;8&quot;&gt;
                         &lt;ScrollViewer VerticalScrollBarVisibility=&quot;Auto&quot;&gt;
                            &lt;TextBlock Text=&quot;{x:Bind ViewModel.SelectedPOLine.Specifications, Mode=OneWay}&quot; 
                                       TextWrapping=&quot;Wrap&quot; 
                                       Style=&quot;{ThemeResource BodyTextBlockStyle}&quot;/&gt;
                        &lt;/ScrollViewer&gt;
                    &lt;/Border&gt;
                &lt;/Grid&gt;
            &lt;/Border&gt;
        &lt;/Grid&gt;

        &lt;!-- Status Bar --&gt;
        &lt;StackPanel Grid.Row=&quot;3&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot;&gt;
            &lt;ProgressRing IsActive=&quot;{x:Bind ViewModel.IsBusy, Mode=OneWay}&quot;
                          Width=&quot;20&quot; Height=&quot;20&quot;/&gt;
            &lt;TextBlock Text=&quot;{x:Bind ViewModel.StatusMessage, Mode=OneWay}&quot;
                       VerticalAlignment=&quot;Center&quot;/&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Action Buttons --&gt;
        &lt;StackPanel Grid.Row=&quot;4&quot; Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot; HorizontalAlignment=&quot;Right&quot;&gt;
            &lt;Button Content=&quot;{x:Bind ViewModel.NavigationButtonText, Mode=OneWay}&quot;
                    Command=&quot;{x:Bind ViewModel.ProceedToStep2Command}&quot;
                    Style=&quot;{StaticResource AccentButtonStyle}&quot;/&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Volvo/Data/Dao_VolvoShipment.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Volvo.Models;
using MTM_Receiving_Application.Module_Core.Helpers.Database;

namespace MTM_Receiving_Application.Module_Volvo.Data;

/// &lt;summary&gt;
/// Data Access Object for volvo_label_data table
/// Provides CRUD operations using stored procedures
/// &lt;/summary&gt;
public class Dao_VolvoShipment
{
    private readonly string _connectionString;

    public Dao_VolvoShipment(string connectionString)
    {
        _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
    }

    /// &lt;summary&gt;
    /// Inserts a new Volvo shipment and returns the generated ID and shipment number
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipment&quot;&gt;Volvo shipment model to insert&lt;/param&gt;
    /// &lt;returns&gt;Model_Dao_Result with shipment ID and number in Data property&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;(int ShipmentId, int ShipmentNumber)&gt;&gt; InsertAsync(Model_VolvoShipment shipment)
    {
        try
        {
            await using var connection = new MySqlConnection(_connectionString);
            await connection.OpenAsync();

            await using var command = new MySqlCommand(&quot;sp_volvo_shipment_insert&quot;, connection)
            {
                CommandType = CommandType.StoredProcedure
            };

            // Input parameters
            command.Parameters.AddWithValue(&quot;@p_shipment_date&quot;, shipment.ShipmentDate);
            command.Parameters.AddWithValue(&quot;@p_employee_number&quot;, shipment.EmployeeNumber);
            command.Parameters.AddWithValue(&quot;@p_notes&quot;, shipment.Notes ?? (object)DBNull.Value);

            // Output parameters
            var newIdParam = new MySqlParameter(&quot;@p_new_id&quot;, MySqlDbType.Int32)
            {
                Direction = ParameterDirection.Output
            };
            var shipmentNumberParam = new MySqlParameter(&quot;@p_shipment_number&quot;, MySqlDbType.Int32)
            {
                Direction = ParameterDirection.Output
            };

            command.Parameters.Add(newIdParam);
            command.Parameters.Add(shipmentNumberParam);

            await command.ExecuteNonQueryAsync();

            var shipmentId = Convert.ToInt32(newIdParam.Value);
            var shipmentNumber = Convert.ToInt32(shipmentNumberParam.Value);

            return new Model_Dao_Result&lt;(int, int)&gt;
            {
                Success = true,
                Data = (shipmentId, shipmentNumber),
                AffectedRows = 1
            };
        }
        catch (Exception ex)
        {
            return new Model_Dao_Result&lt;(int, int)&gt;
            {
                Success = false,
                ErrorMessage = $&quot;Error inserting Volvo shipment: {ex.Message}&quot;,
                Severity = Enum_ErrorSeverity.Error,
                Exception = ex
            };
        }
    }

    /// &lt;summary&gt;
    /// Updates a Volvo shipment
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipment&quot;&gt;Volvo shipment model to update&lt;/param&gt;
    /// &lt;returns&gt;Model_Dao_Result indicating success/failure&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&gt; UpdateAsync(Model_VolvoShipment shipment)
    {
        try
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;id&quot;, shipment.Id },
                { &quot;notes&quot;, shipment.Notes ?? (object)DBNull.Value }
            };

            var result = await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
                _connectionString,
                &quot;sp_volvo_shipment_update&quot;,
                parameters);

            return result;
        }
        catch (Exception ex)
        {
            return new Model_Dao_Result
            {
                Success = false,
                ErrorMessage = $&quot;Error updating Volvo shipment: {ex.Message}&quot;,
                Severity = Enum_ErrorSeverity.Error,
                Exception = ex
            };
        }
    }

    /// &lt;summary&gt;
    /// Completes a shipment with PO and Receiver numbers
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipmentId&quot;&gt;Shipment ID&lt;/param&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;Purchase order number&lt;/param&gt;
    /// &lt;param name=&quot;receiverNumber&quot;&gt;Receiver number&lt;/param&gt;
    /// &lt;returns&gt;Model_Dao_Result indicating success/failure&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&gt; CompleteAsync(int shipmentId, string poNumber, string receiverNumber)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;shipment_id&quot;, shipmentId },
            { &quot;po_number&quot;, poNumber },
            { &quot;receiver_number&quot;, receiverNumber }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_volvo_shipment_complete&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Deletes a shipment and all its lines (CASCADE DELETE)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipmentId&quot;&gt;Shipment ID to delete&lt;/param&gt;
    /// &lt;returns&gt;Model_Dao_Result indicating success/failure&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&gt; DeleteAsync(int shipmentId)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;shipment_id&quot;, shipmentId }
        };

        return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
            _connectionString,
            &quot;sp_volvo_shipment_delete&quot;,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Gets the pending shipment if one exists
    /// &lt;/summary&gt;
    /// &lt;returns&gt;Model_Dao_Result with pending shipment or null if none exists&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_VolvoShipment&gt;&gt; GetPendingAsync()
    {
        return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
            _connectionString,
            &quot;sp_Volvo_Shipment_GetPending&quot;,
            MapFromReader,
            null
        );
    }

    /// &lt;summary&gt;
    /// Gets a shipment by ID
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipmentId&quot;&gt;Shipment ID&lt;/param&gt;
    /// &lt;returns&gt;Model_Dao_Result with shipment or null if not found&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_VolvoShipment?&gt;&gt; GetByIdAsync(int shipmentId)
    {
        try
        {
            await using var connection = new MySqlConnection(_connectionString);
            await connection.OpenAsync();

            await using var command = new MySqlCommand
            {
                Connection = connection,
                CommandText = @&quot;
                    SELECT id, shipment_date, shipment_number, po_number, receiver_number,
                           employee_number, notes, status, created_date, modified_date, is_archived
                    FROM volvo_label_data
                    WHERE id = @p_id&quot;,
                CommandType = CommandType.Text
            };

            command.Parameters.AddWithValue(&quot;@p_id&quot;, shipmentId);

            await using var reader = await command.ExecuteReaderAsync();

            if (await reader.ReadAsync())
            {
                return new Model_Dao_Result&lt;Model_VolvoShipment?&gt;
                {
                    Success = true,
                    Data = MapFromReader(reader),
                    AffectedRows = 1
                };
            }

            return new Model_Dao_Result&lt;Model_VolvoShipment?&gt;
            {
                Success = false,
                Data = null,
                ErrorMessage = &quot;Shipment not found&quot;
            };
        }
        catch (Exception ex)
        {
            return new Model_Dao_Result&lt;Model_VolvoShipment?&gt;
            {
                Success = false,
                Data = null,
                ErrorMessage = $&quot;Error retrieving shipment: {ex.Message}&quot;,
                Severity = Enum_ErrorSeverity.Error,
                Exception = ex
            };
        }
    }

    /// &lt;summary&gt;
    /// Gets shipment history with filtering
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;startDate&quot;&gt;Start date for filter&lt;/param&gt;
    /// &lt;param name=&quot;endDate&quot;&gt;End date for filter&lt;/param&gt;
    /// &lt;param name=&quot;status&quot;&gt;Status filter (&apos;pending_po&apos;, &apos;completed&apos;, or &apos;all&apos;)&lt;/param&gt;
    /// &lt;returns&gt;Model_Dao_Result with list of shipments&lt;/returns&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoShipment&gt;&gt;&gt; GetHistoryAsync(
        DateTime startDate,
        DateTime endDate,
        string status = &quot;all&quot;)
    {
        var parameters = new Dictionary&lt;string, object&gt;
        {
            { &quot;start_date&quot;, startDate.Date },
            { &quot;end_date&quot;, endDate.Date },
            { &quot;status&quot;, status }
        };

        return await Helper_Database_StoredProcedure.ExecuteListAsync(
            _connectionString,
            &quot;sp_Volvo_Shipment_GetHistory&quot;,
            MapFromReader,
            parameters
        );
    }

    /// &lt;summary&gt;
    /// Maps DataReader to Model_VolvoShipment
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;reader&quot;&gt;&lt;/param&gt;
    private static Model_VolvoShipment MapFromReader(IDataReader reader)
    {
        return new Model_VolvoShipment
        {
            Id = reader.GetInt32(reader.GetOrdinal(&quot;id&quot;)),
            ShipmentDate = reader.GetDateTime(reader.GetOrdinal(&quot;shipment_date&quot;)),
            ShipmentNumber = reader.GetInt32(reader.GetOrdinal(&quot;shipment_number&quot;)),
            PONumber = reader.IsDBNull(reader.GetOrdinal(&quot;po_number&quot;))
                ? null
                : reader.GetString(reader.GetOrdinal(&quot;po_number&quot;)),
            ReceiverNumber = reader.IsDBNull(reader.GetOrdinal(&quot;receiver_number&quot;))
                ? null
                : reader.GetString(reader.GetOrdinal(&quot;receiver_number&quot;)),
            EmployeeNumber = reader.GetString(reader.GetOrdinal(&quot;employee_number&quot;)),
            Notes = reader.IsDBNull(reader.GetOrdinal(&quot;notes&quot;))
                ? null
                : reader.GetString(reader.GetOrdinal(&quot;notes&quot;)),
            Status = reader.GetString(reader.GetOrdinal(&quot;status&quot;)),
            CreatedDate = reader.GetDateTime(reader.GetOrdinal(&quot;created_date&quot;)),
            ModifiedDate = reader.GetDateTime(reader.GetOrdinal(&quot;modified_date&quot;)),
            IsArchived = reader.GetBoolean(reader.GetOrdinal(&quot;is_archived&quot;))
        };
    }
}</file><file path="Module_Volvo/Models/Model_VolvoShipmentLine.cs">using System;
using CommunityToolkit.Mvvm.ComponentModel;

namespace MTM_Receiving_Application.Module_Volvo.Models;

/// &lt;summary&gt;
/// Represents an individual part line item within a Volvo shipment
/// Maps to volvo_line_data database table
/// &lt;/summary&gt;
public partial class Model_VolvoShipmentLine : ObservableObject
{
    /// &lt;summary&gt;
    /// Auto-increment primary key
    /// &lt;/summary&gt;
    [ObservableProperty]
    private int _id;

    /// &lt;summary&gt;
    /// Foreign key to parent shipment
    /// &lt;/summary&gt;
    [ObservableProperty]
    private int _shipmentId;

    /// &lt;summary&gt;
    /// Volvo part number (from volvo_masterdata)
    /// Example: V-EMB-500, V-EMB-750
    /// &lt;/summary&gt;
    [ObservableProperty]
    private string _partNumber = string.Empty;

    /// &lt;summary&gt;
    /// Quantity per skid for this part (cached for recalculation)
    /// &lt;/summary&gt;
    [ObservableProperty]
    private int _quantityPerSkid;

    /// &lt;summary&gt;
    /// Number of skids actually received (user-entered count)
    /// &lt;/summary&gt;
    [ObservableProperty]
    private int _receivedSkidCount;

    /// &lt;summary&gt;
    /// Calculated piece count from component explosion
    /// IMPORTANT: Stored at creation time (historical integrity - doesn&apos;t change if master data updates)
    /// &lt;/summary&gt;
    [ObservableProperty]
    private int _calculatedPieceCount;

    /// &lt;summary&gt;
    /// Flag indicating if there is a discrepancy between expected and received quantities
    /// If true, ExpectedSkidCount and DiscrepancyNote are populated
    /// &lt;/summary&gt;
    [ObservableProperty]
    private bool _hasDiscrepancy = false;

    /// &lt;summary&gt;
    /// Expected skid count from Volvo packlist (NULL if no discrepancy)
    /// Used to calculate difference: ReceivedSkidCount - ExpectedSkidCount
    /// &lt;/summary&gt;
    [ObservableProperty]
    private double? _expectedSkidCount;

    /// &lt;summary&gt;
    /// User&apos;s note about the discrepancy (NULL if no discrepancy)
    /// &lt;/summary&gt;
    [ObservableProperty]
    private string? _discrepancyNote;

    /// &lt;summary&gt;
    /// Expected piece count (calculated from ExpectedSkidCount  QuantityPerSkid)
    /// Returns null if no expected count is set
    /// &lt;/summary&gt;
    public int? ExpectedPieceCount =&gt; ExpectedSkidCount.HasValue &amp;&amp; QuantityPerSkid &gt; 0
        ? (int)(ExpectedSkidCount.Value * QuantityPerSkid)
        : null;

    /// &lt;summary&gt;
    /// Calculated difference between received and expected pieces
    /// Positive = more received than expected, Negative = fewer received
    /// Returns null if no expected count is set
    /// &lt;/summary&gt;
    public int? PieceDifference =&gt; ExpectedPieceCount.HasValue
        ? CalculatedPieceCount - ExpectedPieceCount.Value
        : null;

    /// &lt;summary&gt;
    /// Recalculate pieces when received skid count changes
    /// &lt;/summary&gt;
    partial void OnReceivedSkidCountChanged(int value)
    {
        CalculatedPieceCount = QuantityPerSkid * value;
        OnPropertyChanged(nameof(PieceDifference));
        OnPropertyChanged(nameof(ExpectedPieceCount));
    }

    /// &lt;summary&gt;
    /// Update calculated values when quantity per skid changes
    /// &lt;/summary&gt;
    partial void OnQuantityPerSkidChanged(int value)
    {
        CalculatedPieceCount = ReceivedSkidCount * value;
        OnPropertyChanged(nameof(ExpectedPieceCount));
        OnPropertyChanged(nameof(PieceDifference));
    }

    /// &lt;summary&gt;
    /// Update calculated difference when expected skid count changes
    /// &lt;/summary&gt;
    partial void OnExpectedSkidCountChanged(double? value)
    {
        OnPropertyChanged(nameof(ExpectedPieceCount));
        OnPropertyChanged(nameof(PieceDifference));
    }

    /// &lt;summary&gt;
    /// Clear discrepancy fields when HasDiscrepancy is unchecked
    /// &lt;/summary&gt;
    partial void OnHasDiscrepancyChanged(bool value)
    {
        if (!value)
        {
            ExpectedSkidCount = null;
            DiscrepancyNote = null;
        }
    }
}</file><file path="MainWindow.xaml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;Window
    x:Class=&quot;MTM_Receiving_Application.MainWindow&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:local=&quot;using:MTM_Receiving_Application&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;
    x:Name=&quot;MainWindowRoot&quot;
    Title=&quot;MTM_Receiving_Application&quot;&gt;

    &lt;Window.SystemBackdrop&gt;
        &lt;MicaBackdrop /&gt;
    &lt;/Window.SystemBackdrop&gt;

    &lt;Grid&gt;
        &lt;!-- Custom Title Bar Area (when ExtendsContentIntoTitleBar = true) --&gt;
        &lt;Grid x:Name=&quot;AppTitleBar&quot; 
              Height=&quot;48&quot; 
              VerticalAlignment=&quot;Top&quot; 
              Canvas.ZIndex=&quot;1&quot;&gt;
            &lt;Grid.ColumnDefinitions&gt;
                &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
            &lt;/Grid.ColumnDefinitions&gt;
            
            &lt;!-- App Icon and Title --&gt;
            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;12&quot; Margin=&quot;16,0,0,0&quot;&gt;
                &lt;Image Source=&quot;/Assets/app-icon.ico&quot; 
                       Width=&quot;16&quot; 
                       Height=&quot;16&quot; 
                       VerticalAlignment=&quot;Center&quot;/&gt;
                &lt;TextBlock Text=&quot;MTM Receiving Application&quot; 
                           VerticalAlignment=&quot;Center&quot;
                           Style=&quot;{StaticResource CaptionTextBlockStyle}&quot;/&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;

        &lt;NavigationView x:Name=&quot;NavView&quot;
                        PaneDisplayMode=&quot;Left&quot;
                        IsSettingsVisible=&quot;True&quot;
                        SelectionChanged=&quot;NavView_SelectionChanged&quot;&gt;
            &lt;NavigationView.PaneHeader&gt;
                &lt;TextBlock Text=&quot;MTM Receiving&quot; 
                           Style=&quot;{StaticResource TitleTextBlockStyle}&quot;
                           Margin=&quot;12,0,0,0&quot;/&gt;
            &lt;/NavigationView.PaneHeader&gt;
            
            &lt;NavigationView.Header&gt;
                &lt;StackPanel&gt;
                    &lt;Grid&gt;
                        &lt;Grid.ColumnDefinitions&gt;
                            &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                            &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                        &lt;/Grid.ColumnDefinitions&gt;
                        
                        &lt;TextBlock x:Name=&quot;PageTitleTextBlock&quot;
                                   Text=&quot;Dashboard&quot; 
                                   Style=&quot;{StaticResource TitleTextBlockStyle}&quot;
                                   VerticalAlignment=&quot;Center&quot;
                                   Margin=&quot;16,0&quot;/&gt;
                                   
                        &lt;StackPanel Grid.Column=&quot;1&quot; 
                                    Orientation=&quot;Horizontal&quot; 
                                    Spacing=&quot;12&quot; 
                                    Margin=&quot;0,0,24,0&quot;
                                    VerticalAlignment=&quot;Center&quot;&gt;
                            &lt;PersonPicture x:Name=&quot;UserPicture&quot;
                                           Height=&quot;32&quot;
                                           Width=&quot;32&quot;/&gt;
                            &lt;TextBlock x:Name=&quot;UserDisplayTextBlock&quot;
                                       Text=&quot;Not Logged In&quot;
                                       VerticalAlignment=&quot;Center&quot;
                                       Style=&quot;{StaticResource BodyStrongTextBlockStyle}&quot;/&gt;
                        &lt;/StackPanel&gt;
                    &lt;/Grid&gt;
                    &lt;InfoBar IsOpen=&quot;{x:Bind ViewModel.NotificationService.IsStatusOpen, Mode=TwoWay}&quot;
                             Severity=&quot;{x:Bind ViewModel.WinUIStatusSeverity, Mode=OneWay}&quot;
                             Message=&quot;{x:Bind ViewModel.NotificationService.StatusMessage, Mode=OneWay}&quot;
                             IsClosable=&quot;True&quot;
                             HorizontalAlignment=&quot;Center&quot;
                             VerticalAlignment=&quot;Center&quot;
                             Margin=&quot;0,20,0,20&quot;/&gt;
                &lt;/StackPanel&gt;
            &lt;/NavigationView.Header&gt;

            &lt;NavigationView.MenuItems&gt;
                &lt;NavigationViewItem Content=&quot;Receiving Labels&quot; Tag=&quot;ReceivingWorkflowView&quot; Margin=&quot;0,0,0,4&quot;&gt;
                    &lt;NavigationViewItem.Icon&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE74C;&quot; /&gt;
                    &lt;/NavigationViewItem.Icon&gt;
                &lt;/NavigationViewItem&gt;
                &lt;NavigationViewItem Content=&quot;Dunnage Labels&quot; Tag=&quot;DunnageLabelPage&quot; Margin=&quot;0,0,0,4&quot;&gt;
                    &lt;NavigationViewItem.Icon&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE7B8;&quot; /&gt;
                    &lt;/NavigationViewItem.Icon&gt;
                &lt;/NavigationViewItem&gt;
                &lt;NavigationViewItem Content=&quot;UPS / FedEx Labels&quot; Tag=&quot;RoutingLabelPage&quot; Margin=&quot;0,0,0,4&quot;&gt;
                    &lt;NavigationViewItem.Icon&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE724;&quot; /&gt;
                    &lt;/NavigationViewItem.Icon&gt;
                &lt;/NavigationViewItem&gt;
                &lt;NavigationViewItem Content=&quot;Volvo Dunnage Requisition&quot; Tag=&quot;VolvoShipmentEntry&quot; Margin=&quot;0,0,0,4&quot;&gt;
                    &lt;NavigationViewItem.Icon&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE7C1;&quot; /&gt;
                    &lt;/NavigationViewItem.Icon&gt;
                &lt;/NavigationViewItem&gt;
                &lt;NavigationViewItem Content=&quot;End of Day Reports&quot; Tag=&quot;ReportingMainPage&quot; Margin=&quot;0,0,0,4&quot;&gt;
                    &lt;NavigationViewItem.Icon&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE9F9;&quot; /&gt;
                    &lt;/NavigationViewItem.Icon&gt;
                &lt;/NavigationViewItem&gt;

                &lt;!-- Development Tools (visible in debug builds only) --&gt;
                &lt;NavigationViewItem x:Name=&quot;DatabaseTestMenuItem&quot; 
                                    Content=&quot;Settings DB Test&quot; 
                                    Tag=&quot;DatabaseTestView&quot; 
                                    Margin=&quot;0,0,0,4&quot;
                                    Visibility=&quot;Collapsed&quot;&gt;
                    &lt;NavigationViewItem.Icon&gt;
                        &lt;FontIcon Glyph=&quot;&amp;#xE8AB;&quot; /&gt;
                    &lt;/NavigationViewItem.Icon&gt;
                &lt;/NavigationViewItem&gt;

            &lt;/NavigationView.MenuItems&gt;

            &lt;Frame x:Name=&quot;ContentFrame&quot; /&gt;
        &lt;/NavigationView&gt;
    &lt;/Grid&gt;
&lt;/Window&gt;</file><file path="Module_Routing/ViewModels/RoutingWizardStep1ViewModel.cs">using System;
using System.Collections.ObjectModel;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Routing.Models;
using MTM_Receiving_Application.Module_Routing.Services;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using Microsoft.UI.Xaml.Controls;
using Microsoft.Extensions.Configuration;

namespace MTM_Receiving_Application.Module_Routing.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Wizard Step 1: PO and Line Selection (or OTHER workflow)
/// &lt;/summary&gt;
public partial class RoutingWizardStep1ViewModel : ObservableObject
{
    private readonly IRoutingInforVisualService _inforVisualService;
    private readonly IRoutingService _routingService;
    private readonly IService_ErrorHandler _errorHandler;
    private readonly IService_LoggingUtility _logger;
    private readonly Microsoft.Extensions.Configuration.IConfiguration _configuration;

    // Issue #24: TODO - Replace with WeakReferenceMessenger for loose coupling
    // Current implementation uses direct parent reference for communication
    // Migration requires: Message classes, messenger registration, 3 step ViewModels update
    private readonly RoutingWizardContainerViewModel _containerViewModel;

    #region Constructor
    public RoutingWizardStep1ViewModel(
        IRoutingInforVisualService inforVisualService,
        IRoutingService routingService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger,
        RoutingWizardContainerViewModel containerViewModel,
        Microsoft.Extensions.Configuration.IConfiguration configuration)
    {
        _inforVisualService = inforVisualService;
        _routingService = routingService;
        _errorHandler = errorHandler;
        _logger = logger;
        _containerViewModel = containerViewModel;
        _configuration = configuration;

        // Subscribe to container property changes to update button text
        _containerViewModel.PropertyChanged += (s, e) =&gt;
        {
            if (e.PropertyName == nameof(_containerViewModel.IsEditingFromReview))
            {
                OnPropertyChanged(nameof(IsEditingFromReview));
                OnPropertyChanged(nameof(NavigationButtonText));
            }
        };

        // Auto-fill PO number if using mock data
        InitializeAsync();
    }
    #endregion

    #region Observable Properties
    /// &lt;summary&gt;
    /// PO Number entered by user
    /// &lt;/summary&gt;
    [ObservableProperty]
    private string _poNumber = string.Empty;

    /// &lt;summary&gt;
    /// List of PO lines retrieved from Infor Visual
    /// &lt;/summary&gt;
    [ObservableProperty]
    private ObservableCollection&lt;Model_InforVisualPOLine&gt; _poLines = new();

    /// &lt;summary&gt;
    /// Selected PO line from DataGrid
    /// &lt;/summary&gt;
    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(IsLineSelected))]
    [NotifyPropertyChangedFor(nameof(SelectedPOLineTitle))]
    [NotifyPropertyChangedFor(nameof(HasReferenceInfo))]
    private Model_InforVisualPOLine? _selectedPOLine;

    /// &lt;summary&gt;
    /// Helper property for binding visibility of details panel
    /// &lt;/summary&gt;
    public bool IsLineSelected =&gt; SelectedPOLine != null;

    /// &lt;summary&gt;
    /// Title for the details panel
    /// &lt;/summary&gt;
    public string SelectedPOLineTitle =&gt; SelectedPOLine != null 
        ? $&quot;Line {SelectedPOLine.LineNumber} Specifications&quot; 
        : string.Empty;

    /// &lt;summary&gt;
    /// Helper to show/hide reference info field
    /// &lt;/summary&gt;
    public bool HasReferenceInfo =&gt; SelectedPOLine != null &amp;&amp; !string.IsNullOrEmpty(SelectedPOLine.ReferenceInfo);

    /// &lt;summary&gt;
    /// Indicates whether we&apos;re in OTHER mode (no PO validation)
    /// &lt;/summary&gt;
    [ObservableProperty]
    private bool _isOtherMode;

    /// &lt;summary&gt;
    /// Available OTHER reasons (RETURNED, SAMPLE, etc.)
    /// &lt;/summary&gt;
    [ObservableProperty]
    private ObservableCollection&lt;Model_RoutingOtherReason&gt; _otherReasons = new();

    /// &lt;summary&gt;
    /// Selected OTHER reason from dropdown
    /// &lt;/summary&gt;
    [ObservableProperty]
    private Model_RoutingOtherReason? _selectedOtherReason;

    /// &lt;summary&gt;
    /// Manual quantity for OTHER workflow
    /// &lt;/summary&gt;
    [ObservableProperty]
    private int _otherQuantity = 1;

    /// &lt;summary&gt;
    /// Busy indicator
    /// &lt;/summary&gt;
    [ObservableProperty]
    private bool _isBusy;

    /// &lt;summary&gt;
    /// Status message
    /// &lt;/summary&gt;
    [ObservableProperty]
    private string _statusMessage = &quot;Enter PO number or select OTHER&quot;;

    /// &lt;summary&gt;
    /// Is user editing from review (Step 3)
    /// &lt;/summary&gt;
    public bool IsEditingFromReview =&gt; _containerViewModel.IsEditingFromReview;

    /// &lt;summary&gt;
    /// Button text for navigation (changes when editing from review)
    /// &lt;/summary&gt;
    public string NavigationButtonText =&gt; IsEditingFromReview ? &quot;Back to Review&quot; : &quot;Next: Select Recipient&quot;;

    /// &lt;summary&gt;
    /// Controls visibility of the Reference column (hidden if empty for all rows)
    /// &lt;/summary&gt;
    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(ReferenceColumnWidth))]
    private bool _isReferenceColumnVisible;

    public Microsoft.UI.Xaml.GridLength ReferenceColumnWidth =&gt; _isReferenceColumnVisible ? new Microsoft.UI.Xaml.GridLength(100) : new Microsoft.UI.Xaml.GridLength(0);

    /// &lt;summary&gt;
    /// Controls visibility of the Specs column (hidden if empty for all rows)
    /// &lt;/summary&gt;
    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(SpecsColumnWidth))]
    private bool _isSpecsColumnVisible;

    public Microsoft.UI.Xaml.GridLength SpecsColumnWidth =&gt; _isSpecsColumnVisible ? new Microsoft.UI.Xaml.GridLength(1, Microsoft.UI.Xaml.GridUnitType.Star) : new Microsoft.UI.Xaml.GridLength(0);
    #endregion

    #region Commands
    /// &lt;summary&gt;
    /// Validate PO number and fetch lines
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task ValidatePOAsync()
    {
        if (IsBusy)
        {
            return;
        }

        if (string.IsNullOrWhiteSpace(PoNumber))
        {
            StatusMessage = &quot;Please enter a PO number&quot;;
            return;
        }

        try
        {
            IsBusy = true;
            StatusMessage = &quot;Validating PO...&quot;;

            // Validate PO exists in Infor Visual
            var validationResult = await _inforVisualService.ValidatePoNumberAsync(PoNumber);

            if (validationResult.IsSuccess &amp;&amp; validationResult.Data)
            {
                // Issue #30: Better progress feedback
                StatusMessage = &quot;PO valid - fetching line items...&quot;;

                // PO is valid - fetch lines
                var linesResult = await _inforVisualService.GetPoLinesAsync(PoNumber);

                if (linesResult.IsSuccess &amp;&amp; linesResult.Data != null)
                {
                    PoLines.Clear();
                    bool hasRefs = false;
                    bool hasSpecs = false;

                    foreach (var line in linesResult.Data)
                    {
                        PoLines.Add(line);
                        if (!string.IsNullOrEmpty(line.ReferenceInfo)) hasRefs = true;
                        if (!string.IsNullOrEmpty(line.SpecificationsPreview)) hasSpecs = true;
                    }

                    IsReferenceColumnVisible = hasRefs;
                    IsSpecsColumnVisible = hasSpecs;

                    // Issue #27: Check for empty lines result
                    if (PoLines.Count == 0)
                    {
                        StatusMessage = $&quot;PO {PoNumber} is valid but has no open lines available&quot;;
                        await _errorHandler.ShowUserErrorAsync(
                            $&quot;PO {PoNumber} exists but has no open line items to route.&quot;,
                            &quot;No Lines Available&quot;,
                            nameof(ValidatePOAsync)
                        );
                    }
                    else
                    {
                        StatusMessage = $&quot;Found {PoLines.Count} line(s) for PO {PoNumber}&quot;;
                    }
                }
                else
                {
                    StatusMessage = &quot;No lines found for this PO&quot;;
                }
            }
            else
            {
                // PO not found or Infor Visual offline
                await ShowPONotFoundDialogAsync();
            }
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Medium,
                nameof(ValidatePOAsync),
                nameof(RoutingWizardStep1ViewModel));
            StatusMessage = &quot;Error validating PO&quot;;
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Switch to OTHER mode (manual entry without PO)
    /// &lt;/summary&gt;
    [RelayCommand]
    private async Task SwitchToOtherModeAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading OTHER reasons...&quot;;

            // Issue #13: GetOtherReasonsAsync not implemented in IRoutingService
            // Feature requires database table: routing_po_alternatives (id, reason_code, description, is_active)
            // Stored procedure: sp_routing_po_alternatives_get_active
            // Priority: LOW - Wizard mode (PO-based) is primary workflow
            // var reasonsResult = await _routingService.GetOtherReasonsAsync();
            // if (reasonsResult.IsSuccess &amp;&amp; reasonsResult.Data != null)
            // {
            //     OtherReasons.Clear();
            //     foreach (var reason in reasonsResult.Data)
            //     {
            //         OtherReasons.Add(reason);
            //     }
            //     IsOtherMode = true;
            //     PoLines.Clear();
            //     StatusMessage = &quot;Select a reason for non-PO package&quot;;
            // }
            // else
            // {
            //     await _errorHandler.ShowUserErrorAsync(
            //         &quot;Failed to load OTHER reasons&quot;,
            //         &quot;Data Load Error&quot;,
            //         nameof(SwitchToOtherModeAsync));
            // }

            await Task.CompletedTask;
            IsOtherMode = true;
            PoLines.Clear();
            StatusMessage = &quot;OTHER reasons loading not yet implemented&quot;;
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Medium,
                nameof(SwitchToOtherModeAsync),
                nameof(RoutingWizardStep1ViewModel));
        }
        finally
        {
            IsBusy = false;
        }
    }

    /// &lt;summary&gt;
    /// Proceed to Step 2 (Recipient Selection)
    /// &lt;/summary&gt;
    [RelayCommand(CanExecute = nameof(CanProceedToStep2))]
    private void ProceedToStep2()
    {
        try
        {
            _logger.LogInfo($&quot;ProceedToStep2 called - IsOtherMode: {IsOtherMode}, SelectedPOLine: {SelectedPOLine?.PartID ?? &quot;null&quot;}, SelectedOtherReason: {SelectedOtherReason?.Description ?? &quot;null&quot;}&quot;);

            // Update container with selected data
            if (IsOtherMode &amp;&amp; SelectedOtherReason != null)
            {
                _containerViewModel.SelectedOtherReason = SelectedOtherReason;
                _containerViewModel.OtherQuantity = OtherQuantity;
                _containerViewModel.SelectedPOLine = null;
                _logger.LogInfo($&quot;Updated container with OTHER reason: {SelectedOtherReason.Description}, Quantity: {OtherQuantity}&quot;);
            }
            else if (SelectedPOLine != null)
            {
                _containerViewModel.SelectedPOLine = SelectedPOLine;
                _containerViewModel.SelectedOtherReason = null;
                _logger.LogInfo($&quot;Updated container with PO Line: {SelectedPOLine.PartID}, PO: {SelectedPOLine.PONumber}&quot;);
            }
            else
            {
                _logger.LogWarning(&quot;ProceedToStep2: Neither PO line nor OTHER reason selected&quot;);
                StatusMessage = &quot;Please select a PO line or OTHER reason&quot;;
                return;
            }

            // Navigate based on edit mode
            if (IsEditingFromReview)
            {
                _logger.LogInfo(&quot;Returning to Step 3 (Review) after edit&quot;);
                _containerViewModel.NavigateToStep3Command.Execute(null);
            }
            else
            {
                _logger.LogInfo(&quot;Executing NavigateToStep2Command&quot;);
                _containerViewModel.NavigateToStep2Command.Execute(null);
                _logger.LogInfo(&quot;NavigateToStep2Command executed&quot;);
            }
        }
        catch (Exception ex)
        {
            _logger.LogError($&quot;Error in ProceedToStep2: {ex.Message}&quot;, ex);
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Error,
                nameof(ProceedToStep2),
                nameof(RoutingWizardStep1ViewModel));
        }
    }

    /// &lt;summary&gt;
    /// Can proceed to Step 2 if either PO line or OTHER reason is selected
    /// &lt;/summary&gt;
    private bool CanProceedToStep2()
    {
        var canProceed = (IsOtherMode &amp;&amp; SelectedOtherReason != null) ||
               (!IsOtherMode &amp;&amp; SelectedPOLine != null);
        _logger.LogInfo($&quot;CanProceedToStep2: {canProceed} - IsOtherMode: {IsOtherMode}, SelectedPOLine: {SelectedPOLine?.PartID ?? &quot;null&quot;}, SelectedOtherReason: {SelectedOtherReason?.Description ?? &quot;null&quot;}&quot;);
        return canProceed;
    }
    #endregion

    #region Helper Methods
    /// &lt;summary&gt;
    /// Show &quot;PO not found&quot; confirmation dialog
    /// &lt;/summary&gt;
    private async Task ShowPONotFoundDialogAsync()
    {
        // Issue #29: Null guard for XamlRoot
        if (App.MainWindow?.Content?.XamlRoot == null)
        {
            await _errorHandler.ShowUserErrorAsync(
                &quot;Unable to display dialog - window not initialized&quot;,
                &quot;UI Error&quot;,
                nameof(ShowPONotFoundDialogAsync)
            );
            StatusMessage = &quot;Error: UI not ready&quot;;
            return;
        }

        var dialog = new ContentDialog
        {
            Title = &quot;PO Not Found&quot;,
            Content = $&quot;PO &apos;{PoNumber}&apos; was not found in Infor Visual.\n\nWould you like to treat this as an OTHER (non-PO) package?&quot;,
            PrimaryButtonText = &quot;Yes, treat as OTHER&quot;,
            CloseButtonText = &quot;No, try again&quot;,
            DefaultButton = ContentDialogButton.Close,
            XamlRoot = App.MainWindow.Content.XamlRoot
        };

        var result = await dialog.ShowAsync();

        if (result == ContentDialogResult.Primary)
        {
            // User chose to treat as OTHER
            await SwitchToOtherModeAsync();
        }
        else
        {
            // User chose to retry
            PoNumber = string.Empty;
            StatusMessage = &quot;Enter a valid PO number&quot;;
        }
    }

    /// &lt;summary&gt;
    /// Notify command can execute changed when selection changes
    /// &lt;/summary&gt;
    partial void OnSelectedPOLineChanged(Model_InforVisualPOLine? value)
    {
        _logger.LogInfo($&quot;SelectedPOLine changed to: {value?.PartID ?? &quot;null&quot;} (PO: {value?.PONumber ?? &quot;null&quot;})&quot;);
        ProceedToStep2Command.NotifyCanExecuteChanged();

        if (value != null)
        {
            StatusMessage = $&quot;Selected: {value.PartID} - Click &apos;Next&apos; to continue&quot;;
        }
    }

    partial void OnSelectedOtherReasonChanged(Model_RoutingOtherReason? value)
    {
        _logger.LogInfo($&quot;SelectedOtherReason changed to: {value?.Description ?? &quot;null&quot;}&quot;);
        ProceedToStep2Command.NotifyCanExecuteChanged();

        if (value != null)
        {
            StatusMessage = $&quot;Selected: {value.Description} - Click &apos;Next&apos; to continue&quot;;
        }
    }

    /// &lt;summary&gt;
    /// Initialize component - autofill PO if mock data enabled
    /// &lt;/summary&gt;
    private async void InitializeAsync()
    {
        try
        {
            var useMockData = _configuration.GetValue&lt;bool&gt;(&quot;AppSettings:UseInforVisualMockData&quot;);

            if (useMockData)
            {
                var defaultPO = _configuration.GetValue&lt;string&gt;(&quot;AppSettings:DefaultMockPONumber&quot;) ?? &quot;PO-066868&quot;;
                await _logger.LogInfoAsync($&quot;[MOCK DATA MODE] Auto-filling PO number: {defaultPO}&quot;);

                PoNumber = defaultPO;
                StatusMessage = $&quot;[MOCK DATA] Auto-filled PO: {defaultPO}&quot;;

                // Auto-validate and load mock data
                await Task.Delay(500); // Small delay for UI update
                await ValidatePOAsync();
            }
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error during initialization: {ex.Message}&quot;, ex);
        }
    }
    #endregion
}</file><file path="Module_Settings/ViewModels/ViewModel_Settings_DatabaseTest.cs">using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Settings.Data;
using MTM_Receiving_Application.Module_Settings.Models;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using MySql.Data.MySqlClient;
using System;
using System.Collections.ObjectModel;
using System.Diagnostics;
using System.IO;
using System.Linq;
using System.Text;
using System.Text.Json;
using System.Threading.Tasks;

namespace MTM_Receiving_Application.Module_Settings.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Settings Database Test - Development tool for validating database implementation
/// &lt;/summary&gt;
public partial class ViewModel_Settings_DatabaseTest : ViewModel_Shared_Base
{
    #region Dependencies
    private readonly Dao_SystemSettings _daoSystemSettings;
    private readonly Dao_UserSettings _daoUserSettings;
    private readonly Dao_PackageType _daoPackageType;
    private readonly Dao_PackageTypeMappings _daoPackageTypeMappings;
    private readonly Dao_RoutingRule _daoRoutingRule;
    private readonly Dao_ScheduledReport _daoScheduledReport;
    private readonly Dao_SettingsAuditLog _daoSettingsAuditLog;
    #endregion

    #region Observable Properties

    // Connection Status
    [ObservableProperty]
    private bool _isConnected;

    [ObservableProperty]
    private string _connectionStatus = &quot;Not Connected&quot;;

    [ObservableProperty]
    private int _connectionTimeMs;

    [ObservableProperty]
    private string _serverVersion = string.Empty;

    // Test Summary
    [ObservableProperty]
    private int _tablesValidated;

    [ObservableProperty]
    private int _totalTables = 7;

    [ObservableProperty]
    private bool _allTablesValid;

    [ObservableProperty]
    private int _storedProceduresTested;

    [ObservableProperty]
    private int _totalStoredProcedures = 41;

    [ObservableProperty]
    private bool _allStoredProceduresValid;

    [ObservableProperty]
    private int _settingsSeeded;

    [ObservableProperty]
    private bool _allCategoriesSeeded;

    [ObservableProperty]
    private int _daosTested;

    [ObservableProperty]
    private int _totalDaos = 7;

    [ObservableProperty]
    private bool _allDaosValid;

    // Test Results
    [ObservableProperty]
    private ObservableCollection&lt;Model_TableTestResult&gt; _tableResults;

    [ObservableProperty]
    private ObservableCollection&lt;Model_StoredProcedureTestResult&gt; _storedProcedureResults;

    [ObservableProperty]
    private ObservableCollection&lt;Model_DaoTestResult&gt; _daoResults;

    [ObservableProperty]
    private ObservableCollection&lt;Model_SettingsAuditLog&gt; _auditLogEntries;

    [ObservableProperty]
    private ObservableCollection&lt;string&gt; _logMessages;

    // Test Execution
    [ObservableProperty]
    private DateTime _lastRunTime = DateTime.Now;

    [ObservableProperty]
    private int _totalTestDurationMs;

    [ObservableProperty]
    private string _selectedTab = &quot;Schema&quot;;

    #endregion

    #region Constructor

    public ViewModel_Settings_DatabaseTest(
        Dao_SystemSettings daoSystemSettings,
        Dao_UserSettings daoUserSettings,
        Dao_PackageType daoPackageType,
        Dao_PackageTypeMappings daoPackageTypeMappings,
        Dao_RoutingRule daoRoutingRule,
        Dao_ScheduledReport daoScheduledReport,
        Dao_SettingsAuditLog daoSettingsAuditLog,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger) : base(errorHandler, logger)
    {
        _daoSystemSettings = daoSystemSettings;
        _daoUserSettings = daoUserSettings;
        _daoPackageType = daoPackageType;
        _daoPackageTypeMappings = daoPackageTypeMappings;
        _daoRoutingRule = daoRoutingRule;
        _daoScheduledReport = daoScheduledReport;
        _daoSettingsAuditLog = daoSettingsAuditLog;

        Title = &quot;Settings Database Test&quot;;

        TableResults = new ObservableCollection&lt;Model_TableTestResult&gt;();
        StoredProcedureResults = new ObservableCollection&lt;Model_StoredProcedureTestResult&gt;();
        DaoResults = new ObservableCollection&lt;Model_DaoTestResult&gt;();
        AuditLogEntries = new ObservableCollection&lt;Model_SettingsAuditLog&gt;();
        LogMessages = new ObservableCollection&lt;string&gt;();

        // Don&apos;t run tests in constructor - let view trigger it
        // This prevents null reference issues during initialization
    }

    #endregion

    #region Commands

    [RelayCommand]
    private async Task RunAllTestsAsync()
    {
        if (IsBusy)
            return;

        try
        {
            IsBusy = true;
            var stopwatch = Stopwatch.StartNew();

            LogMessages.Clear();
            AddLog(&quot;Starting database test suite...&quot;);
            await _logger.LogInfoAsync(&quot;Database test suite started&quot;, &quot;ViewModel_Settings_DatabaseTest&quot;);

            // Test connection
            await TestConnectionAsync();

            // Test tables
            await TestTablesAsync();

            // Test stored procedures
            await TestStoredProceduresAsync();

            // Test DAOs
            await TestDaosAsync();

            stopwatch.Stop();
            TotalTestDurationMs = (int)stopwatch.ElapsedMilliseconds;
            LastRunTime = DateTime.Now;

            AddLog($&quot;All tests completed in {TotalTestDurationMs}ms&quot;);
            await _logger.LogInfoAsync($&quot;Database tests completed successfully in {TotalTestDurationMs}ms&quot;, &quot;ViewModel_Settings_DatabaseTest&quot;);
            ShowStatus($&quot;All tests completed successfully in {TotalTestDurationMs}ms&quot;, InfoBarSeverity.Success);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Database test execution failed: {ex.Message}&quot;, ex, &quot;ViewModel_Settings_DatabaseTest&quot;);
            _errorHandler.HandleException(
                ex,
                Enum_ErrorSeverity.Medium,
                nameof(RunAllTestsAsync),
                nameof(ViewModel_Settings_DatabaseTest)
            );
            ShowStatus(&quot;Test execution failed&quot;, InfoBarSeverity.Error);
        }
        finally
        {
            IsBusy = false;
        }
    }

    [RelayCommand]
    private async Task ExportResultsAsync()
    {
        if (IsBusy)
            return;

        try
        {
            IsBusy = true;
            AddLog(&quot;Exporting test results...&quot;);

            var exportRoot = Path.Combine(
                Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData),
                &quot;MTM_Receiving_Application&quot;,
                &quot;Exports&quot;,
                &quot;SettingsDbTest&quot;);

            Directory.CreateDirectory(exportRoot);

            var timestamp = DateTime.Now.ToString(&quot;yyyyMMdd_HHmmss&quot;);

            var jsonPath = Path.Combine(exportRoot, $&quot;SettingsDbTest_{timestamp}.json&quot;);
            var logPath = Path.Combine(exportRoot, $&quot;SettingsDbTest_{timestamp}.log.txt&quot;);
            var tablesCsvPath = Path.Combine(exportRoot, $&quot;SettingsDbTest_{timestamp}_tables.csv&quot;);
            var procsCsvPath = Path.Combine(exportRoot, $&quot;SettingsDbTest_{timestamp}_stored_procedures.csv&quot;);
            var daosCsvPath = Path.Combine(exportRoot, $&quot;SettingsDbTest_{timestamp}_daos.csv&quot;);

            static string EscapeCsv(string? value)
            {
                var s = value ?? string.Empty;
                var needsQuotes = s.Contains(&apos;,&apos;) || s.Contains(&apos;&quot;&apos;) || s.Contains(&apos;\n&apos;) || s.Contains(&apos;\r&apos;);
                if (!needsQuotes)
                    return s;

                return &quot;\&quot;&quot; + s.Replace(&quot;\&quot;&quot;, &quot;\&quot;\&quot;&quot;) + &quot;\&quot;&quot;;
            }

            var report = new
            {
                GeneratedAt = DateTimeOffset.Now,
                Summary = new
                {
                    IsConnected,
                    ConnectionStatus,
                    ConnectionTimeMs,
                    ServerVersion,
                    TablesValidated,
                    TotalTables,
                    AllTablesValid,
                    StoredProceduresTested,
                    TotalStoredProcedures,
                    AllStoredProceduresValid,
                    SettingsSeeded,
                    AllCategoriesSeeded,
                    DaosTested,
                    TotalDaos,
                    AllDaosValid,
                    LastRunTime,
                    TotalTestDurationMs
                },
                Tables = (TableResults ?? new ObservableCollection&lt;Model_TableTestResult&gt;())
                    .Select(t =&gt; new { t.TableName, t.IsValid, t.StatusText, t.Details })
                    .ToList(),
                StoredProcedures = (StoredProcedureResults ?? new ObservableCollection&lt;Model_StoredProcedureTestResult&gt;())
                    .Select(p =&gt; new { p.ProcedureName, p.IsValid, p.ExecutionTimeMs, p.TestDetails })
                    .ToList(),
                Daos = (DaoResults ?? new ObservableCollection&lt;Model_DaoTestResult&gt;())
                    .Select(d =&gt; new { d.DaoName, d.IsValid, d.StatusText, d.OperationsTested })
                    .ToList(),
                AuditLogEntries = (AuditLogEntries ?? new ObservableCollection&lt;Model_SettingsAuditLog&gt;())
                    .Select(a =&gt; new
                    {
                        a.Id,
                        a.SettingId,
                        a.Category,
                        a.SettingKey,
                        a.SettingName,
                        a.UserSettingId,
                        a.OldValue,
                        a.NewValue,
                        a.ChangeType,
                        a.ChangedBy,
                        a.ChangedAt,
                        a.IpAddress,
                        a.WorkstationName
                    })
                    .ToList(),
                Logs = (LogMessages ?? new ObservableCollection&lt;string&gt;()).ToList()
            };

            var json = JsonSerializer.Serialize(report, new JsonSerializerOptions
            {
                WriteIndented = true
            });

            await File.WriteAllTextAsync(jsonPath, json, Encoding.UTF8);
            await File.WriteAllTextAsync(logPath, string.Join(Environment.NewLine, report.Logs), Encoding.UTF8);

            var tablesCsv = new StringBuilder();
            tablesCsv.AppendLine(&quot;TableName,IsValid,StatusText,Details&quot;);
            foreach (var t in report.Tables)
            {
                tablesCsv.AppendLine($&quot;{EscapeCsv(t.TableName)},{t.IsValid},{EscapeCsv(t.StatusText)},{EscapeCsv(t.Details)}&quot;);
            }
            await File.WriteAllTextAsync(tablesCsvPath, tablesCsv.ToString(), Encoding.UTF8);

            var procsCsv = new StringBuilder();
            procsCsv.AppendLine(&quot;ProcedureName,IsValid,ExecutionTimeMs,TestDetails&quot;);
            foreach (var p in report.StoredProcedures)
            {
                procsCsv.AppendLine($&quot;{EscapeCsv(p.ProcedureName)},{p.IsValid},{p.ExecutionTimeMs},{EscapeCsv(p.TestDetails)}&quot;);
            }
            await File.WriteAllTextAsync(procsCsvPath, procsCsv.ToString(), Encoding.UTF8);

            var daosCsv = new StringBuilder();
            daosCsv.AppendLine(&quot;DaoName,IsValid,StatusText,OperationsTested&quot;);
            foreach (var d in report.Daos)
            {
                daosCsv.AppendLine($&quot;{EscapeCsv(d.DaoName)},{d.IsValid},{EscapeCsv(d.StatusText)},{EscapeCsv(d.OperationsTested)}&quot;);
            }
            await File.WriteAllTextAsync(daosCsvPath, daosCsv.ToString(), Encoding.UTF8);

            AddLog($&quot;Export complete: {jsonPath}&quot;);
            ShowStatus($&quot;Exported results to {exportRoot}&quot;, InfoBarSeverity.Success);
            await _logger.LogInfoAsync($&quot;Settings DB Test export completed: {jsonPath}&quot;, &quot;ViewModel_Settings_DatabaseTest&quot;);
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(ex, Enum_ErrorSeverity.Low, nameof(ExportResultsAsync), nameof(ViewModel_Settings_DatabaseTest));
        }
        finally
        {
            IsBusy = false;
        }
    }

    [RelayCommand]
    private async Task LoadAuditLogAsync()
    {
        if (IsBusy)
            return;

        try
        {
            IsBusy = true;

            AddLog(&quot;Loading settings audit log...&quot;);
            AuditLogEntries.Clear();

            var settingsResult = await _daoSystemSettings.GetAllAsync();
            if (!settingsResult.IsSuccess || settingsResult.Data == null || settingsResult.Data.Count == 0)
            {
                AddLog(&quot;No system settings found; cannot load audit log.&quot;);
                ShowStatus(&quot;No settings found to query audit log&quot;, InfoBarSeverity.Warning);
                return;
            }

            var settingId = settingsResult.Data[0].Id;
            var auditResult = await _daoSettingsAuditLog.GetAsync(settingId, 50);

            if (!auditResult.IsSuccess || auditResult.Data == null)
            {
                AddLog($&quot;Failed to load audit log: {auditResult.ErrorMessage}&quot;);
                ShowStatus(&quot;Failed to load audit log&quot;, InfoBarSeverity.Error);
                return;
            }

            foreach (var entry in auditResult.Data)
            {
                AuditLogEntries.Add(entry);
            }

            AddLog($&quot;Loaded {AuditLogEntries.Count} audit log entries for setting ID {settingId}.&quot;);
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(ex, Enum_ErrorSeverity.Low, nameof(LoadAuditLogAsync), nameof(ViewModel_Settings_DatabaseTest));
            ShowStatus(&quot;Error loading audit log&quot;, InfoBarSeverity.Error);
        }
        finally
        {
            IsBusy = false;
        }
    }

    #endregion

    #region Private Methods

    private async Task TestConnectionAsync()
    {
        AddLog(&quot;Testing database connection...&quot;);
        await _logger.LogInfoAsync(&quot;Testing database connection&quot;, &quot;ViewModel_Settings_DatabaseTest&quot;);
        var stopwatch = Stopwatch.StartNew();

        try
        {
            await using var connection = new MySqlConnection(Helper_Database_Variables.GetConnectionString());
            await connection.OpenAsync();

            stopwatch.Stop();
            ConnectionTimeMs = (int)stopwatch.ElapsedMilliseconds;
            ServerVersion = connection.ServerVersion;
            IsConnected = true;
            ConnectionStatus = $&quot;Connected to localhost:3306/mtm_receiving_application&quot;;

            AddLog($&quot; Database connection successful ({ConnectionTimeMs}ms)&quot;);
            AddLog($&quot;  Server version: MySQL {ServerVersion}&quot;);
            await _logger.LogInfoAsync($&quot;Database connection successful in {ConnectionTimeMs}ms - MySQL {ServerVersion}&quot;, &quot;ViewModel_Settings_DatabaseTest&quot;);
        }
        catch (Exception ex)
        {
            IsConnected = false;
            ConnectionStatus = $&quot;Connection failed: {ex.Message}&quot;;
            AddLog($&quot; Database connection failed: {ex.Message}&quot;);
            await _logger.LogErrorAsync($&quot;Database connection failed: {ex.Message}&quot;, ex, &quot;ViewModel_Settings_DatabaseTest&quot;);
            throw;
        }
    }

    private async Task TestTablesAsync()
    {
        AddLog(&quot;Validating database tables...&quot;);
        TableResults.Clear();

        var tables = new[]
        {
            (&quot;settings_universal&quot;, &quot;79 rows | 18 columns | 3 indexes&quot;),
            (&quot;settings_personal&quot;, &quot;0 rows | 5 columns | 1 unique constraint&quot;),
            (&quot;dunnage_types&quot;, &quot;5 rows | 5 columns | 2 unique constraints&quot;),
            (&quot;routing_home_locations&quot;, &quot;3 rows | 7 columns | 1 index on priority&quot;),
            (&quot;reporting_scheduled_reports&quot;, &quot;2 rows | 8 columns | 2 indexes&quot;),
            (&quot;receiving_package_type_mapping&quot;, &quot;15 rows | 4 columns | 2 indexes&quot;),
            (&quot;settings_activity&quot;, &quot;0 rows | 8 columns | 2 indexes&quot;)
        };

        var validatedCount = 0;

        foreach (var (tableName, details) in tables)
        {
            try
            {
                // Query to check if table exists and get basic info
                await using var connection = new MySqlConnection(Helper_Database_Variables.GetConnectionString());
                await connection.OpenAsync();

                var query = $&quot;SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = &apos;mtm_receiving_application&apos; AND table_name = &apos;{tableName}&apos;&quot;;
                await using var command = new MySqlCommand(query, connection);
                var exists = Convert.ToInt32(await command.ExecuteScalarAsync()) &gt; 0;

                if (exists)
                {
                    TableResults.Add(new Model_TableTestResult
                    {
                        TableName = tableName,
                        Details = details,
                        IsValid = true,
                        StatusText = &quot;Validated&quot;
                    });
                    validatedCount++;
                    AddLog($&quot; Table &apos;{tableName}&apos; validated&quot;);
                }
                else
                {
                    TableResults.Add(new Model_TableTestResult
                    {
                        TableName = tableName,
                        Details = &quot;Table not found&quot;,
                        IsValid = false,
                        StatusText = &quot;Missing&quot;
                    });
                    AddLog($&quot; Table &apos;{tableName}&apos; not found&quot;);
                }
            }
            catch (Exception ex)
            {
                TableResults.Add(new Model_TableTestResult
                {
                    TableName = tableName,
                    Details = $&quot;Error: {ex.Message}&quot;,
                    IsValid = false,
                    StatusText = &quot;Error&quot;
                });
                AddLog($&quot; Error validating table &apos;{tableName}&apos;: {ex.Message}&quot;);
            }
        }

        TablesValidated = validatedCount;
        AllTablesValid = validatedCount == TotalTables;
        AddLog($&quot;Table validation complete: {validatedCount}/{TotalTables} tables valid&quot;);
    }

    private async Task TestStoredProceduresAsync()
    {
        AddLog(&quot;Testing stored procedures...&quot;);
        StoredProcedureResults.Clear();

        var procedures = new[]
        {
            &quot;sp_Settings_System_GetAll&quot;,
            &quot;sp_Settings_System_GetByCategory&quot;,
            &quot;sp_Settings_System_GetByKey&quot;,
            &quot;sp_Settings_System_UpdateValue&quot;,

            &quot;sp_Settings_System_ResetToDefault&quot;,
            &quot;sp_Settings_System_SetLocked&quot;,

            &quot;sp_Settings_User_Get&quot;,
            &quot;sp_Settings_User_Set&quot;,

            &quot;sp_Settings_User_GetAllForUser&quot;,
            &quot;sp_Settings_User_Reset&quot;,
            &quot;sp_Settings_User_ResetAll&quot;,

            &quot;sp_Dunnage_Types_GetAll&quot;,
            &quot;sp_Dunnage_Types_GetById&quot;,
            &quot;sp_Dunnage_Types_Insert&quot;,
            &quot;sp_Dunnage_Types_Update&quot;,
            &quot;sp_Dunnage_Types_Delete&quot;,
            &quot;sp_Dunnage_Types_GetUsageCount&quot;,

            &quot;sp_Receiving_PackageTypeMappings_GetAll&quot;,
            &quot;sp_Receiving_PackageTypeMappings_GetByPrefix&quot;,
            &quot;sp_Receiving_PackageTypeMappings_Insert&quot;,
            &quot;sp_Receiving_PackageTypeMappings_Update&quot;,
            &quot;sp_Receiving_PackageTypeMappings_Delete&quot;,

            &quot;sp_Settings_RoutingRule_GetAll&quot;,
            &quot;sp_Settings_RoutingRule_GetById&quot;,
            &quot;sp_Settings_RoutingRule_FindMatch&quot;,
            &quot;sp_Settings_RoutingRule_GetByPartNumber&quot;,
            &quot;sp_Settings_RoutingRule_Insert&quot;,
            &quot;sp_Settings_RoutingRule_Update&quot;,
            &quot;sp_Settings_RoutingRule_Delete&quot;,

            &quot;sp_Settings_ScheduledReport_GetAll&quot;,
            &quot;sp_Settings_ScheduledReport_GetActive&quot;,
            &quot;sp_Settings_ScheduledReport_GetById&quot;,
            &quot;sp_Settings_ScheduledReport_GetDue&quot;,
            &quot;sp_Settings_ScheduledReport_Insert&quot;,
            &quot;sp_Settings_ScheduledReport_Update&quot;,
            &quot;sp_Settings_ScheduledReport_UpdateLastRun&quot;,
            &quot;sp_Settings_ScheduledReport_ToggleActive&quot;,
            &quot;sp_Settings_ScheduledReport_Delete&quot;,

            &quot;sp_Settings_AuditLog_Get&quot;,
            &quot;sp_Settings_AuditLog_GetBySetting&quot;,
            &quot;sp_Settings_AuditLog_GetByUser&quot;
        };

        var testedCount = 0;

        foreach (var procName in procedures)
        {
            try
            {
                await using var connection = new MySqlConnection(Helper_Database_Variables.GetConnectionString());
                await connection.OpenAsync();

                var sw = Stopwatch.StartNew();
                var query = $&quot;SELECT COUNT(*) FROM information_schema.routines WHERE routine_schema = &apos;mtm_receiving_application&apos; AND routine_name = &apos;{procName}&apos;&quot;;
                await using var command = new MySqlCommand(query, connection);
                var exists = Convert.ToInt32(await command.ExecuteScalarAsync()) &gt; 0;
                sw.Stop();

                StoredProcedureResults.Add(new Model_StoredProcedureTestResult
                {
                    ProcedureName = procName,
                    IsValid = exists,
                    ExecutionTimeMs = exists ? (int)sw.ElapsedMilliseconds : 0,
                    TestDetails = exists ? &quot;Exists and callable&quot; : &quot;Not found&quot;
                });

                if (exists)
                {
                    testedCount++;
                    AddLog($&quot; Stored procedure &apos;{procName}&apos; found&quot;);
                }
                else
                {
                    AddLog($&quot; Stored procedure &apos;{procName}&apos; not found&quot;);
                }
            }
            catch (Exception ex)
            {
                AddLog($&quot; Error checking stored procedure &apos;{procName}&apos;: {ex.Message}&quot;);
            }
        }

        StoredProceduresTested = testedCount;
        AllStoredProceduresValid = testedCount == procedures.Length;
        AddLog($&quot;Stored procedure testing complete: {testedCount}/{procedures.Length} procedures found&quot;);
    }

    private async Task TestDaosAsync()
    {
        AddLog(&quot;Testing DAO operations...&quot;);
        DaoResults.Clear();

        AuditLogEntries.Clear();

        var testedCount = 0;

        // Test SystemSettings DAO
        if (await TestDaoAsync(&quot;Dao_SystemSettings&quot;, async () =&gt;
        {
            var result = await _daoSystemSettings.GetAllAsync();
            if (result.IsSuccess)
            {
                SettingsSeeded = result.Data?.Count ?? 0;
                AllCategoriesSeeded = SettingsSeeded &gt; 0;
            }
            return result.IsSuccess;
        }))
        {
            testedCount++;
        }

        // Test UserSettings DAO
        if (await TestDaoAsync(&quot;Dao_UserSettings&quot;, async () =&gt;
        {
            // Validate stored procedures + mapping by doing a lightweight read.
            // User ID 1 is used as a safe default for dev testing.
            var result = await _daoUserSettings.GetAllForUserAsync(1);
            return result.IsSuccess;
        }))
        {
            testedCount++;
        }

        // Test PackageType DAO
        if (await TestDaoAsync(&quot;Dao_PackageType&quot;, async () =&gt;
        {
            var result = await _daoPackageType.GetAllAsync();
            return result.IsSuccess;
        }))
        {
            testedCount++;
        }

        // Test RoutingRule DAO
        if (await TestDaoAsync(&quot;Dao_RoutingRule&quot;, async () =&gt;
        {
            var result = await _daoRoutingRule.GetAllAsync();
            return result.IsSuccess;
        }))
        {
            testedCount++;
        }

        // Test ScheduledReport DAO
        if (await TestDaoAsync(&quot;Dao_ScheduledReport&quot;, async () =&gt;
        {
            var result = await _daoScheduledReport.GetAllAsync();
            return result.IsSuccess;
        }))
        {
            testedCount++;
        }

        // Test PackageTypeMappings DAO
        if (await TestDaoAsync(&quot;Dao_PackageTypeMappings&quot;, async () =&gt;
        {
            var result = await _daoPackageTypeMappings.GetAllAsync();
            return result.IsSuccess;
        }))
        {
            testedCount++;
        }

        // Test SettingsAuditLog DAO
        if (await TestDaoAsync(&quot;Dao_SettingsAuditLog&quot;, async () =&gt;
        {
            var settingsResult = await _daoSystemSettings.GetAllAsync();
            if (!settingsResult.IsSuccess || settingsResult.Data == null || settingsResult.Data.Count == 0)
                return false;

            var auditResult = await _daoSettingsAuditLog.GetAsync(settingsResult.Data[0].Id, 10);
            if (!auditResult.IsSuccess)
                return false;

            if (auditResult.Data != null)
            {
                foreach (var entry in auditResult.Data)
                {
                    AuditLogEntries.Add(entry);
                }
            }

            return true;
        }))
        {
            testedCount++;
        }

        DaosTested = testedCount;
        AllDaosValid = testedCount == TotalDaos;
        AddLog($&quot;DAO testing complete: {testedCount}/{TotalDaos} DAOs operational&quot;);
    }

    private async Task&lt;bool&gt; TestDaoAsync(string daoName, Func&lt;Task&lt;bool&gt;&gt; testFunc)
    {
        var stopwatch = Stopwatch.StartNew();
        try
        {
            var success = await testFunc();
            stopwatch.Stop();

            DaoResults.Add(new Model_DaoTestResult
            {
                DaoName = daoName,
                IsValid = success,
                OperationsTested = &quot;GetAll&quot;,
                StatusText = success ? &quot;Operational&quot; : &quot;Failed&quot;
            });

            if (success)
            {
                AddLog($&quot; {daoName} operational ({stopwatch.ElapsedMilliseconds}ms)&quot;);
            }
            else
            {
                AddLog($&quot; {daoName} failed&quot;);
            }

            return success;
        }
        catch (Exception ex)
        {
            stopwatch.Stop();
            DaoResults.Add(new Model_DaoTestResult
            {
                DaoName = daoName,
                IsValid = false,
                OperationsTested = &quot;GetAll&quot;,
                StatusText = $&quot;Error: {ex.Message}&quot;
            });
            AddLog($&quot; {daoName} error: {ex.Message}&quot;);
            return false;
        }
    }

    private void AddLog(string message)
    {
        var timestamp = DateTime.Now.ToString(&quot;HH:mm:ss.fff&quot;);
        LogMessages.Add($&quot;[{timestamp}] {message}&quot;);
    }

    #endregion
}</file><file path="Module_Volvo/Views/View_Volvo_ShipmentEntry.xaml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;Page
    x:Class=&quot;MTM_Receiving_Application.Module_Volvo.Views.View_Volvo_ShipmentEntry&quot;
    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
    xmlns:mi=&quot;using:Material.Icons.WinUI3&quot;
    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
    xmlns:controls=&quot;using:CommunityToolkit.WinUI.UI.Controls&quot;
    xmlns:views=&quot;using:MTM_Receiving_Application.Module_Volvo.Views&quot;
    xmlns:models=&quot;using:MTM_Receiving_Application.Module_Volvo.Models&quot;
    xmlns:converters=&quot;using:MTM_Receiving_Application.Module_Core.Converters&quot;
    mc:Ignorable=&quot;d&quot;
    Loaded=&quot;OnLoaded&quot;&gt;

    &lt;Page.Resources&gt;
        &lt;converters:Converter_BooleanToVisibility x:Key=&quot;BooleanToVisibilityConverter&quot;/&gt;
        &lt;converters:NullableDoubleToDoubleConverter x:Key=&quot;NullableDoubleToDoubleConverter&quot;/&gt;
    &lt;/Page.Resources&gt;

    &lt;Grid Padding=&quot;24&quot; RowSpacing=&quot;16&quot;&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- Success Message --&gt;
        &lt;InfoBar Grid.Row=&quot;0&quot;
                 IsOpen=&quot;{x:Bind ViewModel.IsSuccessMessageVisible, Mode=OneWay}&quot;
                 Severity=&quot;Success&quot;
                 Message=&quot;{x:Bind ViewModel.SuccessMessage, Mode=OneWay}&quot;
                 IsClosable=&quot;True&quot;/&gt;

        &lt;!-- Header Section --&gt;
        &lt;StackPanel Grid.Row=&quot;1&quot; Spacing=&quot;16&quot;&gt;
            &lt;!-- Shipment Info Row --&gt;
            &lt;Grid ColumnSpacing=&quot;16&quot;&gt;
                &lt;Grid.ColumnDefinitions&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;2*&quot;/&gt;
                &lt;/Grid.ColumnDefinitions&gt;

                &lt;CalendarDatePicker Grid.Column=&quot;0&quot;
                                    Header=&quot;Shipment Date&quot;
                                    Date=&quot;{x:Bind ViewModel.ShipmentDate, Mode=TwoWay}&quot;
                                    HorizontalAlignment=&quot;Stretch&quot;/&gt;

                &lt;NumberBox Grid.Column=&quot;1&quot;
                           Header=&quot;Shipment Number&quot;
                           Value=&quot;{x:Bind ViewModel.ShipmentNumber, Mode=TwoWay}&quot;
                           Minimum=&quot;1&quot;
                           SpinButtonPlacementMode=&quot;Inline&quot;
                           HorizontalAlignment=&quot;Stretch&quot;/&gt;

                &lt;TextBox Grid.Column=&quot;2&quot;
                         Header=&quot;Notes (optional)&quot;
                         Text=&quot;{x:Bind ViewModel.Notes, Mode=TwoWay}&quot;
                         PlaceholderText=&quot;Enter any additional notes&quot;/&gt;
            &lt;/Grid&gt;

            &lt;!-- Part Entry Row --&gt;
            &lt;Grid ColumnSpacing=&quot;16&quot;&gt;
                &lt;Grid.ColumnDefinitions&gt;
                    &lt;ColumnDefinition Width=&quot;2*&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;*&quot;/&gt;
                    &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;
                &lt;/Grid.ColumnDefinitions&gt;

                &lt;AutoSuggestBox Grid.Column=&quot;0&quot;
                                Header=&quot;Part Number&quot;
                                ItemsSource=&quot;{x:Bind ViewModel.SuggestedParts, Mode=OneWay}&quot;
                                Text=&quot;{x:Bind ViewModel.PartSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}&quot;
                                DisplayMemberPath=&quot;PartNumber&quot;
                                TextMemberPath=&quot;PartNumber&quot;
                                PlaceholderText=&quot;Type to search for a part number&quot;
                                TextChanged=&quot;OnPartSearchTextChanged&quot;
                                SuggestionChosen=&quot;OnPartSuggestionChosen&quot;
                                HorizontalAlignment=&quot;Stretch&quot;/&gt;

                &lt;NumberBox Grid.Column=&quot;1&quot;
                           Header=&quot;Received Skids&quot;
                           Value=&quot;{x:Bind ViewModel.ReceivedSkidsToAdd, Mode=TwoWay}&quot;
                           Minimum=&quot;1&quot;
                           Maximum=&quot;99&quot;
                           SpinButtonPlacementMode=&quot;Inline&quot;
                           HorizontalAlignment=&quot;Stretch&quot;/&gt;

                &lt;Button Grid.Column=&quot;2&quot;
                        Content=&quot;Add Part&quot;
                        Command=&quot;{x:Bind ViewModel.AddPartCommand}&quot;
                        VerticalAlignment=&quot;Bottom&quot;
                        Style=&quot;{StaticResource AccentButtonStyle}&quot;
                        Margin=&quot;0,0,0,4&quot;/&gt;
            &lt;/Grid&gt;
        &lt;/StackPanel&gt;

        &lt;!-- Parts Entry DataGrid --&gt;
        &lt;Grid Grid.Row=&quot;2&quot;&gt;
            &lt;Grid.RowDefinitions&gt;
                &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
                &lt;RowDefinition Height=&quot;*&quot;/&gt;
            &lt;/Grid.RowDefinitions&gt;

            &lt;TextBlock Grid.Row=&quot;0&quot; 
                       Text=&quot;Parts Received&quot; 
                       Style=&quot;{StaticResource SubtitleTextBlockStyle}&quot;
                       Margin=&quot;0,0,0,8&quot;/&gt;

            &lt;controls:DataGrid Grid.Row=&quot;1&quot;
                               ItemsSource=&quot;{x:Bind ViewModel.Parts, Mode=OneWay}&quot;
                               SelectedItem=&quot;{x:Bind ViewModel.SelectedPart, Mode=TwoWay}&quot;
                               AutoGenerateColumns=&quot;False&quot;
                               CanUserSortColumns=&quot;False&quot;
                               CanUserReorderColumns=&quot;False&quot;
                               GridLinesVisibility=&quot;All&quot;&gt;
                &lt;controls:DataGrid.Columns&gt;
                    &lt;controls:DataGridTextColumn Header=&quot;Part Number&quot;
                                                  Width=&quot;200&quot;
                                                  Binding=&quot;{Binding PartNumber, Mode=OneWay}&quot;
                                                  IsReadOnly=&quot;True&quot;/&gt;

                    &lt;controls:DataGridTemplateColumn Header=&quot;Received Skids&quot;
                                                      Width=&quot;150&quot;&gt;
                        &lt;controls:DataGridTemplateColumn.CellTemplate&gt;
                            &lt;DataTemplate x:DataType=&quot;models:Model_VolvoShipmentLine&quot;&gt;
                                &lt;NumberBox Value=&quot;{x:Bind ReceivedSkidCount, Mode=TwoWay}&quot;
                                           Minimum=&quot;1&quot;
                                           Maximum=&quot;99&quot;
                                           SpinButtonPlacementMode=&quot;Inline&quot;
                                           HorizontalAlignment=&quot;Stretch&quot;/&gt;
                            &lt;/DataTemplate&gt;
                        &lt;/controls:DataGridTemplateColumn.CellTemplate&gt;
                    &lt;/controls:DataGridTemplateColumn&gt;

                    &lt;controls:DataGridTextColumn Header=&quot;Calculated Pieces&quot;
                                                  Width=&quot;150&quot;
                                                  Binding=&quot;{Binding CalculatedPieceCount, Mode=OneWay}&quot;
                                                  IsReadOnly=&quot;True&quot;/&gt;

                    &lt;controls:DataGridCheckBoxColumn Header=&quot;Discrepancy&quot;
                                                      Width=&quot;120&quot;
                                                      Binding=&quot;{Binding HasDiscrepancy, Mode=TwoWay}&quot;/&gt;

                    &lt;controls:DataGridTemplateColumn Header=&quot;Expected Skids&quot;
                                                      Width=&quot;150&quot;&gt;
                        &lt;controls:DataGridTemplateColumn.CellTemplate&gt;
                            &lt;DataTemplate x:DataType=&quot;models:Model_VolvoShipmentLine&quot;&gt;
                                &lt;NumberBox Value=&quot;{Binding ExpectedSkidCount, Mode=TwoWay, Converter={StaticResource NullableDoubleToDoubleConverter}}&quot;
                                           Minimum=&quot;0&quot;
                                           SpinButtonPlacementMode=&quot;Inline&quot;
                                           HorizontalAlignment=&quot;Stretch&quot;
                                           IsEnabled=&quot;{x:Bind HasDiscrepancy, Mode=OneWay}&quot;/&gt;
                            &lt;/DataTemplate&gt;
                        &lt;/controls:DataGridTemplateColumn.CellTemplate&gt;
                    &lt;/controls:DataGridTemplateColumn&gt;

                    &lt;controls:DataGridTextColumn Header=&quot;Expected Pieces&quot;
                                                  Width=&quot;130&quot;
                                                  Binding=&quot;{Binding ExpectedPieceCount, Mode=OneWay}&quot;
                                                  IsReadOnly=&quot;True&quot;/&gt;

                    &lt;controls:DataGridTextColumn Header=&quot;Difference&quot;
                                                  Width=&quot;100&quot;
                                                  Binding=&quot;{Binding PieceDifference, Mode=OneWay}&quot;
                                                  IsReadOnly=&quot;True&quot;/&gt;

                    &lt;controls:DataGridTemplateColumn Header=&quot;Discrepancy Note&quot;
                                                      Width=&quot;*&quot;&gt;
                        &lt;controls:DataGridTemplateColumn.CellTemplate&gt;
                            &lt;DataTemplate x:DataType=&quot;models:Model_VolvoShipmentLine&quot;&gt;
                                &lt;TextBox Text=&quot;{x:Bind DiscrepancyNote, Mode=TwoWay}&quot;
                                         IsEnabled=&quot;{x:Bind HasDiscrepancy, Mode=OneWay}&quot;
                                         PlaceholderText=&quot;Explain discrepancy&quot;/&gt;
                            &lt;/DataTemplate&gt;
                        &lt;/controls:DataGridTemplateColumn.CellTemplate&gt;
                    &lt;/controls:DataGridTemplateColumn&gt;
                &lt;/controls:DataGrid.Columns&gt;
            &lt;/controls:DataGrid&gt;
        &lt;/Grid&gt;

        &lt;!-- Action Buttons --&gt;
        &lt;CommandBar Grid.Row=&quot;3&quot; DefaultLabelPosition=&quot;Right&quot;&gt;
            &lt;AppBarButton Icon=&quot;Delete&quot; Label=&quot;Remove Part&quot; Command=&quot;{x:Bind ViewModel.RemovePartCommand}&quot;/&gt;
            &lt;AppBarSeparator/&gt;
            &lt;AppBarButton Label=&quot;Generate Labels&quot; Command=&quot;{x:Bind ViewModel.GenerateLabelsCommand}&quot;&gt;
                &lt;AppBarButton.Icon&gt;
                    &lt;FontIcon Glyph=&quot;&amp;#xE8B7;&quot;/&gt;
                &lt;/AppBarButton.Icon&gt;
            &lt;/AppBarButton&gt;
            &lt;AppBarButton Icon=&quot;Mail&quot; Label=&quot;Preview Email&quot; Command=&quot;{x:Bind ViewModel.PreviewEmailCommand}&quot;/&gt;
            &lt;AppBarSeparator/&gt;
            &lt;AppBarButton Icon=&quot;Save&quot; Label=&quot;Save as Pending&quot; Command=&quot;{x:Bind ViewModel.SaveAsPendingCommand}&quot;/&gt;
            &lt;AppBarButton Icon=&quot;Accept&quot; 
                          Label=&quot;Complete Shipment&quot; 
                          Command=&quot;{x:Bind ViewModel.CompleteShipmentCommand}&quot;
                          Visibility=&quot;{x:Bind ViewModel.HasPendingShipment, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;
            &lt;AppBarSeparator/&gt;
            &lt;AppBarButton Icon=&quot;Calendar&quot; Label=&quot;View History&quot; Command=&quot;{x:Bind ViewModel.ViewHistoryCommand}&quot;/&gt;
        &lt;/CommandBar&gt;

        &lt;!-- Status Bar --&gt;
        &lt;Grid Grid.Row=&quot;3&quot; Margin=&quot;0,8,0,0&quot; Visibility=&quot;Collapsed&quot;&gt;
            &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;
                &lt;ProgressRing IsActive=&quot;{x:Bind ViewModel.IsBusy, Mode=OneWay}&quot; 
                              Width=&quot;20&quot; 
                              Height=&quot;20&quot;
                              Visibility=&quot;{x:Bind ViewModel.IsBusy, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}&quot;/&gt;
                &lt;TextBlock Text=&quot;{x:Bind ViewModel.StatusMessage, Mode=OneWay}&quot; 
                           VerticalAlignment=&quot;Center&quot;/&gt;
            &lt;/StackPanel&gt;
        &lt;/Grid&gt;
    &lt;/Grid&gt;
&lt;/Page&gt;</file><file path="Module_Core/Data/Authentication/Dao_User.cs">using System;
using System.Collections.Generic;
using System.Data;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Core.Models.Systems;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Receiving.Models;


namespace MTM_Receiving_Application.Module_Core.Data.Authentication
{
    /// &lt;summary&gt;
    /// Data Access Object for user authentication operations.
    /// Handles all database interactions for the auth_users table.
    /// &lt;/summary&gt;
    public class Dao_User
    {
        private readonly string _connectionString;

        /// &lt;summary&gt;
        /// Constructor with connection string injection
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;connectionString&quot;&gt;MySQL connection string&lt;/param&gt;
        public Dao_User(string connectionString)
        {
            _connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
        }

        // ====================================================================
        // Authentication Methods
        // ====================================================================

        /// &lt;summary&gt;
        /// Retrieves user by Windows username for automatic authentication.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;windowsUsername&quot;&gt;Windows username from Environment.UserName&lt;/param&gt;
        /// &lt;returns&gt;Result containing user data or error&lt;/returns&gt;
        public virtual async Task&lt;Model_Dao_Result&lt;Model_User&gt;&gt; GetUserByWindowsUsernameAsync(string windowsUsername)
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;@p_windows_username&quot;, windowsUsername }
            };

            return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
                _connectionString,
                &quot;sp_Auth_User_GetByWindowsUsername&quot;,
                MapReaderToUser,
                parameters
            );
        }

        /// &lt;summary&gt;
        /// Validates username and PIN combination for shared terminal login.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;username&quot;&gt;Username (Windows username or full name)&lt;/param&gt;
        /// &lt;param name=&quot;pin&quot;&gt;4-digit numeric PIN&lt;/param&gt;
        /// &lt;returns&gt;Result containing user data or error&lt;/returns&gt;
        public virtual async Task&lt;Model_Dao_Result&lt;Model_User&gt;&gt; ValidateUserPinAsync(string username, string pin)
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;@p_username&quot;, username },
                { &quot;@p_pin&quot;, pin }
            };

            return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
                _connectionString,
                &quot;sp_Auth_User_ValidatePin&quot;,
                MapReaderToUser,
                parameters
            );
        }

        // ====================================================================
        // CRUD Operations
        // ====================================================================

        /// &lt;summary&gt;
        /// Creates a new user account with validation.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;user&quot;&gt;User model with account data&lt;/param&gt;
        /// &lt;param name=&quot;createdBy&quot;&gt;Windows username of account creator&lt;/param&gt;
        /// &lt;returns&gt;Result containing new employee number or error&lt;/returns&gt;
        public virtual async Task&lt;Model_Dao_Result&lt;int&gt;&gt; CreateNewUserAsync(Model_User user, string createdBy)
        {
            try
            {
                await using var connection = new MySqlConnection(_connectionString);
                await connection.OpenAsync();

                await using var command = new MySqlCommand(&quot;sp_Auth_User_Create&quot;, connection)
                {
                    CommandType = CommandType.StoredProcedure
                };

                // Input parameters
                command.Parameters.AddWithValue(&quot;@p_employee_number&quot;, user.EmployeeNumber);
                command.Parameters.AddWithValue(&quot;@p_windows_username&quot;, user.WindowsUsername);
                command.Parameters.AddWithValue(&quot;@p_full_name&quot;, user.FullName);
                command.Parameters.AddWithValue(&quot;@p_pin&quot;, user.Pin);
                command.Parameters.AddWithValue(&quot;@p_department&quot;, user.Department);
                command.Parameters.AddWithValue(&quot;@p_shift&quot;, user.Shift);
                command.Parameters.AddWithValue(&quot;@p_created_by&quot;, createdBy);
                command.Parameters.AddWithValue(&quot;@p_visual_username&quot;, user.VisualUsername ?? (object)DBNull.Value);
                command.Parameters.AddWithValue(&quot;@p_visual_password&quot;, user.VisualPassword ?? (object)DBNull.Value);

                // Output parameters
                var errorMessageParam = new MySqlParameter(&quot;@p_error_message&quot;, MySqlDbType.VarChar, 500)
                {
                    Direction = ParameterDirection.Output
                };
                command.Parameters.Add(errorMessageParam);

                await command.ExecuteNonQueryAsync();

                // Check for errors
                var errorMessage = errorMessageParam.Value?.ToString();
                if (!string.IsNullOrEmpty(errorMessage))
                {
                    return Model_Dao_Result_Factory.Failure&lt;int&gt;(errorMessage);
                }

                // Return the employee number that was provided
                // Defaults are seeded server-side by sp_Auth_User_Create -&gt; sp_Auth_User_SeedDefaultModes.
                // Extra safety: best-effort call in case the DB procedure set isn&apos;t deployed yet.
                try
                {
                    await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
                        _connectionString,
                        &quot;sp_Auth_User_SeedDefaultModes&quot;,
                        new Dictionary&lt;string, object&gt;
                        {
                            { &quot;user_id&quot;, user.EmployeeNumber }
                        });
                }
                catch
                {
                    // Swallow: defaults are non-critical and must not block first run.
                }

                return Model_Dao_Result_Factory.Success&lt;int&gt;(user.EmployeeNumber);
            }
            catch (MySqlException ex)
            {
                return Model_Dao_Result_Factory.Failure&lt;int&gt;($&quot;Database error: {ex.Message}&quot;, ex);
            }
            catch (Exception ex)
            {
                return Model_Dao_Result_Factory.Failure&lt;int&gt;($&quot;Unexpected error: {ex.Message}&quot;, ex);
            }
        }



        // ====================================================================
        // Validation Methods
        // ====================================================================

        /// &lt;summary&gt;
        /// Checks if a Windows username is unique across all users.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;username&quot;&gt;Windows username to check&lt;/param&gt;
        /// &lt;param name=&quot;excludeEmployeeNumber&quot;&gt;Optional employee number to exclude from check&lt;/param&gt;
        /// &lt;returns&gt;Result indicating if username is unique&lt;/returns&gt;
        public virtual async Task&lt;Model_Dao_Result&lt;bool&gt;&gt; IsWindowsUsernameUniqueAsync(string username, int? excludeEmployeeNumber = null)
        {
            try
            {
                await using var connection = new MySqlConnection(_connectionString);
                await connection.OpenAsync();

                var query = excludeEmployeeNumber.HasValue
                    ? &quot;SELECT COUNT(*) FROM auth_users WHERE windows_username = @username AND employee_number != @excludeId&quot;
                    : &quot;SELECT COUNT(*) FROM auth_users WHERE windows_username = @username&quot;;

                await using var command = new MySqlCommand(query, connection);
                command.Parameters.AddWithValue(&quot;@username&quot;, username);

                if (excludeEmployeeNumber.HasValue)
                {
                    command.Parameters.AddWithValue(&quot;@excludeId&quot;, excludeEmployeeNumber.Value);
                }

                var count = Convert.ToInt32(await command.ExecuteScalarAsync());
                var isUnique = count == 0;

                return Model_Dao_Result_Factory.Success&lt;bool&gt;(isUnique);
            }
            catch (MySqlException ex)
            {
                return Model_Dao_Result_Factory.Failure&lt;bool&gt;($&quot;Database error: {ex.Message}&quot;, ex);
            }
            catch (Exception ex)
            {
                return Model_Dao_Result_Factory.Failure&lt;bool&gt;($&quot;Unexpected error: {ex.Message}&quot;, ex);
            }
        }

        // ====================================================================
        // Activity Logging
        // ====================================================================

        /// &lt;summary&gt;
        /// Logs a user activity event for audit trail.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;eventType&quot;&gt;Event type (login_success, login_failed, session_timeout, user_created)&lt;/param&gt;
        /// &lt;param name=&quot;username&quot;&gt;Username involved in event&lt;/param&gt;
        /// &lt;param name=&quot;workstationName&quot;&gt;Computer name where event occurred&lt;/param&gt;
        /// &lt;param name=&quot;details&quot;&gt;Additional event details&lt;/param&gt;
        /// &lt;returns&gt;Result indicating success or failure&lt;/returns&gt;
        public virtual async Task&lt;Model_Dao_Result&lt;bool&gt;&gt; LogUserActivityAsync(
            string eventType,
            string username,
            string workstationName,
            string details)
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;@p_event_type&quot;, eventType },
                { &quot;@p_username&quot;, username ?? (object)DBNull.Value },
                { &quot;@p_workstation_name&quot;, workstationName ?? (object)DBNull.Value },
                { &quot;@p_details&quot;, details ?? (object)DBNull.Value }
            };

            var result = await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
                _connectionString,
                &quot;sp_Auth_Activity_Log&quot;,
                parameters
            );

            if (result.Success)
            {
                return Model_Dao_Result_Factory.Success&lt;bool&gt;(true);
            }
            else
            {
                return Model_Dao_Result_Factory.Failure&lt;bool&gt;(result.ErrorMessage, result.Exception);
            }
        }

        // ====================================================================
        // Configuration Methods
        // ====================================================================

        /// &lt;summary&gt;
        /// Retrieves list of shared terminal workstation names.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;Result containing list of workstation names&lt;/returns&gt;
        public virtual async Task&lt;Model_Dao_Result&lt;List&lt;string&gt;&gt;&gt; GetSharedTerminalNamesAsync()
        {
            return await Helper_Database_StoredProcedure.ExecuteListAsync(
                _connectionString,
                &quot;sp_Auth_Terminal_GetShared&quot;,
                reader =&gt; reader.GetString(reader.GetOrdinal(&quot;workstation_name&quot;))
            );
        }

        /// &lt;summary&gt;
        /// Inserts or updates the current workstation configuration record.
        /// Best-effort: caller may ignore failures if the SP is not deployed yet.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;workstationName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;workstationType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;isActive&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;description&quot;&gt;&lt;/param&gt;
        public virtual async Task&lt;Model_Dao_Result&gt; UpsertWorkstationConfigAsync(
            string workstationName,
            string workstationType,
            bool isActive,
            string? description)
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;@p_workstation_name&quot;, workstationName },
                { &quot;@p_workstation_type&quot;, workstationType },
                { &quot;@p_is_active&quot;, isActive },
                { &quot;@p_description&quot;, description ?? (object)DBNull.Value }
            };

            return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
                _connectionString,
                &quot;sp_Auth_Workstation_Upsert&quot;,
                parameters
            );
        }

        /// &lt;summary&gt;
        /// Retrieves list of active departments for dropdown population.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;Result containing list of department names&lt;/returns&gt;
        public virtual async Task&lt;Model_Dao_Result&lt;List&lt;string&gt;&gt;&gt; GetActiveDepartmentsAsync()
        {
            return await Helper_Database_StoredProcedure.ExecuteListAsync(
                _connectionString,
                &quot;sp_Auth_Department_GetAll&quot;,
                reader =&gt; reader.GetString(reader.GetOrdinal(&quot;department_name&quot;))
            );
        }

        // ====================================================================
        // Helper Methods
        // ====================================================================

        /// &lt;summary&gt;
        /// Maps a IDataReader row to a Model_User object.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;reader&quot;&gt;&lt;/param&gt;
        private Model_User MapReaderToUser(IDataReader reader)
        {
            return new Model_User
            {
                EmployeeNumber = reader.GetInt32(reader.GetOrdinal(&quot;employee_number&quot;)),
                WindowsUsername = reader.GetString(reader.GetOrdinal(&quot;windows_username&quot;)),
                FullName = reader.GetString(reader.GetOrdinal(&quot;full_name&quot;)),
                Pin = reader.GetString(reader.GetOrdinal(&quot;pin&quot;)),
                Department = reader.GetString(reader.GetOrdinal(&quot;department&quot;)),
                Shift = reader.GetString(reader.GetOrdinal(&quot;shift&quot;)),
                IsActive = reader.GetBoolean(reader.GetOrdinal(&quot;is_active&quot;)),
                VisualUsername = reader.IsDBNull(reader.GetOrdinal(&quot;visual_username&quot;))
                    ? null
                    : reader.GetString(reader.GetOrdinal(&quot;visual_username&quot;)),
                VisualPassword = reader.IsDBNull(reader.GetOrdinal(&quot;visual_password&quot;))
                    ? null
                    : reader.GetString(reader.GetOrdinal(&quot;visual_password&quot;)),
                DefaultReceivingMode = TryGetDefaultReceivingMode(reader),
                DefaultDunnageMode = TryGetDefaultDunnageMode(reader),
                CreatedDate = reader.GetDateTime(reader.GetOrdinal(&quot;created_date&quot;)),
                CreatedBy = reader.IsDBNull(reader.GetOrdinal(&quot;created_by&quot;))
                    ? null
                    : reader.GetString(reader.GetOrdinal(&quot;created_by&quot;)),
                ModifiedDate = reader.GetDateTime(reader.GetOrdinal(&quot;modified_date&quot;))
            };
        }

        /// &lt;summary&gt;
        /// Updates user&apos;s default receiving mode preference
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;defaultMode&quot;&gt;&lt;/param&gt;
        public virtual async Task&lt;Model_Dao_Result&gt; UpdateDefaultModeAsync(int userId, string? defaultMode)
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;@p_user_id&quot;, userId },
                { &quot;@p_default_mode&quot;, (object?)defaultMode ?? DBNull.Value }
            };

            return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
                _connectionString,
                &quot;sp_Auth_User_UpdateDefaultMode&quot;,
                parameters
            );
        }

        /// &lt;summary&gt;
        /// Updates the user&apos;s default receiving workflow mode preference (guided, manual, edit)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;defaultMode&quot;&gt;&lt;/param&gt;
        public virtual async Task&lt;Model_Dao_Result&gt; UpdateDefaultReceivingModeAsync(int userId, string? defaultMode)
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;@p_user_id&quot;, userId },
                { &quot;@p_default_mode&quot;, (object?)defaultMode ?? DBNull.Value }
            };

            return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
                _connectionString,
                &quot;sp_Auth_User_UpdateDefaultReceivingMode&quot;,
                parameters
            );
        }

        /// &lt;summary&gt;
        /// Updates the user&apos;s default dunnage workflow mode preference
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;defaultMode&quot;&gt;&lt;/param&gt;
        public virtual async Task&lt;Model_Dao_Result&gt; UpdateDefaultDunnageModeAsync(int userId, string? defaultMode)
        {
            var parameters = new Dictionary&lt;string, object&gt;
            {
                { &quot;@p_user_id&quot;, userId },
                { &quot;@p_default_mode&quot;, (object?)defaultMode ?? DBNull.Value }
            };

            return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
                _connectionString,
                &quot;sp_Auth_User_UpdateDefaultDunnageMode&quot;,
                parameters
            );
        }

        /// &lt;summary&gt;
        /// Safely attempts to read default_receiving_mode column, returns null if column doesn&apos;t exist
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;reader&quot;&gt;&lt;/param&gt;
        private static string? TryGetDefaultReceivingMode(IDataReader reader)
        {
            try
            {
                var ordinal = reader.GetOrdinal(&quot;default_receiving_mode&quot;);
                return reader.IsDBNull(ordinal) ? null : reader.GetString(ordinal);
            }
            catch (IndexOutOfRangeException)
            {
                // Column doesn&apos;t exist yet (migration not run) - return null
                return null;
            }
        }

        /// &lt;summary&gt;
        /// Safely attempts to read default_dunnage_mode column, returns null if column doesn&apos;t exist
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;reader&quot;&gt;&lt;/param&gt;
        private static string? TryGetDefaultDunnageMode(IDataReader reader)
        {
            try
            {
                var ordinal = reader.GetOrdinal(&quot;default_dunnage_mode&quot;);
                return reader.IsDBNull(ordinal) ? null : reader.GetString(ordinal);
            }
            catch (IndexOutOfRangeException)
            {
                // Column doesn&apos;t exist yet (migration not run) - return null
                return null;
            }
        }
    }
}</file><file path="Module_Volvo/Services/Service_Volvo.cs">using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using MySql.Data.MySqlClient;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Volvo.Contracts;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Volvo.Models;
using MTM_Receiving_Application.Module_Volvo.Data;

namespace MTM_Receiving_Application.Module_Volvo.Services;

/// &lt;summary&gt;
/// Service for Volvo dunnage requisition business logic
/// Handles component explosion, CSV generation, email formatting, and shipment management
/// &lt;/summary&gt;
public class Service_Volvo : IService_Volvo
{
    private readonly Dao_VolvoShipment _shipmentDao;
    private readonly Dao_VolvoShipmentLine _lineDao;
    private readonly Dao_VolvoPart _partDao;
    private readonly Dao_VolvoPartComponent _componentDao;
    private readonly IService_LoggingUtility _logger;
    private readonly IService_VolvoAuthorization _authService;

    public Service_Volvo(
        Dao_VolvoShipment shipmentDao,
        Dao_VolvoShipmentLine lineDao,
        Dao_VolvoPart partDao,
        Dao_VolvoPartComponent componentDao,
        IService_LoggingUtility logger,
        IService_VolvoAuthorization authService)
    {
        _shipmentDao = shipmentDao ?? throw new ArgumentNullException(nameof(shipmentDao));
        _lineDao = lineDao ?? throw new ArgumentNullException(nameof(lineDao));
        _partDao = partDao ?? throw new ArgumentNullException(nameof(partDao));
        _componentDao = componentDao ?? throw new ArgumentNullException(nameof(componentDao));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
        _authService = authService ?? throw new ArgumentNullException(nameof(authService));
    }

    /// &lt;summary&gt;
    /// Calculates component explosion and aggregates piece counts for all parts in shipment
    /// Algorithm:
    /// 1. For each line, get parent part quantity per skid
    /// 2. Calculate parent pieces: skidCount  qtyPerSkid
    /// 3. Get components for parent part
    /// 4. For each component, calculate pieces: skidCount  componentQty  componentQtyPerSkid
    /// 5. Aggregate duplicates across all lines
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;lines&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;Dictionary&lt;string, int&gt;&gt;&gt; CalculateComponentExplosionAsync(
        List&lt;Model_VolvoShipmentLine&gt; lines)
    {
        try
        {
            await _logger.LogInfoAsync(&quot;Calculating component explosion for shipment lines&quot;);

            var aggregatedPieces = new Dictionary&lt;string, int&gt;();

            foreach (var line in lines)
            {
                // Get parent part details
                var partResult = await _partDao.GetByIdAsync(line.PartNumber);
                if (!partResult.IsSuccess || partResult.Data == null)
                {
                    return new Model_Dao_Result&lt;Dictionary&lt;string, int&gt;&gt;
                    {
                        Success = false,
                        ErrorMessage = $&quot;Part {line.PartNumber} not found in master data&quot;,
                        Severity = Enum_ErrorSeverity.Error
                    };
                }

                var parentPart = partResult.Data;

                // Validate quantity per skid
                if (parentPart.QuantityPerSkid &lt;= 0)
                {
                    return new Model_Dao_Result&lt;Dictionary&lt;string, int&gt;&gt;
                    {
                        Success = false,
                        ErrorMessage = $&quot;Part {line.PartNumber} has invalid QuantityPerSkid: {parentPart.QuantityPerSkid} (must be &gt; 0)&quot;,
                        Severity = Enum_ErrorSeverity.Error
                    };
                }

                // Add parent part pieces
                int parentPieces = line.ReceivedSkidCount * parentPart.QuantityPerSkid;
                if (aggregatedPieces.ContainsKey(line.PartNumber))
                {
                    aggregatedPieces[line.PartNumber] += parentPieces;
                }
                else
                {
                    aggregatedPieces[line.PartNumber] = parentPieces;
                }

                // Get and add component pieces
                var componentsResult = await _componentDao.GetByParentPartAsync(line.PartNumber);
                if (componentsResult.IsSuccess &amp;&amp; componentsResult.Data != null)
                {
                    foreach (var component in componentsResult.Data)
                    {
                        // Validate component quantities
                        if (component.Quantity &lt;= 0 || component.ComponentQuantityPerSkid &lt;= 0)
                        {
                            await _logger.LogWarningAsync(
                                $&quot;Skipping component {component.ComponentPartNumber} with invalid quantity: &quot; +
                                $&quot;ComponentQty={component.Quantity}, QtyPerSkid={component.ComponentQuantityPerSkid}&quot;);
                            continue;
                        }

                        // Component pieces = skidCount  componentQty  componentQtyPerSkid
                        int componentPieces = line.ReceivedSkidCount * component.Quantity * component.ComponentQuantityPerSkid;

                        if (aggregatedPieces.ContainsKey(component.ComponentPartNumber))
                        {
                            aggregatedPieces[component.ComponentPartNumber] += componentPieces;
                        }
                        else
                        {
                            aggregatedPieces[component.ComponentPartNumber] = componentPieces;
                        }
                    }
                }
            }

            await _logger.LogInfoAsync($&quot;Component explosion complete: {aggregatedPieces.Count} unique parts&quot;);

            return new Model_Dao_Result&lt;Dictionary&lt;string, int&gt;&gt;
            {
                Success = true,
                Data = aggregatedPieces
            };
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error calculating component explosion: {ex.Message}&quot;, ex);
            return new Model_Dao_Result&lt;Dictionary&lt;string, int&gt;&gt;
            {
                Success = false,
                ErrorMessage = $&quot;Error calculating component explosion: {ex.Message}&quot;,
                Severity = Enum_ErrorSeverity.Error,
                Exception = ex
            };
        }
    }

    /// &lt;summary&gt;
    /// Generates CSV file for LabelView 2022 label printing
    /// Format: Material,Quantity,Employee,Date,Time,Receiver,Notes
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipmentId&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;string&gt;&gt; GenerateLabelCsvAsync(int shipmentId)
    {
        try
        {
            // Authorization check
            var authResult = await _authService.CanGenerateLabelsAsync();
            if (!authResult.IsSuccess)
            {
                return new Model_Dao_Result&lt;string&gt;
                {
                    Success = false,
                    ErrorMessage = &quot;You are not authorized to generate labels&quot;,
                    Severity = Enum_ErrorSeverity.Warning
                };
            }

            // Validate shipmentId (prevent file path injection)
            if (shipmentId &lt;= 0)
            {
                return new Model_Dao_Result&lt;string&gt;
                {
                    Success = false,
                    ErrorMessage = &quot;Invalid shipment ID&quot;,
                    Severity = Enum_ErrorSeverity.Error
                };
            }

            await _logger.LogInfoAsync($&quot;Generating label CSV for shipment {shipmentId}&quot;);

            // Get shipment details
            var shipmentResult = await _shipmentDao.GetByIdAsync(shipmentId);
            if (!shipmentResult.IsSuccess || shipmentResult.Data == null)
            {
                return new Model_Dao_Result&lt;string&gt;
                {
                    Success = false,
                    ErrorMessage = &quot;Shipment not found&quot;,
                    Severity = Enum_ErrorSeverity.Error
                };
            }

            var shipment = shipmentResult.Data;

            // Get shipment lines
            var linesResult = await _lineDao.GetByShipmentIdAsync(shipmentId);
            if (!linesResult.IsSuccess || linesResult.Data == null)
            {
                return new Model_Dao_Result&lt;string&gt;
                {
                    Success = false,
                    ErrorMessage = &quot;Failed to retrieve shipment lines&quot;,
                    Severity = Enum_ErrorSeverity.Error
                };
            }

            var lines = linesResult.Data;

            // Calculate component explosion
            var explosionResult = await CalculateComponentExplosionAsync(lines);
            if (!explosionResult.IsSuccess || explosionResult.Data == null)
            {
                return new Model_Dao_Result&lt;string&gt;
                {
                    Success = false,
                    ErrorMessage = explosionResult.ErrorMessage,
                    Severity = Enum_ErrorSeverity.Error
                };
            }

            var aggregatedPieces = explosionResult.Data;

            // Sanity check: prevent extremely large CSV files
            const int MaxCsvLines = 10000;
            if (aggregatedPieces.Count &gt; MaxCsvLines)
            {
                return new Model_Dao_Result&lt;string&gt;
                {
                    Success = false,
                    ErrorMessage = $&quot;CSV generation failed: Too many parts ({aggregatedPieces.Count} parts exceeds maximum of {MaxCsvLines})&quot;,
                    Severity = Enum_ErrorSeverity.Error
                };
            }

            // Create CSV directory
            string appDataPath = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
            string csvDirectory = Path.Combine(appDataPath, &quot;MTM_Receiving_Application&quot;, &quot;Volvo&quot;, &quot;Labels&quot;);
            Directory.CreateDirectory(csvDirectory);

            // Use fixed filename Volvo_Labels.csv (overwrites previous)
            string fileName = &quot;Volvo_Labels.csv&quot;;
            string filePath = Path.Combine(csvDirectory, fileName);

            // Build CSV content
            var csvContent = new StringBuilder();
            csvContent.AppendLine(&quot;Material,Quantity,Employee,Date,Time,Receiver,Notes&quot;);

            string dateFormatted = shipment.ShipmentDate.ToString(&quot;MM/dd/yyyy&quot;);
            string timeFormatted = DateTime.Now.ToString(&quot;HH:mm:ss&quot;);

            foreach (var kvp in aggregatedPieces.OrderBy(x =&gt; x.Key))
            {
                // Format: Material,Quantity,Employee,Date,Time,Receiver,Notes
                // Receiver field is empty for Volvo parts (per spec - hide PO field for V-EMB- parts)
                csvContent.AppendLine($&quot;{kvp.Key},{kvp.Value},{shipment.EmployeeNumber},{dateFormatted},{timeFormatted},,&quot;);
            }

            // Write CSV file
            await File.WriteAllTextAsync(filePath, csvContent.ToString());

            await _logger.LogInfoAsync($&quot;Label CSV generated: {filePath}&quot;);

            return new Model_Dao_Result&lt;string&gt;
            {
                Success = true,
                Data = filePath
            };
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error generating label CSV: {ex.Message}&quot;, ex);
            return new Model_Dao_Result&lt;string&gt;
            {
                Success = false,
                ErrorMessage = $&quot;Error generating label CSV: {ex.Message}&quot;,
                Severity = Enum_ErrorSeverity.Error,
                Exception = ex
            };
        }
    }

    /// &lt;summary&gt;
    /// Formats email text for PO requisition (with discrepancy notice if applicable)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipment&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;lines&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;requestedLines&quot;&gt;&lt;/param&gt;
    public async Task&lt;string&gt; FormatEmailTextAsync(
        Model_VolvoShipment shipment,
        List&lt;Model_VolvoShipmentLine&gt; lines,
        Dictionary&lt;string, int&gt;? requestedLines = null)
    {
        // Null guard for requestedLines
        requestedLines ??= new Dictionary&lt;string, int&gt;();

        var emailText = new StringBuilder();

        // Subject line (for user reference)
        emailText.AppendLine($&quot;Subject: PO Requisition - Volvo Dunnage - {shipment.ShipmentDate:MM/dd/yyyy} Shipment #{shipment.ShipmentNumber}&quot;);
        emailText.AppendLine();

        // Greeting
        emailText.AppendLine(&quot;Good morning,&quot;);
        emailText.AppendLine();
        emailText.AppendLine($&quot;Please create a PO for the following Volvo dunnage received on {shipment.ShipmentDate:MM/dd/yyyy}:&quot;);
        emailText.AppendLine();

        // Discrepancy section (if any)
        var discrepancies = lines.Where(l =&gt; l.HasDiscrepancy).ToList();
        if (discrepancies.Count &gt; 0)
        {
            emailText.AppendLine(&quot;**DISCREPANCIES NOTED**&quot;);
            emailText.AppendLine();
            emailText.AppendLine(&quot;Part Number\tPacklist Qty (pcs)\tReceived Qty (pcs)\tDifference (pcs)\tNote&quot;);
            emailText.AppendLine(new string(&apos;-&apos;, 80));

            foreach (var line in discrepancies)
            {
                int expectedPieces = line.ExpectedPieceCount ?? 0;
                int receivedPieces = line.CalculatedPieceCount;
                int difference = receivedPieces - expectedPieces;
                string diffStr = difference &gt; 0 ? $&quot;+{difference}&quot; : difference.ToString();
                emailText.AppendLine($&quot;{line.PartNumber}\t{expectedPieces}\t{receivedPieces}\t{diffStr}\t{line.DiscrepancyNote ?? &quot;&quot;}&quot;);
            }

            emailText.AppendLine();
        }

        // Requested lines section
        emailText.AppendLine(&quot;Requested Lines:&quot;);
        emailText.AppendLine();
        emailText.AppendLine(&quot;Part Number\tQuantity (pcs)&quot;);
        emailText.AppendLine(new string(&apos;-&apos;, 40));

        foreach (var kvp in requestedLines.OrderBy(x =&gt; x.Key))
        {
            emailText.AppendLine($&quot;{kvp.Key}\t{kvp.Value}&quot;);
        }

        emailText.AppendLine();

        // Notes section (if any)
        if (!string.IsNullOrWhiteSpace(shipment.Notes))
        {
            emailText.AppendLine(&quot;Additional Notes:&quot;);
            emailText.AppendLine(shipment.Notes);
            emailText.AppendLine();
        }

        await _logger.LogInfoAsync(&quot;Email text formatted&quot;);

        return emailText.ToString();
    }

    /// &lt;summary&gt;
    /// Formats email data for PO requisition (structured for display and HTML conversion)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipment&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;lines&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;requestedLines&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_VolvoEmailData&gt; FormatEmailDataAsync(
        Model_VolvoShipment shipment,
        List&lt;Model_VolvoShipmentLine&gt; lines,
        Dictionary&lt;string, int&gt;? requestedLines = null)
    {
        // Null guard for requestedLines
        requestedLines ??= new Dictionary&lt;string, int&gt;();

        var emailData = new Model_VolvoEmailData
        {
            Subject = $&quot;PO Requisition - Volvo Dunnage - {shipment.ShipmentDate:MM/dd/yyyy} Shipment #{shipment.ShipmentNumber}&quot;,
            Greeting = &quot;Good morning,&quot;,
            Message = $&quot;Please create a PO for the following Volvo dunnage received on {shipment.ShipmentDate:MM/dd/yyyy}:&quot;,
            RequestedLines = requestedLines,
            AdditionalNotes = string.IsNullOrWhiteSpace(shipment.Notes) ? null : shipment.Notes,
            Signature = string.Empty
        };

        // Build discrepancy list
        var discrepancies = lines.Where(l =&gt; l.HasDiscrepancy).ToList();
        foreach (var line in discrepancies)
        {
            int expectedPieces = line.ExpectedPieceCount ?? 0;
            int receivedPieces = line.CalculatedPieceCount;
            int difference = receivedPieces - expectedPieces;
            emailData.Discrepancies.Add(new Model_VolvoEmailData.DiscrepancyLineItem
            {
                PartNumber = line.PartNumber,
                PacklistQty = expectedPieces,
                ReceivedQty = receivedPieces,
                Difference = difference,
                Note = line.DiscrepancyNote ?? string.Empty
            });
        }

        await _logger.LogInfoAsync(&quot;Email data formatted&quot;);
        return emailData;
    }

    /// &lt;summary&gt;
    /// Converts structured email data to HTML format with tables for Outlook paste
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;emailData&quot;&gt;&lt;/param&gt;
    public string FormatEmailAsHtml(Model_VolvoEmailData emailData)
    {
        var html = new StringBuilder();

        html.AppendLine(&quot;&lt;html&gt;&quot;);
        html.AppendLine(&quot;&lt;body style=&apos;font-family: Calibri, Arial, sans-serif; font-size: 11pt;&apos;&gt;&quot;);

        // Greeting
        html.AppendLine($&quot;&lt;p&gt;{emailData.Greeting}&lt;/p&gt;&quot;);
        html.AppendLine($&quot;&lt;p&gt;{emailData.Message}&lt;/p&gt;&quot;);

        // Discrepancy table
        if (emailData.Discrepancies.Count &gt; 0)
        {
            html.AppendLine(&quot;&lt;p&gt;&lt;strong&gt;**DISCREPANCIES NOTED**&lt;/strong&gt;&lt;/p&gt;&quot;);
            html.AppendLine(&quot;&lt;table border=&apos;1&apos; cellpadding=&apos;5&apos; cellspacing=&apos;0&apos; style=&apos;border-collapse: collapse; font-size: 10pt;&apos;&gt;&quot;);
            html.AppendLine(&quot;&lt;thead&gt;&quot;);
            html.AppendLine(&quot;&lt;tr style=&apos;background-color: #D9D9D9; font-weight: bold;&apos;&gt;&quot;);
            html.AppendLine(&quot;&lt;th&gt;Part Number&lt;/th&gt;&quot;);
            html.AppendLine(&quot;&lt;th&gt;Packlist Qty&lt;/th&gt;&quot;);
            html.AppendLine(&quot;&lt;th&gt;Received Qty&lt;/th&gt;&quot;);
            html.AppendLine(&quot;&lt;th&gt;Difference&lt;/th&gt;&quot;);
            html.AppendLine(&quot;&lt;th&gt;Note&lt;/th&gt;&quot;);
            html.AppendLine(&quot;&lt;/tr&gt;&quot;);
            html.AppendLine(&quot;&lt;/thead&gt;&quot;);
            html.AppendLine(&quot;&lt;tbody&gt;&quot;);

            foreach (var disc in emailData.Discrepancies)
            {
                string diffStr = disc.Difference &gt; 0 ? $&quot;+{disc.Difference}&quot; : disc.Difference.ToString();
                html.AppendLine(&quot;&lt;tr&gt;&quot;);
                html.AppendLine($&quot;&lt;td&gt;{disc.PartNumber}&lt;/td&gt;&quot;);
                html.AppendLine($&quot;&lt;td&gt;{disc.PacklistQty}&lt;/td&gt;&quot;);
                html.AppendLine($&quot;&lt;td&gt;{disc.ReceivedQty}&lt;/td&gt;&quot;);
                html.AppendLine($&quot;&lt;td&gt;{diffStr}&lt;/td&gt;&quot;);
                html.AppendLine($&quot;&lt;td&gt;{disc.Note}&lt;/td&gt;&quot;);
                html.AppendLine(&quot;&lt;/tr&gt;&quot;);
            }

            html.AppendLine(&quot;&lt;/tbody&gt;&quot;);
            html.AppendLine(&quot;&lt;/table&gt;&quot;);
            html.AppendLine(&quot;&lt;br/&gt;&quot;);
        }

        // Requested Lines table
        html.AppendLine(&quot;&lt;p&gt;&lt;strong&gt;Requested Lines:&lt;/strong&gt;&lt;/p&gt;&quot;);
        html.AppendLine(&quot;&lt;table border=&apos;1&apos; cellpadding=&apos;5&apos; cellspacing=&apos;0&apos; style=&apos;border-collapse: collapse; font-size: 10pt;&apos;&gt;&quot;);
        html.AppendLine(&quot;&lt;thead&gt;&quot;);
        html.AppendLine(&quot;&lt;tr style=&apos;background-color: #D9D9D9; font-weight: bold;&apos;&gt;&quot;);
        html.AppendLine(&quot;&lt;th&gt;Part Number&lt;/th&gt;&quot;);
        html.AppendLine(&quot;&lt;th&gt;Quantity (pcs)&lt;/th&gt;&quot;);
        html.AppendLine(&quot;&lt;/tr&gt;&quot;);
        html.AppendLine(&quot;&lt;/thead&gt;&quot;);
        html.AppendLine(&quot;&lt;tbody&gt;&quot;);

        foreach (var kvp in emailData.RequestedLines.OrderBy(x =&gt; x.Key))
        {
            html.AppendLine(&quot;&lt;tr&gt;&quot;);
            html.AppendLine($&quot;&lt;td&gt;{kvp.Key}&lt;/td&gt;&quot;);
            html.AppendLine($&quot;&lt;td&gt;{kvp.Value}&lt;/td&gt;&quot;);
            html.AppendLine(&quot;&lt;/tr&gt;&quot;);
        }

        html.AppendLine(&quot;&lt;/tbody&gt;&quot;);
        html.AppendLine(&quot;&lt;/table&gt;&quot;);
        html.AppendLine(&quot;&lt;br/&gt;&quot;);

        // Notes
        if (!string.IsNullOrWhiteSpace(emailData.AdditionalNotes))
        {
            html.AppendLine(&quot;&lt;p&gt;&lt;strong&gt;Additional Notes:&lt;/strong&gt;&lt;/p&gt;&quot;);
            html.AppendLine($&quot;&lt;p&gt;{emailData.AdditionalNotes}&lt;/p&gt;&quot;);
        }

        // Signature
        html.AppendLine($&quot;&lt;p&gt;{emailData.Signature.Replace(&quot;\\n&quot;, &quot;&lt;br/&gt;&quot;)}&lt;/p&gt;&quot;);

        html.AppendLine(&quot;&lt;/body&gt;&quot;);
        html.AppendLine(&quot;&lt;/html&gt;&quot;);

        return html.ToString();
    }

    /// &lt;summary&gt;
    /// Validates shipment data before save
    /// Centralized validation logic for data integrity
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipment&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;lines&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; ValidateShipmentAsync(
        Model_VolvoShipment shipment,
        List&lt;Model_VolvoShipmentLine&gt; lines)
    {
        // Validate: At least one line required
        if (lines == null || lines.Count == 0)
        {
            return Model_Dao_Result_Factory.Failure(&quot;At least one part line is required&quot;);
        }

        // Validate: All lines have valid data
        foreach (var line in lines)
        {
            if (string.IsNullOrWhiteSpace(line.PartNumber))
            {
                return Model_Dao_Result_Factory.Failure(&quot;All parts must have a part number&quot;);
            }

            if (line.ReceivedSkidCount &lt; 1 || line.ReceivedSkidCount &gt; 99)
            {
                return Model_Dao_Result_Factory.Failure(
                    $&quot;Part {line.PartNumber}: skid count must be between 1 and 99&quot;);
            }

            if (line.HasDiscrepancy &amp;&amp; !line.ExpectedSkidCount.HasValue)
            {
                return Model_Dao_Result_Factory.Failure(
                    $&quot;Part {line.PartNumber} has discrepancy but no expected skid count&quot;);
            }
        }

        // Validate: Shipment date not in future
        if (shipment.ShipmentDate &gt; DateTime.Now.AddDays(1))
        {
            return Model_Dao_Result_Factory.Failure(&quot;Shipment date cannot be in the future&quot;);
        }

        await _logger.LogInfoAsync(&quot;Shipment validation passed&quot;);
        return Model_Dao_Result_Factory.Success();
    }

    /// &lt;summary&gt;
    /// Saves shipment and lines with status=&apos;pending_po&apos;
    /// Validates: Only one pending shipment allowed at a time
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipment&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;lines&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;overwriteExisting&quot;&gt;If true, deletes any existing pending shipment before saving&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;(int ShipmentId, int ShipmentNumber)&gt;&gt; SaveShipmentAsync(
        Model_VolvoShipment shipment,
        List&lt;Model_VolvoShipmentLine&gt; lines,
        bool overwriteExisting = false)
    {
        try
        {
            // Authorization check
            var authResult = await _authService.CanManageShipmentsAsync();
            if (!authResult.IsSuccess)
            {
                return new Model_Dao_Result&lt;(int, int)&gt;
                {
                    Success = false,
                    ErrorMessage = &quot;You are not authorized to manage shipments&quot;,
                    Severity = Enum_ErrorSeverity.Warning
                };
            }

            await _logger.LogInfoAsync(&quot;Saving Volvo shipment as pending PO&quot;);

            // Check for existing pending shipment
            var existingPendingResult = await _shipmentDao.GetPendingAsync();
            if (existingPendingResult.IsSuccess &amp;&amp; existingPendingResult.Data != null)
            {
                if (overwriteExisting)
                {
                    // Delete the existing pending shipment
                    await _logger.LogInfoAsync($&quot;Deleting existing pending shipment #{existingPendingResult.Data.ShipmentNumber}&quot;);
                    var deleteResult = await _shipmentDao.DeleteAsync(existingPendingResult.Data.Id);
                    if (!deleteResult.IsSuccess)
                    {
                        return new Model_Dao_Result&lt;(int, int)&gt;
                        {
                            Success = false,
                            ErrorMessage = $&quot;Failed to delete existing shipment: {deleteResult.ErrorMessage}&quot;,
                            Severity = Enum_ErrorSeverity.Error
                        };
                    }
                }
                else
                {
                    // Return the existing shipment info so the UI can prompt for overwrite
                    return new Model_Dao_Result&lt;(int, int)&gt;
                    {
                        Success = false,
                        ErrorMessage = $&quot;PENDING_EXISTS|{existingPendingResult.Data.ShipmentNumber}|{existingPendingResult.Data.ShipmentDate:MM/dd/yyyy}&quot;,
                        Data = (existingPendingResult.Data.Id, existingPendingResult.Data.ShipmentNumber),
                        Severity = Enum_ErrorSeverity.Warning
                    };
                }
            }

            // Validate: At least one line required
            if (lines == null || lines.Count == 0)
            {
                return new Model_Dao_Result&lt;(int, int)&gt;
                {
                    Success = false,
                    ErrorMessage = &quot;At least one part line is required&quot;,
                    Severity = Enum_ErrorSeverity.Warning
                };
            }

            // Calculate and store piece counts for each line
            foreach (var line in lines)
            {
                var partResult = await _partDao.GetByIdAsync(line.PartNumber);
                if (!partResult.IsSuccess || partResult.Data == null)
                {
                    return new Model_Dao_Result&lt;(int, int)&gt;
                    {
                        Success = false,
                        ErrorMessage = $&quot;Part {line.PartNumber} not found&quot;,
                        Severity = Enum_ErrorSeverity.Error
                    };
                }

                // Calculate parent part pieces only (components handled separately)
                var parentPart = partResult.Data;
                line.CalculatedPieceCount = line.ReceivedSkidCount * parentPart.QuantityPerSkid;
            }

            // Insert shipment
            var insertResult = await _shipmentDao.InsertAsync(shipment);
            if (!insertResult.IsSuccess)
            {
                return new Model_Dao_Result&lt;(int, int)&gt;
                {
                    Success = false,
                    ErrorMessage = insertResult.ErrorMessage,
                    Severity = Enum_ErrorSeverity.Error
                };
            }

            int shipmentId = insertResult.Data.ShipmentId;
            int shipmentNumber = insertResult.Data.ShipmentNumber;

            await _logger.LogInfoAsync($&quot;Starting line insertion transaction for shipment {shipmentId}, {lines.Count} lines to insert&quot;);

            // Insert lines within transaction for data integrity
            await using var connection = new MySqlConnection(Helper_Database_Variables.GetConnectionString());
            await connection.OpenAsync();
            await using var transaction = await connection.BeginTransactionAsync();

            try
            {
                int lineIndex = 0;
                foreach (var line in lines)
                {
                    lineIndex++;
                    line.ShipmentId = shipmentId;

                    await _logger.LogInfoAsync($&quot;Inserting line {lineIndex}/{lines.Count}: &quot; +
                        $&quot;Part={line.PartNumber}, &quot; +
                        $&quot;Skids={line.ReceivedSkidCount}, &quot; +
                        $&quot;Pieces={line.CalculatedPieceCount}, &quot; +
                        $&quot;HasDiscrepancy={line.HasDiscrepancy}, &quot; +
                        $&quot;ExpectedSkids={line.ExpectedSkidCount?.ToString() ?? &quot;NULL&quot;}, &quot; +
                        $&quot;Note={(!string.IsNullOrEmpty(line.DiscrepancyNote) ? &quot;PROVIDED&quot; : &quot;NULL&quot;)}&quot;);

                    var parameters = new Dictionary&lt;string, object&gt;
                    {
                        { &quot;shipment_id&quot;, line.ShipmentId },
                        { &quot;part_number&quot;, line.PartNumber },
                        { &quot;received_skid_count&quot;, line.ReceivedSkidCount },
                        { &quot;calculated_piece_count&quot;, line.CalculatedPieceCount },
                        { &quot;has_discrepancy&quot;, line.HasDiscrepancy ? 1 : 0 },
                        { &quot;expected_skid_count&quot;, line.ExpectedSkidCount ?? (object)DBNull.Value },
                        { &quot;discrepancy_note&quot;, line.DiscrepancyNote ?? (object)DBNull.Value }
                    };

                    await _logger.LogInfoAsync($&quot;Parameters: {string.Join(&quot;, &quot;, parameters.Select(p =&gt; $&quot;{p.Key}={p.Value}&quot;))}&quot;);

                    var lineResult = await Helper_Database_StoredProcedure.ExecuteInTransactionAsync(
                        connection,
                        (MySqlTransaction)transaction,
                        &quot;sp_Volvo_ShipmentLine_Insert&quot;,
                        parameters);

                    if (!lineResult.IsSuccess)
                    {
                        await transaction.RollbackAsync();
                        await _logger.LogErrorAsync($&quot;Failed to insert line {lineIndex} for part {line.PartNumber}&quot;);
                        await _logger.LogErrorAsync($&quot;Error: {lineResult.ErrorMessage}&quot;);
                        if (lineResult.Exception != null)
                        {
                            await _logger.LogErrorAsync($&quot;Exception Type: {lineResult.Exception.GetType().Name}&quot;);
                            await _logger.LogErrorAsync($&quot;Exception Message: {lineResult.Exception.Message}&quot;);
                            if (lineResult.Exception.InnerException != null)
                            {
                                await _logger.LogErrorAsync($&quot;Inner Exception: {lineResult.Exception.InnerException.Message}&quot;);
                            }
                        }
                        return new Model_Dao_Result&lt;(int, int)&gt;
                        {
                            Success = false,
                            ErrorMessage = $&quot;Failed to insert line for part {line.PartNumber}: {lineResult.ErrorMessage}&quot;,
                            Severity = Enum_ErrorSeverity.Error
                        };
                    }

                    await _logger.LogInfoAsync($&quot;Line {lineIndex} inserted successfully&quot;);
                }

                await transaction.CommitAsync();
                await _logger.LogInfoAsync($&quot;Transaction committed: Shipment {shipmentId} saved with {lines.Count} lines&quot;);

                return new Model_Dao_Result&lt;(int, int)&gt;
                {
                    Success = true,
                    Data = (shipmentId, shipmentNumber)
                };
            }
            catch (Exception ex)
            {
                await transaction.RollbackAsync();
                await _logger.LogErrorAsync($&quot;Transaction failed, rolled back: {ex.Message}&quot;, ex);
                return new Model_Dao_Result&lt;(int, int)&gt;
                {
                    Success = false,
                    ErrorMessage = $&quot;Transaction failed: {ex.Message}&quot;,
                    Severity = Enum_ErrorSeverity.Error
                };
            }
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error saving shipment: {ex.Message}&quot;, ex);
            return new Model_Dao_Result&lt;(int, int)&gt;
            {
                Success = false,
                ErrorMessage = $&quot;Error saving shipment: {ex.Message}&quot;,
                Severity = Enum_ErrorSeverity.Error,
                Exception = ex
            };
        }
    }

    /// &lt;summary&gt;
    /// Gets pending shipment if one exists
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&lt;Model_VolvoShipment?&gt;&gt; GetPendingShipmentAsync()
    {
        var result = await _shipmentDao.GetPendingAsync();
        if (!result.IsSuccess)
        {
            return Model_Dao_Result_Factory.Failure&lt;Model_VolvoShipment?&gt;(result.ErrorMessage);
        }
        return Model_Dao_Result_Factory.Success&lt;Model_VolvoShipment?&gt;(result.Data);
    }

    /// &lt;summary&gt;
    /// Gets pending shipment with all line items
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&lt;(Model_VolvoShipment? Shipment, List&lt;Model_VolvoShipmentLine&gt; Lines)&gt;&gt; GetPendingShipmentWithLinesAsync()
    {
        try
        {
            var shipmentResult = await _shipmentDao.GetPendingAsync();
            if (!shipmentResult.IsSuccess)
            {
                return new Model_Dao_Result&lt;(Model_VolvoShipment?, List&lt;Model_VolvoShipmentLine&gt;)&gt;
                {
                    Success = false,
                    ErrorMessage = shipmentResult.ErrorMessage,
                    Severity = shipmentResult.Severity
                };
            }

            if (shipmentResult.Data == null)
            {
                return new Model_Dao_Result&lt;(Model_VolvoShipment?, List&lt;Model_VolvoShipmentLine&gt;)&gt;
                {
                    Success = true,
                    Data = (null, new List&lt;Model_VolvoShipmentLine&gt;())
                };
            }

            var linesResult = await _lineDao.GetByShipmentIdAsync(shipmentResult.Data.Id);
            if (!linesResult.IsSuccess)
            {
                return new Model_Dao_Result&lt;(Model_VolvoShipment?, List&lt;Model_VolvoShipmentLine&gt;)&gt;
                {
                    Success = false,
                    ErrorMessage = linesResult.ErrorMessage,
                    Severity = linesResult.Severity
                };
            }

            return new Model_Dao_Result&lt;(Model_VolvoShipment?, List&lt;Model_VolvoShipmentLine&gt;)&gt;
            {
                Success = true,
                Data = (shipmentResult.Data, linesResult.Data ?? new List&lt;Model_VolvoShipmentLine&gt;())
            };
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error getting pending shipment with lines: {ex.Message}&quot;, ex);
            return new Model_Dao_Result&lt;(Model_VolvoShipment?, List&lt;Model_VolvoShipmentLine&gt;)&gt;
            {
                Success = false,
                ErrorMessage = $&quot;Error: {ex.Message}&quot;,
                Severity = Enum_ErrorSeverity.Error,
                Exception = ex
            };
        }
    }

    /// &lt;summary&gt;
    /// Completes shipment with PO and Receiver numbers
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipmentId&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;poNumber&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;receiverNumber&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; CompleteShipmentAsync(int shipmentId, string poNumber, string receiverNumber)
    {
        try
        {
            // Authorization check
            var authResult = await _authService.CanCompleteShipmentsAsync();
            if (!authResult.IsSuccess)
            {
                return new Model_Dao_Result
                {
                    Success = false,
                    ErrorMessage = &quot;You are not authorized to complete shipments&quot;,
                    Severity = Enum_ErrorSeverity.Warning
                };
            }

            await _logger.LogInfoAsync($&quot;Completing shipment {shipmentId} with PO={poNumber}, Receiver={receiverNumber}&quot;);

            // Validate inputs
            if (string.IsNullOrWhiteSpace(poNumber))
            {
                return new Model_Dao_Result
                {
                    Success = false,
                    ErrorMessage = &quot;PO Number is required&quot;,
                    Severity = Enum_ErrorSeverity.Warning
                };
            }

            if (string.IsNullOrWhiteSpace(receiverNumber))
            {
                return new Model_Dao_Result
                {
                    Success = false,
                    ErrorMessage = &quot;Receiver Number is required&quot;,
                    Severity = Enum_ErrorSeverity.Warning
                };
            }

            var result = await _shipmentDao.CompleteAsync(shipmentId, poNumber, receiverNumber);

            if (result.IsSuccess)
            {
                await _logger.LogInfoAsync($&quot;Shipment {shipmentId} completed successfully&quot;);
            }

            return result;
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error completing shipment: {ex.Message}&quot;, ex);
            return new Model_Dao_Result
            {
                Success = false,
                ErrorMessage = $&quot;Error completing shipment: {ex.Message}&quot;,
                Severity = Enum_ErrorSeverity.Error,
                Exception = ex
            };
        }
    }

    /// &lt;summary&gt;
    /// Gets all active Volvo parts for dropdown population
    /// &lt;/summary&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoPart&gt;&gt;&gt; GetActivePartsAsync()
    {
        return await _partDao.GetAllAsync(includeInactive: false);
    }

    /// &lt;summary&gt;
    /// Gets shipment history with filtering
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;startDate&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;endDate&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;status&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoShipment&gt;&gt;&gt; GetHistoryAsync(
        DateTime startDate,
        DateTime endDate,
        string status = &quot;all&quot;)
    {
        return await _shipmentDao.GetHistoryAsync(startDate, endDate, status);
    }

    /// &lt;summary&gt;
    /// Gets all shipment lines for a specific shipment
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipmentId&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;List&lt;Model_VolvoShipmentLine&gt;&gt;&gt; GetShipmentLinesAsync(int shipmentId)
    {
        return await _lineDao.GetByShipmentIdAsync(shipmentId);
    }

    /// &lt;summary&gt;
    /// Updates an existing shipment and its lines
    /// Regenerates CSV if applicable
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;shipment&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;lines&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&gt; UpdateShipmentAsync(
        Model_VolvoShipment shipment,
        List&lt;Model_VolvoShipmentLine&gt; lines)
    {
        try
        {
            // Update shipment header
            var shipmentResult = await _shipmentDao.UpdateAsync(shipment);
            if (!shipmentResult.IsSuccess)
            {
                return shipmentResult;
            }

            // Delete existing lines
            var existingLines = await _lineDao.GetByShipmentIdAsync(shipment.Id);
            if (existingLines.IsSuccess &amp;&amp; existingLines.Data != null)
            {
                foreach (var line in existingLines.Data)
                {
                    await _lineDao.DeleteAsync(line.Id);
                }
            }

            // Insert updated lines
            foreach (var line in lines)
            {
                line.ShipmentId = shipment.Id;
                var lineResult = await _lineDao.InsertAsync(line);
                if (!lineResult.IsSuccess)
                {
                    await _logger.LogErrorAsync(
                        $&quot;Failed to insert line: {lineResult.ErrorMessage}&quot;,
                        null,
                        nameof(UpdateShipmentAsync));
                }
            }

            // Regenerate CSV if completed
            if (shipment.Status == &quot;completed&quot; &amp;&amp; !string.IsNullOrEmpty(shipment.PONumber))
            {
                await GenerateLabelCsvAsync(shipment.Id);
            }

            return Model_Dao_Result_Factory.Success(&quot;Shipment updated successfully&quot;);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync(
                $&quot;Error updating shipment: {ex.Message}&quot;,
                ex,
                nameof(UpdateShipmentAsync));
            return Model_Dao_Result_Factory.Failure($&quot;Error updating shipment: {ex.Message}&quot;);
        }
    }

    /// &lt;summary&gt;
    /// Exports shipment history to CSV format
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;startDate&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;endDate&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;status&quot;&gt;&lt;/param&gt;
    public async Task&lt;Model_Dao_Result&lt;string&gt;&gt; ExportHistoryToCsvAsync(
        DateTime startDate,
        DateTime endDate,
        string status = &quot;all&quot;)
    {
        try
        {
            var historyResult = await GetHistoryAsync(startDate, endDate, status);
            if (!historyResult.IsSuccess || historyResult.Data == null)
            {
                return Model_Dao_Result_Factory.Failure&lt;string&gt;(&quot;Failed to retrieve history data&quot;);
            }

            var csv = new StringBuilder();
            csv.AppendLine(&quot;ShipmentNumber,Date,PONumber,ReceiverNumber,Status,EmployeeNumber,Notes&quot;);

            foreach (var shipment in historyResult.Data)
            {
                csv.AppendLine($&quot;{shipment.ShipmentNumber},&quot; +
                              $&quot;{shipment.ShipmentDate:yyyy-MM-dd},&quot; +
                              $&quot;{EscapeCsv(shipment.PONumber)},&quot; +
                              $&quot;{EscapeCsv(shipment.ReceiverNumber)},&quot; +
                              $&quot;{shipment.Status},&quot; +
                              $&quot;{shipment.EmployeeNumber},&quot; +
                              $&quot;{EscapeCsv(shipment.Notes)}&quot;);
            }

            return Model_Dao_Result_Factory.Success(csv.ToString());
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync(
                $&quot;Error exporting history: {ex.Message}&quot;,
                ex,
                nameof(ExportHistoryToCsvAsync));
            return Model_Dao_Result_Factory.Failure&lt;string&gt;($&quot;Error exporting history: {ex.Message}&quot;);
        }
    }

    /// &lt;summary&gt;
    /// Escapes CSV values (wraps in quotes if contains comma, quote, or newline)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;value&quot;&gt;&lt;/param&gt;
    private string EscapeCsv(string? value)
    {
        if (string.IsNullOrEmpty(value))
        {
            return string.Empty;
        }

        if (value.Contains(&apos;,&apos;) || value.Contains(&apos;&quot;&apos;) || value.Contains(&apos;\n&apos;))
        {
            return $&quot;\&quot;{value.Replace(&quot;\&quot;&quot;, &quot;\&quot;\&quot;&quot;)}\&quot;&quot;;
        }

        return value;
    }
}</file><file path="Module_Volvo/ViewModels/ViewModel_Volvo_ShipmentEntry.cs">using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Volvo.Contracts;
using MTM_Receiving_Application.Module_Volvo.Models;
using MTM_Receiving_Application.Module_Core.Models.Enums;
using MTM_Receiving_Application.Module_Core.Models.Core;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using Windows.ApplicationModel.DataTransfer;

namespace MTM_Receiving_Application.Module_Volvo.ViewModels;

/// &lt;summary&gt;
/// ViewModel for Volvo shipment entry
/// &lt;/summary&gt;
public partial class ViewModel_Volvo_ShipmentEntry : ViewModel_Shared_Base
{
    private readonly IService_Volvo _volvoService;
    private readonly IService_Window _windowService;
    private readonly IService_UserSessionManager _sessionManager;

    public ViewModel_Volvo_ShipmentEntry(
        IService_Volvo volvoService,
        IService_ErrorHandler errorHandler,
        IService_LoggingUtility logger,
        IService_Window windowService,
        IService_UserSessionManager sessionManager) : base(errorHandler, logger)
    {
        _volvoService = volvoService;
        _windowService = windowService;
        _sessionManager = sessionManager;
    }

    #region Observable Properties

    [ObservableProperty]
    private DateTimeOffset? _shipmentDate = DateTimeOffset.Now;

    [ObservableProperty]
    private int _shipmentNumber = 1;

    [ObservableProperty]
    private string _notes = string.Empty;

    [ObservableProperty]
    private ObservableCollection&lt;Model_VolvoShipmentLine&gt; _parts = new();

    [ObservableProperty]
    private ObservableCollection&lt;Model_VolvoPart&gt; _availableParts = new();

    private List&lt;Model_VolvoPart&gt; _allParts = new();

    [ObservableProperty]
    private ObservableCollection&lt;Model_VolvoPart&gt; _suggestedParts = new();

    [ObservableProperty]
    private Model_VolvoShipmentLine? _selectedPart;

    [ObservableProperty]
    private Model_VolvoPart? _selectedPartToAdd;

    [ObservableProperty]
    private string _partSearchText = string.Empty;

    [ObservableProperty]
    private int _receivedSkidsToAdd = 0;

    [ObservableProperty]
    private bool _canSave = false;

    [ObservableProperty]
    private bool _isSuccessMessageVisible = false;

    [ObservableProperty]
    private string _successMessage = string.Empty;

    [ObservableProperty]
    private bool _hasPendingShipment = false;

    #endregion

    #region Initialization

    public async Task InitializeAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Loading Volvo parts catalog...&quot;;

            // Load available parts
            var partsResult = await _volvoService.GetActivePartsAsync();
            if (partsResult.IsSuccess &amp;&amp; partsResult.Data != null)
            {
                _allParts = partsResult.Data;
                AvailableParts.Clear();
                foreach (var part in _allParts)
                {
                    AvailableParts.Add(part);
                }
            }
            else
            {
                await _errorHandler.HandleErrorAsync(
                    partsResult.ErrorMessage ?? &quot;Failed to load parts catalog&quot;,
                    Enum_ErrorSeverity.Medium,
                    null,
                    true);
            }

            // Check for pending shipment
            var pendingResult = await _volvoService.GetPendingShipmentAsync();
            if (pendingResult.IsSuccess &amp;&amp; pendingResult.Data != null)
            {
                HasPendingShipment = true;
                // Load pending shipment details if exists
                await LoadPendingShipmentAsync();
            }

            StatusMessage = &quot;Ready&quot;;
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error initializing Volvo shipment entry: {ex.Message}&quot;, ex);
            await _errorHandler.HandleErrorAsync(
                &quot;Error initializing Volvo shipment entry&quot;,
                Enum_ErrorSeverity.Medium,
                ex,
                true);
        }
        finally
        {
            IsBusy = false;
        }
    }

    private async Task LoadPendingShipmentAsync()
    {
        var pendingResult = await _volvoService.GetPendingShipmentAsync();
        if (pendingResult.IsSuccess &amp;&amp; pendingResult.Data != null)
        {
            var shipment = pendingResult.Data;
            ShipmentDate = new DateTimeOffset(shipment.ShipmentDate);
            ShipmentNumber = shipment.ShipmentNumber;
            Notes = shipment.Notes ?? string.Empty;

            // Load lines
            var linesResult = await _volvoService.GetShipmentLinesAsync(shipment.Id);
            if (linesResult.IsSuccess &amp;&amp; linesResult.Data != null)
            {
                Parts.Clear();
                foreach (var line in linesResult.Data)
                {
                    Parts.Add(line);
                }
            }
        }
    }

    #endregion

    #region AutoSuggestBox Support

    /// &lt;summary&gt;
    /// Updates the part suggestions list based on user&apos;s search text
    /// Filters parts by case-insensitive substring match on part number
    /// Optimized to reduce collection change notifications
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;queryText&quot;&gt;Search text from AutoSuggestBox&lt;/param&gt;
    public void UpdatePartSuggestions(string queryText)
    {
        if (string.IsNullOrWhiteSpace(queryText))
        {
            SuggestedParts.Clear();
            SelectedPartToAdd = null;
            return;
        }

        var suggestions = _allParts
            .Where(p =&gt; p.PartNumber.Contains(queryText, StringComparison.OrdinalIgnoreCase))
            .Take(20)
            .ToList();

        // Optimize: Use bulk replace to reduce collection change events
        // Clear and add all at once instead of individual adds
        var tempList = new List&lt;Model_VolvoPart&gt;(suggestions);
        SuggestedParts.Clear();
        foreach (var part in tempList)
        {
            SuggestedParts.Add(part);
        }

        // Check if text matches a part exactly
        var exactMatch = _allParts.FirstOrDefault(p =&gt;
            p.PartNumber.Equals(queryText, StringComparison.OrdinalIgnoreCase));
        SelectedPartToAdd = exactMatch;
    }

    /// &lt;summary&gt;
    /// Handles when user selects a part from the AutoSuggestBox dropdown
    /// Sets the search text and selected part for adding to shipment
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;chosenPart&quot;&gt;The part selected from suggestions&lt;/param&gt;
    public void OnPartSuggestionChosen(Model_VolvoPart? chosenPart)
    {
        if (chosenPart != null)
        {
            PartSearchText = chosenPart.PartNumber;
            SelectedPartToAdd = chosenPart;
        }
    }

    partial void OnPartSearchTextChanged(string value)
    {
        UpdatePartSuggestions(value);
    }

    #endregion

    #region Commands

    [RelayCommand(CanExecute = nameof(CanAddPart))]
    private async void AddPart()
    {
        if (SelectedPartToAdd == null || ReceivedSkidsToAdd &lt;= 0)
        {
            return;
        }

        // Input validation (1-99 range)
        if (ReceivedSkidsToAdd &lt; 1 || ReceivedSkidsToAdd &gt; 99)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Received skid count must be between 1 and 99&quot;,
                Enum_ErrorSeverity.Low,
                null,
                true);
            return;
        }

        // Check for duplicate part number
        if (Parts.Any(p =&gt; p.PartNumber.Equals(SelectedPartToAdd.PartNumber, StringComparison.OrdinalIgnoreCase)))
        {
            await _errorHandler.HandleErrorAsync(
                $&quot;Part {SelectedPartToAdd.PartNumber} is already in this shipment. Remove it first if you want to update the quantity.&quot;,
                Enum_ErrorSeverity.Low,
                null,
                true);
            return;
        }

        // Calculate pieces based on quantity per skid
        var calculatedPieces = SelectedPartToAdd.QuantityPerSkid * ReceivedSkidsToAdd;

        var newLine = new Model_VolvoShipmentLine
        {
            PartNumber = SelectedPartToAdd.PartNumber,
            QuantityPerSkid = SelectedPartToAdd.QuantityPerSkid,
            ReceivedSkidCount = ReceivedSkidsToAdd,
            CalculatedPieceCount = calculatedPieces,
            HasDiscrepancy = false,
            ExpectedSkidCount = null,
            DiscrepancyNote = string.Empty
        };

        Parts.Add(newLine);

        // Log user action
        await _logger.LogInfoAsync($&quot;User added part {SelectedPartToAdd.PartNumber}, {ReceivedSkidsToAdd} skids ({calculatedPieces} pcs)&quot;);

        // Reset input fields
        SelectedPartToAdd = null;
        ReceivedSkidsToAdd = 0;
        PartSearchText = string.Empty;
        SuggestedParts.Clear();

        ValidateSaveEligibility();
    }

    private bool CanAddPart()
    {
        return SelectedPartToAdd != null &amp;&amp; ReceivedSkidsToAdd &gt;= 1 &amp;&amp; ReceivedSkidsToAdd &lt;= 99;
    }

    [RelayCommand]
    private async void RemovePart()
    {
        if (SelectedPart != null)
        {
            await _logger.LogInfoAsync($&quot;User removed part {SelectedPart.PartNumber} from shipment&quot;);
            Parts.Remove(SelectedPart);
            ValidateSaveEligibility();
        }
    }

    [RelayCommand]
    private async Task GenerateLabelsAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Generating labels...&quot;;

            // First, save the shipment if not already saved
            if (!HasPendingShipment)
            {
                var saveResult = await SaveShipmentInternalAsync();
                if (!saveResult.IsSuccess)
                {
                    await _errorHandler.HandleErrorAsync(
                        saveResult.ErrorMessage ?? &quot;Failed to save shipment before generating labels&quot;,
                        Enum_ErrorSeverity.Medium,
                        null,
                        true);
                    return;
                }
            }

            // Get the pending shipment ID
            var pendingResult = await _volvoService.GetPendingShipmentAsync();
            if (!pendingResult.IsSuccess || pendingResult.Data == null)
            {
                await _errorHandler.HandleErrorAsync(
                    &quot;No pending shipment found&quot;,
                    Enum_ErrorSeverity.Medium,
                    null,
                    true);
                return;
            }

            // Generate CSV
            var csvResult = await _volvoService.GenerateLabelCsvAsync(pendingResult.Data.Id);
            if (csvResult.IsSuccess)
            {
                SuccessMessage = $&quot;Labels generated successfully!\nFile: {csvResult.Data}&quot;;
                IsSuccessMessageVisible = true;
                StatusMessage = &quot;Labels generated&quot;;
            }
            else
            {
                await _errorHandler.HandleErrorAsync(
                    csvResult.ErrorMessage ?? &quot;Failed to generate labels&quot;,
                    Enum_ErrorSeverity.Medium,
                    null,
                    true);
            }
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error generating labels: {ex.Message}&quot;, ex);
            await _errorHandler.HandleErrorAsync(
                &quot;Error generating labels&quot;,
                Enum_ErrorSeverity.Medium,
                ex,
                true);
        }
        finally
        {
            IsBusy = false;
        }
    }

    [RelayCommand]
    private async Task PreviewEmailAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Formatting email...&quot;;

            // First, ensure the shipment is saved
            if (!HasPendingShipment)
            {
                var saveResult = await SaveShipmentInternalAsync();
                if (!saveResult.IsSuccess)
                {
                    await _errorHandler.HandleErrorAsync(
                        saveResult.ErrorMessage ?? &quot;Failed to save shipment before preview&quot;,
                        Enum_ErrorSeverity.Medium,
                        null,
                        true);
                    return;
                }
            }

            // Get the saved pending shipment
            var pendingResult = await _volvoService.GetPendingShipmentWithLinesAsync();
            if (!pendingResult.IsSuccess || pendingResult.Data.Shipment == null)
            {
                await _errorHandler.HandleErrorAsync(
                    &quot;No pending shipment found&quot;,
                    Enum_ErrorSeverity.Medium,
                    null,
                    true);
                return;
            }

            var shipment = pendingResult.Data.Shipment;
            var lines = pendingResult.Data.Lines;

            // Calculate component explosion to get actual part quantities
            var explosionResult = await _volvoService.CalculateComponentExplosionAsync(lines);

            Dictionary&lt;string, int&gt; requestedLines;
            if (explosionResult.IsSuccess &amp;&amp; explosionResult.Data != null)
            {
                requestedLines = explosionResult.Data;
                await _logger.LogInfoAsync($&quot;Component explosion successful: {requestedLines.Count} parts&quot;);
            }
            else
            {
                // Fallback to empty if explosion fails
                requestedLines = new Dictionary&lt;string, int&gt;();
                await _logger.LogWarningAsync($&quot;Component explosion failed for email preview: {explosionResult.ErrorMessage}&quot;);
            }

            await _logger.LogInfoAsync($&quot;Email preview - RequestedLines count: {requestedLines.Count}&quot;);

            // Format email data with actual part quantities
            var emailData = await _volvoService.FormatEmailDataAsync(shipment, lines, requestedLines);

            await _logger.LogInfoAsync($&quot;Email data formatted - RequestedLines count: {emailData.RequestedLines.Count}&quot;);

            // Show email preview dialog
            await ShowEmailPreviewDialogAsync(emailData);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error previewing email: {ex.Message}&quot;, ex);
            await _errorHandler.HandleErrorAsync(
                &quot;Error previewing email&quot;,
                Enum_ErrorSeverity.Medium,
                ex,
                true);
        }
        finally
        {
            IsBusy = false;
        }
    }

    private async Task ShowEmailPreviewDialogAsync(Model_VolvoEmailData emailData)
    {
        var xamlRoot = _windowService.GetXamlRoot();
        if (xamlRoot == null)
        {
            await _errorHandler.HandleErrorAsync(
                &quot;Cannot show dialog - XamlRoot not available&quot;,
                Enum_ErrorSeverity.Low,
                null,
                true);
            return;
        }

        // Load email recipients from settings
        var settingsDao = new Data.Dao_VolvoSettings(Module_Core.Helpers.Database.Helper_Database_Variables.GetConnectionString());
        var toResult = await settingsDao.GetSettingAsync(&quot;email_to_recipients&quot;);
        var ccResult = await settingsDao.GetSettingAsync(&quot;email_cc_recipients&quot;);

        string toRecipients = FormatRecipientsFromJson(
            toResult.IsSuccess &amp;&amp; toResult.Data != null ? toResult.Data.SettingValue : null,
            &quot;\&quot;Jose Rosas\&quot; &lt;jrosas@mantoolmfg.com&gt;; \&quot;Sandy Miller\&quot; &lt;smiller@mantoolmfg.com&gt;; \&quot;Steph Wittmus\&quot; &lt;swittmus@mantoolmfg.com&gt;&quot;
        );

        string ccRecipients = FormatRecipientsFromJson(
            ccResult.IsSuccess &amp;&amp; ccResult.Data != null ? ccResult.Data.SettingValue : null,
            &quot;\&quot;Debra Alexander\&quot; &lt;dalexander@mantoolmfg.com&gt;; \&quot;Michelle Laurin\&quot; &lt;mlaurin@mantoolmfg.com&gt;&quot;
        );

        var dialog = new ContentDialog
        {
            Title = &quot;PO Requisition Email Preview&quot;,
            PrimaryButtonText = &quot;Copy Email Body&quot;,
            CloseButtonText = &quot;Close&quot;,
            DefaultButton = ContentDialogButton.Primary,
            XamlRoot = xamlRoot,
            MaxWidth = 800
        };

        // Build structured preview UI
        var mainStack = new StackPanel { Spacing = 12, Margin = new Microsoft.UI.Xaml.Thickness(0) };

        // TO Recipients
        var toPanel = new Grid { ColumnSpacing = 8 };
        toPanel.ColumnDefinitions.Add(new Microsoft.UI.Xaml.Controls.ColumnDefinition { Width = new Microsoft.UI.Xaml.GridLength(1, Microsoft.UI.Xaml.GridUnitType.Star) });
        toPanel.ColumnDefinitions.Add(new Microsoft.UI.Xaml.Controls.ColumnDefinition { Width = Microsoft.UI.Xaml.GridLength.Auto });
        var toBox = new TextBox
        {
            Header = &quot;To:&quot;,
            Text = toRecipients,
            IsReadOnly = true,
            TextWrapping = Microsoft.UI.Xaml.TextWrapping.Wrap,
            MaxHeight = 80
        };
        toBox.SetValue(Grid.ColumnProperty, 0);
        var toCopyButton = new Button
        {
            Content = &quot;&quot;,
            Width = 40,
            Height = 40,
            FontSize = 16,
            VerticalAlignment = Microsoft.UI.Xaml.VerticalAlignment.Bottom,
            Margin = new Microsoft.UI.Xaml.Thickness(0, 0, 0, 4)
        };
        toCopyButton.SetValue(Grid.ColumnProperty, 1);
        Microsoft.UI.Xaml.Controls.ToolTipService.SetToolTip(toCopyButton, &quot;Copy To Recipients&quot;);
        toCopyButton.Click += (s, e) =&gt;
        {
            var dataPackage = new DataPackage();
            dataPackage.SetText(toBox.Text);
            Clipboard.SetContent(dataPackage);
        };
        toPanel.Children.Add(toBox);
        toPanel.Children.Add(toCopyButton);
        mainStack.Children.Add(toPanel);

        // CC Recipients
        var ccPanel = new Grid { ColumnSpacing = 8 };
        ccPanel.ColumnDefinitions.Add(new Microsoft.UI.Xaml.Controls.ColumnDefinition { Width = new Microsoft.UI.Xaml.GridLength(1, Microsoft.UI.Xaml.GridUnitType.Star) });
        ccPanel.ColumnDefinitions.Add(new Microsoft.UI.Xaml.Controls.ColumnDefinition { Width = Microsoft.UI.Xaml.GridLength.Auto });
        var ccBox = new TextBox
        {
            Header = &quot;Cc:&quot;,
            Text = ccRecipients,
            IsReadOnly = true,
            TextWrapping = Microsoft.UI.Xaml.TextWrapping.Wrap,
            MaxHeight = 80
        };
        ccBox.SetValue(Grid.ColumnProperty, 0);
        var ccCopyButton = new Button
        {
            Content = &quot;&quot;,
            Width = 40,
            Height = 40,
            FontSize = 16,
            VerticalAlignment = Microsoft.UI.Xaml.VerticalAlignment.Bottom,
            Margin = new Microsoft.UI.Xaml.Thickness(0, 0, 0, 4)
        };
        ccCopyButton.SetValue(Grid.ColumnProperty, 1);
        Microsoft.UI.Xaml.Controls.ToolTipService.SetToolTip(ccCopyButton, &quot;Copy CC Recipients&quot;);
        ccCopyButton.Click += (s, e) =&gt;
        {
            var dataPackage = new DataPackage();
            dataPackage.SetText(ccBox.Text);
            Clipboard.SetContent(dataPackage);
        };
        ccPanel.Children.Add(ccBox);
        ccPanel.Children.Add(ccCopyButton);
        mainStack.Children.Add(ccPanel);

        // Subject
        var subjectPanel = new Grid { ColumnSpacing = 8 };
        subjectPanel.ColumnDefinitions.Add(new Microsoft.UI.Xaml.Controls.ColumnDefinition { Width = new Microsoft.UI.Xaml.GridLength(1, Microsoft.UI.Xaml.GridUnitType.Star) });
        subjectPanel.ColumnDefinitions.Add(new Microsoft.UI.Xaml.Controls.ColumnDefinition { Width = Microsoft.UI.Xaml.GridLength.Auto });
        var subjectBox = new TextBox
        {
            Header = &quot;Subject:&quot;,
            Text = emailData.Subject,
            IsReadOnly = true,
            FontWeight = Microsoft.UI.Text.FontWeights.Bold,
            TextWrapping = Microsoft.UI.Xaml.TextWrapping.Wrap
        };
        subjectBox.SetValue(Grid.ColumnProperty, 0);
        var subjectCopyButton = new Button
        {
            Content = &quot;&quot;,
            Width = 40,
            Height = 40,
            FontSize = 16,
            VerticalAlignment = Microsoft.UI.Xaml.VerticalAlignment.Bottom,
            Margin = new Microsoft.UI.Xaml.Thickness(0, 0, 0, 4)
        };
        subjectCopyButton.SetValue(Grid.ColumnProperty, 1);
        Microsoft.UI.Xaml.Controls.ToolTipService.SetToolTip(subjectCopyButton, &quot;Copy Subject&quot;);
        subjectCopyButton.Click += (s, e) =&gt;
        {
            var dataPackage = new DataPackage();
            dataPackage.SetText(subjectBox.Text);
            Clipboard.SetContent(dataPackage);
        };
        subjectPanel.Children.Add(subjectBox);
        subjectPanel.Children.Add(subjectCopyButton);
        mainStack.Children.Add(subjectPanel);

        // Discrepancies (if any)
        if (emailData.Discrepancies.Count &gt; 0)
        {
            var discHeader = new TextBlock
            {
                Text = &quot;**DISCREPANCIES NOTED**&quot;,
                FontWeight = Microsoft.UI.Text.FontWeights.Bold,
                Margin = new Microsoft.UI.Xaml.Thickness(0, 8, 0, 4)
            };
            mainStack.Children.Add(discHeader);

            var discBox = new TextBox
            {
                IsReadOnly = true,
                TextWrapping = Microsoft.UI.Xaml.TextWrapping.NoWrap,
                FontFamily = new Microsoft.UI.Xaml.Media.FontFamily(&quot;Consolas&quot;),
                AcceptsReturn = true,
                MinHeight = 120,
                MaxHeight = 250
            };
            var discText = new StringBuilder();
            discText.AppendLine(&quot;Part Number\tPacklist Qty (pcs)\tReceived Qty (pcs)\tDifference (pcs)\tNote&quot;);
            discText.AppendLine(new string(&apos;-&apos;, 80));
            foreach (var disc in emailData.Discrepancies)
            {
                string diffStr = disc.Difference &gt; 0 ? $&quot;+{disc.Difference}&quot; : disc.Difference.ToString();
                discText.AppendLine($&quot;{disc.PartNumber}\t{disc.PacklistQty}\t{disc.ReceivedQty}\t{diffStr}\t{disc.Note}&quot;);
            }
            discBox.Text = discText.ToString();
            mainStack.Children.Add(discBox);
        }

        // Requested Lines
        var reqHeader = new TextBlock
        {
            Text = &quot;Requested Lines:&quot;,
            FontWeight = Microsoft.UI.Text.FontWeights.Bold,
            Margin = new Microsoft.UI.Xaml.Thickness(0, 8, 0, 4)
        };
        mainStack.Children.Add(reqHeader);

        var reqBox = new TextBox
        {
            IsReadOnly = true,
            TextWrapping = Microsoft.UI.Xaml.TextWrapping.NoWrap,
            FontFamily = new Microsoft.UI.Xaml.Media.FontFamily(&quot;Consolas&quot;),
            AcceptsReturn = true,
            MinHeight = 150,
            MaxHeight = 300
        };
        var reqText = new StringBuilder();
        reqText.AppendLine(&quot;Part Number\tQuantity (pcs)&quot;);
        reqText.AppendLine(new string(&apos;-&apos;, 40));
        foreach (var kvp in emailData.RequestedLines.OrderBy(x =&gt; x.Key))
        {
            reqText.AppendLine($&quot;{kvp.Key}\t{kvp.Value}&quot;);
        }
        reqBox.Text = reqText.ToString();
        mainStack.Children.Add(reqBox);

        // Additional Notes
        if (!string.IsNullOrWhiteSpace(emailData.AdditionalNotes))
        {
            var notesBox = new TextBox
            {
                Header = &quot;Additional Notes:&quot;,
                Text = emailData.AdditionalNotes,
                IsReadOnly = true,
                TextWrapping = Microsoft.UI.Xaml.TextWrapping.Wrap,
                Height = 60
            };
            mainStack.Children.Add(notesBox);
        }

        var scrollViewer = new ScrollViewer
        {
            Content = mainStack,
            Height = 500,
            VerticalScrollBarVisibility = ScrollBarVisibility.Auto
        };

        dialog.Content = scrollViewer;

        var result = await dialog.ShowAsync();

        if (result == ContentDialogResult.Primary)
        {
            // Copy HTML to clipboard for Outlook paste as table
            var htmlContent = _volvoService.FormatEmailAsHtml(emailData);
            var dataPackage = new DataPackage();
            dataPackage.SetHtmlFormat(htmlContent);
            // Also include plain text fallback
            var plainText = BuildPlainTextEmail(emailData);
            dataPackage.SetText(plainText);
            Clipboard.SetContent(dataPackage);

            SuccessMessage = &quot;Email copied to clipboard (paste into Outlook as formatted table)!&quot;;
            IsSuccessMessageVisible = true;
        }
    }

    private string BuildPlainTextEmail(Model_VolvoEmailData emailData)
    {
        var text = new StringBuilder();
        text.AppendLine($&quot;Subject: {emailData.Subject}&quot;);
        text.AppendLine();
        text.AppendLine(emailData.Greeting);
        text.AppendLine();
        text.AppendLine(emailData.Message);
        text.AppendLine();

        if (emailData.Discrepancies.Count &gt; 0)
        {
            text.AppendLine(&quot;**DISCREPANCIES NOTED**&quot;);
            text.AppendLine();
            text.AppendLine(&quot;Part Number\tPacklist Qty\tReceived Qty\tDifference\tNote&quot;);
            text.AppendLine(new string(&apos;-&apos;, 80));
            foreach (var disc in emailData.Discrepancies)
            {
                string diffStr = disc.Difference &gt; 0 ? $&quot;+{disc.Difference}&quot; : disc.Difference.ToString();
                text.AppendLine($&quot;{disc.PartNumber}\t{disc.PacklistQty}\t{disc.ReceivedQty}\t{diffStr}\t{disc.Note}&quot;);
            }
            text.AppendLine();
        }

        text.AppendLine(&quot;Requested Lines:&quot;);
        text.AppendLine();
        text.AppendLine(&quot;Part Number\tQuantity (pcs)&quot;);
        text.AppendLine(new string(&apos;-&apos;, 40));
        foreach (var kvp in emailData.RequestedLines.OrderBy(x =&gt; x.Key))
        {
            text.AppendLine($&quot;{kvp.Key}\t{kvp.Value}&quot;);
        }
        text.AppendLine();

        if (!string.IsNullOrWhiteSpace(emailData.AdditionalNotes))
        {
            text.AppendLine(&quot;Additional Notes:&quot;);
            text.AppendLine(emailData.AdditionalNotes);
            text.AppendLine();
        }

        text.AppendLine(emailData.Signature);
        return text.ToString();
    }

    [RelayCommand]
    private void ViewHistory()
    {
        _logger.LogInfo(&quot;Navigating to Volvo Shipment History&quot;);
        if (App.MainWindow is MainWindow mainWindow)
        {
            var contentFrame = mainWindow.GetContentFrame();
            contentFrame?.Navigate(typeof(Views.View_Volvo_History));
        }
    }

    [RelayCommand]
    private async Task SaveAsPendingAsync()
    {
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Saving shipment...&quot;;

            var result = await SaveShipmentInternalAsync();
            if (result.IsSuccess)
            {
                SuccessMessage = $&quot;Shipment #{result.Data.ShipmentNumber} saved as pending PO&quot;;
                IsSuccessMessageVisible = true;
                HasPendingShipment = true;
                StatusMessage = &quot;Shipment saved&quot;;
            }
            else
            {
                await _errorHandler.HandleErrorAsync(
                    result.ErrorMessage ?? &quot;Failed to save shipment&quot;,
                    Enum_ErrorSeverity.Medium,
                    null,
                    true);
            }
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error saving shipment: {ex.Message}&quot;, ex);
            await _errorHandler.HandleErrorAsync(
                &quot;Error saving shipment&quot;,
                Enum_ErrorSeverity.Medium,
                ex,
                true);
        }
        finally
        {
            IsBusy = false;
        }
    }

    private async Task&lt;Model_Dao_Result&lt;(int ShipmentId, int ShipmentNumber)&gt;&gt; SaveShipmentInternalAsync()
    {
        // Validate
        if (!ValidateShipment())
        {
            return Model_Dao_Result_Factory.Failure&lt;(int ShipmentId, int ShipmentNumber)&gt;(&quot;Shipment validation failed&quot;);
        }

        // Build shipment object
        var shipment = new Model_VolvoShipment
        {
            ShipmentDate = ShipmentDate?.DateTime ?? DateTime.Today,
            ShipmentNumber = ShipmentNumber,
            Notes = Notes,
            Status = VolvoShipmentStatus.PendingPo,
            EmployeeNumber = _sessionManager.CurrentSession?.User?.EmployeeNumber.ToString() ?? &quot;0&quot;
        };

        // Save
        var saveResult = await _volvoService.SaveShipmentAsync(shipment, Parts.ToList());

        // Check if there&apos;s an existing pending shipment
        if (!saveResult.IsSuccess &amp;&amp; saveResult.ErrorMessage.StartsWith(&quot;PENDING_EXISTS&quot;))
        {
            var parts = saveResult.ErrorMessage.Split(&apos;|&apos;);
            var existingShipmentNumber = parts.Length &gt; 1 ? parts[1] : &quot;Unknown&quot;;
            var existingShipmentDate = parts.Length &gt; 2 ? parts[2] : &quot;Unknown Date&quot;;

            // Show confirmation dialog
            var dialog = new ContentDialog
            {
                Title = &quot;Overwrite Pending Shipment?&quot;,
                Content = $&quot;A pending shipment already exists (Shipment #{existingShipmentNumber} from {existingShipmentDate}).{Environment.NewLine}{Environment.NewLine}Do you want to delete it and create a new one?&quot;,
                PrimaryButtonText = &quot;Overwrite&quot;,
                CloseButtonText = &quot;Cancel&quot;,
                DefaultButton = ContentDialogButton.Close,
                XamlRoot = App.MainWindow?.Content?.XamlRoot
            };

            var result = await dialog.ShowAsync();

            if (result == ContentDialogResult.Primary)
            {
                // User confirmed - delete existing and save new
                await _logger.LogInfoAsync($&quot;User confirmed overwrite of pending shipment #{existingShipmentNumber}&quot;);
                return await _volvoService.SaveShipmentAsync(shipment, Parts.ToList(), overwriteExisting: true);
            }
            else
            {
                // User canceled
                await _logger.LogInfoAsync(&quot;User canceled shipment overwrite&quot;);
                return Model_Dao_Result_Factory.Failure&lt;(int ShipmentId, int ShipmentNumber)&gt;(&quot;Shipment save canceled by user&quot;);
            }
        }

        return saveResult;
    }

    [RelayCommand]
    private async Task CompleteShipmentAsync()
    {
        // This will be used when completing a pending shipment with PO/Receiver numbers
        try
        {
            IsBusy = true;
            StatusMessage = &quot;Completing shipment...&quot;;

            var pendingResult = await _volvoService.GetPendingShipmentAsync();
            if (!pendingResult.IsSuccess || pendingResult.Data == null)
            {
                await _errorHandler.HandleErrorAsync(
                    &quot;No pending shipment found&quot;,
                    Enum_ErrorSeverity.Medium,
                    null,
                    true);
                return;
            }

            // Show completion dialog
            await ShowCompletionDialogAsync(pendingResult.Data);
        }
        catch (Exception ex)
        {
            await _logger.LogErrorAsync($&quot;Error completing shipment: {ex.Message}&quot;, ex);
            await _errorHandler.HandleErrorAsync(
                &quot;Error completing shipment&quot;,
                Enum_ErrorSeverity.Medium,
                ex,
                true);
        }
        finally
        {
            IsBusy = false;
        }
    }

    private async Task ShowCompletionDialogAsync(Model_VolvoShipment shipment)
    {
        var xamlRoot = _windowService.GetXamlRoot();
        if (xamlRoot == null)
        {
            return;
        }

        var dialog = new ContentDialog
        {
            Title = $&quot;Complete Shipment #{shipment.ShipmentNumber}&quot;,
            PrimaryButtonText = &quot;Complete&quot;,
            CloseButtonText = &quot;Cancel&quot;,
            DefaultButton = ContentDialogButton.Primary,
            XamlRoot = xamlRoot
        };

        var stackPanel = new StackPanel { Spacing = 12 };

        var poTextBox = new TextBox
        {
            Header = &quot;PO Number&quot;,
            PlaceholderText = &quot;Enter PO number (e.g., PO-062450)&quot;
        };

        var receiverTextBox = new TextBox
        {
            Header = &quot;Receiver Number&quot;,
            PlaceholderText = &quot;Enter receiver number (e.g., 134393)&quot;
        };

        stackPanel.Children.Add(poTextBox);
        stackPanel.Children.Add(receiverTextBox);
        dialog.Content = stackPanel;

        var result = await dialog.ShowAsync();

        if (result == ContentDialogResult.Primary)
        {
            if (string.IsNullOrWhiteSpace(poTextBox.Text) || string.IsNullOrWhiteSpace(receiverTextBox.Text))
            {
                await _errorHandler.HandleErrorAsync(
                    &quot;PO Number and Receiver Number are required&quot;,
                    Enum_ErrorSeverity.Low,
                    null,
                    true);
                return;
            }

            var completeResult = await _volvoService.CompleteShipmentAsync(
                shipment.Id,
                poTextBox.Text.Trim(),
                receiverTextBox.Text.Trim());

            if (completeResult.IsSuccess)
            {
                SuccessMessage = &quot;Shipment completed successfully!&quot;;
                IsSuccessMessageVisible = true;
                HasPendingShipment = false;

                // Clear the form
                ClearShipmentForm();
            }
            else
            {
                await _errorHandler.HandleErrorAsync(
                    completeResult.ErrorMessage ?? &quot;Failed to complete shipment&quot;,
                    Enum_ErrorSeverity.Medium,
                    null,
                    true);
            }
        }
    }

    [RelayCommand]
    private void StartNewEntry()
    {
        IsSuccessMessageVisible = false;
        SuccessMessage = string.Empty;
        HasPendingShipment = false;
        ClearShipmentForm();
    }

    #endregion

    #region Validation

    private bool ValidateShipment()
    {
        if (Parts.Count == 0)
        {
            _errorHandler.HandleErrorAsync(
                &quot;At least one part is required&quot;,
                Enum_ErrorSeverity.Low,
                null,
                true).ConfigureAwait(false);
            return false;
        }

        foreach (var part in Parts)
        {
            if (string.IsNullOrWhiteSpace(part.PartNumber))
            {
                _errorHandler.HandleErrorAsync(
                    &quot;All parts must have a part number selected&quot;,
                    Enum_ErrorSeverity.Low,
                    null,
                    true).ConfigureAwait(false);
                return false;
            }

            if (part.ReceivedSkidCount &lt;= 0)
            {
                _errorHandler.HandleErrorAsync(
                    $&quot;Part {part.PartNumber} must have at least 1 skid&quot;,
                    Enum_ErrorSeverity.Low,
                    null,
                    true).ConfigureAwait(false);
                return false;
            }

            if (part.HasDiscrepancy &amp;&amp; !part.ExpectedSkidCount.HasValue)
            {
                _errorHandler.HandleErrorAsync(
                    $&quot;Part {part.PartNumber} has discrepancy but no expected skid count&quot;,
                    Enum_ErrorSeverity.Low,
                    null,
                    true).ConfigureAwait(false);
                return false;
            }
        }

        return true;
    }

    /// &lt;summary&gt;
    /// Formats JSON array of recipients into Outlook format
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;jsonValue&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;fallbackValue&quot;&gt;&lt;/param&gt;
    private string FormatRecipientsFromJson(string? jsonValue, string fallbackValue)
    {
        if (string.IsNullOrWhiteSpace(jsonValue))
        {
            return fallbackValue;
        }

        try
        {
            var recipients = System.Text.Json.JsonSerializer.Deserialize&lt;List&lt;Models.Model_EmailRecipient&gt;&gt;(jsonValue);
            if (recipients == null || recipients.Count == 0)
            {
                return fallbackValue;
            }

            return string.Join(&quot;; &quot;, recipients.Select(r =&gt; r.ToOutlookFormat()));
        }
        catch (Exception ex)
        {
            _logger.LogErrorAsync($&quot;Error parsing email recipients JSON: {ex.Message}&quot;, ex).ConfigureAwait(false);
            return fallbackValue;
        }
    }

    private void ValidateSaveEligibility()
    {
        CanSave = Parts.Count &gt; 0 &amp;&amp; Parts.All(p =&gt; !string.IsNullOrWhiteSpace(p.PartNumber) &amp;&amp; p.ReceivedSkidCount &gt; 0);
    }

    #endregion

    #region Event Handlers

    partial void OnPartsChanged(ObservableCollection&lt;Model_VolvoShipmentLine&gt; value)
    {
        ValidateSaveEligibility();
    }

    partial void OnSelectedPartToAddChanged(Model_VolvoPart? value)
    {
        AddPartCommand.NotifyCanExecuteChanged();
    }

    partial void OnReceivedSkidsToAddChanged(int value)
    {
        AddPartCommand.NotifyCanExecuteChanged();
    }

    #endregion

    #region Helper Methods

    /// &lt;summary&gt;
    /// Clears all shipment form fields and resets to default state
    /// Extracted to avoid code duplication
    /// &lt;/summary&gt;
    private void ClearShipmentForm()
    {
        Parts.Clear();
        Notes = string.Empty;
        ShipmentNumber = 1;
        SelectedPartToAdd = null;
        ReceivedSkidsToAdd = 0;
        PartSearchText = string.Empty;
        SuggestedParts.Clear();
    }

    #endregion
}</file><file path="MainWindow.xaml.cs">using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using System;

namespace MTM_Receiving_Application
{
    /// &lt;summary&gt;
    /// An empty window that can be used on its own or navigated to within a Frame.
    /// &lt;/summary&gt;
    public sealed partial class MainWindow : Window
    {
        public ViewModel_Shared_MainWindow ViewModel { get; }
        private readonly IService_UserSessionManager _sessionManager;
        private readonly IService_LoggingUtility _logger;
        private bool _hasNavigatedOnStartup = false;

        /// &lt;summary&gt;
        /// Gets the main content frame for navigation
        /// &lt;/summary&gt;
        public Frame GetContentFrame() =&gt; ContentFrame;

        public MainWindow(
            ViewModel_Shared_MainWindow viewModel,
            IService_UserSessionManager sessionManager,
            IService_LoggingUtility logger)
        {
            InitializeComponent();
            ViewModel = viewModel;
            _sessionManager = sessionManager;
            _logger = logger;

            // Set initial window size (1450x900 to accommodate wide data grids and toolbars)
            AppWindow.Resize(new Windows.Graphics.SizeInt32(1450, 900));

            // Center window on screen
            CenterWindow();

            // Configure title bar to blend with UI (drag region will be set on first activation)
            ConfigureTitleBar();

            // Set user display from current session
            if (_sessionManager.CurrentSession?.User != null)
            {
                var user = _sessionManager.CurrentSession.User;
                UserDisplayTextBlock.Text = user.DisplayName;
                UserPicture.DisplayName = user.DisplayName;
            }

            // Wire up activity tracking
            if (Content is UIElement rootElement)
            {
                rootElement.PointerMoved += (s, e) =&gt; _sessionManager.UpdateLastActivity();
                rootElement.KeyDown += (s, e) =&gt; _sessionManager.UpdateLastActivity();
            }

            this.Activated += MainWindow_Activated;
            this.Closed += MainWindow_Closed;

            // Subscribe to navigation events once
            ContentFrame.Navigated += ContentFrame_Navigated;

            // Show development tools in debug builds
#if DEBUG
            DatabaseTestMenuItem.Visibility = Visibility.Visible;
#endif
        }

        private void MainWindow_Closed(object sender, WindowEventArgs args)
        {
            // Ensure the application process terminates when the main window is closed
            Application.Current.Exit();
        }

        private void MainWindow_Activated(object sender, WindowActivatedEventArgs args)
        {
            if (args.WindowActivationState != WindowActivationState.Deactivated)
            {
                _sessionManager.UpdateLastActivity();

                // Set title bar drag region on first activation (XamlRoot will be available)
                SetTitleBarDragRegion();

                // Navigate to Receiving workflow on first activation
                if (!_hasNavigatedOnStartup)
                {
                    _hasNavigatedOnStartup = true;
                    // Title will be set by ContentFrame_Navigated
                    ContentFrame.Navigate(typeof(Module_Receiving.Views.View_Receiving_Workflow));
                }
            }
        }

        private void NavView_SelectionChanged(NavigationView sender, NavigationViewSelectionChangedEventArgs args)
        {
            if (args.IsSettingsSelected)
            {
                PageTitleTextBlock.Text = &quot;Settings&quot;;
                // TODO: Restore when Settings Views are implemented
                // ContentFrame.Navigate(typeof(Module_Settings.Views.View_Settings_Workflow));
            }
            else if (args.SelectedItem is NavigationViewItem item)
            {
                var tag = item.Tag?.ToString();
                switch (tag)
                {
                    case &quot;ReceivingWorkflowView&quot;:
                        // Title will be set by ContentFrame_Navigated
                        ContentFrame.Navigate(typeof(Module_Receiving.Views.View_Receiving_Workflow));
                        break;
                    case &quot;DunnageLabelPage&quot;:
                        // Title will be set by ContentFrame_Navigated
                        ContentFrame.Navigate(typeof(Module_Dunnage.Views.View_Dunnage_WorkflowView));
                        break;
                    case &quot;RoutingLabelPage&quot;:
                        // Title will be set by ContentFrame_Navigated
                        ContentFrame.Navigate(typeof(Module_Routing.Views.RoutingModeSelectionView));
                        break;
                    case &quot;VolvoShipmentEntry&quot;:
                        PageTitleTextBlock.Text = &quot;Volvo Dunnage Requisition&quot;;
                        ContentFrame.Navigate(typeof(Module_Volvo.Views.View_Volvo_ShipmentEntry));
                        break;
                    case &quot;VolvoHistory&quot;:
                        PageTitleTextBlock.Text = &quot;Volvo Shipment History&quot;;
                        ContentFrame.Navigate(typeof(Module_Volvo.Views.View_Volvo_History));
                        break;
                    case &quot;ReportingMainPage&quot;:
                        PageTitleTextBlock.Text = &quot;End of Day Reports&quot;;
                        ContentFrame.Navigate(typeof(Module_Reporting.Views.View_Reporting_Main));
                        break;
                    case &quot;DatabaseTestView&quot;:
                        try
                        {
                            _logger.LogInfo(&quot;Navigating to Settings Database Test view&quot;, &quot;MainWindow&quot;);

                            // Defensive checks
                            if (ContentFrame == null)
                            {
                                _logger.LogError(&quot;ContentFrame is null - cannot navigate&quot;, null, &quot;MainWindow&quot;);
                                throw new InvalidOperationException(&quot;ContentFrame is null&quot;);
                            }

                            _logger.LogInfo($&quot;ContentFrame state: IsLoaded={ContentFrame.IsLoaded}, BackStackDepth={ContentFrame.BackStackDepth}&quot;, &quot;MainWindow&quot;);

                            var viewType = typeof(Module_Settings.Views.View_Settings_DatabaseTest);
                            _logger.LogInfo($&quot;View type: {viewType.FullName}&quot;, &quot;MainWindow&quot;);

                            PageTitleTextBlock.Text = &quot;Settings Database Test&quot;;

                            // Try navigation with detailed logging
                            _logger.LogInfo(&quot;Calling ContentFrame.Navigate()&quot;, &quot;MainWindow&quot;);
                            var navigated = ContentFrame.Navigate(viewType);
                            _logger.LogInfo($&quot;Navigation result: {navigated}&quot;, &quot;MainWindow&quot;);

                            if (!navigated)
                            {
                                _logger.LogError(&quot;Navigation returned false&quot;, null, &quot;MainWindow&quot;);
                            }
                            else
                            {
                                _logger.LogInfo(&quot;Successfully navigated to Settings Database Test view&quot;, &quot;MainWindow&quot;);
                            }
                        }
                        catch (Exception ex)
                        {
                            _logger.LogError($&quot;Failed to navigate to Settings Database Test view: {ex.Message}&quot;, ex, &quot;MainWindow&quot;);

                            // Build detailed error message
                            var errorDetails = new System.Text.StringBuilder();
                            errorDetails.AppendLine(&quot;Failed to load Settings Database Test view:&quot;);
                            errorDetails.AppendLine();
                            errorDetails.AppendLine($&quot;Error Type: {ex.GetType().FullName}&quot;);
                            errorDetails.AppendLine($&quot;Message: {ex.Message}&quot;);
                            errorDetails.AppendLine();
                            errorDetails.AppendLine(&quot;Stack Trace:&quot;);
                            errorDetails.AppendLine(ex.StackTrace ?? &quot;No stack trace available&quot;);

                            // Add inner exception details if present
                            if (ex.InnerException != null)
                            {
                                errorDetails.AppendLine();
                                errorDetails.AppendLine(&quot;Inner Exception:&quot;);
                                errorDetails.AppendLine($&quot;Type: {ex.InnerException.GetType().FullName}&quot;);
                                errorDetails.AppendLine($&quot;Message: {ex.InnerException.Message}&quot;);
                                errorDetails.AppendLine($&quot;Stack: {ex.InnerException.StackTrace ?? &quot;No stack trace&quot;}&quot;);
                            }

                            // Show detailed error to user in scrollable view
                            var scrollViewer = new ScrollViewer
                            {
                                Content = new TextBlock
                                {
                                    Text = errorDetails.ToString(),
                                    TextWrapping = TextWrapping.Wrap,
                                    FontFamily = new Microsoft.UI.Xaml.Media.FontFamily(&quot;Consolas&quot;),
                                    FontSize = 12,
                                    IsTextSelectionEnabled = true
                                },
                                MaxHeight = 500,
                                VerticalScrollBarVisibility = ScrollBarVisibility.Auto
                            };

                            var errorDialog = new ContentDialog
                            {
                                Title = &quot;Navigation Error - Detailed Information&quot;,
                                Content = scrollViewer,
                                CloseButtonText = &quot;OK&quot;,
                                XamlRoot = this.Content.XamlRoot
                            };
                            _ = errorDialog.ShowAsync();
                        }
                        break;

                }
            }
        }

        private void ContentFrame_Navigated(object sender, Microsoft.UI.Xaml.Navigation.NavigationEventArgs e)
        {
            // If navigated to ReceivingWorkflowView, subscribe to ViewModel changes to update header
            if (ContentFrame.Content is Module_Receiving.Views.View_Receiving_Workflow receivingView)
            {
                var viewModel = receivingView.ViewModel;
                if (viewModel != null)
                {
                    // Update header with current step title (ensure UI thread)
                    DispatcherQueue.TryEnqueue(() =&gt;
                    {
                        PageTitleTextBlock.Text = viewModel.CurrentStepTitle;
                    });

                    // Subscribe to property changes to keep header updated
                    viewModel.PropertyChanged += (s, args) =&gt;
                    {
                        if (args.PropertyName == nameof(viewModel.CurrentStepTitle))
                        {
                            // Ensure UI update happens on UI thread
                            DispatcherQueue.TryEnqueue(() =&gt;
                            {
                                PageTitleTextBlock.Text = viewModel.CurrentStepTitle;
                            });
                        }
                    };
                }
            }
            // If navigated to DunnageWorkflowView, subscribe to ViewModel changes to update header
            else if (ContentFrame.Content is Module_Dunnage.Views.View_Dunnage_WorkflowView dunnageView)
            {
                var viewModel = dunnageView.ViewModel;
                if (viewModel != null)
                {
                    // Update header with current step title (ensure UI thread)
                    DispatcherQueue.TryEnqueue(() =&gt;
                    {
                        PageTitleTextBlock.Text = viewModel.CurrentStepTitle;
                    });

                    // Subscribe to property changes to keep header updated
                    viewModel.PropertyChanged += (s, args) =&gt;
                    {
                        if (args.PropertyName == nameof(viewModel.CurrentStepTitle))
                        {
                            // Ensure UI update happens on UI thread
                            DispatcherQueue.TryEnqueue(() =&gt;
                            {
                                PageTitleTextBlock.Text = viewModel.CurrentStepTitle;
                            });
                        }
                    };
                }
            }
            // If navigated to RoutingModeSelectionView, set simple title
            else if (ContentFrame.Content is Module_Routing.Views.RoutingModeSelectionView)
            {
                DispatcherQueue.TryEnqueue(() =&gt;
                {
                    PageTitleTextBlock.Text = &quot;Internal Routing&quot;;
                });
            }
            // TODO: Restore when Settings Views are implemented
            /*
            // If navigated to SettingsWorkflowView, subscribe to ViewModel changes to update header
            else if (ContentFrame.Content is Module_Settings.Views.View_Settings_Workflow settingsView)
            {
                var viewModel = settingsView.ViewModel;
                if (viewModel != null)
                {
                    // Update header with current step title (ensure UI thread)
                    DispatcherQueue.TryEnqueue(() =&gt;
                    {
                        PageTitleTextBlock.Text = viewModel.CurrentStepTitle;
                    });

                    // Subscribe to property changes to keep header updated
                    viewModel.PropertyChanged += (s, args) =&gt;
                    {
                        if (args.PropertyName == nameof(viewModel.CurrentStepTitle))
                        {
                            // Ensure UI update happens on UI thread
                            DispatcherQueue.TryEnqueue(() =&gt;
                            {
                                PageTitleTextBlock.Text = viewModel.CurrentStepTitle;
                            });
                        }
                    };
                }
            }
            */
        }

        /// &lt;summary&gt;
        /// Update user display from current session
        /// Call this after session is created during startup
        /// &lt;/summary&gt;
        public void UpdateUserDisplay()
        {
            if (_sessionManager.CurrentSession?.User != null)
            {
                var user = _sessionManager.CurrentSession.User;
                UserDisplayTextBlock.Text = user.DisplayName;
                UserPicture.DisplayName = user.DisplayName;
            }
        }

        /// &lt;summary&gt;
        /// Center the window on the primary display
        /// &lt;/summary&gt;
        private void CenterWindow()
        {
            var displayArea = Microsoft.UI.Windowing.DisplayArea.Primary;
            var workArea = displayArea.WorkArea;

            var centerX = (workArea.Width - 1450) / 2;
            var centerY = (workArea.Height - 900) / 2;

            AppWindow.Move(new Windows.Graphics.PointInt32(centerX, centerY));
        }

        /// &lt;summary&gt;
        /// Configure title bar to blend with the application UI
        /// &lt;/summary&gt;
        private void ConfigureTitleBar()
        {
            try
            {
                if (AppWindow.TitleBar != null)
                {
                    // Make title bar transparent to blend with Mica backdrop
                    AppWindow.TitleBar.ExtendsContentIntoTitleBar = true;

                    // Set the title bar drag region to the AppTitleBar element
                    AppWindow.TitleBar.PreferredHeightOption = Microsoft.UI.Windowing.TitleBarHeightOption.Tall;

                    // Set button colors to match theme
                    var transparentColor = Windows.UI.Color.FromArgb(0, 0, 0, 0);

                    // Button colors (will use theme colors)
                    AppWindow.TitleBar.ButtonBackgroundColor = transparentColor;
                    AppWindow.TitleBar.ButtonInactiveBackgroundColor = transparentColor;

                    // Foreground colors for buttons
                    var foregroundColor = Windows.UI.Color.FromArgb(255, 255, 255, 255);
                    AppWindow.TitleBar.ButtonForegroundColor = foregroundColor;
                    AppWindow.TitleBar.ButtonHoverForegroundColor = foregroundColor;
                    AppWindow.TitleBar.ButtonPressedForegroundColor = foregroundColor;

                    // Drag region will be set after window loads (in MainWindow_Loaded)
                }
            }
            catch
            {
                // Ignore title bar customization errors
            }
        }

        /// &lt;summary&gt;
        /// Set the drag region for the custom title bar
        /// MUST be called after window is fully loaded (XamlRoot will be available)
        /// &lt;/summary&gt;
        private void SetTitleBarDragRegion()
        {
            try
            {
                if (AppWindow.TitleBar != null &amp;&amp; AppTitleBar != null &amp;&amp; AppTitleBar.XamlRoot != null)
                {
                    // Get the title bar height
                    var scale = AppTitleBar.XamlRoot.RasterizationScale;
                    var titleBarHeight = (int)(AppTitleBar.ActualHeight * scale);

                    // The entire AppTitleBar is draggable
                    var dragRect = new Windows.Graphics.RectInt32
                    {
                        X = 0,
                        Y = 0,
                        Width = (int)(AppTitleBar.ActualWidth * scale),
                        Height = titleBarHeight
                    };

                    AppWindow.TitleBar.SetDragRectangles(new[] { dragRect });
                }
            }
            catch
            {
                // Ignore drag region setup errors
            }
        }
    }
}</file><file path="App.xaml.cs">using System;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;
using Microsoft.UI.Xaml;
using MTM_Receiving_Application.Module_Core.Contracts.Services;
using MTM_Receiving_Application.Module_Core.Services.Database;
using MTM_Receiving_Application.Module_Core.Services.Authentication;
using MTM_Receiving_Application.Module_Receiving.Services;
using MTM_Receiving_Application.Module_Receiving.Contracts;
using MTM_Receiving_Application.Module_Dunnage.Services;
using MTM_Receiving_Application.Module_Dunnage.Contracts;
using MTM_Receiving_Application.Module_Volvo.Services;
using MTM_Receiving_Application.Module_Volvo.Contracts;
using MTM_Receiving_Application.Module_Routing.Services;
using MTM_Receiving_Application.Module_Core.Data.Authentication;
using MTM_Receiving_Application.Module_Receiving.Data;
using MTM_Receiving_Application.Module_Dunnage.Data;
using MTM_Receiving_Application.Module_Routing.Data;
using MTM_Receiving_Application.Module_Volvo.Data;
using MTM_Receiving_Application.Module_Core.Data.InforVisual;
using MTM_Receiving_Application.Module_Core.Helpers.Database;
using MTM_Receiving_Application.Module_Receiving.ViewModels;
using MTM_Receiving_Application.Module_Dunnage.ViewModels;
using MTM_Receiving_Application.Module_Routing.ViewModels;
using MTM_Receiving_Application.Module_Settings.ViewModels;
using MTM_Receiving_Application.Module_Settings.Services;
using MTM_Receiving_Application.Module_Settings.Interfaces;
using MTM_Receiving_Application.Module_Settings.Views;
using MTM_Receiving_Application.Module_Shared.ViewModels;
using MTM_Receiving_Application.Module_Shared.Views;
using MTM_Receiving_Application.Module_Core.Models.Systems;

using MTM_Receiving_Application.Module_Core.Services;

using MTM_Receiving_Application.Module_Core.Services.Startup;
using MTM_Receiving_Application.Module_Core.Services.UI;
using MTM_Receiving_Application.Module_Reporting.Data;
using MTM_Receiving_Application.Module_Reporting.Services;
using MTM_Receiving_Application.Module_Reporting.Contracts;
using MTM_Receiving_Application.Module_Reporting.ViewModels;
using MTM_Receiving_Application.Module_Reporting.Views;
using Microsoft.Extensions.Configuration;
using MediatR;
using FluentValidation;
using Serilog;
using MTM_Receiving_Application.Module_Core.Behaviors;
using System.Reflection;

namespace MTM_Receiving_Application;

/// &lt;summary&gt;
/// Provides application-specific behavior with dependency injection support
/// &lt;/summary&gt;
public partial class App : Application
{
    private readonly IHost _host;

    /// &lt;summary&gt;
    /// Gets the main window for the application
    /// &lt;/summary&gt;
    public static Window? MainWindow { get; internal set; }

    /// &lt;summary&gt;
    /// Initializes the singleton application object and sets up dependency injection
    /// &lt;/summary&gt;
    public App()
    {
        InitializeComponent();

        // Configure Serilog for structured logging
        Log.Logger = new LoggerConfiguration()
            .MinimumLevel.Information()
            .Enrich.WithMachineName()
            .Enrich.WithThreadId()
            .Enrich.WithProperty(&quot;Application&quot;, &quot;MTM_Receiving_Application&quot;)
            .Enrich.WithProperty(&quot;Environment&quot;, &quot;Production&quot;)
            .WriteTo.File(
                &quot;logs/app-.txt&quot;,
                rollingInterval: RollingInterval.Day,
                outputTemplate: &quot;{Timestamp:yyyy-MM-dd HH:mm:ss.fff} [{Level:u3}] [{SourceContext}] [{Properties}] {Message:lj}{NewLine}{Exception}&quot;,
                retainedFileCountLimit: 30)
            .CreateLogger();

        _host = Host.CreateDefaultBuilder()
            .ConfigureServices((context, services) =&gt;
            {
                // ===== CQRS INFRASTRUCTURE (MediatR + Global Pipeline Behaviors) =====
                services.AddMediatR(cfg =&gt;
                {
                    // Register all handlers from this assembly
                    cfg.RegisterServicesFromAssembly(Assembly.GetExecutingAssembly());

                    // Register GLOBAL pipeline behaviors (applied to ALL handlers in ALL modules)
                    cfg.AddBehavior(typeof(IPipelineBehavior&lt;,&gt;), typeof(LoggingBehavior&lt;,&gt;));
                    cfg.AddBehavior(typeof(IPipelineBehavior&lt;,&gt;), typeof(ValidationBehavior&lt;,&gt;));
                    cfg.AddBehavior(typeof(IPipelineBehavior&lt;,&gt;), typeof(AuditBehavior&lt;,&gt;));
                });

                // ===== FLUENTVALIDATION CONFIGURATION (Auto-discovery) =====
                services.AddValidatorsFromAssembly(Assembly.GetExecutingAssembly());

                // ===== CORE SERVICES (Generic Infrastructure) =====
                services.AddSingleton&lt;IService_ErrorHandler, Service_ErrorHandler&gt;();
                services.AddSingleton&lt;IService_LoggingUtility, Service_LoggingUtility&gt;();
                services.AddSingleton&lt;IService_Notification, Service_Notification&gt;();
                services.AddSingleton&lt;IService_Focus, Service_Focus&gt;();

                // Authentication Services
                var mySqlConnectionString = Helper_Database_Variables.GetConnectionString();
                var inforVisualConnectionString = Helper_Database_Variables.GetInforVisualConnectionString();

                services.AddSingleton(sp =&gt; new Dao_User(mySqlConnectionString));

                // Register NEW MySQL DAOs (Singleton - stateless data access)
                services.AddSingleton(sp =&gt; new Dao_ReceivingLoad(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Dao_ReceivingLine(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Dao_PackageTypePreference(mySqlConnectionString));

                // Register Dunnage DAOs (Singleton)
                services.AddSingleton(sp =&gt; new Dao_DunnageLoad(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Dao_DunnageType(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Dao_DunnagePart(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Dao_DunnageSpec(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Dao_InventoriedDunnage(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Dao_DunnageCustomField(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Dao_DunnageUserPreference(mySqlConnectionString));

                // Register NEW Routing Module DAOs (Phase 2 implementation)
                services.AddSingleton(sp =&gt; new Dao_RoutingLabel(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Dao_RoutingRecipient(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Dao_RoutingOtherReason(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Dao_RoutingUsageTracking(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Dao_RoutingUserPreference(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Dao_RoutingLabelHistory(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new MTM_Receiving_Application.Module_Routing.Data.Dao_InforVisualPO(inforVisualConnectionString));

                // Register Volvo DAOs (Singleton)
                services.AddSingleton(sp =&gt; new Dao_VolvoShipment(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Dao_VolvoShipmentLine(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Dao_VolvoPart(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Dao_VolvoPartComponent(mySqlConnectionString));

                // Register Settings DAOs (Singleton)
                services.AddSingleton(sp =&gt; new Module_Settings.Data.Dao_SystemSettings(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Module_Settings.Data.Dao_UserSettings(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Module_Settings.Data.Dao_PackageType(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Module_Settings.Data.Dao_PackageTypeMappings(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Module_Settings.Data.Dao_RoutingRule(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Module_Settings.Data.Dao_ScheduledReport(mySqlConnectionString));
                services.AddSingleton(sp =&gt; new Module_Settings.Data.Dao_SettingsAuditLog(mySqlConnectionString));


                // Register NEW Routing Module Services (Phase 2 implementation)
                services.AddSingleton&lt;IRoutingService&gt;(sp =&gt;
                {
                    var daoLabel = sp.GetRequiredService&lt;Dao_RoutingLabel&gt;();
                    var daoHistory = sp.GetRequiredService&lt;Dao_RoutingLabelHistory&gt;();
                    var inforVisualService = sp.GetRequiredService&lt;IRoutingInforVisualService&gt;();
                    var usageTrackingService = sp.GetRequiredService&lt;IRoutingUsageTrackingService&gt;();
                    var recipientService = sp.GetRequiredService&lt;IRoutingRecipientService&gt;();
                    var logger = sp.GetRequiredService&lt;IService_LoggingUtility&gt;();
                    var configuration = sp.GetRequiredService&lt;Microsoft.Extensions.Configuration.IConfiguration&gt;();
                    return new RoutingService(daoLabel, daoHistory, inforVisualService, usageTrackingService, recipientService, logger, configuration);
                });
                services.AddSingleton&lt;IRoutingInforVisualService&gt;(sp =&gt;
                {
                    var daoInforVisual = sp.GetRequiredService&lt;MTM_Receiving_Application.Module_Routing.Data.Dao_InforVisualPO&gt;();
                    var logger = sp.GetRequiredService&lt;IService_LoggingUtility&gt;();
                    var config = sp.GetRequiredService&lt;Microsoft.Extensions.Configuration.IConfiguration&gt;();
                    var useMockData = config.GetValue&lt;bool&gt;(&quot;AppSettings:UseInforVisualMockData&quot;);
                    return new RoutingInforVisualService(daoInforVisual, logger, useMockData);
                });
                services.AddSingleton&lt;IRoutingRecipientService&gt;(sp =&gt;
                {
                    var daoRecipient = sp.GetRequiredService&lt;Dao_RoutingRecipient&gt;();
                    var logger = sp.GetRequiredService&lt;IService_LoggingUtility&gt;();
                    return new RoutingRecipientService(daoRecipient, logger);
                });
                services.AddSingleton&lt;IRoutingUsageTrackingService&gt;(sp =&gt;
                {
                    var daoUsageTracking = sp.GetRequiredService&lt;Dao_RoutingUsageTracking&gt;();
                    var logger = sp.GetRequiredService&lt;IService_LoggingUtility&gt;();
                    return new RoutingUsageTrackingService(daoUsageTracking, logger);
                });
                services.AddSingleton&lt;IRoutingUserPreferenceService&gt;(sp =&gt;
                {
                    var daoUserPreference = sp.GetRequiredService&lt;Dao_RoutingUserPreference&gt;();
                    var logger = sp.GetRequiredService&lt;IService_LoggingUtility&gt;();
                    return new RoutingUserPreferenceService(daoUserPreference, logger);
                });

                // Register NEW Infor Visual DAOs (READ-ONLY)
                services.AddSingleton(sp =&gt;
                {
                    return new MTM_Receiving_Application.Module_Routing.Data.Dao_InforVisualPO(inforVisualConnectionString);
                });
                services.AddSingleton(sp =&gt;
                {
                    var logger = sp.GetService&lt;IService_LoggingUtility&gt;();
                    return new Dao_InforVisualPart(inforVisualConnectionString, logger);
                });
                services.AddSingleton&lt;IService_Dispatcher&gt;(sp =&gt;
                {
                    var dispatcherQueue = Microsoft.UI.Dispatching.DispatcherQueue.GetForCurrentThread();
                    return new Service_Dispatcher(dispatcherQueue);
                });
                services.AddSingleton&lt;IService_Window, Service_Window&gt;();
                services.AddSingleton&lt;IService_Help, Module_Core.Services.Help.Service_Help&gt;();
                services.AddSingleton&lt;IService_Authentication&gt;(sp =&gt;
                {
                    var daoUser = sp.GetRequiredService&lt;Dao_User&gt;();
                    var errorHandler = sp.GetRequiredService&lt;IService_ErrorHandler&gt;();
                    return new Service_Authentication(daoUser, errorHandler);
                });
                services.AddSingleton&lt;IService_UserSessionManager&gt;(sp =&gt;
                {
                    var daoUser = sp.GetRequiredService&lt;Dao_User&gt;();
                    var dispatcherService = sp.GetRequiredService&lt;IService_Dispatcher&gt;();
                    return new Service_UserSessionManager(daoUser, dispatcherService);
                });
                services.AddTransient&lt;IService_UserPreferences, Service_UserPreferences&gt;();

                // Startup Service
                services.AddTransient&lt;IService_OnStartup_AppLifecycle, Service_OnStartup_AppLifecycle&gt;();

                // NEW: Infor Visual Connection Service with mock data support
                services.AddSingleton(sp =&gt;
                {
                    var logger = sp.GetService&lt;IService_LoggingUtility&gt;();
                    return new Dao_InforVisualConnection(
                        Helper_Database_Variables.GetInforVisualConnectionString(), logger);
                });
                services.AddSingleton&lt;IService_InforVisual&gt;(sp =&gt;
                {
                    var dao = sp.GetRequiredService&lt;Dao_InforVisualConnection&gt;();
                    var logger = sp.GetService&lt;IService_LoggingUtility&gt;();
                    var config = sp.GetRequiredService&lt;Microsoft.Extensions.Configuration.IConfiguration&gt;();
                    var useMockData = config.GetValue&lt;bool&gt;(&quot;AppSettings:UseInforVisualMockData&quot;);
                    return new Service_InforVisualConnect(dao, useMockData, logger);
                });

                // Receiving Workflow Services (003-database-foundation)
                services.AddSingleton&lt;IService_MySQL_Receiving&gt;(sp =&gt; { var logger = sp.GetRequiredService&lt;IService_LoggingUtility&gt;(); return new Service_MySQL_Receiving(Helper_Database_Variables.GetConnectionString(), logger); });
                services.AddTransient&lt;IService_MySQL_ReceivingLine, Service_MySQL_ReceivingLine&gt;();
                services.AddSingleton&lt;IService_MySQL_PackagePreferences&gt;(sp =&gt; new Service_MySQL_PackagePreferences(Helper_Database_Variables.GetConnectionString()));
                services.AddSingleton&lt;IService_SessionManager&gt;(sp =&gt; { var logger = sp.GetRequiredService&lt;IService_LoggingUtility&gt;(); return new Service_SessionManager(logger); });
                services.AddSingleton&lt;IService_CSVWriter&gt;(sp =&gt; { var sessionManager = sp.GetRequiredService&lt;IService_UserSessionManager&gt;(); var logger = sp.GetRequiredService&lt;IService_LoggingUtility&gt;(); return new Service_CSVWriter(sessionManager, logger); });
                services.AddSingleton&lt;IService_ReceivingValidation, Service_ReceivingValidation&gt;();
                services.AddSingleton&lt;IService_ReceivingWorkflow, Service_ReceivingWorkflow&gt;();
                services.AddTransient&lt;IService_Pagination, Service_Pagination&gt;();

                // Dunnage Services (006-dunnage-services)
                services.AddTransient&lt;IService_MySQL_Dunnage, Service_MySQL_Dunnage&gt;();
                services.AddTransient&lt;IService_DunnageCSVWriter, Service_DunnageCSVWriter&gt;();
                services.AddSingleton&lt;IService_DunnageWorkflow, Service_DunnageWorkflow&gt;();
                services.AddSingleton&lt;IService_DunnageAdminWorkflow, Service_DunnageAdminWorkflow&gt;();

                // Volvo Services (002-volvo-module)
                services.AddSingleton&lt;IService_VolvoAuthorization&gt;(sp =&gt;
                {
                    var logger = sp.GetRequiredService&lt;IService_LoggingUtility&gt;();
                    return new Service_VolvoAuthorization(logger);
                });
                services.AddSingleton&lt;IService_Volvo&gt;(sp =&gt;
                {
                    var shipmentDao = sp.GetRequiredService&lt;Dao_VolvoShipment&gt;();
                    var lineDao = sp.GetRequiredService&lt;Dao_VolvoShipmentLine&gt;();
                    var partDao = sp.GetRequiredService&lt;Dao_VolvoPart&gt;();
                    var componentDao = sp.GetRequiredService&lt;Dao_VolvoPartComponent&gt;();
                    var logger = sp.GetRequiredService&lt;IService_LoggingUtility&gt;();
                    var authService = sp.GetRequiredService&lt;IService_VolvoAuthorization&gt;();
                    return new Service_Volvo(shipmentDao, lineDao, partDao, componentDao, logger, authService);
                });
                services.AddSingleton&lt;IService_VolvoMasterData&gt;(sp =&gt;
                {
                    var partDao = sp.GetRequiredService&lt;Dao_VolvoPart&gt;();
                    var componentDao = sp.GetRequiredService&lt;Dao_VolvoPartComponent&gt;();
                    var logger = sp.GetRequiredService&lt;IService_LoggingUtility&gt;();
                    var errorHandler = sp.GetRequiredService&lt;IService_ErrorHandler&gt;();
                    return new Service_VolvoMasterData(partDao, componentDao, logger, errorHandler);
                });

                // Reporting Services (003-reporting-module)
                services.AddSingleton(sp =&gt; new Dao_Reporting(mySqlConnectionString));
                services.AddSingleton&lt;IService_Reporting&gt;(sp =&gt;
                {
                    var dao = sp.GetRequiredService&lt;Dao_Reporting&gt;();
                    var logger = sp.GetRequiredService&lt;IService_LoggingUtility&gt;();
                    return new Service_Reporting(dao, logger);
                });

                // Settings Services
                services.AddSingleton&lt;IService_SettingsWorkflow, Service_SettingsWorkflow&gt;();
                services.AddSingleton&lt;Module_Core.Contracts.Services.Navigation.IService_Navigation, Module_Core.Services.Navigation.Service_Navigation&gt;();
                services.AddSingleton&lt;IService_ViewModelRegistry, Service_ViewModelRegistry&gt;();

                // ViewModels
                services.AddTransient&lt;ViewModel_Shared_MainWindow&gt;();
                services.AddTransient&lt;ViewModel_Shared_SplashScreen&gt;();
                services.AddTransient&lt;ViewModel_Shared_SharedTerminalLogin&gt;();
                services.AddTransient&lt;ViewModel_Shared_NewUserSetup&gt;();
                services.AddTransient&lt;ViewModel_Shared_HelpDialog&gt;();
                services.AddTransient&lt;ViewModel_Dunnage_WorkFlowViewModel&gt;();

                // Receiving Workflow ViewModels
                services.AddTransient&lt;ViewModel_Receiving_Workflow&gt;();
                services.AddTransient&lt;ViewModel_Receiving_ModeSelection&gt;();
                services.AddTransient&lt;ViewModel_Receiving_ManualEntry&gt;();
                services.AddTransient&lt;ViewModel_Receiving_EditMode&gt;();
                services.AddTransient&lt;ViewModel_Receiving_POEntry&gt;();
                services.AddTransient&lt;ViewModel_Receiving_LoadEntry&gt;();
                services.AddTransient&lt;ViewModel_Receiving_WeightQuantity&gt;();
                services.AddTransient&lt;ViewModel_Receiving_HeatLot&gt;();
                services.AddTransient&lt;ViewModel_Receiving_PackageType&gt;();
                services.AddTransient&lt;ViewModel_Receiving_Review&gt;();

                // Dunnage Workflow ViewModels
                services.AddTransient&lt;ViewModel_Dunnage_ModeSelection&gt;();
                services.AddTransient&lt;ViewModel_dunnage_typeselection&gt;();
                services.AddTransient&lt;ViewModel_Dunnage_PartSelection&gt;();
                services.AddTransient&lt;ViewModel_Dunnage_QuantityEntry&gt;();
                services.AddTransient&lt;ViewModel_Dunnage_DetailsEntry&gt;();
                services.AddTransient&lt;ViewModel_Dunnage_Review&gt;();
                services.AddTransient&lt;ViewModel_Dunnage_ManualEntry&gt;();
                services.AddTransient&lt;ViewModel_Dunnage_EditMode&gt;();
                services.AddTransient&lt;ViewModel_Dunnage_AdminMain&gt;();
                services.AddTransient&lt;ViewModel_Dunnage_AdminTypes&gt;();
                services.AddTransient&lt;ViewModel_Dunnage_AdminParts&gt;();
                services.AddTransient&lt;ViewModel_Dunnage_AdminInventory&gt;();
                services.AddTransient&lt;ViewModel_Dunnage_AddTypeDialog&gt;();

                // Volvo Workflow ViewModels
                services.AddTransient&lt;Module_Volvo.ViewModels.ViewModel_Volvo_ShipmentEntry&gt;();
                services.AddTransient&lt;Module_Volvo.ViewModels.ViewModel_Volvo_Settings&gt;();
                services.AddTransient&lt;Module_Volvo.ViewModels.ViewModel_Volvo_History&gt;();

                services.AddTransient&lt;Module_Settings.ViewModels.ViewModel_Settings_DatabaseTest&gt;();

                // Routing Workflow ViewModels
                services.AddSingleton&lt;RoutingWizardContainerViewModel&gt;();
                services.AddTransient&lt;RoutingWizardStep1ViewModel&gt;();
                services.AddTransient&lt;RoutingWizardStep2ViewModel&gt;();
                services.AddTransient&lt;RoutingWizardStep3ViewModel&gt;();

                // Routing Manual Entry ViewModel (Phase 4 implementation)
                services.AddTransient&lt;RoutingManualEntryViewModel&gt;();

                // Routing Edit Mode ViewModel (Phase 5 implementation)
                services.AddTransient&lt;RoutingEditModeViewModel&gt;();

                // Routing Mode Selection ViewModel (Phase 6 implementation)
                services.AddTransient&lt;RoutingModeSelectionViewModel&gt;();

                // Reporting ViewModels (003-reporting-module)
                services.AddTransient&lt;ViewModel_Reporting_Main&gt;();

                // Views
                //services.AddTransient&lt;Main_ReceivingLabelPage&gt;();
                //services.AddTransient&lt;Main_DunnageLabelPage&gt;();
                //services.AddTransient&lt;Main_CarrierDeliveryLabelPage&gt;();

                // NEW Routing Wizard Views (Phase 3 implementation)
                services.AddTransient&lt;Module_Routing.Views.RoutingWizardContainerView&gt;();
                services.AddTransient&lt;Module_Routing.Views.RoutingWizardStep1View&gt;();
                services.AddTransient&lt;Module_Routing.Views.RoutingWizardStep2View&gt;();
                services.AddTransient&lt;Module_Routing.Views.RoutingWizardStep3View&gt;();

                // Routing Manual Entry View (Phase 4 implementation)
                services.AddTransient&lt;Module_Routing.Views.RoutingManualEntryView&gt;();

                // Routing Edit Mode View (Phase 5 implementation)
                services.AddTransient&lt;Module_Routing.Views.RoutingEditModeView&gt;();

                // Routing Mode Selection View (Phase 6 implementation)
                services.AddTransient&lt;Module_Routing.Views.RoutingModeSelectionView&gt;();

                // Settings Views - TODO: Re-add when implemented
                /*
                services.AddTransient&lt;View_Settings_Workflow&gt;();
                services.AddTransient&lt;View_Settings_ModeSelection&gt;();
                services.AddTransient&lt;View_Settings_DunnageMode&gt;();
                services.AddTransient&lt;View_Settings_Placeholder&gt;();
                */

                // Reporting Views (003-reporting-module)
                services.AddTransient&lt;View_Reporting_Main&gt;();

                // Dunnage Admin Views
                services.AddTransient&lt;Module_Dunnage.Views.View_Dunnage_AdminMainView&gt;();
                services.AddTransient&lt;Module_Dunnage.Views.View_Dunnage_AdminTypesView&gt;();
                services.AddTransient&lt;Module_Dunnage.Views.View_Dunnage_AdminPartsView&gt;();
                services.AddTransient&lt;Module_Dunnage.Views.View_Dunnage_AdminInventoryView&gt;();

                // Dunnage Dialogs
                services.AddTransient&lt;Module_Dunnage.Views.View_Dunnage_Dialog_AddToInventoriedListDialog&gt;();

                // Volvo Views
                services.AddTransient&lt;Module_Volvo.Views.View_Volvo_ShipmentEntry&gt;();
                services.AddTransient&lt;Module_Volvo.Views.View_Volvo_Settings&gt;();

                // Windows
                services.AddTransient&lt;View_Shared_SplashScreenWindow&gt;();
                services.AddTransient&lt;View_Shared_SharedTerminalLoginDialog&gt;();
                services.AddTransient&lt;View_Shared_NewUserSetupDialog&gt;();
                services.AddTransient&lt;View_Shared_HelpDialog&gt;();
                services.AddSingleton&lt;MainWindow&gt;();
            })
            .Build();
    }

    /// &lt;summary&gt;
    /// Invoked when the application is launched
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;args&quot;&gt;&lt;/param&gt;
    protected override async void OnLaunched(LaunchActivatedEventArgs args)
    {
        var startupService = _host.Services.GetRequiredService&lt;IService_OnStartup_AppLifecycle&gt;();
        await startupService.StartAsync();

        // Subscribe to session events
        var sessionManager = _host.Services.GetRequiredService&lt;IService_UserSessionManager&gt;();
        sessionManager.SessionTimedOut += OnSessionTimedOut;

        if (MainWindow != null)
        {
            MainWindow.Closed += OnMainWindowClosed;
        }
    }

    private void OnSessionTimedOut(object? sender, Model_SessionTimedOutEventArgs e)
    {
        // Close application on timeout
        // In a real app, we might show a dialog or navigate to login
        MainWindow?.Close();
    }

    private async void OnMainWindowClosed(object sender, WindowEventArgs args)
    {
        var sessionManager = _host.Services.GetRequiredService&lt;IService_UserSessionManager&gt;();
        await sessionManager.EndSessionAsync(&quot;manual_close&quot;);
    }

    /// &lt;summary&gt;
    /// Gets a service from the dependency injection container
    /// &lt;/summary&gt;
    /// &lt;typeparam name=&quot;T&quot;&gt;The service type&lt;/typeparam&gt;
    /// &lt;returns&gt;The requested service&lt;/returns&gt;
    /// &lt;exception cref=&quot;InvalidOperationException&quot;&gt;Thrown if the service is not found&lt;/exception&gt;
    public static T GetService&lt;T&gt;() where T : class
    {
        return ((App)Current)._host.Services.GetService&lt;T&gt;()
            ?? throw new InvalidOperationException($&quot;Service {typeof(T)} not found&quot;);
    }
}</file></files></repomix>