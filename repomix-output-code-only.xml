This file is a merged representation of a subset of the codebase, containing specifically included files and files not matching ignore patterns, combined into a single document by Repomix.
The content has been processed where content has been compressed (code blocks are separated by ⋮---- delimiter).

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
- Pay special attention to the Repository Description. These contain important context and guidelines specific to this project.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Only files matching these patterns are included: **/*.cs, **/*.xaml, App.xaml.cs, MainWindow.xaml.cs
- Files matching these patterns are excluded: **/bin/**, **/obj/**, **/.vs/**, **/node_modules/**, **/*.md, docs/**, Documentation/**, Assets/**, Database/**, specs/**, _bmad-output/**, **/*REPORT.md
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Content has been compressed - code blocks are separated by ⋮---- delimiter
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<user_provided_header>
MTM Receiving Application - Core Project Code (Architecture & Implementation)
</user_provided_header>

<directory_structure>
App.xaml
App.xaml.cs
MainWindow.xaml
MainWindow.xaml.cs
Module_Core/Behaviors/AuditBehavior.cs
Module_Core/Behaviors/LoggingBehavior.cs
Module_Core/Behaviors/ValidationBehavior.cs
Module_Core/Contracts/Services/IService_Authentication.cs
Module_Core/Contracts/Services/IService_CSVWriter.cs
Module_Core/Contracts/Services/IService_Dispatcher.cs
Module_Core/Contracts/Services/IService_DunnageAdminWorkflow.cs
Module_Core/Contracts/Services/IService_DunnageCSVWriter.cs
Module_Core/Contracts/Services/IService_DunnageWorkflow.cs
Module_Core/Contracts/Services/IService_ErrorHandler.cs
Module_Core/Contracts/Services/IService_Focus.cs
Module_Core/Contracts/Services/IService_Help.cs
Module_Core/Contracts/Services/IService_InforVisual.cs
Module_Core/Contracts/Services/IService_LoggingUtility.cs
Module_Core/Contracts/Services/IService_Notification.cs
Module_Core/Contracts/Services/IService_OnStartup_AppLifecycle.cs
Module_Core/Contracts/Services/IService_Pagination.cs
Module_Core/Contracts/Services/IService_ReceivingValidation.cs
Module_Core/Contracts/Services/IService_ReceivingWorkflow.cs
Module_Core/Contracts/Services/IService_Reporting.cs
Module_Core/Contracts/Services/IService_SessionManager.cs
Module_Core/Contracts/Services/IService_UserSessionManager.cs
Module_Core/Contracts/Services/IService_ViewModelRegistry.cs
Module_Core/Contracts/Services/IService_Volvo.cs
Module_Core/Contracts/Services/IService_VolvoMasterData.cs
Module_Core/Contracts/Services/ITimer.cs
Module_Core/Contracts/Services/IWindowService.cs
Module_Core/Contracts/Services/Navigation/IService_Navigation.cs
Module_Core/Contracts/ViewModels/IResettableViewModel.cs
Module_Core/Converters/Converter_BooleanToVisibility.cs
Module_Core/Converters/Converter_BoolToString.cs
Module_Core/Converters/Converter_DecimalToInt.cs
Module_Core/Converters/Converter_DecimalToString.cs
Module_Core/Converters/Converter_DoubleToDecimal.cs
Module_Core/Converters/Converter_EmptyStringToVisibility.cs
Module_Core/Converters/Converter_EnumToVisibility.cs
Module_Core/Converters/Converter_IconCodeToGlyph.cs
Module_Core/Converters/Converter_IntToVisibility.cs
Module_Core/Converters/Converter_LoadNumberToOneBased.cs
Module_Core/Converters/Converter_StringFormat.cs
Module_Core/Converters/NullableDoubleToDoubleConverter.cs
Module_Core/Data/Authentication/Dao_User.cs
Module_Core/Data/InforVisual/Dao_InforVisualConnection.cs
Module_Core/Data/InforVisual/Dao_InforVisualPart.cs
Module_Core/Data/InforVisual/Dao_InforVisualPO.cs
Module_Core/Defaults/InforVisualDefaults.cs
Module_Core/Defaults/WorkstationDefaults.cs
Module_Core/Helpers/Database/Helper_Database_StoredProcedure.cs
Module_Core/Helpers/Database/Helper_Database_Variables.cs
Module_Core/Helpers/Database/Helper_SqlQueryLoader.cs
Module_Core/Helpers/UI/Helper_MaterialIcons.cs
Module_Core/Helpers/UI/Helper_WindowExtensions.cs
Module_Core/Helpers/UI/Helper_WorkflowHelpContentGenerator.cs
Module_Core/Models/Core/Model_Dao_Result_Factory.cs
Module_Core/Models/Core/Model_Dao_Result_Generic.cs
Module_Core/Models/Core/Model_Dao_Result.cs
Module_Core/Models/Core/Model_HelpContent.cs
Module_Core/Models/Enums/Enum_DataSourceType.cs
Module_Core/Models/Enums/Enum_ErrorSeverity.cs
Module_Core/Models/Enums/Enum_HelpSeverity.cs
Module_Core/Models/Enums/Enum_HelpType.cs
Module_Core/Models/Enums/Enum_InfoBarSeverity.cs
Module_Core/Models/Enums/Enum_LabelType.cs
Module_Core/Models/Enums/Enum_PackageType.cs
Module_Core/Models/Enums/Enum_ReceivingWorkflowStep.cs
Module_Core/Models/Enums/Enum_ValidationSeverity.cs
Module_Core/Models/InforVisual/Model_InforVisualConnection.cs
Module_Core/Models/InforVisual/Model_InforVisualPart.cs
Module_Core/Models/InforVisual/Model_InforVisualPO.cs
Module_Core/Models/Reporting/Model_ReportRow.cs
Module_Core/Models/Systems/Model_AppSettings.cs
Module_Core/Models/Systems/Model_AuthenticationResult.cs
Module_Core/Models/Systems/Model_CreateUserResult.cs
Module_Core/Models/Systems/Model_SessionTimedOutEventArgs.cs
Module_Core/Models/Systems/Model_User.cs
Module_Core/Models/Systems/Model_UserSession.cs
Module_Core/Models/Systems/Model_ValidationResult.cs
Module_Core/Models/Systems/Model_WorkstationConfig.cs
Module_Core/Services/Authentication/Service_Authentication.cs
Module_Core/Services/Authentication/Service_UserSessionManager.cs
Module_Core/Services/Database/Service_ErrorHandler.cs
Module_Core/Services/Database/Service_InforVisualConnect.cs
Module_Core/Services/Database/Service_LoggingUtility.cs
Module_Core/Services/Help/Service_Help.cs
Module_Core/Services/Navigation/Service_Navigation.cs
Module_Core/Services/Service_Dispatcher.cs
Module_Core/Services/Service_DispatcherTimerWrapper.cs
Module_Core/Services/Service_Focus.cs
Module_Core/Services/Service_Notification.cs
Module_Core/Services/Service_Pagination.cs
Module_Core/Services/Service_Window.cs
Module_Core/Services/Startup/Service_OnStartup_AppLifecycle.cs
Module_Core/Services/UI/Service_ViewModelRegistry.cs
Module_Core/Themes/MaterialIcons.xaml
Module_Dunnage/Contracts/IService_MySQL_Dunnage.cs
Module_Dunnage/Data/Dao_DunnageCustomField.cs
Module_Dunnage/Data/Dao_DunnageLine.cs
Module_Dunnage/Data/Dao_DunnageLoad.cs
Module_Dunnage/Data/Dao_DunnagePart.cs
Module_Dunnage/Data/Dao_DunnageSpec.cs
Module_Dunnage/Data/Dao_DunnageType.cs
Module_Dunnage/Data/Dao_DunnageUserPreference.cs
Module_Dunnage/Data/Dao_InventoriedDunnage.cs
Module_Dunnage/Enums/Enum_DunnageAdminSection.cs
Module_Dunnage/Enums/Enum_DunnageWorkflowStep.cs
Module_Dunnage/Models/Model_CustomFieldDefinition.cs
Module_Dunnage/Models/Model_DunnageLine.cs
Module_Dunnage/Models/Model_DunnageLoad.cs
Module_Dunnage/Models/Model_DunnagePart.cs
Module_Dunnage/Models/Model_DunnageSession.cs
Module_Dunnage/Models/Model_DunnageSpec.cs
Module_Dunnage/Models/Model_DunnageType.cs
Module_Dunnage/Models/Model_IconDefinition.cs
Module_Dunnage/Models/Model_InventoriedDunnage.cs
Module_Dunnage/Models/Model_SpecInput.cs
Module_Dunnage/Models/Model_SpecItem.cs
Module_Dunnage/Models/SpecDefinition.cs
Module_Dunnage/Services/Service_DunnageAdminWorkflow.cs
Module_Dunnage/Services/Service_DunnageCSVWriter.cs
Module_Dunnage/Services/Service_DunnageWorkflow.cs
Module_Dunnage/Services/Service_MySQL_Dunnage.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_AddTypeDialogViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_AdminInventoryViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_AdminMainViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_AdminPartsViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_AdminTypesViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_DetailsEntryViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_EditModeViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_ManualEntryViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_ModeSelectionViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_PartSelectionViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_QuantityEntryViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_ReviewViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_TypeSelectionViewModel.cs
Module_Dunnage/ViewModels/ViewModel_Dunnage_WorkFlowViewModel.cs
Module_Dunnage/Views/View_Dunnage_AdminInventoryView.xaml
Module_Dunnage/Views/View_Dunnage_AdminInventoryView.xaml.cs
Module_Dunnage/Views/View_Dunnage_AdminMainView.xaml
Module_Dunnage/Views/View_Dunnage_AdminMainView.xaml.cs
Module_Dunnage/Views/View_Dunnage_AdminPartsView.xaml
Module_Dunnage/Views/View_Dunnage_AdminPartsView.xaml.cs
Module_Dunnage/Views/View_Dunnage_AdminTypesView.xaml
Module_Dunnage/Views/View_Dunnage_AdminTypesView.xaml.cs
Module_Dunnage/Views/View_Dunnage_Control_IconPickerControl.xaml
Module_Dunnage/Views/View_Dunnage_Control_IconPickerControl.xaml.cs
Module_Dunnage/Views/View_Dunnage_DetailsEntryView.xaml
Module_Dunnage/Views/View_Dunnage_DetailsEntryView.xaml.cs
Module_Dunnage/Views/View_Dunnage_Dialog_AddMultipleRowsDialog.xaml
Module_Dunnage/Views/View_Dunnage_Dialog_AddMultipleRowsDialog.xaml.cs
Module_Dunnage/Views/View_Dunnage_Dialog_AddToInventoriedListDialog.xaml
Module_Dunnage/Views/View_Dunnage_Dialog_AddToInventoriedListDialog.xaml.cs
Module_Dunnage/Views/View_Dunnage_Dialog_Dunnage_AddTypeDialog.xaml
Module_Dunnage/Views/View_Dunnage_Dialog_Dunnage_AddTypeDialog.xaml.cs
Module_Dunnage/Views/View_Dunnage_EditModeView.xaml
Module_Dunnage/Views/View_Dunnage_EditModeView.xaml.cs
Module_Dunnage/Views/View_Dunnage_ManualEntryView.xaml
Module_Dunnage/Views/View_Dunnage_ManualEntryView.xaml.cs
Module_Dunnage/Views/View_Dunnage_ModeSelectionView.xaml
Module_Dunnage/Views/View_Dunnage_ModeSelectionView.xaml.cs
Module_Dunnage/Views/View_Dunnage_PartSelectionView.xaml
Module_Dunnage/Views/View_Dunnage_PartSelectionView.xaml.cs
Module_Dunnage/Views/View_Dunnage_QuantityEntryView.xaml
Module_Dunnage/Views/View_Dunnage_QuantityEntryView.xaml.cs
Module_Dunnage/Views/View_Dunnage_QuickAddPartDialog.xaml
Module_Dunnage/Views/View_Dunnage_QuickAddPartDialog.xaml.cs
Module_Dunnage/Views/View_Dunnage_QuickAddTypeDialog.xaml
Module_Dunnage/Views/View_Dunnage_QuickAddTypeDialog.xaml.cs
Module_Dunnage/Views/View_Dunnage_ReviewView.xaml
Module_Dunnage/Views/View_Dunnage_ReviewView.xaml.cs
Module_Dunnage/Views/View_Dunnage_TypeSelectionView.xaml
Module_Dunnage/Views/View_Dunnage_TypeSelectionView.xaml.cs
Module_Dunnage/Views/View_Dunnage_WorkflowView.xaml
Module_Dunnage/Views/View_Dunnage_WorkflowView.xaml.cs
Module_Receiving/Contracts/IService_MySQL_PackagePreferences.cs
Module_Receiving/Contracts/IService_MySQL_Receiving.cs
Module_Receiving/Contracts/IService_MySQL_ReceivingLine.cs
Module_Receiving/Data/Dao_PackageTypePreference.cs
Module_Receiving/Data/Dao_ReceivingLine.cs
Module_Receiving/Data/Dao_ReceivingLoad.cs
Module_Receiving/Models/Model_Application_Variables.cs
Module_Receiving/Models/Model_CSVDeleteResult.cs
Module_Receiving/Models/Model_CSVExistenceResult.cs
Module_Receiving/Models/Model_CSVWriteResult.cs
Module_Receiving/Models/Model_InforVisualPart.cs
Module_Receiving/Models/Model_InforVisualPO.cs
Module_Receiving/Models/Model_PackageTypePreference.cs
Module_Receiving/Models/Model_ReceivingLine.cs
Module_Receiving/Models/Model_ReceivingLoad.cs
Module_Receiving/Models/Model_ReceivingSession.cs
Module_Receiving/Models/Model_ReceivingValidationResult.cs
Module_Receiving/Models/Model_ReceivingWorkflowStepResult.cs
Module_Receiving/Models/Model_SaveResult.cs
Module_Receiving/Models/Model_UserPreference.cs
Module_Receiving/Models/Model_WorkflowStepResult.cs
Module_Receiving/Services/Service_CSVWriter.cs
Module_Receiving/Services/Service_MySQL_PackagePreferences.cs
Module_Receiving/Services/Service_MySQL_Receiving.cs
Module_Receiving/Services/Service_MySQL_ReceivingLine.cs
Module_Receiving/Services/Service_ReceivingValidation.cs
Module_Receiving/Services/Service_ReceivingWorkflow.cs
Module_Receiving/Services/Service_SessionManager.cs
Module_Receiving/ViewModels/ViewModel_Receiving_EditMode.cs
Module_Receiving/ViewModels/ViewModel_Receiving_HeatLot.cs
Module_Receiving/ViewModels/ViewModel_Receiving_LoadEntry.cs
Module_Receiving/ViewModels/ViewModel_Receiving_ManualEntry.cs
Module_Receiving/ViewModels/ViewModel_Receiving_ModeSelection.cs
Module_Receiving/ViewModels/ViewModel_Receiving_PackageType.cs
Module_Receiving/ViewModels/ViewModel_Receiving_POEntry.cs
Module_Receiving/ViewModels/ViewModel_Receiving_Review.cs
Module_Receiving/ViewModels/ViewModel_Receiving_WeightQuantity.cs
Module_Receiving/ViewModels/ViewModel_Receiving_Workflow.cs
Module_Receiving/Views/View_Receiving_EditMode.xaml
Module_Receiving/Views/View_Receiving_EditMode.xaml.cs
Module_Receiving/Views/View_Receiving_HeatLot.xaml
Module_Receiving/Views/View_Receiving_HeatLot.xaml.cs
Module_Receiving/Views/View_Receiving_LoadEntry.xaml
Module_Receiving/Views/View_Receiving_LoadEntry.xaml.cs
Module_Receiving/Views/View_Receiving_ManualEntry.xaml
Module_Receiving/Views/View_Receiving_ManualEntry.xaml.cs
Module_Receiving/Views/View_Receiving_ModeSelection.xaml
Module_Receiving/Views/View_Receiving_ModeSelection.xaml.cs
Module_Receiving/Views/View_Receiving_PackageType.xaml
Module_Receiving/Views/View_Receiving_PackageType.xaml.cs
Module_Receiving/Views/View_Receiving_POEntry.xaml
Module_Receiving/Views/View_Receiving_POEntry.xaml.cs
Module_Receiving/Views/View_Receiving_Review.xaml
Module_Receiving/Views/View_Receiving_Review.xaml.cs
Module_Receiving/Views/View_Receiving_WeightQuantity.xaml
Module_Receiving/Views/View_Receiving_WeightQuantity.xaml.cs
Module_Receiving/Views/View_Receiving_Workflow.xaml
Module_Receiving/Views/View_Receiving_Workflow.xaml.cs
Module_Reporting/Data/Dao_Reporting.cs
Module_Reporting/Services/Service_Reporting.cs
Module_Reporting/ViewModels/ViewModel_Reporting_Main.cs
Module_Reporting/Views/View_Reporting_Main.xaml
Module_Reporting/Views/View_Reporting_Main.xaml.cs
Module_Routing/Constants/Constant_Routing.cs
Module_Routing/Constants/Constant_RoutingConfiguration.cs
Module_Routing/Converters/IntToFontWeightConverter.cs
Module_Routing/Converters/IntToProgressBrushConverter.cs
Module_Routing/Converters/NullToBooleanConverter.cs
Module_Routing/Data/Dao_InforVisualPO.cs
Module_Routing/Data/Dao_RoutingLabel.cs
Module_Routing/Data/Dao_RoutingLabelHistory.cs
Module_Routing/Data/Dao_RoutingOtherReason.cs
Module_Routing/Data/Dao_RoutingRecipient.cs
Module_Routing/Data/Dao_RoutingUsageTracking.cs
Module_Routing/Data/Dao_RoutingUserPreference.cs
Module_Routing/Enums/Enum_Routing_WorkflowStep.cs
Module_Routing/Enums/Enum_RoutingMode.cs
Module_Routing/Interfaces/IDao_RoutingLabel.cs
Module_Routing/Interfaces/IDao_RoutingLabelHistory.cs
Module_Routing/Interfaces/IDao_RoutingRecipient.cs
Module_Routing/Interfaces/IDao_RoutingUsageTracking.cs
Module_Routing/Models/Model_InforVisualPOLine.cs
Module_Routing/Models/Model_RoutingLabel.cs
Module_Routing/Models/Model_RoutingLabelHistory.cs
Module_Routing/Models/Model_RoutingOtherReason.cs
Module_Routing/Models/Model_RoutingRecipient.cs
Module_Routing/Models/Model_RoutingUsageTracking.cs
Module_Routing/Models/Model_RoutingUserPreference.cs
Module_Routing/Services/IRoutingInforVisualService.cs
Module_Routing/Services/IRoutingRecipientService.cs
Module_Routing/Services/IRoutingService.cs
Module_Routing/Services/IRoutingUsageTrackingService.cs
Module_Routing/Services/IRoutingUserPreferenceService.cs
Module_Routing/Services/RoutingInforVisualService.cs
Module_Routing/Services/RoutingRecipientService.cs
Module_Routing/Services/RoutingService.cs
Module_Routing/Services/RoutingUsageTrackingService.cs
Module_Routing/Services/RoutingUserPreferenceService.cs
Module_Routing/ViewModels/RoutingEditModeViewModel.cs
Module_Routing/ViewModels/RoutingManualEntryViewModel.cs
Module_Routing/ViewModels/RoutingModeSelectionViewModel.cs
Module_Routing/ViewModels/RoutingWizardContainerViewModel.cs
Module_Routing/ViewModels/RoutingWizardStep1ViewModel.cs
Module_Routing/ViewModels/RoutingWizardStep2ViewModel.cs
Module_Routing/ViewModels/RoutingWizardStep3ViewModel.cs
Module_Routing/Views/RoutingEditModeView.xaml
Module_Routing/Views/RoutingEditModeView.xaml.cs
Module_Routing/Views/RoutingManualEntryView.xaml
Module_Routing/Views/RoutingManualEntryView.xaml.cs
Module_Routing/Views/RoutingModeSelectionView.xaml
Module_Routing/Views/RoutingModeSelectionView.xaml.cs
Module_Routing/Views/RoutingWizardContainerView.xaml
Module_Routing/Views/RoutingWizardContainerView.xaml.cs
Module_Routing/Views/RoutingWizardStep1View.xaml
Module_Routing/Views/RoutingWizardStep1View.xaml.cs
Module_Routing/Views/RoutingWizardStep2View.xaml
Module_Routing/Views/RoutingWizardStep2View.xaml.cs
Module_Routing/Views/RoutingWizardStep3View.xaml
Module_Routing/Views/RoutingWizardStep3View.xaml.cs
Module_Settings/Data/Dao_PackageType.cs
Module_Settings/Data/Dao_PackageTypeMappings.cs
Module_Settings/Data/Dao_RoutingRule.cs
Module_Settings/Data/Dao_ScheduledReport.cs
Module_Settings/Data/Dao_SettingsAuditLog.cs
Module_Settings/Data/Dao_SystemSettings.cs
Module_Settings/Data/Dao_UserSettings.cs
Module_Settings/Enums/Enum_SettingsWorkflowStep.cs
Module_Settings/Interfaces/IService_SettingsWorkflow.cs
Module_Settings/Interfaces/IService_UserPreferences.cs
Module_Settings/Models/Model_ConnectionTestResult.cs
Module_Settings/Models/Model_DaoTestResult.cs
Module_Settings/Models/Model_PackageType.cs
Module_Settings/Models/Model_PackageTypeMapping.cs
Module_Settings/Models/Model_RoutingRule.cs
Module_Settings/Models/Model_ScheduledReport.cs
Module_Settings/Models/Model_SettingsAuditLog.cs
Module_Settings/Models/Model_SettingValue.cs
Module_Settings/Models/Model_StoredProcedureTestResult.cs
Module_Settings/Models/Model_SystemSetting.cs
Module_Settings/Models/Model_TableTestResult.cs
Module_Settings/Models/Model_UserSetting.cs
Module_Settings/Services/Service_SettingsWorkflow.cs
Module_Settings/Services/Service_UserPreferences.cs
Module_Settings/ViewModels/ViewModel_Settings_DatabaseTest.cs
Module_Settings/Views/View_Settings_DatabaseTest.xaml
Module_Settings/Views/View_Settings_DatabaseTest.xaml.cs
Module_Shared/ViewModels/ViewModel_Shared_Base.cs
Module_Shared/ViewModels/ViewModel_Shared_HelpDialog.cs
Module_Shared/ViewModels/ViewModel_Shared_MainWindow.cs
Module_Shared/ViewModels/ViewModel_Shared_NewUserSetup.cs
Module_Shared/ViewModels/ViewModel_Shared_SharedTerminalLogin.cs
Module_Shared/ViewModels/ViewModel_Shared_SplashScreen.cs
Module_Shared/Views/View_Shared_HelpDialog.xaml
Module_Shared/Views/View_Shared_HelpDialog.xaml.cs
Module_Shared/Views/View_Shared_IconSelectorWindow.xaml
Module_Shared/Views/View_Shared_IconSelectorWindow.xaml.cs
Module_Shared/Views/View_Shared_NewUserSetupDialog.xaml
Module_Shared/Views/View_Shared_NewUserSetupDialog.xaml.cs
Module_Shared/Views/View_Shared_SharedTerminalLoginDialog.xaml
Module_Shared/Views/View_Shared_SharedTerminalLoginDialog.xaml.cs
Module_Shared/Views/View_Shared_SplashScreenWindow.xaml
Module_Shared/Views/View_Shared_SplashScreenWindow.xaml.cs
Module_Volvo/Data/Dao_VolvoPart.cs
Module_Volvo/Data/Dao_VolvoPartComponent.cs
Module_Volvo/Data/Dao_VolvoSettings.cs
Module_Volvo/Data/Dao_VolvoShipment.cs
Module_Volvo/Data/Dao_VolvoShipmentLine.cs
Module_Volvo/Interfaces/IDao_VolvoPart.cs
Module_Volvo/Interfaces/IDao_VolvoShipment.cs
Module_Volvo/Interfaces/IDao_VolvoShipmentLine.cs
Module_Volvo/Models/Model_EmailRecipient.cs
Module_Volvo/Models/Model_VolvoEmailData.cs
Module_Volvo/Models/Model_VolvoPart.cs
Module_Volvo/Models/Model_VolvoPartComponent.cs
Module_Volvo/Models/Model_VolvoSetting.cs
Module_Volvo/Models/Model_VolvoShipment.cs
Module_Volvo/Models/Model_VolvoShipmentLine.cs
Module_Volvo/Models/VolvoShipmentStatus.cs
Module_Volvo/Services/IService_VolvoAuthorization.cs
Module_Volvo/Services/Service_Volvo.cs
Module_Volvo/Services/Service_VolvoAuthorization.cs
Module_Volvo/Services/Service_VolvoMasterData.cs
Module_Volvo/ViewModels/ViewModel_Volvo_History.cs
Module_Volvo/ViewModels/ViewModel_Volvo_Settings.cs
Module_Volvo/ViewModels/ViewModel_Volvo_ShipmentEntry.cs
Module_Volvo/Views/View_Volvo_History.xaml
Module_Volvo/Views/View_Volvo_History.xaml.cs
Module_Volvo/Views/View_Volvo_Settings.xaml
Module_Volvo/Views/View_Volvo_Settings.xaml.cs
Module_Volvo/Views/View_Volvo_ShipmentEntry.xaml
Module_Volvo/Views/View_Volvo_ShipmentEntry.xaml.cs
Module_Volvo/Views/VolvoPartAddEditDialog.xaml
Module_Volvo/Views/VolvoPartAddEditDialog.xaml.cs
Module_Volvo/Views/VolvoShipmentEditDialog.xaml
Module_Volvo/Views/VolvoShipmentEditDialog.xaml.cs
MTM_Receiving_Application.Tests/Fixtures/DatabaseFixture.cs
MTM_Receiving_Application.Tests/Fixtures/ServiceCollectionFixture.cs
MTM_Receiving_Application.Tests/GlobalUsings.cs
MTM_Receiving_Application.Tests/Helpers/TestHelper.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_BooleanToVisibility_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_BoolToString_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_DecimalToInt_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_DecimalToString_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_DoubleToDecimal_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_EmptyStringToVisibility_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_EnumToVisibility_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_IconCodeToGlyph_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_IntToVisibility_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_LoadNumberToOneBased_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_StringFormat_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Converters/NullableDoubleToDoubleConverter_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Data/Authentication/Dao_User_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Defaults/InforVisualDefaults_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Defaults/WorkstationDefaults_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Helpers/Database/Helper_Database_StoredProcedure_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Helpers/Database/Helper_Database_Variables_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Models/Core/Model_Dao_Result_Factory_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_AuthenticationResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_User_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_UserSession_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_ValidationResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_WorkstationConfig_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Services/Authentication/Service_Authentication_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Services/Authentication/Service_UserSessionManager_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Services/Database/Service_ErrorHandler_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Services/Help/Service_Help_Tests.cs
MTM_Receiving_Application.Tests/Module_Core/Services/UI/Service_ViewModelRegistry_Tests.cs
MTM_Receiving_Application.Tests/Module_Dunnage/Data/Dao_DunnageLoad_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Data/Dao_ReceivingLine_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Data/Dao_ReceivingLoad_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_Application_Variables_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_CSVDeleteResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_CSVExistenceResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_CSVWriteResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_InforVisualPart_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_InforVisualPO_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_PackageTypePreference_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingLine_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingLoad_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingSession_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingValidationResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingWorkflowStepResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_SaveResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_UserPreference_Tests.cs
MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_WorkflowStepResult_Tests.cs
MTM_Receiving_Application.Tests/Module_Routing/Data/Dao_RoutingLabel_Tests.cs
MTM_Receiving_Application.Tests/Module_Settings/Data/Dao_PackageType_Tests.cs
MTM_Receiving_Application.Tests/UnitTest1.cs
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="App.xaml">
<?xml version="1.0" encoding="utf-8"?>
<Application
    x:Class="MTM_Receiving_Application.App"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MTM_Receiving_Application"
    xmlns:converters="using:MTM_Receiving_Application.Converters">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <XamlControlsResources xmlns="using:Microsoft.UI.Xaml.Controls" />
                <ResourceDictionary Source="ms-appx:///Module_Core/Themes/MaterialIcons.xaml"/>
                <!-- Other merged dictionaries here -->
            </ResourceDictionary.MergedDictionaries>
            <!-- Other app resources here -->
        </ResourceDictionary>
    </Application.Resources>
</Application>
</file>

<file path="Module_Core/Behaviors/AuditBehavior.cs">
/// <summary>
/// Global pipeline behavior that adds audit context to all requests.
/// Automatically applied to ALL handlers in ALL modules.
/// Logs user context, machine name, and timestamp for compliance and troubleshooting.
/// </summary>
/// <typeparam name="TRequest">The request type.</typeparam>
/// <typeparam name="TResponse">The response type.</typeparam>
public class AuditBehavior<TRequest, TResponse> : IPipelineBehavior<TRequest, TResponse>
where TRequest : IRequest<TResponse>
⋮----
public async Task<TResponse> Handle(
⋮----
// Capture audit context
var userId = Environment.UserName; // TODO: Replace with authenticated user from IService_Authentication
⋮----
_logger.LogInformation(
⋮----
// Proceed to next behavior or handler
</file>

<file path="Module_Core/Behaviors/LoggingBehavior.cs">
/// <summary>
/// Global pipeline behavior that logs all MediatR requests.
/// Automatically applied to ALL handlers in ALL modules.
/// </summary>
/// <typeparam name="TRequest">The request type.</typeparam>
/// <typeparam name="TResponse">The response type.</typeparam>
public class LoggingBehavior<TRequest, TResponse> : IPipelineBehavior<TRequest, TResponse>
where TRequest : IRequest<TResponse>
⋮----
public async Task<TResponse> Handle(
⋮----
var requestGuid = Guid.NewGuid().ToString();
⋮----
_logger.LogInformation(
⋮----
var stopwatch = Stopwatch.StartNew();
⋮----
stopwatch.Stop();
⋮----
_logger.LogError(
</file>

<file path="Module_Core/Behaviors/ValidationBehavior.cs">
/// <summary>
/// Global pipeline behavior that validates commands using FluentValidation.
/// Automatically applied to ALL commands in ALL modules.
/// Validation occurs BEFORE the handler executes.
/// </summary>
/// <typeparam name="TRequest">The request type.</typeparam>
/// <typeparam name="TResponse">The response type.</typeparam>
public class ValidationBehavior<TRequest, TResponse> : IPipelineBehavior<TRequest, TResponse>
where TRequest : IRequest<TResponse>
⋮----
public async Task<TResponse> Handle(
⋮----
// If no validators registered for this request type, skip validation
if (!_validators.Any())
⋮----
// Run all validators in parallel
var validationResults = await Task.WhenAll(
_validators.Select(v => v.ValidateAsync(context, cancellationToken)));
⋮----
// Collect all validation failures
⋮----
.SelectMany(r => r.Errors)
.Where(f => f != null)
.ToList();
⋮----
// If any validation failures, throw ValidationException (short-circuits handler execution)
if (failures.Any())
⋮----
throw new ValidationException(failures);
⋮----
// Validation passed, proceed to handler
</file>

<file path="Module_Core/Contracts/Services/IService_CSVWriter.cs">
/// <summary>
/// Service for writing receiving data to CSV files.
/// Handles both local (%APPDATA%) and network paths with graceful fallback.
/// </summary>
public interface IService_CSVWriter
⋮----
/// Writes receiving loads to both local and network CSV files.
/// Network failure does not prevent local write (graceful degradation).
⋮----
/// <param name="loads">List of loads to write</param>
/// <returns>Result object indicating success/failure for each destination</returns>
/// <exception cref="ArgumentException">If loads list is null or empty</exception>
/// <exception cref="InvalidOperationException">If local write fails (critical error)</exception>
public Task<Model_CSVWriteResult> WriteToCSVAsync(List<Model_ReceivingLoad> loads);
⋮----
/// Writes loads to a specific CSV file path.
/// Used internally but exposed for testing.
⋮----
/// <param name="filePath">Absolute path to CSV file</param>
/// <param name="loads">Loads to write</param>
/// <param name="append">Whether to append to existing file (default true)</param>
/// <exception cref="InvalidOperationException">If write fails</exception>
public Task WriteToFileAsync(string filePath, List<Model_ReceivingLoad> loads, bool append = true);
⋮----
/// Reads receiving loads from a CSV file.
⋮----
/// <returns>List of receiving loads</returns>
/// <exception cref="FileNotFoundException">If file does not exist</exception>
/// <exception cref="InvalidOperationException">If read fails</exception>
public Task<List<Model_ReceivingLoad>> ReadFromCSVAsync(string filePath);
⋮----
/// Clears CSV files (used for reset on startup).
⋮----
/// <returns>Result indicating which files were cleared</returns>
public Task<Model_CSVDeleteResult> ClearCSVFilesAsync();
⋮----
/// Checks if CSV files exist.
⋮----
/// <returns>Result indicating existence of local and network files</returns>
public Task<Model_CSVExistenceResult> CheckCSVFilesExistAsync();
⋮----
/// Gets the configured local CSV file path.
⋮----
/// <returns>Absolute path to local CSV</returns>
public string GetLocalCSVPath();
⋮----
/// Gets the configured network CSV file path.
⋮----
/// <returns>UNC path to network CSV</returns>
public string GetNetworkCSVPath();
</file>

<file path="Module_Core/Contracts/Services/IService_Dispatcher.cs">
/// <summary>
/// Interface for dispatcher operations.
/// Wraps DispatcherQueue to allow mocking in unit tests.
/// </summary>
public interface IService_Dispatcher
⋮----
/// Creates a new timer on the dispatcher thread.
⋮----
/// <returns>A new IDispatcherTimer instance</returns>
public IService_DispatcherTimer CreateTimer();
⋮----
/// Enqueues a function for execution on the dispatcher thread.
⋮----
/// <param name="callback">The function to execute</param>
/// <returns>True if the function was enqueued; otherwise, false.</returns>
public bool TryEnqueue(Action callback);
</file>

<file path="Module_Core/Contracts/Services/IService_DunnageAdminWorkflow.cs">
using MTM_Receiving_Application.Module_Receiving.Models; // For Model_WorkflowStepResult if needed
using MTM_Receiving_Application.Module_Core.Models.Enums; // For other enums if needed
⋮----
/// <summary>
/// Service interface for Dunnage Admin UI navigation workflow
/// Manages 4-section navigation: Types, Parts, Specs, Inventoried List
/// </summary>
public interface IService_DunnageAdminWorkflow
⋮----
/// Gets the current admin section being displayed
⋮----
/// Raised when admin section changes
⋮----
/// Raised when status message needs to be displayed
⋮----
/// Navigate to specific admin section
⋮----
/// <param name="section">Target section (Types, Parts, Specs, InventoriedList)</param>
public Task NavigateToSectionAsync(Enum_DunnageAdminSection section);
⋮----
/// Return to main admin hub (4-card navigation view)
⋮----
public Task NavigateToHubAsync();
⋮----
/// Validate if navigation away from current section is allowed
/// (checks for unsaved changes, pending operations)
⋮----
/// <returns>True if navigation allowed, false if blocked</returns>
public Task<bool> CanNavigateAwayAsync();
⋮----
/// Mark current section as having unsaved changes
⋮----
public void MarkDirty();
⋮----
/// Clear unsaved changes flag (after save or discard)
⋮----
public void MarkClean();
⋮----
/// Check if current section has unsaved changes
</file>

<file path="Module_Core/Contracts/Services/IService_DunnageCSVWriter.cs">
/// <summary>
/// Service interface for CSV export of dunnage data with dynamic column generation
/// EXTENDED for dynamic spec columns (spec 010-dunnage-complete)
/// </summary>
public interface IService_DunnageCSVWriter
⋮----
// ============================================
// EXISTING METHOD (from spec 006-dunnage-services)
⋮----
/// Write dunnage loads to CSV file (wizard workflow export)
/// Uses fixed columns based on selected type's specs
⋮----
/// <param name="loads">List of loads to export</param>
/// <param name="typeName">Dunnage type name for filename</param>
/// <returns>File paths (local and network) and success status</returns>
public Task<Model_CSVWriteResult> WriteToCsvAsync(List<Model_DunnageLoad> loads, string typeName);
⋮----
/// Write dunnage loads to CSV file (backward compatibility)
⋮----
/// <param name="loads"></param>
public Task<Model_CSVWriteResult> WriteToCSVAsync(List<Model_DunnageLoad> loads);
⋮----
// NEW METHODS (spec 010-dunnage-complete)
⋮----
/// Write dunnage loads to CSV with dynamic columns for all spec keys
/// Used for Manual Entry and Edit Mode exports (all types in one file)
⋮----
/// <param name="allSpecKeys">Union of all spec keys across all types (from GetAllSpecKeysAsync)</param>
/// <param name="filename">Optional custom filename (default: DunnageData_{timestamp}.csv)</param>
/// <returns>CSV write result with local/network paths and success status</returns>
/// <remarks>
/// Generates columns: ID, PartID, DunnageType, Quantity, PONumber, ReceivedDate, UserId, Location, LabelNumber, [Dynamic Spec Columns]
/// Blank cells for specs not applicable to a load's type
/// RFC 4180 compliant (CsvHelper escaping)
/// Dual-path write: local (%APPDATA%) always succeeds, network (\\MTMDC\) best-effort
/// </remarks>
public Task<Model_CSVWriteResult> WriteDynamicCsvAsync(
⋮----
/// Export selected loads from DataGrid (Manual Entry or Edit Mode)
/// Includes dynamic spec columns based on types in selection
⋮----
/// <param name="selectedLoads">Loads selected in DataGrid</param>
/// <param name="includeAllSpecColumns">If true, includes all spec keys across all types. If false, only keys used by selected loads' types.</param>
/// <returns>CSV write result</returns>
public Task<Model_CSVWriteResult> ExportSelectedLoadsAsync(
⋮----
/// Validate network path availability (for dual-path writing)
⋮----
/// <param name="timeout">Timeout in seconds for reachability check</param>
/// <returns>True if network path reachable, false otherwise</returns>
public Task<bool> IsNetworkPathAvailableAsync(int timeout = 3);
⋮----
/// Get local CSV file path for current user
⋮----
/// <param name="filename">Filename (without path)</param>
/// <returns>Full local path (%APPDATA%\MTM_Receiving_Application\{filename})</returns>
public string GetLocalCsvPath(string filename);
⋮----
/// Get network CSV file path for current user
⋮----
/// <returns>Full network path (\\MTMDC\DunnageData\{username}\{filename})</returns>
public string GetNetworkCsvPath(string filename);
⋮----
/// Clears the contents of all CSV files created by the application from local and network paths
⋮----
/// <param name="filenamePattern">Optional filename pattern to match (e.g., "DunnageData_*.csv"). If null, clears all CSV files.</param>
/// <returns>CSV clear result with counts of cleared files and any errors</returns>
public Task<Model_CSVDeleteResult> ClearCSVFilesAsync(string? filenamePattern = null);
</file>

<file path="Module_Core/Contracts/Services/IService_DunnageWorkflow.cs">
using MTM_Receiving_Application.Module_Receiving.Models; // For Model_WorkflowStepResult if needed
using MTM_Receiving_Application.Module_Core.Models.Enums; // For other enums if needed
⋮----
public interface IService_DunnageWorkflow
⋮----
public event EventHandler StepChanged;
⋮----
public Task<bool> StartWorkflowAsync();
public Task<Model_WorkflowStepResult> AdvanceToNextStepAsync();
public void GoToStep(Enum_DunnageWorkflowStep step);
public Task<Model_SaveResult> SaveSessionAsync();
public Task<Model_SaveResult> SaveToCSVOnlyAsync();
public Task<Model_SaveResult> SaveToDatabaseOnlyAsync();
public void ClearSession();
⋮----
public Task<Model_CSVDeleteResult> ResetCSVFilesAsync();
public void AddCurrentLoadToSession();
</file>

<file path="Module_Core/Contracts/Services/IService_ErrorHandler.cs">
/// <summary>
/// Service contract for centralized error handling and user notification.
/// Implementations must log errors to file system and display user-friendly dialogs.
/// </summary>
public interface IService_ErrorHandler
⋮----
/// Handles an error by logging it and optionally displaying a dialog.
⋮----
/// <param name="errorMessage">The error message to log and display</param>
/// <param name="severity">The severity level of the error</param>
/// <param name="exception">Optional exception that caused the error</param>
/// <param name="showDialog">Whether to show a user-facing dialog</param>
/// <returns>Task for async operation</returns>
public Task HandleErrorAsync(
⋮----
/// Logs an error without displaying a dialog.
⋮----
/// <param name="errorMessage">The error message to log</param>
⋮----
public Task LogErrorAsync(
⋮----
/// Displays a user-friendly error dialog.
⋮----
/// <param name="title">Dialog title</param>
/// <param name="message">Error message to display</param>
/// <param name="severity">Severity level (affects icon/styling)</param>
⋮----
public Task ShowErrorDialogAsync(
⋮----
/// Handles a Model_Dao_Result error by logging and optionally displaying.
⋮----
/// <param name="result">The DAO result containing error information</param>
/// <param name="operationName">Name of the operation that failed</param>
⋮----
public Task HandleDaoErrorAsync(
⋮----
// Aliases for compatibility (spec 010-dunnage-complete)
⋮----
public Task ShowUserErrorAsync(string message, string title, string method);
⋮----
public void HandleException(Exception ex, Enum_ErrorSeverity severity, string method, string className);
</file>

<file path="Module_Core/Contracts/Services/IService_Help.cs">
using MTM_Receiving_Application.Module_Receiving.Models; // For Model_WorkflowStepResult if needed
using MTM_Receiving_Application.Module_Core.Models.Enums; // For other enums if needed
⋮----
/// <summary>
/// Service for providing contextual help content throughout the application
/// </summary>
public interface IService_Help
⋮----
/// Displays help dialog with content for the specified key
⋮----
/// <param name="helpKey">The unique key for the help content</param>
public Task ShowHelpAsync(string helpKey);
⋮----
/// Shows help for specific dunnage workflow step
⋮----
/// <param name="step">The workflow step enum</param>
public Task ShowContextualHelpAsync(Enum_DunnageWorkflowStep step);
⋮----
/// Shows help for specific receiving workflow step
⋮----
public Task ShowContextualHelpAsync(Enum_ReceivingWorkflowStep step);
⋮----
/// Retrieves help content by key without showing dialog
⋮----
/// <param name="key">The unique help key</param>
/// <returns>Model_HelpContent if found, null otherwise</returns>
public Model_HelpContent? GetHelpContent(string key);
⋮----
/// Gets all help content for a category
⋮----
/// <param name="category">Category name</param>
/// <returns>List of help content items</returns>
public List<Model_HelpContent> GetHelpByCategory(string category);
⋮----
/// Searches help content by title or content
⋮----
/// <param name="searchTerm">Search string</param>
/// <returns>List of matching help content items</returns>
public List<Model_HelpContent> SearchHelp(string searchTerm);
⋮----
/// Checks if user has dismissed a tip/help permanently
⋮----
/// <param name="helpKey">The help key to check</param>
/// <returns>true if dismissed, false otherwise</returns>
public Task<bool> IsDismissedAsync(string helpKey);
⋮----
/// Sets whether a tip/help is dismissed
⋮----
/// <param name="helpKey">The help key</param>
/// <param name="isDismissed">Whether it should be dismissed</param>
public Task SetDismissedAsync(string helpKey, bool isDismissed);
⋮----
/// Gets help content for a dunnage workflow step
⋮----
/// <param name="step">The workflow step</param>
public string GetDunnageWorkflowHelp(Enum_DunnageWorkflowStep step);
⋮----
/// Gets help content for a receiving workflow step
⋮----
public string GetReceivingWorkflowHelp(Enum_ReceivingWorkflowStep step);
⋮----
/// Gets tip content for a specific view or feature
⋮----
/// <param name="viewName">The view name</param>
public string GetTip(string viewName);
⋮----
/// Gets placeholder text for a specific input field
⋮----
/// <param name="fieldName">The field name</param>
public string GetPlaceholder(string fieldName);
⋮----
/// Gets tooltip content for a specific UI element
⋮----
/// <param name="elementName">The element name</param>
public string GetTooltip(string elementName);
⋮----
/// Gets InfoBar message content
⋮----
/// <param name="messageKey">The message key</param>
public string GetInfoBarMessage(string messageKey);
</file>

<file path="Module_Core/Contracts/Services/IService_InforVisual.cs">
/// <summary>
/// Service for querying Infor Visual database (SQL Server) for PO and Part information.
/// Read-only operations only - no writes to Infor Visual.
/// </summary>
public interface IService_InforVisual
⋮----
/// Retrieves a purchase order with all associated parts from Infor Visual.
⋮----
/// <param name="poNumber">6-digit PO number</param>
/// <returns>Result containing InforVisualPO with Parts collection, or null if not found</returns>
public Task<Model_Dao_Result<Model_InforVisualPO?>> GetPOWithPartsAsync(string poNumber);
⋮----
/// Retrieves part information by Part ID for non-PO items.
⋮----
/// <param name="partID">Part identifier</param>
/// <returns>Result containing InforVisualPart with details, or null if not found</returns>
public Task<Model_Dao_Result<Model_InforVisualPart?>> GetPartByIDAsync(string partID);
⋮----
/// Queries same-day receiving transactions for a specific PO and Part.
/// Used to warn users if part was already received today.
⋮----
/// <param name="poNumber">PO number</param>
⋮----
/// <param name="date">Date to query (typically DateTime.Today)</param>
/// <returns>Result containing Total quantity received, or 0 if no receipts found</returns>
public Task<Model_Dao_Result<decimal>> GetSameDayReceivingQuantityAsync(string poNumber, string partID, DateTime date);
⋮----
/// Calculates remaining quantity for a specific PO and Part.
/// Remaining Quantity = Quantity Ordered - Quantity Received.
/// Returns whole number only (no decimals).
⋮----
/// <returns>Result containing remaining quantity as integer</returns>
public Task<Model_Dao_Result<int>> GetRemainingQuantityAsync(string poNumber, string partID);
⋮----
/// Validates that the Infor Visual database connection is available.
⋮----
/// <returns>True if connection successful, false otherwise</returns>
public Task<bool> TestConnectionAsync();
</file>

<file path="Module_Core/Contracts/Services/IService_LoggingUtility.cs">
/// <summary>
/// Service contract for application logging functionality.
/// Implementations must write to file system with daily rotation.
/// </summary>
public interface IService_LoggingUtility
⋮----
/// Logs an informational message.
⋮----
/// <param name="message">The message to log</param>
/// <param name="context">Optional context information</param>
public void LogInfo(string message, string? context = null);
⋮----
/// Logs a warning message.
⋮----
/// <param name="message">The warning message to log</param>
⋮----
public void LogWarning(string message, string? context = null);
⋮----
/// Logs an error message with optional exception.
⋮----
/// <param name="message">The error message to log</param>
/// <param name="exception">Optional exception that caused the error</param>
⋮----
public void LogError(string message, Exception? exception = null, string? context = null);
⋮----
/// Logs a critical error message with optional exception.
⋮----
/// <param name="message">The critical error message to log</param>
⋮----
public void LogCritical(string message, Exception? exception = null, string? context = null);
⋮----
/// Logs a fatal error message with optional exception.
/// Fatal errors indicate the application should terminate.
⋮----
/// <param name="message">The fatal error message to log</param>
⋮----
public void LogFatal(string message, Exception? exception = null, string? context = null);
⋮----
/// Logs an informational message asynchronously.
⋮----
/// <param name="message"></param>
/// <param name="context"></param>
public Task LogInfoAsync(string message, string? context = null);
⋮----
/// Logs a warning message asynchronously.
⋮----
public Task LogWarningAsync(string message, string? context = null);
⋮----
/// Logs an error message asynchronously.
⋮----
/// <param name="exception"></param>
⋮----
public Task LogErrorAsync(string message, Exception? exception = null, string? context = null);
⋮----
/// Gets the path to the current log file.
⋮----
/// <returns>Full path to today's log file</returns>
public string GetCurrentLogFilePath();
⋮----
/// Ensures the log directory exists and is writable.
⋮----
/// <returns>True if log directory is accessible, false otherwise</returns>
public bool EnsureLogDirectoryExists();
⋮----
/// Archives old log files (older than specified days).
⋮----
/// <param name="daysToKeep">Number of days of logs to keep</param>
/// <returns>Number of log files archived</returns>
public int ArchiveOldLogs(int daysToKeep = 30);
</file>

<file path="Module_Core/Contracts/Services/IService_Notification.cs">
public interface IService_Notification : INotifyPropertyChanged
⋮----
public void ShowStatus(string message, InfoBarSeverity severity = InfoBarSeverity.Informational);
</file>

<file path="Module_Core/Contracts/Services/IService_OnStartup_AppLifecycle.cs">
public interface IService_OnStartup_AppLifecycle
⋮----
public Task StartAsync();
</file>

<file path="Module_Core/Contracts/Services/IService_Pagination.cs">
public interface IService_Pagination
⋮----
/// <summary>
/// Gets the current page number (1-based).
/// </summary>
⋮----
/// Gets the total number of pages.
⋮----
/// Gets the number of items per page.
⋮----
/// Gets the total number of items in the source collection.
⋮----
/// Gets a value indicating whether there is a next page.
⋮----
/// Gets a value indicating whether there is a previous page.
⋮----
/// Event raised when the current page data changes.
⋮----
public event EventHandler PageChanged;
⋮----
/// Sets the source collection to be paginated.
⋮----
/// <typeparam name="T">The type of items in the collection.</typeparam>
/// <param name="source">The source collection.</param>
public void SetSource<T>(IEnumerable<T> source);
⋮----
/// Gets the items for the current page.
⋮----
/// <returns>A list of items for the current page.</returns>
public IEnumerable<T> GetCurrentPageItems<T>();
⋮----
/// Moves to the next page.
⋮----
public bool NextPage();
⋮----
/// Moves to the previous page.
⋮----
public bool PreviousPage();
⋮----
/// Moves to the first page.
⋮----
public bool FirstPage();
⋮----
/// Moves to the last page.
⋮----
public bool LastPage();
⋮----
/// Moves to a specific page.
⋮----
/// <param name="pageNumber">The page number to move to.</param>
public bool GoToPage(int pageNumber);
</file>

<file path="Module_Core/Contracts/Services/IService_ReceivingValidation.cs">
/// <summary>
/// Service for validating receiving data and enforcing business rules.
/// </summary>
public interface IService_ReceivingValidation
⋮----
/// Validates a PO number format (6 digits, numeric).
⋮----
/// <param name="poNumber">PO number to validate</param>
/// <returns>Validation result with success flag and error message if invalid</returns>
public Model_ReceivingValidationResult ValidatePONumber(string poNumber);
⋮----
/// Validates a Part ID format and basic requirements.
⋮----
/// <param name="partID">Part ID to validate</param>
/// <returns>Validation result</returns>
public Model_ReceivingValidationResult ValidatePartID(string partID);
⋮----
/// Validates number of loads (1-99).
⋮----
/// <param name="numLoads">Number of loads</param>
⋮----
public Model_ReceivingValidationResult ValidateNumberOfLoads(int numLoads);
⋮----
/// Validates weight/quantity value (must be > 0).
⋮----
/// <param name="weightQuantity">Weight quantity</param>
⋮----
public Model_ReceivingValidationResult ValidateWeightQuantity(decimal weightQuantity);
⋮----
/// Validates package count (must be > 0).
⋮----
/// <param name="packagesPerLoad">Package count</param>
⋮----
public Model_ReceivingValidationResult ValidatePackageCount(int packagesPerLoad);
⋮----
/// Validates heat/lot number (required, max length).
⋮----
/// <param name="heatLotNumber">Heat/lot number</param>
⋮----
public Model_ReceivingValidationResult ValidateHeatLotNumber(string heatLotNumber);
⋮----
/// Validates total quantity against PO ordered quantity (for PO items only).
/// Returns warning result if exceeded, allowing user to override.
⋮----
/// <param name="totalQuantity">Sum of all load quantities</param>
/// <param name="orderedQuantity">PO ordered quantity</param>
/// <param name="partID">Part identifier for error message</param>
/// <returns>Validation result with warning severity if exceeded</returns>
public Task<Model_ReceivingValidationResult> ValidateAgainstPOQuantityAsync(
⋮----
/// Checks for same-day receiving and returns warning if found.
/// For PO items only - queries Infor Visual for today's receipts.
⋮----
/// <param name="poNumber">PO number</param>
/// <param name="partID">Part identifier</param>
/// <param name="userEnteredQuantity">User's total entered quantity</param>
/// <returns>Validation result with warning if same-day receiving exists</returns>
public Task<Model_ReceivingValidationResult> CheckSameDayReceivingAsync(
⋮----
/// Validates a complete receiving load before save.
⋮----
/// <param name="load">Load to validate</param>
⋮----
public Model_ReceivingValidationResult ValidateReceivingLoad(Model_ReceivingLoad load);
⋮----
/// Validates all loads in a session before save.
⋮----
/// <param name="loads">List of loads</param>
/// <returns>Validation result with all errors aggregated</returns>
public Model_ReceivingValidationResult ValidateSession(List<Model_ReceivingLoad> loads);
⋮----
/// Validates a part ID exists in Infor Visual (for edit scenarios).
⋮----
/// <param name="partID">Part ID to check</param>
⋮----
public Task<Model_ReceivingValidationResult> ValidatePartExistsInVisualAsync(string partID);
</file>

<file path="Module_Core/Contracts/Services/IService_ReceivingWorkflow.cs">
/// <summary>
/// Service for orchestrating the receiving workflow state machine.
/// Manages step transitions, validation gates, and session state.
/// </summary>
public interface IService_ReceivingWorkflow
⋮----
/// Event raised when a status message should be shown.
⋮----
/// Raises a status message.
⋮----
/// <param name="message"></param>
public void RaiseStatusMessage(string message);
⋮----
/// Event raised when the workflow step changes.
⋮----
public event EventHandler StepChanged;
⋮----
/// Gets the current workflow step.
⋮----
/// Gets the current session.
⋮----
/// Gets or sets the current PO number being processed.
⋮----
/// Gets or sets the current part being processed.
⋮----
/// Gets or sets whether the current item is a non-PO item.
⋮----
/// Gets or sets the number of loads to create for the current part.
⋮----
/// Starts a new receiving workflow session.
/// Loads any existing persisted session if available.
⋮----
/// <returns>True if existing session restored, false if new session</returns>
public Task<bool> StartWorkflowAsync();
⋮----
/// Advances to the next step if validation passes.
⋮----
/// <returns>Result indicating success and any validation errors</returns>
public Task<Model_ReceivingWorkflowStepResult> AdvanceToNextStepAsync();
⋮----
/// Goes back to the previous step.
⋮----
/// <returns>Result indicating success</returns>
public Model_ReceivingWorkflowStepResult GoToPreviousStep();
⋮----
/// Goes to a specific step (used for "Add Another Part/PO").
⋮----
/// <param name="step">Target step</param>
⋮----
public Model_ReceivingWorkflowStepResult GoToStep(Enum_ReceivingWorkflowStep step);
⋮----
/// Adds current loads to session and resets for next part entry.
⋮----
public Task AddCurrentPartToSessionAsync();
⋮----
/// Saves all loads in session to CSV and database.
⋮----
/// <param name="messageProgress">Progress reporter for status messages</param>
/// <param name="percentProgress">Progress reporter for percentage completion</param>
/// <returns>Result with save operation details</returns>
public Task<Model_SaveResult> SaveSessionAsync(IProgress<string>? messageProgress = null, IProgress<int>? percentProgress = null);
⋮----
/// Clears all UI inputs in registered ViewModels.
⋮----
public void ClearUIInputs();
⋮----
/// Saves all loads in session to CSV only.
⋮----
public Task<Model_SaveResult> SaveToCSVOnlyAsync();
⋮----
/// Saves all loads in session to database only.
⋮----
public Task<Model_SaveResult> SaveToDatabaseOnlyAsync();
⋮----
/// Resets the workflow to initial state.
⋮----
public Task ResetWorkflowAsync();
⋮----
/// Resets the CSV files (deletes them).
⋮----
public Task<Model_CSVDeleteResult> ResetCSVFilesAsync();
⋮----
/// Persists current session state to JSON.
⋮----
public Task PersistSessionAsync();
</file>

<file path="Module_Core/Contracts/Services/IService_SessionManager.cs">
/// <summary>
/// Service for persisting and restoring session state to/from JSON file.
/// Session file location: %APPDATA%\MTM_Receiving_Application\session.json
/// </summary>
public interface IService_SessionManager
⋮----
/// Saves the current session to JSON file.
/// Automatically creates directory if it doesn't exist.
⋮----
/// <param name="session">Session to persist</param>
/// <exception cref="ArgumentNullException">If session is null</exception>
/// <exception cref="InvalidOperationException">If file write fails</exception>
public Task SaveSessionAsync(Model_ReceivingSession session);
⋮----
/// Loads the persisted session from JSON file.
/// Returns null if no session file exists or if file is corrupted.
/// Corrupted files are automatically deleted.
⋮----
/// <returns>Restored session or null</returns>
public Task<Model_ReceivingSession?> LoadSessionAsync();
⋮----
/// Deletes the persisted session file.
/// Called after successful save to prevent stale data.
⋮----
/// <returns>True if deleted, false if file didn't exist</returns>
public Task<bool> ClearSessionAsync();
⋮----
/// Checks if a persisted session file exists.
⋮----
/// <returns>True if session file exists, false otherwise</returns>
public bool SessionExists();
⋮----
/// Gets the full path to the session JSON file.
⋮----
/// <returns>Absolute file path</returns>
public string GetSessionFilePath();
</file>

<file path="Module_Core/Contracts/Services/IService_UserSessionManager.cs">
/// <summary>
/// Service contract for user session management and timeout monitoring.
/// </summary>
public interface IService_UserSessionManager
⋮----
/// Gets the current active user session.
⋮----
/// Creates a new user session.
⋮----
/// <param name="user">Authenticated user</param>
/// <param name="workstationConfig">Workstation configuration</param>
/// <param name="authenticationMethod">Method used for authentication</param>
/// <returns>The created session</returns>
public Model_UserSession CreateSession(
⋮----
/// Updates the last activity timestamp to prevent timeout.
⋮----
public void UpdateLastActivity();
⋮----
/// Starts the session timeout monitoring timer.
⋮----
public void StartTimeoutMonitoring();
⋮----
/// Stops the session timeout monitoring timer.
⋮----
public void StopTimeoutMonitoring();
⋮----
/// Checks if the current session has timed out.
⋮----
/// <returns>True if timed out, false otherwise</returns>
public bool IsSessionTimedOut();
⋮----
/// Ends the current session and logs the reason.
⋮----
/// <param name="reason">Reason for ending session</param>
public Task EndSessionAsync(string reason);
⋮----
/// Event raised when the session times out.
</file>

<file path="Module_Core/Contracts/Services/IService_ViewModelRegistry.cs">
public interface IService_ViewModelRegistry
⋮----
public void Register(object viewModel);
public IEnumerable<T> GetViewModels<T>();
public void ClearAllInputs();
</file>

<file path="Module_Core/Contracts/Services/ITimer.cs">
/// <summary>
/// Interface for a timer that can be used for scheduling tasks.
/// Wraps DispatcherQueueTimer to allow mocking in unit tests.
/// </summary>
public interface IService_DispatcherTimer
⋮----
/// Gets or sets the amount of time between timer ticks.
⋮----
/// Gets or sets a value that indicates whether the timer repeats.
⋮----
/// Gets a value that indicates whether the timer is running.
⋮----
/// Occurs when the timer interval has elapsed.
⋮----
/// Starts the timer.
⋮----
public void Start();
⋮----
/// Stops the timer.
⋮----
public void Stop();
</file>

<file path="Module_Core/Contracts/Services/IWindowService.cs">
public interface IService_Window
⋮----
public XamlRoot? GetXamlRoot();
</file>

<file path="Module_Core/Contracts/Services/Navigation/IService_Navigation.cs">
/// <summary>
/// Service for handling page navigation
/// </summary>
public interface IService_Navigation
⋮----
/// Navigate to a page type
⋮----
/// <param name="frame">The frame to navigate in</param>
/// <param name="pageType">The type of page to navigate to</param>
/// <param name="parameter">Optional navigation parameter</param>
/// <returns>True if navigation succeeded</returns>
public bool NavigateTo(Frame frame, Type pageType, object? parameter = null);
⋮----
/// Navigate to a page type by name
⋮----
/// <param name="pageTypeName">Full name of the page type</param>
⋮----
public bool NavigateTo(Frame frame, string pageTypeName, object? parameter = null);
⋮----
/// Clear the navigation frame
⋮----
/// <param name="frame">The frame to clear</param>
public void ClearNavigation(Frame frame);
⋮----
/// Check if navigation can go back
⋮----
/// <param name="frame"></param>
public bool CanGoBack(Frame frame);
⋮----
/// Navigate back
⋮----
public void GoBack(Frame frame);
</file>

<file path="Module_Core/Data/InforVisual/Dao_InforVisualConnection.cs">
/// <summary>
/// Data Access Object for Infor Visual database connections and queries
/// WARNING: READ-ONLY ACCESS ONLY - NO WRITES PERMITTED
/// </summary>
public class Dao_InforVisualConnection
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Tests connection to Infor Visual database
⋮----
public async Task<Model_Dao_Result<bool>> TestConnectionAsync()
⋮----
await using var connection = new SqlConnection(_connectionString);
await connection.OpenAsync();
⋮----
return Model_Dao_Result_Factory.Success(isConnected);
⋮----
/// Retrieves PO with all line items and parts
/// Uses: 01_GetPOWithParts.sql
⋮----
/// <param name="poNumber"></param>
public async Task<Model_Dao_Result<List<Model_InforVisualPO>>> GetPOWithPartsAsync(string poNumber)
⋮----
var query = Helper_SqlQueryLoader.LoadAndPrepareQuery("01_GetPOWithParts.sql");
⋮----
await using var command = new SqlCommand(query, connection);
command.Parameters.AddWithValue("@PoNumber", poNumber);
⋮----
await using var reader = await command.ExecuteReaderAsync();
⋮----
while (await reader.ReadAsync())
⋮----
poLines.Add(new Model_InforVisualPO
⋮----
PoNumber = reader["PoNumber"].ToString() ?? string.Empty,
PoLine = Convert.ToInt32(reader["PoLine"]),
PartNumber = reader["PartNumber"].ToString() ?? string.Empty,
PartDescription = reader["PartDescription"].ToString() ?? string.Empty,
OrderedQty = Convert.ToDecimal(reader["OrderedQty"]),
ReceivedQty = Convert.ToDecimal(reader["ReceivedQty"]),
RemainingQty = Convert.ToDecimal(reader["RemainingQty"]),
UnitOfMeasure = reader["UnitOfMeasure"].ToString() ?? "EA",
⋮----
VendorCode = reader["VendorCode"].ToString() ?? string.Empty,
VendorName = reader["VendorName"].ToString() ?? string.Empty,
PoStatus = reader["PoStatus"].ToString() ?? string.Empty,
SiteId = reader["SiteId"].ToString() ?? "002"
⋮----
return Model_Dao_Result_Factory.Success(poLines);
⋮----
/// Validates if a PO number exists
/// Uses: 02_ValidatePONumber.sql
⋮----
public async Task<Model_Dao_Result<bool>> ValidatePoNumberAsync(string poNumber)
⋮----
var query = Helper_SqlQueryLoader.LoadAndPrepareQuery("02_ValidatePONumber.sql");
⋮----
var count = (int?)await command.ExecuteScalarAsync() ?? 0;
⋮----
return Model_Dao_Result_Factory.Success(isValid);
⋮----
/// Retrieves part details by part number
/// Uses: 03_GetPartByNumber.sql
⋮----
/// <param name="partNumber"></param>
public async Task<Model_Dao_Result<Model_InforVisualPart?>> GetPartByNumberAsync(string partNumber)
⋮----
var query = Helper_SqlQueryLoader.LoadAndPrepareQuery("03_GetPartByNumber.sql");
⋮----
command.Parameters.AddWithValue("@PartNumber", partNumber);
⋮----
if (await reader.ReadAsync())
⋮----
var part = new Model_InforVisualPart
⋮----
Description = reader["Description"].ToString() ?? string.Empty,
UnitCost = reader["UnitCost"] != DBNull.Value ? Convert.ToDecimal(reader["UnitCost"]) : 0,
PrimaryUom = reader["PrimaryUom"].ToString() ?? "EA",
OnHandQty = Convert.ToDecimal(reader["OnHandQty"]),
AllocatedQty = Convert.ToDecimal(reader["AllocatedQty"]),
AvailableQty = Convert.ToDecimal(reader["AvailableQty"]),
DefaultSite = reader["DefaultSite"].ToString() ?? string.Empty,
PartStatus = reader["PartStatus"].ToString() ?? string.Empty,
ProductLine = reader["ProductLine"].ToString() ?? string.Empty
⋮----
/// Searches for parts by description pattern
/// Uses: 04_SearchPartsByDescription.sql
⋮----
/// <param name="searchTerm"></param>
/// <param name="maxResults"></param>
public async Task<Model_Dao_Result<List<Model_InforVisualPart>>> SearchPartsByDescriptionAsync(
⋮----
var query = Helper_SqlQueryLoader.LoadAndPrepareQuery("04_SearchPartsByDescription.sql");
⋮----
command.Parameters.AddWithValue("@SearchTerm", searchTerm);
command.Parameters.AddWithValue("@MaxResults", maxResults);
⋮----
parts.Add(new Model_InforVisualPart
⋮----
return Model_Dao_Result_Factory.Success(parts);
</file>

<file path="Module_Core/Data/InforVisual/Dao_InforVisualPart.cs">
public class Dao_InforVisualPart
⋮----
private static void ValidateReadOnlyConnection(string connectionString)
⋮----
if (string.IsNullOrWhiteSpace(connectionString))
⋮----
throw new ArgumentNullException(nameof(connectionString));
⋮----
var builder = new SqlConnectionStringBuilder(connectionString);
⋮----
throw new InvalidOperationException(
⋮----
public async Task<Model_Dao_Result<Model_InforVisualPart>> GetByPartNumberAsync(string partNumber)
⋮----
await using var connection = new SqlConnection(_connectionString);
await connection.OpenAsync();
⋮----
var query = Helper_SqlQueryLoader.LoadAndPrepareQuery("03_GetPartByNumber.sql");
⋮----
await using var command = new SqlCommand(query, connection);
command.Parameters.AddWithValue("@PartNumber", partNumber);
⋮----
await using var reader = await command.ExecuteReaderAsync();
if (await reader.ReadAsync())
⋮----
var part = new Model_InforVisualPart
⋮----
PartNumber = reader["PartNumber"].ToString() ?? string.Empty,
Description = reader["Description"].ToString() ?? string.Empty,
PartType = reader["PartType"].ToString() ?? string.Empty,
UnitCost = Convert.ToDecimal(reader["UnitCost"]),
PrimaryUom = reader["PrimaryUom"].ToString() ?? "EA",
OnHandQty = Convert.ToDecimal(reader["OnHandQty"]),
AllocatedQty = Convert.ToDecimal(reader["AllocatedQty"]),
AvailableQty = Convert.ToDecimal(reader["AvailableQty"]),
DefaultSite = reader["DefaultSite"].ToString() ?? "002",
PartStatus = reader["PartStatus"].ToString() ?? "ACTIVE",
ProductLine = reader["ProductLine"].ToString() ?? string.Empty
⋮----
return Model_Dao_Result_Factory.Success(part);
⋮----
public async Task<Model_Dao_Result<List<Model_InforVisualPart>>> SearchPartsByDescriptionAsync(
⋮----
var query = Helper_SqlQueryLoader.LoadAndPrepareQuery("04_SearchPartsByDescription.sql");
⋮----
command.Parameters.AddWithValue("@SearchTerm", searchTerm);
command.Parameters.AddWithValue("@MaxResults", maxResults);
⋮----
while (await reader.ReadAsync())
⋮----
list.Add(new Model_InforVisualPart
⋮----
return Model_Dao_Result_Factory.Success(list);
</file>

<file path="Module_Core/Data/InforVisual/Dao_InforVisualPO.cs">
public class Dao_InforVisualPO
⋮----
private static void ValidateReadOnlyConnection(string connectionString)
⋮----
if (string.IsNullOrWhiteSpace(connectionString))
⋮----
throw new ArgumentNullException(nameof(connectionString));
⋮----
var builder = new SqlConnectionStringBuilder(connectionString);
⋮----
throw new InvalidOperationException(
⋮----
public async Task<Model_Dao_Result<List<Model_InforVisualPO>>> GetByPoNumberAsync(string poNumber)
⋮----
await using var connection = new SqlConnection(_connectionString);
await connection.OpenAsync();
⋮----
var query = Helper_SqlQueryLoader.LoadAndPrepareQuery("01_GetPOWithParts.sql");
⋮----
await using var command = new SqlCommand(query, connection);
command.Parameters.AddWithValue("@PoNumber", poNumber);
⋮----
await using var reader = await command.ExecuteReaderAsync();
while (await reader.ReadAsync())
⋮----
list.Add(new Model_InforVisualPO
⋮----
PoNumber = reader["PoNumber"].ToString() ?? string.Empty,
PoLine = Convert.ToInt32(reader["PoLine"]),
PartNumber = reader["PartNumber"].ToString() ?? string.Empty,
PartDescription = reader["PartDescription"].ToString() ?? string.Empty,
OrderedQty = Convert.ToDecimal(reader["OrderedQty"]),
ReceivedQty = Convert.ToDecimal(reader["ReceivedQty"]),
RemainingQty = Convert.ToDecimal(reader["RemainingQty"]),
UnitOfMeasure = reader["UnitOfMeasure"].ToString() ?? "EA",
DueDate = reader["DueDate"] == DBNull.Value ? null : Convert.ToDateTime(reader["DueDate"]),
VendorCode = reader["VendorCode"].ToString() ?? string.Empty,
VendorName = reader["VendorName"].ToString() ?? string.Empty,
PoStatus = reader["PoStatus"].ToString() ?? string.Empty,
SiteId = reader["SiteId"].ToString() ?? "002"
⋮----
return Model_Dao_Result_Factory.Success(list);
⋮----
public async Task<Model_Dao_Result<bool>> ValidatePoNumberAsync(string poNumber)
⋮----
var query = Helper_SqlQueryLoader.LoadAndPrepareQuery("02_ValidatePONumber.sql");
⋮----
var count = Convert.ToInt32(await command.ExecuteScalarAsync());
⋮----
return Model_Dao_Result_Factory.Success(isValid);
</file>

<file path="Module_Core/Helpers/Database/Helper_SqlQueryLoader.cs">
/// <summary>
/// Helper class to load SQL queries from embedded resource files
/// </summary>
public static class Helper_SqlQueryLoader
⋮----
/// Loads a SQL query from an embedded resource file
⋮----
/// <param name="resourcePath">Path to the SQL file relative to Database/InforVisual (e.g., "01_GetPOWithParts.sql")</param>
/// <returns>The SQL query text</returns>
public static string LoadInforVisualQuery(string resourcePath)
⋮----
// Get the executing assembly
var assembly = Assembly.GetExecutingAssembly();
⋮----
using var stream = assembly.GetManifestResourceStream(resourceName);
⋮----
// Fallback: Try to load from file system during development
⋮----
var filePath = Path.Combine(baseDir, "Database", "InforVisualScripts", "Queries", resourcePath);
⋮----
if (File.Exists(filePath))
⋮----
return File.ReadAllText(filePath);
⋮----
// Try relative to solution root
var solutionRoot = Directory.GetParent(baseDir)?.Parent?.Parent?.Parent?.FullName;
⋮----
filePath = Path.Combine(solutionRoot, "Database", "InforVisualScripts", "Queries", resourcePath);
⋮----
throw new FileNotFoundException($"SQL query file not found: {resourcePath}. Resource name attempted: {resourceName}");
⋮----
using var reader = new StreamReader(stream);
return reader.ReadToEnd();
⋮----
throw new InvalidOperationException($"Failed to load SQL query from {resourcePath}: {ex.Message}", ex);
⋮----
/// Cleans a SQL query by removing comments and normalizing whitespace
⋮----
/// <param name="sql">Raw SQL text</param>
/// <returns>Cleaned SQL query ready for execution</returns>
public static string CleanQuery(string sql)
⋮----
if (string.IsNullOrWhiteSpace(sql))
⋮----
// Remove single-line comments (-- comments)
var lines = sql.Split(new[] { "\r\n", "\r", "\n" }, StringSplitOptions.None);
⋮----
var trimmedLine = line.Trim();
⋮----
// Skip comment-only lines
if (trimmedLine.StartsWith("--"))
⋮----
// Remove inline comments
var commentIndex = line.IndexOf("--");
⋮----
var lineWithoutComment = line.Substring(0, commentIndex).TrimEnd();
if (!string.IsNullOrWhiteSpace(lineWithoutComment))
⋮----
cleanedLines.Add(lineWithoutComment);
⋮----
else if (!string.IsNullOrWhiteSpace(line))
⋮----
cleanedLines.Add(line);
⋮----
return string.Join(Environment.NewLine, cleanedLines);
⋮----
/// Extracts the actual query from a SQL file that includes DECLARE statements for testing
⋮----
/// <param name="sqlFileContent">Full SQL file content with DECLAREs</param>
/// <returns>Just the SELECT/query portion without DECLARE statements</returns>
public static string ExtractQueryFromFile(string sqlFileContent)
⋮----
if (string.IsNullOrWhiteSpace(sqlFileContent))
⋮----
// Find the start of the actual query (after DECLARE statements)
var lines = sqlFileContent.Split(new[] { "\r\n", "\r", "\n" }, StringSplitOptions.None);
⋮----
// Skip comments
⋮----
// Skip DECLARE statements
if (trimmedLine.StartsWith("DECLARE", StringComparison.OrdinalIgnoreCase))
⋮----
// Look for SELECT, WITH, INSERT, UPDATE, DELETE as query start
⋮----
(trimmedLine.StartsWith("SELECT", StringComparison.OrdinalIgnoreCase) ||
trimmedLine.StartsWith("WITH", StringComparison.OrdinalIgnoreCase) ||
trimmedLine.StartsWith("INSERT", StringComparison.OrdinalIgnoreCase) ||
trimmedLine.StartsWith("UPDATE", StringComparison.OrdinalIgnoreCase) ||
trimmedLine.StartsWith("DELETE", StringComparison.OrdinalIgnoreCase)))
⋮----
if (foundQueryStart && !string.IsNullOrWhiteSpace(line))
⋮----
queryLines.Add(line);
⋮----
return string.Join(Environment.NewLine, queryLines);
⋮----
/// Loads and prepares a SQL query for execution (removes test DECLAREs and comments)
⋮----
/// <param name="resourcePath">SQL file name</param>
/// <returns>Clean, executable SQL query</returns>
public static string LoadAndPrepareQuery(string resourcePath)
⋮----
return extractedQuery.Trim();
</file>

<file path="Module_Core/Helpers/UI/Helper_MaterialIcons.cs">
public static class Helper_MaterialIcons
⋮----
public static List<MaterialIconKind> GetAllIcons()
⋮----
_allIcons = Enum.GetValues<MaterialIconKind>().ToList();
⋮----
public static IEnumerable<MaterialIconKind> SearchIcons(string searchText)
⋮----
if (string.IsNullOrWhiteSpace(searchText))
⋮----
searchText = searchText.ToLower().Trim();
return all.Where(k => k.ToString().ToLower().Contains(searchText));
</file>

<file path="Module_Core/Helpers/UI/Helper_WindowExtensions.cs">
/// <summary>
/// Extension methods for WinUI 3 Window configuration
/// Provides simplified window sizing, positioning, and presenter configuration
/// </summary>
public static class Helper_WindowExtensions
⋮----
/// Sets the window size
⋮----
/// <param name="window">The window to resize</param>
/// <param name="width">Desired width in pixels</param>
/// <param name="height">Desired height in pixels</param>
public static void SetWindowSize(this Window window, int width, int height)
⋮----
var appWindow = window.GetAppWindow();
appWindow.Resize(new Windows.Graphics.SizeInt32(width, height));
⋮----
/// Centers the window on the primary display
⋮----
/// <param name="window">The window to center</param>
public static void CenterOnScreen(this Window window)
⋮----
appWindow.Move(new Windows.Graphics.PointInt32(x, y));
⋮----
/// Configures the window as non-resizable (fixed size)
⋮----
/// <param name="window">The window to configure</param>
/// <param name="disableMaximize">Whether to disable maximize button</param>
/// <param name="disableMinimize">Whether to disable minimize button</param>
public static void SetFixedSize(this Window window, bool disableMaximize = true, bool disableMinimize = true)
⋮----
/// Hides the title bar icon and system menu
⋮----
public static void HideTitleBarIcon(this Window window)
⋮----
/// Extends content into the title bar area (custom title bar)
⋮----
/// <param name="customTitleBarElement">Optional custom title bar element</param>
public static void UseCustomTitleBar(this Window window, UIElement? customTitleBarElement = null)
⋮----
window.SetTitleBar(customTitleBarElement);
⋮----
/// Makes the title bar transparent (for splash screens)
⋮----
public static void MakeTitleBarTransparent(this Window window)
⋮----
/// Gets the AppWindow from a WinUI 3 Window
⋮----
/// <param name="window"></param>
private static AppWindow GetAppWindow(this Window window)
⋮----
var hWnd = WindowNative.GetWindowHandle(window);
var windowId = Microsoft.UI.Win32Interop.GetWindowIdFromWindow(hWnd);
return AppWindow.GetFromWindowId(windowId);
</file>

<file path="Module_Core/Helpers/UI/Helper_WorkflowHelpContentGenerator.cs">
public static class Helper_WorkflowHelpContentGenerator
⋮----
public static UIElement GenerateHelpContent(Enum_ReceivingWorkflowStep step)
⋮----
private static UIElement CreateModeSelectionHelp()
⋮----
private static UIElement CreateManualEntryHelp()
⋮----
private static UIElement CreatePOEntryHelp()
⋮----
private static UIElement CreateLoadEntryHelp()
⋮----
private static UIElement CreateWeightQuantityHelp()
⋮----
private static UIElement CreateHeatLotHelp()
⋮----
private static UIElement CreatePackageTypeHelp()
⋮----
private static UIElement CreateReviewHelp()
⋮----
private static UIElement CreateDefaultHelp()
⋮----
var stack = new StackPanel { Spacing = 12, Padding = new Thickness(4), MaxWidth = 450 };
⋮----
var title = new TextBlock
⋮----
var description = new TextBlock
⋮----
stack.Children.Add(title);
stack.Children.Add(description);
⋮----
private static UIElement CreateHelpPanel(string title, string description, (string header, string content)[] sections)
⋮----
var mainStack = new StackPanel { Spacing = 20, Padding = new Thickness(4), MaxWidth = 450 };
⋮----
// Title Section
var titleStack = new StackPanel { Spacing = 8 };
var titleText = new TextBlock
⋮----
var underline = new Border
⋮----
CornerRadius = new CornerRadius(1),
⋮----
var descText = new TextBlock
⋮----
titleStack.Children.Add(titleText);
titleStack.Children.Add(underline);
titleStack.Children.Add(descText);
mainStack.Children.Add(titleStack);
⋮----
// Content Sections
⋮----
var border = new Border
⋮----
Padding = new Thickness(16),
CornerRadius = new CornerRadius(8),
BorderThickness = new Thickness(1),
⋮----
var sectionStack = new StackPanel { Spacing = 8 };
⋮----
var headerText = new TextBlock
⋮----
var contentText = new TextBlock
⋮----
sectionStack.Children.Add(headerText);
sectionStack.Children.Add(contentText);
⋮----
mainStack.Children.Add(border);
</file>

<file path="Module_Core/Models/Core/Model_Dao_Result_Generic.cs">
/// <summary>
/// Generic version of Model_Dao_Result for returning data
/// </summary>
/// <typeparam name="T">Type of data returned</typeparam>
public class Model_Dao_Result<T> : Model_Dao_Result
⋮----
/// Data returned by the operation
</file>

<file path="Module_Core/Models/Core/Model_Dao_Result.cs">
/// <summary>
/// Standardized response object for all database operations
/// Provides success/failure status, error messages, and performance metrics
/// </summary>
public class Model_Dao_Result
⋮----
/// Indicates whether the database operation succeeded
⋮----
/// Alias for Success to match some usage patterns
⋮----
/// Error message if operation failed, empty string if successful
⋮----
/// Severity level of any error that occurred
⋮----
/// Number of rows affected by the database operation
⋮----
/// Execution time in milliseconds for performance monitoring
⋮----
/// Optional return value from the database operation (e.g., generated ID)
⋮----
/// Exception that caused the failure, if any
⋮----
// Static factory methods moved to DaoResultFactory to avoid circular dependencies
</file>

<file path="Module_Core/Models/Core/Model_HelpContent.cs">
/// <summary>
/// Model representing help content for the application
/// Used by IService_Help to provide contextual help, tips, tooltips, and tutorials
/// </summary>
public partial class Model_HelpContent : ObservableObject
⋮----
private Enum_HelpType _helpType = Enum_HelpType.Info;
⋮----
private Enum_HelpSeverity _severity = Enum_HelpSeverity.Info;
⋮----
private DateTime _lastUpdated = DateTime.Now;
⋮----
/// Gets the MaterialIconKind enum for displaying the icon
⋮----
if (!string.IsNullOrEmpty(Icon) && Enum.TryParse<MaterialIconKind>(Icon, true, out var kind))
</file>

<file path="Module_Core/Models/Enums/Enum_DataSourceType.cs">

</file>

<file path="Module_Core/Models/Enums/Enum_ErrorSeverity.cs">
/// <summary>
/// Categorizes error severity levels for logging and error handling
/// </summary>
⋮----
/// Informational message - no action required
⋮----
/// Low severity - minor issue
⋮----
/// Warning - potential issue but operation continues
⋮----
/// Medium severity - significant issue but application continues
⋮----
/// Error - operation failed but application continues
⋮----
/// Critical - serious issue requiring immediate attention
⋮----
/// Fatal - application cannot continue
</file>

<file path="Module_Core/Models/Enums/Enum_HelpSeverity.cs">
/// <summary>
/// Defines the severity level of help content
/// </summary>
⋮----
/// General information
⋮----
/// Important to know
⋮----
/// Critical information, must read
</file>

<file path="Module_Core/Models/Enums/Enum_HelpType.cs">
/// <summary>
/// Defines the type of help content
/// </summary>
⋮----
/// Quick tips and best practices
⋮----
/// Informational content
⋮----
/// Important warnings and cautions
⋮----
/// Step-by-step instructions
⋮----
/// Detailed reference material
</file>

<file path="Module_Core/Models/Enums/Enum_InfoBarSeverity.cs">

</file>

<file path="Module_Core/Models/Enums/Enum_LabelType.cs">
/// <summary>
/// Identifies the type of label being generated
/// </summary>
⋮----
/// Standard receiving label
⋮----
/// Dunnage/packing material label
⋮----
/// UPS or FedEx shipping label
⋮----
/// Mini receiving label variant
⋮----
/// Mini coil label variant
</file>

<file path="Module_Core/Models/Enums/Enum_PackageType.cs">

</file>

<file path="Module_Core/Models/Enums/Enum_ReceivingWorkflowStep.cs">
/// <summary>
/// Workflow steps enumeration for Receiving.
/// </summary>
</file>

<file path="Module_Core/Models/Enums/Enum_ValidationSeverity.cs">
/// <summary>
/// Severity level for validation results.
/// </summary>
</file>

<file path="Module_Core/Models/Systems/Model_AppSettings.cs">
/// <summary>
/// Application settings loaded from appsettings.json
/// </summary>
public class Model_AppSettings
⋮----
/// If true, uses mock data instead of querying Infor Visual database
/// Useful for development/testing when Infor Visual server is unavailable
⋮----
/// Environment name (Development, Production, etc.)
</file>

<file path="Module_Core/Models/Systems/Model_CreateUserResult.cs">
/// <summary>
/// Result of a user creation attempt.
/// </summary>
public class Model_CreateUserResult
⋮----
public static Model_CreateUserResult SuccessResult(int employeeNumber) => new()
⋮----
public static Model_CreateUserResult ErrorResult(string message) => new()
</file>

<file path="Module_Core/Models/Systems/Model_SessionTimedOutEventArgs.cs">
public class Model_SessionTimedOutEventArgs : EventArgs
</file>

<file path="Module_Core/Services/Authentication/Service_UserSessionManager.cs">
/// <summary>
/// Service implementation for session management and timeout monitoring.
/// Uses IDispatcherService to check for session timeouts every 60 seconds.
/// </summary>
public class Service_UserSessionManager : IService_UserSessionManager
⋮----
private readonly Dao_User _daoUser;
private readonly IService_Dispatcher _dispatcherService;
⋮----
/// Constructor with dependency injection.
⋮----
/// <param name="daoUser">User data access object for activity logging</param>
/// <param name="dispatcherService">Dispatcher service for timer operations</param>
⋮----
_daoUser = daoUser ?? throw new ArgumentNullException(nameof(daoUser));
_dispatcherService = dispatcherService ?? throw new ArgumentNullException(nameof(dispatcherService));
⋮----
// ====================================================================
// Properties
⋮----
/// <inheritdoc/>
⋮----
// Session Management
⋮----
public Model_UserSession CreateSession(
⋮----
throw new ArgumentNullException(nameof(user));
⋮----
throw new ArgumentNullException(nameof(workstationConfig));
⋮----
CurrentSession = new Model_UserSession
⋮----
public void UpdateLastActivity()
⋮----
// Timeout Monitoring
⋮----
public void StartTimeoutMonitoring()
⋮----
throw new InvalidOperationException("Cannot start timeout monitoring without an active session");
⋮----
// Stop existing timer if running
⋮----
// Create new timer
_timeoutTimer = _dispatcherService.CreateTimer();
_timeoutTimer.Interval = TimeSpan.FromSeconds(TimerIntervalSeconds);
⋮----
_timeoutTimer.Start();
⋮----
System.Diagnostics.Debug.WriteLine($"Session timeout monitoring started. Timeout: {CurrentSession.TimeoutDuration.TotalMinutes} minutes");
⋮----
public void StopTimeoutMonitoring()
⋮----
_timeoutTimer.Stop();
⋮----
System.Diagnostics.Debug.WriteLine("Session timeout monitoring stopped");
⋮----
public bool IsSessionTimedOut()
⋮----
public async Task EndSessionAsync(string reason)
⋮----
// Log session end
await _daoUser.LogUserActivityAsync(
⋮----
System.Diagnostics.Debug.WriteLine($"Session ended. Reason: {reason}");
⋮----
System.Diagnostics.Debug.WriteLine($"Failed to log session end: {ex.Message}");
⋮----
// Clean up
⋮----
// Events
⋮----
// Private Methods
⋮----
/// Timer tick handler - checks for session timeout.
⋮----
/// <param name="sender"></param>
/// <param name="args"></param>
private void OnTimerTick(object? sender, object args)
⋮----
System.Diagnostics.Debug.WriteLine(
⋮----
// Raise timeout event
SessionTimedOut?.Invoke(this, new Model_SessionTimedOutEventArgs
⋮----
// Stop monitoring (app will close)
</file>

<file path="Module_Core/Services/Database/Service_ErrorHandler.cs">
/// <summary>
/// Centralized error handling service
/// Logs errors and displays user-friendly WinUI 3 dialogs
/// </summary>
public class Service_ErrorHandler : IService_ErrorHandler
⋮----
private readonly IService_LoggingUtility _loggingService;
private readonly IService_Window _windowService;
⋮----
_loggingService = loggingService ?? throw new ArgumentNullException(nameof(loggingService));
_windowService = windowService ?? throw new ArgumentNullException(nameof(windowService));
⋮----
/// Handles an error by logging it and optionally displaying a dialog
⋮----
/// <param name="errorMessage"></param>
/// <param name="severity"></param>
/// <param name="exception"></param>
/// <param name="showDialog"></param>
public async Task HandleErrorAsync(
⋮----
// Log the error
⋮----
// Show dialog if requested
⋮----
/// Logs an error without displaying a dialog
⋮----
public Task LogErrorAsync(
⋮----
return Task.Run(() =>
⋮----
_loggingService.LogInfo(errorMessage);
⋮----
_loggingService.LogWarning(errorMessage);
⋮----
_loggingService.LogError(errorMessage, exception);
⋮----
_loggingService.LogCritical(errorMessage, exception);
⋮----
_loggingService.LogFatal(errorMessage, exception);
⋮----
/// Displays a user-friendly error dialog using WinUI 3 ContentDialog
⋮----
/// <param name="title"></param>
/// <param name="message"></param>
⋮----
public async Task ShowErrorDialogAsync(
⋮----
// Get the main window's XamlRoot for dialog display
// Note: App.MainWindow is static but might not be accessible in all contexts (e.g. tests)
// We use a safe access pattern or dependency injection for window provider in a real app
// For now, we assume App.MainWindow is available as it's a static property of the App class
// However, since 'App' is in the root namespace, we might need to qualify it or ensure it's accessible.
// If 'App' is not found, it might be because we are in a library or test context where App is not defined or accessible.
// In WinUI 3, (Application.Current as App)?.MainWindow is a common pattern.
⋮----
// Using dynamic to avoid direct dependency on App class which might not be visible here
// or simply checking Application.Current
⋮----
// Use IWindowService to get the XamlRoot
var xamlRoot = _windowService.GetXamlRoot();
⋮----
// Fallback: Just log if we can't show dialog
_loggingService.LogWarning("Cannot show dialog - XamlRoot is null");
⋮----
var dialog = new ContentDialog
⋮----
// Set dialog style based on severity (could be enhanced with custom styles)
// For now, just show the dialog
await dialog.ShowAsync();
⋮----
// If dialog fails, at least log it
_loggingService.LogError($"Failed to show error dialog: {ex.Message}", ex);
⋮----
/// Handles a Model_Dao_Result error by logging and optionally displaying
⋮----
/// <param name="result"></param>
/// <param name="operationName"></param>
⋮----
public async Task HandleDaoErrorAsync(
⋮----
// Not an error
⋮----
public Task ShowUserErrorAsync(string message, string title, string method)
⋮----
public void HandleException(Exception ex, Enum_ErrorSeverity severity, string method, string className)
⋮----
/// Gets appropriate dialog title based on severity
⋮----
private static string GetDialogTitle(Enum_ErrorSeverity severity)
</file>

<file path="Module_Core/Services/Database/Service_InforVisualConnect.cs">
/// <summary>
/// Service for connecting to and querying Infor Visual database (SQL Server)
/// ⚠️ STRICTLY READ ONLY - NO WRITES ALLOWED TO INFOR VISUAL ⚠️
/// Server: VISUAL, Database: MTMFG, Warehouse: 002
/// </summary>
public class Service_InforVisualConnect : IService_InforVisual
⋮----
private readonly Dao_InforVisualConnection _dao;
⋮----
_dao = dao ?? throw new ArgumentNullException(nameof(dao));
⋮----
public async Task<bool> TestConnectionAsync()
⋮----
var result = await _dao.TestConnectionAsync();
⋮----
public async Task<Model_Dao_Result<Model_InforVisualPO?>> GetPOWithPartsAsync(string poNumber)
⋮----
if (string.IsNullOrWhiteSpace(poNumber))
⋮----
// Use the PO number as provided - Infor Visual IDs include the prefix (e.g. "PO-123456")
⋮----
var result = await _dao.GetPOWithPartsAsync(cleanPoNumber);
⋮----
// Convert flat DAO model to hierarchical service model
⋮----
public async Task<Model_Dao_Result<Model_InforVisualPart?>> GetPartByIDAsync(string partID)
⋮----
if (string.IsNullOrWhiteSpace(partID))
⋮----
var result = await _dao.GetPartByNumberAsync(partID);
⋮----
// Convert DAO model to service model
⋮----
public async Task<Model_Dao_Result<decimal>> GetSameDayReceivingQuantityAsync(
⋮----
// This functionality requires custom query/stored procedure in Infor Visual
// Not implemented in current SQL files
⋮----
public async Task<Model_Dao_Result<int>> GetRemainingQuantityAsync(string poNumber, string partID)
⋮----
var result = await _dao.GetPOWithPartsAsync(poNumber);
⋮----
var matchingLine = result.Data.FirstOrDefault(line =>
line.PartNumber.Equals(partID, StringComparison.OrdinalIgnoreCase));
⋮----
/// Converts flat DAO PO lines to hierarchical service model
⋮----
/// <param name="poLines"></param>
private Model_InforVisualPO ConvertToServiceModel(List<Models.InforVisual.Model_InforVisualPO> poLines)
⋮----
return new Model_InforVisualPO
⋮----
Parts = poLines.ConvertAll(line => new Model_InforVisualPart
⋮----
POLineNumber = line.PoLine.ToString(),
PartType = "FG", // Default - could be enhanced with additional query
⋮----
/// Converts DAO part model to service model
⋮----
/// <param name="daoPart"></param>
private Model_InforVisualPart ConvertPartToServiceModel(Models.InforVisual.Model_InforVisualPart daoPart)
⋮----
return new Model_InforVisualPart
⋮----
PartType = "FG", // Default
⋮----
private Model_Dao_Result<Model_InforVisualPO?> CreateMockPO(string poNumber)
⋮----
var mockPO = new Model_InforVisualPO
⋮----
new Model_InforVisualPart
⋮----
private Model_Dao_Result<Model_InforVisualPart?> CreateMockPart(string partID)
⋮----
var mockPart = new Model_InforVisualPart
</file>

<file path="Module_Core/Services/Help/Service_Help.cs">
/// <summary>
/// Service for providing contextual help content throughout the application
/// </summary>
public class Service_Help : IService_Help
⋮----
private readonly IService_Window _windowService;
private readonly IService_LoggingUtility _logger;
private readonly IService_Dispatcher _dispatcher;
⋮----
public async Task ShowHelpAsync(string helpKey)
⋮----
await _logger.LogWarningAsync($"Help content not found for key: {helpKey}");
⋮----
// Must execute on UI thread since we're showing a dialog
⋮----
_dispatcher.TryEnqueue(async () =>
⋮----
await _logger.LogErrorAsync("Failed to retrieve HelpDialog from DI container");
tcs.SetResult(false);
⋮----
dialog.SetHelpContent(content);
dialog.XamlRoot = _windowService.GetXamlRoot();
⋮----
await _logger.LogErrorAsync("XamlRoot is null, cannot show help dialog");
⋮----
await dialog.ShowAsync();
await _logger.LogInfoAsync($"Displayed help for: {helpKey}");
tcs.SetResult(true);
⋮----
await _logger.LogErrorAsync($"Error in UI thread: {ex.Message}");
tcs.SetException(ex);
⋮----
await _logger.LogErrorAsync($"Error showing help for key {helpKey}: {ex.Message}");
⋮----
public async Task ShowContextualHelpAsync(Enum_DunnageWorkflowStep step)
⋮----
public async Task ShowContextualHelpAsync(Enum_ReceivingWorkflowStep step)
⋮----
public Model_HelpContent? GetHelpContent(string key)
⋮----
return _helpContentCache.TryGetValue(key, out var content) ? content : null;
⋮----
public List<Model_HelpContent> GetHelpByCategory(string category)
⋮----
.Where(c => c.Category.Equals(category, StringComparison.OrdinalIgnoreCase))
.OrderBy(c => c.Title)
.ToList();
⋮----
public List<Model_HelpContent> SearchHelp(string searchTerm)
⋮----
if (string.IsNullOrWhiteSpace(searchTerm))
⋮----
var term = searchTerm.ToLower();
⋮----
.Where(c => c.Title.ToLower().Contains(term) || c.Content.ToLower().Contains(term))
.OrderByDescending(c => c.Title.ToLower().Contains(term))
.ThenBy(c => c.Title)
.Take(20)
⋮----
public async Task<bool> IsDismissedAsync(string helpKey)
⋮----
return _dismissedTips.Contains(helpKey);
⋮----
public async Task SetDismissedAsync(string helpKey, bool isDismissed)
⋮----
_dismissedTips.Add(helpKey);
⋮----
_dismissedTips.Remove(helpKey);
⋮----
public string GetDunnageWorkflowHelp(Enum_DunnageWorkflowStep step)
⋮----
public string GetReceivingWorkflowHelp(Enum_ReceivingWorkflowStep step)
⋮----
public string GetTip(string viewName)
⋮----
public string GetPlaceholder(string fieldName)
⋮----
public string GetTooltip(string elementName)
⋮----
public string GetInfoBarMessage(string messageKey)
⋮----
private void InitializeHelpContent()
⋮----
// Dunnage Workflow Help Content
⋮----
// Receiving Workflow Help Content
⋮----
// Admin Help Content
⋮----
// Tooltips
⋮----
// Placeholders
⋮----
// Tips
⋮----
// InfoBar Messages
⋮----
private void InitializeDunnageHelp()
⋮----
AddHelpContent(new Model_HelpContent
⋮----
private void InitializeReceivingHelp()
⋮----
private void InitializeAdminHelp()
⋮----
private void InitializeTooltips()
⋮----
// Navigation tooltips
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.FirstPage", Content = "First Page", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.PreviousPage", Content = "Previous Page", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.NextPage", Content = "Next Page", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.LastPage", Content = "Last Page", HelpType = Enum_HelpType.Tip });
⋮----
// Mode selection quick access
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.QuickGuidedWizard", Content = "Skip mode selection and go directly to Guided Wizard", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.QuickManualEntry", Content = "Skip mode selection and go directly to Manual Entry", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.QuickEditMode", Content = "Skip mode selection and go directly to Edit Mode", HelpType = Enum_HelpType.Tip });
⋮----
// Workflow actions
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.ReturnToModeSelection", Content = "Return to mode selection (clears current work)", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.ShowHelp", Content = "Click for help about current step", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.Refresh", Content = "Refresh parts list", HelpType = Enum_HelpType.Tip });
⋮----
// Manual entry operations
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.AddMultipleRows", Content = "Add multiple rows at once (up to 100)", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.AutoFill", Content = "Auto-fill from last entry for this Part ID", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.FillBlanks", Content = "Copy PO, Location, and specs from last row to empty fields", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.SortForPrinting", Content = "Sort by Part ID â†’ PO â†’ Type", HelpType = Enum_HelpType.Tip });
⋮----
// Edit mode data sources
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.LoadSessionMemory", Content = "Load unsaved loads from current session", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.LoadRecentCSV", Content = "Load from most recent CSV export", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.LoadHistoricalData", Content = "Load historical loads from database", HelpType = Enum_HelpType.Tip });
⋮----
// Admin operations
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.CreateType", Content = "Create a new dunnage type", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.EditType", Content = "Edit selected type", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.DeleteType", Content = "Delete selected type with impact analysis", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.ReturnToAdmin", Content = "Return to admin main navigation", HelpType = Enum_HelpType.Tip });
⋮----
// Admin Parts
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.CreatePart", Content = "Create a new dunnage part", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.EditPart", Content = "Edit selected part", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.DeletePart", Content = "Delete selected part", HelpType = Enum_HelpType.Tip });
⋮----
// Edit Mode
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.RemoveSelectedRows", Content = "Remove all selected rows", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.FilterLastWeek", Content = "Show loads from last 7 days", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.FilterToday", Content = "Show loads from today only", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.FilterThisWeek", Content = "Show loads from this week (Mon-Sun)", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.FilterThisMonth", Content = "Show loads from this month", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.FilterThisQuarter", Content = "Show loads from this quarter", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.FilterShowAll", Content = "Show all loads from last year", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.SaveChanges", Content = "Save all changes to database", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.SelectAll", Content = "Select or deselect all rows", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.RemoveRow", Content = "Remove selected rows", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.ClearFilters", Content = "Remove all date filters", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.GoToPage", Content = "Go to specified page", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.SaveAndFinish", Content = "Save all changes and finish", HelpType = Enum_HelpType.Tip });
⋮----
// Manual Entry
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.AddRow", Content = "Add a new row to the grid", HelpType = Enum_HelpType.Tip });
⋮----
// Quick Add Dialog
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.HelpDunnageTypes", Content = "Click for help about dunnage types", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Field.TypeName", Content = "Enter a unique descriptive name for this dunnage type", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.SelectIcon", Content = "Click to browse and select an icon from the icon library", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Field.SpecName", Content = "Enter a unique name for this specification field", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Field.SpecType", Content = "Select the data type for this field", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Field.MinValue", Content = "Minimum allowed value (optional)", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Field.MaxValue", Content = "Maximum allowed value (optional)", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Field.Unit", Content = "Unit of measurement to display (optional)", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Field.Required", Content = "Check if this field must be filled when creating parts", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.AddSpec", Content = "Add this specification to the list below", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.List.Specs", Content = "List of specifications defined for this type", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.RemoveSpec", Content = "Remove this specification", HelpType = Enum_HelpType.Tip });
⋮----
// Review View
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.AddAnother", Content = "Add another load to the current batch", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.SaveAndGenerate", Content = "Save all entries to database and generate labels", HelpType = Enum_HelpType.Tip });
⋮----
// Workflow View
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.ModeSelection", Content = "Return to mode selection (clears current work)", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.StepHelp", Content = "Click for help about the current step", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.BackStep", Content = "Go back to previous step", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.NextStep", Content = "Proceed to next step", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.SaveAndReview", Content = "Save entry and proceed to review", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.StartNew", Content = "Start a new receiving entry", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.ResetCSV", Content = "Clear the CSV data and start over", HelpType = Enum_HelpType.Tip });
⋮----
// Receiving PO Entry
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.LoadPO", Content = "Load purchase order details from Infor Visual", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.SwitchToNonPO", Content = "Switch to non-PO entry mode for items without purchase orders", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.LookupPart", Content = "Look up part details in the system", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Tooltip.Button.SwitchToPO", Content = "Switch to PO entry mode", HelpType = Enum_HelpType.Tip });
⋮----
private void InitializePlaceholders()
⋮----
// Dunnage placeholders
AddHelpContent(new Model_HelpContent { Key = "Placeholder.Field.Quantity", Content = "Enter quantity...", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Placeholder.Field.PONumber", Content = "Enter PO number (optional)...", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Placeholder.Field.Location", Content = "Enter location...", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Placeholder.Field.PartSelection", Content = "Choose a part...", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Placeholder.Field.HeatLotNumber", Content = "Enter heat/lot number or leave blank", HelpType = Enum_HelpType.Tip });
⋮----
// Receiving placeholders
AddHelpContent(new Model_HelpContent { Key = "Placeholder.Field.PONumberReceiving", Content = "Enter PO (e.g., 66868 or PO-066868)", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Placeholder.Field.PartID", Content = "Enter Part ID (e.g., MMC-001, MMF-456)", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Placeholder.Field.Weight", Content = "Enter weight...", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Placeholder.Field.QuantityNumber", Content = "Enter whole number", HelpType = Enum_HelpType.Tip });
⋮----
// Date placeholders
AddHelpContent(new Model_HelpContent { Key = "Placeholder.Field.StartDate", Content = "Start Date", HelpType = Enum_HelpType.Tip });
AddHelpContent(new Model_HelpContent { Key = "Placeholder.Field.EndDate", Content = "End Date", HelpType = Enum_HelpType.Tip });
⋮----
private void InitializeTips()
⋮----
// Dunnage Tips
⋮----
// Receiving Tips
⋮----
private void InitializeInfoBarMessages()
⋮----
private void AddHelpContent(Model_HelpContent content)
⋮----
if (!string.IsNullOrEmpty(content.Key))
</file>

<file path="Module_Core/Services/Navigation/Service_Navigation.cs">
/// <summary>
/// Service for handling page navigation
/// </summary>
public class Service_Navigation : IService_Navigation
⋮----
private readonly IService_LoggingUtility _logger;
⋮----
public bool NavigateTo(Frame frame, Type pageType, object? parameter = null)
⋮----
_logger.LogError("Navigation frame is null", null, "Service_Navigation");
⋮----
_logger.LogError("Page type is null", null, "Service_Navigation");
⋮----
var result = frame.Navigate(pageType, parameter);
⋮----
_logger.LogInfo($"Navigated to {pageType.Name}", "Service_Navigation");
⋮----
_logger.LogWarning($"Failed to navigate to {pageType.Name}", "Service_Navigation");
⋮----
_logger.LogError($"Navigation error: {ex.Message}", ex, "Service_Navigation");
⋮----
public bool NavigateTo(Frame frame, string pageTypeName, object? parameter = null)
⋮----
var pageType = Type.GetType(pageTypeName);
⋮----
_logger.LogError($"Could not find type: {pageTypeName}", null, "Service_Navigation");
⋮----
public void ClearNavigation(Frame frame)
⋮----
_logger.LogInfo("Navigation cleared", "Service_Navigation");
⋮----
public bool CanGoBack(Frame frame)
⋮----
public void GoBack(Frame frame)
⋮----
frame.GoBack();
_logger.LogInfo("Navigated back", "Service_Navigation");
</file>

<file path="Module_Core/Services/Service_Dispatcher.cs">
/// <summary>
/// Implementation of IDispatcherService using WinUI DispatcherQueue.
/// </summary>
public class Service_Dispatcher : IService_Dispatcher
⋮----
private readonly DispatcherQueue _dispatcherQueue;
⋮----
_dispatcherQueue = dispatcherQueue ?? throw new ArgumentNullException(nameof(dispatcherQueue));
⋮----
public IService_DispatcherTimer CreateTimer()
⋮----
return new Service_DispatcherTimerWrapper(_dispatcherQueue.CreateTimer());
⋮----
public bool TryEnqueue(Action callback)
⋮----
return _dispatcherQueue.TryEnqueue(() => callback());
</file>

<file path="Module_Core/Services/Service_DispatcherTimerWrapper.cs">
/// <summary>
/// Wrapper for DispatcherQueueTimer.
/// </summary>
public class Service_DispatcherTimerWrapper : IService_DispatcherTimer
⋮----
private readonly DispatcherQueueTimer _timer;
⋮----
_timer = timer ?? throw new ArgumentNullException(nameof(timer));
⋮----
public void Start() => _timer.Start();
⋮----
public void Stop() => _timer.Stop();
</file>

<file path="Module_Core/Services/Service_Notification.cs">
public partial class Service_Notification : ObservableObject, IService_Notification
⋮----
private readonly IService_Dispatcher _dispatcher;
⋮----
private InfoBarSeverity _statusSeverity = InfoBarSeverity.Informational;
⋮----
public void ShowStatus(string message, InfoBarSeverity severity = InfoBarSeverity.Informational)
⋮----
// Auto-dismiss after 5 seconds if informational or success
⋮----
Task.Delay(5000).ContinueWith(_ =>
⋮----
_dispatcher.TryEnqueue(() =>
</file>

<file path="Module_Core/Services/Service_Pagination.cs">
public class Service_Pagination : IService_Pagination
⋮----
/// <summary>
/// Default page size
/// </summary>
⋮----
return (int)Math.Ceiling((double)TotalItems / PageSize);
⋮----
CurrentPage = 1; // Reset to first page on size change
⋮----
public void SetSource<T>(IEnumerable<T> source)
⋮----
public IEnumerable<T> GetCurrentPageItems<T>()
⋮----
.Skip((CurrentPage - 1) * PageSize)
.Take(PageSize)
⋮----
public bool NextPage()
⋮----
public bool PreviousPage()
⋮----
public bool FirstPage()
⋮----
public bool LastPage()
⋮----
public bool GoToPage(int pageNumber)
⋮----
private void OnPageChanged()
</file>

<file path="Module_Core/Services/Service_Window.cs">
public class Service_Window : IService_Window
⋮----
public XamlRoot? GetXamlRoot()
</file>

<file path="Module_Core/Services/UI/Service_ViewModelRegistry.cs">
public class Service_ViewModelRegistry : IService_ViewModelRegistry
⋮----
public void Register(object viewModel)
⋮----
_viewModels.Add(new WeakReference<object>(viewModel));
⋮----
public IEnumerable<T> GetViewModels<T>()
⋮----
.Select(r => r.TryGetTarget(out var target) ? target : null)
.Where(t => t != null && t is T)
⋮----
public void ClearAllInputs()
⋮----
if (vmRef.TryGetTarget(out var vm))
⋮----
resettable.ResetToDefaults();
⋮----
private void Cleanup()
⋮----
_viewModels.RemoveAll(r => !r.TryGetTarget(out _));
</file>

<file path="Module_Core/Themes/MaterialIcons.xaml">
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="using:Material.Icons.WinUI3">

  <Style TargetType="local:MaterialIcon">
    <Setter Property="IsTabStop" Value="False" />
    <Setter Property="FlowDirection" Value="LeftToRight" />
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="local:MaterialIcon">
          <Border Background="{TemplateBinding Background}"
                  BorderBrush="{TemplateBinding BorderBrush}"
                  BorderThickness="{TemplateBinding BorderThickness}">
            <Viewbox FlowDirection="{TemplateBinding FlowDirection}">
              <Canvas Width="24"
                      Height="24">
                <Path Data="{Binding Data, RelativeSource={RelativeSource TemplatedParent}}"
                      Fill="{TemplateBinding Foreground}" />
              </Canvas>
            </Viewbox>
          </Border>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>

  <Style TargetType="local:MaterialIconText">
    <Setter Property="IsTabStop" Value="False" />
    <Setter Property="FlowDirection" Value="LeftToRight" />
    <Setter Property="Spacing" Value="5" />
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="local:MaterialIconText">
          <StackPanel Orientation="{TemplateBinding Orientation}"
                      Spacing="{TemplateBinding Spacing}">
            <local:MaterialIcon Width="{TemplateBinding IconSize}"
                                Height="{TemplateBinding IconSize}"
                                Animation="{TemplateBinding Animation}"
                                Kind="{TemplateBinding Kind}" />
            <TextBlock Text="{TemplateBinding Text}" />
          </StackPanel>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>
</ResourceDictionary>
</file>

<file path="Module_Dunnage/Contracts/IService_MySQL_Dunnage.cs">
/// <summary>
/// Service for dunnage database operations.
/// Wraps DAOs with business logic validation and error handling.
/// </summary>
public interface IService_MySQL_Dunnage
⋮----
// ==================== Type Operations (7 methods) ====================
⋮----
public Task<Model_Dao_Result<List<Model_DunnageType>>> GetAllTypesAsync();
public Task<Model_Dao_Result<Model_DunnageType>> GetTypeByIdAsync(int typeId);
public Task<Model_Dao_Result<int>> InsertTypeAsync(string typeName, string icon);
public Task<Model_Dao_Result> InsertTypeAsync(Model_DunnageType type);
public Task<Model_Dao_Result> UpdateTypeAsync(Model_DunnageType type);
public Task<Model_Dao_Result> DeleteTypeAsync(int typeId);
public Task<Model_Dao_Result<int>> CheckDuplicateTypeNameAsync(string typeName);
⋮----
// ==================== Spec Operations (6 methods) ====================
⋮----
public Task<Model_Dao_Result<List<Model_DunnageSpec>>> GetSpecsForTypeAsync(int typeId);
public Task<Model_Dao_Result> InsertSpecAsync(Model_DunnageSpec spec);
public Task<Model_Dao_Result> UpdateSpecAsync(Model_DunnageSpec spec);
public Task<Model_Dao_Result> DeleteSpecAsync(int specId);
public Task<Model_Dao_Result> DeleteSpecsByTypeIdAsync(int typeId);
public Task<List<string>> GetAllSpecKeysAsync();
⋮----
// ==================== Part Operations (7 methods) ====================
⋮----
public Task<Model_Dao_Result<List<Model_DunnagePart>>> GetAllPartsAsync();
public Task<Model_Dao_Result<List<Model_DunnagePart>>> GetPartsByTypeAsync(int typeId);
public Task<Model_Dao_Result<Model_DunnagePart>> GetPartByIdAsync(string partId);
public Task<Model_Dao_Result> InsertPartAsync(Model_DunnagePart part);
public Task<Model_Dao_Result> UpdatePartAsync(Model_DunnagePart part);
public Task<Model_Dao_Result> DeletePartAsync(string partId);
public Task<Model_Dao_Result<List<Model_DunnagePart>>> SearchPartsAsync(string searchText, int? typeId = null);
⋮----
// ==================== Load Operations (6 methods) ====================
⋮----
public Task<Model_Dao_Result> SaveLoadsAsync(List<Model_DunnageLoad> loads);
public Task<Model_Dao_Result<List<Model_DunnageLoad>>> GetLoadsByDateRangeAsync(DateTime start, DateTime end);
public Task<Model_Dao_Result<List<Model_DunnageLoad>>> GetAllLoadsAsync();
public Task<Model_Dao_Result<Model_DunnageLoad>> GetLoadByIdAsync(string loadUuid);
public Task<Model_Dao_Result> UpdateLoadAsync(Model_DunnageLoad load);
public Task<Model_Dao_Result> DeleteLoadAsync(string loadUuid);
⋮----
// ==================== Inventory Operations (6 methods) ====================
⋮----
public Task<bool> IsPartInventoriedAsync(string partId);
public Task<Model_Dao_Result<Model_InventoriedDunnage>> GetInventoryDetailsAsync(string partId);
public Task<Model_Dao_Result<List<Model_InventoriedDunnage>>> GetAllInventoriedPartsAsync();
public Task<Model_Dao_Result> AddToInventoriedListAsync(Model_InventoriedDunnage item);
public Task<Model_Dao_Result> RemoveFromInventoriedListAsync(string partId);
public Task<Model_Dao_Result> UpdateInventoriedPartAsync(Model_InventoriedDunnage item);
⋮----
// ==================== Impact Analysis (4 methods) ====================
⋮----
public Task<Model_Dao_Result<int>> GetPartCountByTypeIdAsync(int typeId);
public Task<Model_Dao_Result<int>> GetTransactionCountByPartIdAsync(string partId);
public Task<Model_Dao_Result<int>> GetTransactionCountByTypeIdAsync(int typeId);
public Task<Model_Dao_Result<int>> GetPartCountBySpecKeyAsync(int typeId, string specKey);
⋮----
// Aliases for compatibility (spec 010-dunnage-complete)
public Task<Model_Dao_Result<int>> GetPartCountByTypeAsync(int typeId) => GetPartCountByTypeIdAsync(typeId);
public Task<Model_Dao_Result<int>> GetTransactionCountByTypeAsync(int typeId) => GetTransactionCountByTypeIdAsync(typeId);
public Task<Model_Dao_Result<int>> GetTransactionCountByPartAsync(string partId) => GetTransactionCountByPartIdAsync(partId);
⋮----
// ==================== Custom Field Operations (3 methods) ====================
⋮----
public Task<Model_Dao_Result> InsertCustomFieldAsync(int typeId, Model_CustomFieldDefinition field);
public Task<Model_Dao_Result<List<Model_CustomFieldDefinition>>> GetCustomFieldsByTypeAsync(int typeId);
public Task<Model_Dao_Result> DeleteCustomFieldAsync(int fieldId);
⋮----
// ==================== User Preference Operations (2 methods) ====================
⋮----
public Task<Model_Dao_Result> UpsertUserPreferenceAsync(string key, string value);
public Task<Model_Dao_Result<List<Model_IconDefinition>>> GetRecentlyUsedIconsAsync(int count);
</file>

<file path="Module_Dunnage/Enums/Enum_DunnageWorkflowStep.cs">
ModeSelection = 0,    // Initial step: choose Guided, Manual Entry, or Edit mode
TypeSelection = 1,    // Select dunnage type (Pallet, Divider, etc.)
PartSelection = 2,    // Select specific part/spec
QuantityEntry = 3,    // Enter quantity received
DetailsEntry = 4,     // Enter additional details (PO number, notes, etc.)
Review = 5,           // Review session before saving
ManualEntry = 6,      // Bulk grid entry mode
EditMode = 7          // Historical data editing mode
</file>

<file path="Module_Dunnage/Models/Model_DunnageLine.cs">
/// <summary>
/// Represents a dunnage/packing material label entry
/// Maps to label_table_dunnage database table
/// </summary>
public class Model_DunnageLine
⋮----
/// Auto-increment primary key
⋮----
/// First line of dunnage label text
⋮----
/// Second line of dunnage label text
⋮----
/// Purchase order number
⋮----
/// Transaction date
⋮----
/// Employee number who created the label
⋮----
/// Supplier/vendor name
⋮----
/// Storage or destination location
⋮----
/// Label number for multiple labels
⋮----
/// Record creation timestamp
</file>

<file path="Module_Dunnage/Models/Model_DunnagePart.cs">
public class Model_DunnagePart : INotifyPropertyChanged
⋮----
private string _specValues = string.Empty; // JSON string
⋮----
private DateTime _createdDate = DateTime.Now;
⋮----
protected virtual void OnPropertyChanged([CallerMemberName] string? propertyName = null)
⋮----
PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
⋮----
protected bool SetField<T>(ref T field, T value, [CallerMemberName] string? propertyName = null)
⋮----
if (EqualityComparer<T>.Default.Equals(field, value))
⋮----
private void DeserializeSpecValues()
⋮----
if (string.IsNullOrWhiteSpace(SpecValues))
</file>

<file path="Module_Dunnage/Models/Model_DunnageSession.cs">
public class Model_DunnageSession : INotifyPropertyChanged
⋮----
protected virtual void OnPropertyChanged([CallerMemberName] string? propertyName = null)
⋮----
PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
⋮----
protected bool SetField<T>(ref T field, T value, [CallerMemberName] string? propertyName = null)
⋮----
if (EqualityComparer<T>.Default.Equals(field, value))
</file>

<file path="Module_Dunnage/Models/Model_DunnageSpec.cs">
public class Model_DunnageSpec : INotifyPropertyChanged
⋮----
private string _specValue = string.Empty; // JSON string
⋮----
private DateTime _createdDate = DateTime.Now;
⋮----
protected virtual void OnPropertyChanged([CallerMemberName] string? propertyName = null)
⋮----
PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
⋮----
protected bool SetField<T>(ref T field, T value, [CallerMemberName] string? propertyName = null)
⋮----
if (EqualityComparer<T>.Default.Equals(field, value))
⋮----
private void DeserializeSpecs()
⋮----
if (string.IsNullOrWhiteSpace(SpecValue))
</file>

<file path="Module_Dunnage/Models/Model_DunnageType.cs">
/// <summary>
/// Represents a dunnage type classification.
/// Database Table: dunnage_types
/// </summary>
public partial class Model_DunnageType : ObservableObject
⋮----
private string _icon = "\uDB81\uDF20"; // Default to box icon (Fluent System Icons)
⋮----
private DateTime _createdDate = DateTime.Now;
⋮----
// Aliases for ViewModel compatibility (spec 010-dunnage-complete)
⋮----
/// Gets the MaterialIconKind enum for displaying the icon
⋮----
// Try to parse the Icon string as a MaterialIconKind enum
if (!string.IsNullOrEmpty(Icon) && Enum.TryParse<MaterialIconKind>(Icon, true, out var kind))
⋮----
// Default to PackageVariantClosed if parsing fails
</file>

<file path="Module_Dunnage/Models/Model_IconDefinition.cs">
/// <summary>
/// Represents an icon definition for the Add Type Dialog icon picker.
/// Contains Material Design Icons metadata.
/// </summary>
public partial class Model_IconDefinition : ObservableObject
⋮----
private MaterialIconKind _kind;
⋮----
// Alias for compatibility
⋮----
get => Kind.ToString();
⋮----
else if (LegacyMapping.TryGetValue(value, out var legacyResult))
⋮----
Name = legacyResult.ToString();
</file>

<file path="Module_Dunnage/Models/Model_InventoriedDunnage.cs">
public class Model_InventoriedDunnage : INotifyPropertyChanged
⋮----
private DateTime _createdDate = DateTime.Now;
⋮----
protected virtual void OnPropertyChanged([CallerMemberName] string? propertyName = null)
⋮----
PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
⋮----
protected bool SetField<T>(ref T field, T value, [CallerMemberName] string? propertyName = null)
⋮----
if (EqualityComparer<T>.Default.Equals(field, value))
</file>

<file path="Module_Dunnage/Models/Model_SpecInput.cs">
/// <summary>
/// Represents a dynamic spec input field for dunnage label generation
/// </summary>
public partial class Model_SpecInput : ObservableObject
⋮----
private string _specType = "text"; // "text", "number", "boolean"
</file>

<file path="Module_Dunnage/Models/Model_SpecItem.cs">
/// <summary>
/// UI model for displaying and editing specification items in dialogs
/// </summary>
public class Model_SpecItem
⋮----
parts.Add($"Min: {MinValue.Value}");
⋮----
parts.Add($"Max: {MaxValue.Value}");
⋮----
if (!string.IsNullOrEmpty(Unit))
⋮----
parts.Add(Unit);
⋮----
desc += $" ({string.Join(", ", parts)})";
</file>

<file path="Module_Dunnage/Models/SpecDefinition.cs">
public class SpecDefinition
⋮----
public string DataType { get; set; } = "Text"; // Text, Number, Boolean
⋮----
// Number specific
</file>

<file path="Module_Dunnage/Services/Service_DunnageAdminWorkflow.cs">
/// <summary>
/// Service implementation for Dunnage Admin UI navigation workflow
/// Manages 4-section navigation: Types, Parts, Specs, Inventoried List
/// </summary>
public class Service_DunnageAdminWorkflow : IService_DunnageAdminWorkflow
⋮----
private Enum_DunnageAdminSection _currentSection = Enum_DunnageAdminSection.Hub;
⋮----
/// Gets the current admin section being displayed
⋮----
/// Raised when admin section changes
⋮----
/// Raised when status message needs to be displayed
⋮----
/// Navigate to specific admin section
⋮----
/// <param name="section">Target section (Types, Parts, Specs, InventoriedList)</param>
public async Task NavigateToSectionAsync(Enum_DunnageAdminSection section)
⋮----
// Check if navigation is allowed
⋮----
// Navigate to section
⋮----
// Raise status message
⋮----
/// Return to main admin hub (4-card navigation view)
⋮----
public async Task NavigateToHubAsync()
⋮----
/// Validate if navigation away from current section is allowed
/// (checks for unsaved changes, pending operations)
⋮----
/// <returns>True if navigation allowed, false if blocked</returns>
public Task<bool> CanNavigateAwayAsync()
⋮----
// If no unsaved changes, allow navigation
⋮----
return Task.FromResult(true);
⋮----
// If unsaved changes exist, block navigation
// The UI should prompt the user to save or discard changes
return Task.FromResult(false);
⋮----
/// Mark current section as having unsaved changes
⋮----
public void MarkDirty()
⋮----
/// Clear unsaved changes flag (after save or discard)
⋮----
public void MarkClean()
⋮----
/// Check if current section has unsaved changes
</file>

<file path="Module_Dunnage/Services/Service_MySQL_Dunnage.cs">
public class Service_MySQL_Dunnage : IService_MySQL_Dunnage
⋮----
private readonly IService_ErrorHandler _errorHandler;
private readonly IService_LoggingUtility _logger;
private readonly IService_UserSessionManager _sessionManager;
private readonly Dao_DunnageLoad _daoDunnageLoad;
private readonly Dao_DunnageType _daoDunnageType;
private readonly Dao_DunnagePart _daoDunnagePart;
private readonly Dao_DunnageSpec _daoDunnageSpec;
private readonly Dao_InventoriedDunnage _daoInventoriedDunnage;
private readonly Dao_DunnageCustomField _daoCustomField;
private readonly Dao_DunnageUserPreference _daoUserPreference;
⋮----
// ==================== Type Operations ====================
⋮----
public async Task<Model_Dao_Result<List<Model_DunnageType>>> GetAllTypesAsync()
⋮----
return await _daoDunnageType.GetAllAsync();
⋮----
public async Task<Model_Dao_Result<Model_DunnageType>> GetTypeByIdAsync(int typeId)
⋮----
return await _daoDunnageType.GetByIdAsync(typeId);
⋮----
public async Task<Model_Dao_Result<int>> InsertTypeAsync(string typeName, string icon)
⋮----
return await _daoDunnageType.InsertAsync(typeName, icon, CurrentUser);
⋮----
public async Task<Model_Dao_Result> InsertTypeAsync(Model_DunnageType type)
⋮----
await _logger.LogInfoAsync($"Inserting new dunnage type: {type.TypeName} (Icon: {type.Icon}) by user: {CurrentUser}");
var result = await _daoDunnageType.InsertAsync(type.TypeName, type.Icon, CurrentUser);
⋮----
await _logger.LogInfoAsync($"Successfully inserted dunnage type '{type.TypeName}' with ID: {type.Id}");
return Model_Dao_Result_Factory.Success();
⋮----
if (result.ErrorMessage.Contains("Duplicate entry"))
⋮----
await _logger.LogWarningAsync($"Failed to insert dunnage type '{type.TypeName}': Duplicate entry");
return Model_Dao_Result_Factory.Failure($"The dunnage type name '{type.TypeName}' is already in use.");
⋮----
await _logger.LogErrorAsync($"Failed to insert dunnage type '{type.TypeName}': {result.ErrorMessage}");
return Model_Dao_Result_Factory.Failure(result.ErrorMessage);
⋮----
await _logger.LogErrorAsync($"Exception in InsertTypeAsync for type '{type.TypeName}': {ex.Message}");
⋮----
return Model_Dao_Result_Factory.Failure($"Error inserting dunnage type: {ex.Message}");
⋮----
public async Task<Model_Dao_Result> UpdateTypeAsync(Model_DunnageType type)
⋮----
await _logger.LogInfoAsync($"Updating dunnage type ID {type.Id}: {type.TypeName} (Icon: {type.Icon}) by user: {CurrentUser}");
var result = await _daoDunnageType.UpdateAsync(type.Id, type.TypeName, type.Icon, CurrentUser);
⋮----
if (!result.IsSuccess && result.ErrorMessage.Contains("Duplicate entry"))
⋮----
await _logger.LogWarningAsync($"Failed to update dunnage type ID {type.Id}: Duplicate entry for '{type.TypeName}'");
⋮----
await _logger.LogInfoAsync($"Successfully updated dunnage type ID {type.Id}: {type.TypeName}");
⋮----
await _logger.LogErrorAsync($"Failed to update dunnage type ID {type.Id}: {result.ErrorMessage}");
⋮----
await _logger.LogErrorAsync($"Exception in UpdateTypeAsync for type ID {type.Id}: {ex.Message}");
⋮----
return Model_Dao_Result_Factory.Failure($"Error updating dunnage type: {ex.Message}");
⋮----
public async Task<Model_Dao_Result> DeleteTypeAsync(int typeId)
⋮----
await _logger.LogInfoAsync($"Attempting to delete dunnage type ID {typeId} by user: {CurrentUser}");
⋮----
// Check if any parts are using this type
var partsResult = await _daoDunnagePart.GetByTypeAsync(typeId);
⋮----
await _logger.LogWarningAsync($"Cannot delete dunnage type ID {typeId}: Used by {partsResult.Data.Count} parts");
return Model_Dao_Result_Factory.Failure($"Cannot delete type. It is used by {partsResult.Data.Count} parts.");
⋮----
// Check if any specs are defined for this type
var specsResult = await _daoDunnageSpec.GetByTypeAsync(typeId);
⋮----
await _logger.LogWarningAsync($"Cannot delete dunnage type ID {typeId}: Has {specsResult.Data.Count} specifications defined");
return Model_Dao_Result_Factory.Failure($"Cannot delete type. It has {specsResult.Data.Count} specifications defined. Please delete them first.");
⋮----
var result = await _daoDunnageType.DeleteAsync(typeId);
⋮----
await _logger.LogInfoAsync($"Successfully deleted dunnage type ID {typeId}");
⋮----
await _logger.LogErrorAsync($"Failed to delete dunnage type ID {typeId}: {result.ErrorMessage}");
⋮----
await _logger.LogErrorAsync($"Exception in DeleteTypeAsync for type ID {typeId}: {ex.Message}");
⋮----
return Model_Dao_Result_Factory.Failure($"Error deleting dunnage type: {ex.Message}");
⋮----
public async Task<Model_Dao_Result<int>> CheckDuplicateTypeNameAsync(string typeName)
⋮----
var result = await _daoDunnageType.CheckDuplicateNameAsync(typeName);
⋮----
// ==================== Spec Operations ====================
⋮----
public async Task<Model_Dao_Result<List<Model_DunnageSpec>>> GetSpecsForTypeAsync(int typeId)
⋮----
return await _daoDunnageSpec.GetByTypeAsync(typeId);
⋮----
public async Task<Model_Dao_Result> InsertSpecAsync(Model_DunnageSpec spec)
⋮----
await _logger.LogInfoAsync($"Inserting spec '{spec.SpecKey}' for type ID {spec.TypeId} by user: {CurrentUser}");
var result = await _daoDunnageSpec.InsertAsync(spec.TypeId, spec.SpecKey, spec.SpecValue, CurrentUser);
⋮----
await _logger.LogInfoAsync($"Successfully inserted spec '{spec.SpecKey}' with ID: {spec.Id}");
⋮----
await _logger.LogErrorAsync($"Failed to insert spec '{spec.SpecKey}' for type ID {spec.TypeId}: {result.ErrorMessage}");
⋮----
await _logger.LogErrorAsync($"Exception in InsertSpecAsync for spec '{spec.SpecKey}': {ex.Message}");
⋮----
return Model_Dao_Result_Factory.Failure($"Error inserting spec: {ex.Message}");
⋮----
public async Task<Model_Dao_Result> UpdateSpecAsync(Model_DunnageSpec spec)
⋮----
await _logger.LogInfoAsync($"Updating spec ID {spec.Id}: {spec.SpecKey} = {spec.SpecValue} by user: {CurrentUser}");
var result = await _daoDunnageSpec.UpdateAsync(spec.Id, spec.SpecValue, CurrentUser);
⋮----
await _logger.LogInfoAsync($"Successfully updated spec ID {spec.Id}: {spec.SpecKey}");
⋮----
await _logger.LogErrorAsync($"Failed to update spec ID {spec.Id}: {result.ErrorMessage}");
⋮----
await _logger.LogErrorAsync($"Exception in UpdateSpecAsync for spec ID {spec.Id}: {ex.Message}");
⋮----
return Model_Dao_Result_Factory.Failure($"Error updating spec: {ex.Message}");
⋮----
public async Task<Model_Dao_Result> DeleteSpecAsync(int specId)
⋮----
return await _daoDunnageSpec.DeleteByIdAsync(specId);
⋮----
return Model_Dao_Result_Factory.Failure($"Error deleting spec: {ex.Message}");
⋮----
public async Task<Model_Dao_Result> DeleteSpecsByTypeIdAsync(int typeId)
⋮----
// Not implemented in DAO yet, but typically handled by cascade delete in DB
⋮----
public async Task<List<string>> GetAllSpecKeysAsync()
⋮----
var result = await _daoDunnageSpec.GetAllAsync();
⋮----
.Select(s => s.SpecKey)
.Distinct()
.Order()
.ToList();
⋮----
// ==================== Part Operations ====================
⋮----
public async Task<Model_Dao_Result<List<Model_DunnagePart>>> GetAllPartsAsync()
⋮----
return await _daoDunnagePart.GetAllAsync();
⋮----
public async Task<Model_Dao_Result<List<Model_DunnagePart>>> GetPartsByTypeAsync(int typeId)
⋮----
_logger.LogInfo($"Service_MySQL_Dunnage: GetPartsByTypeAsync called for typeId={typeId}", "DunnageService");
⋮----
var result = await _daoDunnagePart.GetByTypeAsync(typeId);
_logger.LogInfo($"Service_MySQL_Dunnage: GetPartsByTypeAsync returned {result.Data?.Count ?? 0} parts", "DunnageService");
⋮----
public async Task<Model_Dao_Result<Model_DunnagePart>> GetPartByIdAsync(string partId)
⋮----
return await _daoDunnagePart.GetByIdAsync(partId);
⋮----
public async Task<Model_Dao_Result> InsertPartAsync(Model_DunnagePart part)
⋮----
await _logger.LogInfoAsync($"Inserting new dunnage part: {part.PartId} (Type ID: {part.TypeId}, Home Location: {part.HomeLocation}) by user: {CurrentUser}");
var result = await _daoDunnagePart.InsertAsync(part.PartId, part.TypeId, part.SpecValues, part.HomeLocation, CurrentUser);
⋮----
await _logger.LogInfoAsync($"Successfully inserted dunnage part '{part.PartId}' with ID: {part.Id}");
⋮----
await _logger.LogErrorAsync($"Failed to insert dunnage part '{part.PartId}': {result.ErrorMessage}");
⋮----
await _logger.LogErrorAsync($"Exception in InsertPartAsync for part '{part.PartId}': {ex.Message}");
⋮----
return Model_Dao_Result_Factory.Failure($"Error inserting part: {ex.Message}");
⋮----
public async Task<Model_Dao_Result> UpdatePartAsync(Model_DunnagePart part)
⋮----
await _logger.LogInfoAsync($"Updating dunnage part ID {part.Id} (Part ID: {part.PartId}, Home Location: {part.HomeLocation}) by user: {CurrentUser}");
var result = await _daoDunnagePart.UpdateAsync(part.Id, part.SpecValues, part.HomeLocation, CurrentUser);
⋮----
await _logger.LogInfoAsync($"Successfully updated dunnage part ID {part.Id}");
⋮----
await _logger.LogErrorAsync($"Failed to update dunnage part ID {part.Id}: {result.ErrorMessage}");
⋮----
await _logger.LogErrorAsync($"Exception in UpdatePartAsync for part ID {part.Id}: {ex.Message}");
⋮----
return Model_Dao_Result_Factory.Failure($"Error updating part: {ex.Message}");
⋮----
public async Task<Model_Dao_Result> DeletePartAsync(string partId)
⋮----
// Dao_DunnagePart does not have DeleteAsync yet.
return Model_Dao_Result_Factory.Failure("Delete part not implemented in DAO yet.");
⋮----
public async Task<Model_Dao_Result<List<Model_DunnagePart>>> SearchPartsAsync(string searchText, int? typeId)
⋮----
result = await _daoDunnagePart.GetByTypeAsync(typeId.Value);
⋮----
result = await _daoDunnagePart.GetAllAsync();
⋮----
if (string.IsNullOrWhiteSpace(searchText))
⋮----
var filtered = result.Data.Where(p =>
p.PartId.Contains(searchText, StringComparison.OrdinalIgnoreCase) ||
p.DunnageTypeName.Contains(searchText, StringComparison.OrdinalIgnoreCase)
).ToList();
⋮----
// ==================== Load Operations ====================
⋮----
public async Task<Model_Dao_Result> SaveLoadsAsync(List<Model_DunnageLoad> loads)
⋮----
await _logger.LogInfoAsync("SaveLoadsAsync called with no loads to save");
⋮----
await _logger.LogInfoAsync($"Saving batch of {loads.Count} dunnage loads by user: {CurrentUser}");
var result = await _daoDunnageLoad.InsertBatchAsync(loads, CurrentUser);
⋮----
var totalQuantity = loads.Sum(l => l.Quantity);
await _logger.LogInfoAsync($"Successfully saved {loads.Count} dunnage loads (Total Quantity: {totalQuantity})");
⋮----
await _logger.LogErrorAsync($"Failed to save {loads.Count} dunnage loads: {result.ErrorMessage}");
⋮----
await _logger.LogErrorAsync($"Exception in SaveLoadsAsync for {loads?.Count ?? 0} loads: {ex.Message}");
⋮----
return Model_Dao_Result_Factory.Failure($"Error saving loads: {ex.Message}");
⋮----
public async Task<Model_Dao_Result<List<Model_DunnageLoad>>> GetLoadsByDateRangeAsync(DateTime start, DateTime end)
⋮----
return await _daoDunnageLoad.GetByDateRangeAsync(start, end);
⋮----
public async Task<Model_Dao_Result<List<Model_DunnageLoad>>> GetAllLoadsAsync()
⋮----
return await _daoDunnageLoad.GetAllAsync();
⋮----
public async Task<Model_Dao_Result<Model_DunnageLoad>> GetLoadByIdAsync(string loadUuid)
⋮----
if (Guid.TryParse(loadUuid, out var guid))
⋮----
return await _daoDunnageLoad.GetByIdAsync(guid);
⋮----
public async Task<Model_Dao_Result> UpdateLoadAsync(Model_DunnageLoad load)
⋮----
return Model_Dao_Result_Factory.Failure("Update load not implemented in DAO yet.");
⋮----
public async Task<Model_Dao_Result> DeleteLoadAsync(string loadUuid)
⋮----
return Model_Dao_Result_Factory.Failure("Delete load not implemented in DAO yet.");
⋮----
// ==================== Inventory Operations ====================
⋮----
public async Task<bool> IsPartInventoriedAsync(string partId)
⋮----
var result = await _daoInventoriedDunnage.CheckAsync(partId);
⋮----
public async Task<Model_Dao_Result<Model_InventoriedDunnage>> GetInventoryDetailsAsync(string partId)
⋮----
return await _daoInventoriedDunnage.GetByPartAsync(partId);
⋮----
public async Task<Model_Dao_Result<List<Model_InventoriedDunnage>>> GetAllInventoriedPartsAsync()
⋮----
return await _daoInventoriedDunnage.GetAllAsync();
⋮----
public async Task<Model_Dao_Result> AddToInventoriedListAsync(Model_InventoriedDunnage item)
⋮----
await _logger.LogInfoAsync($"Adding part '{item.PartId}' to inventoried list (Method: {item.InventoryMethod}) by user: {CurrentUser}");
var result = await _daoInventoriedDunnage.InsertAsync(item.PartId, item.InventoryMethod ?? string.Empty, item.Notes ?? string.Empty, CurrentUser);
⋮----
await _logger.LogInfoAsync($"Successfully added part '{item.PartId}' to inventoried list with ID: {item.Id}");
⋮----
await _logger.LogErrorAsync($"Failed to add part '{item.PartId}' to inventoried list: {result.ErrorMessage}");
⋮----
await _logger.LogErrorAsync($"Exception in AddToInventoriedListAsync for part '{item.PartId}': {ex.Message}");
⋮----
return Model_Dao_Result_Factory.Failure($"Error adding to inventory list: {ex.Message}");
⋮----
public async Task<Model_Dao_Result> RemoveFromInventoriedListAsync(string partId)
⋮----
return Model_Dao_Result_Factory.Failure("Remove from inventory list not implemented in DAO yet.");
⋮----
public async Task<Model_Dao_Result> UpdateInventoriedPartAsync(Model_InventoriedDunnage item)
⋮----
return await _daoInventoriedDunnage.UpdateAsync(item.Id, item.InventoryMethod ?? string.Empty, item.Notes ?? string.Empty, CurrentUser);
⋮----
return Model_Dao_Result_Factory.Failure($"Error updating inventory item: {ex.Message}");
⋮----
// ==================== Impact Analysis ====================
⋮----
public async Task<Model_Dao_Result<int>> GetPartCountByTypeIdAsync(int typeId)
⋮----
return await _daoDunnageType.CountPartsAsync(typeId);
⋮----
public async Task<Model_Dao_Result<int>> GetTransactionCountByPartIdAsync(string partId)
⋮----
return await _daoDunnagePart.CountTransactionsAsync(partId);
⋮----
public async Task<Model_Dao_Result<int>> GetTransactionCountByTypeIdAsync(int typeId)
⋮----
return await _daoDunnageType.CountTransactionsAsync(typeId);
⋮----
public async Task<Model_Dao_Result<int>> GetPartCountBySpecKeyAsync(int typeId, string specKey)
⋮----
return await _daoDunnageSpec.CountPartsUsingSpecAsync(typeId, specKey);
⋮----
// ==================== Custom Field Operations ====================
⋮----
public async Task<Model_Dao_Result> InsertCustomFieldAsync(int typeId, Model_CustomFieldDefinition field)
⋮----
var result = await _daoCustomField.InsertAsync(typeId, field, CurrentUser);
⋮----
return Model_Dao_Result_Factory.Failure($"Error inserting custom field: {ex.Message}");
⋮----
public async Task<Model_Dao_Result<List<Model_CustomFieldDefinition>>> GetCustomFieldsByTypeAsync(int typeId)
⋮----
return await _daoCustomField.GetByTypeAsync(typeId);
⋮----
public async Task<Model_Dao_Result> DeleteCustomFieldAsync(int fieldId)
⋮----
return await _daoCustomField.DeleteAsync(fieldId);
⋮----
return Model_Dao_Result_Factory.Failure($"Error deleting custom field: {ex.Message}");
⋮----
// ==================== User Preference Operations ====================
⋮----
public async Task<Model_Dao_Result> UpsertUserPreferenceAsync(string key, string value)
⋮----
return await _daoUserPreference.UpsertAsync(CurrentUser, key, value);
⋮----
return Model_Dao_Result_Factory.Failure($"Error saving user preference: {ex.Message}");
⋮----
public async Task<Model_Dao_Result<List<Model_IconDefinition>>> GetRecentlyUsedIconsAsync(int count)
⋮----
return await _daoUserPreference.GetRecentlyUsedIconsAsync(CurrentUser, count);
⋮----
private void HandleException(Exception ex, Enum_ErrorSeverity severity, string method, string className)
⋮----
_ = _errorHandler.HandleErrorAsync($"Error in {method} ({className}): {ex.Message}", severity, ex);
</file>

<file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_AdminMainViewModel.cs">
/// <summary>
/// ViewModel for Dunnage Admin Main Navigation Hub
/// Provides 4-section navigation: Types, Parts, Specs, Inventoried List
/// </summary>
public partial class ViewModel_Dunnage_AdminMain : ViewModel_Shared_Base
⋮----
private readonly IService_DunnageAdminWorkflow _adminWorkflow;
⋮----
// Subscribe to workflow events
⋮----
// Initialize to Hub view
⋮----
/// Navigate to Dunnage Types Management
⋮----
private async Task NavigateToManageTypesAsync()
⋮----
await _adminWorkflow.NavigateToSectionAsync(Enum_DunnageAdminSection.Types);
⋮----
await _logger.LogInfoAsync("Navigated to Type Management", "AdminMain");
⋮----
await _errorHandler.HandleErrorAsync(
⋮----
/// Navigate to Dunnage Specs Management
⋮----
private async Task NavigateToManageSpecsAsync()
⋮----
await _adminWorkflow.NavigateToSectionAsync(Enum_DunnageAdminSection.Specs);
⋮----
await _logger.LogInfoAsync("Navigated to Spec Management", "AdminMain");
⋮----
/// Navigate to Dunnage Parts Management
⋮----
private async Task NavigateToManagePartsAsync()
⋮----
await _adminWorkflow.NavigateToSectionAsync(Enum_DunnageAdminSection.Parts);
⋮----
await _logger.LogInfoAsync("Navigated to Part Management", "AdminMain");
⋮----
/// Navigate to Inventoried Dunnage List
⋮----
private async Task NavigateToInventoriedListAsync()
⋮----
await _adminWorkflow.NavigateToSectionAsync(Enum_DunnageAdminSection.InventoriedList);
⋮----
await _logger.LogInfoAsync("Navigated to Inventoried List", "AdminMain");
⋮----
/// Return to main navigation hub (4-card view)
⋮----
private async Task ReturnToMainNavigationAsync()
⋮----
await _adminWorkflow.NavigateToHubAsync();
⋮----
await _logger.LogInfoAsync("Returned to main navigation hub", "AdminMain");
⋮----
private void OnSectionChanged(object? sender, Enum_DunnageAdminSection section)
⋮----
private void OnStatusMessageRaised(object? sender, string message)
⋮----
/// Update visibility flags based on current section
⋮----
/// <param name="section"></param>
private void UpdateVisibility(Enum_DunnageAdminSection section)
</file>

<file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_AdminPartsViewModel.cs">
/// <summary>
/// ViewModel for Dunnage Part Management
/// Handles CRUD operations with pagination, filtering, and search
/// </summary>
public partial class ViewModel_Dunnage_AdminParts : ViewModel_Shared_Base
⋮----
private readonly IService_MySQL_Dunnage _dunnageService;
private readonly IService_DunnageAdminWorkflow _adminWorkflow;
private readonly IService_Pagination _paginationService;
private readonly IService_Window _windowService;
private readonly IService_Help _helpService;
⋮----
// Configure pagination
⋮----
/// Gets a tooltip by key from the help service
⋮----
/// <param name="key"></param>
public string GetTooltip(string key) => _helpService.GetTooltip(key);
⋮----
/// Load all parts and types
⋮----
private async Task LoadPartsAsync()
⋮----
// Load types for filter dropdown
var typesResult = await _dunnageService.GetAllTypesAsync();
⋮----
AvailableTypes.Clear();
⋮----
AvailableTypes.Add(type);
⋮----
// Load all parts
var partsResult = await _dunnageService.GetAllPartsAsync();
⋮----
await _errorHandler.HandleDaoErrorAsync(partsResult, "LoadPartsAsync", true);
⋮----
// Setup pagination
_paginationService.SetSource(_allParts);
⋮----
// Load first page
⋮----
await _logger.LogInfoAsync($"Loaded {TotalRecords} dunnage parts", "PartManagement");
⋮----
await _errorHandler.HandleErrorAsync(
⋮----
/// Filter parts by selected type
⋮----
private async Task FilterByTypeAsync()
⋮----
var result = await _dunnageService.GetPartsByTypeAsync(SelectedFilterType.Id);
⋮----
await _errorHandler.HandleDaoErrorAsync(result, "FilterByTypeAsync", true);
⋮----
/// Search parts by text
⋮----
private async Task SearchPartsAsync()
⋮----
if (string.IsNullOrWhiteSpace(SearchText))
⋮----
var result = await _dunnageService.SearchPartsAsync(SearchText);
⋮----
await _errorHandler.HandleDaoErrorAsync(result, "SearchPartsAsync", true);
⋮----
/// Clear all filters
⋮----
private async Task ClearFiltersAsync()
⋮----
private void NextPage()
⋮----
if (_paginationService.NextPage())
⋮----
private void PreviousPage()
⋮----
if (_paginationService.PreviousPage())
⋮----
private void FirstPage()
⋮----
if (_paginationService.FirstPage())
⋮----
private void LastPage()
⋮----
if (_paginationService.LastPage())
⋮----
private void LoadPage()
⋮----
Parts.Clear();
⋮----
Parts.Add(item);
⋮----
private void OnPageChanged(object? sender, EventArgs e)
⋮----
private void UpdateNavigationButtons()
⋮----
/// Show delete confirmation with transaction count
⋮----
private async Task ShowDeleteConfirmationAsync()
⋮----
var countResult = await _dunnageService.GetTransactionCountByPartAsync(SelectedPart.PartId);
⋮----
await _errorHandler.HandleDaoErrorAsync(countResult, "GetTransactionCountByPartAsync", true);
⋮----
var warningDialog = new ContentDialog
⋮----
XamlRoot = _windowService.GetXamlRoot()
⋮----
await warningDialog.ShowAsync();
⋮----
var confirmDialog = new ContentDialog
⋮----
var result = await confirmDialog.ShowAsync();
⋮----
private async Task DeletePartAsync()
⋮----
var result = await _dunnageService.DeletePartAsync(SelectedPart.PartId);
⋮----
await _errorHandler.HandleDaoErrorAsync(result, "DeletePartAsync", true);
⋮----
await _logger.LogInfoAsync($"Deleted part: {SelectedPart.PartId}", "PartManagement");
⋮----
// Reload parts
⋮----
private async Task ReturnToAdminHubAsync()
⋮----
await _adminWorkflow.NavigateToHubAsync();
⋮----
partial void OnSelectedPartChanged(Model_DunnagePart? value)
</file>

<file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_DetailsEntryViewModel.cs">
/// <summary>
/// ViewModel for Dunnage Details Entry
/// </summary>
public partial class ViewModel_Dunnage_DetailsEntry : ViewModel_Shared_Base
⋮----
private readonly IService_DunnageWorkflow _workflowService;
private readonly IService_Help _helpService;
private readonly IService_MySQL_Dunnage _dunnageService;
private readonly IService_Dispatcher _dispatcher;
⋮----
// Subscribe to workflow step changes to re-initialize when this step is reached
⋮----
private void OnWorkflowStepChanged(object? sender, EventArgs e)
⋮----
_dispatcher.TryEnqueue(async () =>
⋮----
/// Load spec inputs for the selected part's type
⋮----
public async Task LoadSpecsForSelectedPartAsync()
⋮----
_logger.LogError("No type selected in workflow session", null, "DetailsEntry");
SpecInputs.Clear();
⋮----
_logger.LogInfo($"Loading specs for type ID: {selectedTypeId}", "DetailsEntry");
⋮----
// Fetch specs from dunnage_specs table (NOT from SpecsJson field which doesn't exist)
var specsResult = await _dunnageService.GetSpecsForTypeAsync(selectedTypeId);
⋮----
_logger.LogWarning($"No specs found for type {selectedTypeId}: {specsResult.ErrorMessage}", "DetailsEntry");
⋮----
_logger.LogInfo($"Loaded {specs.Count} specs from database", "DetailsEntry");
⋮----
// Get the selected part's spec values for defaults
⋮----
if (selectedPart != null && !string.IsNullOrWhiteSpace(selectedPart.SpecValues))
⋮----
_logger.LogInfo($"Loaded spec values from part: {selectedPart.SpecValues}", "DetailsEntry");
⋮----
_logger.LogError($"Failed to parse part spec values: {ex.Message}", ex, "DetailsEntry");
⋮----
// Create spec inputs from database specs
⋮----
TextSpecs.Clear();
NumberSpecs.Clear();
BooleanSpecs.Clear();
⋮----
// Parse spec_value JSON to get type, unit, required
⋮----
// Get default value from part if available
⋮----
var specType = specValueDict.ContainsKey("type") ? specValueDict["type"]?.ToString()?.ToLowerInvariant() ?? "text" : "text";
⋮----
// Convert default value to appropriate type
⋮----
if (!string.IsNullOrWhiteSpace(defaultValue))
⋮----
typedValue = double.Parse(defaultValue);
⋮----
typedValue = bool.Parse(defaultValue);
⋮----
_logger.LogWarning($"Failed to convert value '{defaultValue}' to type '{specType}': {ex.Message}", "DetailsEntry");
typedValue = defaultValue; // Keep as string if conversion fails
⋮----
var input = new Model_SpecInput
⋮----
Unit = specValueDict.ContainsKey("unit") ? specValueDict["unit"]?.ToString() : null,
IsRequired = specValueDict.ContainsKey("required") && bool.Parse(specValueDict["required"]?.ToString() ?? "false"),
⋮----
SpecInputs.Add(input);
⋮----
var typeFromDb = specValueDict.ContainsKey("type") ? specValueDict["type"]?.ToString() ?? "null" : "not found";
_logger.LogInfo($"Processing spec: {spec.SpecKey}, Type from DB: {typeFromDb}, Normalized: {specType}", "DetailsEntry");
⋮----
// Add to type-specific collection
⋮----
BooleanSpecs.Add(input);
_logger.LogInfo($"Added {spec.SpecKey} to BooleanSpecs", "DetailsEntry");
⋮----
NumberSpecs.Add(input);
_logger.LogInfo($"Added {spec.SpecKey} to NumberSpecs", "DetailsEntry");
⋮----
TextSpecs.Add(input);
_logger.LogInfo($"Added {spec.SpecKey} to TextSpecs", "DetailsEntry");
⋮----
// Update visibility flags
⋮----
_logger.LogInfo($"Created {SpecInputs.Count} spec input controls (Text: {TextSpecs.Count}, Number: {NumberSpecs.Count}, Boolean: {BooleanSpecs.Count})", "DetailsEntry");
⋮----
// Check if part is inventoried
⋮----
var isInventoried = await _dunnageService.IsPartInventoriedAsync(selectedPart.PartId);
⋮----
await _errorHandler.HandleErrorAsync(
⋮----
private Dictionary<string, object> ParseSpecValue(string specValue)
⋮----
if (string.IsNullOrWhiteSpace(specValue))
⋮----
_logger.LogError($"Failed to parse spec value JSON: {ex.Message}", ex, "DetailsEntry");
⋮----
partial void OnPoNumberChanged(string value)
⋮----
if (string.IsNullOrWhiteSpace(value))
⋮----
private void UpdateInventoryMessage()
⋮----
private bool ValidateInputs()
⋮----
// Check required specs
foreach (var spec in SpecInputs.Where(s => s.IsRequired))
⋮----
if (spec.Value == null || string.IsNullOrWhiteSpace(spec.Value.ToString()))
⋮----
private void GoBack()
⋮----
_logger.LogInfo("Navigating back to Quantity Entry", "DetailsEntry");
_workflowService.GoToStep(Enum_DunnageWorkflowStep.QuantityEntry);
⋮----
private async Task GoNextAsync()
⋮----
// Set details in workflow session
⋮----
// Convert spec inputs to dictionary
var specValues = SpecInputs.ToDictionary(
⋮----
_logger.LogInfo("Details saved, navigating to Review", "DetailsEntry");
⋮----
// Navigate to Review
_workflowService.GoToStep(Enum_DunnageWorkflowStep.Review);
⋮----
/// <summary>\n    /// Shows contextual help for details entry\n    /// </summary>
/// <param name="key"></param>\n    [RelayCommand]\n    private async Task ShowHelpAsync()\n    {\n        await _helpService.ShowHelpAsync(\"Dunnage.DetailsEntry\");\n    }
⋮----
/// Gets a tooltip by key from the help service
⋮----
/// <param name="key"></param>
public string GetTooltip(string key) => _helpService.GetTooltip(key);
⋮----
/// Gets a placeholder by key from the help service
⋮----
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
⋮----
/// Gets a tip by key from the help service
⋮----
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_ManualEntryViewModel.cs">
/// <summary>
/// ViewModel for Dunnage Manual Entry mode
/// </summary>
public partial class ViewModel_Dunnage_ManualEntry : ViewModel_Shared_Base
⋮----
private readonly IService_DunnageWorkflow _workflowService;
private readonly IService_MySQL_Dunnage _dunnageService;
private readonly IService_DunnageCSVWriter _csvWriter;
private readonly IService_Window _windowService;
private readonly IService_Help _helpService;
⋮----
public async Task InitializeAsync()
⋮----
// Load available types
var typesResult = await _dunnageService.GetAllTypesAsync();
⋮----
AvailableTypes.Clear();
⋮----
AvailableTypes.Add(type);
⋮----
// Load available parts
var partsResult = await _dunnageService.GetAllPartsAsync();
⋮----
AvailableParts.Clear();
⋮----
AvailableParts.Add(part);
⋮----
// Load dynamic spec columns
⋮----
// Add initial empty row
⋮----
_logger.LogInfo("Manual Entry initialized", "ManualEntry");
⋮----
await _errorHandler.HandleErrorAsync(
⋮----
private void AddRow()
⋮----
var newLoad = new Model_DunnageLoad
⋮----
Loads.Add(newLoad);
⋮----
_logger.LogInfo($"Added new row, total: {Loads.Count}", "ManualEntry");
⋮----
private async Task AddMultipleRowsAsync()
⋮----
var xamlRoot = _windowService.GetXamlRoot();
⋮----
_logger.LogError("Cannot show dialog: XamlRoot is null", null, "ManualEntry");
await _errorHandler.HandleErrorAsync("Unable to display dialog", Enum_ErrorSeverity.Error, null, true);
⋮----
var result = await dialog.ShowAsync();
⋮----
_logger.LogInfo($"Added {count} rows via dialog, total: {Loads.Count}", "ManualEntry");
⋮----
private void RemoveRow()
⋮----
Loads.Remove(SelectedLoad);
SelectedLoad = Loads.LastOrDefault();
⋮----
_logger.LogInfo($"Removed row, total: {Loads.Count}", "ManualEntry");
⋮----
private void FillBlankSpaces()
⋮----
var lastLoad = Loads.LastOrDefault();
⋮----
// Copy PO Number
if (string.IsNullOrWhiteSpace(load.PoNumber) && !string.IsNullOrWhiteSpace(lastLoad.PoNumber))
⋮----
// Copy Location
if (string.IsNullOrWhiteSpace(load.Location) && !string.IsNullOrWhiteSpace(lastLoad.Location))
⋮----
// Copy specs if they exist
⋮----
_logger.LogInfo("Fill blank spaces executed", "ManualEntry");
⋮----
private void SortForPrinting()
⋮----
.OrderBy(l => l.PartId)
.ThenBy(l => l.PoNumber)
.ThenBy(l => l.TypeName)
.ToList();
⋮----
Loads.Clear();
⋮----
Loads.Add(load);
⋮----
_logger.LogInfo("Sort for printing executed", "ManualEntry");
⋮----
private async Task AutoFillAsync()
⋮----
if (string.IsNullOrWhiteSpace(SelectedLoad.PartId))
⋮----
// Get part by ID
var partResult = await _dunnageService.GetPartByIdAsync(SelectedLoad.PartId);
⋮----
// Auto-fill Type
var type = AvailableTypes.FirstOrDefault(t => t.Id == part.TypeId);
⋮----
// Auto-fill Spec Values from part master data
⋮----
_logger.LogInfo($"Auto-filled {part.SpecValuesDict.Count} spec values for Part ID: {SelectedLoad.PartId}", "ManualEntry");
⋮----
// Set default values
⋮----
if (string.IsNullOrWhiteSpace(SelectedLoad.InventoryMethod))
⋮----
SelectedLoad.InventoryMethod = string.IsNullOrWhiteSpace(SelectedLoad.PoNumber) ? "Adjust In" : "Receive In";
⋮----
_logger.LogInfo($"Auto-fill completed for Part ID: {SelectedLoad.PartId}", "ManualEntry");
⋮----
private async Task SaveToHistoryAsync()
⋮----
// Use same save method - history is just another save
var result = await _dunnageService.SaveLoadsAsync(Loads.ToList());
⋮----
_logger.LogInfo($"Saved {Loads.Count} loads to history", "ManualEntry");
⋮----
await _errorHandler.HandleDaoErrorAsync(result, "SaveToHistoryAsync", true);
⋮----
private async Task SaveAllAsync()
⋮----
// Validate all loads
⋮----
if (string.IsNullOrWhiteSpace(load.TypeName) || string.IsNullOrWhiteSpace(load.PartId))
⋮----
// Save to database
var saveResult = await _dunnageService.SaveLoadsAsync(Loads.ToList());
⋮----
await _errorHandler.HandleDaoErrorAsync(saveResult, "SaveAllAsync", true);
⋮----
// Export to CSV
var csvResult = await _csvWriter.WriteToCSVAsync(Loads.ToList());
⋮----
_logger.LogInfo($"Saved {Loads.Count} loads", "ManualEntry");
⋮----
// Clear loads
⋮----
AddRow(); // Add new empty row
⋮----
/// <summary>\n    /// Shows contextual help for manual entry\n    /// </summary>\n    [RelayCommand]\n    private async Task ShowHelpAsync()\n    {\n        await _helpService.ShowHelpAsync(\"Dunnage.ManualEntry\");\n    }
⋮----
private async Task ReturnToModeSelectionAsync()
⋮----
var result = await dialog.ShowAsync().AsTask();
⋮----
_logger.LogInfo("User confirmed return to mode selection, clearing loads", "ManualEntry");
⋮----
_workflowService.ClearSession();
_workflowService.GoToStep(Enum_DunnageWorkflowStep.ModeSelection);
⋮----
_logger.LogError($"Failed to return to mode selection: {ex.Message}", ex, "ManualEntry");
await _errorHandler.HandleErrorAsync("Failed to return to mode selection", Enum_ErrorSeverity.Error, ex, true);
⋮----
_logger.LogInfo("User cancelled return to mode selection", "ManualEntry");
⋮----
private async Task LoadSpecColumnsAsync()
⋮----
var specKeys = await _dunnageService.GetAllSpecKeysAsync();
⋮----
_logger.LogInfo($"Loaded {SpecColumnHeaders.Count} dynamic spec columns", "ManualEntry");
⋮----
_logger.LogError($"Failed to load spec columns: {ex.Message}", ex, "ManualEntry");
⋮----
/// Handles PartID change to trigger auto-fill
⋮----
/// <param name="load"></param>
public async Task OnPartIdChangedAsync(Model_DunnageLoad load)
⋮----
if (load == null || string.IsNullOrWhiteSpace(load.PartId))
⋮----
// Auto-populate type and specs when PartID is entered
var partResult = await _dunnageService.GetPartByIdAsync(load.PartId);
⋮----
// Auto-fill specs from part master
⋮----
_logger.LogInfo($"Auto-populated data for Part ID: {load.PartId}", "ManualEntry");
⋮----
_logger.LogError($"Error auto-populating part data: {ex.Message}", ex, "ManualEntry");
⋮----
private void UpdateCanSave()
⋮----
CanSave = Loads.Any(l => !string.IsNullOrWhiteSpace(l.TypeName) || !string.IsNullOrWhiteSpace(l.PartId));
⋮----
/// Gets a tooltip by key from the help service
⋮----
/// <param name="key"></param>
public string GetTooltip(string key) => _helpService.GetTooltip(key);
⋮----
/// Gets a placeholder by key from the help service
⋮----
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
⋮----
/// Gets a tip by key from the help service
⋮----
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_PartSelectionViewModel.cs">
/// <summary>
/// ViewModel for Dunnage Part Selection with inventory notification
/// </summary>
public partial class ViewModel_Dunnage_PartSelection : ViewModel_Shared_Base
⋮----
private readonly IService_DunnageWorkflow _workflowService;
private readonly IService_MySQL_Dunnage _dunnageService; private readonly IService_Help _helpService; private readonly IService_Dispatcher _dispatcher;
⋮----
// Subscribe to workflow step changes to re-initialize when this step is reached
⋮----
_logger.LogInfo("PartSelection: ViewModel constructed and subscribed to StepChanged", "PartSelection");
⋮----
private void OnWorkflowStepChanged(object? sender, EventArgs e)
⋮----
_logger.LogInfo($"PartSelection: Workflow step changed to {_workflowService.CurrentStep}", "PartSelection");
⋮----
_logger.LogInfo("PartSelection: Step is PartSelection, calling InitializeAsync via dispatcher", "PartSelection");
_dispatcher.TryEnqueue(async () =>
⋮----
/// Gets the MaterialIconKind for the selected type
⋮----
if (!string.IsNullOrEmpty(SelectedTypeIcon) && Enum.TryParse<MaterialIconKind>(SelectedTypeIcon, true, out var kind))
⋮----
/// Helper property for UI binding
⋮----
/// Initialize and load parts for selected type
⋮----
public async Task InitializeAsync()
⋮----
_logger.LogInfo("PartSelection: InitializeAsync called", "PartSelection");
⋮----
_logger.LogInfo("PartSelection: InitializeAsync returning because IsBusy is true", "PartSelection");
⋮----
// Get selected type from workflow
⋮----
_logger.LogInfo($"PartSelection: SelectedTypeId={SelectedTypeId}, SelectedTypeName={SelectedTypeName}, SelectedTypeIcon={SelectedTypeIcon}", "PartSelection");
⋮----
_logger.LogInfo($"PartSelection: {StatusMessage}", "PartSelection");
⋮----
_logger.LogError($"PartSelection: Failed to initialize: {ex.Message}", ex, "PartSelection");
await _errorHandler.HandleErrorAsync(
⋮----
private async Task LoadPartsAsync()
⋮----
_logger.LogInfo($"PartSelection: LoadPartsAsync called with SelectedTypeId={SelectedTypeId}", "PartSelection");
⋮----
_logger.LogInfo("PartSelection: SelectedTypeId is 0, returning from LoadPartsAsync", "PartSelection");
⋮----
_logger.LogInfo($"PartSelection: Calling _dunnageService.GetPartsByTypeAsync({SelectedTypeId})", "PartSelection");
var result = await _dunnageService.GetPartsByTypeAsync(SelectedTypeId);
⋮----
AvailableParts.Clear();
⋮----
AvailableParts.Add(part);
⋮----
_logger.LogInfo($"PartSelection: Successfully loaded {AvailableParts.Count} parts", "PartSelection");
⋮----
_logger.LogWarning($"PartSelection: Failed to load parts: {result.ErrorMessage}", "PartSelection");
await _errorHandler.HandleDaoErrorAsync(
⋮----
_logger.LogError($"PartSelection: Error in LoadPartsAsync: {ex.Message}", ex, "PartSelection");
⋮----
partial void OnSelectedPartChanged(Model_DunnagePart? oldValue, Model_DunnagePart? newValue)
⋮----
_logger.LogInfo($"Part selected via ComboBox: {newValue.PartId}", "PartSelection");
⋮----
// Update workflow session immediately when part is selected
⋮----
_logger.LogInfo($"Updated workflow session with selected part: {newValue.PartId}", "PartSelection");
⋮----
// Notify that command can execute state changed
SelectPartCommand.NotifyCanExecuteChanged();
⋮----
private async Task CheckInventoryStatusAsync(Model_DunnagePart part)
⋮----
var isInventoried = await _dunnageService.IsPartInventoriedAsync(part.PartId);
⋮----
// Part is inventoried - show notification
⋮----
InventoryMethod = "Adjust In"; // No PO context yet
⋮----
_logger.LogInfo($"Part {part.PartId} is inventoried - showing notification", "PartSelection");
⋮----
_logger.LogError($"Error checking inventory status: {ex.Message}", ex, "PartSelection");
// Don't show error to user - just hide notification
⋮----
private void UpdateInventoryMessage()
⋮----
private void GoBack()
⋮----
_logger.LogInfo("Returning to Type Selection", "PartSelection");
_workflowService.GoToStep(Enum_DunnageWorkflowStep.TypeSelection);
⋮----
private async Task SelectPartAsync()
⋮----
// Set selected part in workflow
⋮----
_logger.LogInfo($"Selected part: {SelectedPart.PartId}", "PartSelection");
⋮----
// Navigate to quantity entry
_workflowService.GoToStep(Enum_DunnageWorkflowStep.QuantityEntry);
⋮----
private async Task QuickAddPartAsync()
⋮----
_logger.LogInfo($"Quick Add Part requested for type {SelectedTypeName}", "PartSelection");
⋮----
// Fetch specs for the selected type
var specsResult = await _dunnageService.GetSpecsForTypeAsync(SelectedTypeId);
⋮----
// Show dialog with type pre-selected and specs
⋮----
_logger.LogInfo("Cannot show dialog: XamlRoot is null", "PartSelection");
⋮----
var result = await dialog.ShowAsync();
⋮----
_logger.LogInfo($"Adding new part: {partId} for type {SelectedTypeName}", "PartSelection");
⋮----
// Create new part model
var newPart = new Model_DunnagePart
⋮----
// Insert new part
var insertResult = await _dunnageService.InsertPartAsync(newPart);
⋮----
_logger.LogInfo($"Successfully added part: {partId}", "PartSelection");
⋮----
// Reload parts to show new part
⋮----
// Auto-select the new part
var addedPart = AvailableParts.FirstOrDefault(p => p.PartId == partId);
⋮----
/// <summary>\n    /// Shows contextual help for part selection\n    /// </summary>
/// <param name="key"></param>\n    [RelayCommand]\n    private async Task ShowHelpAsync()\n    {\n        await _helpService.ShowHelpAsync(\"Dunnage.PartSelection\");\n    }
⋮----
/// Gets a tooltip by key from the help service
⋮----
/// <param name="key"></param>
public string GetTooltip(string key) => _helpService.GetTooltip(key);
⋮----
/// Gets a placeholder by key from the help service
⋮----
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
⋮----
/// Gets a tip by key from the help service
⋮----
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_QuantityEntryViewModel.cs">
/// <summary>
/// ViewModel for Dunnage Quantity Entry
/// </summary>
public partial class ViewModel_Dunnage_QuantityEntry : ViewModel_Shared_Base
⋮----
private readonly IService_DunnageWorkflow _workflowService;
private readonly IService_Dispatcher _dispatcher;
private readonly IService_Help _helpService;
⋮----
// Subscribe to workflow step changes to re-initialize when this step is reached
⋮----
private void OnWorkflowStepChanged(object? sender, EventArgs e)
⋮----
_dispatcher.TryEnqueue(LoadContextData);
⋮----
/// Gets the MaterialIconKind for the selected type
⋮----
if (!string.IsNullOrEmpty(SelectedTypeIcon) && Enum.TryParse<MaterialIconKind>(SelectedTypeIcon, true, out var kind))
⋮----
/// Indicates if the quantity is valid
⋮----
/// Load context data from workflow session
⋮----
public void LoadContextData()
⋮----
// Initialize workflow session quantity with default value if not set
⋮----
_logger.LogInfo($"Initialized workflow session quantity to {Quantity}", "QuantityEntry");
⋮----
_logger.LogInfo($"Loaded context: Type={SelectedTypeName}, Part={SelectedPartName}, Quantity={_workflowService.CurrentSession.Quantity}", "QuantityEntry");
⋮----
_logger.LogError($"Error loading context data: {ex.Message}", ex, "QuantityEntry");
⋮----
partial void OnQuantityChanged(int value)
⋮----
// Update workflow session immediately
⋮----
_logger.LogInfo($"Quantity changed to {value}, updated workflow session", "QuantityEntry");
⋮----
GoNextCommand.NotifyCanExecuteChanged();
⋮----
private void ValidateQuantity()
⋮----
/// <summary>\n    /// Shows contextual help for quantity entry\n    /// </summary>\n    [RelayCommand]\n    private async Task ShowHelpAsync()\n    {\n        await _helpService.ShowHelpAsync(\"Dunnage.QuantityEntry\");\n    }
⋮----
private void GoBack()
⋮----
_logger.LogInfo("Navigating back to Part Selection", "QuantityEntry");
_workflowService.GoToStep(Enum_DunnageWorkflowStep.PartSelection);
⋮----
private async Task GoNextAsync()
⋮----
// Set quantity in workflow session
⋮----
_logger.LogInfo($"Quantity set to {Quantity}", "QuantityEntry");
⋮----
// Navigate to Details Entry
_workflowService.GoToStep(Enum_DunnageWorkflowStep.DetailsEntry);
⋮----
await _errorHandler.HandleErrorAsync(
⋮----
/// Gets a tooltip by key from the help service
⋮----
/// <param name="key"></param>
public string GetTooltip(string key) => _helpService.GetTooltip(key);
⋮----
/// Gets a placeholder by key from the help service
⋮----
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
⋮----
/// Gets a tip by key from the help service
⋮----
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Dunnage/Views/View_Dunnage_AdminInventoryView.xaml">
<Page
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_AdminInventoryView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:models="using:MTM_Receiving_Application.Module_Dunnage.Models"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>
        <converters:Converter_IntToVisibility x:Key="IntToVisibilityConverter"/>
        <converters:Converter_StringFormat x:Key="DateTimeToStringConverter"/>
    </Page.Resources>

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock 
                Text="Manage Inventoried Parts" 
                Style="{StaticResource TitleTextBlockStyle}"/>
            <TextBlock 
                Text="Configure parts that require inventory tracking" 
                Style="{StaticResource BodyTextBlockStyle}"
                Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                Margin="0,8,0,0"/>
        </StackPanel>

        <!-- Toolbar -->
        <CommandBar Grid.Row="1" DefaultLabelPosition="Right" Margin="0,0,0,16">
            <AppBarButton 
                Icon="Add" 
                Label="Add Part to List"
                Command="{x:Bind ViewModel.ShowAddToListCommand}"
                ToolTipService.ToolTip="Add a part to the inventory tracking list"/>
            <AppBarSeparator/>
            <AppBarButton 
                Icon="Edit" 
                Label="Edit Entry"
                Command="{x:Bind ViewModel.ShowEditEntryCommand}"
                IsEnabled="{x:Bind ViewModel.HasSelection, Mode=OneWay}"
                ToolTipService.ToolTip="Edit the selected inventory entry"/>
            <AppBarButton 
                Icon="Delete" 
                Label="Remove from List"
                Command="{x:Bind ViewModel.ShowRemoveConfirmationCommand}"
                IsEnabled="{x:Bind ViewModel.HasSelection, Mode=OneWay}"
                ToolTipService.ToolTip="Remove the selected part from inventory tracking"/>
            <AppBarSeparator/>
            <AppBarButton 
                Icon="Back" 
                Label="Back to Admin Hub"
                Command="{x:Bind ViewModel.BackToHubCommand}"
                ToolTipService.ToolTip="Return to the admin hub"/>
        </CommandBar>

        <!-- DataGrid -->
        <Border 
            Grid.Row="2" 
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="1"
            CornerRadius="8"
            Padding="1">
            <Grid>
                <controls:DataGrid
                    ItemsSource="{x:Bind ViewModel.InventoriedParts, Mode=OneWay}"
                    SelectedItem="{x:Bind ViewModel.SelectedInventoriedPart, Mode=TwoWay}"
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    GridLinesVisibility="Horizontal"
                    HeadersVisibility="Column"
                    SelectionMode="Single"
                    CanUserReorderColumns="False"
                    CanUserSortColumns="True"
                    VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Auto"
                    AlternatingRowBackground="{ThemeResource SubtleFillColorSecondaryBrush}">

                    <controls:DataGrid.Columns>
                        <!-- Part ID Column -->
                        <controls:DataGridTextColumn 
                            Header="Part ID" 
                            Binding="{Binding PartId}"
                            Width="2*"
                            CanUserResize="True"/>

                        <!-- Inventory Method Column -->
                        <controls:DataGridTextColumn 
                            Header="Inventory Method" 
                            Binding="{Binding InventoryMethod}"
                            Width="*"
                            CanUserResize="True"/>

                        <!-- Notes Column -->
                        <controls:DataGridTextColumn 
                            Header="Notes" 
                            Binding="{Binding Notes}"
                            Width="3*"
                            CanUserResize="True"/>

                        <!-- Date Added Column -->
                        <controls:DataGridTextColumn 
                            Header="Date Added" 
                            Binding="{Binding CreatedDate, Converter={StaticResource DateTimeToStringConverter}}"
                            Width="*"
                            CanUserResize="True"/>

                        <!-- Added By Column -->
                        <controls:DataGridTextColumn 
                            Header="Added By" 
                            Binding="{Binding CreatedBy}"
                            Width="*"
                            CanUserResize="True"/>

                        <!-- Last Modified Column -->
                        <controls:DataGridTextColumn 
                            Header="Last Modified" 
                            Binding="{Binding ModifiedDate, Converter={StaticResource DateTimeToStringConverter}}"
                            Width="*"
                            CanUserResize="True"/>

                        <!-- Modified By Column -->
                        <controls:DataGridTextColumn 
                            Header="Modified By" 
                            Binding="{Binding ModifiedBy}"
                            Width="*"
                            CanUserResize="True"/>
                    </controls:DataGrid.Columns>
                </controls:DataGrid>

                <!-- Empty State -->
                <StackPanel 
                    VerticalAlignment="Center" 
                    HorizontalAlignment="Center"
                    Spacing="16"
                    Visibility="{x:Bind ViewModel.InventoriedParts.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=Inverse}">
                    <FontIcon 
                        Glyph="&#xE7C3;" 
                        FontSize="72"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                    <TextBlock 
                        Text="No inventoried parts found" 
                        Style="{StaticResource SubtitleTextBlockStyle}"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                    <TextBlock 
                        Text="Click 'Add Part to List' to configure parts that require inventory tracking"
                        Style="{StaticResource CaptionTextBlockStyle}"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="8" Margin="0,16,0,0">
            <ProgressRing 
                IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                Width="20" 
                Height="20"/>
            <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"/>
            <TextBlock 
                Text="|"
                Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                Margin="8,0,8,0"/>
            <TextBlock>
                <Run Text="Total Parts:"/>
                <Run Text="{x:Bind ViewModel.InventoriedParts.Count, Mode=OneWay}" FontWeight="SemiBold"/>
            </TextBlock>
        </StackPanel>
    </Grid>
</Page>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_AdminInventoryView.xaml.cs">
public sealed partial class View_Dunnage_AdminInventoryView : Page
⋮----
private readonly IService_Focus _focusService;
⋮----
_focusService.AttachFocusOnVisibility(this);
⋮----
protected override async void OnNavigatedTo(NavigationEventArgs e)
⋮----
base.OnNavigatedTo(e);
App.GetService<IService_LoggingUtility>().LogInfo("Admin Inventory View loaded", "AdminInventoryView");
await ViewModel.InitializeAsync();
</file>

<file path="Module_Dunnage/Views/View_Dunnage_AdminMainView.xaml">
<Page
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_AdminMainView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="using:MTM_Receiving_Application.Module_Dunnage.Views"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid Padding="24">
        <!-- Main Navigation Hub (4-card view) -->
        <Grid Visibility="{x:Bind ViewModel.IsMainNavigationVisible, Mode=OneWay}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Margin="0,0,0,24">
                <TextBlock 
                    Text="Dunnage Management" 
                    Style="{StaticResource TitleTextBlockStyle}"/>
                <TextBlock 
                    Text="Manage types, parts, specifications, and inventory" 
                    Style="{StaticResource BodyTextBlockStyle}"
                    Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                    Margin="0,8,0,0"/>
            </StackPanel>

            <!-- 4 Navigation Cards (2x2 Grid) -->
            <Grid Grid.Row="1" VerticalAlignment="Center">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Type Management Card -->
                <Button 
                    Grid.Row="0" 
                    Grid.Column="0"
                    Command="{x:Bind ViewModel.NavigateToManageTypesCommand}"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Margin="0,0,12,12"
                    Padding="24"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8">
                    <StackPanel Spacing="12">
                        <FontIcon 
                            Glyph="&#xE7C3;" 
                            FontSize="48"
                            Foreground="{ThemeResource SystemAccentColor}"/>
                        <TextBlock 
                            Text="Manage Types" 
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            HorizontalAlignment="Center"/>
                        <TextBlock 
                            Text="Add, edit, and delete dunnage types"
                            Style="{StaticResource CaptionTextBlockStyle}"
                            Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                            TextWrapping="Wrap"
                            HorizontalAlignment="Center"
                            TextAlignment="Center"/>
                    </StackPanel>
                </Button>

                <!-- Spec Management Card -->
                <Button 
                    Grid.Row="0" 
                    Grid.Column="1"
                    Command="{x:Bind ViewModel.NavigateToManageSpecsCommand}"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Margin="12,0,0,12"
                    Padding="24"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8">
                    <StackPanel Spacing="12">
                        <FontIcon 
                            Glyph="&#xE8FD;" 
                            FontSize="48"
                            Foreground="{ThemeResource SystemAccentColor}"/>
                        <TextBlock 
                            Text="Manage Specs" 
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            HorizontalAlignment="Center"/>
                        <TextBlock 
                            Text="Define specifications for each type"
                            Style="{StaticResource CaptionTextBlockStyle}"
                            Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                            TextWrapping="Wrap"
                            HorizontalAlignment="Center"
                            TextAlignment="Center"/>
                    </StackPanel>
                </Button>

                <!-- Part Management Card -->
                <Button 
                    Grid.Row="1" 
                    Grid.Column="0"
                    Command="{x:Bind ViewModel.NavigateToManagePartsCommand}"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Margin="0,12,12,0"
                    Padding="24"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8">
                    <StackPanel Spacing="12">
                        <FontIcon 
                            Glyph="&#xE8F1;" 
                            FontSize="48"
                            Foreground="{ThemeResource SystemAccentColor}"/>
                        <TextBlock 
                            Text="Manage Parts" 
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            HorizontalAlignment="Center"/>
                        <TextBlock 
                            Text="Add and edit dunnage part numbers"
                            Style="{StaticResource CaptionTextBlockStyle}"
                            Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                            TextWrapping="Wrap"
                            HorizontalAlignment="Center"
                            TextAlignment="Center"/>
                    </StackPanel>
                </Button>

                <!-- Inventoried List Card -->
                <Button 
                    Grid.Row="1" 
                    Grid.Column="1"
                    Command="{x:Bind ViewModel.NavigateToInventoriedListCommand}"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Margin="12,12,0,0"
                    Padding="24"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8">
                    <StackPanel Spacing="12">
                        <FontIcon 
                            Glyph="&#xE8EF;" 
                            FontSize="48"
                            Foreground="{ThemeResource SystemAccentColor}"/>
                        <TextBlock 
                            Text="Inventoried List" 
                            Style="{StaticResource SubtitleTextBlockStyle}"
                            HorizontalAlignment="Center"/>
                        <TextBlock 
                            Text="Manage inventory tracking settings"
                            Style="{StaticResource CaptionTextBlockStyle}"
                            Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                            TextWrapping="Wrap"
                            HorizontalAlignment="Center"
                            TextAlignment="Center"/>
                    </StackPanel>
                </Button>
            </Grid>

            <!-- Status Bar -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8" Margin="0,24,0,0">
                <ProgressRing 
                    IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                    Width="20" 
                    Height="20"/>
                <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"/>
            </StackPanel>
        </Grid>

        <!-- Type Management Section -->
        <Grid Visibility="{x:Bind ViewModel.IsManageTypesVisible, Mode=OneWay}">
            <local:View_Dunnage_AdminTypesView/>
        </Grid>

        <!-- Spec Management Section (placeholder) -->
        <Grid Visibility="{x:Bind ViewModel.IsManageSpecsVisible, Mode=OneWay}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="16">
                <FontIcon Glyph="&#xE8FD;" FontSize="72" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                <TextBlock 
                    Text="Spec Management" 
                    Style="{StaticResource TitleTextBlockStyle}"
                    HorizontalAlignment="Center"/>
                <TextBlock 
                    Text="This view will be implemented in a future phase"
                    Style="{StaticResource BodyTextBlockStyle}"
                    Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                    HorizontalAlignment="Center"/>
                <Button 
                    Content="Back to Main Menu"
                    Command="{x:Bind ViewModel.ReturnToMainNavigationCommand}"
                    Style="{StaticResource AccentButtonStyle}"
                    HorizontalAlignment="Center"
                    Margin="0,16,0,0"/>
            </StackPanel>
        </Grid>

        <!-- Part Management Section -->
        <Grid Visibility="{x:Bind ViewModel.IsManagePartsVisible, Mode=OneWay}">
            <local:View_Dunnage_AdminPartsView/>
        </Grid>

        <!-- Inventoried List Section (placeholder) -->
        <Grid Visibility="{x:Bind ViewModel.IsInventoriedListVisible, Mode=OneWay}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="16">
                <FontIcon Glyph="&#xE8EF;" FontSize="72" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                <TextBlock 
                    Text="Inventoried List" 
                    Style="{StaticResource TitleTextBlockStyle}"
                    HorizontalAlignment="Center"/>
                <TextBlock 
                    Text="This view will be implemented in a future phase"
                    Style="{StaticResource BodyTextBlockStyle}"
                    Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                    HorizontalAlignment="Center"/>
                <Button 
                    Content="Back to Main Menu"
                    Command="{x:Bind ViewModel.ReturnToMainNavigationCommand}"
                    Style="{StaticResource AccentButtonStyle}"
                    HorizontalAlignment="Center"
                    Margin="0,16,0,0"/>
            </StackPanel>
        </Grid>
    </Grid>
</Page>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_AdminMainView.xaml.cs">
public sealed partial class View_Dunnage_AdminMainView : Page
⋮----
private readonly IService_Focus _focusService;
⋮----
_focusService.AttachFocusOnVisibility(this);
</file>

<file path="Module_Dunnage/Views/View_Dunnage_AdminPartsView.xaml">
<Page
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_AdminPartsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    Loaded="OnPageLoaded">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock 
                Text="Manage Dunnage Parts" 
                Style="{StaticResource TitleTextBlockStyle}"/>
            <TextBlock 
                Text="Add, edit, and search dunnage parts with spec values" 
                Style="{StaticResource BodyTextBlockStyle}"
                Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                Margin="0,8,0,0"/>
        </StackPanel>

        <!-- Toolbar -->
        <CommandBar Grid.Row="1" DefaultLabelPosition="Right" Margin="0,0,0,16">
            <AppBarButton 
                Icon="Add" 
                Label="Add New Part"
                ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.CreatePart'), Mode=OneWay}"/>
            <AppBarSeparator/>
            <AppBarButton 
                Icon="Edit" 
                Label="Edit Part"
                IsEnabled="{x:Bind ViewModel.CanEdit, Mode=OneWay}"
                ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.EditPart'), Mode=OneWay}"/>
            <AppBarButton 
                Icon="Delete" 
                Label="Delete Part"
                Command="{x:Bind ViewModel.ShowDeleteConfirmationCommand}"
                IsEnabled="{x:Bind ViewModel.CanDelete, Mode=OneWay}"
                ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.DeletePart'), Mode=OneWay}"/>
            <AppBarSeparator/>
            <AppBarButton 
                Icon="Back" 
                Label="Back to Admin Hub"
                Command="{x:Bind ViewModel.ReturnToAdminHubCommand}"
                ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.ReturnToAdmin'), Mode=OneWay}"/>
        </CommandBar>

        <!-- Search and Filter Bar -->
        <Grid Grid.Row="2" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Search Box -->
            <TextBox 
                Grid.Column="0"
                Text="{x:Bind ViewModel.SearchText, Mode=TwoWay}"
                PlaceholderText="Search by Part ID..."
                Margin="0,0,12,0">
                <TextBox.KeyboardAccelerators>
                    <KeyboardAccelerator Key="Enter" Invoked="OnSearchKeyboardAccelerator"/>
                </TextBox.KeyboardAccelerators>
            </TextBox>

            <!-- Type Filter -->
            <ComboBox 
                Grid.Column="1"
                ItemsSource="{x:Bind ViewModel.AvailableTypes, Mode=OneWay}"
                SelectedItem="{x:Bind ViewModel.SelectedFilterType, Mode=TwoWay}"
                PlaceholderText="Filter by Type"
                DisplayMemberPath="DunnageType"
                MinWidth="200"
                Margin="0,0,12,0"/>

            <!-- Filter Buttons -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                <Button 
                    Content="Search"
                    Command="{x:Bind ViewModel.SearchPartsCommand}"
                    Style="{StaticResource AccentButtonStyle}"/>
                <Button 
                    Content="Filter by Type"
                    Command="{x:Bind ViewModel.FilterByTypeCommand}"/>
                <Button 
                    Content="Clear"
                    Command="{x:Bind ViewModel.ClearFiltersCommand}"/>
            </StackPanel>
        </Grid>

        <!-- DataGrid -->
        <Border 
            Grid.Row="3" 
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="1"
            CornerRadius="8"
            Padding="1">
            <Grid>
                <controls:DataGrid
                    ItemsSource="{x:Bind ViewModel.Parts, Mode=OneWay}"
                    SelectedItem="{x:Bind ViewModel.SelectedPart, Mode=TwoWay}"
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    GridLinesVisibility="Horizontal"
                    HeadersVisibility="Column"
                    SelectionMode="Single"
                    CanUserReorderColumns="False"
                    CanUserSortColumns="True"
                    VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Auto"
                    AlternatingRowBackground="{ThemeResource SubtleFillColorSecondaryBrush}">

                    <controls:DataGrid.Columns>
                        <!-- Part ID Column -->
                        <controls:DataGridTextColumn 
                            Header="Part ID" 
                            Binding="{Binding PartId}"
                            Width="2*"
                            CanUserResize="True"/>

                        <!-- Type Column -->
                        <controls:DataGridTextColumn 
                            Header="Type" 
                            Binding="{Binding DunnageTypeName}"
                            Width="*"
                            CanUserResize="True"/>

                        <!-- Spec Values Column (Note: Dynamic spec columns would require code-behind) -->
                        <controls:DataGridTextColumn 
                            Header="Specifications" 
                            Binding="{Binding DunnageSpecValuesJson}"
                            Width="2*"
                            CanUserResize="True"/>

                        <!-- Date Added Column -->
                        <controls:DataGridTextColumn 
                            Header="Date Added" 
                            Binding="{Binding CreatedDate, Converter={StaticResource DateTimeToStringConverter}}"
                            Width="*"
                            CanUserResize="True"/>

                        <!-- Added By Column -->
                        <controls:DataGridTextColumn 
                            Header="Added By" 
                            Binding="{Binding CreatedBy}"
                            Width="*"
                            CanUserResize="True"/>
                    </controls:DataGrid.Columns>
                </controls:DataGrid>

                <!-- Empty State -->
                <StackPanel 
                    VerticalAlignment="Center" 
                    HorizontalAlignment="Center"
                    Spacing="16"
                    Visibility="{x:Bind ViewModel.Parts.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=Inverse}">
                    <FontIcon 
                        Glyph="&#xE8F1;" 
                        FontSize="72"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                    <TextBlock 
                        Text="No parts found" 
                        Style="{StaticResource SubtitleTextBlockStyle}"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                    <TextBlock 
                        Text="Try adjusting your filters or add a new part"
                        Style="{StaticResource CaptionTextBlockStyle}"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Pagination Controls -->
        <Grid Grid.Row="4" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Record Count -->
            <TextBlock Grid.Column="0" VerticalAlignment="Center">
                <Run Text="Showing"/>
                <Run Text="{x:Bind ViewModel.Parts.Count, Mode=OneWay}" FontWeight="SemiBold"/>
                <Run Text="of"/>
                <Run Text="{x:Bind ViewModel.TotalRecords, Mode=OneWay}" FontWeight="SemiBold"/>
                <Run Text="parts"/>
            </TextBlock>

            <!-- Pagination Buttons -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                <Button 
                    Content="First"
                    Command="{x:Bind ViewModel.FirstPageCommand}"
                    IsEnabled="{x:Bind ViewModel.CanNavigatePrevious, Mode=OneWay}"
                    MinWidth="80"/>
                <Button 
                    Content="Previous"
                    Command="{x:Bind ViewModel.PreviousPageCommand}"
                    IsEnabled="{x:Bind ViewModel.CanNavigatePrevious, Mode=OneWay}"
                    MinWidth="80"/>
                <TextBlock 
                    VerticalAlignment="Center"
                    Margin="12,0,12,0">
                    <Run Text="Page"/>
                    <Run Text="{x:Bind ViewModel.CurrentPage, Mode=OneWay}" FontWeight="SemiBold"/>
                    <Run Text="of"/>
                    <Run Text="{x:Bind ViewModel.TotalPages, Mode=OneWay}" FontWeight="SemiBold"/>
                </TextBlock>
                <Button 
                    Content="Next"
                    Command="{x:Bind ViewModel.NextPageCommand}"
                    IsEnabled="{x:Bind ViewModel.CanNavigateNext, Mode=OneWay}"
                    MinWidth="80"/>
                <Button 
                    Content="Last"
                    Command="{x:Bind ViewModel.LastPageCommand}"
                    IsEnabled="{x:Bind ViewModel.CanNavigateNext, Mode=OneWay}"
                    MinWidth="80"/>
            </StackPanel>
        </Grid>

        <!-- Status Bar -->
        <StackPanel Grid.Row="5" Orientation="Horizontal" Spacing="8" Margin="0,16,0,0">
            <ProgressRing 
                IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                Width="20" 
                Height="20"/>
            <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"/>
        </StackPanel>
    </Grid>
</Page>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_AdminPartsView.xaml.cs">
public sealed partial class View_Dunnage_AdminPartsView : Page
⋮----
private readonly IService_Focus _focusService;
⋮----
_focusService.AttachFocusOnVisibility(this);
⋮----
private async void OnPageLoaded(object sender, RoutedEventArgs e)
⋮----
await ViewModel.LoadPartsCommand.ExecuteAsync(null);
⋮----
private async void OnSearchKeyboardAccelerator(KeyboardAccelerator sender, KeyboardAcceleratorInvokedEventArgs args)
⋮----
await ViewModel.SearchPartsCommand.ExecuteAsync(null);
</file>

<file path="Module_Dunnage/Views/View_Dunnage_AdminTypesView.xaml">
<Page
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_AdminTypesView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    xmlns:materialIcons="using:Material.Icons.WinUI3"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    Loaded="OnPageLoaded">

    <Page.Resources>
        <converters:Converter_IconCodeToGlyph x:Key="IconCodeToGlyphConverter"/>
        <converters:Converter_IntToVisibility x:Key="IntToVisibilityConverter"/>
        <converters:Converter_StringFormat x:Key="DateTimeToStringConverter"/>
    </Page.Resources>

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock 
                Text="Manage Dunnage Types" 
                Style="{StaticResource TitleTextBlockStyle}"/>
            <TextBlock 
                Text="Add, edit, and delete dunnage types with impact analysis" 
                Style="{StaticResource BodyTextBlockStyle}"
                Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                Margin="0,8,0,0"/>
        </StackPanel>

        <!-- Toolbar -->
        <CommandBar Grid.Row="1" DefaultLabelPosition="Right" Margin="0,0,0,16">
            <AppBarButton 
                Icon="Add" 
                Label="Add New Type"
                ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.CreateType'), Mode=OneWay}"/>
            <AppBarSeparator/>
            <AppBarButton 
                Icon="Edit" 
                Label="Edit Type"
                Command="{x:Bind ViewModel.ShowEditTypeCommand}"
                IsEnabled="{x:Bind ViewModel.CanEdit, Mode=OneWay}"
                ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.EditType'), Mode=OneWay}"/>
            <AppBarButton 
                Icon="Delete" 
                Label="Delete Type"
                Command="{x:Bind ViewModel.ShowDeleteConfirmationCommand}"
                IsEnabled="{x:Bind ViewModel.CanDelete, Mode=OneWay}"
                ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.DeleteType'), Mode=OneWay}"/>
            <AppBarSeparator/>
            <AppBarButton 
                Icon="Back" 
                Label="Back to Admin Hub"
                Command="{x:Bind ViewModel.ReturnToAdminHubCommand}"
                ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.ReturnToAdmin'), Mode=OneWay}"/>
        </CommandBar>

        <!-- DataGrid -->
        <Border 
            Grid.Row="2" 
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="1"
            CornerRadius="8"
            Padding="1">
            <Grid>
                <controls:DataGrid
                    ItemsSource="{x:Bind ViewModel.Types, Mode=OneWay}"
                    SelectedItem="{x:Bind ViewModel.SelectedType, Mode=TwoWay}"
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    GridLinesVisibility="Horizontal"
                    HeadersVisibility="Column"
                    SelectionMode="Single"
                    CanUserReorderColumns="False"
                    CanUserSortColumns="True"
                    VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Auto"
                    AlternatingRowBackground="{ThemeResource SubtleFillColorSecondaryBrush}">

                    <controls:DataGrid.Columns>
                        <!-- Icon Column -->
                        <controls:DataGridTemplateColumn Header="Icon" Width="60">
                            <controls:DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <materialIcons:MaterialIcon 
                                        Kind="{Binding IconKind}" 
                                        Width="24" 
                                        Height="24"
                                        Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                                </DataTemplate>
                            </controls:DataGridTemplateColumn.CellTemplate>
                        </controls:DataGridTemplateColumn>

                        <!-- Type Name Column -->
                        <controls:DataGridTextColumn 
                            Header="Type Name" 
                            Binding="{Binding DunnageType}"
                            Width="2*"
                            CanUserResize="True"/>

                        <!-- Date Added Column -->
                        <controls:DataGridTextColumn 
                            Header="Date Added" 
                            Binding="{Binding DateAdded, Converter={StaticResource DateTimeToStringConverter}}"
                            Width="*"
                            CanUserResize="True"/>

                        <!-- Added By Column -->
                        <controls:DataGridTextColumn 
                            Header="Added By" 
                            Binding="{Binding AddedBy}"
                            Width="*"
                            CanUserResize="True"/>

                        <!-- Last Modified Column -->
                        <controls:DataGridTextColumn 
                            Header="Last Modified" 
                            Binding="{Binding LastModified, Converter={StaticResource DateTimeToStringConverter}}"
                            Width="*"
                            CanUserResize="True"/>

                        <!-- Modified By Column -->
                        <controls:DataGridTextColumn 
                            Header="Modified By" 
                            Binding="{Binding ModifiedBy}"
                            Width="*"
                            CanUserResize="True"/>
                    </controls:DataGrid.Columns>
                </controls:DataGrid>

                <!-- Empty State -->
                <StackPanel 
                    VerticalAlignment="Center" 
                    HorizontalAlignment="Center"
                    Spacing="16"
                    Visibility="{x:Bind ViewModel.Types.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=Inverse}">
                    <FontIcon 
                        Glyph="&#xE7C3;" 
                        FontSize="72"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                    <TextBlock 
                        Text="No types found" 
                        Style="{StaticResource SubtitleTextBlockStyle}"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                    <TextBlock 
                        Text="Click 'Add New Type' to create your first dunnage type"
                        Style="{StaticResource CaptionTextBlockStyle}"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="8" Margin="0,16,0,0">
            <ProgressRing 
                IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                Width="20" 
                Height="20"/>
            <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"/>
            <TextBlock 
                Text="|"
                Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                Margin="8,0,8,0"/>
            <TextBlock>
                <Run Text="Total Types:"/>
                <Run Text="{x:Bind ViewModel.Types.Count, Mode=OneWay}" FontWeight="SemiBold"/>
            </TextBlock>
        </StackPanel>
    </Grid>
</Page>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_AdminTypesView.xaml.cs">
public sealed partial class View_Dunnage_AdminTypesView : Page
⋮----
private readonly IService_Focus _focusService;
⋮----
_focusService.AttachFocusOnVisibility(this);
⋮----
private async void OnPageLoaded(object sender, RoutedEventArgs e)
⋮----
App.GetService<IService_LoggingUtility>().LogInfo("Admin Types View loaded", "AdminTypesView");
await ViewModel.LoadTypesCommand.ExecuteAsync(null);
</file>

<file path="Module_Dunnage/Views/View_Dunnage_Control_IconPickerControl.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_Control_IconPickerControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:materialIcons="using:Material.Icons.WinUI3"
    xmlns:icons="using:Material.Icons"
    xmlns:models="using:MTM_Receiving_Application.Module_Dunnage.Models"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:Converter_IntToVisibility x:Key="IntToVisibilityConverter" />
        
        <Style x:Key="IconGridViewItemStyle" TargetType="GridViewItem">
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="VerticalContentAlignment" Value="Stretch" />
            <Setter Property="Margin" Value="2" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="MinWidth" Value="40" />
            <Setter Property="MinHeight" Value="40" />
        </Style>

        <DataTemplate x:Key="IconTemplate" x:DataType="icons:MaterialIconKind">
            <Border Width="40" Height="40" 
                    BorderThickness="1" 
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    CornerRadius="4" 
                    Padding="4" 
                    ToolTipService.ToolTip="{x:Bind ToString()}">
                <materialIcons:MaterialIcon Kind="{x:Bind}" Width="24" Height="24" Foreground="{ThemeResource AccentFillColorDefaultBrush}" />
            </Border>
        </DataTemplate>
        
        <DataTemplate x:Key="RecentIconTemplate" x:DataType="models:Model_IconDefinition">
             <Border Width="40" Height="40" 
                    BorderThickness="1" 
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    CornerRadius="4" 
                    Padding="4" 
                    ToolTipService.ToolTip="{x:Bind Name}">
                <materialIcons:MaterialIcon Kind="{x:Bind Kind}" Width="24" Height="24" Foreground="{ThemeResource AccentFillColorDefaultBrush}" />
            </Border>
        </DataTemplate>
    </UserControl.Resources>

    <StackPanel Spacing="12">

        <!-- Recently Used Section -->
        <StackPanel Spacing="8" Visibility="{x:Bind RecentlyUsedIcons.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}}">
            <TextBlock Text="Recently Used" FontWeight="SemiBold" FontSize="12" />
            <GridView
                x:Name="RecentIconsGrid"
                SelectionMode="Single"
                MaxHeight="60"
                ItemsSource="{x:Bind RecentlyUsedIcons, Mode=OneWay}"
                ItemTemplate="{StaticResource RecentIconTemplate}"
                ItemContainerStyle="{StaticResource IconGridViewItemStyle}"
                SelectionChanged="OnRecentIconSelectionChanged">
                <GridView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <ItemsWrapGrid Orientation="Horizontal" MaximumRowsOrColumns="6" />
                    </ItemsPanelTemplate>
                </GridView.ItemsPanel>
            </GridView>
        </StackPanel>

        <!-- Search Box -->
        <TextBox
            x:Name="SearchBox"
            PlaceholderText="Search icons..."
            TextChanged="OnSearchTextChanged" />

        <!-- All Icons Grid -->
        <GridView
            x:Name="AllIconsGrid"
            SelectionMode="Single"
            SelectedItem="{x:Bind SelectedIcon, Mode=TwoWay}"
            ItemTemplate="{StaticResource IconTemplate}"
            ItemContainerStyle="{StaticResource IconGridViewItemStyle}"
            MaxHeight="300">
            <GridView.ItemsPanel>
                <ItemsPanelTemplate>
                    <ItemsWrapGrid Orientation="Horizontal" MaximumRowsOrColumns="6" />
                </ItemsPanelTemplate>
            </GridView.ItemsPanel>
        </GridView>
    </StackPanel>
</UserControl>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_Control_IconPickerControl.xaml.cs">
public sealed partial class View_Dunnage_Control_IconPickerControl : UserControl
⋮----
public static readonly DependencyProperty SelectedIconProperty =
DependencyProperty.Register(
⋮----
new PropertyMetadata(MaterialIconKind.PackageVariantClosed, OnSelectedIconChanged));
⋮----
public static readonly DependencyProperty RecentlyUsedIconsProperty =
⋮----
new PropertyMetadata(default(ObservableCollection<Model_IconDefinition>)));
⋮----
// Load all icons
_allIcons = Helper_MaterialIcons.GetAllIcons();
_filteredIcons = new ObservableCollection<MaterialIconKind>(_allIcons.Take(200)); // Initial limit for performance
⋮----
private static void OnSelectedIconChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
⋮----
// Update RecentIconsGrid selection if the icon is in the list
⋮----
var recent = control.RecentlyUsedIcons.FirstOrDefault(x => x.Kind == kind);
⋮----
private void OnRecentIconSelectionChanged(object sender, SelectionChangedEventArgs e)
⋮----
private void OnSearchTextChanged(object sender, TextChangedEventArgs e)
⋮----
_filteredIcons.Clear();
⋮----
var matches = Helper_MaterialIcons.SearchIcons(searchText).Take(200);
⋮----
_filteredIcons.Add(icon);
</file>

<file path="Module_Dunnage/Views/View_Dunnage_DetailsEntryView.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_DetailsEntryView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:views="using:MTM_Receiving_Application.Module_Dunnage.Views"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d"
    x:DataType="views:View_Dunnage_DetailsEntryView"
    Loaded="OnLoaded">

    <UserControl.Resources>
        <converters:Converter_IntToVisibility x:Key="IntToVisibilityConverter"/>
        <converters:Converter_BooleanToVisibility x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid Padding="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,16">
            <TextBlock Text="Enter Details"
                       Style="{StaticResource TitleTextBlockStyle}"/>
            <TextBlock Text="{x:Bind ViewModel.GetTip('Dunnage.DetailsEntry'), Mode=OneWay}"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       Style="{StaticResource BodyTextBlockStyle}"/>
        </StackPanel>

        <!-- Inventory Notification -->
        <InfoBar Grid.Row="1"
                 IsOpen="{x:Bind ViewModel.IsInventoryNotificationVisible, Mode=OneWay}"
                 Severity="Informational"
                 Title="Inventory Action Required"
                 Message="{x:Bind ViewModel.InventoryNotificationMessage, Mode=OneWay}"
                 IsClosable="False"
                 Margin="0,0,0,12"/>

        <!-- Details Form -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <StackPanel Spacing="12">
                
                <!-- PO Number and Location Card -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="16">
                    <Grid ColumnSpacing="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- PO Number -->
                        <StackPanel Grid.Column="0" Spacing="6">
                            <TextBlock Text="PO Number"
                                       Style="{StaticResource SubtitleTextBlockStyle}"/>
                            <TextBox x:Name="PoNumberTextBox"
                                     Text="{x:Bind ViewModel.PoNumber, Mode=TwoWay}"
                                     PlaceholderText="{x:Bind ViewModel.GetPlaceholder('Field.PONumber'), Mode=OneWay}"
                                     HorizontalAlignment="Stretch"/>
                            <TextBlock Text="Leave blank for non-PO dunnage"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       Style="{StaticResource CaptionTextBlockStyle}"/>
                        </StackPanel>

                        <!-- Location -->
                        <StackPanel Grid.Column="1" Spacing="6">
                            <TextBlock Text="Location"
                                       Style="{StaticResource SubtitleTextBlockStyle}"/>
                            <TextBox Text="{x:Bind ViewModel.Location, Mode=TwoWay}"
                                     PlaceholderText="{x:Bind ViewModel.GetPlaceholder('Field.Location'), Mode=OneWay}"
                                     HorizontalAlignment="Stretch"/>
                            <TextBlock Text="Where this dunnage is located"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       Style="{StaticResource CaptionTextBlockStyle}"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Specifications Card (Read-Only) -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="16">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Specifications (from selected part)"
                                   Style="{StaticResource SubtitleTextBlockStyle}"/>
                        
                        <Grid ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Column 1: Text Specs -->
                            <StackPanel Grid.Column="0" Spacing="4" 
                                        Visibility="{x:Bind ViewModel.HasTextSpecs, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <ItemsRepeater ItemsSource="{x:Bind ViewModel.TextSpecs, Mode=OneWay}">
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Spacing="2" Margin="0,0,0,6">
                                                <TextBlock Text="{Binding SpecName}" FontWeight="SemiBold" FontSize="12"/>
                                                <TextBox Text="{Binding Value, Mode=OneWay}" 
                                                         IsReadOnly="True"
                                                         Width="180"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>
                            </StackPanel>
                            
                            <!-- Column 2: Number Specs -->
                            <StackPanel Grid.Column="1" Spacing="4"
                                        Visibility="{x:Bind ViewModel.HasNumberSpecs, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <ItemsRepeater ItemsSource="{x:Bind ViewModel.NumberSpecs, Mode=OneWay}">
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Spacing="2" Margin="0,0,0,6">
                                                <TextBlock Text="{Binding SpecName}" FontWeight="SemiBold" FontSize="12"/>
                                                <TextBox Text="{Binding Value, Mode=OneWay}" 
                                                         IsReadOnly="True"
                                                         Width="180"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>
                            </StackPanel>
                            
                            <!-- Column 3: Boolean Specs -->
                            <StackPanel Grid.Column="2" Spacing="4"
                                        Visibility="{x:Bind ViewModel.HasBooleanSpecs, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <ItemsRepeater ItemsSource="{x:Bind ViewModel.BooleanSpecs, Mode=OneWay}">
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate>
                                            <CheckBox Content="{Binding SpecName}" 
                                                      IsChecked="{Binding Value, Mode=OneWay}" 
                                                      IsEnabled="False"
                                                      Margin="0,0,0,6"/>
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>
                            </StackPanel>
                        </Grid>

                        <!-- Placeholder when no specs -->
                        <TextBlock Text="No specifications configured for this type."
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   Visibility="{x:Bind ViewModel.SpecInputs.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter='Inverse'}"
                                   Style="{StaticResource BodyTextBlockStyle}"/>
                    </StackPanel>
                </Border>

                <!-- Info Panel Card -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="16">
                    <StackPanel Spacing="6">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE946;" FontSize="16" Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                            <TextBlock Text="Note" FontWeight="SemiBold"/>
                        </StackPanel>
                        <TextBlock TextWrapping="Wrap" FontSize="12"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                            <Run Text="• PO Number: Use if receiving against a purchase order"/>
                            <LineBreak/>
                            <Run Text="• Location: Physical location of the dunnage"/>
                            <LineBreak/>
                            <Run Text="• Specifications: Pre-filled from the selected part"/>
                        </TextBlock>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_DetailsEntryView.xaml.cs">
public sealed partial class View_Dunnage_DetailsEntryView : UserControl
⋮----
private readonly IService_Focus _focusService;
⋮----
_focusService.AttachFocusOnVisibility(this, PoNumberTextBox);
⋮----
private async void OnLoaded(object sender, RoutedEventArgs e)
⋮----
await ViewModel.LoadSpecsForSelectedPartAsync();
</file>

<file path="Module_Dunnage/Views/View_Dunnage_Dialog_AddMultipleRowsDialog.xaml">
<ContentDialog
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_Dialog_AddMultipleRowsDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Add Multiple Rows"
    PrimaryButtonText="Add"
    CloseButtonText="Cancel"
    DefaultButton="Primary"
    PrimaryButtonClick="ContentDialog_PrimaryButtonClick">

    <StackPanel Spacing="16" Padding="24">
        <TextBlock 
            Text="How many rows would you like to add?" 
            Style="{StaticResource BodyTextBlockStyle}"/>
        
        <NumberBox 
            x:Name="RowCountNumberBox"
            Header="Number of Rows"
            Minimum="1"
            Maximum="100"
            Value="10"
            SpinButtonPlacementMode="Inline"
            ValidationMode="InvalidInputOverwritten"
            AcceptsExpression="False"/>
        
        <InfoBar 
            IsOpen="True"
            Severity="Informational"
            IsClosable="False"
            Message="Maximum 100 rows can be added at once. Each row will be initialized with default values (Quantity = 1)."/>
    </StackPanel>
</ContentDialog>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_Dialog_AddMultipleRowsDialog.xaml.cs">
/// <summary>
/// Dialog for adding multiple rows at once
/// </summary>
public sealed partial class View_Dunnage_Dialog_AddMultipleRowsDialog : ContentDialog
⋮----
private readonly IService_Focus _focusService;
⋮----
_focusService.AttachFocusOnVisibility(this, RowCountNumberBox);
⋮----
private void ContentDialog_PrimaryButtonClick(ContentDialog sender, ContentDialogButtonClickEventArgs args)
</file>

<file path="Module_Dunnage/Views/View_Dunnage_Dialog_AddToInventoriedListDialog.xaml">
<ContentDialog
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_Dialog_AddToInventoriedListDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Add Part to Inventoried List"
    PrimaryButtonText="Add to List"
    CloseButtonText="Cancel"
    DefaultButton="Primary"
    PrimaryButtonClick="OnPrimaryButtonClick">

    <ScrollViewer MaxHeight="500">
        <StackPanel Spacing="12" Padding="24">
            
            <!-- Part ID Selection -->
            <TextBlock Text="Part ID" FontWeight="SemiBold"/>
            <ComboBox x:Name="PartIdComboBox"
                      PlaceholderText="Select a part..."
                      HorizontalAlignment="Stretch"
                      IsEditable="True"
                      TextSubmitted="PartIdComboBox_TextSubmitted"/>
            <TextBlock x:Name="PartIdError"
                       Text="Part ID is required"
                       Foreground="{ThemeResource SystemErrorTextColor}"
                       Visibility="Collapsed"
                       Margin="0,-8,0,0"/>

            <!-- Inventory Method -->
            <TextBlock Text="Inventory Method" FontWeight="SemiBold" Margin="0,12,0,0"/>
            <ComboBox x:Name="InventoryMethodComboBox"
                      HorizontalAlignment="Stretch"
                      SelectedIndex="2">
                <ComboBoxItem Content="Adjust In"/>
                <ComboBoxItem Content="Receive In"/>
                <ComboBoxItem Content="Both"/>
            </ComboBox>
            <TextBlock Text="Adjust In: Only triggers during inventory adjustments"
                       Style="{StaticResource CaptionTextBlockStyle}"
                       Foreground="{ThemeResource SystemControlDisabledBaseMediumLowBrush}"
                       TextWrapping="Wrap"
                       Margin="0,-8,0,0"/>
            <TextBlock Text="Receive In: Only triggers during receiving transactions"
                       Style="{StaticResource CaptionTextBlockStyle}"
                       Foreground="{ThemeResource SystemControlDisabledBaseMediumLowBrush}"
                       TextWrapping="Wrap"/>
            <TextBlock Text="Both: Triggers for both adjust and receive operations"
                       Style="{StaticResource CaptionTextBlockStyle}"
                       Foreground="{ThemeResource SystemControlDisabledBaseMediumLowBrush}"
                       TextWrapping="Wrap"/>

            <!-- Notes -->
            <TextBlock Text="Notes (optional)" FontWeight="SemiBold" Margin="0,12,0,0"/>
            <TextBox x:Name="NotesTextBox"
                     PlaceholderText="Add any notes or special instructions..."
                     AcceptsReturn="True"
                     TextWrapping="Wrap"
                     Height="80"/>

        </StackPanel>
    </ScrollViewer>
</ContentDialog>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_Dialog_AddToInventoriedListDialog.xaml.cs">
public sealed partial class View_Dunnage_Dialog_AddToInventoriedListDialog : ContentDialog
⋮----
private readonly Dao_DunnagePart _daoPart;
private readonly Dao_InventoriedDunnage _daoInventory;
private readonly IService_Focus _focusService;
⋮----
_focusService.AttachFocusOnVisibility(this);
⋮----
private async Task LoadPartsAsync()
⋮----
var result = await _daoPart.GetAllAsync();
⋮----
PartIdComboBox.ItemsSource = result.Data.ConvertAll(p => p.PartId);
⋮----
// Silent fail - user can still type part ID
⋮----
private void PartIdComboBox_TextSubmitted(ComboBox sender, ComboBoxTextSubmittedEventArgs args)
⋮----
// Validate part ID exists when user types and presses enter
if (!string.IsNullOrWhiteSpace(args.Text))
⋮----
private async void OnPrimaryButtonClick(ContentDialog sender, ContentDialogButtonClickEventArgs args)
⋮----
// Get deferral to perform async validation
var deferral = args.GetDeferral();
⋮----
// Validate Part ID
⋮----
if (string.IsNullOrWhiteSpace(partId))
⋮----
// Check if part already in inventoried list
var checkResult = await _daoInventory.GetByPartAsync(partId);
⋮----
// Show error - part already in list
var errorDialog = new ContentDialog
⋮----
await errorDialog.ShowAsync();
⋮----
// Get selected inventory method
⋮----
// Get notes
⋮----
// Insert into database
var insertResult = await _daoInventory.InsertAsync(
⋮----
// Show error
⋮----
deferral.Complete();
</file>

<file path="Module_Dunnage/Views/View_Dunnage_Dialog_Dunnage_AddTypeDialog.xaml">
<ContentDialog
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_Dialog_Dunnage_AddTypeDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:MTM_Receiving_Application.Module_Dunnage.Views.Controls"
    xmlns:models="using:MTM_Receiving_Application.Module_Dunnage.Models"
    xmlns:viewmodels="using:MTM_Receiving_Application.Module_Dunnage.ViewModels"
    xmlns:materialIcons="using:Material.Icons.WinUI3"
    x:Name="Root"
    Title="Add New Dunnage Type"
    PrimaryButtonText="Save Type"
    CloseButtonText="Cancel"
    DefaultButton="Primary"
    MaxHeight="750"
    PrimaryButtonCommand="{x:Bind ViewModel.SaveTypeCommand}"
    IsPrimaryButtonEnabled="{x:Bind ViewModel.CanSave, Mode=OneWay}">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="16" Padding="24">

            <!-- Duplicate Warning InfoBar -->
            <InfoBar
                Severity="Warning"
                IsOpen="{x:Bind ViewModel.ShowDuplicateWarning, Mode=OneWay}"
                Title="Duplicate Type Name"
                Message="A type with this name already exists.">
                <InfoBar.ActionButton>
                    <HyperlinkButton Content="View Existing Type" />
                </InfoBar.ActionButton>
            </InfoBar>

            <!-- Field Limit Warning InfoBar -->
            <InfoBar
                Severity="Informational"
                IsOpen="{x:Bind ViewModel.ShowFieldLimitWarning, Mode=OneWay}"
                Title="Many Custom Fields"
                Message="You have added 10+ custom fields. Consider grouping similar fields for better usability." />

            <!-- Basic Information Section -->
            <StackPanel Spacing="12">
                <TextBlock Text="Basic Information" Style="{StaticResource SubtitleTextBlockStyle}" />

                <!-- Type Name -->
                <TextBox
                    Header="Type Name"
                    PlaceholderText="Enter dunnage type name (e.g., Pallet - 48x40)"
                    Text="{x:Bind ViewModel.TypeName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    BorderBrush="{x:Bind ViewModel.TypeNameError, Mode=OneWay, Converter={StaticResource ErrorToBrushConverter}}"
                    MaxLength="100" />

                <TextBlock
                    Text="{x:Bind ViewModel.TypeNameError, Mode=OneWay}"
                    Foreground="Red"
                    Visibility="{x:Bind ViewModel.TypeNameError, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}"
                    Margin="0,-8,0,0" />

                <!-- Icon Picker Button -->
                <TextBlock Text="Icon" Margin="0,8,0,0" FontWeight="SemiBold" />
                <Button x:Name="SelectIconButton"
                        Click="OnSelectIconClick"
                        HorizontalAlignment="Stretch"
                        Padding="16,12"
                        ToolTipService.ToolTip="Click to browse and select an icon from the icon library">
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <materialIcons:MaterialIcon 
                            Kind="{x:Bind ViewModel.SelectedIcon, Mode=OneWay}" 
                            Width="32" 
                            Height="32"
                            Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Click to select icon" FontWeight="SemiBold"/>
                            <TextBlock 
                                Text="{x:Bind ViewModel.SelectedIcon, Mode=OneWay}"
                                FontSize="12"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </StackPanel>
                </Button>
            </StackPanel>

            <!-- Custom Specifications Section -->
            <StackPanel Spacing="12" Margin="0,16,0,0">
                <TextBlock Text="Custom Specifications" Style="{StaticResource SubtitleTextBlockStyle}" />

                <!-- Add New Field Form -->
                <Border
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Add Custom Field" FontWeight="SemiBold" />

                        <TextBox
                            Header="Field Name"
                            PlaceholderText="Enter field name (e.g., Width, Material)"
                            Text="{x:Bind ViewModel.FieldName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            BorderBrush="{x:Bind ViewModel.FieldNameError, Mode=OneWay, Converter={StaticResource ErrorToBrushConverter}}"
                            MaxLength="100" />

                        <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,-8,0,0">
                            <TextBlock
                                Text="{x:Bind ViewModel.FieldNameError, Mode=OneWay}"
                                Foreground="Red"
                                Visibility="{x:Bind ViewModel.FieldNameError, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}" />
                            <TextBlock
                                Text="{x:Bind ViewModel.FieldCharacterCount, Mode=OneWay}"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                HorizontalAlignment="Right" />
                            <TextBlock Text="/100 characters" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                        </StackPanel>

                        <ComboBox
                            Header="Field Type"
                            SelectedItem="{x:Bind ViewModel.FieldType, Mode=TwoWay}"
                            HorizontalAlignment="Stretch">
                            <x:String>Text</x:String>
                            <x:String>Number</x:String>
                            <x:String>Dropdown</x:String>
                            <x:String>Yes/No</x:String>
                        </ComboBox>

                        <CheckBox
                            Content="Required field"
                            IsChecked="{x:Bind ViewModel.IsFieldRequired, Mode=TwoWay}" />

                        <Button
                            Content="{x:Bind ViewModel.EditingField, Mode=OneWay, Converter={StaticResource EditingFieldToTextConverter}}"
                            Command="{x:Bind ViewModel.AddFieldCommand}"
                            IsEnabled="{x:Bind ViewModel.CanAddField, Mode=OneWay}"
                            Style="{StaticResource AccentButtonStyle}"
                            HorizontalAlignment="Right" />
                    </StackPanel>
                </Border>

                <!-- Field Preview List -->
                <TextBlock
                    Text="Custom Fields Preview"
                    FontWeight="SemiBold"
                    Visibility="{x:Bind ViewModel.CustomFields.Count, Mode=OneWay, Converter={StaticResource CountToVisibilityConverter}}"
                    Margin="0,8,0,0" />

                <ItemsRepeater
                    ItemsSource="{x:Bind ViewModel.CustomFields, Mode=OneWay}">
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="models:Model_CustomFieldDefinition">
                            <Border
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="12"
                                Margin="0,4"
                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                                <Grid ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <!-- Drag Handle -->
                                    <FontIcon Grid.Column="0" Glyph="&#xE76F;" FontSize="16" VerticalAlignment="Center" />

                                    <!-- Field Info -->
                                    <StackPanel Grid.Column="1" Spacing="4">
                                        <TextBlock Text="{x:Bind FieldName}" FontWeight="SemiBold" />
                                        <TextBlock
                                            Text="{x:Bind GetSummary()}"
                                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                            FontSize="12" />
                                    </StackPanel>

                                    <!-- Edit/Delete Buttons -->
                                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4">
                                        <Button
                                            Content="Edit"
                                            Command="{Binding EditFieldCommand}"
                                            CommandParameter="{x:Bind}"
                                            Style="{StaticResource TextBlockButtonStyle}" />
                                        <Button
                                            Content="Delete"
                                            Command="{Binding DeleteFieldCommand}"
                                            CommandParameter="{x:Bind}"
                                            Style="{StaticResource TextBlockButtonStyle}"
                                            Foreground="Red" />
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>

                <TextBlock
                    Text="No custom fields added yet. Click 'Add Field' to create one."
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Visibility="{x:Bind ViewModel.CustomFields.Count, Mode=OneWay, Converter={StaticResource InverseCountToVisibilityConverter}}"
                    HorizontalAlignment="Center"
                    Margin="0,16" />
            </StackPanel>

        </StackPanel>
    </ScrollViewer>
</ContentDialog>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_Dialog_Dunnage_AddTypeDialog.xaml.cs">
public sealed partial class View_Dunnage_Dialog_Dunnage_AddTypeDialog : ContentDialog
⋮----
private readonly IService_Focus _focusService;
⋮----
_focusService.AttachFocusOnVisibility(this);
⋮----
private async void OnSelectIconClick(object sender, RoutedEventArgs e)
⋮----
var iconSelector = new View_Shared_IconSelectorWindow();
⋮----
// Set initial selection to current icon
iconSelector.SetInitialSelection(ViewModel.SelectedIcon);
⋮----
iconSelector.Activate();
⋮----
// Wait for the window to close and get the result
var selectedIcon = await iconSelector.WaitForSelectionAsync();
</file>

<file path="Module_Dunnage/Views/View_Dunnage_EditModeView.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_EditModeView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:viewmodels="using:MTM_Receiving_Application.Module_Dunnage.ViewModels"
    xmlns:enums="using:MTM_Receiving_Application.Module_Core.Models.Enums"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d"
    x:Name="Root">

    <UserControl.Resources>
        <converters:Converter_DecimalToString x:Key="DecimalToStringConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Toolbar - T154: 3 data source buttons -->
        <Grid Grid.Row="0" Margin="0,0,0,12">
            <!-- Main Toolbar Area -->
            <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                <!-- Load Data Section - T154 -->
                <TextBlock Text="Load Data From:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,4,0"/>
                
                <Button Command="{x:Bind ViewModel.LoadFromCurrentMemoryCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.LoadSessionMemory'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE81D;"/>
                        <TextBlock Text="Current Memory"/>
                    </StackPanel>
                </Button>

                <Button Command="{x:Bind ViewModel.LoadFromCurrentLabelsCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.LoadRecentCSV'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8E5;"/>
                        <TextBlock Text="Current Labels"/>
                    </StackPanel>
                </Button>
                
                <Button Command="{x:Bind ViewModel.LoadFromHistoryCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.LoadHistoricalData'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74C;"/>
                        <TextBlock Text="History"/>
                    </StackPanel>
                </Button>

                <!-- Separator -->
                <Rectangle Width="1" Height="24" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" Margin="8,0"/>

                <!-- Edit Actions Section -->
                <Button Command="{x:Bind ViewModel.SelectAllCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8B3;"/>
                        <TextBlock Text="Select All"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.RemoveSelectedRowsCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.RemoveSelectedRows'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74D;"/>
                        <TextBlock Text="Remove Selected"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Date Filter Toolbar - T164: Dynamic button text -->
        <Grid Grid.Row="1" Margin="0,0,0,12">
            <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                <TextBlock Text="Filter Date:" VerticalAlignment="Center" FontWeight="SemiBold"/>
                
                <CalendarDatePicker Date="{x:Bind ViewModel.FromDate, Mode=TwoWay}" 
                                   PlaceholderText="{x:Bind ViewModel.GetPlaceholder('Field.StartDate'), Mode=OneWay}"
                                   Width="140"/>
                <TextBlock Text="to" VerticalAlignment="Center"/>
                <CalendarDatePicker Date="{x:Bind ViewModel.ToDate, Mode=TwoWay}" 
                                   PlaceholderText="{x:Bind ViewModel.GetPlaceholder('Field.EndDate'), Mode=OneWay}"
                                   Width="140"/>
                
                <Rectangle Width="1" Height="24" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" Margin="8,0"/>
                
                <!-- T158, T159, T160, T161, T162, T163, T164: Date filter buttons with dynamic text -->
                <Button Content="{x:Bind ViewModel.LastWeekButtonText, Mode=OneTime}" 
                        Command="{x:Bind ViewModel.SetFilterLastWeekCommand}"
                        ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.FilterLastWeek'), Mode=OneWay}"/>
                <Button Content="{x:Bind ViewModel.TodayButtonText, Mode=OneTime}" 
                        Command="{x:Bind ViewModel.SetFilterTodayCommand}"
                        ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.FilterToday'), Mode=OneWay}"/>
                <Button Content="{x:Bind ViewModel.ThisWeekButtonText, Mode=OneTime}" 
                        Command="{x:Bind ViewModel.SetFilterThisWeekCommand}"
                        ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.FilterThisWeek'), Mode=OneWay}"/>
                <Button Content="{x:Bind ViewModel.ThisMonthButtonText, Mode=OneTime}" 
                        Command="{x:Bind ViewModel.SetFilterThisMonthCommand}"
                        ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.FilterThisMonth'), Mode=OneWay}"/>
                <Button Content="{x:Bind ViewModel.ThisQuarterButtonText, Mode=OneTime}" 
                        Command="{x:Bind ViewModel.SetFilterThisQuarterCommand}"
                        ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.FilterThisQuarter'), Mode=OneWay}"/>
                <Button Content="Show All" 
                        Command="{x:Bind ViewModel.SetFilterShowAllCommand}"
                        ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.FilterShowAll'), Mode=OneWay}"/>
            </StackPanel>
        </Grid>

        <!-- Data Grid -->
        <controls:DataGrid Grid.Row="2"
                          x:Name="EditModeDataGrid"
                          ItemsSource="{x:Bind ViewModel.FilteredLoads, Mode=OneWay}"
                          AutoGenerateColumns="False"
                          IsReadOnly="False"
                          CanUserSortColumns="True"
                          GridLinesVisibility="All"
                          HeadersVisibility="Column"
                          SelectionMode="Single"
                          KeyDown="EditModeDataGrid_KeyDown"
                          CurrentCellChanged="EditModeDataGrid_CurrentCellChanged"
                          Tapped="EditModeDataGrid_Tapped">
            <controls:DataGrid.Columns>
                <controls:DataGridTemplateColumn Header="" Width="50" CanUserResize="False">
                    <controls:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}" 
                                      HorizontalAlignment="Center" 
                                      VerticalAlignment="Center"
                                      MinWidth="0"
                                      Margin="0"/>
                        </DataTemplate>
                    </controls:DataGridTemplateColumn.CellTemplate>
                </controls:DataGridTemplateColumn>
                <controls:DataGridTextColumn Header="Load #" Binding="{Binding LoadNumber}" IsReadOnly="True" Width="Auto"/>
                <controls:DataGridTextColumn Header="Type" Binding="{Binding TypeName}" Width="*"/>
                <controls:DataGridTextColumn Header="Part ID" Binding="{Binding PartId}" Width="*"/>
                <controls:DataGridTextColumn Header="Quantity" Binding="{Binding Quantity}" Width="Auto"/>
                <controls:DataGridTextColumn Header="PO Number" Binding="{Binding PoNumber}" Width="Auto"/>
                <controls:DataGridTextColumn Header="Location" Binding="{Binding Location}" Width="Auto"/>
                <controls:DataGridTextColumn Header="Created Date" Binding="{Binding CreatedDate}" IsReadOnly="True" Width="Auto"/>
                <controls:DataGridTextColumn Header="Created By" Binding="{Binding CreatedBy}" IsReadOnly="True" Width="Auto"/>
            </controls:DataGrid.Columns>
        </controls:DataGrid>

        <!-- Footer: Pagination and Save -->
        <Grid Grid.Row="3" Margin="0,12,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Pagination Controls -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                <Button Command="{x:Bind ViewModel.FirstPageCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.FirstPage'), Mode=OneWay}">
                    <FontIcon Glyph="&#xE892;"/>
                </Button>
                <Button Command="{x:Bind ViewModel.PreviousPageCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.PreviousPage'), Mode=OneWay}">
                    <FontIcon Glyph="&#xE76B;"/>
                </Button>
                
                <Rectangle Width="1" Height="24" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" Margin="8,0"/>
                
                <TextBlock Text="Page" VerticalAlignment="Center"/>
                <TextBlock Text="{x:Bind ViewModel.CurrentPage, Mode=OneWay}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                <TextBlock Text="of" VerticalAlignment="Center"/>
                <TextBlock Text="{x:Bind ViewModel.TotalPages, Mode=OneWay}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                
                <Rectangle Width="1" Height="24" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" Margin="8,0"/>
                
                <Button Command="{x:Bind ViewModel.NextPageCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.NextPage'), Mode=OneWay}">
                    <FontIcon Glyph="&#xE76C;"/>
                </Button>
                <Button Command="{x:Bind ViewModel.LastPageCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.LastPage'), Mode=OneWay}">
                    <FontIcon Glyph="&#xE893;"/>
                </Button>
            </StackPanel>

            <!-- Save Button -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12">
                <Button Content="Save Changes" Command="{x:Bind ViewModel.SaveAllCommand}" Style="{StaticResource AccentButtonStyle}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.SaveChanges'), Mode=OneWay}"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_EditModeView.xaml.cs">
public sealed partial class View_Dunnage_EditModeView : UserControl
⋮----
private readonly IService_Focus _focusService;
⋮----
this.InitializeComponent();
⋮----
_focusService.AttachFocusOnVisibility(this);
⋮----
private void EditModeDataGrid_CurrentCellChanged(object? sender, EventArgs e)
⋮----
// Wait for the move to complete then activate edit mode
grid?.DispatcherQueue.TryEnqueue(() =>
⋮----
Debug.WriteLine($"[Dunnage_EditModeView] CurrentCellChanged: BeginEdit for Row={grid.SelectedIndex}, Col={grid.CurrentColumn.Header}");
grid.BeginEdit();
⋮----
private void EditModeDataGrid_KeyDown(object sender, KeyRoutedEventArgs e)
⋮----
var shiftState = InputKeyboardSource.GetKeyStateForCurrentThread(VirtualKey.Shift);
⋮----
Debug.WriteLine($"[Dunnage_EditModeView] KeyDown: Key={e.Key}, Shift={isShiftDown}, OriginalSource={e.OriginalSource}, CurrentColumn={grid.CurrentColumn?.Header}");
⋮----
private void EditModeDataGrid_Tapped(object sender, TappedRoutedEventArgs e)
⋮----
Debug.WriteLine($"[Dunnage_EditModeView] Tapped: OriginalSource={e.OriginalSource}");
⋮----
// Handle empty grid or header clicks
⋮----
Debug.WriteLine("[Dunnage_EditModeView] Tapped: Grid empty");
⋮----
Debug.WriteLine("[Dunnage_EditModeView] Tapped: SelectedItem is null (Header or empty space). Selecting first editable cell.");
// Header clicked or empty space
⋮----
// Cell clicked - CurrentCellChanged handles the edit mode if cell changes.
// But if we tap the SAME cell, CurrentCellChanged might not fire.
// So we ensure edit mode here too.
Debug.WriteLine("[Dunnage_EditModeView] Tapped: Cell clicked. Enqueuing BeginEdit.");
grid.DispatcherQueue.TryEnqueue(() =>
⋮----
Debug.WriteLine($"[Dunnage_EditModeView] Tapped: BeginEdit for Row={grid.SelectedIndex}, Col={grid.CurrentColumn.Header}");
⋮----
private void SelectFirstEditableCell(DataGrid grid)
⋮----
Debug.WriteLine("[Dunnage_EditModeView] SelectFirstEditableCell: Starting");
⋮----
// Find first non-readonly column
var firstEditable = grid.Columns.OrderBy(c => c.DisplayIndex).FirstOrDefault(c => !c.IsReadOnly);
⋮----
Debug.WriteLine($"[Dunnage_EditModeView] SelectFirstEditableCell: Found editable column {firstEditable.Header}. Setting CurrentColumn and calling BeginEdit.");
⋮----
grid.Focus(Microsoft.UI.Xaml.FocusState.Programmatic);
⋮----
Debug.WriteLine($"[Dunnage_EditModeView] SelectFirstEditableCell: BeginEdit called for column {firstEditable.Header}");
⋮----
Debug.WriteLine("[Dunnage_EditModeView] SelectFirstEditableCell: No editable column found.");
⋮----
Debug.WriteLine($"[Dunnage_EditModeView] SelectFirstEditableCell: Grid has no items (Count={itemCount})");
</file>

<file path="Module_Dunnage/Views/View_Dunnage_ManualEntryView.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_ManualEntryView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:viewmodels="using:MTM_Receiving_Application.Module_Dunnage.ViewModels"
    xmlns:enums="using:MTM_Receiving_Application.Module_Core.Models.Enums"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d"
    x:Name="Root">

    <UserControl.Resources>
        <converters:Converter_DecimalToString x:Key="DecimalToStringConverter"/>
        <converters:Converter_LoadNumberToOneBased x:Key="LoadNumberConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Grid Grid.Row="0" Margin="0,0,0,12">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                <StackPanel Orientation="Horizontal" Spacing="12" Padding="0,0,12,0">
                <Button Command="{x:Bind ViewModel.AddRowCommand}" Style="{StaticResource AccentButtonStyle}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.AddRow'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE710;"/>
                        <TextBlock Text="Add Row"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.AddMultipleRowsCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.AddMultipleRows'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE710;"/>
                        <TextBlock Text="Add Multiple"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.RemoveRowCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.RemoveRow'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74D;"/>
                        <TextBlock Text="Remove Row"/>
                    </StackPanel>
                </Button>
                
                <Rectangle Width="1" Height="24" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" Margin="8,0"/>
                
                <Button Command="{x:Bind ViewModel.AutoFillCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.AutoFill'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74E;"/>
                        <TextBlock Text="Auto-Fill"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.FillBlankSpacesCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.FillBlanks'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8B7;"/>
                        <TextBlock Text="Fill Blank Spaces"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.SortForPrintingCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.SortForPrinting'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8CB;"/>
                        <TextBlock Text="Sort"/>
                    </StackPanel>
                </Button>
                
                <Rectangle Width="1" Height="24" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" Margin="8,0"/>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- Data Grid -->
        <controls:DataGrid Grid.Row="1"
                          x:Name="ManualEntryDataGrid"
                          ItemsSource="{x:Bind ViewModel.Loads, Mode=OneWay}"
                          SelectedItem="{x:Bind ViewModel.SelectedLoad, Mode=TwoWay}"
                          AutoGenerateColumns="False"
                          IsReadOnly="False"
                          CanUserSortColumns="True"
                          GridLinesVisibility="All"
                          HeadersVisibility="Column"
                          SelectionMode="Single"
                          KeyDown="ManualEntryDataGrid_KeyDown"
                          CurrentCellChanged="ManualEntryDataGrid_CurrentCellChanged"
                          Tapped="ManualEntryDataGrid_Tapped">
            <controls:DataGrid.Columns>
                <controls:DataGridTextColumn Header="Load #" 
                                           Binding="{Binding LoadNumber, Converter={StaticResource LoadNumberConverter}}" 
                                           IsReadOnly="True" 
                                           Width="Auto"/>
                <controls:DataGridTextColumn Header="Type" 
                                           Binding="{Binding TypeName}" 
                                           Width="*"/>
                <controls:DataGridTextColumn Header="Part ID" 
                                           Binding="{Binding PartId}" 
                                           Width="*"/>
                <controls:DataGridTextColumn Header="Quantity" 
                                           Binding="{Binding Quantity}" 
                                           Width="Auto"/>
                <controls:DataGridTextColumn Header="PO Number" 
                                           Binding="{Binding PoNumber}" 
                                           Width="Auto"/>
                <controls:DataGridTextColumn Header="Location" 
                                           Binding="{Binding Location}" 
                                           Width="Auto"/>
                <controls:DataGridTextColumn Header="Home Location" 
                                           Binding="{Binding HomeLocation}" 
                                           Width="Auto"/>
            </controls:DataGrid.Columns>
        </controls:DataGrid>

        <!-- Navigation -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0" Spacing="12">
            <Button Content="Save &amp; Finish" Command="{x:Bind ViewModel.SaveAllCommand}" Style="{StaticResource AccentButtonStyle}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.SaveAndFinish'), Mode=OneWay}"/>
        </StackPanel>
    </Grid>
</UserControl>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_ManualEntryView.xaml.cs">
public sealed partial class View_Dunnage_ManualEntryView : UserControl
⋮----
private readonly IService_Focus _focusService;
⋮----
this.InitializeComponent();
⋮----
// Listen for collection changes to handle "Add Row" focus
⋮----
_focusService.AttachFocusOnVisibility(this);
⋮----
private void Loads_CollectionChanged(object? sender, System.Collections.Specialized.NotifyCollectionChangedEventArgs e)
⋮----
Debug.WriteLine("[Dunnage_ManualEntryView] Loads_CollectionChanged: New row added");
// When a new row is added, ensure we focus and edit the first cell
ManualEntryDataGrid.DispatcherQueue.TryEnqueue(() =>
⋮----
// Select the last added item (assuming add to bottom)
⋮----
Debug.WriteLine($"[Dunnage_ManualEntryView] Loads_CollectionChanged: Selecting new item LoadNumber={newItem.LoadNumber}");
⋮----
ManualEntryDataGrid.ScrollIntoView(newItem, ManualEntryDataGrid.Columns.FirstOrDefault());
⋮----
// Use async delay to ensure grid is fully ready before entering edit mode
_ = Task.Run(async () =>
⋮----
await Task.Delay(100); // Give grid time to complete selection and render
⋮----
private void ManualEntryDataGrid_CurrentCellChanged(object? sender, EventArgs e)
⋮----
// Wait for the move to complete then activate edit mode
grid?.DispatcherQueue.TryEnqueue(() =>
⋮----
Debug.WriteLine($"[Dunnage_ManualEntryView] CurrentCellChanged: BeginEdit for Row={grid.SelectedIndex}, Col={grid.CurrentColumn.Header}");
grid.BeginEdit();
⋮----
private void ManualEntryDataGrid_KeyDown(object sender, KeyRoutedEventArgs e)
⋮----
var shiftState = InputKeyboardSource.GetKeyStateForCurrentThread(VirtualKey.Shift);
⋮----
Debug.WriteLine($"[Dunnage_ManualEntryView] KeyDown: Key={e.Key}, Shift={isShiftDown}, OriginalSource={e.OriginalSource}, CurrentColumn={grid.CurrentColumn?.Header}");
⋮----
private void ManualEntryDataGrid_Tapped(object sender, TappedRoutedEventArgs e)
⋮----
Debug.WriteLine($"[Dunnage_ManualEntryView] Tapped: OriginalSource={e.OriginalSource}");
⋮----
// Handle empty grid or header clicks
⋮----
Debug.WriteLine("[Dunnage_ManualEntryView] Tapped: Grid empty, triggering AddRow command.");
if (ViewModel.AddRowCommand.CanExecute(null))
⋮----
ViewModel.AddRowCommand.Execute(null);
⋮----
// Focus handled by Loads_CollectionChanged
⋮----
Debug.WriteLine("[Dunnage_ManualEntryView] Tapped: SelectedItem is null (Header or empty space). Selecting first editable cell.");
// Header clicked or empty space
⋮----
// Cell clicked - CurrentCellChanged handles the edit mode if cell changes.
// But if we tap the SAME cell, CurrentCellChanged might not fire.
// So we ensure edit mode here too.
Debug.WriteLine("[Dunnage_ManualEntryView] Tapped: Cell clicked. Enqueuing BeginEdit.");
grid.DispatcherQueue.TryEnqueue(() =>
⋮----
Debug.WriteLine($"[Dunnage_ManualEntryView] Tapped: BeginEdit for Row={grid.SelectedIndex}, Col={grid.CurrentColumn.Header}");
⋮----
private void SelectFirstEditableCell(DataGrid grid)
⋮----
Debug.WriteLine("[Dunnage_ManualEntryView] SelectFirstEditableCell: Starting");
⋮----
// Find first non-readonly column
var firstEditable = grid.Columns.OrderBy(c => c.DisplayIndex).FirstOrDefault(c => !c.IsReadOnly);
⋮----
Debug.WriteLine($"[Dunnage_ManualEntryView] SelectFirstEditableCell: Found editable column {firstEditable.Header}. Setting CurrentColumn and calling BeginEdit.");
⋮----
grid.Focus(Microsoft.UI.Xaml.FocusState.Programmatic);
⋮----
Debug.WriteLine($"[Dunnage_ManualEntryView] SelectFirstEditableCell: BeginEdit called for column {firstEditable.Header}");
⋮----
Debug.WriteLine("[Dunnage_ManualEntryView] SelectFirstEditableCell: No editable column found.");
⋮----
Debug.WriteLine($"[Dunnage_ManualEntryView] SelectFirstEditableCell: Grid has no items (Count={itemCount})");
</file>

<file path="Module_Dunnage/Views/View_Dunnage_ModeSelectionView.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_ModeSelectionView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:MTM_Receiving_Application.Module_Dunnage.ViewModels"
    mc:Ignorable="d">

    <Grid>
        <StackPanel Spacing="32" HorizontalAlignment="Center" VerticalAlignment="Center">
            <StackPanel Orientation="Horizontal" Spacing="24">
                <!-- Guided Wizard Column -->
                <StackPanel Spacing="12">
                    <Button Command="{x:Bind ViewModel.SelectGuidedModeCommand}"
                            Width="280" Height="180"
                            Padding="20"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            AutomationProperties.Name="Guided Wizard Mode">
                        <StackPanel Spacing="12">
                            <FontIcon Glyph="&#xE771;" 
                                      FontSize="48" 
                                      Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                            <TextBlock Text="Guided Wizard" Style="{StaticResource SubtitleTextBlockStyle}" HorizontalAlignment="Center"/>
                            <TextBlock Text="Step-by-step workflow for dunnage receiving with validation at each stage." 
                                       Style="{StaticResource BodyTextBlockStyle}" 
                                       TextWrapping="Wrap" 
                                       TextAlignment="Center"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Guided Mode Checkbox -->
                    <CheckBox Content="Set as default mode"
                              IsChecked="{x:Bind ViewModel.IsGuidedModeDefault, Mode=TwoWay}"
                              Command="{x:Bind ViewModel.SetGuidedAsDefaultCommand}"
                              CommandParameter="{Binding IsChecked, RelativeSource={RelativeSource Self}}"
                              HorizontalAlignment="Center"
                              ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Tooltip.Button.QuickGuidedWizard'), Mode=OneWay}"/>
                </StackPanel>

                <!-- Manual Entry Column -->
                <StackPanel Spacing="12">
                    <Button Command="{x:Bind ViewModel.SelectManualModeCommand}"
                            Width="280" Height="180"
                            Padding="20"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            AutomationProperties.Name="Manual Entry Mode">
                        <StackPanel Spacing="12">
                            <FontIcon Glyph="&#xE7F0;" 
                                      FontSize="48" 
                                      Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                            <TextBlock Text="Manual Entry" Style="{StaticResource SubtitleTextBlockStyle}" HorizontalAlignment="Center"/>
                            <TextBlock Text="Bulk grid entry for receiving multiple dunnage items simultaneously." 
                                       Style="{StaticResource BodyTextBlockStyle}" 
                                       TextWrapping="Wrap" 
                                       TextAlignment="Center"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Manual Mode Checkbox -->
                    <CheckBox Content="Set as default mode"
                              IsChecked="{x:Bind ViewModel.IsManualModeDefault, Mode=TwoWay}"
                              Command="{x:Bind ViewModel.SetManualAsDefaultCommand}"
                              CommandParameter="{Binding IsChecked, RelativeSource={RelativeSource Self}}"
                              HorizontalAlignment="Center"
                              ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Tooltip.Button.QuickManualEntry'), Mode=OneWay}"/>
                </StackPanel>

                <!-- Edit Mode Column -->
                <StackPanel Spacing="12">
                    <Button Command="{x:Bind ViewModel.SelectEditModeCommand}"
                            Width="280" Height="180"
                            Padding="20"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            AutomationProperties.Name="Edit Mode">
                        <StackPanel Spacing="12">
                            <FontIcon Glyph="&#xE70F;" 
                                      FontSize="48" 
                                      Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                            <TextBlock Text="Edit Mode" Style="{StaticResource SubtitleTextBlockStyle}" HorizontalAlignment="Center"/>
                            <TextBlock Text="Load historical dunnage records for editing and correction." 
                                       Style="{StaticResource BodyTextBlockStyle}" 
                                       TextWrapping="Wrap" 
                                       TextAlignment="Center"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Edit Mode Checkbox -->
                    <CheckBox Content="Set as default mode"
                              IsChecked="{x:Bind ViewModel.IsEditModeDefault, Mode=TwoWay}"
                              Command="{x:Bind ViewModel.SetEditAsDefaultCommand}"
                              CommandParameter="{Binding IsChecked, RelativeSource={RelativeSource Self}}"
                              HorizontalAlignment="Center"
                              ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.QuickEditMode'), Mode=OneWay}"/>
                </StackPanel>
            </StackPanel>
        </StackPanel>
    </Grid>
</UserControl>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_ModeSelectionView.xaml.cs">
/// <summary>
/// UserControl for Dunnage Mode Selection view
/// </summary>
public sealed partial class View_Dunnage_ModeSelectionView : UserControl
</file>

<file path="Module_Dunnage/Views/View_Dunnage_PartSelectionView.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_PartSelectionView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mi="using:Material.Icons.WinUI3"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:MTM_Receiving_Application.Module_Dunnage.Models"
    xmlns:views="using:MTM_Receiving_Application.Module_Dunnage.Views"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d"
    x:DataType="views:View_Dunnage_PartSelectionView"
    Loaded="OnLoaded">

    <UserControl.Resources>
        <converters:Converter_BooleanToVisibility x:Key="BooleanToVisibilityConverter"/>
        <converters:Converter_EmptyStringToVisibility x:Key="EmptyStringToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,24">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <TextBlock Style="{StaticResource TitleTextBlockStyle}" Text="Select Part - "/>
                <mi:MaterialIcon Kind="{x:Bind ViewModel.SelectedTypeIconKind, Mode=OneWay}" 
                                 Width="24" Height="24"
                                 Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                                 VerticalAlignment="Center"/>
                <TextBlock Text="{x:Bind ViewModel.SelectedTypeName, Mode=OneWay}" 
                           Style="{StaticResource TitleTextBlockStyle}"/>
            </StackPanel>
            <TextBlock Text="{x:Bind ViewModel.GetTip('Dunnage.PartSelection'), Mode=OneWay}"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       Style="{StaticResource BodyTextBlockStyle}"/>
        </StackPanel>

        <!-- Inventory Notification -->
        <InfoBar Grid.Row="1"
                 IsOpen="{x:Bind ViewModel.IsInventoryNotificationVisible, Mode=OneWay}"
                 Severity="Warning"
                 Message="{x:Bind ViewModel.InventoryNotificationMessage, Mode=OneWay}"
                 Margin="0,0,0,16"/>

        <!-- Part Selection Form -->
        <ScrollViewer Grid.Row="2">
            <StackPanel Spacing="24">
                
                <!-- Part Dropdown -->
                <StackPanel Spacing="12">
                    <TextBlock Text="Select Part" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <ComboBox x:Name="PartNumberComboBox"
                              ItemsSource="{x:Bind ViewModel.AvailableParts, Mode=OneWay}"
                              SelectedItem="{x:Bind ViewModel.SelectedPart, Mode=TwoWay}"
                              DisplayMemberPath="PartId"
                              PlaceholderText="{x:Bind ViewModel.GetPlaceholder('Field.PartSelection'), Mode=OneWay}"
                              HorizontalAlignment="Stretch"
                              MinWidth="300"/>
                </StackPanel>

                <!-- Part Details Card -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20"
                        Visibility="{x:Bind ViewModel.IsPartSelected, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Grid RowSpacing="12">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <TextBlock Grid.Row="0" 
                                   Text="Part Details" 
                                   Style="{StaticResource SubtitleTextBlockStyle}"/>

                        <!-- Details Grid -->
                        <Grid Grid.Row="1" ColumnSpacing="24" RowSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Part ID -->
                            <TextBlock Grid.Row="0" Grid.Column="0" 
                                       Text="Part ID:" 
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" 
                                       Text="{x:Bind ViewModel.SelectedPart.PartId, Mode=OneWay}" 
                                       FontWeight="SemiBold"/>

                            <!-- Type -->
                            <TextBlock Grid.Row="1" Grid.Column="0" 
                                       Text="Type:" 
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Spacing="6">
                                <mi:MaterialIcon Kind="{x:Bind ViewModel.SelectedTypeIconKind, Mode=OneWay}" 
                                                 Width="16" Height="16"
                                                 Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                                <TextBlock Text="{x:Bind ViewModel.SelectedTypeName, Mode=OneWay}"/>
                            </StackPanel>
                        </Grid>

                        <!-- Inventory Method (if applicable) -->
                        <StackPanel Grid.Row="2" 
                                    Orientation="Horizontal" 
                                    Spacing="8"
                                    Visibility="{x:Bind ViewModel.IsInventoryNotificationVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <FontIcon Glyph="&#xE946;" 
                                      FontSize="16" 
                                      Foreground="{ThemeResource SystemFillColorCautionBrush}"/>
                            <TextBlock Text="Inventory Method:" 
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock Text="{x:Bind ViewModel.InventoryMethod, Mode=OneWay}" 
                                       FontWeight="SemiBold"
                                       Foreground="{ThemeResource SystemFillColorCautionBrush}"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Action Buttons -->
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <Button Command="{x:Bind ViewModel.QuickAddPartCommand}"
                            HorizontalAlignment="Left">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE710;" FontSize="16"/>
                            <TextBlock Text="Add New Part"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Command="{x:Bind ViewModel.LoadPartsCommand}"
                            HorizontalAlignment="Left"
                            ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.Refresh'), Mode=OneWay}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE72C;" FontSize="16"/>
                            <TextBlock Text="Refresh Parts"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_PartSelectionView.xaml.cs">
public sealed partial class View_Dunnage_PartSelectionView : UserControl
⋮----
private readonly IService_Focus _focusService;
⋮----
_focusService.AttachFocusOnVisibility(this, PartNumberComboBox);
⋮----
private async void OnLoaded(object sender, RoutedEventArgs e)
⋮----
System.Diagnostics.Debug.WriteLine("Dunnage_PartSelectionView: OnLoaded called");
await ViewModel.InitializeAsync();
</file>

<file path="Module_Dunnage/Views/View_Dunnage_QuantityEntryView.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_QuantityEntryView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mi="using:Material.Icons.WinUI3"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:views="using:MTM_Receiving_Application.Module_Dunnage.Views"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d"
    x:DataType="views:View_Dunnage_QuantityEntryView"
    Loaded="OnLoaded">

    <UserControl.Resources>
        <converters:Converter_EmptyStringToVisibility x:Key="EmptyStringToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid Padding="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,16">
            <TextBlock Text="Enter Quantity"
                       Style="{StaticResource TitleTextBlockStyle}"/>
            <TextBlock Text="Specify how many labels you need to generate."
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       Style="{StaticResource BodyTextBlockStyle}"/>
        </StackPanel>

        <!-- Context Banner -->
        <Border Grid.Row="1"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="12"
                Margin="0,0,0,12">
            <StackPanel Spacing="6">
                <TextBlock Text="Selection Summary"
                           FontWeight="SemiBold"
                           FontSize="13"/>
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Type:" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12"/>
                    <mi:MaterialIcon Kind="{x:Bind ViewModel.SelectedTypeIconKind, Mode=OneWay}" 
                                     Width="16" Height="16"
                                     Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    <TextBlock Text="{x:Bind ViewModel.SelectedTypeName, Mode=OneWay}"
                               FontWeight="SemiBold"
                               FontSize="12"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Part:" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12"/>
                    <TextBlock Text="{x:Bind ViewModel.SelectedPartName, Mode=OneWay}"
                               FontWeight="SemiBold"
                               FontSize="12"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Quantity Input -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <StackPanel Spacing="12">
                <!-- Quantity Card -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="16">
                    <StackPanel Spacing="6">
                        <TextBlock Text="Quantity"
                                   Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <NumberBox x:Name="QuantityNumberBox"
                                   Value="{x:Bind ViewModel.Quantity, Mode=TwoWay}"
                                   Minimum="1"
                                   Maximum="9999"
                                   SpinButtonPlacementMode="Inline"
                                   HorizontalAlignment="Stretch"
                                   PlaceholderText="{x:Bind ViewModel.GetPlaceholder('Field.Quantity'), Mode=OneWay}"/>
                        
                        <!-- Validation Message -->
                        <TextBlock Text="{x:Bind ViewModel.ValidationMessage, Mode=OneWay}"
                                   Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                   Visibility="{x:Bind ViewModel.ValidationMessage, Mode=OneWay, Converter={StaticResource EmptyStringToVisibilityConverter}}"
                                   TextWrapping="Wrap"
                                   FontSize="12"/>
                    </StackPanel>
                </Border>

                <!-- Info Panel Card -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="16">
                    <StackPanel Spacing="6">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE946;" 
                                      FontSize="16" 
                                      Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                            <TextBlock Text="Tip" FontWeight="SemiBold"/>
                        </StackPanel>
                        <TextBlock Text="{x:Bind ViewModel.GetTip('Dunnage.QuantityEntry'), Mode=OneWay}"
                                   TextWrapping="Wrap"
                                   FontSize="12"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_QuantityEntryView.xaml.cs">
public sealed partial class View_Dunnage_QuantityEntryView : UserControl
⋮----
private readonly IService_Focus _focusService;
⋮----
_focusService.AttachFocusOnVisibility(this, QuantityNumberBox);
⋮----
private void OnLoaded(object sender, RoutedEventArgs e)
⋮----
ViewModel.LoadContextData();
</file>

<file path="Module_Dunnage/Views/View_Dunnage_QuickAddPartDialog.xaml">
<?xml version="1.0" encoding="utf-8"?>
<ContentDialog
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_QuickAddPartDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Add New Dunnage Part"
    PrimaryButtonText="Add Part"
    CloseButtonText="Cancel"
    DefaultButton="Primary"
    PrimaryButtonClick="OnPrimaryButtonClick"
    PrimaryButtonStyle="{StaticResource AccentButtonStyle}"
    Width="500">

    <ScrollViewer MaxHeight="500">
        <StackPanel Spacing="20" Padding="8">
            <!-- Instructions -->
            <TextBlock 
                Text="Enter details for the new dunnage part"
                TextWrapping="Wrap"
                Style="{StaticResource BodyTextBlockStyle}"/>

            <!-- Type Display (Read-only) -->
            <Border Background="{ThemeResource LayerFillColorDefaultBrush}"
                    Padding="12"
                    CornerRadius="4">
                <StackPanel Spacing="4">
                    <TextBlock Text="Dunnage Type" 
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    <TextBlock x:Name="TypeNameTextBlock"
                               FontWeight="SemiBold"/>
                </StackPanel>
            </Border>

            <!-- Part ID Field -->
            <StackPanel Spacing="8">
                <TextBlock Text="Part ID (Auto-generated)" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                <TextBox 
                    x:Name="PartIdTextBox"
                    IsReadOnly="True"
                    PlaceholderText="Auto-generated based on dimensions"
                    MaxLength="100"/>
                <TextBlock 
                    Text="Part ID is generated from Type and Dimensions"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Style="{StaticResource CaptionTextBlockStyle}"/>
            </StackPanel>

            <!-- Specifications Section -->
            <StackPanel Spacing="12">
                <TextBlock Text="Specifications" 
                           Style="{StaticResource BodyStrongTextBlockStyle}"/>
                <TextBlock 
                    Text="Enter dimensions to generate the Part ID"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Style="{StaticResource CaptionTextBlockStyle}"/>

                <Grid ColumnSpacing="12" RowSpacing="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Width -->
                    <StackPanel Grid.Column="0" Spacing="4">
                        <TextBlock Text="Width (in)" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                        <NumberBox x:Name="WidthNumberBox" 
                                   PlaceholderText="0"
                                   SpinButtonPlacementMode="Hidden"
                                   Minimum="0"
                                   Maximum="999"
                                   SmallChange="1"
                                   LargeChange="10"
                                   ValueChanged="OnDimensionChanged"/>
                    </StackPanel>

                    <!-- Height -->
                    <StackPanel Grid.Column="1" Spacing="4">
                        <TextBlock Text="Height (in)" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                        <NumberBox x:Name="HeightNumberBox" 
                                   PlaceholderText="0"
                                   SpinButtonPlacementMode="Hidden"
                                   Minimum="0"
                                   Maximum="999"
                                   SmallChange="1"
                                   LargeChange="10"
                                   ValueChanged="OnDimensionChanged"/>
                    </StackPanel>

                    <!-- Depth -->
                    <StackPanel Grid.Column="2" Spacing="4">
                        <TextBlock Text="Depth (in)" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                        <NumberBox x:Name="DepthNumberBox" 
                                   PlaceholderText="0"
                                   SpinButtonPlacementMode="Hidden"
                                   Minimum="0"
                                   Maximum="999"
                                   SmallChange="1"
                                   LargeChange="10"
                                   ValueChanged="OnDimensionChanged"/>
                    </StackPanel>
                </Grid>
            </StackPanel>

            <!-- Dynamic Specs Container -->
            <StackPanel x:Name="DynamicSpecsPanel" Spacing="12"/>

            <!-- Additional Notes -->
            <StackPanel Spacing="8">
                <TextBlock Text="Additional Notes (Optional)" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                <TextBox 
                    x:Name="NotesTextBox"
                    PlaceholderText="Any additional specifications or notes"
                    TextWrapping="Wrap"
                    AcceptsReturn="True"
                    MaxLength="500"
                    Height="80"/>
            </StackPanel>

        </StackPanel>
    </ScrollViewer>
</ContentDialog>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_QuickAddTypeDialog.xaml">
<?xml version="1.0" encoding="utf-8"?>
<ContentDialog
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_QuickAddTypeDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:materialIcons="using:Material.Icons.WinUI3"
    xmlns:local="using:MTM_Receiving_Application.Module_Dunnage.Views"
    xmlns:models="using:MTM_Receiving_Application.Module_Dunnage.Models"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    Title="Add New Dunnage Type"
    PrimaryButtonText="Add Type"
    CloseButtonText="Cancel"
    DefaultButton="Primary"
    PrimaryButtonClick="OnPrimaryButtonClick"
    PrimaryButtonStyle="{StaticResource AccentButtonStyle}"
    Width="900">

    <ContentDialog.Resources>
        <converters:Converter_IconCodeToGlyph x:Key="IconCodeToGlyphConverter"/>
        <!-- Help Button Style -->
        <Style x:Key="HelpButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="CornerRadius" Value="4"/>
        </Style>
    </ContentDialog.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="600">
        <StackPanel Spacing="24" Padding="12">
            <!-- Header with Help Button -->
            <Grid>
                <TextBlock 
                    Text="Enter details for the new dunnage type"
                    TextWrapping="Wrap"
                    VerticalAlignment="Center"
                    Style="{StaticResource BodyTextBlockStyle}"/>
                
                <Button x:Name="HelpButton"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Style="{StaticResource HelpButtonStyle}"
                        ToolTipService.ToolTip="Click for help about dunnage types">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <FontIcon Glyph="&#xE946;" FontSize="14" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                        <TextBlock Text="Help" FontSize="12" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                    </StackPanel>
                    <Button.Flyout>
                        <Flyout>
                            <StackPanel Spacing="16" MaxWidth="400" Padding="4">
                                <StackPanel Spacing="8">
                                    <TextBlock Text="Dunnage Types" Style="{StaticResource SubtitleTextBlockStyle}" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                    <Border Height="2" Background="{ThemeResource AccentFillColorDefaultBrush}" CornerRadius="1" HorizontalAlignment="Left" Width="60"/>
                                    <TextBlock TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}">Define categories of dunnage materials for receiving classification.</TextBlock>
                                </StackPanel>
                                
                                <Border Background="{ThemeResource LayerFillColorDefaultBrush}" Padding="12" CornerRadius="6" BorderThickness="1" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
                                    <StackPanel Spacing="8">
                                        <TextBlock Text="Type Name" FontWeight="SemiBold" FontSize="13"/>
                                        <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">Choose a descriptive name like 'Pallet', 'Crate', or 'Foam Insert'. This will be displayed in selection lists.</TextBlock>
                                    </StackPanel>
                                </Border>
                                
                                <Border Background="{ThemeResource LayerFillColorDefaultBrush}" Padding="12" CornerRadius="6" BorderThickness="1" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
                                    <StackPanel Spacing="8">
                                        <TextBlock Text="Specifications" FontWeight="SemiBold" FontSize="13"/>
                                        <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">Add custom fields to capture specific data for this type. For example, 'Material' (Text), 'Weight Capacity' (Number with unit 'lbs'), or 'Recyclable' (Boolean).</TextBlock>
                                    </StackPanel>
                                </Border>
                                
                                <Border Background="{ThemeResource SystemFillColorAttentionBackgroundBrush}" Padding="12" CornerRadius="6" BorderThickness="1" BorderBrush="{ThemeResource SystemFillColorAttentionBrush}">
                                    <StackPanel Spacing="6">
                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                            <FontIcon Glyph="&#xE946;" FontSize="12" Foreground="{ThemeResource SystemFillColorAttentionBrush}"/>
                                            <TextBlock Text="Tip" FontWeight="SemiBold" FontSize="12" Foreground="{ThemeResource SystemFillColorAttentionBrush}"/>
                                        </StackPanel>
                                        <TextBlock TextWrapping="Wrap" FontSize="11">Required specs must be filled when creating new parts. Use Number type for measurements and validation.</TextBlock>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Flyout>
                    </Button.Flyout>
                </Button>
            </Grid>

            <!-- Type Name Field -->
            <StackPanel Spacing="12">
                <TextBlock Text="Type Name" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                <TextBox 
                    x:Name="TypeNameTextBox"
                    PlaceholderText="e.g., Pallet, Crate, Blocking"
                    MaxLength="100"
                    TextChanged="OnTypeNameChanged"
                    ToolTipService.ToolTip="Enter a unique descriptive name for this dunnage type"/>
                <TextBlock 
                    x:Name="ValidationTextBlock"
                    Text="Type name is required"
                    Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                    Visibility="Collapsed"
                    Style="{StaticResource CaptionTextBlockStyle}"/>
            </StackPanel>

            <!-- Icon Selection -->
            <StackPanel Spacing="12">
                <TextBlock Text="Select Icon" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                <TextBlock 
                    Text="Choose an icon to represent this type"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Style="{StaticResource CaptionTextBlockStyle}"/>
                
                <Button x:Name="SelectIconButton"
                        Click="OnSelectIconClick"
                        HorizontalAlignment="Stretch"
                        Padding="16,12"
                        ToolTipService.ToolTip="Click to browse and select an icon from the icon library">
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <materialIcons:MaterialIcon x:Name="SelectedIconDisplay" 
                                  Kind="{x:Bind SelectedIconKind, Mode=OneWay}" 
                                  Width="24" Height="24"
                                  Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Click to select icon" FontWeight="SemiBold"/>
                            <TextBlock x:Name="SelectedIconNameText"
                                       Text="Box"
                                       FontSize="12"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </StackPanel>
                </Button>
            </StackPanel>

            <!-- Specifications -->
            <StackPanel Spacing="12">
                <StackPanel Spacing="4">
                    <TextBlock Text="Specifications" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <TextBlock 
                        Text="Define custom fields to capture specific data for this dunnage type"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Style="{StaticResource CaptionTextBlockStyle}"/>
                </StackPanel>
            
                <!-- Add Spec Form -->
                <Border Background="{ThemeResource LayerFillColorDefaultBrush}" 
                        CornerRadius="6" 
                        Padding="16"
                        BorderThickness="1"
                        BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">
                    <StackPanel Spacing="12">
                        <Grid ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="NewSpecNameBox" 
                                     PlaceholderText="Field Name (e.g. Material, Weight)"
                                     ToolTipService.ToolTip="Enter a unique name for this specification field"/>
                            <ComboBox x:Name="NewSpecTypeCombo" 
                                      Grid.Column="1"
                                      SelectedIndex="0" 
                                      HorizontalAlignment="Stretch"
                                      ToolTipService.ToolTip="Select the data type for this field">
                                <ComboBoxItem Content="Text"/>
                                <ComboBoxItem Content="Number"/>
                                <ComboBoxItem Content="Boolean"/>
                            </ComboBox>
                        </Grid>
                        
                        <!-- Number Type Options -->
                        <StackPanel x:Name="NumberOptionsPanel" Spacing="8" Visibility="Collapsed">
                            <TextBlock Text="Number Validation" FontSize="12" FontWeight="SemiBold" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <Grid ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <NumberBox x:Name="NewSpecMinValueBox" 
                                           Header="Min Value" 
                                           PlaceholderText="Optional"
                                           SpinButtonPlacementMode="Compact"
                                           ToolTipService.ToolTip="Minimum allowed value (optional)"/>
                                <NumberBox x:Name="NewSpecMaxValueBox" 
                                           Grid.Column="1"
                                           Header="Max Value" 
                                           PlaceholderText="Optional"
                                           SpinButtonPlacementMode="Compact"
                                           ToolTipService.ToolTip="Maximum allowed value (optional)"/>
                                <TextBox x:Name="NewSpecUnitBox" 
                                         Grid.Column="2"
                                         Header="Unit" 
                                         PlaceholderText="e.g. inches, lbs"
                                         ToolTipService.ToolTip="Unit of measurement (optional)"/>
                            </Grid>
                        </StackPanel>
                        
                        <Grid ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
                                <CheckBox x:Name="NewSpecRequiredCheck" 
                                          Content="Required Field"
                                          ToolTipService.ToolTip="Check if this field is required"/>
                            </StackPanel>
                            <Button Grid.Column="1" 
                                    Content="Add Field" 
                                    Click="OnAddSpecClick" 
                                    Style="{StaticResource AccentButtonStyle}"
                                    ToolTipService.ToolTip="Add this specification to the list below"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <ListView x:Name="SpecsListView" 
                          Height="130"
                          BorderThickness="1"
                          BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
                          CornerRadius="6"
                          Padding="4"
                          ToolTipService.ToolTip="List of specifications defined for this type">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:Model_SpecItem">
                        <Grid Padding="0,4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Spacing="2">
                                <TextBlock Text="{x:Bind Name}" FontWeight="SemiBold" FontSize="13"/>
                                <TextBlock Text="{x:Bind Description}" 
                                           FontSize="11" 
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            </StackPanel>
                            <Border Grid.Column="1" 
                                    Background="{ThemeResource SystemFillColorAttentionBackgroundBrush}"
                                    CornerRadius="3"
                                    Padding="6,2"
                                    Margin="8,0"
                                    Visibility="{x:Bind IsRequiredVisibility}">
                                <TextBlock Text="Required" FontSize="10" FontWeight="SemiBold"/>
                            </Border>
                            <Button Grid.Column="2" 
                                    Content="&#xE74D;"
                                    FontFamily="Segoe MDL2 Assets"
                                    ToolTipService.ToolTip="Remove this specification"
                                    Click="OnRemoveSpecClick" 
                                    Style="{StaticResource SubtleButtonStyle}"/>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</ContentDialog>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_QuickAddTypeDialog.xaml.cs">
public sealed partial class View_Dunnage_QuickAddTypeDialog : ContentDialog, INotifyPropertyChanged
⋮----
private MaterialIconKind _selectedIcon = MaterialIconKind.PackageVariantClosed; // Default box icon
private string _selectedIconName = "Box"; // Default icon name
⋮----
private void OnSpecTypeChanged(object sender, SelectionChangedEventArgs e)
⋮----
var type = item.Content.ToString();
⋮----
public void InitializeForEdit(string typeName, string iconName, Dictionary<string, SpecDefinition> specs)
⋮----
// Try parse icon name, fallback to default
⋮----
SelectedIconNameText.Text = kind.ToString();
⋮----
Specs.Clear();
⋮----
Specs.Add(new Model_SpecItem
⋮----
private void OnAddSpecClick(object sender, RoutedEventArgs e)
⋮----
private void AddSpec()
⋮----
var name = NewSpecNameBox.Text.Trim();
if (string.IsNullOrWhiteSpace(name))
⋮----
if (Specs.Any(s => s.Name.Equals(name, System.StringComparison.OrdinalIgnoreCase)))
⋮----
var type = typeItem?.Content.ToString() ?? "Text";
⋮----
unit = NewSpecUnitBox.Text.Trim();
if (!double.IsNaN(NewSpecMinValueBox.Value))
⋮----
if (!double.IsNaN(NewSpecMaxValueBox.Value))
⋮----
// Clear form
⋮----
private void OnRemoveSpecClick(object sender, RoutedEventArgs e)
⋮----
Specs.Remove(spec);
⋮----
private async void OnSelectIconClick(object sender, RoutedEventArgs e)
⋮----
// Show window and wait for it to close
var hwnd = WinRT.Interop.WindowNative.GetWindowHandle(iconWindow);
var windowId = Microsoft.UI.Win32Interop.GetWindowIdFromWindow(hwnd);
var appWindow = Microsoft.UI.Windowing.AppWindow.GetFromWindowId(windowId);
⋮----
iconWindow.Activate();
⋮----
// Wait for window to close (polling approach)
⋮----
iconWindow.Closed += (s, args) => tcs.SetResult(true);
⋮----
// Check if icon was selected
⋮----
private void OnTypeNameChanged(object sender, TextChangedEventArgs e)
⋮----
ValidationTextBlock.Visibility = Visibility.Collapsed; // Hide error while typing
⋮----
private void OnPrimaryButtonClick(ContentDialog sender, ContentDialogButtonClickEventArgs args)
⋮----
var input = TypeNameTextBox.Text.Trim();
⋮----
// 1. Required check
if (string.IsNullOrWhiteSpace(input))
⋮----
// 2. Start with Capital Letter check
if (!char.IsUpper(input[0]))
⋮----
// 3. No spaces check
if (input.Contains(" "))
⋮----
// 4. No special characters check (Alphanumeric only)
if (!AlphanumericRegex().IsMatch(input))
⋮----
// Set properties for caller to retrieve
⋮----
private static partial System.Text.RegularExpressions.Regex AlphanumericRegex();
⋮----
private void ShowError(string message)
⋮----
private void OnPropertyChanged([CallerMemberName] string? propertyName = null)
⋮----
PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
</file>

<file path="Module_Dunnage/Views/View_Dunnage_ReviewView.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_ReviewView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mi="using:Material.Icons.WinUI3"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:views="using:MTM_Receiving_Application.Module_Dunnage.Views"
    xmlns:models="using:MTM_Receiving_Application.Module_Dunnage.Models"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d"
    x:DataType="views:View_Dunnage_ReviewView"
    Loaded="OnLoaded">

    <UserControl.Resources>
        <converters:Converter_BooleanToVisibility x:Key="BooleanToVisibilityConverter"/>
        <converters:Converter_EmptyStringToVisibility x:Key="EmptyStringToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Success Message -->
        <InfoBar Grid.Row="0"
                 IsOpen="{x:Bind ViewModel.IsSuccessMessageVisible, Mode=OneWay}"
                 Severity="Success"
                 Message="{x:Bind ViewModel.SuccessMessage, Mode=OneWay}"
                 IsClosable="False">
            <InfoBar.ActionButton>
                <Button Content="Start New Entry" Command="{x:Bind ViewModel.StartNewEntryCommand}"/>
            </InfoBar.ActionButton>
        </InfoBar>

        <!-- Content Section with View Toggle -->
        <Grid Grid.Row="1">
            <!-- Single Entry View -->
            <Grid Visibility="{x:Bind ViewModel.IsSingleView, Mode=OneWay}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Entry Counter -->
                <Border Grid.Row="0" 
                       Background="{ThemeResource AccentFillColorDefaultBrush}"
                       Padding="12,6"
                       CornerRadius="8,8,0,0">
                    <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                        <FontIcon Glyph="&#xE8FD;" 
                                 FontSize="16" 
                                 Foreground="White"/>
                        <TextBlock Style="{StaticResource SubtitleTextBlockStyle}"
                                   Foreground="White">
                            <Run Text="Entry"/>
                            <Run Text="{x:Bind ViewModel.CurrentEntryIndex, Mode=OneWay}"/>
                            <Run Text="of"/>
                            <Run Text="{x:Bind ViewModel.LoadCount, Mode=OneWay}"/>
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Single Entry Form -->
                <Grid Grid.Row="1">
                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                           BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                           BorderThickness="1,0,1,1"
                           CornerRadius="0,0,8,8"
                           Padding="20">
                        <Grid MaxWidth="900">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Left Column -->
                            <StackPanel Grid.Column="0" Spacing="12" Margin="0,0,12,0">
                                <TextBlock Text="Load Details" 
                                          Style="{StaticResource SubtitleTextBlockStyle}"
                                          Margin="0,0,0,8"/>

                                <StackPanel Spacing="4">
                                    <TextBlock Text="Type" 
                                              Style="{StaticResource CaptionTextBlockStyle}"
                                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <mi:MaterialIcon Kind="{x:Bind ViewModel.CurrentLoad.TypeIconKind, Mode=OneWay}" 
                                                         Width="18" Height="18"
                                                         Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                                        <TextBlock Text="{x:Bind ViewModel.CurrentLoad.TypeName, Mode=OneWay}" 
                                                  Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                    </StackPanel>
                                </StackPanel>

                                <StackPanel Spacing="4">
                                    <TextBlock Text="Part ID" 
                                              Style="{StaticResource CaptionTextBlockStyle}"
                                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Text="{x:Bind ViewModel.CurrentLoad.PartId, Mode=OneWay}" 
                                              Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>

                                <StackPanel Spacing="4">
                                    <TextBlock Text="Quantity" 
                                              Style="{StaticResource CaptionTextBlockStyle}"
                                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Text="{x:Bind ViewModel.CurrentLoad.Quantity, Mode=OneWay}" 
                                              Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Right Column -->
                            <StackPanel Grid.Column="1" Spacing="12" Margin="12,0,0,0">
                                <TextBlock Text="Additional Information" 
                                          Style="{StaticResource SubtitleTextBlockStyle}"
                                          Margin="0,0,0,8"/>

                                <StackPanel Spacing="4">
                                    <TextBlock Text="PO Number" 
                                              Style="{StaticResource CaptionTextBlockStyle}"
                                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Text="{x:Bind ViewModel.CurrentLoad.PoNumber, Mode=OneWay}" 
                                              Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>

                                <StackPanel Spacing="4">
                                    <TextBlock Text="Location" 
                                              Style="{StaticResource CaptionTextBlockStyle}"
                                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Text="{x:Bind ViewModel.CurrentLoad.Location, Mode=OneWay}" 
                                              Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>

                                <StackPanel Spacing="4">
                                    <TextBlock Text="Inventory Method" 
                                              Style="{StaticResource CaptionTextBlockStyle}"
                                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Text="{x:Bind ViewModel.CurrentLoad.InventoryMethod, Mode=OneWay}" 
                                              Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>

                <!-- Navigation Bar for Single View -->
                <CommandBar Grid.Row="2" DefaultLabelPosition="Right" Margin="0,12,0,0">
                    <AppBarButton Icon="Back" 
                                 Label="Previous" 
                                 Command="{x:Bind ViewModel.PreviousEntryCommand}"
                                 IsEnabled="{x:Bind ViewModel.CanGoBack, Mode=OneWay}"
                                 AutomationProperties.Name="Previous Entry"/>
                    
                    <AppBarButton Icon="Forward" 
                                 Label="Next" 
                                 Command="{x:Bind ViewModel.NextEntryCommand}"
                                 IsEnabled="{x:Bind ViewModel.CanGoNext, Mode=OneWay}"
                                 AutomationProperties.Name="Next Entry"/>
                    
                    <AppBarSeparator/>
                    
                    <AppBarButton Icon="ViewAll" 
                                 Label="Table View" 
                                 Command="{x:Bind ViewModel.SwitchToTableViewCommand}"
                                 AutomationProperties.Name="Switch to Table View"/>
                </CommandBar>
            </Grid>

            <!-- Table View (DataGrid) -->
            <Grid Visibility="{x:Bind ViewModel.IsTableView, Mode=OneWay}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0"
                       Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                       BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                       BorderThickness="1"
                       CornerRadius="8"
                       Padding="16">
                    <controls:DataGrid x:Name="ReviewDataGrid"
                                      ItemsSource="{x:Bind ViewModel.SessionLoads, Mode=OneWay}"
                                      AutoGenerateColumns="False"
                                      CanUserReorderColumns="False"
                                      CanUserResizeColumns="True"
                                      CanUserSortColumns="True"
                                      GridLinesVisibility="None"
                                      HeadersVisibility="Column"
                                      SelectionMode="Single"
                                      IsReadOnly="True">
                        <controls:DataGrid.Columns>
                            <controls:DataGridTextColumn Header="Type" 
                                                        Binding="{Binding TypeName}" 
                                                        Width="120"/>
                            <controls:DataGridTextColumn Header="Part ID" 
                                                        Binding="{Binding PartId}" 
                                                        Width="150"/>
                            <controls:DataGridTextColumn Header="Quantity" 
                                                        Binding="{Binding Quantity}" 
                                                        Width="100"/>
                            <controls:DataGridTextColumn Header="PO Number" 
                                                        Binding="{Binding PoNumber}" 
                                                        Width="150"/>
                            <controls:DataGridTextColumn Header="Location" 
                                                        Binding="{Binding Location}" 
                                                        Width="150"/>
                            <controls:DataGridTextColumn Header="Inventory Method" 
                                                        Binding="{Binding InventoryMethod}" 
                                                        Width="*"/>
                        </controls:DataGrid.Columns>
                    </controls:DataGrid>
                </Border>

                <!-- Navigation Bar for Table View -->
                <CommandBar Grid.Row="1" DefaultLabelPosition="Right" Margin="0,16,0,0">
                    <AppBarButton Label="Single View" 
                                 Command="{x:Bind ViewModel.SwitchToSingleViewCommand}"
                                 AutomationProperties.Name="Switch to Single View">
                        <AppBarButton.Icon>
                            <FontIcon Glyph="&#xE8FD;"/>
                        </AppBarButton.Icon>
                    </AppBarButton>
                </CommandBar>
            </Grid>
        </Grid>

        <!-- Action Buttons -->
        <Grid Grid.Row="2" ColumnSpacing="12" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="1" 
                   Command="{x:Bind ViewModel.AddAnotherCommand}"
                   AutomationProperties.Name="Add Another Load"
                   ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.AddAnother'), Mode=OneWay}">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE710;" FontSize="16"/>
                    <TextBlock Text="Add Another"/>
                </StackPanel>
            </Button>
            
            <Button Grid.Column="2" 
                   Command="{x:Bind ViewModel.SaveAllCommand}"
                   Style="{StaticResource AccentButtonStyle}"
                   IsEnabled="{x:Bind ViewModel.CanSave, Mode=OneWay}"
                   AutomationProperties.Name="Save to Database">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE74E;" FontSize="16"/>
                    <TextBlock Text="Save All"/>
                </StackPanel>
            </Button>
        </Grid>
    </Grid>
</UserControl>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_ReviewView.xaml.cs">
public sealed partial class View_Dunnage_ReviewView : UserControl
⋮----
private readonly IService_Focus _focusService;
⋮----
_focusService.AttachFocusOnVisibility(this);
⋮----
private void OnLoaded(object sender, RoutedEventArgs e)
⋮----
ViewModel.LoadSessionLoads();
</file>

<file path="Module_Receiving/Contracts/IService_MySQL_PackagePreferences.cs">
/// <summary>
/// Service for managing package type preferences in MySQL database.
/// </summary>
public interface IService_MySQL_PackagePreferences
⋮----
/// Retrieves the saved package type preference for a part ID.
⋮----
/// <param name="partID">Part identifier</param>
/// <returns>PackageTypePreference if found, null otherwise</returns>
/// <exception cref="ArgumentException">If partID is null or empty</exception>
public Task<Model_PackageTypePreference?> GetPreferenceAsync(string partID);
⋮----
/// Saves or updates the package type preference for a part ID.
/// Uses UPSERT logic (INSERT or UPDATE based on existence).
⋮----
/// <param name="preference">Preference to save</param>
/// <exception cref="ArgumentNullException">If preference is null</exception>
/// <exception cref="ArgumentException">If preference.PartID is null or empty</exception>
/// <exception cref="InvalidOperationException">If database operation fails</exception>
public Task SavePreferenceAsync(Model_PackageTypePreference preference);
⋮----
/// Deletes a package type preference for a part ID.
⋮----
/// <returns>True if deleted, false if not found</returns>
public Task<bool> DeletePreferenceAsync(string partID);
</file>

<file path="Module_Receiving/Contracts/IService_MySQL_Receiving.cs">
/// <summary>
/// Service for saving receiving load data to MySQL database.
/// </summary>
public interface IService_MySQL_Receiving
⋮----
/// Saves a batch of receiving loads to the database within a transaction.
/// All loads succeed or all fail (atomic operation).
⋮----
/// <param name="loads">List of receiving loads to save</param>
/// <returns>Number of loads successfully inserted</returns>
/// <exception cref="ArgumentException">If loads list is null or empty</exception>
/// <exception cref="InvalidOperationException">If database operation fails</exception>
public Task<int> SaveReceivingLoadsAsync(List<Model_ReceivingLoad> loads);
⋮----
/// Retrieves receiving history for a specific part (for reference/audit).
⋮----
/// <param name="partID">Part identifier</param>
/// <param name="startDate">Start date for history</param>
/// <param name="endDate">End date for history</param>
/// <returns>List of historical receiving loads</returns>
public Task<List<Model_ReceivingLoad>> GetReceivingHistoryAsync(string partID, DateTime startDate, DateTime endDate);
⋮----
/// Retrieves all receiving loads within a date range.
⋮----
/// <param name="startDate">Start date for retrieval</param>
/// <param name="endDate">End date for retrieval</param>
/// <returns>DAO result containing list of receiving loads</returns>
public Task<Model_Dao_Result<List<Model_ReceivingLoad>>> GetAllReceivingLoadsAsync(DateTime startDate, DateTime endDate);
⋮----
/// Updates a batch of receiving loads in the database.
⋮----
/// <param name="loads">List of loads to update</param>
/// <returns>Number of loads successfully updated</returns>
public Task<int> UpdateReceivingLoadsAsync(List<Model_ReceivingLoad> loads);
⋮----
/// Deletes a batch of receiving loads from the database.
⋮----
/// <param name="loads">List of loads to delete</param>
/// <returns>Number of loads successfully deleted</returns>
public Task<int> DeleteReceivingLoadsAsync(List<Model_ReceivingLoad> loads);
⋮----
/// Validates that the MySQL database connection is available.
⋮----
/// <returns>True if connection successful, false otherwise</returns>
public Task<bool> TestConnectionAsync();
</file>

<file path="Module_Receiving/Contracts/IService_MySQL_ReceivingLine.cs">
public interface IService_MySQL_ReceivingLine
⋮----
/// <summary>Insert a new receiving line</summary>
/// <param name="line"></param>
public Task<Model_Dao_Result> InsertReceivingLineAsync(Model_ReceivingLine line);
⋮----
// Add other methods if needed by ReceivingLabelViewModel
</file>

<file path="Module_Receiving/Models/Model_Application_Variables.cs">
/// <summary>
/// Application-wide configuration and constants
/// </summary>
public class Model_Application_Variables
⋮----
/// Display name of the application
⋮----
/// Semantic version of the application (MAJOR.MINOR.PATCH)
⋮----
/// MySQL connection string (configured from Helper_Database_Variables)
⋮----
/// Directory path for application log files
⋮----
public string LogDirectory { get; set; } = Path.Combine(
Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
⋮----
/// Current environment (Development, Test, Production)
</file>

<file path="Module_Receiving/Models/Model_CSVDeleteResult.cs">
/// <summary>
/// Result of CSV delete operation.
/// </summary>
public class Model_CSVDeleteResult
</file>

<file path="Module_Receiving/Models/Model_CSVExistenceResult.cs">
/// <summary>
/// Result of CSV existence check.
/// </summary>
public class Model_CSVExistenceResult
</file>

<file path="Module_Receiving/Models/Model_CSVWriteResult.cs">
/// <summary>
/// Result of CSV write operation.
/// </summary>
public class Model_CSVWriteResult
⋮----
// Combined properties from both definitions
</file>

<file path="Module_Receiving/Models/Model_InforVisualPart.cs">
/// <summary>
/// Represents a part/line item on a purchase order from Infor Visual.
/// Read-only data from external system.
/// </summary>
public class Model_InforVisualPart
⋮----
/// Remaining quantity available to receive (Ordered - Received).
/// Whole number only (no decimals).
⋮----
/// Display text for UI showing part ID, description, and line number.
</file>

<file path="Module_Receiving/Models/Model_InforVisualPO.cs">
/// <summary>
/// Represents a purchase order retrieved from Infor Visual (SQL Server).
/// Read-only data from external system.
/// </summary>
public class Model_InforVisualPO
⋮----
/// Indicates whether this PO has any parts associated with it.
⋮----
/// Returns a user-friendly status description.
⋮----
/// Indicates if the PO is closed or cancelled.
</file>

<file path="Module_Receiving/Models/Model_PackageTypePreference.cs">
/// <summary>
/// Stores user's preferred package type for specific part IDs.
/// Persisted to MySQL database for use across sessions.
/// </summary>
public class Model_PackageTypePreference
</file>

<file path="Module_Receiving/Models/Model_ReceivingLoad.cs">
/// <summary>
/// Represents one load/skid of received material with all associated details.
/// Implements ObservableObject for data binding in WinUI 3.
/// </summary>
public partial class Model_ReceivingLoad : ObservableObject
⋮----
private Guid _loadID = Guid.NewGuid();
⋮----
private string? _poNumber;  // Nullable for non-PO items
⋮----
private string _heatLotNumber = string.Empty;  // Default to empty, set to "Nothing Entered" on save if blank
⋮----
private int _packagesPerLoad = 0;  // Default to 0 (blank)
⋮----
private Enum_PackageType _packageType = Enum_PackageType.Skid;
⋮----
private DateTime _receivedDate = DateTime.Now;
⋮----
partial void OnPartIDChanged(string value)
⋮----
if (string.IsNullOrWhiteSpace(value))
⋮----
// If PackagesPerLoad is 0 (default/blank), set it to 1 when PartID is entered
⋮----
var upperValue = value.ToUpperInvariant();
if (upperValue.Contains("MMC"))
⋮----
else if (upperValue.Contains("MMF"))
⋮----
System.Diagnostics.Debug.WriteLine($"[Model_ReceivingLoad] OnPartIDChanged error: {ex.Message}");
⋮----
partial void OnPackageTypeChanged(Enum_PackageType value)
⋮----
PackageTypeName = value.ToString();
⋮----
partial void OnPackageTypeNameChanged(string value)
⋮----
/// Calculates and updates WeightPerPackage when quantity or package count changes.
⋮----
partial void OnWeightQuantityChanged(decimal value)
⋮----
/// Calculates and updates WeightPerPackage when package count changes.
⋮----
partial void OnPackagesPerLoadChanged(int value)
⋮----
/// Calculates weight per package: WeightQuantity ÷ PackagesPerLoad.
⋮----
private void CalculateWeightPerPackage()
⋮----
// Round to whole number as requested
WeightPerPackage = Math.Round(WeightQuantity / PackagesPerLoad, 0);
⋮----
/// Display property for review grid showing weight per package with unit.
⋮----
/// Display property for PO number handling null values.
⋮----
string.IsNullOrEmpty(PoNumber) ? "N/A" : PoNumber;
</file>

<file path="Module_Receiving/Models/Model_ReceivingSession.cs">
/// <summary>
/// Represents the current data entry session with accumulated loads from potentially multiple parts.
/// Persisted to JSON for session restoration across application restarts.
/// </summary>
public class Model_ReceivingSession
⋮----
public Guid SessionID { get; set; } = Guid.NewGuid();
⋮----
// Transient properties (not persisted to JSON)
⋮----
/// Total number of loads across all parts in this session.
⋮----
/// Sum of all load weights/quantities in this session.
⋮----
/// List of unique part IDs in this session.
⋮----
Loads?.Select(l => l.PartID).Distinct().ToList() ?? new List<string>();
⋮----
/// Indicates whether this session has any loads.
</file>

<file path="Module_Receiving/Models/Model_ReceivingValidationResult.cs">
/// <summary>
/// Result of a receiving validation operation.
/// </summary>
public class Model_ReceivingValidationResult
⋮----
public static Model_ReceivingValidationResult Success() => new() { IsValid = true };
public static Model_ReceivingValidationResult Error(string message) => new()
⋮----
public static Model_ReceivingValidationResult Warning(string message) => new()
⋮----
IsValid = true, // Warnings don't block
</file>

<file path="Module_Receiving/Models/Model_ReceivingWorkflowStepResult.cs">
/// <summary>
/// Result of a workflow step transition for Receiving.
/// </summary>
public class Model_ReceivingWorkflowStepResult
⋮----
public static Model_ReceivingWorkflowStepResult SuccessResult(Enum_ReceivingWorkflowStep newStep, string message = "") => new()
⋮----
public static Model_ReceivingWorkflowStepResult ErrorResult(List<string> errors) => new()
</file>

<file path="Module_Receiving/Models/Model_SaveResult.cs">
public class Model_SaveResult
⋮----
// Legacy property support if needed, or just remove if unused
</file>

<file path="Module_Receiving/Models/Model_UserPreference.cs">
public partial class Model_UserPreference : ObservableObject
⋮----
/// <summary>Unique identifier (auto-increment)</summary>
⋮----
/// <summary>Username (Windows username or PIN-authenticated user)</summary>
⋮----
/// <summary>Preferred package type: "Package" or "Pallet"</summary>
⋮----
/// <summary>Timestamp when preference was last updated</summary>
⋮----
private DateTime _lastUpdated;
⋮----
/// <summary>Workstation identifier (for shared terminals)</summary>
⋮----
/// <summary>Default general mode</summary>
⋮----
/// <summary>Default receiving workflow mode</summary>
⋮----
/// <summary>Default dunnage workflow mode</summary>
</file>

<file path="Module_Receiving/Models/Model_WorkflowStepResult.cs">
public class Model_WorkflowStepResult
</file>

<file path="Module_Receiving/Services/Service_CSVWriter.cs">
/// <summary>
/// Service for writing receiving data to CSV files.
/// Handles both local (%APPDATA%) and network paths with graceful fallback.
/// </summary>
public class Service_CSVWriter : IService_CSVWriter
⋮----
private readonly IService_UserSessionManager _sessionManager;
private readonly IService_LoggingUtility _logger;
⋮----
_sessionManager = sessionManager ?? throw new ArgumentNullException(nameof(sessionManager));
_logger = logger ?? throw new ArgumentNullException(nameof(logger));
⋮----
var appDataPath = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
// Ensure directory exists
var appDir = Path.Combine(appDataPath, "MTM_Receiving_Application");
if (!Directory.Exists(appDir))
⋮----
Directory.CreateDirectory(appDir);
⋮----
_localCSVPath = Path.Combine(appDir, "ReceivingData.csv");
⋮----
private string GetNetworkCSVPathInternal()
⋮----
_logger.LogInfo("Resolving network CSV path...");
⋮----
var userDir = Path.Combine(networkBase, userName);
⋮----
_logger.LogInfo($"Checking network directory: {userDir}");
⋮----
if (!Directory.Exists(userDir))
⋮----
_logger.LogInfo($"Creating network directory: {userDir}");
Directory.CreateDirectory(userDir);
⋮----
_logger.LogWarning($"Failed to create network directory: {ex.Message}");
⋮----
return Path.Combine(userDir, "ReceivingData.csv");
⋮----
_logger.LogError($"Error resolving network path: {ex.Message}");
⋮----
public async Task<Model_CSVWriteResult> WriteToCSVAsync(List<Model_ReceivingLoad> loads)
⋮----
_logger.LogInfo($"Starting WriteToCSVAsync for {loads?.Count ?? 0} loads.");
⋮----
throw new ArgumentException("Loads list cannot be null or empty", nameof(loads));
⋮----
var result = new Model_CSVWriteResult { RecordsWritten = loads.Count };
⋮----
// Write to local CSV (required - failure is critical)
⋮----
_logger.LogInfo($"Writing to local CSV: {_localCSVPath}");
⋮----
_logger.LogInfo("Local CSV write successful.");
⋮----
_logger.LogError($"Local CSV write failed: {ex.Message}");
⋮----
throw new InvalidOperationException("Failed to write local CSV file", ex);
⋮----
// Attempt network CSV (optional - failure is not critical)
⋮----
_logger.LogInfo("Attempting network CSV write...");
var networkPath = await Task.Run(() => GetNetworkCSVPathInternal());
_logger.LogInfo($"Network path resolved: {networkPath}");
⋮----
_logger.LogInfo("Network CSV write successful.");
⋮----
_logger.LogWarning($"Network CSV write failed: {ex.Message}");
⋮----
// Don't throw - graceful degradation
⋮----
public async Task WriteToFileAsync(string filePath, List<Model_ReceivingLoad> loads, bool append = true)
⋮----
_logger.LogInfo($"WriteToFileAsync called for: {filePath}, Append: {append}");
await Task.Run(async () =>
⋮----
bool isNewFile = !File.Exists(filePath) || !append;
_logger.LogInfo($"File exists check for {filePath}: {!isNewFile}");
⋮----
var config = new CsvConfiguration(CultureInfo.InvariantCulture)
⋮----
// We handle header manually
⋮----
await using var stream = new FileStream(filePath, fileMode, FileAccess.Write, FileShare.Read);
await using var writer = new StreamWriter(stream);
await using var csv = new CsvWriter(writer, config);
⋮----
csv.NextRecord();
⋮----
csv.WriteRecord(load);
⋮----
await writer.FlushAsync();
_logger.LogInfo($"Successfully wrote to {filePath}");
⋮----
_logger.LogError($"Error writing to file {filePath}: {ex.Message}");
⋮----
public async Task<List<Model_ReceivingLoad>> ReadFromCSVAsync(string filePath)
⋮----
_logger.LogInfo($"ReadFromCSVAsync called for: {filePath}");
return await Task.Run(() =>
⋮----
if (!File.Exists(filePath))
⋮----
throw new FileNotFoundException($"CSV file not found: {filePath}");
⋮----
using var reader = new StreamReader(filePath);
using var csv = new CsvReader(reader, config);
⋮----
_logger.LogInfo($"Successfully read {loads.Count} records from {filePath}");
⋮----
_logger.LogError($"Error reading from file {filePath}: {ex.Message}");
⋮----
public async Task<Model_CSVDeleteResult> ClearCSVFilesAsync()
⋮----
var result = new Model_CSVDeleteResult();
⋮----
// Clear local CSV
if (File.Exists(_localCSVPath))
⋮----
await Task.Run(() =>
⋮----
using var writer = new StreamWriter(_localCSVPath);
using var csv = new CsvWriter(writer, CultureInfo.InvariantCulture);
⋮----
// Clear network CSV
⋮----
if (File.Exists(networkPath))
⋮----
using var writer = new StreamWriter(networkPath);
⋮----
public async Task<Model_CSVExistenceResult> CheckCSVFilesExistAsync()
⋮----
var result = new Model_CSVExistenceResult();
⋮----
result.LocalExists = File.Exists(_localCSVPath);
⋮----
result.NetworkExists = File.Exists(networkPath);
⋮----
public string GetLocalCSVPath() => _localCSVPath;
⋮----
public string GetNetworkCSVPath() => GetNetworkCSVPathInternal();
</file>

<file path="Module_Receiving/Services/Service_MySQL_PackagePreferences.cs">
/// <summary>
/// Service for managing package type preferences in MySQL database.
/// </summary>
public class Service_MySQL_PackagePreferences : IService_MySQL_PackagePreferences
⋮----
private readonly Dao_PackageTypePreference _dao;
⋮----
_dao = dao ?? throw new ArgumentNullException(nameof(dao));
⋮----
// Constructor for backward compatibility if needed
⋮----
_dao = new Dao_PackageTypePreference(connectionString);
⋮----
public async Task<Model_PackageTypePreference?> GetPreferenceAsync(string partID)
⋮----
if (string.IsNullOrWhiteSpace(partID))
⋮----
throw new ArgumentException("Part ID cannot be null or empty", nameof(partID));
⋮----
var result = await _dao.GetPreferenceAsync(partID);
⋮----
public async Task SavePreferenceAsync(Model_PackageTypePreference preference)
⋮----
throw new ArgumentNullException(nameof(preference));
⋮----
var result = await _dao.SavePreferenceAsync(preference);
⋮----
throw new Exception(result.ErrorMessage);
⋮----
public async Task<bool> DeletePreferenceAsync(string partID)
⋮----
var result = await _dao.DeletePreferenceAsync(partID);
</file>

<file path="Module_Receiving/Services/Service_MySQL_Receiving.cs">
/// <summary>
/// Service for saving receiving load data to MySQL database.
/// </summary>
public class Service_MySQL_Receiving : IService_MySQL_Receiving
⋮----
private readonly Dao_ReceivingLoad _receivingLoadDao;
private readonly IService_LoggingUtility _logger;
⋮----
_logger = logger ?? throw new ArgumentNullException(nameof(logger));
⋮----
// Constructor for backward compatibility if needed, but DI should handle it
⋮----
_receivingLoadDao = new Dao_ReceivingLoad(connectionString);
⋮----
public async Task<int> SaveReceivingLoadsAsync(List<Model_ReceivingLoad> loads)
⋮----
_logger.LogInfo($"Saving {loads.Count} loads to database.");
⋮----
var result = await _receivingLoadDao.SaveLoadsAsync(loads);
⋮----
_logger.LogInfo($"Successfully saved {result.Data} loads.");
⋮----
_logger.LogError($"Failed to save loads: {result.ErrorMessage}", result.Exception);
throw new InvalidOperationException(result.ErrorMessage, result.Exception);
⋮----
public async Task<int> UpdateReceivingLoadsAsync(List<Model_ReceivingLoad> loads)
⋮----
_logger.LogInfo($"Updating {loads.Count} loads in database.");
⋮----
var result = await _receivingLoadDao.UpdateLoadsAsync(loads);
⋮----
_logger.LogInfo($"Successfully updated {result.Data} loads.");
⋮----
_logger.LogError($"Failed to update loads: {result.ErrorMessage}", result.Exception);
⋮----
public async Task<int> DeleteReceivingLoadsAsync(List<Model_ReceivingLoad> loads)
⋮----
_logger.LogInfo($"Deleting {loads.Count} loads from database.");
⋮----
var result = await _receivingLoadDao.DeleteLoadsAsync(loads);
⋮----
_logger.LogInfo($"Successfully deleted {result.Data} loads.");
⋮----
_logger.LogError($"Failed to delete loads: {result.ErrorMessage}", result.Exception);
⋮----
public async Task<List<Model_ReceivingLoad>> GetReceivingHistoryAsync(string partID, DateTime startDate, DateTime endDate)
⋮----
var result = await _receivingLoadDao.GetHistoryAsync(partID, startDate, endDate);
⋮----
_logger.LogError($"Failed to get receiving history: {result.ErrorMessage}", result.Exception);
// Return empty list or throw? Original implementation returned empty list on error (implicitly via empty result)
// But here we know it failed.
// I'll return empty list to match previous behavior of returning list (even if empty).
⋮----
public async Task<Model_Dao_Result<List<Model_ReceivingLoad>>> GetAllReceivingLoadsAsync(DateTime startDate, DateTime endDate)
⋮----
_logger.LogInfo($"Retrieving all receiving loads from {startDate:yyyy-MM-dd} to {endDate:yyyy-MM-dd}");
⋮----
var result = await _receivingLoadDao.GetAllAsync(startDate, endDate);
⋮----
_logger.LogInfo($"Retrieved {result.Data?.Count ?? 0} receiving loads from database");
⋮----
_logger.LogError($"Failed to retrieve receiving loads: {result.ErrorMessage}", result.Exception);
⋮----
public async Task<bool> TestConnectionAsync()
⋮----
// Delegate to DAO or keep simple check?
// DAO doesn't have TestConnection.
// I'll keep it simple or add it to DAO.
// Since I don't want to modify DAO again right now, I'll just try a simple query via DAO if possible,
// or just assume true if DAO is instantiated.
// Actually, I can't easily test connection without exposing connection string or adding method to DAO.
// I'll add TestConnectionAsync to DAO later if needed.
// For now, I'll just return true as a placeholder or try to call GetAllAsync with limit 0?
// Or I can just remove this method if it's not in the interface.
// Let's check interface.
</file>

<file path="Module_Receiving/Services/Service_MySQL_ReceivingLine.cs">
public class Service_MySQL_ReceivingLine : IService_MySQL_ReceivingLine
⋮----
private readonly Dao_ReceivingLine _receivingLineDao;
private readonly IService_LoggingUtility _logger;
private readonly IService_ErrorHandler _errorHandler;
⋮----
public async Task<Model_Dao_Result> InsertReceivingLineAsync(Model_ReceivingLine line)
⋮----
// DELEGATE TO DAO
var result = await _receivingLineDao.InsertReceivingLineAsync(line);
⋮----
_logger.LogError(
⋮----
_logger.LogInfo(
⋮----
await _errorHandler.HandleErrorAsync(
⋮----
return Model_Dao_Result_Factory.Failure(
</file>

<file path="Module_Receiving/Services/Service_ReceivingValidation.cs">
/// <summary>
/// Service for validating receiving data and enforcing business rules.
/// </summary>
public class Service_ReceivingValidation : IService_ReceivingValidation
⋮----
private readonly IService_InforVisual _inforVisualService;
private static readonly Regex _regex = new Regex(@"^(PO-)?\d{1,6}$", RegexOptions.IgnoreCase);
⋮----
_inforVisualService = inforVisualService ?? throw new ArgumentNullException(nameof(inforVisualService));
⋮----
public Model_ReceivingValidationResult ValidatePONumber(string poNumber)
⋮----
if (string.IsNullOrWhiteSpace(poNumber))
⋮----
return Model_ReceivingValidationResult.Error("PO number is required");
⋮----
// Allow optional "PO-" prefix followed by 1-6 digits
if (!_regex.IsMatch(poNumber))
⋮----
return Model_ReceivingValidationResult.Error("PO number must be numeric (up to 6 digits) or in PO-###### format");
⋮----
return Model_ReceivingValidationResult.Success();
⋮----
public Model_ReceivingValidationResult ValidatePartID(string partID)
⋮----
if (string.IsNullOrWhiteSpace(partID))
⋮----
return Model_ReceivingValidationResult.Error("Part ID is required");
⋮----
return Model_ReceivingValidationResult.Error("Part ID cannot exceed 50 characters");
⋮----
public Model_ReceivingValidationResult ValidateNumberOfLoads(int numLoads)
⋮----
return Model_ReceivingValidationResult.Error("Number of loads must be at least 1");
⋮----
return Model_ReceivingValidationResult.Error("Number of loads cannot exceed 99");
⋮----
public Model_ReceivingValidationResult ValidateWeightQuantity(decimal weightQuantity)
⋮----
return Model_ReceivingValidationResult.Error("Weight/Quantity must be greater than 0");
⋮----
public Model_ReceivingValidationResult ValidatePackageCount(int packagesPerLoad)
⋮----
return Model_ReceivingValidationResult.Error("Package count must be greater than 0");
⋮----
public Model_ReceivingValidationResult ValidateHeatLotNumber(string heatLotNumber)
⋮----
if (string.IsNullOrWhiteSpace(heatLotNumber))
⋮----
return Model_ReceivingValidationResult.Error("Heat/Lot number is required");
⋮----
return Model_ReceivingValidationResult.Error("Heat/Lot number cannot exceed 50 characters");
⋮----
public Task<Model_ReceivingValidationResult> ValidateAgainstPOQuantityAsync(decimal totalQuantity, decimal orderedQuantity, string partID)
⋮----
return Task.FromResult(Model_ReceivingValidationResult.Warning(
⋮----
return Task.FromResult(Model_ReceivingValidationResult.Success());
⋮----
public async Task<Model_ReceivingValidationResult> CheckSameDayReceivingAsync(string poNumber, string partID, decimal userEnteredQuantity)
⋮----
var result = await _inforVisualService.GetSameDayReceivingQuantityAsync(poNumber, partID, DateTime.Today);
⋮----
return Model_ReceivingValidationResult.Warning(
⋮----
// If check fails or returns 0, don't block - just skip the warning
⋮----
public Model_ReceivingValidationResult ValidateReceivingLoad(Model_ReceivingLoad load)
⋮----
if (string.IsNullOrWhiteSpace(load.PartID))
⋮----
errors.Add("Part ID is required");
⋮----
if (string.IsNullOrWhiteSpace(load.PartType))
⋮----
errors.Add("Part Type is required");
⋮----
errors.Add("Load number must be at least 1");
⋮----
errors.Add($"Load {load.LoadNumber}: Weight/Quantity must be greater than 0");
⋮----
if (string.IsNullOrWhiteSpace(load.HeatLotNumber))
⋮----
errors.Add($"Load {load.LoadNumber}: Heat/Lot number is required");
⋮----
errors.Add($"Load {load.LoadNumber}: Package count must be greater than 0");
⋮----
if (string.IsNullOrWhiteSpace(load.PackageTypeName))
⋮----
errors.Add($"Load {load.LoadNumber}: Package type is required");
⋮----
var result = Model_ReceivingValidationResult.Error(string.Join("; ", errors));
⋮----
public Model_ReceivingValidationResult ValidateSession(List<Model_ReceivingLoad> loads)
⋮----
return Model_ReceivingValidationResult.Error("Session must contain at least one load");
⋮----
allErrors.AddRange(loadValidation.Errors);
⋮----
var result = Model_ReceivingValidationResult.Error($"{allErrors.Count} validation error(s) found");
⋮----
public async Task<Model_ReceivingValidationResult> ValidatePartExistsInVisualAsync(string partID)
⋮----
var result = await _inforVisualService.GetPartByIDAsync(partID);
⋮----
return Model_ReceivingValidationResult.Error($"Error validating part: {result.ErrorMessage}");
⋮----
return Model_ReceivingValidationResult.Error($"Part ID {partID} not found in Infor Visual database");
</file>

<file path="Module_Receiving/Services/Service_ReceivingWorkflow.cs">
/// <summary>
/// Service for orchestrating the receiving workflow state machine.
/// Manages step transitions, validation gates, and session state.
/// </summary>
public class Service_ReceivingWorkflow : IService_ReceivingWorkflow
⋮----
private readonly IService_SessionManager _sessionManager;
private readonly IService_CSVWriter _csvWriter;
private readonly IService_MySQL_Receiving _mysqlReceiving;
private readonly IService_ReceivingValidation _validation;
private readonly IService_LoggingUtility _logger;
private readonly IService_ViewModelRegistry _viewModelRegistry;
⋮----
public void RaiseStatusMessage(string message)
⋮----
private Enum_ReceivingWorkflowStep _currentStep = Enum_ReceivingWorkflowStep.ModeSelection;
⋮----
_logger.LogInfo($"Changing step from {_currentStep} to {value}");
⋮----
_logger.LogInfo($"Step changed to {value} (event fired)");
⋮----
_sessionManager = sessionManager ?? throw new ArgumentNullException(nameof(sessionManager));
_csvWriter = csvWriter ?? throw new ArgumentNullException(nameof(csvWriter));
_mysqlReceiving = mysqlReceiving ?? throw new ArgumentNullException(nameof(mysqlReceiving));
_validation = validation ?? throw new ArgumentNullException(nameof(validation));
_logger = logger ?? throw new ArgumentNullException(nameof(logger));
_viewModelRegistry = viewModelRegistry ?? throw new ArgumentNullException(nameof(viewModelRegistry));
⋮----
public async Task<bool> StartWorkflowAsync()
⋮----
_logger.LogInfo("Starting receiving workflow.");
// Try to load existing session
var existingSession = await _sessionManager.LoadSessionAsync();
⋮----
_logger.LogInfo("Restoring existing session.");
⋮----
// Determine which step to restore to based on session state
CurrentStep = Enum_ReceivingWorkflowStep.Review; // Default to review if session exists
return true; // Session restored
⋮----
// Start fresh
CurrentSession = new Model_ReceivingSession();
⋮----
// Check if user has a default receiving mode set
⋮----
if (currentUser != null && !string.IsNullOrEmpty(currentUser.DefaultReceivingMode))
⋮----
// Skip mode selection and go directly to the default mode
switch (currentUser.DefaultReceivingMode.ToLower())
⋮----
_logger.LogInfo("Starting in Guided mode (default)");
⋮----
_logger.LogInfo("Starting in Manual Entry mode (default)");
⋮----
_logger.LogInfo("Starting in Edit mode (default)");
⋮----
// Invalid default, show mode selection
⋮----
_logger.LogInfo("Invalid default mode, showing mode selection");
⋮----
// No default mode, show mode selection
⋮----
_logger.LogInfo("No default mode set, showing mode selection");
⋮----
return false; // New session
⋮----
public async Task<Model_ReceivingWorkflowStepResult> AdvanceToNextStepAsync()
⋮----
// Validate current step before advancing
⋮----
// Transition handled by GoToStep
return Model_ReceivingWorkflowStepResult.SuccessResult(CurrentStep);
⋮----
// Manual entry goes directly to saving/review
// Validation happens on save
⋮----
// Edit mode goes to saving/review
⋮----
if (string.IsNullOrEmpty(CurrentPONumber) && !IsNonPOItem)
⋮----
validationErrors.Add("PO Number is required.");
return Model_ReceivingWorkflowStepResult.ErrorResult(validationErrors);
⋮----
validationErrors.Add("Part selection is required.");
⋮----
// Update session with PO/Part info
⋮----
validationErrors.Add("Number of loads must be at least 1.");
⋮----
var result = _validation.ValidateWeightQuantity(load.WeightQuantity);
⋮----
validationErrors.Add($"Load {load.LoadNumber}: {result.Message}");
⋮----
var result = _validation.ValidateHeatLotNumber(load.HeatLotNumber);
⋮----
var result = _validation.ValidatePackageCount(load.PackagesPerLoad);
⋮----
if (string.IsNullOrWhiteSpace(load.PackageTypeName))
⋮----
validationErrors.Add($"Load {load.LoadNumber}: Package Type is required.");
⋮----
_logger.LogInfo("Transitioning from Review to Saving...");
⋮----
validationErrors.Add($"Cannot advance from step {CurrentStep}");
⋮----
// Persist session after step change
_logger.LogInfo("Persisting session...");
⋮----
_logger.LogInfo("Session persisted.");
⋮----
return Model_ReceivingWorkflowStepResult.SuccessResult(CurrentStep, $"Advanced to {CurrentStep}");
⋮----
private void GenerateLoads()
⋮----
// Remove previous loads from this batch if they exist
⋮----
CurrentSession.Loads.Remove(load);
⋮----
_currentBatchLoads.Clear();
⋮----
var load = new Model_ReceivingLoad
⋮----
LoadNumber = CurrentSession.Loads.Count + 1, // Increment load number globally
⋮----
CurrentSession.Loads.Add(load);
_currentBatchLoads.Add(load);
⋮----
public Model_ReceivingWorkflowStepResult GoToPreviousStep()
⋮----
return Model_ReceivingWorkflowStepResult.ErrorResult(new List<string> { $"Cannot go back from step {CurrentStep}" });
⋮----
return Model_ReceivingWorkflowStepResult.SuccessResult(CurrentStep, $"Returned to {CurrentStep}");
⋮----
public Model_ReceivingWorkflowStepResult GoToStep(Enum_ReceivingWorkflowStep step)
⋮----
return Model_ReceivingWorkflowStepResult.SuccessResult(CurrentStep, $"Navigated to {CurrentStep}");
⋮----
public async Task AddCurrentPartToSessionAsync()
⋮----
// Commit current batch
⋮----
// Reset for next part
⋮----
public void ClearUIInputs()
⋮----
_viewModelRegistry.ClearAllInputs();
⋮----
public async Task<Model_SaveResult> SaveToCSVOnlyAsync()
⋮----
var result = new Model_SaveResult();
⋮----
// Validate session
var validation = _validation.ValidateSession(CurrentSession.Loads);
⋮----
var csvResult = await _csvWriter.WriteToCSVAsync(CurrentSession.Loads);
⋮----
result.LocalCSVPath = _csvWriter.GetLocalCSVPath();
result.NetworkCSVPath = _csvWriter.GetNetworkCSVPath();
⋮----
result.Errors.Add($"Local CSV write failed: {csvResult.LocalError}");
⋮----
result.Warnings.Add($"Network CSV write failed: {csvResult.NetworkError}");
⋮----
result.Success = result.LocalCSVSuccess; // Network failure is just a warning
⋮----
result.Errors.Add($"CSV save failed: {ex.Message}");
_logger.LogError("CSV save failed", ex);
⋮----
public async Task<Model_SaveResult> SaveToDatabaseOnlyAsync()
⋮----
int savedCount = await _mysqlReceiving.SaveReceivingLoadsAsync(CurrentSession.Loads);
⋮----
result.Errors.Add($"Database save failed: {ex.Message}");
_logger.LogError("Database save failed", ex);
⋮----
public async Task<Model_SaveResult> SaveSessionAsync(IProgress<string>? messageProgress = null, IProgress<int>? percentProgress = null)
⋮----
_logger.LogInfo("Starting session save.");
⋮----
_logger.LogInfo("Validating session before save...");
⋮----
_logger.LogWarning($"Session validation failed: {string.Join(", ", validation.Errors)}");
⋮----
_logger.LogInfo("Reporting progress: Saving to local CSV...");
⋮----
// Save to CSV
⋮----
result.Errors.AddRange(csvResult.Errors);
result.Warnings.AddRange(csvResult.Warnings);
⋮----
_logger.LogInfo("Reporting progress: Saving to database...");
⋮----
// Save to database
⋮----
result.Errors.AddRange(dbResult.Errors);
⋮----
_logger.LogInfo("Reporting progress: Finalizing...");
⋮----
// Final success check
// Success if Local CSV worked AND Database worked
⋮----
_logger.LogInfo("Save completed successfully. Clearing session.");
// Clear session
await _sessionManager.ClearSessionAsync();
CurrentSession.Loads.Clear();
⋮----
// Also clear CSV files since we saved successfully
await _csvWriter.ClearCSVFilesAsync();
⋮----
_logger.LogWarning($"Save completed with errors. Success: {result.Success}");
⋮----
_logger.LogError("Unexpected error during save session", ex);
⋮----
result.Errors.Add($"Unexpected error: {ex.Message}");
⋮----
public async Task ResetWorkflowAsync()
⋮----
public async Task<Model_CSVDeleteResult> ResetCSVFilesAsync()
⋮----
_logger.LogInfo("Resetting CSV files requested.");
return await _csvWriter.ClearCSVFilesAsync();
⋮----
public async Task PersistSessionAsync()
⋮----
await _sessionManager.SaveSessionAsync(CurrentSession);
</file>

<file path="Module_Receiving/Services/Service_SessionManager.cs">
/// <summary>
/// Service for persisting and restoring session state to/from JSON file.
/// Session file location: %APPDATA%\MTM_Receiving_Application\session.json
/// </summary>
public class Service_SessionManager : IService_SessionManager
⋮----
private readonly IService_LoggingUtility _logger;
⋮----
_logger = logger ?? throw new ArgumentNullException(nameof(logger));
var appDataPath = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
var appFolder = Path.Combine(appDataPath, "MTM_Receiving_Application");
⋮----
// Ensure directory exists
if (!Directory.Exists(appFolder))
⋮----
Directory.CreateDirectory(appFolder);
⋮----
_sessionPath = Path.Combine(appFolder, "session.json");
⋮----
public async Task SaveSessionAsync(Model_ReceivingSession session)
⋮----
_logger.LogInfo("SaveSessionAsync started.");
⋮----
throw new ArgumentNullException(nameof(session));
⋮----
var options = new JsonSerializerOptions
⋮----
_logger.LogInfo("Serializing session...");
var json = JsonSerializer.Serialize(session, options);
_logger.LogInfo($"Writing session to file: {_sessionPath}");
await File.WriteAllTextAsync(_sessionPath, json);
_logger.LogInfo("Session saved successfully.");
⋮----
_logger.LogError($"Failed to save session to file: {ex.Message}", ex);
throw new InvalidOperationException("Failed to save session to file", ex);
⋮----
public async Task<Model_ReceivingSession?> LoadSessionAsync()
⋮----
if (!File.Exists(_sessionPath))
⋮----
var json = await File.ReadAllTextAsync(_sessionPath);
⋮----
// Corrupted file - delete and return null
⋮----
File.Delete(_sessionPath);
⋮----
// Ignore delete errors
⋮----
throw new InvalidOperationException("Failed to load session from file", ex);
⋮----
public async Task<bool> ClearSessionAsync()
⋮----
await Task.Run(() => File.Delete(_sessionPath));
⋮----
public bool SessionExists()
⋮----
return File.Exists(_sessionPath);
⋮----
public string GetSessionFilePath()
</file>

<file path="Module_Receiving/ViewModels/ViewModel_Receiving_EditMode.cs">
/// <summary>
/// ViewModel for Edit Mode - allows editing existing loads but not adding new ones.
/// </summary>
public partial class ViewModel_Receiving_EditMode : ViewModel_Shared_Base
⋮----
private readonly IService_ReceivingWorkflow _workflowService;
private readonly IService_MySQL_Receiving _mysqlService;
private readonly IService_CSVWriter _csvWriter;
private readonly IService_Pagination _paginationService;
private readonly IService_Help _helpService;
⋮----
private Enum_DataSourceType _currentDataSource = Enum_DataSourceType.Memory;
⋮----
private DateTimeOffset _filterStartDate = DateTimeOffset.Now.AddDays(-7);
⋮----
private DateTimeOffset _filterEndDate = DateTimeOffset.Now;
⋮----
private string _thisMonthButtonText = DateTime.Now.ToString("MMMM");
⋮----
private readonly IService_Window _windowService;
⋮----
/// Initializes a new instance of the EditModeViewModel class.
⋮----
/// <param name="workflowService"></param>
/// <param name="mysqlService"></param>
/// <param name="csvWriter"></param>
/// <param name="paginationService"></param>
/// <param name="errorHandler"></param>
/// <param name="logger"></param>
/// <param name="windowService"></param>
/// <param name="helpService"></param>
⋮----
_logger.LogInfo("Edit Mode initialized");
⋮----
/// Gets the text representation of the quarter for a given date.
⋮----
/// <param name="date"></param>
private static string GetQuarterText(DateTime date)
⋮----
/// Handles the pagination page changed event.
⋮----
/// <param name="sender"></param>
/// <param name="e"></param>
private void OnPageChanged(object? sender, EventArgs e)
⋮----
/// Updates the displayed loads based on the current page.
⋮----
private void UpdatePagedDisplay()
⋮----
Loads.Clear();
⋮----
Loads.Add(item);
⋮----
/// Notifies that pagination command execution status has changed.
⋮----
private void NotifyPaginationCommands()
⋮----
NextPageCommand.NotifyCanExecuteChanged();
PreviousPageCommand.NotifyCanExecuteChanged();
FirstPageCommand.NotifyCanExecuteChanged();
LastPageCommand.NotifyCanExecuteChanged();
GoToPageCommand.NotifyCanExecuteChanged();
⋮----
/// Handles changes to the Loads collection to attach/detach property change listeners.
⋮----
private void Loads_CollectionChanged(object? sender, System.Collections.Specialized.NotifyCollectionChangedEventArgs e)
⋮----
/// Handles property changes on individual load items.
⋮----
private void Load_PropertyChanged(object? sender, System.ComponentModel.PropertyChangedEventArgs e)
⋮----
RemoveRowCommand.NotifyCanExecuteChanged();
⋮----
/// Notifies that command execution status has changed.
⋮----
private void NotifyCommands()
⋮----
SaveCommand.NotifyCanExecuteChanged();
⋮----
SelectAllCommand.NotifyCanExecuteChanged();
⋮----
/// Handles changes to the filter start date.
⋮----
partial void OnFilterStartDateChanged(DateTimeOffset value) => ApplyDateFilter();
⋮----
/// Handles changes to the filter end date.
⋮----
partial void OnFilterEndDateChanged(DateTimeOffset value) => ApplyDateFilter();
⋮----
/// Applies the date filter to the loaded data.
⋮----
private void ApplyDateFilter()
⋮----
/// Filters the master list and updates pagination.
⋮----
private void FilterAndPaginate()
⋮----
var end = FilterEndDate.Date.AddDays(1).AddTicks(-1);
⋮----
_filteredLoads = _allLoads.Where(l => l.ReceivedDate >= start && l.ReceivedDate <= end).ToList();
⋮----
_paginationService.SetSource(_filteredLoads);
⋮----
/// Sets the date filter to the last 7 days.
⋮----
private async Task SetFilterLastWeekAsync()
⋮----
FilterStartDate = DateTime.Today.AddDays(-7);
⋮----
/// Sets the date filter to today.
⋮----
private async Task SetFilterTodayAsync()
⋮----
/// Sets the date filter to the current week.
⋮----
private async Task SetFilterThisWeekAsync()
⋮----
var start = today.AddDays(-(int)today.DayOfWeek);
var end = start.AddDays(6);
⋮----
/// Sets the date filter to the current month.
⋮----
private async Task SetFilterThisMonthAsync()
⋮----
FilterStartDate = new DateTime(today.Year, today.Month, 1);
FilterEndDate = FilterStartDate.AddMonths(1).AddDays(-1);
⋮----
/// Sets the date filter to the current quarter.
⋮----
private async Task SetFilterThisQuarterAsync()
⋮----
FilterStartDate = new DateTime(today.Year, 3 * quarter - 2, 1);
FilterEndDate = FilterStartDate.AddMonths(3).AddDays(-1);
⋮----
/// Sets the date filter to show all records (last year).
⋮----
private async Task SetFilterShowAllAsync()
⋮----
FilterStartDate = DateTime.Today.AddYears(-1);
⋮----
/// Navigates to the previous page.
⋮----
private void PreviousPage() => _paginationService.PreviousPage();
⋮----
/// Navigates to the next page.
⋮----
private void NextPage() => _paginationService.NextPage();
⋮----
/// Navigates to the first page.
⋮----
private void FirstPage() => _paginationService.FirstPage();
⋮----
/// Navigates to the last page.
⋮----
private void LastPage() => _paginationService.LastPage();
⋮----
/// Navigates to a specific page number.
⋮----
private void GoToPage() => _paginationService.GoToPage(GotoPageNumber);
⋮----
/// Determines if navigation to the next page is possible.
⋮----
private bool CanGoNext() => _paginationService.HasNextPage;
⋮----
/// Determines if navigation to the previous page is possible.
⋮----
private bool CanGoPrevious() => _paginationService.HasPreviousPage;
⋮----
/// Loads data from the current in-memory session.
⋮----
private async Task LoadFromCurrentMemoryAsync()
⋮----
_logger.LogInfo("Loading data from current memory");
⋮----
_deletedLoads.Clear();
⋮----
await _errorHandler.HandleErrorAsync(
⋮----
_allLoads.Clear();
⋮----
_allLoads.Add(load);
⋮----
_logger.LogInfo($"Successfully loaded {_allLoads.Count} loads from current memory");
⋮----
FilterStartDate = DateTimeOffset.Now.AddYears(-1);
⋮----
_logger.LogError($"Failed to load from current memory: {ex.Message}");
await _errorHandler.HandleErrorAsync("Failed to load data from current session", Enum_ErrorSeverity.Error, ex);
⋮----
/// Loads data from current label CSV files.
⋮----
private async Task LoadFromCurrentLabelsAsync()
⋮----
_logger.LogInfo("User initiated Current Labels (CSV) load");
⋮----
await _errorHandler.ShowErrorDialogAsync(
⋮----
_logger.LogError($"Failed to load from labels: {ex.Message}");
await _errorHandler.HandleErrorAsync("Failed to load data from label file", Enum_ErrorSeverity.Error, ex);
⋮----
/// Attempts to load data from default CSV locations (local or network).
⋮----
private async Task<bool> TryLoadFromDefaultCsvAsync()
⋮----
string localPath = _csvWriter.GetLocalCSVPath();
if (File.Exists(localPath))
⋮----
_logger.LogInfo($"Attempting to load from local CSV: {localPath}");
var loadedData = await _csvWriter.ReadFromCSVAsync(localPath);
⋮----
_workflowService.CurrentSession.Loads.Add(load);
⋮----
_logger.LogInfo($"Successfully loaded {_allLoads.Count} loads from local labels");
⋮----
_logger.LogWarning($"Failed to load from local labels: {ex.Message}");
⋮----
string networkPath = _csvWriter.GetNetworkCSVPath();
if (File.Exists(networkPath))
⋮----
_logger.LogInfo($"Attempting to load from network labels: {networkPath}");
var loadedData = await _csvWriter.ReadFromCSVAsync(networkPath);
⋮----
_logger.LogInfo($"Successfully loaded {_allLoads.Count} loads from network labels");
⋮----
_logger.LogWarning($"Failed to load from network labels: {ex.Message}");
⋮----
/// Loads historical data from the database.
⋮----
private async Task LoadFromHistoryAsync()
⋮----
_logger.LogInfo("User initiated history load");
⋮----
_logger.LogInfo($"Loading receiving history from {startDate:yyyy-MM-dd} to {endDate:yyyy-MM-dd}");
var result = await _mysqlService.GetAllReceivingLoadsAsync(startDate, endDate);
⋮----
_logger.LogInfo($"Successfully loaded {_allLoads.Count} loads from history");
⋮----
_logger.LogError($"Failed to load from history: {ex.Message}");
await _errorHandler.HandleErrorAsync("Failed to load data from history", Enum_ErrorSeverity.Error, ex);
⋮----
/// Selects or deselects all currently displayed loads.
⋮----
private void SelectAll()
⋮----
bool anyUnselected = Loads.Any(l => !l.IsSelected);
⋮----
/// Determines if the Select All command can be executed.
⋮----
private bool CanSelectAll() => Loads.Count > 0;
⋮----
/// Removes the selected row(s) from the collection.
⋮----
private void RemoveRow()
⋮----
var selectedLoads = Loads.Where(l => l.IsSelected).ToList();
⋮----
_logger.LogInfo($"Removing {selectedLoads.Count} selected loads");
⋮----
_deletedLoads.Add(load);
_workflowService.CurrentSession.Loads.Remove(load);
_allLoads.Remove(load);
_filteredLoads.Remove(load);
Loads.Remove(load);
⋮----
_logger.LogInfo($"Removing load {SelectedLoad.LoadNumber} (Part ID: {SelectedLoad.PartID})");
_deletedLoads.Add(SelectedLoad);
_workflowService.CurrentSession.Loads.Remove(SelectedLoad);
_allLoads.Remove(SelectedLoad);
_filteredLoads.Remove(SelectedLoad);
Loads.Remove(SelectedLoad);
⋮----
_logger.LogWarning("RemoveRow called with no selected load(s)");
⋮----
/// Determines if the Remove Row command can be executed.
⋮----
private bool CanRemoveRow() => Loads.Any(l => l.IsSelected);
⋮----
/// Saves the changes made to the loads.
⋮----
private async Task SaveAsync()
⋮----
_logger.LogInfo($"Validating and saving {_filteredLoads.Count} loads from edit mode");
⋮----
// Set default Heat/Lot if empty for all loads being processed
// We update _allLoads to ensure consistency across all data sources
⋮----
if (string.IsNullOrWhiteSpace(load.HeatLotNumber))
⋮----
var errorMessage = string.Join("\n", validationErrors);
_logger.LogWarning($"Edit mode validation failed: {validationErrors.Count} errors");
⋮----
await _workflowService.AdvanceToNextStepAsync();
⋮----
if (string.IsNullOrEmpty(_currentCsvPath))
⋮----
await _errorHandler.HandleErrorAsync("No label file path available for saving.", Enum_ErrorSeverity.Error);
⋮----
_logger.LogInfo($"Overwriting label file: {_currentCsvPath}");
await _csvWriter.WriteToFileAsync(_currentCsvPath, _allLoads, append: false);
⋮----
await _errorHandler.ShowErrorDialogAsync("Success", "Label file updated successfully.", Enum_ErrorSeverity.Info);
⋮----
_logger.LogInfo("Updating history records");
⋮----
_logger.LogInfo($"Deleting {_deletedLoads.Count} removed records");
deleted = await _mysqlService.DeleteReceivingLoadsAsync(_deletedLoads);
⋮----
updated = await _mysqlService.UpdateReceivingLoadsAsync(_filteredLoads);
⋮----
await _errorHandler.ShowErrorDialogAsync("Success", $"History updated successfully.\n{updated} records updated.\n{deleted} records deleted.", Enum_ErrorSeverity.Info);
⋮----
_logger.LogInfo($"Edit mode save completed successfully for source: {CurrentDataSource}");
⋮----
_logger.LogError($"Failed to save edit mode data: {ex.Message}");
await _errorHandler.HandleErrorAsync("Failed to save receiving data", Enum_ErrorSeverity.Critical, ex);
⋮----
/// Determines if the Save command can be executed.
⋮----
private bool CanSave()
⋮----
/// Returns to the mode selection screen after confirmation.
⋮----
private async Task ReturnToModeSelectionAsync()
⋮----
var xamlRoot = _windowService.GetXamlRoot();
⋮----
_logger.LogError("Cannot show dialog: XamlRoot is null");
await _errorHandler.HandleErrorAsync("Unable to display dialog", Enum_ErrorSeverity.Error);
⋮----
var result = await dialog.ShowAsync().AsTask();
⋮----
_logger.LogInfo("User confirmed return to mode selection, resetting workflow");
await _workflowService.ResetWorkflowAsync();
_workflowService.GoToStep(Enum_ReceivingWorkflowStep.ModeSelection);
⋮----
_logger.LogError($"Failed to reset workflow: {ex.Message}");
await _errorHandler.HandleErrorAsync("Failed to return to mode selection", Enum_ErrorSeverity.Error, ex);
⋮----
_logger.LogInfo("User cancelled return to mode selection");
⋮----
/// Validates the list of loads before saving.
⋮----
/// <param name="loadsToValidate"></param>
private System.Collections.Generic.List<string> ValidateLoads(IEnumerable<Model_ReceivingLoad> loadsToValidate)
⋮----
if (!loadsToValidate.Any() && _deletedLoads.Count == 0)
⋮----
errors.Add("No loads to save");
⋮----
if (string.IsNullOrWhiteSpace(load.PartID))
⋮----
errors.Add($"Load #{load.LoadNumber}: Part ID is required");
⋮----
errors.Add($"Load #{load.LoadNumber}: Weight/Quantity must be greater than zero");
⋮----
errors.Add($"Load #{load.LoadNumber}: Packages per load must be greater than zero");
⋮----
/// Shows contextual help for edit mode
⋮----
private async Task ShowHelpAsync()
⋮----
await _helpService.ShowHelpAsync("Receiving.EditMode");
⋮----
public string GetTooltip(string key) => _helpService.GetTooltip(key);
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Receiving/ViewModels/ViewModel_Receiving_HeatLot.cs">
public partial class ViewModel_Receiving_HeatLot : ViewModel_Shared_Base
⋮----
private readonly IService_ReceivingWorkflow _workflowService;
private readonly IService_ReceivingValidation _validationService;
private readonly IService_Help _helpService;
⋮----
private void OnStepChanged(object? sender, System.EventArgs e)
⋮----
public Task OnNavigatedToAsync()
⋮----
Loads.Clear();
⋮----
Loads.Add(load);
⋮----
private void AutoFill()
⋮----
// Fill down logic:
// Iterate through loads. If a load has a blank HeatLotNumber,
// copy it from the previous load (if available).
⋮----
if (string.IsNullOrWhiteSpace(currentLoad.HeatLotNumber) && !string.IsNullOrWhiteSpace(prevLoad.HeatLotNumber))
⋮----
private Task ValidateAndContinueAsync()
⋮----
// Set "Not Entered" for any blank heat/lot fields before advancing
⋮----
// Validation logic is handled by Service_ReceivingWorkflow when advancing
⋮----
/// <summary>
/// Ensures all heat/lot fields have a value. Sets "Nothing Entered" for blank fields.
/// </summary>
private void PrepareHeatLotFields()
⋮----
if (string.IsNullOrWhiteSpace(load.HeatLotNumber))
⋮----
/// Shows contextual help for heat/lot entry
⋮----
private async Task ShowHelpAsync()
⋮----
await _helpService.ShowHelpAsync("Receiving.HeatLot");
⋮----
public string GetTooltip(string key) => _helpService.GetTooltip(key);
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Receiving/ViewModels/ViewModel_Receiving_LoadEntry.cs">
public partial class ViewModel_Receiving_LoadEntry : ViewModel_Shared_Base, IResettableViewModel
⋮----
private readonly IService_ReceivingWorkflow _workflowService;
private readonly IService_ReceivingValidation _validationService;
private readonly IService_Help _helpService;
private readonly IService_ViewModelRegistry _viewModelRegistry;
⋮----
_viewModelRegistry.Register(this);
⋮----
public void ResetToDefaults()
⋮----
private void OnStepChanged(object? sender, System.EventArgs e)
⋮----
private async Task CreateLoadsAsync()
⋮----
var validationResult = _validationService.ValidateNumberOfLoads(NumberOfLoads);
⋮----
await _errorHandler.HandleErrorAsync(validationResult.Message, Enum_ErrorSeverity.Warning);
⋮----
// Sync with service
⋮----
partial void OnNumberOfLoadsChanged(int value)
⋮----
public void UpdatePartInfo(string partId, string description)
⋮----
/// <summary>
/// Shows contextual help for load entry
/// </summary>
⋮----
private async Task ShowHelpAsync()
⋮----
await _helpService.ShowHelpAsync("Receiving.LoadEntry");
⋮----
public string GetTooltip(string key) => _helpService.GetTooltip(key);
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Receiving/ViewModels/ViewModel_Receiving_ManualEntry.cs">
public partial class ViewModel_Receiving_ManualEntry : ViewModel_Shared_Base
⋮----
private readonly IService_ReceivingWorkflow _workflowService;
private readonly IService_MySQL_Receiving _mysqlService;
private readonly IService_Window _windowService;
private readonly IService_Help _helpService;
⋮----
private async Task AutoFillAsync()
⋮----
_logger.LogInfo("Starting Auto-Fill Blank Spaces operation");
⋮----
// Iterate through all loads in the grid
⋮----
// 1. Part ID (Material ID) - Fill Down Logic
// If blank, copy from immediate predecessor
if (string.IsNullOrWhiteSpace(currentLoad.PartID))
⋮----
if (!string.IsNullOrWhiteSpace(prev.PartID))
⋮----
// 2. Other Fields - Copy from nearest previous row with SAME PartID
if (!string.IsNullOrWhiteSpace(currentLoad.PartID))
⋮----
// Find source load (nearest previous row with same PartID)
⋮----
// PO Number: If blank, use PO from previous row with same Material ID
if (string.IsNullOrWhiteSpace(currentLoad.PoNumber) && !string.IsNullOrWhiteSpace(sourceLoad.PoNumber))
⋮----
// Quantity: If blank (0), use Quantity from previous row with same Material ID
⋮----
// Heat: If blank, use Heat from previous row with same Material ID
if (string.IsNullOrWhiteSpace(currentLoad.HeatLotNumber) && !string.IsNullOrWhiteSpace(sourceLoad.HeatLotNumber))
⋮----
// Also copy other useful fields if blank, consistent with "same material" logic
⋮----
if (string.IsNullOrWhiteSpace(currentLoad.PackageTypeName) && !string.IsNullOrWhiteSpace(sourceLoad.PackageTypeName))
⋮----
// Date: If blank (default/min value), use current date
// Note: Model_ReceivingLoad initializes ReceivedDate to DateTime.Now usually, but let's ensure it.
⋮----
// Employee: If blank, use employee from first row
// Assuming "Employee" maps to UserId or similar.
// Model_ReceivingLoad has UserId.
if (string.IsNullOrWhiteSpace(currentLoad.UserId))
⋮----
// Try previous row first (propagation)
if (i > 0 && !string.IsNullOrWhiteSpace(Loads[i - 1].UserId))
⋮----
else if (Loads.Count > 0 && !string.IsNullOrWhiteSpace(Loads[0].UserId))
⋮----
// If first row is also blank, maybe use current session user?
⋮----
_logger.LogInfo($"Auto-Fill Blank Spaces completed. Updated {filledCount} fields across {Loads.Count} rows.");
⋮----
// Force UI update if needed (ObservableCollection updates properties automatically if INPC is fired)
// Model_ReceivingLoad implements ObservableObject so it should be fine.
⋮----
_logger.LogError($"Auto-fill failed: {ex.Message}");
await _errorHandler.HandleErrorAsync("Auto-fill failed", Enum_ErrorSeverity.Error, ex);
⋮----
private void AddRow()
⋮----
private async Task AddMultipleRowsAsync()
⋮----
// Prompt for number of rows
var xamlRoot = _windowService.GetXamlRoot();
⋮----
var result = await dialog.ShowAsync();
⋮----
if (int.TryParse(inputTextBox.Text, out int count) && count > 0 && count <= 50)
⋮----
_logger.LogInfo($"Adding {count} new rows to manual entry grid");
⋮----
_logger.LogWarning($"Invalid row count entered: {inputTextBox.Text}");
await _errorHandler.HandleErrorAsync("Please enter a valid number between 1 and 50.", Enum_ErrorSeverity.Warning);
⋮----
public void AddNewLoad()
⋮----
var newLoad = new Model_ReceivingLoad
⋮----
LoadID = System.Guid.NewGuid(),
⋮----
Loads.Add(newLoad);
_workflowService.CurrentSession.Loads.Add(newLoad);
⋮----
// Select the new load
⋮----
private void RemoveRow()
⋮----
_logger.LogInfo($"Removing load {SelectedLoad.LoadNumber} (Part ID: {SelectedLoad.PartID})");
_workflowService.CurrentSession.Loads.Remove(SelectedLoad);
Loads.Remove(SelectedLoad);
⋮----
_logger.LogWarning("RemoveRow called with no selected load");
⋮----
private async Task SaveAsync()
⋮----
_logger.LogInfo($"Saving {Loads.Count} loads from manual entry");
⋮----
// Set default Heat/Lot if empty
⋮----
if (string.IsNullOrWhiteSpace(load.HeatLotNumber))
⋮----
// In manual mode, we skip step-by-step validation and go straight to saving
// The workflow service will handle the actual save logic
await _workflowService.AdvanceToNextStepAsync();
⋮----
_logger.LogError($"Failed to save manual entry data: {ex.Message}");
await _errorHandler.HandleErrorAsync("Failed to save receiving data", Enum_ErrorSeverity.Critical, ex);
⋮----
private async Task ReturnToModeSelectionAsync()
⋮----
_logger.LogError("Cannot show dialog: XamlRoot is null");
await _errorHandler.HandleErrorAsync("Unable to display dialog", Enum_ErrorSeverity.Error);
⋮----
var result = await dialog.ShowAsync().AsTask();
⋮----
_logger.LogInfo("User confirmed return to mode selection, resetting workflow");
// Reset workflow and return to mode selection
await _workflowService.ResetWorkflowAsync();
_workflowService.GoToStep(Enum_ReceivingWorkflowStep.ModeSelection);
// The ReceivingWorkflowViewModel will handle the visibility update through StepChanged event
⋮----
_logger.LogError($"Failed to reset workflow: {ex.Message}");
await _errorHandler.HandleErrorAsync("Failed to return to mode selection", Enum_ErrorSeverity.Error, ex);
⋮----
_logger.LogInfo("User cancelled return to mode selection");
⋮----
/// <summary>
/// Shows contextual help for manual entry
/// </summary>
⋮----
private async Task ShowHelpAsync()
⋮----
await _helpService.ShowHelpAsync("Receiving.ManualEntry");
⋮----
public string GetTooltip(string key) => _helpService.GetTooltip(key);
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Receiving/ViewModels/ViewModel_Receiving_ModeSelection.cs">
public partial class ViewModel_Receiving_ModeSelection : ViewModel_Shared_Base
⋮----
private readonly IService_ReceivingWorkflow _workflowService;
private readonly IService_UserSessionManager _sessionManager;
private readonly IService_UserPreferences _userPreferencesService;
private readonly IService_Help _helpService;
private readonly IService_Window _windowService;
⋮----
// Load current default mode
⋮----
private void LoadDefaultMode()
⋮----
private async Task SelectGuidedModeAsync()
⋮----
_logger.LogInfo("User selected Guided Mode.");
⋮----
_workflowService.GoToStep(Enum_ReceivingWorkflowStep.POEntry);
⋮----
private async Task SelectManualModeAsync()
⋮----
_logger.LogInfo("User selected Manual Mode.");
⋮----
_workflowService.GoToStep(Enum_ReceivingWorkflowStep.ManualEntry);
⋮----
private async Task SelectEditModeAsync()
⋮----
_logger.LogInfo("User selected Edit Mode.");
⋮----
_workflowService.GoToStep(Enum_ReceivingWorkflowStep.EditMode);
⋮----
/// <summary>
/// Shows confirmation dialog before mode change
/// </summary>
/// <returns>True if user confirmed, false if cancelled</returns>
⋮----
/// Checks if there is any unsaved data in the current workflow
⋮----
private bool HasUnsavedData()
⋮----
// Check if there are any loads in the session
⋮----
// Check if there's any PO/Part selection
if (!string.IsNullOrEmpty(_workflowService.CurrentSession.PoNumber) ||
⋮----
private async Task<bool> ConfirmModeChangeAsync()
⋮----
// Skip confirmation if there's no unsaved data
⋮----
_logger.LogInfo("No unsaved data detected, skipping confirmation dialog");
⋮----
var xamlRoot = _windowService.GetXamlRoot();
⋮----
_logger.LogWarning("XamlRoot is null, proceeding without confirmation");
⋮----
var dialog = new ContentDialog
⋮----
var result = await dialog.ShowAsync();
⋮----
_logger.LogError($"Error showing confirmation dialog: {ex.Message}", ex);
return true; // Proceed if dialog fails
⋮----
/// Clears all transient workflow data without affecting persisted data
⋮----
private void ClearWorkflowData()
⋮----
// Clear current session data (in-memory only, not database or CSV)
⋮----
// Clear UI inputs in all connected ViewModels
⋮----
_logger.LogInfo("Workflow data and UI inputs cleared for mode change");
⋮----
_logger.LogError($"Error clearing workflow data: {ex.Message}", ex);
⋮----
/// Clears UI input properties across all Receiving workflow ViewModels
⋮----
private void ClearAllUIInputs()
⋮----
// Clear POEntry ViewModel
⋮----
// Clear PackageType ViewModel
⋮----
// Clear LoadEntry ViewModel
⋮----
// Clear WeightQuantity ViewModel
⋮----
// Clear HeatLot ViewModel
⋮----
_logger.LogInfo("UI inputs cleared across all Receiving ViewModels");
⋮----
_logger.LogError($"Error clearing UI inputs: {ex.Message}", ex);
⋮----
private async Task SetGuidedAsDefaultAsync(bool isChecked)
⋮----
var result = await _userPreferencesService.UpdateDefaultReceivingModeAsync(currentUser.WindowsUsername, newMode ?? "");
⋮----
// Update in-memory user object
⋮----
// Update UI state
⋮----
_logger.LogInfo($"Default mode set to: {newMode ?? "none"}");
⋮----
await _errorHandler.ShowErrorDialogAsync("Save Error", result.ErrorMessage, Enum_ErrorSeverity.Error);
// Revert checkbox
⋮----
await _errorHandler.HandleErrorAsync($"Failed to set default mode: {ex.Message}",
⋮----
private async Task SetManualAsDefaultAsync(bool isChecked)
⋮----
private async Task SetEditAsDefaultAsync(bool isChecked)
⋮----
/// Shows contextual help for receiving mode selection
⋮----
private async Task ShowHelpAsync()
⋮----
await _helpService.ShowHelpAsync("Receiving.ModeSelection");
⋮----
/// Gets a tooltip by key from the help service
⋮----
/// <param name="key"></param>
public string GetTooltip(string key) => _helpService.GetTooltip(key);
⋮----
/// Gets a placeholder by key from the help service
⋮----
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
⋮----
/// Gets a tip by key from the help service
⋮----
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Receiving/ViewModels/ViewModel_Receiving_PackageType.cs">
public partial class ViewModel_Receiving_PackageType : ViewModel_Shared_Base
⋮----
private readonly IService_ReceivingWorkflow _workflowService;
private readonly IService_MySQL_PackagePreferences _preferencesService;
private readonly IService_ReceivingValidation _validationService;
private readonly IService_Help _helpService;
⋮----
private void OnStepChanged(object? sender, System.EventArgs e)
⋮----
public async Task OnNavigatedToAsync()
⋮----
Loads.Clear();
⋮----
Loads.Add(load);
⋮----
private async Task LoadPreferencesAsync()
⋮----
if (string.IsNullOrEmpty(partId))
⋮----
// Try to load from DB
var preference = await _preferencesService.GetPreferenceAsync(partId);
⋮----
// Apply saved preference
if (PackageTypes.Contains(preference.PackageTypeName))
⋮----
// Apply smart defaults based on PartID prefix
⋮----
if (partID.StartsWith("MMC", StringComparison.OrdinalIgnoreCase))
⋮----
else if (partID.StartsWith("MMF", StringComparison.OrdinalIgnoreCase))
⋮----
SelectedPackageType = "Skids"; // Default fallback
⋮----
partial void OnSelectedPackageTypeChanged(string value)
⋮----
SavePreferenceAsync().ConfigureAwait(false);
⋮----
partial void OnCustomPackageTypeNameChanged(string value)
⋮----
partial void OnIsSaveAsDefaultChanged(bool value)
⋮----
// Optional: Delete preference if unchecked?
// For now, we just don't update it.
// Or we could delete it.
// Let's delete it to be consistent with "Default" concept.
DeletePreferenceAsync().ConfigureAwait(false);
⋮----
private void UpdateLoadsPackageType()
⋮----
private async Task SavePreferenceAsync()
⋮----
_workflowService.RaiseStatusMessage("Part ID too long (max 50 chars).");
⋮----
if (string.IsNullOrWhiteSpace(typeName))
⋮----
_workflowService.RaiseStatusMessage("Please enter a package type name.");
⋮----
_workflowService.RaiseStatusMessage("Package type name too long (max 50 chars).");
⋮----
// T020b: Ensure PackageTypeName has valid characters
// Allow alphanumeric, spaces, hyphens, dots, parentheses
if (!_regex.IsMatch(typeName))
⋮----
_workflowService.RaiseStatusMessage("Invalid characters in package type name.");
⋮----
var preference = new Model_PackageTypePreference
⋮----
await _preferencesService.SavePreferenceAsync(preference);
_workflowService.RaiseStatusMessage("Preference saved.");
⋮----
// T020d: Add more detailed error logging
⋮----
await _errorHandler.HandleErrorAsync(msg, Enum_ErrorSeverity.Warning, ex);
⋮----
private async Task DeletePreferenceAsync()
⋮----
await _preferencesService.DeletePreferenceAsync(partId);
_workflowService.RaiseStatusMessage("Preference deleted.");
⋮----
await _errorHandler.HandleErrorAsync("Failed to delete preference", Enum_ErrorSeverity.Warning, ex);
⋮----
/// <summary>
/// Shows contextual help for package type selection
/// </summary>
⋮----
private async Task ShowHelpAsync()
⋮----
await _helpService.ShowHelpAsync("Receiving.PackageType");
⋮----
public string GetTooltip(string key) => _helpService.GetTooltip(key);
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Receiving/ViewModels/ViewModel_Receiving_Review.cs">
public partial class ViewModel_Receiving_Review : ViewModel_Shared_Base
⋮----
private readonly IService_ReceivingWorkflow _workflowService;
private readonly IService_ReceivingValidation _validationService;
private readonly IService_Help _helpService;
private readonly IService_Window _windowService;
⋮----
private bool _isSingleView = true;  // Default to single entry view
⋮----
/// <summary>
/// Display index (1-based) for UI
/// </summary>
⋮----
/// Indicates if the Previous button should be enabled
⋮----
/// Indicates if the Next button should be enabled
⋮----
/// Inverse of IsSingleView for binding table view visibility
⋮----
private void OnStepChanged(object? sender, System.EventArgs e)
⋮----
public async Task OnNavigatedToAsync()
⋮----
Loads.Clear();
⋮----
Loads.Add(load);
⋮----
// Set current entry to first load if available
⋮----
private void PreviousEntry()
⋮----
private void NextEntry()
⋮----
private void SwitchToTableView()
⋮----
private void SwitchToSingleView()
⋮----
private async Task AddAnotherPartAsync()
⋮----
_logger.LogInfo("User requested to add another part/PO");
⋮----
// Show confirmation dialog to prevent accidental data loss
⋮----
_logger.LogInfo("User cancelled add another part/PO");
⋮----
// Save current session to CSV before clearing
⋮----
var saveResult = await _workflowService.SaveToCSVOnlyAsync();
⋮----
await _errorHandler.HandleErrorAsync(
$"Failed to save CSV backup: {string.Join(", ", saveResult.Errors)}",
⋮----
// Clear transient workflow data FIRST (before navigation)
⋮----
// Preserve current session loads
await _workflowService.AddCurrentPartToSessionAsync();
⋮----
// Navigate to PO Entry to start new part/PO entry
// Note: AddCurrentPartToSessionAsync already sets CurrentStep to POEntry
// so this is redundant, but explicit for clarity
_workflowService.GoToStep(Enum_ReceivingWorkflowStep.POEntry);
⋮----
_logger.LogInfo("Navigated to PO Entry for new part, workflow data cleared");
⋮----
_logger.LogError($"Error in AddAnotherPartAsync: {ex.Message}", ex);
⋮----
/// Shows confirmation dialog before clearing data for new entry
⋮----
private async Task<bool> ConfirmAddAnotherAsync()
⋮----
var xamlRoot = _windowService.GetXamlRoot();
⋮----
_logger.LogWarning("XamlRoot is null, proceeding without confirmation");
⋮----
var dialog = new ContentDialog
⋮----
var result = await dialog.ShowAsync();
⋮----
_logger.LogError($"Error showing confirmation dialog: {ex.Message}", ex);
return true; // Proceed if dialog fails
⋮----
/// Clears transient workflow data from intermediate steps (not the session loads)
/// This prevents data duplication when adding another part
⋮----
private void ClearTransientWorkflowData()
⋮----
// Clear the current session properties that hold form data
// but preserve the Loads collection (already saved loads)
⋮----
// Clear PO-related properties if they exist in session
⋮----
// Clear UI inputs in connected ViewModels
_workflowService.ClearUIInputs();
⋮----
_logger.LogInfo("Transient workflow data and UI inputs cleared for new entry");
⋮----
_logger.LogError($"Error clearing transient workflow data: {ex.Message}", ex);
⋮----
private async Task SaveAsync()
⋮----
// Trigger the save workflow
// This moves to "Saving" step
await _workflowService.AdvanceToNextStepAsync();
⋮----
public void HandleCascadingUpdate(Model_ReceivingLoad changedLoad, string propertyName)
⋮----
// Logic for cascading updates
// If user changes a value in row X, should it update X+1, X+2...?
// Spec says: "Review Grid with Cascading Updates"
// Usually this means if I change Heat# on Load 1, it might ask to update others,
// or if I change PO# it updates all for that part?
⋮----
// T044 says: "cascading update logic for Part# and PO#"
⋮----
var index = Loads.IndexOf(changedLoad);
⋮----
// Update all subsequent loads? Or all loads for this part?
// If we are reviewing the current session, and it's a single part (US1),
// changing PO probably implies changing it for all loads of this part.
⋮----
// If PartID changes, we might need to re-validate or update description?
// For now, let's assume we update all loads to match if it's the same "group".
⋮----
// Add other cascading logic if needed (e.g. Heat Number cascading downwards)
⋮----
/// Shows contextual help for review grid
⋮----
private async Task ShowHelpAsync()
⋮----
await _helpService.ShowHelpAsync("Receiving.Review");
⋮----
public string GetTooltip(string key) => _helpService.GetTooltip(key);
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Receiving/ViewModels/ViewModel_Receiving_WeightQuantity.cs">
public partial class ViewModel_Receiving_WeightQuantity : ViewModel_Shared_Base
⋮----
private readonly IService_ReceivingWorkflow _workflowService;
private readonly IService_ReceivingValidation _validationService;
private readonly IService_InforVisual _inforVisualService;
private readonly IService_Help _helpService;
⋮----
private void OnStepChanged(object? sender, EventArgs e)
⋮----
public async Task OnNavigatedToAsync()
⋮----
// Refresh loads from session
Loads.Clear();
⋮----
Loads.Add(load);
⋮----
private void UpdatePOQuantityInfo()
⋮----
private async Task CheckSameDayReceivingAsync()
⋮----
if (string.IsNullOrEmpty(poNumber) || string.IsNullOrEmpty(partId))
⋮----
var result = await _inforVisualService.GetSameDayReceivingQuantityAsync(poNumber, partId, DateTime.Today);
⋮----
await _errorHandler.LogErrorAsync("Failed to check same-day receiving", Enum_ErrorSeverity.Warning, ex);
⋮----
private async Task ValidateAndContinueAsync()
⋮----
// Validate all loads have weight > 0
⋮----
var result = _validationService.ValidateWeightQuantity(load.WeightQuantity);
⋮----
await _errorHandler.HandleErrorAsync($"Load {load.LoadNumber}: {result.Message}", Enum_ErrorSeverity.Warning);
⋮----
var totalWeight = Loads.Sum(l => l.WeightQuantity);
⋮----
/// <summary>
/// Shows contextual help for weight/quantity entry
/// </summary>
⋮----
private async Task ShowHelpAsync()
⋮----
await _helpService.ShowHelpAsync("Receiving.WeightQuantity");
⋮----
public string GetTooltip(string key) => _helpService.GetTooltip(key);
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Receiving/ViewModels/ViewModel_Receiving_Workflow.cs">
public partial class ViewModel_Receiving_Workflow : ViewModel_Shared_Base
⋮----
private readonly IService_ReceivingWorkflow _workflowService;
private readonly IService_Help _helpService;
⋮----
private readonly IService_Dispatcher _dispatcherService;
private readonly IService_Window _windowService;
⋮----
// Initialize visibility based on current step
⋮----
private void OnWorkflowStepChanged(object? sender, EventArgs e)
⋮----
_logger.LogInfo("StepChanged event received in ViewModel. Updating visibility.");
⋮----
_logger.LogInfo("Step is Saving. Enqueuing PerformSaveAsync via Dispatcher.");
_dispatcherService.TryEnqueue(async () =>
⋮----
// Hide all steps
⋮----
// Show current step and set title
⋮----
// Update help content based on step
HelpContent = Helper_WorkflowHelpContentGenerator.GenerateHelpContent(_workflowService.CurrentStep);
⋮----
_logger.LogInfo($"Visibility updated. Current Step: {_workflowService.CurrentStep}, Title: {CurrentStepTitle}");
⋮----
private async Task NextStepAsync()
⋮----
_logger.LogInfo("NextStepAsync command triggered.");
⋮----
// Removed Task.Yield() to avoid context switching issues
// await Task.Yield();
⋮----
var result = await _workflowService.AdvanceToNextStepAsync();
_logger.LogInfo($"AdvanceToNextStepAsync returned. Success: {result.Success}, Step: {_workflowService.CurrentStep}");
⋮----
await _errorHandler.HandleErrorAsync(
string.Join("\n", result.ValidationErrors),
⋮----
_logger.LogError($"Error in NextStepAsync: {ex.Message}", ex);
await _errorHandler.HandleErrorAsync($"An error occurred: {ex.Message}", Enum_ErrorSeverity.Error);
⋮----
private async Task PerformSaveAsync()
⋮----
_logger.LogInfo("PerformSaveAsync called but already saving. Ignoring.");
⋮----
_logger.LogInfo("PerformSaveAsync started.");
⋮----
// Update UI immediately
⋮----
// Perform save
⋮----
_logger.LogInfo($"Save progress message: {msg}");
⋮----
_logger.LogInfo($"Save progress percent: {pct}");
⋮----
_logger.LogInfo("Calling _workflowService.SaveSessionAsync...");
LastSaveResult = await _workflowService.SaveSessionAsync(messageProgress, percentProgress);
_logger.LogInfo($"SaveSessionAsync returned. Success: {LastSaveResult.Success}");
⋮----
// Advance to Complete step
await _workflowService.AdvanceToNextStepAsync();
⋮----
_logger.LogError($"Error in PerformSaveAsync: {ex.Message}", ex);
await _errorHandler.HandleErrorAsync($"Save failed: {ex.Message}", Enum_ErrorSeverity.Error);
⋮----
private async Task StartNewEntryAsync()
⋮----
await _workflowService.ResetWorkflowAsync();
⋮----
private async Task ResetCSVAsync()
⋮----
var xamlRoot = _windowService.GetXamlRoot();
⋮----
_logger.LogError("Cannot show dialog: XamlRoot is null");
await _errorHandler.HandleErrorAsync("Unable to display dialog", Enum_ErrorSeverity.Error);
⋮----
var dialog = new ContentDialog
⋮----
var result = await dialog.ShowAsync();
⋮----
// Try to save to DB first
var saveResult = await _workflowService.SaveToDatabaseOnlyAsync();
⋮----
var warnDialog = new ContentDialog
⋮----
Content = $"Failed to save to database: {string.Join(", ", saveResult.Errors)}\n\nDo you want to proceed with deleting CSV files anyway?",
⋮----
var warnResult = await warnDialog.ShowAsync();
⋮----
var deleteResult = await _workflowService.ResetCSVFilesAsync();
⋮----
private void PreviousStep()
⋮----
var result = _workflowService.GoToPreviousStep();
⋮----
private async Task ReturnToModeSelectionAsync()
⋮----
// Reset workflow and return to mode selection
⋮----
_workflowService.GoToStep(Enum_ReceivingWorkflowStep.ModeSelection);
⋮----
/// <summary>
/// Shows contextual help for current workflow step
/// </summary>
⋮----
private async Task ShowHelpAsync()
⋮----
await _helpService.ShowHelpAsync("Receiving.Workflow");
⋮----
public string GetTooltip(string key) => _helpService.GetTooltip(key);
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Receiving/Views/View_Receiving_EditMode.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_EditMode"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:viewmodels="using:MTM_Receiving_Application.Module_Receiving.ViewModels"
    xmlns:enums="using:MTM_Receiving_Application.Module_Core.Models.Enums"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d"
    x:Name="Root">

    <UserControl.Resources>
        <converters:Converter_DecimalToString x:Key="DecimalToStringConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Grid Grid.Row="0" Margin="0,0,0,12">
            <!-- Main Toolbar Area -->
            <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                <!-- Load Data Section -->
                <TextBlock Text="Load Data From:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,4,0"/>
                
                <Button Command="{x:Bind ViewModel.LoadFromCurrentMemoryCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.LoadSessionMemory'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8A7;"/>
                        <TextBlock Text="Current Memory"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.LoadFromCurrentLabelsCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.LoadRecentCSV'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8E5;"/>
                        <TextBlock Text="Current Labels"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.LoadFromHistoryCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.LoadHistoricalData'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74C;"/>
                        <TextBlock Text="History"/>
                    </StackPanel>
                </Button>

                <!-- Separator -->
                <Rectangle Width="1" Height="24" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" Margin="8,0"/>

                <!-- Edit Actions Section -->
                <Button Command="{x:Bind ViewModel.SelectAllCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.SelectAll'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8B3;"/>
                        <TextBlock Text="{x:Bind ViewModel.SelectAllButtonText, Mode=OneWay}"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.RemoveRowCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.RemoveRow'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74D;"/>
                        <TextBlock Text="Remove Row"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Date Filter Toolbar -->
        <Grid Grid.Row="1" Margin="0,0,0,12">
            <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                <TextBlock Text="Filter Date:" VerticalAlignment="Center" FontWeight="SemiBold"/>
                
                <CalendarDatePicker Date="{x:Bind ViewModel.FilterStartDate, Mode=TwoWay}" 
                                   PlaceholderText="{x:Bind ViewModel.GetPlaceholder('Field.StartDate'), Mode=OneWay}"
                                   Width="140"/>
                <TextBlock Text="to" VerticalAlignment="Center"/>
                <CalendarDatePicker Date="{x:Bind ViewModel.FilterEndDate, Mode=TwoWay}" 
                                   PlaceholderText="{x:Bind ViewModel.GetPlaceholder('Field.EndDate'), Mode=OneWay}"
                                   Width="140"/>
                
                <Rectangle Width="1" Height="24" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" Margin="8,0"/>
                
                <Button Content="Last Week" Command="{x:Bind ViewModel.SetFilterLastWeekCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.FilterLastWeek'), Mode=OneWay}"/>
                <Button Content="Today" Command="{x:Bind ViewModel.SetFilterTodayCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.FilterToday'), Mode=OneWay}"/>
                <Button Content="This Week" Command="{x:Bind ViewModel.SetFilterThisWeekCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.FilterThisWeek'), Mode=OneWay}"/>
                <Button Content="{x:Bind ViewModel.ThisMonthButtonText, Mode=OneWay}" Command="{x:Bind ViewModel.SetFilterThisMonthCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.FilterThisMonth'), Mode=OneWay}"/>
                <Button Content="{x:Bind ViewModel.ThisQuarterButtonText, Mode=OneWay}" Command="{x:Bind ViewModel.SetFilterThisQuarterCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.FilterThisQuarter'), Mode=OneWay}"/>
                <Button Content="Show All" Command="{x:Bind ViewModel.SetFilterShowAllCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.ClearFilters'), Mode=OneWay}"/>
            </StackPanel>
        </Grid>

        <!-- Data Grid -->
        <controls:DataGrid Grid.Row="2"
                          x:Name="EditModeDataGrid"
                          ItemsSource="{x:Bind ViewModel.Loads, Mode=OneWay}"
                          SelectedItem="{x:Bind ViewModel.SelectedLoad, Mode=TwoWay}"
                          AutoGenerateColumns="False"
                          IsReadOnly="False"
                          CanUserSortColumns="True"
                          GridLinesVisibility="All"
                          HeadersVisibility="Column"
                          SelectionMode="Single"
                          KeyDown="EditModeDataGrid_KeyDown"
                          CurrentCellChanged="EditModeDataGrid_CurrentCellChanged"
                          Tapped="EditModeDataGrid_Tapped">
            <controls:DataGrid.Columns>
                <controls:DataGridTemplateColumn Header="" Width="50" CanUserResize="False">
                    <controls:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}" 
                                      HorizontalAlignment="Center" 
                                      VerticalAlignment="Center"
                                      MinWidth="0"
                                      Margin="0"/>
                        </DataTemplate>
                    </controls:DataGridTemplateColumn.CellTemplate>
                </controls:DataGridTemplateColumn>
                <controls:DataGridTextColumn Header="Load #" Binding="{Binding LoadNumber}" IsReadOnly="True" Width="Auto"/>
                <controls:DataGridTextColumn Header="Part ID" Binding="{Binding PartID}" Width="*"/>
                <controls:DataGridTextColumn Header="Weight/Qty" Binding="{Binding WeightQuantity, Converter={StaticResource DecimalToStringConverter}}" Width="Auto"/>
                <controls:DataGridTextColumn Header="Heat/Lot" Binding="{Binding HeatLotNumber}" Width="Auto"/>
                <controls:DataGridTextColumn Header="Pkg Type" Binding="{Binding PackageType}" IsReadOnly="True" Width="Auto"/>
                <controls:DataGridTextColumn Header="Pkgs/Load" Binding="{Binding PackagesPerLoad}" Width="Auto"/>
                <controls:DataGridTextColumn Header="Wt/Pkg" Binding="{Binding WeightPerPackage, Converter={StaticResource DecimalToStringConverter}}" IsReadOnly="True" Width="Auto"/>
            </controls:DataGrid.Columns>
        </controls:DataGrid>

        <!-- Footer: Pagination and Save -->
        <Grid Grid.Row="3" Margin="0,12,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Pagination Controls -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                <Button Command="{x:Bind ViewModel.FirstPageCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.FirstPage'), Mode=OneWay}">
                    <FontIcon Glyph="&#xE892;"/>
                </Button>
                <Button Command="{x:Bind ViewModel.PreviousPageCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.PreviousPage'), Mode=OneWay}">
                    <FontIcon Glyph="&#xE76B;"/>
                </Button>
                
                <Rectangle Width="1" Height="24" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" Margin="8,0"/>
                
                <TextBlock Text="Page" VerticalAlignment="Center"/>
                <TextBox Text="{x:Bind ViewModel.GotoPageNumber, Mode=TwoWay}" Width="60" HorizontalContentAlignment="Center"/>
                <TextBlock Text="of" VerticalAlignment="Center"/>
                <TextBlock Text="{x:Bind ViewModel.TotalPages, Mode=OneWay}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                
                <Button Content="Go" Command="{x:Bind ViewModel.GoToPageCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.GoToPage'), Mode=OneWay}"/>
                
                <Rectangle Width="1" Height="24" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" Margin="8,0"/>
                
                <Button Command="{x:Bind ViewModel.NextPageCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.NextPage'), Mode=OneWay}">
                    <FontIcon Glyph="&#xE76C;"/>
                </Button>
                <Button Command="{x:Bind ViewModel.LastPageCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.LastPage'), Mode=OneWay}">
                    <FontIcon Glyph="&#xE893;"/>
                </Button>
            </StackPanel>

            <!-- Save Button -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12">
                <Button Content="Save &amp; Finish" Command="{x:Bind ViewModel.SaveCommand}" Style="{StaticResource AccentButtonStyle}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.SaveAndFinish'), Mode=OneWay}"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
</file>

<file path="Module_Receiving/Views/View_Receiving_EditMode.xaml.cs">
public sealed partial class View_Receiving_EditMode : UserControl
⋮----
this.InitializeComponent();
⋮----
private void EditModeDataGrid_CurrentCellChanged(object? sender, EventArgs e)
⋮----
// Wait for the move to complete then activate edit mode
grid?.DispatcherQueue.TryEnqueue(() =>
⋮----
Debug.WriteLine($"[EditModeView] CurrentCellChanged: BeginEdit for Row={grid.SelectedIndex}, Col={grid.CurrentColumn.Header}");
grid.BeginEdit();
⋮----
private void EditModeDataGrid_KeyDown(object sender, KeyRoutedEventArgs e)
⋮----
var shiftState = InputKeyboardSource.GetKeyStateForCurrentThread(VirtualKey.Shift);
⋮----
Debug.WriteLine($"[EditModeView] KeyDown: Key={e.Key}, Shift={isShiftDown}, OriginalSource={e.OriginalSource}, CurrentColumn={grid.CurrentColumn?.Header}");
⋮----
private void EditModeDataGrid_Tapped(object sender, TappedRoutedEventArgs e)
⋮----
Debug.WriteLine($"[EditModeView] Tapped: OriginalSource={e.OriginalSource}");
⋮----
// Handle selection
⋮----
Debug.WriteLine("[EditModeView] Tapped: SelectedItem is null (Header or empty space). Selecting first editable cell.");
// Header clicked or empty space
⋮----
// Cell clicked - CurrentCellChanged handles the edit mode if cell changes.
// But if we tap the SAME cell, CurrentCellChanged might not fire.
// So we ensure edit mode here too.
Debug.WriteLine("[EditModeView] Tapped: Cell clicked. Enqueuing BeginEdit.");
grid.DispatcherQueue.TryEnqueue(() =>
⋮----
Debug.WriteLine($"[EditModeView] Tapped: BeginEdit for Row={grid.SelectedIndex}, Col={grid.CurrentColumn.Header}");
⋮----
private void SelectFirstEditableCell(DataGrid grid)
⋮----
Debug.WriteLine("[EditModeView] SelectFirstEditableCell: Starting");
⋮----
// Find first non-readonly column
var firstEditable = grid.Columns.OrderBy(c => c.DisplayIndex).FirstOrDefault(c => !c.IsReadOnly);
⋮----
Debug.WriteLine($"[EditModeView] SelectFirstEditableCell: Found editable column {firstEditable.Header}. Setting CurrentColumn and calling BeginEdit.");
⋮----
grid.Focus(Microsoft.UI.Xaml.FocusState.Programmatic);
⋮----
Debug.WriteLine($"[EditModeView] SelectFirstEditableCell: BeginEdit called for column {firstEditable.Header}");
⋮----
Debug.WriteLine("[EditModeView] SelectFirstEditableCell: No editable column found.");
⋮----
Debug.WriteLine($"[EditModeView] SelectFirstEditableCell: Grid has no items (Count={itemCount})");
</file>

<file path="Module_Receiving/Views/View_Receiving_HeatLot.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_HeatLot"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:Converter_StringFormat x:Key="StringFormatConverter"/>
        <converters:Converter_IntToVisibility x:Key="IntToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid Padding="16">
        <!-- Content Section -->
        <Grid>
            <StackPanel Spacing="16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Load Entries" Style="{StaticResource SubtitleTextBlockStyle}" VerticalAlignment="Center"/>
                    <Button Grid.Column="1" 
                            Content="Auto-Fill" 
                            Command="{x:Bind ViewModel.AutoFillCommand}"
                            Style="{StaticResource AccentButtonStyle}"
                            ToolTipService.ToolTip="Fill blank heat numbers from rows above"/>
                </Grid>
            
                <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="500">
                    <ItemsControl ItemsSource="{x:Bind ViewModel.Loads, Mode=OneWay}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Margin="0,0,0,12" 
                                       Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                       Padding="16" 
                                       CornerRadius="8" 
                                       BorderThickness="1" 
                                       BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
                                    <Grid ColumnSpacing="16">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center" Width="100">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <FontIcon Glyph="&#xE7B8;" 
                                                         FontSize="16"
                                                         Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                                <TextBlock Text="{Binding LoadNumber, Converter={StaticResource StringFormatConverter}, ConverterParameter='Load #{0}'}" 
                                                          Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <TextBox Grid.Column="1"
                                                Header="Heat/Lot Number (Optional)"
                                                Text="{Binding HeatLotNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                PlaceholderText="Enter heat/lot number or leave blank"
                                                AutomationProperties.Name="Heat Lot Number"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
</file>

<file path="Module_Receiving/Views/View_Receiving_HeatLot.xaml.cs">
public sealed partial class View_Receiving_HeatLot : UserControl
⋮----
private readonly IService_Focus _focusService;
⋮----
this.InitializeComponent();
⋮----
_focusService.AttachFocusOnVisibility(this);
⋮----
private async void HeatLotView_Loaded(object sender, RoutedEventArgs e)
⋮----
await ViewModel.OnNavigatedToAsync();
</file>

<file path="Module_Receiving/Views/View_Receiving_LoadEntry.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_LoadEntry"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    mc:Ignorable="d">

    <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="32"
                MinWidth="500">
            <StackPanel Spacing="24" HorizontalAlignment="Center">
                <StackPanel Spacing="8" HorizontalAlignment="Center">
                    <FontIcon Glyph="&#xE7B8;" 
                             FontSize="48"
                             Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                             HorizontalAlignment="Center"/>
                    <TextBlock Text="{x:Bind ViewModel.SelectedPartInfo, Mode=OneWay}" 
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                               HorizontalAlignment="Center"
                               TextAlignment="Center"/>
                </StackPanel>

                <NumberBox x:Name="NumberOfLoadsNumberBox"
                           Header="Number of Loads (1-99)"
                           Value="{x:Bind ViewModel.NumberOfLoads, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                           Minimum="1"
                           Maximum="99"
                           SmallChange="1"
                           LargeChange="10"
                           SpinButtonPlacementMode="Inline"
                           Width="250"
                           HorizontalAlignment="Center"
                           AutomationProperties.Name="Number of Loads"/>
                       
                <TextBlock Text="Enter the total number of skids/loads for this part." 
                           Style="{StaticResource CaptionTextBlockStyle}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           HorizontalAlignment="Center"
                           TextAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
</file>

<file path="Module_Receiving/Views/View_Receiving_LoadEntry.xaml.cs">
public sealed partial class View_Receiving_LoadEntry : UserControl
⋮----
private readonly IService_Focus _focusService;
⋮----
this.InitializeComponent();
⋮----
_focusService.AttachFocusOnVisibility(this, NumberOfLoadsNumberBox);
</file>

<file path="Module_Receiving/Views/View_Receiving_ManualEntry.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_ManualEntry"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:viewmodels="using:MTM_Receiving_Application.Module_Receiving.ViewModels"
    xmlns:enums="using:MTM_Receiving_Application.Module_Core.Models.Enums"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d"
    x:Name="Root">

    <UserControl.Resources>
        <converters:Converter_DecimalToString x:Key="DecimalToStringConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Grid Grid.Row="0" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                <Button x:Name="AddRowButton" Command="{x:Bind ViewModel.AddRowCommand}" Style="{StaticResource AccentButtonStyle}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.AddRow'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE710;"/>
                        <TextBlock Text="Add Row"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.AddMultipleRowsCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.AddMultipleRows'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE710;"/>
                        <TextBlock Text="Add Multiple"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.RemoveRowCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.RemoveRow'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74D;"/>
                        <TextBlock Text="Remove Row"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.AutoFillCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.AutoFill'), Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74E;"/>
                        <TextBlock Text="Auto-Fill"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Data Grid -->
        <controls:DataGrid Grid.Row="1"
                          x:Name="ManualEntryDataGrid"
                          ItemsSource="{x:Bind ViewModel.Loads, Mode=OneWay}"
                          SelectedItem="{x:Bind ViewModel.SelectedLoad, Mode=TwoWay}"
                          AutoGenerateColumns="False"
                          IsReadOnly="False"
                          CanUserSortColumns="True"
                          GridLinesVisibility="All"
                          HeadersVisibility="Column"
                          SelectionMode="Single"
                          KeyDown="ManualEntryDataGrid_KeyDown"
                          CurrentCellChanged="ManualEntryDataGrid_CurrentCellChanged"
                          Tapped="ManualEntryDataGrid_Tapped">
            <controls:DataGrid.Columns>
                <controls:DataGridTextColumn Header="Load #" Binding="{Binding LoadNumber}" IsReadOnly="True"/>
                <controls:DataGridTextColumn Header="Part ID" Binding="{Binding PartID}" Width="*"/>
                <controls:DataGridTextColumn Header="Weight/Qty" Binding="{Binding WeightQuantity, Converter={StaticResource DecimalToStringConverter}}"/>
                <controls:DataGridTextColumn Header="Heat/Lot" Binding="{Binding HeatLotNumber}"/>
                <controls:DataGridTextColumn Header="Pkg Type" Binding="{Binding PackageType}" IsReadOnly="True"/>
                <controls:DataGridTextColumn Header="Pkgs/Load" Binding="{Binding PackagesPerLoad}"/>
                <controls:DataGridTextColumn Header="Wt/Pkg" Binding="{Binding WeightPerPackage, Converter={StaticResource DecimalToStringConverter}}" IsReadOnly="True"/>
            </controls:DataGrid.Columns>
        </controls:DataGrid>

        <!-- Navigation -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0" Spacing="12">
            <Button Content="Save &amp; Finish" Command="{x:Bind ViewModel.SaveCommand}" Style="{StaticResource AccentButtonStyle}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.SaveAndFinish'), Mode=OneWay}"/>
        </StackPanel>
    </Grid>
</UserControl>
</file>

<file path="Module_Receiving/Views/View_Receiving_ManualEntry.xaml.cs">
public sealed partial class View_Receiving_ManualEntry : UserControl
⋮----
private readonly IService_Focus _focusService;
⋮----
this.InitializeComponent();
⋮----
// Listen for collection changes to handle "Add Row" focus
⋮----
_focusService.AttachFocusOnVisibility(this, AddRowButton);
⋮----
private void Loads_CollectionChanged(object? sender, System.Collections.Specialized.NotifyCollectionChangedEventArgs e)
⋮----
Debug.WriteLine("[ManualEntryView] Loads_CollectionChanged: New row added");
// When a new row is added, ensure we focus and edit the first cell
ManualEntryDataGrid.DispatcherQueue.TryEnqueue(() =>
⋮----
// Select the last added item (assuming add to bottom)
⋮----
Debug.WriteLine($"[ManualEntryView] Loads_CollectionChanged: Selecting new item LoadNumber={newItem.LoadNumber}");
⋮----
ManualEntryDataGrid.ScrollIntoView(newItem, ManualEntryDataGrid.Columns.FirstOrDefault());
⋮----
// Use async delay to ensure grid is fully ready before entering edit mode
_ = Task.Run(async () =>
⋮----
await Task.Delay(100); // Give grid time to complete selection and render
⋮----
private void ManualEntryDataGrid_CurrentCellChanged(object? sender, EventArgs e)
⋮----
// Wait for the move to complete then activate edit mode
grid?.DispatcherQueue.TryEnqueue(() =>
⋮----
Debug.WriteLine($"[ManualEntryView] CurrentCellChanged: BeginEdit for Row={grid.SelectedIndex}, Col={grid.CurrentColumn.Header}");
grid.BeginEdit();
⋮----
private void ManualEntryDataGrid_KeyDown(object sender, KeyRoutedEventArgs e)
⋮----
var shiftState = InputKeyboardSource.GetKeyStateForCurrentThread(VirtualKey.Shift);
⋮----
Debug.WriteLine($"[ManualEntryView] KeyDown: Key={e.Key}, Shift={isShiftDown}, OriginalSource={e.OriginalSource}, CurrentColumn={grid.CurrentColumn?.Header}");
⋮----
private void ManualEntryDataGrid_Tapped(object sender, TappedRoutedEventArgs e)
⋮----
Debug.WriteLine($"[ManualEntryView] Tapped: OriginalSource={e.OriginalSource}");
⋮----
// Handle empty grid or header clicks
⋮----
Debug.WriteLine("[ManualEntryView] Tapped: Grid empty, triggering AddRow command.");
if (ViewModel.AddRowCommand.CanExecute(null))
⋮----
ViewModel.AddRowCommand.Execute(null);
⋮----
// Focus handled by Loads_CollectionChanged
⋮----
Debug.WriteLine("[ManualEntryView] Tapped: SelectedItem is null (Header or empty space). Selecting first editable cell.");
// Header clicked or empty space
⋮----
// Cell clicked - CurrentCellChanged handles the edit mode if cell changes.
// But if we tap the SAME cell, CurrentCellChanged might not fire.
// So we ensure edit mode here too.
Debug.WriteLine("[ManualEntryView] Tapped: Cell clicked. Enqueuing BeginEdit.");
grid.DispatcherQueue.TryEnqueue(() =>
⋮----
Debug.WriteLine($"[ManualEntryView] Tapped: BeginEdit for Row={grid.SelectedIndex}, Col={grid.CurrentColumn.Header}");
⋮----
private void SelectFirstEditableCell(DataGrid grid)
⋮----
Debug.WriteLine("[ManualEntryView] SelectFirstEditableCell: Starting");
⋮----
// Find first non-readonly column
var firstEditable = grid.Columns.OrderBy(c => c.DisplayIndex).FirstOrDefault(c => !c.IsReadOnly);
⋮----
Debug.WriteLine($"[ManualEntryView] SelectFirstEditableCell: Found editable column {firstEditable.Header}. Setting CurrentColumn and calling BeginEdit.");
⋮----
grid.Focus(Microsoft.UI.Xaml.FocusState.Programmatic);
⋮----
Debug.WriteLine($"[ManualEntryView] SelectFirstEditableCell: BeginEdit called for column {firstEditable.Header}");
⋮----
Debug.WriteLine("[ManualEntryView] SelectFirstEditableCell: No editable column found.");
⋮----
Debug.WriteLine($"[ManualEntryView] SelectFirstEditableCell: Grid has no items (Count={itemCount})");
</file>

<file path="Module_Receiving/Views/View_Receiving_ModeSelection.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_ModeSelection"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:MTM_Receiving_Application.Module_Receiving.ViewModels"
    mc:Ignorable="d">

    <Grid>
        <StackPanel Spacing="32" HorizontalAlignment="Center" VerticalAlignment="Center">
            <StackPanel Orientation="Horizontal" Spacing="24">
                <!-- Guided Mode Column -->
                <StackPanel Spacing="12">
                    <Button Command="{x:Bind ViewModel.SelectGuidedModeCommand}"
                            Width="280" Height="180"
                            Padding="20"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            AutomationProperties.Name="Guided Wizard Mode">
                        <StackPanel Spacing="12">
                            <FontIcon Glyph="&#xE771;" FontSize="48" Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                            <TextBlock Text="Guided Wizard" Style="{StaticResource SubtitleTextBlockStyle}" HorizontalAlignment="Center"/>
                            <TextBlock Text="Step-by-step process for standard receiving workflow." 
                                       Style="{StaticResource BodyTextBlockStyle}" 
                                       TextWrapping="Wrap" 
                                       TextAlignment="Center"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Guided Mode Checkbox -->
                    <CheckBox Content="Set as default mode"
                              IsChecked="{x:Bind ViewModel.IsGuidedModeDefault, Mode=TwoWay}"
                              Command="{x:Bind ViewModel.SetGuidedAsDefaultCommand}"
                              CommandParameter="{Binding IsChecked, RelativeSource={RelativeSource Self}}"
                              HorizontalAlignment="Center"
                              ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.QuickGuidedWizard'), Mode=OneWay}"/>
                </StackPanel>

                <!-- Manual Mode Column -->
                <StackPanel Spacing="12">
                    <Button Command="{x:Bind ViewModel.SelectManualModeCommand}"
                            Width="280" Height="180"
                            Padding="20"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            AutomationProperties.Name="Manual Entry Mode">
                        <StackPanel Spacing="12">
                            <FontIcon Glyph="&#xE7F0;" FontSize="48" Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                            <TextBlock Text="Manual Entry" Style="{StaticResource SubtitleTextBlockStyle}" HorizontalAlignment="Center"/>
                            <TextBlock Text="Customizable grid for bulk data entry and editing." 
                                       Style="{StaticResource BodyTextBlockStyle}" 
                                       TextWrapping="Wrap" 
                                       TextAlignment="Center"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Manual Mode Checkbox -->
                    <CheckBox Content="Set as default mode"
                              IsChecked="{x:Bind ViewModel.IsManualModeDefault, Mode=TwoWay}"
                              Command="{x:Bind ViewModel.SetManualAsDefaultCommand}"
                              CommandParameter="{Binding IsChecked, RelativeSource={RelativeSource Self}}"
                              HorizontalAlignment="Center"
                              ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.QuickManualEntry'), Mode=OneWay}"/>
                </StackPanel>

                <!-- Edit Mode Column -->
                <StackPanel Spacing="12">
                    <Button Command="{x:Bind ViewModel.SelectEditModeCommand}"
                            Width="280" Height="180"
                            Padding="20"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            AutomationProperties.Name="Edit Mode">
                        <StackPanel Spacing="12">
                            <FontIcon Glyph="&#xE70F;" FontSize="48" Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                            <TextBlock Text="Edit Mode" Style="{StaticResource SubtitleTextBlockStyle}" HorizontalAlignment="Center"/>
                            <TextBlock Text="Edit existing loads without adding new ones." 
                                       Style="{StaticResource BodyTextBlockStyle}" 
                                       TextWrapping="Wrap" 
                                       TextAlignment="Center"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Edit Mode Checkbox -->
                    <CheckBox Content="Set as default mode"
                              IsChecked="{x:Bind ViewModel.IsEditModeDefault, Mode=TwoWay}"
                              Command="{x:Bind ViewModel.SetEditAsDefaultCommand}"
                              CommandParameter="{Binding IsChecked, RelativeSource={RelativeSource Self}}"
                              HorizontalAlignment="Center"
                              ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.QuickEditMode'), Mode=OneWay}"/>
                </StackPanel>
            </StackPanel>
        </StackPanel>
    </Grid>
</UserControl>
</file>

<file path="Module_Receiving/Views/View_Receiving_ModeSelection.xaml.cs">
public sealed partial class View_Receiving_ModeSelection : UserControl
⋮----
this.InitializeComponent();
</file>

<file path="Module_Receiving/Views/View_Receiving_PackageType.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_PackageType"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:Converter_StringFormat x:Key="StringFormatConverter"/>
        <converters:Converter_BooleanToVisibility x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid Padding="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Package Type Selection -->
        <Border Grid.Row="1"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                Padding="20"
                CornerRadius="8"
                VerticalAlignment="Top"
                Margin="0,0,0,16">
            <StackPanel Spacing="16">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE7B8;" FontSize="16" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                    <TextBlock Text="Package Type (Applied to all loads)" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                </StackPanel>
                
                <StackPanel Orientation="Horizontal" Spacing="16">
                    <ComboBox x:Name="PackageTypeComboBox"
                              Header="Type"
                              ItemsSource="{x:Bind ViewModel.PackageTypes, Mode=OneWay}"
                              SelectedItem="{x:Bind ViewModel.SelectedPackageType, Mode=TwoWay}"
                              Width="200"
                              AutomationProperties.Name="Package Type"/>
                    
                    <TextBox Header="Custom Name"
                             Text="{x:Bind ViewModel.CustomPackageTypeName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Visibility="{x:Bind ViewModel.IsCustomTypeVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                             Width="200"
                             AutomationProperties.Name="Custom Package Name"/>
                </StackPanel>
                
                <CheckBox Content="Save as default for this part" 
                          IsChecked="{x:Bind ViewModel.IsSaveAsDefault, Mode=TwoWay}"/>
            </StackPanel>
        </Border>

        <!-- Loads List -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{x:Bind ViewModel.Loads, Mode=OneWay}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="0,0,0,8" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" Padding="16,12" CornerRadius="8" BorderThickness="1" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100"/>
                                <ColumnDefinition Width="250"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE7B8;" FontSize="14" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                    <TextBlock Text="{Binding LoadNumber, Converter={StaticResource StringFormatConverter}, ConverterParameter='#{0}'}" 
                                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <NumberBox Grid.Column="1"
                                       Header="Packages per Load"
                                       Value="{Binding PackagesPerLoad, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                       Minimum="1"
                                       SmallChange="1"
                                       LargeChange="5"
                                       SpinButtonPlacementMode="Inline"
                                       AutomationProperties.Name="Packages per Load"/>
                                       
                            <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="16,0,0,0">
                                <TextBlock Text="Weight per Package" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <TextBlock Text="{Binding WeightPerPackage, Converter={StaticResource StringFormatConverter}, ConverterParameter='{}{0:N2} lbs'}" 
                                           Style="{StaticResource BodyStrongTextBlockStyle}"/>
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>
</file>

<file path="Module_Receiving/Views/View_Receiving_PackageType.xaml.cs">
public sealed partial class View_Receiving_PackageType : UserControl
⋮----
private readonly IService_Focus _focusService;
⋮----
this.InitializeComponent();
⋮----
_focusService.AttachFocusOnVisibility(this, PackageTypeComboBox);
⋮----
private async void PackageTypeView_Loaded(object sender, RoutedEventArgs e)
⋮----
await ViewModel.OnNavigatedToAsync();
</file>

<file path="Module_Receiving/Views/View_Receiving_POEntry.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_POEntry"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:Converter_BooleanToVisibility x:Key="BooleanToVisibilityConverter"/>
        <converters:Converter_DecimalToInt x:Key="DecimalToIntConverter"/>
    </UserControl.Resources>

    <Grid Padding="24" RowSpacing="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Input Section (Row 0) -->
        <Grid Grid.Row="0">
            <!-- PO Entry Mode -->
            <StackPanel Visibility="{x:Bind ViewModel.IsNonPOItem, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}">
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20">
                    <StackPanel Spacing="16">
                        <!-- PO Number Input with Icon -->
                        <StackPanel Spacing="8">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE8A5;" 
                                         FontSize="16"
                                         Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                <TextBlock Text="Purchase Order Number" 
                                          Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                            </StackPanel>
                            
                            <TextBox x:Name="PoNumberTextBox"
                                    Text="{x:Bind ViewModel.PoNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                    PlaceholderText="{x:Bind ViewModel.GetPlaceholder('Field.PONumber'), Mode=OneWay}"
                                    MaxWidth="400"
                                    HorizontalAlignment="Stretch"
                                    TabIndex="0"
                                    LostFocus="POTextBox_LostFocus"
                                    AutomationProperties.Name="Purchase Order Number"/>
                            
                            <!-- Validation Message -->
                            <TextBlock Text="{x:Bind ViewModel.PoValidationMessage, Mode=OneWay}" 
                                      Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                      FontSize="12"
                                      Visibility="{x:Bind ViewModel.IsLoadPOEnabled, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}"/>
                            
                            <!-- PO Status Display -->
                            <Border BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="8,4"
                                    Margin="0,8,0,0"
                                    Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE8C9;" FontSize="14"/>
                                    <TextBlock Text="Status:" FontWeight="SemiBold" FontSize="12"/>
                                    <TextBlock Text="{x:Bind ViewModel.PoStatusDescription, Mode=OneWay}" 
                                              FontSize="12"
                                              FontWeight="SemiBold"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Action Buttons -->
                        <Grid ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <Button Grid.Column="0"
                                   Command="{x:Bind ViewModel.LoadPOCommand}" 
                                   IsEnabled="{x:Bind ViewModel.IsLoadPOEnabled, Mode=OneWay}"
                                   Style="{StaticResource AccentButtonStyle}"
                                   AutomationProperties.Name="Load Purchase Order"
                                   ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.LoadPO'), Mode=OneWay}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE896;" FontSize="16"/>
                                    <TextBlock Text="Load PO"/>
                                </StackPanel>
                            </Button>
                            
                            <Button Grid.Column="1"
                                   Content="Switch to Non-PO" 
                                   Command="{x:Bind ViewModel.ToggleNonPOCommand}"
                                   ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.SwitchToNonPO'), Mode=OneWay}"/>
                        </Grid>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Non-PO Entry Mode -->
            <StackPanel Visibility="{x:Bind ViewModel.IsNonPOItem, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20">
                    <StackPanel Spacing="16">
                        <!-- Part ID Input with Icon -->
                        <StackPanel Spacing="8">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE8B7;" 
                                         FontSize="16"
                                         Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                <TextBlock Text="Part Identifier" 
                                          Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                            </StackPanel>
                            
                            <TextBox x:Name="PartIDTextBox"
                                    Text="{x:Bind ViewModel.PartID, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                    PlaceholderText="{x:Bind ViewModel.GetPlaceholder('Field.PartID'), Mode=OneWay}"
                                    MaxWidth="400"
                                    HorizontalAlignment="Stretch"
                                    AutomationProperties.Name="Part Identifier"/>
                        </StackPanel>

                        <!-- Package Type Display (Auto-detected) -->
                        <StackPanel Spacing="8">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE7B8;" 
                                         FontSize="16"
                                         Foreground="{ThemeResource AccentTextFillColorSecondaryBrush}"/>
                                <TextBlock Text="Package Type (Auto-detected)" 
                                          Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                            </StackPanel>
                            
                            <TextBlock Text="{x:Bind ViewModel.PackageType, Mode=OneWay}"
                                      Style="{ThemeResource SubtitleTextBlockStyle}"
                                      Foreground="{ThemeResource SystemAccentColor}"/>
                        </StackPanel>

                        <!-- Action Buttons -->
                        <Grid ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <Button Grid.Column="0"
                                   Command="{x:Bind ViewModel.LookupPartCommand}" 
                                   Style="{StaticResource AccentButtonStyle}"
                                   AutomationProperties.Name="Look Up Part"
                                   ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.LookupPart'), Mode=OneWay}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE721;" FontSize="16"/>
                                    <TextBlock Text="Look Up Part"/>
                                </StackPanel>
                            </Button>
                            
                            <Button Grid.Column="1"
                                   Content="Switch to PO Entry" 
                                   Command="{x:Bind ViewModel.ToggleNonPOCommand}"
                                   ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.SwitchToPO'), Mode=OneWay}"/>
                        </Grid>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>

        <!-- Loading Indicator -->
        <ProgressBar Grid.Row="0" 
                    IsIndeterminate="True" 
                    VerticalAlignment="Bottom"
                    Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                    Margin="0,0,0,-10"/>

        <!-- Parts Grid Section (Row 1) -->
        <Border Grid.Row="1" 
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="16"
                Visibility="{x:Bind ViewModel.IsPartsListVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" Margin="0,0,0,12">
                    <FontIcon Glyph="&#xE8FD;" 
                             FontSize="16"
                             Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                    <TextBlock Text="Available Parts" 
                              Style="{ThemeResource SubtitleTextBlockStyle}"/>
                </StackPanel>
                
                <controls:DataGrid Grid.Row="1"
                                  ItemsSource="{x:Bind ViewModel.Parts, Mode=OneWay}"
                                  SelectedItem="{x:Bind ViewModel.SelectedPart, Mode=TwoWay}"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column"
                                  SelectionMode="Single"
                                  AutomationProperties.Name="Parts List">
                    <controls:DataGrid.Columns>
                        <controls:DataGridTextColumn Header="Part ID" 
                                                    Binding="{Binding PartID}" 
                                                    Width="150"/>
                        <controls:DataGridTextColumn Header="Description" 
                                                    Binding="{Binding Description}" 
                                                    Width="*"/>
                        <controls:DataGridTextColumn Header="Remaining Qty" 
                                                    Binding="{Binding RemainingQuantity}" 
                                                    Width="120"/>
                        <controls:DataGridTextColumn Header="Qty Ordered" 
                                                    Binding="{Binding QtyOrdered, Converter={StaticResource DecimalToIntConverter}}" 
                                                    Width="120"/>
                        <controls:DataGridTextColumn Header="Line #" 
                                                    Binding="{Binding POLineNumber}" 
                                                    Width="80"/>
                    </controls:DataGrid.Columns>
                </controls:DataGrid>
            </Grid>
        </Border>
    </Grid>
</UserControl>
</file>

<file path="Module_Receiving/Views/View_Receiving_POEntry.xaml.cs">
public sealed partial class View_Receiving_POEntry : UserControl
⋮----
private readonly IService_Focus _focusService;
⋮----
this.InitializeComponent();
⋮----
_focusService.AttachFocusOnVisibility(this, PoNumberTextBox);
⋮----
private void POTextBox_LostFocus(object sender, RoutedEventArgs e)
⋮----
// Trigger auto-correction command
ViewModel.PoTextBoxLostFocusCommand.Execute(null);
</file>

<file path="Module_Receiving/Views/View_Receiving_Review.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_Review"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d"
    Loaded="UserControl_Loaded">

    <UserControl.Resources>
        <converters:Converter_BooleanToVisibility x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Content Section with View Toggle -->
        <Grid Grid.Row="1">
            <!-- Single Entry View -->
            <Grid Visibility="{x:Bind ViewModel.IsSingleView, Mode=OneWay}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Entry Counter -->
                <Border Grid.Row="0" 
                       Background="{ThemeResource AccentFillColorDefaultBrush}"
                       Padding="12,6"
                       CornerRadius="8,8,0,0">
                    <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                        <FontIcon Glyph="&#xE8FD;" 
                                 FontSize="16"
                                 Foreground="White"/>
                        <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}"
                                  Foreground="White">
                            <Run Text="Entry"/>
                            <Run Text="{x:Bind ViewModel.DisplayIndex, Mode=OneWay}" 
                                 FontWeight="Bold"/>
                            <Run Text="of"/>
                            <Run Text="{x:Bind ViewModel.Loads.Count, Mode=OneWay}" 
                                 FontWeight="Bold"/>
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Single Entry Form -->
                <Grid Grid.Row="1">
                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                           BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                           BorderThickness="1,0,1,1"
                           CornerRadius="0,0,8,8"
                           Padding="20">
                        <Grid MaxWidth="900">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0" Spacing="12" Margin="0,0,12,0">
                            <!-- Load Number (Read-only) -->
                            <StackPanel Spacing="8">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE7B8;" 
                                             FontSize="14"
                                             Foreground="{ThemeResource AccentTextFillColorSecondaryBrush}"/>
                                    <TextBlock Text="Load Number" 
                                              Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                                <TextBox Text="{x:Bind ViewModel.CurrentEntry.LoadNumber, Mode=OneWay}" 
                                        IsReadOnly="True"
                                        Background="{ThemeResource ControlFillColorDisabledBrush}"/>
                            </StackPanel>

                            <!-- PO Number -->
                            <StackPanel Spacing="8">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE8A5;" 
                                             FontSize="14"
                                             Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                    <TextBlock Text="Purchase Order Number" 
                                              Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                                <TextBox Text="{x:Bind ViewModel.CurrentEntry.PoNumber, Mode=OneWay}" 
                                        IsReadOnly="True"/>
                            </StackPanel>

                            <!-- Part ID -->
                            <StackPanel Spacing="8">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE8B7;" 
                                             FontSize="14"
                                             Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                    <TextBlock Text="Part ID" 
                                              Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                                <TextBox Text="{x:Bind ViewModel.CurrentEntry.PartID, Mode=OneWay}" 
                                        IsReadOnly="True"/>
                            </StackPanel>

                            <!-- Remaining Quantity -->
                            <StackPanel Spacing="8">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE9F9;" 
                                             FontSize="14"
                                             Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                    <TextBlock Text="Remaining Quantity" 
                                              Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                                <TextBox Text="{x:Bind ViewModel.CurrentEntry.RemainingQuantity, Mode=OneWay}" 
                                        IsReadOnly="True"
                                        Foreground="{ThemeResource SystemAccentColor}"
                                        FontWeight="SemiBold"/>
                            </StackPanel>

                            <!-- Weight/Quantity -->
                            <StackPanel Spacing="8">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xEA8B;" 
                                             FontSize="14"
                                             Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                    <TextBlock Text="Weight/Quantity" 
                                              Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                                <TextBox Text="{x:Bind ViewModel.CurrentEntry.WeightQuantity, Mode=OneWay}" 
                                        IsReadOnly="True"/>
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Spacing="12" Margin="12,0,0,0">
                            <!-- Heat/Lot Number -->
                            <StackPanel Spacing="8">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE8B4;" 
                                             FontSize="14"
                                             Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                    <TextBlock Text="Heat/Lot Number" 
                                              Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                                <TextBox Text="{x:Bind ViewModel.CurrentEntry.HeatLotNumber, Mode=OneWay}" 
                                        IsReadOnly="True"/>
                            </StackPanel>

                            <!-- Packages Per Load -->
                            <StackPanel Spacing="8">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE7B8;" 
                                             FontSize="14"
                                             Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                    <TextBlock Text="Packages Per Load" 
                                              Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                                <TextBox Text="{x:Bind ViewModel.CurrentEntry.PackagesPerLoad, Mode=OneWay}" 
                                        IsReadOnly="True"/>
                            </StackPanel>

                            <!-- Package Type -->
                            <StackPanel Spacing="8">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE7B8;" 
                                             FontSize="14"
                                             Foreground="{ThemeResource AccentTextFillColorSecondaryBrush}"/>
                                    <TextBlock Text="Package Type" 
                                              Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                                <TextBox Text="{x:Bind ViewModel.CurrentEntry.PackageTypeName, Mode=OneWay}" 
                                        IsReadOnly="True"/>
                            </StackPanel>
                        </StackPanel>
                        </Grid>
                    </Border>
                </Grid>

                <!-- Navigation Bar for Single View -->
                <CommandBar Grid.Row="2" DefaultLabelPosition="Right" Margin="0,12,0,0">
                    <AppBarButton Icon="Back" 
                                 Label="Previous" 
                                 Command="{x:Bind ViewModel.PreviousEntryCommand}"
                                 IsEnabled="{x:Bind ViewModel.CanGoBack, Mode=OneWay}"
                                 AutomationProperties.Name="Previous Entry"/>
                    
                    <AppBarButton Icon="Forward" 
                                 Label="Next" 
                                 Command="{x:Bind ViewModel.NextEntryCommand}"
                                 IsEnabled="{x:Bind ViewModel.CanGoNext, Mode=OneWay}"
                                 AutomationProperties.Name="Next Entry"/>
                    
                    <AppBarSeparator/>
                    
                    <AppBarButton Icon="ViewAll" 
                                 Label="Table View" 
                                 Command="{x:Bind ViewModel.SwitchToTableViewCommand}"
                                 AutomationProperties.Name="Switch to Table View"/>
                </CommandBar>
            </Grid>

            <!-- Table View (DataGrid) -->
            <Grid Visibility="{x:Bind ViewModel.IsTableView, Mode=OneWay}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0"
                       Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                       BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                       BorderThickness="1"
                       CornerRadius="8"
                       Padding="16">
                    <controls:DataGrid x:Name="ReviewDataGrid"
                                      ItemsSource="{x:Bind ViewModel.Loads, Mode=OneWay}"
                                      AutoGenerateColumns="False"
                                      GridLinesVisibility="Horizontal"
                                      HeadersVisibility="Column"
                                      CanUserSortColumns="False"
                                      SelectionMode="Single"
                                      AutomationProperties.Name="Receiving Entries Table">
                        <controls:DataGrid.Columns>
                            <controls:DataGridTextColumn Header="Load #" 
                                                        Binding="{Binding LoadNumber}" 
                                                        IsReadOnly="True" 
                                                        Width="80"/>
                            <controls:DataGridTextColumn Header="PO Number" 
                                                        Binding="{Binding PoNumber, TargetNullValue='N/A'}" 
                                                        Width="120"/>
                            <controls:DataGridTextColumn Header="Part ID" 
                                                        Binding="{Binding PartID}" 
                                                        Width="150"/>
                            <controls:DataGridTextColumn Header="Remaining Qty" 
                                                        Binding="{Binding RemainingQuantity}" 
                                                        Width="120"/>
                            <controls:DataGridTextColumn Header="Weight/Qty" 
                                                        Binding="{Binding WeightQuantity}" 
                                                        Width="120"/>
                            <controls:DataGridTextColumn Header="Heat/Lot #" 
                                                        Binding="{Binding HeatLotNumber}" 
                                                        Width="150"/>
                            <controls:DataGridTextColumn Header="Pkgs" 
                                                        Binding="{Binding PackagesPerLoad}" 
                                                        Width="80"/>
                            <controls:DataGridTextColumn Header="Pkg Type" 
                                                        Binding="{Binding PackageTypeName}" 
                                                        Width="100"/>
                        </controls:DataGrid.Columns>
                    </controls:DataGrid>
                </Border>

                <!-- Navigation Bar for Table View -->
                <CommandBar Grid.Row="1" DefaultLabelPosition="Right" Margin="0,16,0,0">
                    <AppBarButton Label="Single View" 
                                 Command="{x:Bind ViewModel.SwitchToSingleViewCommand}"
                                 AutomationProperties.Name="Switch to Single View">
                        <AppBarButton.Icon>
                            <FontIcon Glyph="&#xE8A9;"/>
                        </AppBarButton.Icon>
                    </AppBarButton>
                </CommandBar>
            </Grid>
        </Grid>

        <!-- Action Buttons -->
        <Grid Grid.Row="2" ColumnSpacing="12" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="1" 
                   Command="{x:Bind ViewModel.AddAnotherPartCommand}"
                   AutomationProperties.Name="Add Another Part or PO"
                   ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.AddAnother'), Mode=OneWay}">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE710;" FontSize="16"/>
                    <TextBlock Text="Add Another Part/PO"/>
                </StackPanel>
            </Button>
            
            <Button Grid.Column="2" 
                   Command="{x:Bind ViewModel.SaveCommand}"
                   Style="{StaticResource AccentButtonStyle}"
                   AutomationProperties.Name="Save to Database"
                   ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.SaveAndGenerate'), Mode=OneWay}">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE74E;" FontSize="16"/>
                    <TextBlock Text="Save to Database"/>
                </StackPanel>
            </Button>
        </Grid>
    </Grid>
</UserControl>
</file>

<file path="Module_Receiving/Views/View_Receiving_Review.xaml.cs">
public sealed partial class View_Receiving_Review : UserControl
⋮----
this.InitializeComponent();
⋮----
private async void UserControl_Loaded(object sender, RoutedEventArgs e)
⋮----
await ViewModel.OnNavigatedToAsync();
</file>

<file path="Module_Receiving/Views/View_Receiving_WeightQuantity.xaml">
<UserControl
    x:Class="MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_WeightQuantity"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:Converter_StringFormat x:Key="StringFormatConverter"/>
        <converters:Converter_IntToVisibility x:Key="IntToVisibilityConverter"/>
        <converters:Converter_DoubleToDecimal x:Key="DoubleToDecimalConverter"/>
    </UserControl.Resources>

    <Grid Padding="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Info Header -->
        <Border Grid.Row="0" 
                Background="{ThemeResource AccentFillColorDefaultBrush}"
                Padding="16,12"
                CornerRadius="8"
                Margin="0,0,0,12">
            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                <FontIcon Glyph="&#xEA8B;" FontSize="16" Foreground="White"/>
                <TextBlock Text="{x:Bind ViewModel.PoQuantityInfo, Mode=OneWay}" 
                           Style="{StaticResource BodyStrongTextBlockStyle}"
                           Foreground="White"/>
            </StackPanel>
        </Border>

        <!-- Warning Banner -->
        <InfoBar Grid.Row="1"
                 IsOpen="{x:Bind ViewModel.HasWarning, Mode=OneWay}"
                 Severity="Warning"
                 Message="{x:Bind ViewModel.WarningMessage, Mode=OneWay}"
                 IsClosable="False"
                 Margin="0,0,0,12"/>

        <!-- Loads List with Fixed Height -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{x:Bind ViewModel.Loads, Mode=OneWay}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="0,0,0,8" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" Padding="16,12" CornerRadius="8" BorderThickness="1" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE7B8;" FontSize="14" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                    <TextBlock Text="{Binding LoadNumber, Converter={StaticResource StringFormatConverter}, ConverterParameter='Load #{0}'}" 
                                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <NumberBox Grid.Column="1"
                                       Header="Weight/Quantity"
                                       Value="{Binding WeightQuantity, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DoubleToDecimalConverter}}"
                                       Minimum="0"
                                       SmallChange="1"
                                       LargeChange="10"
                                       SpinButtonPlacementMode="Inline"
                                      PlaceholderText="Enter whole number"
                                       AutomationProperties.Name="Weight Quantity"/>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>
</file>

<file path="Module_Receiving/Views/View_Receiving_WeightQuantity.xaml.cs">
public sealed partial class View_Receiving_WeightQuantity : UserControl
⋮----
private readonly IService_Focus _focusService;
⋮----
this.InitializeComponent();
⋮----
_focusService.AttachFocusOnVisibility(this);
⋮----
private async void WeightQuantityView_Loaded(object sender, RoutedEventArgs e)
⋮----
await ViewModel.OnNavigatedToAsync();
</file>

<file path="Module_Receiving/Views/View_Receiving_Workflow.xaml">
<Page
    x:Class="MTM_Receiving_Application.Module_Receiving.Views.View_Receiving_Workflow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:MTM_Receiving_Application.Module_Receiving.ViewModels"
    xmlns:views="using:MTM_Receiving_Application.Module_Receiving.Views"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:Converter_BooleanToVisibility x:Key="BooleanToVisibilityConverter"/>
        <converters:Converter_BoolToString x:Key="BoolToStringConverter"/>
        <converters:Converter_StringFormat x:Key="StringFormatConverter"/>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Content Area -->
        <Grid Grid.Row="1" Margin="16,12,16,16">
            <!-- Mode Selection View -->
            <views:View_Receiving_ModeSelection Visibility="{x:Bind ViewModel.IsModeSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            
            <!-- Manual Entry View -->
            <views:View_Receiving_ManualEntry Visibility="{x:Bind ViewModel.IsManualEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>

            <!-- Edit Mode View -->
            <views:View_Receiving_EditMode Visibility="{x:Bind ViewModel.IsEditModeVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>

            <!-- PO Entry View -->
            <views:View_Receiving_POEntry Visibility="{x:Bind ViewModel.IsPOEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            <views:View_Receiving_LoadEntry Visibility="{x:Bind ViewModel.IsLoadEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            <views:View_Receiving_WeightQuantity Visibility="{x:Bind ViewModel.IsWeightQuantityEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            <views:View_Receiving_HeatLot Visibility="{x:Bind ViewModel.IsHeatLotEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            <views:View_Receiving_PackageType Visibility="{x:Bind ViewModel.IsPackageTypeEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            <views:View_Receiving_Review Visibility="{x:Bind ViewModel.IsReviewVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            
            <!-- Saving Progress -->
            <StackPanel Visibility="{x:Bind ViewModel.IsSavingVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                        VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="16">
                <ProgressRing IsActive="True" Width="64" Height="64"/>
                <TextBlock Text="{x:Bind ViewModel.SaveProgressMessage, Mode=OneWay}" 
                           Style="{StaticResource SubtitleTextBlockStyle}"
                           HorizontalAlignment="Center"/>
                <ProgressBar Value="{x:Bind ViewModel.SaveProgressValue, Mode=OneWay}" Maximum="100" Width="300"/>
            </StackPanel>

            <!-- Completion Summary -->
            <StackPanel Visibility="{x:Bind ViewModel.IsCompleteVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                        VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="24" MaxWidth="600">
                
                <FontIcon Glyph="&#xE930;" FontSize="64" Foreground="{ThemeResource SystemFillColorSuccessBrush}" 
                          Visibility="{x:Bind ViewModel.LastSaveResult.Success, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                <FontIcon Glyph="&#xE783;" FontSize="64" Foreground="{ThemeResource SystemFillColorCriticalBrush}" 
                          Visibility="{x:Bind ViewModel.LastSaveResult.Success, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter='Inverse'}"/>

                <TextBlock Text="Success!" 
                           Style="{StaticResource TitleTextBlockStyle}" HorizontalAlignment="Center"
                           Visibility="{x:Bind ViewModel.LastSaveResult.Success, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                <TextBlock Text="Save Failed" 
                           Style="{StaticResource TitleTextBlockStyle}" HorizontalAlignment="Center"
                           Visibility="{x:Bind ViewModel.LastSaveResult.Success, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter='Inverse'}"/>

                <TextBlock Style="{StaticResource BodyStrongTextBlockStyle}" HorizontalAlignment="Center">
                    <Run Text="{x:Bind ViewModel.LastSaveResult.LoadsSaved, Mode=OneWay}"/>
                    <Run Text=" loads saved successfully."/>
                </TextBlock>

                <StackPanel Spacing="8" Background="{ThemeResource LayerFillColorDefaultBrush}" Padding="16" CornerRadius="8">
                    <TextBlock Text="Save Details:" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="Local CSV:"/>
                        <TextBlock Text="Saved" Foreground="Green" Visibility="{x:Bind ViewModel.LastSaveResult.LocalCSVSuccess, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        <TextBlock Text="Failed" Foreground="Red" Visibility="{x:Bind ViewModel.LastSaveResult.LocalCSVSuccess, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter='Inverse'}"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="Network CSV:"/>
                        <TextBlock Text="Saved" Foreground="Green" Visibility="{x:Bind ViewModel.LastSaveResult.NetworkCSVSuccess, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        <TextBlock Text="Failed" Foreground="Red" Visibility="{x:Bind ViewModel.LastSaveResult.NetworkCSVSuccess, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter='Inverse'}"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="Database:"/>
                        <TextBlock Text="Saved" Foreground="Green" Visibility="{x:Bind ViewModel.LastSaveResult.DatabaseSuccess, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        <TextBlock Text="Failed" Foreground="Red" Visibility="{x:Bind ViewModel.LastSaveResult.DatabaseSuccess, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter='Inverse'}"/>
                    </StackPanel>
                </StackPanel>
                
                <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Center">
                    <Button Content="Start New Entry" Command="{x:Bind ViewModel.StartNewEntryCommand}" Style="{StaticResource AccentButtonStyle}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.StartNew'), Mode=OneWay}"/>
                    <Button Content="Reset CSV" Command="{x:Bind ViewModel.ResetCSVCommand}" ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.ResetCSV'), Mode=OneWay}"/>
                </StackPanel>
            </StackPanel>
        </Grid>

        <!-- Navigation Buttons -->
        <Grid Grid.Row="2" Margin="24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <!-- Left-aligned buttons -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left" Spacing="12">
                <Button Content="Mode Selection" 
                        Command="{x:Bind ViewModel.ReturnToModeSelectionCommand}"
                        Background="Transparent" 
                        BorderBrush="{ThemeResource SystemAccentColor}"/>
                <Button Content="Reset CSV" 
                        Command="{x:Bind ViewModel.ResetCSVCommand}" 
                        Visibility="{x:Bind ViewModel.IsModeSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter='Inverse'}"
                        Background="Transparent" 
                        BorderBrush="Transparent" 
                        Foreground="Red"
                        ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.ResetCSV'), Mode=OneWay}"/>
            </StackPanel>
            
            <!-- Center help button -->
            <Button Grid.Column="0"
                    Grid.ColumnSpan="2"
                    Canvas.ZIndex="1000"
                    HorizontalAlignment="Center"
                    Click="HelpButton_Click"
                    Style="{StaticResource AccentButtonStyle}"
                    Padding="12,8"
                    ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.StepHelp'), Mode=OneWay}">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE946;" FontSize="16"/>
                    <TextBlock Text="Help"/>
                </StackPanel>
            </Button>
            
            <!-- Right-aligned navigation buttons -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="12">
                <Button Content="Back" Command="{x:Bind ViewModel.PreviousStepCommand}"/>
                <Button Content="Next" Command="{x:Bind ViewModel.NextStepCommand}" Style="{StaticResource AccentButtonStyle}"/>
            </StackPanel>
        </Grid>
    </Grid>
</Page>
</file>

<file path="Module_Receiving/Views/View_Receiving_Workflow.xaml.cs">
public sealed partial class View_Receiving_Workflow : Page
⋮----
this.InitializeComponent();
⋮----
private async void HelpButton_Click(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
⋮----
await _helpService.ShowContextualHelpAsync(_workflowService.CurrentStep);
⋮----
protected override void OnNavigatedTo(NavigationEventArgs e)
⋮----
base.OnNavigatedTo(e);
⋮----
// Check for default mode and skip mode selection if set
// Only do this if we're starting fresh (on ModeSelection step)
⋮----
// Only apply default mode if we're on the mode selection screen
// and there's a valid user session
⋮----
if (!string.IsNullOrEmpty(defaultMode))
⋮----
// User has a default mode set - go directly to that mode
⋮----
workflowService.GoToStep(Enum_ReceivingWorkflowStep.POEntry);
⋮----
workflowService.GoToStep(Enum_ReceivingWorkflowStep.ManualEntry);
⋮----
// If defaultMode is null or conditions not met, stay on current step
</file>

<file path="Module_Reporting/Views/View_Reporting_Main.xaml">
<Page
    x:Class="MTM_Receiving_Application.Module_Reporting.Views.View_Reporting_Main"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,24">
            <TextBlock 
                Text="{x:Bind ViewModel.Title, Mode=OneWay}" 
                Style="{StaticResource TitleTextBlockStyle}"/>
            <TextBlock 
                Text="Select date range and modules to generate end-of-day reports" 
                Style="{StaticResource BodyTextBlockStyle}"
                Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
        </StackPanel>

        <!-- Date Range Selection -->
        <StackPanel Grid.Row="1" Spacing="12" Margin="0,0,0,24">
            <TextBlock Text="Date Range" Style="{StaticResource SubtitleTextBlockStyle}"/>
            <Grid ColumnSpacing="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <CalendarDatePicker 
                    Grid.Column="0"
                    Header="Start Date"
                    Date="{x:Bind ViewModel.StartDate, Mode=TwoWay}"
                    HorizontalAlignment="Stretch"/>

                <CalendarDatePicker 
                    Grid.Column="1"
                    Header="End Date"
                    Date="{x:Bind ViewModel.EndDate, Mode=TwoWay}"
                    HorizontalAlignment="Stretch"/>

                <Button 
                    Grid.Column="2"
                    Content="Check Availability"
                    Command="{x:Bind ViewModel.CheckAvailabilityCommand}"
                    Style="{StaticResource AccentButtonStyle}"
                    VerticalAlignment="Bottom"
                    Margin="0,0,0,4"/>
            </Grid>
        </StackPanel>

        <!-- Module Selection -->
        <StackPanel Grid.Row="2" Spacing="12" Margin="0,0,0,24">
            <TextBlock Text="Select Modules" Style="{StaticResource SubtitleTextBlockStyle}"/>
            <Grid ColumnSpacing="24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Spacing="4">
                    <CheckBox 
                        Content="Receiving"
                        IsChecked="{x:Bind ViewModel.IsReceivingChecked, Mode=TwoWay}"
                        IsEnabled="{x:Bind ViewModel.IsReceivingEnabled, Mode=OneWay}"/>
                    <TextBlock 
                        Text="{x:Bind ViewModel.ReceivingCount, Mode=OneWay}"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                        Margin="28,0,0,0"
                        FontSize="12"/>
                    <Button 
                        Content="Generate Report"
                        Command="{x:Bind ViewModel.GenerateReceivingReportCommand}"
                        HorizontalAlignment="Stretch"
                        Margin="0,4,0,0"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Spacing="4">
                    <CheckBox 
                        Content="Dunnage"
                        IsChecked="{x:Bind ViewModel.IsDunnageChecked, Mode=TwoWay}"
                        IsEnabled="{x:Bind ViewModel.IsDunnageEnabled, Mode=OneWay}"/>
                    <TextBlock 
                        Text="{x:Bind ViewModel.DunnageCount, Mode=OneWay}"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                        Margin="28,0,0,0"
                        FontSize="12"/>
                    <Button 
                        Content="Generate Report"
                        Command="{x:Bind ViewModel.GenerateDunnageReportCommand}"
                        HorizontalAlignment="Stretch"
                        Margin="0,4,0,0"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Spacing="4">
                    <CheckBox 
                        Content="Routing"
                        IsChecked="{x:Bind ViewModel.IsRoutingChecked, Mode=TwoWay}"
                        IsEnabled="{x:Bind ViewModel.IsRoutingEnabled, Mode=OneWay}"/>
                    <TextBlock 
                        Text="{x:Bind ViewModel.RoutingCount, Mode=OneWay}"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                        Margin="28,0,0,0"
                        FontSize="12"/>
                    <Button 
                        Content="Generate Report"
                        Command="{x:Bind ViewModel.GenerateRoutingReportCommand}"
                        HorizontalAlignment="Stretch"
                        Margin="0,4,0,0"/>
                </StackPanel>

                <StackPanel Grid.Column="3" Spacing="4">
                    <CheckBox 
                        Content="Volvo"
                        IsChecked="{x:Bind ViewModel.IsVolvoChecked, Mode=TwoWay}"
                        IsEnabled="{x:Bind ViewModel.IsVolvoEnabled, Mode=OneWay}"/>
                    <TextBlock 
                        Text="{x:Bind ViewModel.VolvoCount, Mode=OneWay}"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                        Margin="28,0,0,0"
                        FontSize="12"/>
                    <Button 
                        Content="Generate Report"
                        Command="{x:Bind ViewModel.GenerateVolvoReportCommand}"
                        HorizontalAlignment="Stretch"
                        Margin="0,4,0,0"/>
                </StackPanel>
            </Grid>
        </StackPanel>

        <!-- Report Data Grid -->
        <Border 
            Grid.Row="3" 
            BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Padding="12">
            <ScrollViewer>
                <StackPanel Spacing="12">
                    <TextBlock 
                        Text="{x:Bind ViewModel.CurrentModuleName, Mode=OneWay}" 
                        Style="{StaticResource SubtitleTextBlockStyle}"/>
                    
                    <ListView 
                        ItemsSource="{x:Bind ViewModel.ReportData, Mode=OneWay}"
                        SelectionMode="None">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="8">
                                    <StackPanel>
                                        <TextBlock Text="{Binding CreatedDate, Mode=OneWay}" FontWeight="Bold"/>
                                        <TextBlock Text="{Binding PartNumber, Mode=OneWay}"/>
                                        <TextBlock Text="{Binding PONumber, Mode=OneWay}" Foreground="Gray"/>
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Action Buttons -->
        <CommandBar Grid.Row="4" DefaultLabelPosition="Right" Margin="0,12,0,0">
            <AppBarButton 
                Icon="Save" 
                Label="Export to CSV"
                Command="{x:Bind ViewModel.ExportToCSVCommand}"/>
            <AppBarButton 
                Icon="Copy" 
                Label="Copy Email Format"
                Command="{x:Bind ViewModel.CopyEmailFormatCommand}"/>
            <AppBarSeparator/>
            <AppBarButton 
                Icon="Refresh" 
                Label="Check Availability"
                Command="{x:Bind ViewModel.CheckAvailabilityCommand}"/>
        </CommandBar>
    </Grid>
</Page>
</file>

<file path="Module_Reporting/Views/View_Reporting_Main.xaml.cs">
/// <summary>
/// Main page for End-of-Day Reporting module
/// </summary>
public sealed partial class View_Reporting_Main : Page
</file>

<file path="Module_Routing/Enums/Enum_RoutingMode.cs">
/// <summary>
/// Enumeration of routing module operating modes
/// </summary>
⋮----
/// Wizard mode: Step-by-step guided workflow
⋮----
/// Manual entry mode: Grid-based batch entry
⋮----
/// Edit mode: Search and edit existing labels
</file>

<file path="Module_Routing/Views/RoutingWizardContainerView.xaml.cs">
public sealed partial class RoutingWizardContainerView : Page
</file>

<file path="Module_Routing/Views/RoutingWizardStep1View.xaml.cs">
public sealed partial class RoutingWizardStep1View : Page
</file>

<file path="Module_Routing/Views/RoutingWizardStep3View.xaml.cs">
public sealed partial class RoutingWizardStep3View : Page
⋮----
private void OnPageLoaded(object sender, RoutedEventArgs e)
⋮----
// Load review data when page loads
ViewModel.LoadReviewData();
</file>

<file path="Module_Settings/Enums/Enum_SettingsWorkflowStep.cs">
/// <summary>
/// Settings workflow navigation steps
/// </summary>
</file>

<file path="Module_Settings/Interfaces/IService_UserPreferences.cs">
public interface IService_UserPreferences
⋮----
/// <summary>Get user's latest receiving mode preference</summary>
/// <param name="username"></param>
public Task<Model_Dao_Result<Model_UserPreference>> GetLatestUserPreferenceAsync(string username);
⋮----
/// <summary>Update user's default receiving mode</summary>
⋮----
/// <param name="defaultMode"></param>
public Task<Model_Dao_Result> UpdateDefaultModeAsync(string username, string defaultMode);
⋮----
/// <summary>Update user's default receiving workflow mode (guided, manual, edit)</summary>
⋮----
public Task<Model_Dao_Result> UpdateDefaultReceivingModeAsync(string username, string defaultMode);
⋮----
/// <summary>Update user's default dunnage mode</summary>
⋮----
public Task<Model_Dao_Result> UpdateDefaultDunnageModeAsync(string username, string defaultMode);
</file>

<file path="Module_Settings/Services/Service_SettingsWorkflow.cs">
/// <summary>
/// Service for managing Settings workflow navigation
/// </summary>
public class Service_SettingsWorkflow : IService_SettingsWorkflow
⋮----
private Enum_SettingsWorkflowStep _currentStep = Enum_SettingsWorkflowStep.ModeSelection;
⋮----
public void GoToStep(Enum_SettingsWorkflowStep step)
⋮----
public void GoBack()
⋮----
// Return to mode selection
⋮----
public void Reset()
</file>

<file path="Module_Shared/ViewModels/ViewModel_Shared_Base.cs">
/// <summary>
/// Base ViewModel providing common functionality for all ViewModels
/// </summary>
public abstract partial class ViewModel_Shared_Base : ObservableObject
⋮----
protected readonly IService_ErrorHandler _errorHandler;
protected readonly IService_LoggingUtility _logger;
⋮----
private InfoBarSeverity _statusSeverity = InfoBarSeverity.Informational;
⋮----
public void ShowStatus(string message, InfoBarSeverity severity = InfoBarSeverity.Informational)
⋮----
// Update global notification
⋮----
// Update local properties
</file>

<file path="Module_Shared/ViewModels/ViewModel_Shared_HelpDialog.cs">
/// <summary>
/// ViewModel for the centralized help dialog
/// </summary>
public partial class ViewModel_Shared_HelpDialog : ViewModel_Shared_Base
⋮----
private readonly IService_Help _helpService;
⋮----
/// Loads help content and related topics
⋮----
/// <param name="content">The help content to load</param>
public async Task LoadHelpContentAsync(Model_HelpContent content)
⋮----
// Check if dismissed
⋮----
IsDismissed = await _helpService.IsDismissedAsync(content.Key);
⋮----
// Load related topics
RelatedTopics.Clear();
⋮----
var relatedContent = _helpService.GetHelpContent(relatedKey);
⋮----
RelatedTopics.Add(relatedContent);
⋮----
_errorHandler.HandleException(
⋮----
private async Task ViewRelatedTopicAsync()
⋮----
// This will be called from the ListView click event
⋮----
public async Task LoadRelatedTopicAsync(Model_HelpContent? relatedContent)
⋮----
private async Task CopyContentAsync()
⋮----
if (HelpContent != null && !string.IsNullOrEmpty(HelpContent.Content))
⋮----
dataPackage.SetText(HelpContent.Content);
Windows.ApplicationModel.DataTransfer.Clipboard.SetContent(dataPackage);
⋮----
await _logger.LogInfoAsync("Help content copied to clipboard");
⋮----
partial void OnIsDismissedChanged(bool value)
⋮----
if (HelpContent != null && !string.IsNullOrEmpty(HelpContent.Key))
⋮----
_ = _helpService.SetDismissedAsync(HelpContent.Key, value);
</file>

<file path="Module_Shared/ViewModels/ViewModel_Shared_MainWindow.cs">
public partial class ViewModel_Shared_MainWindow : ViewModel_Shared_Base
⋮----
private readonly IService_UserSessionManager _sessionManager;
⋮----
private void OnNotificationServicePropertyChanged(object? sender, PropertyChangedEventArgs e)
⋮----
private void UpdateUserDisplay(Model_User user)
</file>

<file path="Module_Shared/ViewModels/ViewModel_Shared_NewUserSetup.cs">
/// <summary>
/// ViewModel for NewUserSetupDialog.
/// Manages new user account creation workflow.
/// </summary>
public partial class ViewModel_Shared_NewUserSetup : ViewModel_Shared_Base
⋮----
private readonly IService_Authentication _authService;
⋮----
// ====================================================================
// Properties
⋮----
/// List of available departments from database
⋮----
/// The new employee number assigned after successful account creation
⋮----
/// Indicates if the user cancelled the dialog
⋮----
/// The Windows username of the person creating this account (for audit trail)
⋮----
// Constructor
⋮----
/// Constructor with dependency injection
⋮----
/// <param name="authService"></param>
/// <param name="errorHandler"></param>
/// <param name="logger"></param>
⋮----
_authService = authService ?? throw new ArgumentNullException(nameof(authService));
⋮----
// Methods
⋮----
/// Load active departments from database
⋮----
public async Task LoadDepartmentsAsync()
⋮----
var departmentList = await _authService.GetActiveDepartmentsAsync();
⋮----
Departments.Clear();
⋮----
Departments.Add(dept);
⋮----
_logger.LogInfo($"Loaded {Departments.Count} departments for new user setup");
⋮----
await _errorHandler.HandleErrorAsync(
⋮----
/// Create new user account
⋮----
public async Task<bool> CreateAccountAsync()
⋮----
// Validate employee number
if (!int.TryParse(EmployeeNumber, out int empNum) || empNum <= 0)
⋮----
// Validate PIN uniqueness via service
var pinValidation = await _authService.ValidatePinAsync(Pin, empNum);
⋮----
// Construct Model_User object
var newUser = new Model_User
⋮----
// Call authentication service to create new user
⋮----
var result = await _authService.CreateNewUserAsync(newUser, CreatedBy, progress);
⋮----
// Account created successfully
⋮----
_logger.LogInfo($"New user account created: {FullName} (Emp #{NewEmployeeNumber}) by {CreatedBy}");
⋮----
// Account creation failed
⋮----
_logger.LogWarning($"Failed to create account for {WindowsUsername}: {ErrorMessage}");
⋮----
/// Validate PIN format (4 digits)
⋮----
/// <param name="pin"></param>
public bool ValidatePinFormat(string pin)
⋮----
if (string.IsNullOrWhiteSpace(pin))
⋮----
if (!char.IsDigit(c))
⋮----
/// Validate that PINs match
⋮----
/// <param name="confirmPin"></param>
public bool ValidatePinMatch(string pin, string confirmPin)
⋮----
return !string.IsNullOrWhiteSpace(pin) && pin == confirmPin;
⋮----
/// Validate full name (at least 2 characters)
⋮----
/// <param name="fullName"></param>
public bool ValidateFullName(string fullName)
⋮----
return !string.IsNullOrWhiteSpace(fullName) && fullName.Trim().Length >= 2;
</file>

<file path="Module_Shared/ViewModels/ViewModel_Shared_SharedTerminalLogin.cs">
/// <summary>
/// ViewModel for SharedTerminalLoginDialog.
/// Manages PIN-based authentication for shared terminal workstations.
/// </summary>
public partial class ViewModel_Shared_SharedTerminalLogin : ViewModel_Shared_Base
⋮----
private readonly IService_Authentication _authService;
⋮----
// ====================================================================
// Properties
⋮----
/// Indicates if the user was locked out after 3 failed attempts
⋮----
/// Indicates if the user cancelled the login dialog
⋮----
/// The authenticated user (null if authentication failed)
⋮----
// Constructor
⋮----
/// Constructor with dependency injection
⋮----
/// <param name="authService"></param>
/// <param name="errorHandler"></param>
/// <param name="logger"></param>
⋮----
_authService = authService ?? throw new ArgumentNullException(nameof(authService));
⋮----
// Commands
⋮----
/// Attempts to authenticate the user with provided credentials
⋮----
/// <returns>True if authentication successful, false otherwise</returns>
public async Task<bool> LoginAsync()
⋮----
// Validate input (basic checks)
if (string.IsNullOrWhiteSpace(Username))
⋮----
if (string.IsNullOrWhiteSpace(Pin))
⋮----
// Call authentication service
⋮----
var result = await _authService.AuthenticateByPinAsync(Username, Pin, progress);
⋮----
// Authentication successful
⋮----
_logger.LogInfo($"PIN authentication successful for user: {Username}");
⋮----
// Authentication failed
⋮----
_logger.LogWarning($"PIN authentication failed for user: {Username}. Attempt {AttemptCount}");
⋮----
await _errorHandler.HandleErrorAsync(
</file>

<file path="Module_Shared/ViewModels/ViewModel_Shared_SplashScreen.cs">
/// <summary>
/// ViewModel for the splash screen window.
/// Tracks startup progress and displays status messages.
/// </summary>
public partial class ViewModel_Shared_SplashScreen : ViewModel_Shared_Base
⋮----
/// Updates progress percentage and status message
⋮----
/// <param name="percentage">Progress percentage (0-100)</param>
/// <param name="message">Status message to display</param>
public void UpdateProgress(double percentage, string message)
⋮----
/// Set splash screen to indeterminate/pulsing state
/// Used when waiting for user input (dialogs)
⋮----
public void SetIndeterminate(string message)
⋮----
/// Reset progress to initial state
⋮----
public void Reset()
</file>

<file path="Module_Shared/Views/View_Shared_HelpDialog.xaml">
<ContentDialog
    x:Class="MTM_Receiving_Application.Module_Shared.Views.View_Shared_HelpDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mi="using:Material.Icons.WinUI3"
    xmlns:models="using:MTM_Receiving_Application.Module_Core.Models.Core"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="{x:Bind ViewModel.HelpContent.Title, Mode=OneWay}"
    PrimaryButtonText="Close"
    DefaultButton="Primary"
    Width="700"
    Height="600">

    <ContentDialog.Resources>
        <Style x:Key="HelpHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="12,0,0,0"/>
        </Style>
        
        <Style x:Key="HelpContentStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="LineHeight" Value="22"/>
        </Style>

        <Style x:Key="RelatedTopicStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Margin" Value="8,4"/>
        </Style>
    </ContentDialog.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
            <mi:MaterialIcon 
                Kind="{x:Bind ViewModel.HelpContent.IconKind, Mode=OneWay}"
                Width="32" 
                Height="32"
                Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
            <TextBlock 
                Text="{x:Bind ViewModel.HelpContent.Title, Mode=OneWay}"
                Style="{StaticResource HelpHeaderStyle}"
                VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Content Section -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <TextBlock 
                Text="{x:Bind ViewModel.HelpContent.Content, Mode=OneWay}"
                Style="{StaticResource HelpContentStyle}"/>
        </ScrollViewer>

        <!-- Related Topics Section -->
        <Expander 
            Grid.Row="2"
            Header="Related Topics"
            Margin="0,16,0,0"
            HorizontalAlignment="Stretch"
            Visibility="{x:Bind ViewModel.IsRelatedHelpAvailable, Mode=OneWay}">
            <ListView 
                ItemsSource="{x:Bind ViewModel.RelatedTopics, Mode=OneWay}"
                SelectionMode="None"
                IsItemClickEnabled="True"
                ItemClick="RelatedTopics_ItemClick">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:Model_HelpContent">
                        <StackPanel Orientation="Horizontal">
                            <mi:MaterialIcon 
                                Kind="{x:Bind IconKind}"
                                Width="20" 
                                Height="20"
                                Margin="0,0,8,0"/>
                            <TextBlock 
                                Text="{x:Bind Title}"
                                Style="{StaticResource RelatedTopicStyle}"/>
                        </StackPanel>
                    </DataTemplate>
                </ListView.ItemTemplate>
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                    </Style>
                </ListView.ItemContainerStyle>
            </ListView>
        </Expander>

        <!-- Footer Section -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Stretch" Margin="0,12,0,0">
            <CheckBox 
                Content="Don't show this again"
                IsChecked="{x:Bind ViewModel.IsDismissed, Mode=TwoWay}"
                Visibility="{x:Bind ViewModel.CanDismiss, Mode=OneWay}"
                HorizontalAlignment="Left"/>
            
            <Button 
                Content="Copy"
                Command="{x:Bind ViewModel.CopyContentCommand}"
                HorizontalAlignment="Right"
                Margin="12,0,0,0">
                <Button.KeyboardAccelerators>
                    <KeyboardAccelerator Key="C" Modifiers="Control"/>
                </Button.KeyboardAccelerators>
            </Button>
        </StackPanel>
    </Grid>
</ContentDialog>
</file>

<file path="Module_Shared/Views/View_Shared_HelpDialog.xaml.cs">
/// <summary>
/// Centralized help dialog for displaying contextual help content
/// </summary>
public sealed partial class View_Shared_HelpDialog : ContentDialog
⋮----
/// Sets the help content to display in the dialog
⋮----
/// <param name="content"></param>
public void SetHelpContent(Model_HelpContent content)
⋮----
_ = ViewModel.LoadHelpContentAsync(content);
⋮----
/// Handles clicking on a related topic to navigate to it
⋮----
/// <param name="sender"></param>
/// <param name="e"></param>
private async void RelatedTopics_ItemClick(object sender, Microsoft.UI.Xaml.Controls.ItemClickEventArgs e)
⋮----
await ViewModel.LoadRelatedTopicAsync(relatedContent);
</file>

<file path="Module_Shared/Views/View_Shared_IconSelectorWindow.xaml">
<Window
    x:Class="MTM_Receiving_Application.Module_Shared.Views.View_Shared_IconSelectorWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:materialIcons="using:Material.Icons.WinUI3"
    mc:Ignorable="d"
    Title="Select Icon">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Custom Title Bar -->
        <Grid x:Name="AppTitleBar" Grid.Row="0" Height="32" Background="Transparent">
            <TextBlock Text="Icon Library" 
                       VerticalAlignment="Center" 
                       Margin="16,0,0,0"
                       Style="{StaticResource CaptionTextBlockStyle}"/>
        </Grid>

        <!-- Header & Search -->
        <Grid Grid.Row="1" Padding="32,16,32,16" Background="{ThemeResource LayerFillColorDefaultBrush}" BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}" BorderThickness="0,0,0,1">
            <Grid ColumnSpacing="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBox x:Name="SearchBox" 
                         Grid.Column="0"
                         PlaceholderText="Search icons (e.g. 'box', 'truck')..." 
                         TextChanged="OnSearchTextChanged"
                         Height="36"
                         CornerRadius="4"/>
                         
                <CheckBox x:Name="ShowAllIconsCheckBox" 
                          Grid.Column="1"
                          Content="Show all icons" 
                          Checked="OnShowAllIconsChanged"
                          Unchecked="OnShowAllIconsChanged"
                          VerticalAlignment="Center"/>
            </Grid>
        </Grid>

        <!-- Icon Grid -->
        <Viewbox Grid.Row="2" Stretch="Uniform">
            <GridView x:Name="IconGridView" 
                      Padding="16"
                      SelectionMode="Single"
                      IsItemClickEnabled="True"
                      ItemClick="OnIconItemClick"
                      ScrollViewer.VerticalScrollBarVisibility="Disabled"
                      Width="900" Height="650">
                <GridView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <ItemsWrapGrid MaximumRowsOrColumns="4" Orientation="Horizontal" HorizontalAlignment="Center"/>
                    </ItemsPanelTemplate>
                </GridView.ItemsPanel>
                <GridView.ItemTemplate>
                    <DataTemplate>
                        <Border Width="200" Height="140"
                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1" 
                                CornerRadius="8"
                                Margin="8"
                                ToolTipService.ToolTip="{Binding Name}">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Normal" />
                                    <VisualState x:Name="PointerOver">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPanel" Storyboard.TargetProperty="Background">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource CardBackgroundFillColorSecondaryBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                            
                            <StackPanel x:Name="ContentPanel" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="12" Padding="12">
                                <materialIcons:MaterialIcon Kind="{Binding Kind}" 
                                          Width="40" Height="40"
                                          Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                                <TextBlock Text="{Binding Name}" 
                                           FontSize="14" 
                                           TextWrapping="Wrap" 
                                           TextAlignment="Center"
                                           HorizontalAlignment="Center"
                                           MaxLines="2"
                                           TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </GridView.ItemTemplate>
            </GridView>
        </Viewbox>

        <!-- Footer -->
        <Grid Grid.Row="3" Padding="32,20" Background="{ThemeResource LayerFillColorDefaultBrush}" BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}" BorderThickness="0,1,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <Button x:Name="CancelButton" Grid.Column="0" Content="Cancel" Click="OnCancelClick" Width="100" Height="36" CornerRadius="4" HorizontalAlignment="Left"/>
            
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                <Button x:Name="FirstPageButton" Click="OnFirstPageClick" Width="44" Height="36" CornerRadius="4" ToolTipService.ToolTip="First Page">
                    <materialIcons:MaterialIcon Kind="PageFirst" Width="16" Height="16"/>
                </Button>
                <Button x:Name="PreviousPageButton" Click="OnPreviousPageClick" Width="44" Height="36" CornerRadius="4" ToolTipService.ToolTip="Previous Page">
                    <materialIcons:MaterialIcon Kind="ChevronLeft" Width="16" Height="16"/>
                </Button>
                
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="4" Padding="16,0" Height="36" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                    <TextBlock x:Name="PageInfoTextBlock" VerticalAlignment="Center" Text="Page 1 of 1" FontWeight="SemiBold"/>
                </Border>
                
                <Button x:Name="NextPageButton" Click="OnNextPageClick" Width="44" Height="36" CornerRadius="4" ToolTipService.ToolTip="Next Page">
                    <materialIcons:MaterialIcon Kind="ChevronRight" Width="16" Height="16"/>
                </Button>
                <Button x:Name="LastPageButton" Click="OnLastPageClick" Width="44" Height="36" CornerRadius="4" ToolTipService.ToolTip="Last Page">
                    <materialIcons:MaterialIcon Kind="PageLast" Width="16" Height="16"/>
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
</file>

<file path="Module_Shared/Views/View_Shared_IconSelectorWindow.xaml.cs">
public sealed partial class View_Shared_IconSelectorWindow : Window
⋮----
Debug.WriteLine($"Failed to get logging service: {ex.Message}");
⋮----
// Custom Title Bar
⋮----
var hwnd = WinRT.Interop.WindowNative.GetWindowHandle(this);
var windowId = Microsoft.UI.Win32Interop.GetWindowIdFromWindow(hwnd);
var appWindow = Microsoft.UI.Windowing.AppWindow.GetFromWindowId(windowId);
⋮----
appWindow.Resize(windowSize);
⋮----
var displayArea = Microsoft.UI.Windowing.DisplayArea.GetFromWindowId(windowId, Microsoft.UI.Windowing.DisplayAreaFallback.Primary);
⋮----
appWindow.Move(new Windows.Graphics.PointInt32 { X = centerX, Y = centerY });
⋮----
// Handle window closing to complete the task
⋮----
/// <summary>
/// Sets the initial icon selection in the grid
/// </summary>
/// <param name="iconKind"></param>
public void SetInitialSelection(MaterialIconKind iconKind)
⋮----
// Find and select the icon in the grid after it loads
DispatcherQueue.TryEnqueue(() =>
⋮----
var iconInfo = _allIcons.FirstOrDefault(i => i.Kind == iconKind);
⋮----
IconGridView.ScrollIntoView(iconInfo);
⋮----
/// Waits for the user to select an icon or close the window
⋮----
public Task<MaterialIconKind?> WaitForSelectionAsync()
⋮----
private void LoadIcons()
⋮----
var icons = Helper_MaterialIcons.GetAllIcons();
_allIcons = icons.ConvertAll(k => new IconInfo(k.ToString(), k));
⋮----
// Define common/curated icons for dunnage and packaging
⋮----
.Where(i => commonIconNames.Contains(i.Name))
.ToList();
⋮----
// Start with common icons (unless "Show all" is checked)
⋮----
Debug.WriteLine($"Error loading icons: {ex}");
⋮----
private void UpdateGridView()
⋮----
_totalPages = (int)Math.Ceiling((double)_filteredIcons.Count / ICONS_PER_PAGE);
⋮----
.Skip((_currentPage - 1) * ICONS_PER_PAGE)
.Take(ICONS_PER_PAGE)
⋮----
// Update pagination controls
⋮----
private void OnSearchTextChanged(object sender, TextChangedEventArgs e)
⋮----
var searchText = SearchBox.Text.ToLower().Trim();
⋮----
if (string.IsNullOrWhiteSpace(searchText))
⋮----
.Where(i => i.Name.ToLower().Contains(searchText))
⋮----
private void OnShowAllIconsChanged(object sender, RoutedEventArgs e)
⋮----
private void OnIconItemClick(object sender, ItemClickEventArgs e)
⋮----
private void OnPreviousPageClick(object sender, RoutedEventArgs e)
⋮----
private void OnNextPageClick(object sender, RoutedEventArgs e)
⋮----
private void OnFirstPageClick(object sender, RoutedEventArgs e)
⋮----
private void OnLastPageClick(object sender, RoutedEventArgs e)
⋮----
private void OnCancelClick(object sender, RoutedEventArgs e)
⋮----
public class IconInfo
</file>

<file path="Module_Shared/Views/View_Shared_NewUserSetupDialog.xaml">
<?xml version="1.0" encoding="utf-8"?>
<ContentDialog
    x:Class="MTM_Receiving_Application.Module_Shared.Views.View_Shared_NewUserSetupDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Create Your Account"
    PrimaryButtonText="Create Account"
    CloseButtonText="Cancel"
    DefaultButton="Primary"
    PrimaryButtonStyle="{StaticResource AccentButtonStyle}"
    Width="480">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header with Icon and Welcome -->
        <StackPanel Grid.Row="0" Spacing="8" Padding="20,16,20,12" Background="{ThemeResource LayerFillColorDefaultBrush}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <FontIcon Grid.Column="0" 
                          FontFamily="{StaticResource SymbolThemeFontFamily}" 
                          Glyph="&#xE77B;" 
                          FontSize="32"
                          Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                          VerticalAlignment="Center"
                          Margin="0,0,16,0"/>
                
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="Welcome to MTM Receiving" 
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               FontWeight="SemiBold"/>
                    <TextBlock Text="Let's set up your account to get started" 
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Style="{StaticResource CaptionTextBlockStyle}"/>
                </StackPanel>
            </Grid>
        </StackPanel>

        <!-- Main Content - Using Grid for compact two-column layout with ScrollViewer -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto" 
                      HorizontalScrollBarVisibility="Disabled"
                      MaxHeight="480">
            <Grid Padding="20,12" RowSpacing="12" ColumnSpacing="12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

            <!-- Row 0: Full Name (spans both columns) -->
            <StackPanel Grid.Row="0" Grid.ColumnSpan="2" Spacing="6">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE77B;" 
                              FontSize="16"
                              Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    <TextBlock Text="Full Name *" 
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                </StackPanel>
                <TextBox x:Name="FullNameTextBox"
                         PlaceholderText="Enter your full name"
                         MaxLength="100"
                         TabIndex="0"/>
            </StackPanel>

            <!-- Row 1: Employee Number & Windows Username -->
            <StackPanel Grid.Row="1" Grid.Column="0" Spacing="6">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE8D4;" 
                              FontSize="16"
                              Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    <TextBlock Text="Employee Number *" 
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                </StackPanel>
                <TextBox x:Name="EmployeeNumberTextBox"
                         PlaceholderText="e.g., 6229"
                         MaxLength="10"
                         TabIndex="1"
                         InputScope="Number"/>
            </StackPanel>

            <StackPanel Grid.Row="1" Grid.Column="1" Spacing="6">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE910;" 
                              FontSize="16"
                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    <TextBlock Text="Windows Username" 
                               Style="{StaticResource BodyStrongTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <TextBox x:Name="WindowsUsernameTextBox"
                         IsReadOnly="True"
                         Background="{ThemeResource ControlAltFillColorSecondaryBrush}"
                         TabIndex="-1"/>
            </StackPanel>

            <!-- Row 2: Department & Shift -->
            <StackPanel Grid.Row="2" Grid.Column="0" Spacing="6">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE716;" 
                              FontSize="16"
                              Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    <TextBlock Text="Department *" 
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                </StackPanel>
                <ComboBox x:Name="DepartmentComboBox"
                          PlaceholderText="Select department"
                          HorizontalAlignment="Stretch"
                          TabIndex="2"
                          SelectionChanged="DepartmentComboBox_SelectionChanged"/>
            </StackPanel>

            <StackPanel Grid.Row="2" Grid.Column="1" Spacing="6">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE823;" 
                              FontSize="16"
                              Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    <TextBlock Text="Shift *" 
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                </StackPanel>
                <ComboBox x:Name="ShiftComboBox"
                          PlaceholderText="Select shift"
                          HorizontalAlignment="Stretch"
                          TabIndex="4">
                    <ComboBoxItem Content="1st Shift"/>
                    <ComboBoxItem Content="2nd Shift"/>
                    <ComboBoxItem Content="3rd Shift"/>
                </ComboBox>
            </StackPanel>

            <!-- Row 3: Custom Department (Visible when "Other" selected, spans both columns) -->
            <StackPanel x:Name="CustomDepartmentPanel" 
                        Grid.Row="3" 
                        Grid.ColumnSpan="2" 
                        Spacing="6" 
                        Visibility="Collapsed">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE70F;" 
                              FontSize="16"
                              Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    <TextBlock Text="Custom Department Name *" 
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                </StackPanel>
                <TextBox x:Name="CustomDepartmentTextBox"
                         PlaceholderText="Enter department name"
                         MaxLength="50"
                         TabIndex="3"/>
            </StackPanel>

            <!-- Row 4: PIN Fields -->
            <StackPanel Grid.Row="4" Grid.Column="0" Spacing="6">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE72E;" 
                              FontSize="16"
                              Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    <TextBlock Text="4-Digit PIN *" 
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                </StackPanel>
                <PasswordBox x:Name="PinPasswordBox"
                             PlaceholderText="Create PIN"
                             MaxLength="4"
                             TabIndex="5"
                             PasswordRevealMode="Peek"/>
                <TextBlock Text="For shared terminal login" 
                           Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                           Style="{StaticResource CaptionTextBlockStyle}"/>
            </StackPanel>

            <StackPanel Grid.Row="4" Grid.Column="1" Spacing="6">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE8C9;" 
                              FontSize="16"
                              Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    <TextBlock Text="Confirm PIN *" 
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                </StackPanel>
                <PasswordBox x:Name="ConfirmPinPasswordBox"
                             PlaceholderText="Re-enter PIN"
                             MaxLength="4"
                             TabIndex="6"
                             PasswordRevealMode="Peek"/>
            </StackPanel>

            <!-- Row 5: ERP Credentials Section (Optional) -->
            <Expander x:Name="ErpExpander"
                      Grid.Row="5" 
                      Grid.ColumnSpan="2"
                      Header="ERP System Access (Optional)"
                      IsExpanded="False"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Stretch"
                      VerticalContentAlignment="Stretch">
                <Expander.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                      Glyph="&#xE89F;" 
                                      FontSize="16"/>
                            <TextBlock Text="{Binding}" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                        </StackPanel>
                    </DataTemplate>
                </Expander.HeaderTemplate>
                
                <StackPanel Spacing="12" Padding="12,8,0,0">
                    <CheckBox x:Name="ConfigureErpCheckBox"
                              Content="Configure Visual/Infor ERP credentials"
                              Checked="ConfigureErpCheckBox_Checked"
                              Unchecked="ConfigureErpCheckBox_Unchecked"
                              TabIndex="7"/>

                    <StackPanel x:Name="ErpCredentialsPanel" Spacing="12" Visibility="Collapsed">
                        <InfoBar Severity="Warning" 
                                 IsOpen="True" 
                                 IsClosable="False"
                                 Message="Credentials are stored in plain text for ERP integration."/>
                        
                        <StackPanel Spacing="6">
                            <TextBlock Text="Visual/Infor Username" 
                                       Style="{StaticResource BodyStrongTextBlockStyle}"/>
                            <TextBox x:Name="VisualUsernameTextBox"
                                     PlaceholderText="ERP username"
                                     MaxLength="50"
                                     TabIndex="8"/>
                        </StackPanel>

                        <StackPanel Spacing="6">
                            <TextBlock Text="Visual/Infor Password" 
                                       Style="{StaticResource BodyStrongTextBlockStyle}"/>
                            <PasswordBox x:Name="VisualPasswordBox"
                                         PlaceholderText="ERP password"
                                         MaxLength="100"
                                         TabIndex="9"
                                         PasswordRevealMode="Peek"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </Expander>
            </Grid>
        </ScrollViewer>

        <!-- Footer: Status Bar & Progress -->
        <StackPanel Grid.Row="2" Spacing="6" Padding="20,8,20,16">
            <ProgressBar x:Name="LoadingProgressBar" 
                         IsIndeterminate="True" 
                         Visibility="Collapsed"
                         Height="4"/>
            
            <InfoBar x:Name="StatusInfoBar"
                     IsOpen="False"
                     IsClosable="True"/>
        </StackPanel>
    </Grid>
</ContentDialog>
</file>

<file path="Module_Shared/Views/View_Shared_NewUserSetupDialog.xaml.cs">
/// <summary>
/// Dialog for creating new user accounts when Windows username is not found in database.
/// Allows supervisor to create account with full name, department, shift, and PIN.
/// </summary>
public sealed partial class View_Shared_NewUserSetupDialog : ContentDialog
⋮----
/// Constructor with ViewModel injection
⋮----
/// <param name="viewModel"></param>
⋮----
ViewModel = viewModel ?? throw new ArgumentNullException(nameof(viewModel));
⋮----
// Wire up event handlers
⋮----
/// Handle dialog closing event (including X button)
⋮----
/// <param name="sender"></param>
/// <param name="args"></param>
private void OnDialogClosing(ContentDialog sender, ContentDialogClosingEventArgs args)
⋮----
// If user closes with X or Cancel button, mark as cancelled
⋮----
/// Initialize dialog when loaded
⋮----
/// <param name="e"></param>
private async void OnDialogLoaded(object sender, RoutedEventArgs e)
⋮----
// Set Windows username (read-only)
⋮----
// Load departments from database
⋮----
// Set focus to full name field
FullNameTextBox.Focus(FocusState.Programmatic);
⋮----
/// Load departments from database and populate ComboBox
⋮----
private async System.Threading.Tasks.Task LoadDepartmentsAsync()
⋮----
await ViewModel.LoadDepartmentsAsync();
⋮----
// Clear and populate ComboBox
DepartmentComboBox.Items.Clear();
⋮----
DepartmentComboBox.Items.Add(dept);
⋮----
// Add "Other" option
DepartmentComboBox.Items.Add("Other");
⋮----
/// Handle Department ComboBox selection change
⋮----
private void DepartmentComboBox_SelectionChanged(object sender, SelectionChangedEventArgs e)
⋮----
string selectedDept = DepartmentComboBox.SelectedItem.ToString() ?? string.Empty;
⋮----
// Show/hide custom department field based on selection
⋮----
CustomDepartmentTextBox.Focus(FocusState.Programmatic);
⋮----
/// Handle ERP configuration checkbox checked
⋮----
private void ConfigureErpCheckBox_Checked(object sender, RoutedEventArgs e)
⋮----
// Ensure expander is expanded to show the content
⋮----
// Set focus to first ERP field after a brief delay to allow UI to render
_ = DispatcherQueue.TryEnqueue(Microsoft.UI.Dispatching.DispatcherQueuePriority.Normal, () =>
⋮----
VisualUsernameTextBox.Focus(FocusState.Programmatic);
⋮----
/// Handle ERP configuration checkbox unchecked
⋮----
private void ConfigureErpCheckBox_Unchecked(object sender, RoutedEventArgs e)
⋮----
// Clear ERP fields when unchecked
⋮----
/// Handle Create Account button click
⋮----
private async void OnCreateAccountButtonClick(ContentDialog sender, ContentDialogButtonClickEventArgs args)
⋮----
// Clear previous errors
⋮----
// Collect form data
⋮----
// Use custom department if "Other" selected
⋮----
// Validate all fields
if (string.IsNullOrWhiteSpace(employeeNumber))
⋮----
EmployeeNumberTextBox.Focus(FocusState.Programmatic);
⋮----
if (!int.TryParse(employeeNumber, out int empNum) || empNum <= 0)
⋮----
if (string.IsNullOrWhiteSpace(fullName))
⋮----
if (string.IsNullOrWhiteSpace(department))
⋮----
DepartmentComboBox.Focus(FocusState.Programmatic);
⋮----
if (string.IsNullOrWhiteSpace(shift))
⋮----
ShiftComboBox.Focus(FocusState.Programmatic);
⋮----
if (string.IsNullOrWhiteSpace(pin))
⋮----
PinPasswordBox.Focus(FocusState.Programmatic);
⋮----
if (pin.Length != 4 || !pin.All(char.IsDigit))
⋮----
ConfirmPinPasswordBox.Focus(FocusState.Programmatic);
⋮----
// Set loading state
⋮----
// Update ViewModel properties
⋮----
// Update ERP credentials if configured
⋮----
// Attempt to create account
bool success = await ViewModel.CreateAccountAsync();
⋮----
// Restore normal state
⋮----
// Show success message with employee number
⋮----
// Wait a moment for user to see success message
await System.Threading.Tasks.Task.Delay(2000);
⋮----
// Close dialog
⋮----
// Show error message
⋮----
/// Handle Cancel button click
⋮----
private void OnCancelButtonClick(ContentDialog sender, ContentDialogButtonClickEventArgs args)
⋮----
// User cancelled account creation
⋮----
/// Show validation error in InfoBar
⋮----
/// <param name="message"></param>
private void ShowValidationError(string message)
⋮----
/// Set loading state (disable controls, show progress bar)
⋮----
/// <param name="isLoading"></param>
private void SetLoadingState(bool isLoading)
⋮----
// Disable/enable input controls
⋮----
// Disable/enable buttons
⋮----
// Show/hide progress bar
</file>

<file path="Module_Shared/Views/View_Shared_SharedTerminalLoginDialog.xaml">
<?xml version="1.0" encoding="utf-8"?>
<ContentDialog
    x:Class="MTM_Receiving_Application.Module_Shared.Views.View_Shared_SharedTerminalLoginDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Shared Terminal Login"
    PrimaryButtonText="Login"
    CloseButtonText="Cancel"
    DefaultButton="Primary"
    PrimaryButtonStyle="{StaticResource AccentButtonStyle}"
    Width="400">

    <StackPanel Spacing="16" Padding="8">
        <!-- Instructions -->
        <TextBlock 
            Text="Please enter your credentials to continue"
            TextWrapping="Wrap"
            Style="{StaticResource BodyTextBlockStyle}"/>

        <!-- Username Field -->
        <StackPanel Spacing="4">
            <TextBlock Text="Username" Style="{StaticResource CaptionTextBlockStyle}"/>
            <TextBox 
                x:Name="UsernameTextBox"
                PlaceholderText="Enter your username"
                MaxLength="50"
                TabIndex="0"/>
        </StackPanel>

        <!-- PIN Field -->
        <StackPanel Spacing="4">
            <TextBlock Text="4-Digit PIN" Style="{StaticResource CaptionTextBlockStyle}"/>
            <PasswordBox 
                x:Name="PinPasswordBox"
                PlaceholderText="Enter 4-digit PIN"
                MaxLength="4"
                TabIndex="1"
                PasswordRevealMode="Peek"/>
        </StackPanel>

        <!-- Attempt Counter (Hidden initially, shown after first failure) -->
        <TextBlock 
            x:Name="AttemptCounterTextBlock"
            Foreground="Gold"
            Visibility="Collapsed"
            TextWrapping="Wrap"
            Style="{StaticResource CaptionTextBlockStyle}"/>

        <!-- Error InfoBar -->
        <InfoBar 
            x:Name="ErrorInfoBar"
            Severity="Error"
            IsOpen="False"
            IsClosable="True"
            Title="Login Failed"
            Message="Invalid username or PIN. Please try again."/>

    </StackPanel>
</ContentDialog>
</file>

<file path="Module_Shared/Views/View_Shared_SharedTerminalLoginDialog.xaml.cs">
/// <summary>
/// Dialog for PIN-based authentication on shared terminals.
/// Allows username + 4-digit PIN entry with 3-attempt limit.
/// </summary>
public sealed partial class View_Shared_SharedTerminalLoginDialog : ContentDialog
⋮----
private readonly IService_Focus _focusService;
⋮----
/// Constructor with ViewModel injection
⋮----
/// <param name="viewModel"></param>
⋮----
ViewModel = viewModel ?? throw new ArgumentNullException(nameof(viewModel));
⋮----
// Wire up event handlers
⋮----
_focusService.AttachFocusOnVisibility(this, UsernameTextBox);
⋮----
/// Handles the Login button click
⋮----
/// <param name="sender"></param>
/// <param name="args"></param>
private async void OnPrimaryButtonClick(ContentDialog sender, ContentDialogButtonClickEventArgs args)
⋮----
// Clear previous errors
⋮----
// Validate input
⋮----
if (string.IsNullOrWhiteSpace(username))
⋮----
UsernameTextBox.Focus(FocusState.Programmatic);
⋮----
if (string.IsNullOrWhiteSpace(pin))
⋮----
PinPasswordBox.Focus(FocusState.Programmatic);
⋮----
if (pin.Length != 4 || !int.TryParse(pin, out _))
⋮----
// Attempt authentication via ViewModel
⋮----
bool success = await ViewModel.LoginAsync();
⋮----
// Authentication successful - close dialog
⋮----
// Authentication failed
⋮----
// Clear PIN field
⋮----
// Show error
⋮----
// Update attempt counter display
⋮----
// Maximum attempts reached - show lockout message
⋮----
// Disable input controls
⋮----
// Wait 5 seconds then close dialog with failure result
await System.Threading.Tasks.Task.Delay(5000);
⋮----
// Signal to caller that lockout occurred
⋮----
/// Handles the Cancel button click
⋮----
private void OnCloseButtonClick(ContentDialog sender, ContentDialogButtonClickEventArgs args)
⋮----
// User cancelled login
</file>

<file path="Module_Shared/Views/View_Shared_SplashScreenWindow.xaml">
<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="MTM_Receiving_Application.Module_Shared.Views.View_Shared_SplashScreenWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="MTM Receiving Application"   
    >

    <Grid Background="{ThemeResource LayerFillColorDefaultBrush}" Padding="32">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Logo and Branding -->
        <StackPanel Grid.Row="1" HorizontalAlignment="Center" Spacing="12">
            <FontIcon FontFamily="Segoe Fluent Icons" 
                      Glyph="&#xE8F1;" 
                      FontSize="64"
                      Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                      HorizontalAlignment="Center"/>
            
            <TextBlock Text="MTM Receiving Application" 
                       Style="{StaticResource TitleTextBlockStyle}"
                       HorizontalAlignment="Center"
                       FontWeight="SemiBold"/>
            
            <TextBlock Text="Version 1.0.0"
                       Style="{StaticResource CaptionTextBlockStyle}"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       HorizontalAlignment="Center"/>
            
            <TextBlock Text="MTM Manufacturing"
                       Style="{StaticResource BodyTextBlockStyle}"
                       Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                       HorizontalAlignment="Center"/>
        </StackPanel>

        <!-- Progress Section -->
        <StackPanel Grid.Row="2" Margin="0,40,0,0" Spacing="12">
            <TextBlock x:Name="StatusMessageTextBlock"
                       Text="Initializing..."
                       Style="{StaticResource BodyTextBlockStyle}"
                       HorizontalAlignment="Center"
                       TextAlignment="Center"
                       TextWrapping="Wrap"/>

            <ProgressBar x:Name="MainProgressBar"
                         Height="4"
                         Minimum="0"
                         Maximum="100"
                         Value="0"
                         HorizontalAlignment="Stretch"/>

            <TextBlock x:Name="ProgressPercentageTextBlock"
                       Text="0%"
                       Style="{StaticResource CaptionTextBlockStyle}"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       HorizontalAlignment="Center"/>
        </StackPanel>

        <!-- Copyright -->
        <TextBlock Grid.Row="3"
                   Text="© 2025 MTM Manufacturing. All rights reserved."
                   Style="{StaticResource CaptionTextBlockStyle}"
                   Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                   HorizontalAlignment="Center"
                   Margin="0,28,0,0"/>
    </Grid>
</Window>
</file>

<file path="Module_Shared/Views/View_Shared_SplashScreenWindow.xaml.cs">
/// <summary>
/// Splash screen window displayed during application startup
/// Shows branding, progress, and status messages during initialization
/// Window size: 500x450 pixels (optimized for dialog display)
/// </summary>
public sealed partial class View_Shared_SplashScreenWindow : Window
⋮----
/// Flag to indicate if the window is being closed programmatically by the application logic.
/// If false (default), it means the user closed the window manually, which should exit the application.
⋮----
// Subscribe to ViewModel property changes
⋮----
// Configure window appearance and size
⋮----
// Handle manual closure
⋮----
private void SplashScreenWindow_Closed(object sender, WindowEventArgs args)
⋮----
// If the user manually closes the splash screen (e.g. via Alt+F4 or taskbar),
// we must ensure the application process terminates.
⋮----
Application.Current.Exit();
⋮----
/// Configure window appearance, size, and position
⋮----
private void ConfigureWindow()
⋮----
// Use custom title bar with transparent styling
this.UseCustomTitleBar();
this.HideTitleBarIcon();
this.MakeTitleBarTransparent();
⋮----
// Set fixed window size
this.SetWindowSize(WindowWidth, WindowHeight);
this.SetFixedSize(disableMaximize: true, disableMinimize: true);
⋮----
// Center on screen
this.CenterOnScreen();
⋮----
/// Handle ViewModel property changes and update UI
⋮----
/// <param name="sender"></param>
/// <param name="e"></param>
private void ViewModel_PropertyChanged(object? sender, System.ComponentModel.PropertyChangedEventArgs e)
⋮----
DispatcherQueue.TryEnqueue(Microsoft.UI.Dispatching.DispatcherQueuePriority.Normal, () =>
</file>

<file path="Module_Volvo/Views/View_Volvo_History.xaml.cs">
/// <summary>
/// Page for viewing and managing Volvo shipment history
/// </summary>
public sealed partial class View_Volvo_History : Page
⋮----
private async void OnPageLoaded(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
⋮----
// Auto-filter on page load (last 30 days)
await ViewModel.FilterCommand.ExecuteAsync(null);
</file>

<file path="Module_Volvo/Views/View_Volvo_Settings.xaml.cs">
/// <summary>
/// Settings view for Volvo parts master data management
/// </summary>
public sealed partial class View_Volvo_Settings : Page
⋮----
private async void OnPageLoaded(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
⋮----
await ViewModel.RefreshCommand.ExecuteAsync(null);
</file>

<file path="Module_Core/Contracts/Services/IService_Focus.cs">
public interface IService_Focus
⋮----
/// <summary>
/// Sets focus to the specified control.
/// </summary>
/// <param name="control">The control to focus.</param>
public void SetFocus(Control control);
⋮----
/// Finds the first focusable input control (TextBox, NumberBox, ComboBox, Button, etc.)
/// within the container and sets focus to it.
⋮----
/// <param name="container">The container to search.</param>
public void SetFocusFirstInput(DependencyObject container);
⋮----
/// Attaches a listener to the element's Visibility property.
/// When the element becomes Visible, it sets focus to the target control
/// (or the first input if target is null).
⋮----
/// <param name="view">The view/element to monitor for visibility changes.</param>
/// <param name="targetControl">Optional specific control to focus. If null, searches for first input.</param>
public void AttachFocusOnVisibility(FrameworkElement view, Control? targetControl = null);
</file>

<file path="Module_Core/Contracts/Services/IService_Reporting.cs">
/// <summary>
/// Service interface for End-of-Day reporting across all modules
/// Filters history data by date range, normalizes PO numbers, and exports to CSV/email format
/// Reference: EndOfDayEmail.js and AppScript.js from Google Sheets routing label system
/// </summary>
public interface IService_Reporting
⋮----
/// Retrieves Receiving history data filtered by date range
/// Includes: PO Number (normalized), Part Number, Description, Quantity, Weight, Heat/Lot, Date
⋮----
/// <param name="startDate">Start date for filter</param>
/// <param name="endDate">End date for filter</param>
/// <returns>DAO result containing list of report rows</returns>
public Task<Model_Dao_Result<List<Model_ReportRow>>> GetReceivingHistoryAsync(
⋮----
/// Retrieves Dunnage history data filtered by date range
/// Includes: Type, Part, Specs (concatenated), Quantity, Date
⋮----
public Task<Model_Dao_Result<List<Model_ReportRow>>> GetDunnageHistoryAsync(
⋮----
/// Retrieves Routing history data filtered by date range
/// Includes: Deliver To, Department, Package Description, PO Number, Employee, Date
⋮----
public Task<Model_Dao_Result<List<Model_ReportRow>>> GetRoutingHistoryAsync(
⋮----
/// Retrieves Volvo history data filtered by date range
/// Includes: Shipment Date, Shipment Number, PO Number, Receiver Number, Status, Date
⋮----
public Task<Model_Dao_Result<List<Model_ReportRow>>> GetVolvoHistoryAsync(
⋮----
/// Checks availability of data for each module in the specified date range
/// Returns dictionary of module name → record count
/// Used to enable/disable module checkboxes in UI
⋮----
/// <returns>DAO result containing dictionary of module names and record counts</returns>
public Task<Model_Dao_Result<Dictionary<string, int>>> CheckAvailabilityAsync(
⋮----
/// Exports report data to CSV file matching MiniUPSLabel.csv structure
⋮----
/// <param name="data">Filtered report rows</param>
/// <param name="moduleName">Module name for filename (Receiving, Dunnage, Routing, Volvo)</param>
/// <returns>DAO result with file path of generated CSV</returns>
public Task<Model_Dao_Result<string>> ExportToCSVAsync(
⋮----
/// Formats report data as email body with alternating row colors grouped by date
/// Matches Google Sheets colorHistory() function behavior
⋮----
/// <param name="applyDateGrouping">Apply alternating colors by date group</param>
/// <returns>DAO result containing HTML-formatted string for email body</returns>
public Task<Model_Dao_Result<string>> FormatForEmailAsync(
⋮----
/// Normalizes PO number to standard format (PO-063150 or PO-063150B)
/// Matches EndOfDayEmail.js normalizePO() algorithm
/// Examples:
/// - "63150" → "PO-063150"
/// - "063150B" → "PO-063150B"
/// - "Customer Supplied" → "Customer Supplied" (pass through)
/// - "" → "No PO"
/// - "1234" → "Validate PO" (too short)
⋮----
/// <param name="poNumber">Raw PO number to normalize</param>
/// <returns>Normalized PO number</returns>
public string NormalizePONumber(string? poNumber);
</file>

<file path="Module_Core/Contracts/ViewModels/IResettableViewModel.cs">
public interface IResettableViewModel
⋮----
public void ResetToDefaults();
</file>

<file path="Module_Core/Converters/Converter_BooleanToVisibility.cs">
public class Converter_BooleanToVisibility : IValueConverter
⋮----
public object Convert(object? value, Type targetType, object? parameter, string language)
⋮----
if (parameter is string s && s.Equals("Inverse", StringComparison.OrdinalIgnoreCase))
⋮----
public object ConvertBack(object? value, Type targetType, object? parameter, string language)
⋮----
throw new NotImplementedException();
</file>

<file path="Module_Core/Converters/Converter_BoolToString.cs">
public class Converter_BoolToString : IValueConverter
⋮----
public object Convert(object? value, Type targetType, object? parameter, string language)
⋮----
var parts = paramString.Split('|');
⋮----
public object ConvertBack(object? value, Type targetType, object? parameter, string language)
⋮----
throw new NotImplementedException();
</file>

<file path="Module_Core/Converters/Converter_DecimalToInt.cs">
/// <summary>
/// Converts decimal values to integer (whole number) for display, removing decimal places.
/// </summary>
public class Converter_DecimalToInt : IValueConverter
⋮----
public object Convert(object? value, Type targetType, object? parameter, string language)
⋮----
return ((int)decimalValue).ToString("N0");
⋮----
return ((int)doubleValue).ToString("N0");
⋮----
return ((int)floatValue).ToString("N0");
⋮----
public object ConvertBack(object? value, Type targetType, object? parameter, string language)
⋮----
if (value is string strValue && decimal.TryParse(strValue, out decimal result))
</file>

<file path="Module_Core/Converters/Converter_DecimalToString.cs">
public class Converter_DecimalToString : IValueConverter
⋮----
public object Convert(object? value, Type targetType, object? parameter, string language)
⋮----
return d == 0 ? string.Empty : d.ToString("G29");
⋮----
public object ConvertBack(object? value, Type targetType, object? parameter, string language)
⋮----
if (string.IsNullOrWhiteSpace(s))
⋮----
if (decimal.TryParse(s, out decimal result))
</file>

<file path="Module_Core/Converters/Converter_DoubleToDecimal.cs">
public class Converter_DoubleToDecimal : IValueConverter
⋮----
public object Convert(object? value, Type targetType, object? parameter, string language)
⋮----
return System.Convert.ToDouble(d);
⋮----
public object ConvertBack(object? value, Type targetType, object? parameter, string language)
⋮----
return System.Convert.ToDecimal(d);
</file>

<file path="Module_Core/Converters/Converter_EmptyStringToVisibility.cs">
public class Converter_EmptyStringToVisibility : IValueConverter
⋮----
public object Convert(object? value, Type targetType, object? parameter, string language)
⋮----
bool isVisible = !string.IsNullOrWhiteSpace(stringValue);
⋮----
if (parameter is string s && s.Equals("Inverse", StringComparison.OrdinalIgnoreCase))
⋮----
public object ConvertBack(object? value, Type targetType, object? parameter, string language)
⋮----
throw new NotImplementedException();
</file>

<file path="Module_Core/Converters/Converter_IconCodeToGlyph.cs">
/// <summary>
/// Converts an icon code (like &#xE7B8; or E7B8) to a glyph character.
/// </summary>
public class Converter_IconCodeToGlyph : IValueConverter
⋮----
public object Convert(object? value, Type targetType, object? parameter, string language)
⋮----
if (value is string iconCode && !string.IsNullOrWhiteSpace(iconCode))
⋮----
// Handle HTML entity format: &#xE7B8;
if (iconCode.StartsWith("&#x") && iconCode.EndsWith(";"))
⋮----
string hex = iconCode.Substring(3, iconCode.Length - 4);
if (int.TryParse(hex, System.Globalization.NumberStyles.HexNumber, null, out int code))
⋮----
return ((char)code).ToString();
⋮----
// Handle raw hex format: E7B8
if (iconCode.Length == 4 && int.TryParse(iconCode, System.Globalization.NumberStyles.HexNumber, null, out int rawCode))
⋮----
return ((char)rawCode).ToString();
⋮----
// If it's already a single character or something else, return as is
⋮----
return "\uE7B8"; // Default box icon
⋮----
public object ConvertBack(object? value, Type targetType, object? parameter, string language)
⋮----
throw new NotImplementedException();
</file>

<file path="Module_Core/Converters/Converter_LoadNumberToOneBased.cs">
/// <summary>
/// Converts a zero-based load number to 1-based for display
/// </summary>
public class Converter_LoadNumberToOneBased : IValueConverter
⋮----
public object Convert(object? value, Type targetType, object? parameter, string language)
⋮----
public object ConvertBack(object? value, Type targetType, object? parameter, string language)
⋮----
if (value is string strValue && int.TryParse(strValue, out int displayNumber))
</file>

<file path="Module_Core/Converters/Converter_StringFormat.cs">
public class Converter_StringFormat : IValueConverter
⋮----
public object Convert(object? value, Type targetType, object? parameter, string language)
⋮----
return string.Format(format, value);
⋮----
public object ConvertBack(object? value, Type targetType, object? parameter, string language)
⋮----
throw new NotImplementedException();
</file>

<file path="Module_Core/Defaults/InforVisualDefaults.cs">
/// <summary>
/// Centralized defaults for Infor Visual integration.
/// Prefer loading these values from configuration where possible.
/// </summary>
public static class InforVisualDefaults
</file>

<file path="Module_Core/Defaults/WorkstationDefaults.cs">
/// <summary>
/// Centralized workstation configuration defaults.
/// Prefer loading these values from configuration where possible.
/// </summary>
public static class WorkstationDefaults
</file>

<file path="Module_Core/Models/Core/Model_Dao_Result_Factory.cs">
/// <summary>
/// Factory for creating Model_Dao_Result instances to avoid self-referencing cycles in model classes.
/// </summary>
public static class Model_Dao_Result_Factory
⋮----
public static Model_Dao_Result Failure(string? message, Exception? ex = null)
⋮----
return new Model_Dao_Result
⋮----
ErrorMessage = string.IsNullOrWhiteSpace(message) ? "Operation failed." : message,
⋮----
public static Model_Dao_Result Success(int affectedRows = 0)
⋮----
AffectedRows = Math.Max(0, affectedRows),
⋮----
public static Model_Dao_Result<T> Failure<T>(string? message, Exception? ex = null)
⋮----
public static Model_Dao_Result<T> Success<T>(T data, int affectedRows = 0)
</file>

<file path="Module_Core/Models/InforVisual/Model_InforVisualConnection.cs">
/// <summary>
/// Configuration for Infor Visual database connection
/// READ-ONLY access to VISUAL server, MTMFG database
/// </summary>
public class Model_InforVisualConnection
⋮----
/// Builds READ-ONLY connection string for Infor Visual
⋮----
public string GetConnectionString()
</file>

<file path="Module_Core/Models/InforVisual/Model_InforVisualPart.cs">
public partial class Model_InforVisualPart : ObservableObject
⋮----
/// <summary>Part Number (unique identifier)</summary>
⋮----
/// <summary>Part Description</summary>
⋮----
/// <summary>Part Type (PURCHASED, MANUFACTURED, etc.)</summary>
⋮----
/// <summary>Standard Unit Cost</summary>
⋮----
/// <summary>Primary Unit of Measure</summary>
⋮----
/// <summary>On-Hand Quantity at Warehouse 002</summary>
⋮----
/// <summary>Allocated Quantity (reserved for orders)</summary>
⋮----
/// <summary>Available Quantity (OnHandQty - AllocatedQty)</summary>
⋮----
/// <summary>Default Warehouse/Site</summary>
⋮----
/// <summary>Part Status (ACTIVE, OBSOLETE, etc.)</summary>
⋮----
/// <summary>Product Line/Category</summary>
</file>

<file path="Module_Core/Models/InforVisual/Model_InforVisualPO.cs">
public partial class Model_InforVisualPO : ObservableObject
</file>

<file path="Module_Core/Models/Reporting/Model_ReportRow.cs">
/// <summary>
/// Unified data structure for report rows across all modules
/// Used for end-of-day reporting with support for Receiving, Dunnage, Routing, and Volvo data
/// </summary>
public class Model_ReportRow
⋮----
/// Primary identifier from source table (GUID for receiving/dunnage, integer for routing)
⋮----
/// Purchase order number (normalized format: PO-XXXXXX)
⋮----
/// Part number/identifier
⋮----
/// Part description
⋮----
/// Quantity of items
⋮----
/// Weight in pounds
⋮----
/// Heat/Lot number (concatenated format: HeatNumber/LotNumber)
⋮----
/// Date when record was created (transaction date)
⋮----
/// Source module name (Receiving, Dunnage, Routing, Volvo)
⋮----
// Routing-specific fields
⋮----
/// Routing: Line number from PO
⋮----
/// Routing: Delivery recipient name
⋮----
/// Routing: Department name
⋮----
/// Routing: Physical location
⋮----
/// Routing: Package description
⋮----
/// Routing: Work order number
⋮----
/// Routing: Other reason (for non-PO packages)
⋮----
/// Employee number who created the record
⋮----
// Dunnage-specific fields
⋮----
/// Dunnage: Type name (Pallet, Box, etc.)
⋮----
/// Dunnage: Concatenated specifications (key:value pairs)
⋮----
// Volvo-specific fields
⋮----
/// Volvo: Shipment number
⋮----
/// Volvo: Receiver number
⋮----
/// Volvo: Shipment status
⋮----
/// Volvo: Count of parts in shipment
</file>

<file path="Module_Core/Models/Systems/Model_AuthenticationResult.cs">
/// <summary>
/// Result of an authentication attempt.
/// </summary>
public class Model_AuthenticationResult
⋮----
public static Model_AuthenticationResult SuccessResult(Model_User user)
⋮----
ArgumentNullException.ThrowIfNull(user);
⋮----
return new Model_AuthenticationResult
⋮----
public static Model_AuthenticationResult ErrorResult(string message)
⋮----
if (string.IsNullOrWhiteSpace(message))
⋮----
throw new ArgumentException("Error message cannot be null or whitespace.", nameof(message));
</file>

<file path="Module_Core/Models/Systems/Model_UserSession.cs">
/// <summary>
/// Represents the current active user session with timeout tracking.
/// Maintained in memory during application lifetime.
/// </summary>
public class Model_UserSession
⋮----
// ====================================================================
// User Information
⋮----
/// Authenticated user for this session
⋮----
// Session Metadata
⋮----
/// Computer name where session is active (from Environment.MachineName)
⋮----
/// Workstation type: "personal_workstation" or "shared_terminal"
⋮----
/// Authentication method used: "windows_auto" or "pin_login"
⋮----
/// Timestamp when user logged in
⋮----
/// Timestamp of last user interaction (mouse, keyboard, window focus)
/// Updated by UpdateLastActivity() method
⋮----
// Session Management
⋮----
/// Session timeout duration based on workstation type
/// 30 minutes for personal workstations, 15 minutes for shared terminals
⋮----
/// Time elapsed since last user activity
⋮----
/// Indicates if session has exceeded timeout duration
⋮----
/// Indicates if user has configured ERP access (copied from User model)
⋮----
// Methods
⋮----
/// Updates the last activity timestamp to current time.
/// Called on any user interaction event (mouse, keyboard, window focus).
⋮----
public void UpdateLastActivity()
⋮----
// Constructor
⋮----
/// Default constructor
⋮----
/// Constructor that requires an authenticated user.
⋮----
/// <param name="user">Authenticated user for this session.</param>
⋮----
ArgumentNullException.ThrowIfNull(user);
</file>

<file path="Module_Core/Models/Systems/Model_ValidationResult.cs">
/// <summary>
/// Result of a validation operation.
/// </summary>
public class Model_ValidationResult
⋮----
public static Model_ValidationResult Valid() => new()
⋮----
public static Model_ValidationResult Invalid(string? message) => new()
⋮----
ErrorMessage = string.IsNullOrWhiteSpace(message) ? "Validation failed." : message
</file>

<file path="Module_Core/Services/Database/Service_LoggingUtility.cs">
/// <summary>
/// Implements file-based logging with daily rotation
/// Logs are written to %APPDATA%\MTM_Receiving_Application\Logs\
/// </summary>
public class Service_LoggingUtility : IService_LoggingUtility
⋮----
_logDirectory = Path.Combine(
Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
⋮----
// Start background logging thread
System.Threading.Tasks.Task.Factory.StartNew(ProcessLogQueue,
⋮----
private void ProcessLogQueue()
⋮----
foreach (var logEntry in _logQueue.GetConsumingEnumerable())
⋮----
File.AppendAllText(logFilePath, logEntry, Encoding.UTF8);
⋮----
System.Diagnostics.Debug.WriteLine($"Background logging failed: {ex.Message}");
⋮----
/// Logs an informational message
⋮----
/// <param name="message"></param>
/// <param name="context"></param>
public void LogInfo(string message, string? context = null)
⋮----
/// Logs a warning message
⋮----
public void LogWarning(string message, string? context = null)
⋮----
/// Logs an error message with optional exception
⋮----
/// <param name="exception"></param>
⋮----
public void LogError(string message, Exception? exception = null, string? context = null)
⋮----
/// Logs a critical error message with optional exception
⋮----
public void LogCritical(string message, Exception? exception = null, string? context = null)
⋮----
/// Logs a fatal error message with optional exception
⋮----
public void LogFatal(string message, Exception? exception = null, string? context = null)
⋮----
public Task LogInfoAsync(string message, string? context = null)
⋮----
public Task LogErrorAsync(string message, Exception? exception = null, string? context = null)
⋮----
/// Gets the path to today's log file
⋮----
public string GetCurrentLogFilePath()
⋮----
return Path.Combine(_logDirectory, fileName);
⋮----
/// Ensures the log directory exists and is writable
⋮----
public bool EnsureLogDirectoryExists()
⋮----
if (!Directory.Exists(_logDirectory))
⋮----
Directory.CreateDirectory(_logDirectory);
⋮----
// Can't log this error since logging is broken
System.Diagnostics.Debug.WriteLine($"Failed to create log directory: {ex.Message}");
⋮----
/// Archives old log files (older than specified days)
⋮----
/// <param name="daysToKeep"></param>
public int ArchiveOldLogs(int daysToKeep = 30)
⋮----
var cutoffDate = DateTime.Now.AddDays(-daysToKeep);
var archiveDirectory = Path.Combine(_logDirectory, "archive");
⋮----
foreach (var file in Directory.GetFiles(_logDirectory, "app_*.log"))
⋮----
var fileInfo = new FileInfo(file);
⋮----
// Create archive directory if it doesn't exist
if (!Directory.Exists(archiveDirectory))
⋮----
Directory.CreateDirectory(archiveDirectory);
⋮----
// Move file to archive
string archivePath = Path.Combine(archiveDirectory, fileInfo.Name);
⋮----
// If file already exists in archive, delete it first
if (File.Exists(archivePath))
⋮----
File.Delete(archivePath);
⋮----
File.Move(file, archivePath);
⋮----
/// Core logging method that writes to file
⋮----
/// <param name="severity"></param>
⋮----
private void WriteLog(string severity, string message, Exception? exception, string? context)
⋮----
var logEntry = new StringBuilder();
⋮----
// Timestamp and severity
logEntry.AppendLine($"[{DateTime.Now:yyyy-MM-dd HH:mm:ss.fff}] [{severity}] {(context != null ? $"[{context}]" : "")}");
logEntry.AppendLine($"Message: {message}");
⋮----
// Add context information if provided
if (!string.IsNullOrEmpty(context))
⋮----
logEntry.AppendLine($"Context: User={Environment.UserName}, Machine={Environment.MachineName}");
⋮----
// Add exception details if provided
⋮----
logEntry.AppendLine($"Exception: {exception.GetType().FullName}: {exception.Message}");
logEntry.AppendLine($"Stack Trace:");
logEntry.AppendLine(exception.StackTrace);
⋮----
// Log inner exceptions
⋮----
logEntry.AppendLine($"Inner Exception: {innerException.GetType().FullName}: {innerException.Message}");
logEntry.AppendLine(innerException.StackTrace);
⋮----
logEntry.AppendLine(); // Blank line between entries
⋮----
// Queue for background writing
_logQueue.Add(logEntry.ToString());
⋮----
// Also write to Debug output for development
System.Diagnostics.Debug.Write(logEntry.ToString());
⋮----
// Last resort - write to debug output if file logging fails
System.Diagnostics.Debug.WriteLine($"LOGGING FAILED: {ex.Message}");
System.Diagnostics.Debug.WriteLine($"Original message: {message}");
⋮----
public Task LogWarningAsync(string message, string? context = null)
</file>

<file path="Module_Core/Services/Service_Focus.cs">
public class Service_Focus : IService_Focus
⋮----
public void SetFocus(Control control)
⋮----
// Ensure we are on the UI thread or use DispatcherQueue
⋮----
control.DispatcherQueue.TryEnqueue(() =>
⋮----
control.Focus(FocusState.Programmatic);
⋮----
public void SetFocusFirstInput(DependencyObject container)
⋮----
fe.DispatcherQueue.TryEnqueue(() =>
⋮----
public void AttachFocusOnVisibility(FrameworkElement view, Control? targetControl = null)
⋮----
// Initial check if already visible and loaded
⋮----
// Hook into Loaded to handle initial focus
⋮----
// Hook into Visibility changes
view.RegisterPropertyChangedCallback(UIElement.VisibilityProperty, (_, _) =>
⋮----
private Control? FindFirstFocusableChild(DependencyObject parent)
⋮----
int childrenCount = VisualTreeHelper.GetChildrenCount(parent);
⋮----
var child = VisualTreeHelper.GetChild(parent, i);
⋮----
private bool IsFocusable(Control control)
⋮----
// Check for specific input types we want to prioritize
⋮----
// Buttons and other controls are also focusable, but maybe we prefer inputs?
// For now, let's include them but maybe inputs should be prioritized if we were doing a deeper search.
// But since we are doing a depth-first search (or breadth-first?), the order matters.
// The current implementation is depth-first.
</file>

<file path="Module_Dunnage/Data/Dao_DunnageLine.cs">
/// <summary>
/// Data Access Object for label_table_dunnage table
/// Provides CRUD operations using stored procedures
/// </summary>
public static class Dao_DunnageLine
⋮----
/// Sets the error handler service (dependency injection)
⋮----
/// <param name="errorHandler"></param>
public static void SetErrorHandler(IService_ErrorHandler errorHandler)
⋮----
/// Inserts a new dunnage line record into the database
⋮----
/// <param name="line">DunnageLine model to insert</param>
/// <returns>Model_Dao_Result with success status and affected rows</returns>
public static async Task<Model_Dao_Result> InsertDunnageLineAsync(Model_DunnageLine line)
⋮----
// Get connection string
string connectionString = Helper_Database_Variables.GetConnectionString(useProduction: true);
⋮----
// Prepare stored procedure parameters
⋮----
new MySqlParameter("@p_Line1", line.Line1 ?? string.Empty),
new MySqlParameter("@p_Line2", line.Line2 ?? string.Empty),
new MySqlParameter("@p_PONumber", line.PONumber),
new MySqlParameter("@p_Date", line.Date),
new MySqlParameter("@p_EmployeeNumber", line.EmployeeNumber),
new MySqlParameter("@p_VendorName", line.VendorName ?? "Unknown"),
new MySqlParameter("@p_Location", line.Location ?? string.Empty),
new MySqlParameter("@p_Status", MySqlDbType.Int32) { Direction = System.Data.ParameterDirection.Output },
new MySqlParameter("@p_ErrorMsg", MySqlDbType.VarChar, 500) { Direction = System.Data.ParameterDirection.Output }
⋮----
// Validate parameters
if (!Helper_Database_StoredProcedure.ValidateParameters(parameters))
⋮----
return new Model_Dao_Result
⋮----
// Execute stored procedure
var result = await Helper_Database_StoredProcedure.ExecuteAsync(
⋮----
var errorResult = new Model_Dao_Result
⋮----
// Log the error using error handler if available
⋮----
await _errorHandler.HandleErrorAsync(
</file>

<file path="Module_Dunnage/Data/Dao_DunnagePart.cs">
public class Dao_DunnagePart
⋮----
public virtual async Task<Model_Dao_Result<List<Model_DunnagePart>>> GetAllAsync()
⋮----
public virtual async Task<Model_Dao_Result<List<Model_DunnagePart>>> GetByTypeAsync(int typeId)
⋮----
System.Diagnostics.Debug.WriteLine($"Dao_DunnagePart: GetByTypeAsync called for typeId={typeId}");
⋮----
System.Diagnostics.Debug.WriteLine($"Dao_DunnagePart: GetByTypeAsync returned {result.Data?.Count ?? 0} parts. Success: {result.IsSuccess}");
⋮----
public virtual async Task<Model_Dao_Result<Model_DunnagePart>> GetByIdAsync(string partId)
⋮----
public virtual async Task<Model_Dao_Result<int>> InsertAsync(string partId, int typeId, string specValues, string homeLocation, string user)
⋮----
var pNewId = new MySqlParameter("@p_new_id", MySqlDbType.Int32)
⋮----
new MySqlParameter("@p_part_id", partId),
new MySqlParameter("@p_type_id", typeId),
new MySqlParameter("@p_spec_values", specValues),
new MySqlParameter("@p_home_location", homeLocation),
new MySqlParameter("@p_user", user),
⋮----
var result = await Helper_Database_StoredProcedure.ExecuteAsync(
⋮----
return Model_Dao_Result_Factory.Success<int>(Convert.ToInt32(pNewId.Value));
⋮----
public virtual async Task<Model_Dao_Result> UpdateAsync(int id, string specValues, string homeLocation, string user)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
public virtual async Task<Model_Dao_Result> DeleteAsync(int id)
⋮----
public virtual async Task<Model_Dao_Result<int>> CountTransactionsAsync(string partId)
⋮----
reader => reader.GetInt32(reader.GetOrdinal("transaction_count")),
⋮----
public virtual async Task<Model_Dao_Result<List<Model_DunnagePart>>> SearchAsync(string searchText, int? typeId = null)
⋮----
private Model_DunnagePart MapFromReader(IDataReader reader)
⋮----
return new Model_DunnagePart
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
PartId = reader.GetString(reader.GetOrdinal("part_id")),
TypeId = reader.GetInt32(reader.GetOrdinal("type_id")),
SpecValues = reader.IsDBNull(reader.GetOrdinal("spec_values")) ? "{}" : reader.GetString(reader.GetOrdinal("spec_values")),
HomeLocation = reader.IsDBNull(reader.GetOrdinal("home_location")) ? string.Empty : reader.GetString(reader.GetOrdinal("home_location")),
CreatedBy = reader.GetString(reader.GetOrdinal("created_by")),
CreatedDate = reader.GetDateTime(reader.GetOrdinal("created_date")),
ModifiedBy = reader.IsDBNull(reader.GetOrdinal("modified_by")) ? null : reader.GetString(reader.GetOrdinal("modified_by")),
ModifiedDate = reader.IsDBNull(reader.GetOrdinal("modified_date")) ? null : reader.GetDateTime(reader.GetOrdinal("modified_date"))
</file>

<file path="Module_Dunnage/Data/Dao_DunnageSpec.cs">
public class Dao_DunnageSpec
⋮----
public virtual async Task<Model_Dao_Result<List<Model_DunnageSpec>>> GetByTypeAsync(int typeId)
⋮----
public virtual async Task<Model_Dao_Result<List<Model_DunnageSpec>>> GetAllAsync()
⋮----
public virtual async Task<Model_Dao_Result<Model_DunnageSpec>> GetByIdAsync(int id)
⋮----
public virtual async Task<Model_Dao_Result<int>> InsertAsync(int typeId, string specKey, string specValue, string user)
⋮----
var pNewId = new MySqlParameter("@p_new_id", MySqlDbType.Int32)
⋮----
new MySqlParameter("@p_type_id", typeId),
new MySqlParameter("@p_spec_key", specKey),
new MySqlParameter("@p_spec_value", specValue),
new MySqlParameter("@p_user", user),
⋮----
var result = await Helper_Database_StoredProcedure.ExecuteAsync(
⋮----
return Model_Dao_Result_Factory.Success<int>(Convert.ToInt32(pNewId.Value));
⋮----
public virtual async Task<Model_Dao_Result> UpdateAsync(int id, string specValue, string user)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
public virtual async Task<Model_Dao_Result> DeleteByIdAsync(int id)
⋮----
public virtual async Task<Model_Dao_Result> DeleteByTypeAsync(int typeId)
⋮----
public virtual async Task<Model_Dao_Result<int>> CountPartsUsingSpecAsync(int typeId, string specKey)
⋮----
reader => reader.GetInt32(reader.GetOrdinal("part_count")),
⋮----
/// <summary>
/// Get union of all unique spec keys across all types (for dynamic CSV columns)
/// </summary>
/// <returns>List of distinct spec keys ordered alphabetically</returns>
public virtual async Task<Model_Dao_Result<List<string>>> GetAllSpecKeysAsync()
⋮----
reader => reader.GetString(reader.GetOrdinal("SpecKey"))
⋮----
private Model_DunnageSpec MapFromReader(IDataReader reader)
⋮----
return new Model_DunnageSpec
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
TypeId = reader.GetInt32(reader.GetOrdinal("type_id")),
SpecKey = reader.GetString(reader.GetOrdinal("spec_key")),
SpecValue = reader.IsDBNull(reader.GetOrdinal("spec_value")) ? "{}" : reader.GetString(reader.GetOrdinal("spec_value")),
CreatedBy = reader.GetString(reader.GetOrdinal("created_by")),
CreatedDate = reader.GetDateTime(reader.GetOrdinal("created_date")),
ModifiedBy = reader.IsDBNull(reader.GetOrdinal("modified_by")) ? null : reader.GetString(reader.GetOrdinal("modified_by")),
ModifiedDate = reader.IsDBNull(reader.GetOrdinal("modified_date")) ? null : reader.GetDateTime(reader.GetOrdinal("modified_date"))
</file>

<file path="Module_Dunnage/Data/Dao_DunnageUserPreference.cs">
public class Dao_DunnageUserPreference
⋮----
public virtual async Task<Model_Dao_Result> UpsertAsync(string userId, string key, string value)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
public virtual async Task<Model_Dao_Result<List<Model_IconDefinition>>> GetRecentlyUsedIconsAsync(string userId, int count)
⋮----
reader => new Model_IconDefinition
⋮----
IconName = reader.GetString(reader.GetOrdinal("icon_name"))
</file>

<file path="Module_Dunnage/Enums/Enum_DunnageAdminSection.cs">
/// <summary>
/// Enum for Dunnage Admin UI sections
/// </summary>
⋮----
/// Main navigation hub (4-card view)
⋮----
/// Dunnage Types management (CRUD on dunnage_types table)
⋮----
/// Part Master management (CRUD on dunnage_part_numbers table)
⋮----
/// Spec Definitions management (CRUD on dunnage_specs table)
⋮----
/// Inventoried Dunnage List (CRUD on dunnage_requires_inventory_list table)
</file>

<file path="Module_Dunnage/Models/Model_CustomFieldDefinition.cs">
/// <summary>
/// Represents a user-defined custom field for dunnage types.
/// Corresponds to dunnage_custom_fields table.
/// </summary>
public partial class Model_CustomFieldDefinition : ObservableObject
⋮----
private DateTime _createdDate = DateTime.Now;
⋮----
/// Returns a summary string for display in the UI
⋮----
public string GetSummary()
</file>

<file path="Module_Dunnage/Models/Model_DunnageLoad.cs">
/// <summary>
/// Represents a received dunnage load transaction.
/// Database Table: dunnage_history
/// </summary>
public partial class Model_DunnageLoad : ObservableObject
⋮----
private Guid _loadUuid;
⋮----
/// Gets the MaterialIconKind for the dunnage type
⋮----
if (!string.IsNullOrEmpty(TypeIcon) && Enum.TryParse<MaterialIconKind>(TypeIcon, true, out var kind))
⋮----
private DateTime _receivedDate = DateTime.Now;
⋮----
private DateTime _createdDate = DateTime.Now;
</file>

<file path="Module_Dunnage/Services/Service_DunnageCSVWriter.cs">
public class Service_DunnageCSVWriter : IService_DunnageCSVWriter
⋮----
private readonly IService_MySQL_Dunnage _dunnageService;
private readonly IService_UserSessionManager _sessionManager;
private readonly IService_LoggingUtility _logger;
private readonly IService_ErrorHandler _errorHandler;
⋮----
/// <summary>
/// Get RFC 4180 compliant CSV configuration
/// T103-T109: RFC 4180 CSV Formatting
/// </summary>
private CsvConfiguration GetRfc4180Configuration()
⋮----
return new CsvConfiguration(CultureInfo.InvariantCulture)
⋮----
// T103: RFC 4180 settings
Delimiter = ",",              // Standard comma delimiter
Quote = '"',                  // Double quote for field escaping
HasHeaderRecord = true,       // Include header row
⋮----
// T106: CRLF line endings
NewLine = "\r\n",            // RFC 4180 requires CRLF
⋮----
// T104: Automatic escaping for special characters (commas, quotes, newlines)
ShouldQuote = args => !string.IsNullOrEmpty(args.Field) &&
(args.Field.Contains(",") ||
args.Field.Contains("\"") ||
args.Field.Contains("\n") ||
args.Field.Contains("\r")),
⋮----
// T105: UTF-8 with BOM for Excel/LabelView compatibility
⋮----
// T108: Invariant culture for numeric formatting (period as decimal separator)
// Already handled by CultureInfo.InvariantCulture
⋮----
public async Task<Model_CSVWriteResult> WriteToCSVAsync(List<Model_DunnageLoad> loads)
⋮----
// Default to DunnageData.csv for backward compatibility
⋮----
/// Write dunnage loads to CSV file (wizard workflow export)
/// Uses fixed columns based on selected type's specs
⋮----
/// <param name="loads"></param>
/// <param name="typeName"></param>
public async Task<Model_CSVWriteResult> WriteToCsvAsync(List<Model_DunnageLoad> loads, string typeName)
⋮----
await _logger.LogWarningAsync("WriteToCsvAsync called with no loads to export");
return new Model_CSVWriteResult { ErrorMessage = "No loads to export." };
⋮----
await _logger.LogInfoAsync($"Starting CSV export for {loads.Count} loads of type '{typeName}'");
⋮----
// FR-046: Get dynamic spec keys
var specKeys = await _dunnageService.GetAllSpecKeysAsync();
specKeys.Sort(); // FR-042: Alphabetically sorted
⋮----
// Prepare records
⋮----
dynamic record = new ExpandoObject();
⋮----
// FR-041: Fixed columns
⋮----
dict["ReceivedDate"] = FormatDateTime(load.ReceivedDate); // T109: yyyy-MM-dd HH:mm:ss
⋮----
// FR-042: Dynamic columns
⋮----
if (load.Specs != null && load.Specs.TryGetValue(key, out object? value))
⋮----
dict[key] = ""; // FR-043: Empty string if missing
⋮----
records.Add(record);
⋮----
// Write to local path
⋮----
await _logger.LogInfoAsync($"Successfully wrote {records.Count} records to local CSV: {localPath}");
⋮----
// Write to network path
⋮----
// Ensure directory exists for network path
var networkDir = Path.GetDirectoryName(networkPath);
if (!string.IsNullOrEmpty(networkDir) && !Directory.Exists(networkDir))
⋮----
Directory.CreateDirectory(networkDir);
⋮----
await _logger.LogInfoAsync($"Successfully wrote {records.Count} records to network CSV: {networkPath}");
⋮----
await _logger.LogErrorAsync($"Failed to write to network path '{networkPath}': {ex.Message}");
// FR-044: Network failure graceful handling
⋮----
return new Model_CSVWriteResult
⋮----
await _logger.LogErrorAsync($"CSV export failed for type '{typeName}': {ex.Message}");
await _errorHandler.HandleErrorAsync($"Export failed: {ex.Message}", Enum_ErrorSeverity.Error, ex, true);
return new Model_CSVWriteResult { ErrorMessage = $"Export failed: {ex.Message}" };
⋮----
/// Write dunnage loads to CSV with dynamic columns for all spec keys
/// Used for Manual Entry and Edit Mode exports (all types in one file)
⋮----
/// <param name="allSpecKeys"></param>
/// <param name="filename"></param>
public async Task<Model_CSVWriteResult> WriteDynamicCsvAsync(
⋮----
await _logger.LogWarningAsync("WriteDynamicCsvAsync called with no loads to export");
⋮----
await _logger.LogInfoAsync($"Starting dynamic CSV export for {loads.Count} loads");
⋮----
// Use provided spec keys or fetch all
var specKeys = allSpecKeys ?? await _dunnageService.GetAllSpecKeysAsync();
specKeys.Sort(); // Alphabetically sorted
⋮----
// Fixed columns
⋮----
// Dynamic spec columns
⋮----
dict[key] = ""; // Blank cell for specs not applicable to this load's type
⋮----
// Generate filename if not provided
⋮----
// Write to network path (best-effort)
⋮----
await _logger.LogWarningAsync("Network path not available for CSV export");
⋮----
await _errorHandler.HandleErrorAsync($"Dynamic CSV export failed: {ex.Message}", Enum_ErrorSeverity.Error, ex, true);
⋮----
/// Export selected loads from DataGrid (Manual Entry or Edit Mode)
/// Includes dynamic spec columns based on types in selection
⋮----
/// <param name="selectedLoads"></param>
/// <param name="includeAllSpecColumns"></param>
public async Task<Model_CSVWriteResult> ExportSelectedLoadsAsync(
⋮----
return new Model_CSVWriteResult { ErrorMessage = "No loads selected for export." };
⋮----
// Include all spec keys across all types
specKeys = await _dunnageService.GetAllSpecKeysAsync();
⋮----
// Only include spec keys used by selected loads' types
⋮----
.Where(l => l.TypeId.HasValue)
.Select(l => l.TypeId!.Value)
.Distinct()
.ToList();
⋮----
var specs = await _dunnageService.GetSpecsForTypeAsync(typeId);
⋮----
var keys = specs.Data.Select(s => s.SpecKey).Distinct();
specKeys.AddRange(keys);
⋮----
specKeys = specKeys.Distinct().ToList();
⋮----
await _errorHandler.HandleErrorAsync($"Selected loads export failed: {ex.Message}", Enum_ErrorSeverity.Error, ex, true);
⋮----
/// Validate network path availability (for dual-path writing)
⋮----
/// <param name="timeout"></param>
public async Task<bool> IsNetworkPathAvailableAsync(int timeout = 3)
⋮----
return await Task.Run(() =>
⋮----
return Directory.Exists(networkRoot);
⋮----
/// Get local CSV file path for current user
⋮----
public string GetLocalCsvPath(string filename)
⋮----
var appData = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
var folder = Path.Combine(appData, "MTM_Receiving_Application");
if (!Directory.Exists(folder))
⋮----
Directory.CreateDirectory(folder);
⋮----
return Path.Combine(folder, filename);
⋮----
/// Get network CSV file path for current user
⋮----
public string GetNetworkCsvPath(string filename)
⋮----
private async Task WriteCsvFileAsync(string path, IEnumerable<dynamic> records)
⋮----
var encoding = new UTF8Encoding(true); // true = include BOM
⋮----
await using (var writer = new StreamWriter(path, false, encoding))
await using (var csv = new CsvWriter(writer, GetRfc4180Configuration()))
⋮----
await csv.WriteRecordsAsync(records);
⋮----
/// Format date/time values as yyyy-MM-dd HH:mm:ss (T109)
⋮----
/// <param name="value"></param>
private string FormatDateTime(DateTime value)
⋮----
return value.ToString("yyyy-MM-dd HH:mm:ss", CultureInfo.InvariantCulture);
⋮----
/// Clear CSV files from both local and network paths
/// If filenamePattern is provided, only clear files matching the pattern
/// If null, clear all CSV files in the user directories
⋮----
/// <param name="filenamePattern">Optional pattern to match (e.g., "DunnageData*.csv")</param>
/// <returns>Result indicating success/failure for local and network operations</returns>
public async Task<Model_CSVDeleteResult> ClearCSVFilesAsync(string? filenamePattern = null)
⋮----
var result = new Model_CSVDeleteResult();
⋮----
await _logger.LogInfoAsync($"Starting CSV file clearing with pattern: {filenamePattern ?? "all"}");
⋮----
// Clear local files
⋮----
var localFolder = Path.GetDirectoryName(GetLocalCsvPath("dummy.csv"));
if (Directory.Exists(localFolder))
⋮----
var filesToClear = Directory.GetFiles(localFolder, filenamePattern ?? "*.csv");
⋮----
// Overwrite with header only
await using var writer = new StreamWriter(file, false, new UTF8Encoding(true));
await using var csv = new CsvWriter(writer, GetRfc4180Configuration());
⋮----
csv.NextRecord();
⋮----
await _logger.LogInfoAsync($"Cleared local CSV file: {file}");
⋮----
result.LocalDeleted = true; // No directory means no files to clear
await _logger.LogInfoAsync("Local CSV directory does not exist - no files to clear");
⋮----
errors.Add(result.LocalError);
await _logger.LogErrorAsync($"Failed to clear local CSV files: {ex.Message}");
⋮----
// Clear network files (best-effort)
⋮----
var networkFolder = Path.GetDirectoryName(GetNetworkCsvPath("dummy.csv"));
if (Directory.Exists(networkFolder))
⋮----
var filesToClear = Directory.GetFiles(networkFolder, filenamePattern ?? "*.csv");
⋮----
await _logger.LogInfoAsync($"Cleared network CSV file: {file}");
⋮----
result.NetworkDeleted = true; // No directory means no files to clear
await _logger.LogInfoAsync("Network CSV directory does not exist - no files to clear");
⋮----
errors.Add("Network path not available");
await _logger.LogWarningAsync("Network path not available for CSV clearing");
⋮----
errors.Add(result.NetworkError);
await _logger.LogErrorAsync($"Failed to clear network CSV files: {ex.Message}");
⋮----
await _logger.LogInfoAsync($"CSV clearing completed. Local: {result.LocalDeleted}, Network: {result.NetworkDeleted}");
⋮----
await _errorHandler.HandleErrorAsync($"CSV clearing failed: {ex.Message}", Enum_ErrorSeverity.Error, ex, true);
</file>

<file path="Module_Dunnage/Services/Service_DunnageWorkflow.cs">
public class Service_DunnageWorkflow : IService_DunnageWorkflow
⋮----
private readonly IService_MySQL_Dunnage _dunnageService;
private readonly IService_DunnageCSVWriter _csvWriter;
private readonly IService_UserSessionManager _sessionManager;
private readonly IService_LoggingUtility _logger;
private readonly IService_ErrorHandler _errorHandler;
private readonly IService_ViewModelRegistry _viewModelRegistry;
⋮----
public Task<bool> StartWorkflowAsync()
⋮----
// Check if user has a default mode set
⋮----
if (currentUser != null && !string.IsNullOrEmpty(currentUser.DefaultDunnageMode))
⋮----
// Skip mode selection and go directly to the default mode
switch (currentUser.DefaultDunnageMode.ToLower())
⋮----
// Invalid default, show mode selection
⋮----
// No default mode, show mode selection
⋮----
return Task.FromResult(true);
⋮----
public Task<Model_WorkflowStepResult> AdvanceToNextStepAsync()
⋮----
return Task.FromResult(new Model_WorkflowStepResult { IsSuccess = false, ErrorMessage = "Please select a dunnage type." });
⋮----
return Task.FromResult(new Model_WorkflowStepResult { IsSuccess = false, ErrorMessage = "Please select a part." });
⋮----
return Task.FromResult(new Model_WorkflowStepResult { IsSuccess = false, ErrorMessage = "Quantity must be greater than zero." });
⋮----
// Add current load to session before advancing to Review
⋮----
return Task.FromResult(new Model_WorkflowStepResult { IsSuccess = false, ErrorMessage = "Already at Review step. Use Save to finish." });
⋮----
return Task.FromResult(new Model_WorkflowStepResult { IsSuccess = true, TargetStep = CurrentStep });
⋮----
_errorHandler.HandleErrorAsync("Error advancing step", Enum_ErrorSeverity.Error, ex, true);
return Task.FromResult(new Model_WorkflowStepResult { IsSuccess = false, ErrorMessage = ex.Message });
⋮----
public void GoToStep(Enum_DunnageWorkflowStep step)
⋮----
public async Task<Model_SaveResult> SaveToCSVOnlyAsync()
⋮----
// If no loads in list, try to create one from current session state
⋮----
loads.Add(load);
⋮----
return new Model_SaveResult { IsSuccess = false, ErrorMessage = "No data to save." };
⋮----
var csvResult = await _csvWriter.WriteToCSVAsync(loads);
⋮----
return new Model_SaveResult
⋮----
await _errorHandler.HandleErrorAsync("Error saving CSV", Enum_ErrorSeverity.Error, ex, true);
return new Model_SaveResult { IsSuccess = false, ErrorMessage = ex.Message };
⋮----
public async Task<Model_SaveResult> SaveToDatabaseOnlyAsync()
⋮----
var dbResult = await _dunnageService.SaveLoadsAsync(loads);
⋮----
await _errorHandler.HandleErrorAsync("Error saving to database", Enum_ErrorSeverity.Error, ex, true);
⋮----
public async Task<Model_SaveResult> SaveSessionAsync()
⋮----
// Save to DB
⋮----
// Export to CSV
⋮----
await _errorHandler.HandleErrorAsync("Error saving session", Enum_ErrorSeverity.Error, ex, true);
⋮----
public void ClearSession()
⋮----
CurrentSession = new Model_DunnageSession();
_viewModelRegistry.ClearAllInputs();
⋮----
public async Task<Model_CSVDeleteResult> ResetCSVFilesAsync()
⋮----
return await _csvWriter.ClearCSVFilesAsync();
⋮----
public void AddCurrentLoadToSession()
⋮----
// Default location to part's home location if not specified
var location = string.IsNullOrWhiteSpace(CurrentSession.Location)
⋮----
// Default PO number if not specified
var poNumber = string.IsNullOrWhiteSpace(CurrentSession.PONumber)
⋮----
var load = new Model_DunnageLoad
⋮----
LoadUuid = Guid.NewGuid(),
⋮----
CurrentSession.Loads.Add(load);
_logger.LogInfo($"Added load to session: Part {load.PartId}, Qty {load.Quantity}", "DunnageWorkflow");
⋮----
_errorHandler.HandleErrorAsync("Error adding load to session", Enum_ErrorSeverity.Medium, ex, false);
⋮----
private Model_DunnageLoad CreateLoadFromCurrentSession()
⋮----
return new Model_DunnageLoad
</file>

<file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_AddTypeDialogViewModel.cs">
/// <summary>
/// ViewModel for Add New Type Dialog with real-time validation and custom field preview
/// </summary>
public partial class ViewModel_Dunnage_AddTypeDialog : ViewModel_Shared_Base
⋮----
private readonly IService_MySQL_Dunnage _dunnageService;
private readonly DispatcherQueue _dispatcherQueue;
⋮----
private MaterialIconKind _selectedIcon = MaterialIconKind.PackageVariantClosed; // Default icon
⋮----
_dispatcherQueue = DispatcherQueue.GetForCurrentThread();
⋮----
// Initialize validation timer
_validationTimer = _dispatcherQueue.CreateTimer();
_validationTimer.Interval = TimeSpan.FromMilliseconds(300);
⋮----
// Load recently used icons
⋮----
private async Task SaveTypeAsync()
⋮----
// Save type to database
var typeResult = await _dunnageService.InsertTypeAsync(TypeName, SelectedIcon.ToString());
⋮----
await _errorHandler.ShowUserErrorAsync(typeResult.ErrorMessage, "Save Failed", nameof(SaveTypeAsync));
⋮----
// Save custom fields
⋮----
var fieldResult = await _dunnageService.InsertCustomFieldAsync(typeId, field);
⋮----
await _errorHandler.ShowUserErrorAsync($"Failed to save field '{field.FieldName}': {fieldResult.ErrorMessage}",
⋮----
// Update recently used icons
await _dunnageService.UpsertUserPreferenceAsync($"RecentIcon_{SelectedIcon}", DateTime.Now.ToString("O"));
⋮----
_errorHandler.HandleException(ex, Enum_ErrorSeverity.Medium,
⋮----
private void AddField()
⋮----
if (string.IsNullOrWhiteSpace(FieldName) || CustomFields.Count >= 25)
⋮----
// Update existing field
⋮----
// Add new field
var field = new Model_CustomFieldDefinition
⋮----
CustomFields.Add(field);
⋮----
// Clear form
⋮----
// Update warnings and limits
⋮----
private void EditField(Model_CustomFieldDefinition field)
⋮----
private void DeleteField(Model_CustomFieldDefinition field)
⋮----
CustomFields.Remove(field);
⋮----
// Update display order
⋮----
partial void OnTypeNameChanged(string value)
⋮----
partial void OnFieldNameChanged(string value)
⋮----
private void OnValidationTimerTick(object? sender, object e)
⋮----
private async void ValidateTypeName()
⋮----
if (string.IsNullOrWhiteSpace(TypeName))
⋮----
// Check for duplicate
var result = await _dunnageService.CheckDuplicateTypeNameAsync(TypeName);
⋮----
DuplicateTypeId = result.Data.ToString();
⋮----
private void ValidateFieldName()
⋮----
if (string.IsNullOrWhiteSpace(FieldName))
⋮----
return; // Don't show error if empty (only on add)
⋮----
// Check for special characters
if (FieldName.Any(c => "<>{}[]|\\".Contains(c)))
⋮----
// Check for duplicate field name
if (CustomFields.Any(f => f.FieldName.Equals(FieldName, StringComparison.OrdinalIgnoreCase) && f != EditingField))
⋮----
private void UpdateCanSave()
⋮----
CanSave = !string.IsNullOrWhiteSpace(TypeName) &&
string.IsNullOrEmpty(TypeNameError) &&
⋮----
private async Task LoadRecentlyUsedIconsAsync()
⋮----
var result = await _dunnageService.GetRecentlyUsedIconsAsync(6);
⋮----
RecentlyUsedIcons.Clear();
⋮----
RecentlyUsedIcons.Add(icon);
⋮----
await _logger.LogErrorAsync($"Failed to load recently used icons: {ex.Message}");
⋮----
public void OnDragItemsCompleted()
⋮----
// Update DisplayOrder based on current position in collection
</file>

<file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_AdminInventoryViewModel.cs">
/// <summary>
/// ViewModel for managing the Inventoried Parts List
/// Enables adding, editing, and removing parts that require Visual ERP inventory tracking
/// </summary>
public partial class ViewModel_Dunnage_AdminInventory : ViewModel_Shared_Base
⋮----
private readonly Dao_InventoriedDunnage _daoInventory;
private readonly Dao_DunnagePart _daoPart;
private readonly IService_DunnageAdminWorkflow _adminWorkflow;
private readonly IService_Window _windowService;
⋮----
/// Gets whether a part is currently selected
⋮----
_daoInventory = daoInventory ?? throw new ArgumentNullException(nameof(daoInventory));
_daoPart = daoPart ?? throw new ArgumentNullException(nameof(daoPart));
_adminWorkflow = adminWorkflow ?? throw new ArgumentNullException(nameof(adminWorkflow));
_windowService = windowService ?? throw new ArgumentNullException(nameof(windowService));
⋮----
/// Initialize the view model - loads inventoried parts
⋮----
public async Task InitializeAsync()
⋮----
/// Load all parts from the inventoried list
⋮----
private async Task LoadInventoriedPartsAsync()
⋮----
var result = await _daoInventory.GetAllAsync();
⋮----
InventoriedParts.Clear();
⋮----
InventoriedParts.Add(part);
⋮----
await _errorHandler.ShowUserErrorAsync(
⋮----
_errorHandler.HandleException(
⋮----
/// Show dialog to add a new part to the inventoried list
⋮----
private async Task ShowAddToListAsync()
⋮----
var result = await dialog.ShowAsync();
⋮----
// Dialog handles the insert, just reload the list
⋮----
/// Show dialog to edit an existing inventoried entry
⋮----
private async Task ShowEditEntryAsync()
⋮----
var dialog = new ContentDialog
⋮----
XamlRoot = _windowService.GetXamlRoot()
⋮----
// Create the edit form
var stackPanel = new StackPanel { Spacing = 12 };
⋮----
// Part ID (readonly)
stackPanel.Children.Add(new TextBlock { Text = "Part ID (read-only)", FontWeight = Microsoft.UI.Text.FontWeights.SemiBold });
var partIdBox = new TextBox
⋮----
stackPanel.Children.Add(partIdBox);
⋮----
// Inventory Method
stackPanel.Children.Add(new TextBlock { Text = "Inventory Method", FontWeight = Microsoft.UI.Text.FontWeights.SemiBold });
var methodCombo = new ComboBox
⋮----
stackPanel.Children.Add(methodCombo);
⋮----
// Notes
stackPanel.Children.Add(new TextBlock { Text = "Notes (optional)", FontWeight = Microsoft.UI.Text.FontWeights.SemiBold });
var notesBox = new TextBox
⋮----
stackPanel.Children.Add(notesBox);
⋮----
var dialogResult = await dialog.ShowAsync();
⋮----
// Save changes
var updateResult = await _daoInventory.UpdateAsync(
⋮----
/// Show confirmation dialog before removing a part from the inventoried list
⋮----
private async Task ShowRemoveConfirmationAsync()
⋮----
/// Remove the selected part from the inventoried list
⋮----
private async Task RemoveFromListAsync()
⋮----
var result = await _daoInventory.DeleteAsync(SelectedInventoriedPart.Id);
⋮----
/// Return to main admin navigation hub
⋮----
private async Task BackToHubAsync()
⋮----
_logger.LogInfo("Returning to Settings Mode Selection from Admin Inventory");
⋮----
settingsWorkflow.GoBack();
⋮----
/// Notifies dependent properties when selection changes
⋮----
partial void OnSelectedInventoriedPartChanged(Model_InventoriedDunnage? value)
</file>

<file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_AdminTypesViewModel.cs">
/// <summary>
/// ViewModel for Dunnage Type Management
/// Handles CRUD operations for dunnage_types table with impact analysis
/// </summary>
public partial class ViewModel_Dunnage_AdminTypes : ViewModel_Shared_Base
⋮----
private readonly IService_MySQL_Dunnage _dunnageService;
private readonly IService_DunnageAdminWorkflow _adminWorkflow;
private readonly IService_Window _windowService;
private readonly IService_Help _helpService;
⋮----
/// Load all dunnage types from database
⋮----
private async Task LoadTypesAsync()
⋮----
var result = await _dunnageService.GetAllTypesAsync();
⋮----
await _errorHandler.HandleDaoErrorAsync(result, "LoadTypesAsync", true);
⋮----
Types.Clear();
⋮----
Types.Add(type);
⋮----
await _logger.LogInfoAsync($"Loaded {Types.Count} dunnage types", "TypeManagement");
⋮----
await _errorHandler.HandleErrorAsync(
⋮----
/// Show Add New Type dialog
⋮----
private async Task ShowAddTypeAsync()
⋮----
XamlRoot = _windowService.GetXamlRoot()
⋮----
var result = await dialog.ShowAsync();
⋮----
await _logger.LogInfoAsync("New dunnage type added via Add Type Dialog", "TypeManagement");
⋮----
// Reload types to show the new type
⋮----
/// Show edit dialog for selected type
⋮----
private async Task ShowEditTypeAsync()
⋮----
var editedType = new Model_DunnageType
⋮----
var dialog = new ContentDialog
⋮----
var stackPanel = new StackPanel { Spacing = 12 };
⋮----
var typeNameBox = new TextBox
⋮----
// Icon selector button
var iconSelectorButton = new Button
⋮----
Padding = new Thickness(16, 12, 16, 12)
⋮----
var iconButtonPanel = new StackPanel
⋮----
var iconTextPanel = new StackPanel
⋮----
var iconLabel = new TextBlock
⋮----
var iconName = new TextBlock
⋮----
iconTextPanel.Children.Add(iconLabel);
iconTextPanel.Children.Add(iconName);
iconButtonPanel.Children.Add(iconDisplay);
iconButtonPanel.Children.Add(iconTextPanel);
⋮----
// Handle icon selection
⋮----
iconSelector.SetInitialSelection(editedType.IconKind);
iconSelector.Activate();
⋮----
var selectedIcon = await iconSelector.WaitForSelectionAsync();
⋮----
editedType.Icon = selectedIcon.Value.ToString();
⋮----
iconName.Text = selectedIcon.Value.ToString();
⋮----
var iconHeader = new TextBlock
⋮----
Margin = new Thickness(0, 8, 0, 0),
⋮----
stackPanel.Children.Add(typeNameBox);
stackPanel.Children.Add(iconHeader);
stackPanel.Children.Add(iconSelectorButton);
⋮----
editedType.DunnageType = typeNameBox.Text.Trim();
// Icon is already set by the button click handler
⋮----
if (string.IsNullOrWhiteSpace(editedType.DunnageType))
⋮----
await _errorHandler.ShowUserErrorAsync("Type name is required", "Validation Error", "ShowEditTypeAsync");
⋮----
var updateResult = await _dunnageService.UpdateTypeAsync(editedType);
⋮----
await _errorHandler.HandleDaoErrorAsync(updateResult, "UpdateTypeAsync", true);
⋮----
await _logger.LogInfoAsync($"Updated type: {editedType.DunnageType}", "TypeManagement");
⋮----
// Reload types
⋮----
/// Show delete confirmation dialog with impact analysis
⋮----
private async Task ShowDeleteConfirmationAsync()
⋮----
// Get impact counts
var partCountResult = await _dunnageService.GetPartCountByTypeAsync(SelectedType.Id);
var transactionCountResult = await _dunnageService.GetTransactionCountByTypeAsync(SelectedType.Id);
⋮----
await _errorHandler.HandleDaoErrorAsync(
⋮----
// Build impact message
⋮----
var warningDialog = new ContentDialog
⋮----
await warningDialog.ShowAsync();
⋮----
// Require "DELETE" confirmation
⋮----
var confirmDialog = new ContentDialog
⋮----
stackPanel.Children.Add(new TextBlock { Text = impactMessage, TextWrapping = Microsoft.UI.Xaml.TextWrapping.Wrap });
⋮----
var confirmBox = new TextBox
⋮----
stackPanel.Children.Add(confirmBox);
⋮----
var result = await confirmDialog.ShowAsync();
⋮----
/// Delete the selected type (after confirmation)
⋮----
private async Task DeleteTypeAsync()
⋮----
var result = await _dunnageService.DeleteTypeAsync(SelectedType.Id);
⋮----
await _errorHandler.HandleDaoErrorAsync(result, "DeleteTypeAsync", true);
⋮----
await _logger.LogInfoAsync($"Deleted type: {SelectedType.DunnageType}", "TypeManagement");
⋮----
/// Return to Admin Main Hub
⋮----
private async Task ReturnToAdminHubAsync()
⋮----
_logger.LogInfo("Returning to Settings Mode Selection from Admin Types");
⋮----
settingsWorkflow.GoBack();
⋮----
partial void OnSelectedTypeChanged(Model_DunnageType? value)
⋮----
/// Gets a tooltip by key from the help service
⋮----
/// <param name="key"></param>
public string GetTooltip(string key) => _helpService.GetTooltip(key);
</file>

<file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_EditModeViewModel.cs">
/// <summary>
/// ViewModel for Dunnage Edit Mode (historical data editing)
/// </summary>
public partial class ViewModel_Dunnage_EditMode : ViewModel_Shared_Base
⋮----
private readonly IService_MySQL_Dunnage _dunnageService;
private readonly IService_Pagination _paginationService;
private readonly IService_DunnageCSVWriter _csvWriter;
private readonly IService_DunnageWorkflow _workflowService;
private readonly IService_Window _windowService;
private readonly IService_Help _helpService;
⋮----
// T166: Set page size to 50
⋮----
// T167: Subscribe to PageChanged event
⋮----
// Set default date range (last 7 days)
⋮----
FromDate = DateTimeOffset.Now.AddDays(-7);
⋮----
// T164: Dynamic button text for date filters
public string LastWeekButtonText => $"Last Week ({DateTime.Now.Date.AddDays(-7):MMM d} - {DateTime.Now.Date:MMM d})";
⋮----
var startOfWeek = today.AddDays(-(int)today.DayOfWeek + (int)DayOfWeek.Monday);
⋮----
startOfWeek = startOfWeek.AddDays(-7);
⋮----
var quarterStart = new DateTime(today.Year, startMonth, 1);
⋮----
/// T151: Load data from current workflow session (unsaved loads in memory)
⋮----
private async Task LoadFromCurrentMemoryAsync()
⋮----
// T156: Info message for empty session
await _errorHandler.HandleErrorAsync(
⋮----
_logger.LogInfo("No unsaved loads found in current session", "EditMode");
⋮----
_allLoads = _workflowService.CurrentSession.Loads.ToList();
⋮----
// Set pagination source
_paginationService.SetSource(_allLoads);
⋮----
// Load first page
⋮----
_logger.LogInfo($"Loaded {TotalRecords} loads from current session", "EditMode");
⋮----
/// T152: Load data from most recent CSV export (Current Labels)
/// T153: CSV parsing error handling with line number reporting
/// T155: Error handling for missing CSV file
⋮----
private async Task LoadFromCurrentLabelsAsync()
⋮----
var localPath = System.IO.Path.Combine(
Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
⋮----
// T155: Check if file exists
if (!System.IO.File.Exists(localPath))
⋮----
_logger.LogWarning($"CSV file not found at {localPath}", "EditMode");
⋮----
// T152: Parse CSV using CsvHelper
⋮----
int lineNumber = 1; // Start at 1 (header is line 0)
⋮----
csv.Read();
csv.ReadHeader();
⋮----
while (csv.Read())
⋮----
var load = new Model_DunnageLoad
⋮----
ReceivedDate = DateTime.TryParse(csv.GetField<string>("Date"), out var date) ? date : DateTime.Now
⋮----
loadsList.Add(load);
⋮----
// T153: Line-specific error reporting
_logger.LogWarning($"Failed to parse line {lineNumber}: {rowEx.Message}", "EditMode");
⋮----
// T153: CSV parsing error with line number
⋮----
_logger.LogInfo($"Loaded {TotalRecords} loads from CSV file", "EditMode");
⋮----
private async Task LoadFromHistoryAsync()
⋮----
var startDate = FromDate?.DateTime ?? DateTime.Now.AddDays(-7);
⋮----
var result = await _dunnageService.GetLoadsByDateRangeAsync(startDate, endDate);
⋮----
await _errorHandler.HandleDaoErrorAsync(result, "LoadFromHistoryAsync", true);
⋮----
_logger.LogInfo($"Loaded {TotalRecords} historical loads from {startDate:d} to {endDate:d}", "EditMode");
⋮----
/// <summary>\n    /// Shows contextual help for edit mode\n    /// </summary>\n    [RelayCommand]\n    private async Task ShowHelpAsync()\n    {\n        await _helpService.ShowHelpAsync(\"Dunnage.EditMode\");\n    }
⋮----
/// T158: Set filter to last 7 days (today - 7 days to today)
⋮----
private async Task SetFilterLastWeekAsync()
⋮----
FromDate = DateTime.Now.Date.AddDays(-7);
⋮----
/// T159: Set filter to today only (today 00:00 to today 23:59)
⋮----
private async Task SetFilterTodayAsync()
⋮----
/// T160: Set filter to this week (Monday to Sunday of current week)
⋮----
private async Task SetFilterThisWeekAsync()
⋮----
if (startOfWeek > today) // If today is Sunday
⋮----
/// T161: Set filter to this month (first to last day of current month)
⋮----
private async Task SetFilterThisMonthAsync()
⋮----
FromDate = new DateTime(today.Year, today.Month, 1);
⋮----
/// T162: Set filter to this quarter (first to last day of current quarter)
⋮----
private async Task SetFilterThisQuarterAsync()
⋮----
FromDate = new DateTime(today.Year, startMonth, 1);
⋮----
/// T163: Clear date filters (show last year of data)
⋮----
private async Task SetFilterShowAllAsync()
⋮----
FromDate = DateTime.Now.Date.AddYears(-1);
⋮----
private void SetDateRangeToday()
⋮----
private void SetDateRangeLastWeek()
⋮----
private void SetDateRangeLastMonth()
⋮----
FromDate = DateTime.Now.Date.AddMonths(-1);
⋮----
private void FirstPage()
⋮----
private void PreviousPage()
⋮----
private void NextPage()
⋮----
private void LastPage()
⋮----
private void LoadPage(int pageNumber)
⋮----
_paginationService.GoToPage(pageNumber);
⋮----
FilteredLoads.Clear();
⋮----
FilteredLoads.Add(load);
⋮----
_logger.LogInfo($"Loaded page {CurrentPage} of {TotalPages}", "EditMode");
⋮----
private void SelectAll()
⋮----
SelectedLoads.Clear();
⋮----
SelectedLoads.Add(load);
⋮----
_logger.LogInfo($"Selected all {FilteredLoads.Count} loads on page", "EditMode");
⋮----
private void RemoveSelectedRows()
⋮----
var loadsToRemove = SelectedLoads.ToList();
⋮----
FilteredLoads.Remove(load);
_allLoads.Remove(load);
⋮----
_logger.LogInfo($"Removed {loadsToRemove.Count} loads", "EditMode");
⋮----
private async Task SaveAllAsync()
⋮----
// Validate all loads
⋮----
if (string.IsNullOrWhiteSpace(load.TypeName) || string.IsNullOrWhiteSpace(load.PartId))
⋮----
// Save to database
var saveResult = await _dunnageService.SaveLoadsAsync(_allLoads);
⋮----
await _errorHandler.HandleDaoErrorAsync(saveResult, "SaveAllAsync", true);
⋮----
// Export to CSV
var csvResult = await _csvWriter.WriteToCSVAsync(_allLoads);
⋮----
_logger.LogInfo($"Saved {_allLoads.Count} loads", "EditMode");
⋮----
private async Task ReturnToModeSelectionAsync()
⋮----
var xamlRoot = _windowService.GetXamlRoot();
⋮----
_logger.LogError("Cannot show dialog: XamlRoot is null", null, "EditMode");
await _errorHandler.HandleErrorAsync("Unable to display dialog", Enum_ErrorSeverity.Error, null, true);
⋮----
var result = await dialog.ShowAsync().AsTask();
⋮----
_logger.LogInfo("User confirmed return to mode selection, clearing data", "EditMode");
⋮----
_allLoads.Clear();
_workflowService.ClearSession();
_workflowService.GoToStep(Enum_DunnageWorkflowStep.ModeSelection);
⋮----
_logger.LogError($"Failed to return to mode selection: {ex.Message}", ex, "EditMode");
await _errorHandler.HandleErrorAsync("Failed to return to mode selection", Enum_ErrorSeverity.Error, ex, true);
⋮----
_logger.LogInfo("User cancelled return to mode selection", "EditMode");
⋮----
/// T167: Event handler for pagination service PageChanged event
⋮----
/// <param name="sender"></param>
/// <param name="e"></param>
private void OnPageChanged(object? sender, EventArgs e)
⋮----
// Update FilteredLoads with current page items
⋮----
_logger.LogInfo($"Page changed to {CurrentPage} of {TotalPages}", "EditMode");
⋮----
private void UpdateCanSave()
⋮----
CanSave = _allLoads.Any(l => !string.IsNullOrWhiteSpace(l.TypeName) || !string.IsNullOrWhiteSpace(l.PartId));
⋮----
/// Gets a tooltip by key from the help service
⋮----
/// <param name="key"></param>
public string GetTooltip(string key) => _helpService.GetTooltip(key);
⋮----
/// Gets a placeholder by key from the help service
⋮----
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
⋮----
/// Gets a tip by key from the help service
⋮----
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_ModeSelectionViewModel.cs">
/// <summary>
/// ViewModel for Dunnage Mode Selection - allows user to choose between Guided Wizard, Manual Entry, or Edit Mode
/// </summary>
public partial class ViewModel_Dunnage_ModeSelection : ViewModel_Shared_Base
⋮----
private readonly IService_DunnageWorkflow _workflowService;
private readonly IService_Help _helpService;
private readonly IService_UserSessionManager _sessionManager;
private readonly IService_UserPreferences _userPreferencesService;
private readonly IService_Window _windowService;
⋮----
// Load current default mode
⋮----
/// Load the user's default dunnage mode preference
⋮----
private void LoadDefaultMode()
⋮----
private async Task SelectGuidedModeAsync()
⋮----
_logger.LogInfo("User selected Guided Wizard mode");
⋮----
_workflowService.GoToStep(Enum_DunnageWorkflowStep.TypeSelection);
⋮----
private async Task SelectManualModeAsync()
⋮----
_logger.LogInfo("User selected Manual Entry mode");
⋮----
_workflowService.GoToStep(Enum_DunnageWorkflowStep.ManualEntry);
⋮----
private async Task SelectEditModeAsync()
⋮----
_logger.LogInfo("User selected Edit Mode");
⋮----
_workflowService.GoToStep(Enum_DunnageWorkflowStep.EditMode);
⋮----
/// Shows confirmation dialog before mode change
⋮----
/// <returns>True if user confirmed, false if cancelled</returns>
⋮----
/// Checks if there is any unsaved data in the current workflow
⋮----
private bool HasUnsavedData()
⋮----
// Check if there are any loads in the session
⋮----
// Check if there's any type/part selection
⋮----
!string.IsNullOrEmpty(_workflowService.CurrentSession.PONumber) ||
!string.IsNullOrEmpty(_workflowService.CurrentSession.Location))
⋮----
private async Task<bool> ConfirmModeChangeAsync()
⋮----
// Skip confirmation if there's no unsaved data
⋮----
_logger.LogInfo("No unsaved data detected, skipping confirmation dialog");
⋮----
var xamlRoot = _windowService.GetXamlRoot();
⋮----
_logger.LogWarning("XamlRoot is null, proceeding without confirmation");
⋮----
var dialog = new ContentDialog
⋮----
var result = await dialog.ShowAsync();
⋮----
_logger.LogError($"Error showing confirmation dialog: {ex.Message}", ex);
return true; // Proceed if dialog fails
⋮----
/// Clears all transient workflow data without affecting persisted data
⋮----
private void ClearWorkflowData()
⋮----
// Clear current session data (in-memory only, not database or CSV)
⋮----
// Clear UI inputs in all connected ViewModels
⋮----
_logger.LogInfo("Dunnage workflow data and UI inputs cleared for mode change");
⋮----
_logger.LogError($"Error clearing dunnage workflow data: {ex.Message}", ex);
⋮----
/// Clears UI input properties across all Dunnage workflow ViewModels
⋮----
private void ClearAllUIInputs()
⋮----
// Clear TypeSelection ViewModel
⋮----
// Clear PartSelection ViewModel
⋮----
// Clear DetailsEntry ViewModel
⋮----
// Clear QuantityEntry ViewModel
⋮----
_logger.LogInfo("UI inputs cleared across all Dunnage ViewModels");
⋮----
_logger.LogError($"Error clearing UI inputs: {ex.Message}", ex);
⋮----
private async Task SetGuidedAsDefaultAsync(bool isChecked)
⋮----
var result = await _userPreferencesService.UpdateDefaultDunnageModeAsync(currentUser.WindowsUsername, newMode ?? "");
⋮----
// Update in-memory user object
⋮----
// Update UI state
⋮----
_logger.LogInfo($"Dunnage default mode set to: {newMode ?? "none"}");
⋮----
await _errorHandler.ShowErrorDialogAsync("Save Error", result.ErrorMessage, Enum_ErrorSeverity.Error);
// Revert checkbox
⋮----
await _errorHandler.HandleErrorAsync($"Failed to set default dunnage mode: {ex.Message}",
⋮----
private async Task SetManualAsDefaultAsync(bool isChecked)
⋮----
/// Shows contextual help for mode selection
⋮----
private async Task ShowHelpAsync()
⋮----
await _helpService.ShowHelpAsync("Dunnage.ModeSelection");
⋮----
private async Task SetEditAsDefaultAsync(bool isChecked)
⋮----
/// Gets a tooltip by key from the help service
⋮----
/// <param name="key"></param>
public string GetTooltip(string key) => _helpService.GetTooltip(key);
⋮----
/// Gets a placeholder by key from the help service
⋮----
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
⋮----
/// Gets a tip by key from the help service
⋮----
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_TypeSelectionViewModel.cs">
/// <summary>
/// ViewModel for Dunnage Type Selection with 3x3 paginated grid
/// </summary>
public partial class ViewModel_dunnage_typeselection : ViewModel_Shared_Base, IResettableViewModel
⋮----
private readonly IService_DunnageWorkflow _workflowService;
private readonly IService_MySQL_Dunnage _dunnageService;
private readonly IService_Pagination _paginationService;
private readonly IService_Help _helpService;
private readonly IService_ViewModelRegistry _viewModelRegistry;
⋮----
// Subscribe to pagination events
⋮----
_viewModelRegistry.Register(this);
⋮----
public void ResetToDefaults()
⋮----
/// Load dunnage types and initialize pagination
⋮----
public async Task InitializeAsync()
⋮----
_logger.LogInfo("TypeSelection: InitializeAsync called", "ViewModel_dunnage_typeselection");
⋮----
_logger.LogInfo("TypeSelection: Already busy, returning", "ViewModel_dunnage_typeselection");
⋮----
_logger.LogInfo("TypeSelection: Starting to load types", "ViewModel_dunnage_typeselection");
⋮----
_errorHandler.HandleErrorAsync(
⋮----
).Wait();
⋮----
private async Task LoadTypesAsync()
⋮----
_logger.LogInfo("TypeSelection: LoadTypesAsync called", "ViewModel_dunnage_typeselection");
⋮----
_logger.LogInfo("TypeSelection: Calling service.GetAllTypesAsync()", "ViewModel_dunnage_typeselection");
⋮----
var result = await _dunnageService.GetAllTypesAsync();
⋮----
_logger.LogInfo($"TypeSelection: Service returned - IsSuccess: {result.IsSuccess}, Data null: {result.Data == null}, Count: {result.Data?.Count ?? 0}", "ViewModel_dunnage_typeselection");
⋮----
// Configure pagination for 3x3 grid (9 items per page)
⋮----
_paginationService.SetSource(result.Data);
_logger.LogInfo($"TypeSelection: Pagination configured with PageSize=9, TotalItems={result.Data.Count}", "ViewModel_dunnage_typeselection");
⋮----
_logger.LogInfo($"TypeSelection: Successfully loaded {result.Data.Count} dunnage types with {TotalPages} pages, DisplayedTypes.Count={DisplayedTypes.Count}", "ViewModel_dunnage_typeselection");
⋮----
await _errorHandler.HandleDaoErrorAsync(
⋮----
await _errorHandler.HandleErrorAsync(
⋮----
private void NextPage()
⋮----
_paginationService.NextPage();
⋮----
private void PreviousPage()
⋮----
_paginationService.PreviousPage();
⋮----
private void FirstPage()
⋮----
_paginationService.FirstPage();
⋮----
private void LastPage()
⋮----
_paginationService.LastPage();
⋮----
private async Task SelectTypeAsync(Model_DunnageType? type)
⋮----
_logger.LogInfo($"TypeSelection: Selected dunnage type: {type.TypeName} (ID: {type.Id})", "TypeSelection");
⋮----
// Set in workflow session
⋮----
_logger.LogInfo($"TypeSelection: Session updated - SelectedTypeId={_workflowService.CurrentSession.SelectedTypeId}", "TypeSelection");
⋮----
// Navigate to part selection
_logger.LogInfo("TypeSelection: Navigating to PartSelection step", "TypeSelection");
_workflowService.GoToStep(Enum_DunnageWorkflowStep.PartSelection);
⋮----
_logger.LogError($"TypeSelection: Error selecting type: {ex.Message}", ex, "TypeSelection");
⋮----
private async Task QuickAddTypeAsync()
⋮----
_logger.LogInfo("Quick Add Type requested", "TypeSelection");
⋮----
// Show dialog
⋮----
_logger.LogInfo("Cannot show dialog: XamlRoot is null", "TypeSelection");
⋮----
var result = await dialog.ShowAsync();
⋮----
var iconName = dialog.SelectedIconKind.ToString();
⋮----
_logger.LogInfo($"Adding new type: {typeName} with icon {iconName}", "TypeSelection");
⋮----
// Insert new type
var newType = new Model_DunnageType
⋮----
// Note: Icon storage would need to be added to database schema
⋮----
var insertResult = await _dunnageService.InsertTypeAsync(newType);
⋮----
_logger.LogInfo($"Successfully added type: {typeName}", "TypeSelection");
⋮----
// Insert specs
⋮----
var specDef = new SpecDefinition
⋮----
var specModel = new Model_DunnageSpec
⋮----
SpecValue = JsonSerializer.Serialize(specDef)
⋮----
await _dunnageService.InsertSpecAsync(specModel);
⋮----
// Reload types to show new type
⋮----
private async Task EditTypeAsync(Model_DunnageType type)
⋮----
_logger.LogInfo($"Edit Type requested for {type.TypeName}", "TypeSelection");
⋮----
// Load existing specs
var specsResult = await _dunnageService.GetSpecsForTypeAsync(type.Id);
⋮----
existingSpecsDict[s.SpecKey] = new SpecDefinition(); // Fallback
⋮----
existingSpecsDict[s.SpecKey] = new SpecDefinition(); // Fallback for empty/invalid JSON
⋮----
dialog.InitializeForEdit(type.TypeName, type.Icon, existingSpecsDict);
⋮----
var newIcon = dialog.SelectedIconKind.ToString();
var newSpecs = dialog.Specs; // Collection of SpecItem
⋮----
// Update Type info
⋮----
var updateResult = await _dunnageService.UpdateTypeAsync(type);
⋮----
await _errorHandler.HandleDaoErrorAsync(updateResult, nameof(EditTypeAsync), true);
⋮----
// Update Specs
// 1. Find removed specs
var newSpecNames = newSpecs.Select(s => s.Name).ToList();
var removedSpecKeys = existingSpecsDict.Keys.Except(newSpecNames).ToList();
⋮----
await _dunnageService.DeleteSpecAsync(specToDelete.Id);
⋮----
// 2. Find added or updated specs
⋮----
var json = JsonSerializer.Serialize(specDef);
⋮----
if (existingSpecsDict.ContainsKey(specItem.Name))
⋮----
// Update existing?
// We need to check if definition changed.
// For simplicity, we can just update the value if it's different.
⋮----
await _dunnageService.UpdateSpecAsync(existingModel);
⋮----
// Insert new
⋮----
_logger.LogInfo($"Successfully updated type: {type.TypeName}", "TypeSelection");
⋮----
await _errorHandler.HandleErrorAsync("Error updating dunnage type", Enum_ErrorSeverity.Error, ex, true);
⋮----
private async Task DeleteTypeAsync(Model_DunnageType type)
⋮----
_logger.LogInfo($"Delete Type requested for {type.TypeName}", "TypeSelection");
⋮----
var deleteResult = await _dunnageService.DeleteTypeAsync(type.Id);
⋮----
_logger.LogInfo($"Successfully deleted type: {type.TypeName}", "TypeSelection");
⋮----
await _errorHandler.HandleDaoErrorAsync(deleteResult, nameof(DeleteTypeAsync), true);
⋮----
await _errorHandler.HandleErrorAsync("Error deleting dunnage type", Enum_ErrorSeverity.Error, ex, true);
⋮----
private void OnPageChanged(object? sender, EventArgs e)
⋮----
private void UpdatePaginationProperties()
⋮----
// Notify commands to update their CanExecute state
NextPageCommand.NotifyCanExecuteChanged();
PreviousPageCommand.NotifyCanExecuteChanged();
⋮----
private void UpdatePageDisplay()
⋮----
_logger.LogInfo($"TypeSelection: UpdatePageDisplay - Got {currentItems.Count()} items from pagination service", "ViewModel_dunnage_typeselection");
⋮----
DisplayedTypes.Clear();
⋮----
DisplayedTypes.Add(type);
_logger.LogInfo($"TypeSelection: Added type to DisplayedTypes - ID: {type.Id}, Name: {type.TypeName}", "ViewModel_dunnage_typeselection");
⋮----
_logger.LogInfo($"TypeSelection: DisplayedTypes.Count after update: {DisplayedTypes.Count}", "ViewModel_dunnage_typeselection");
⋮----
/// Gets a tooltip by key from the help service
⋮----
/// <param name="key"></param>
public string GetTooltip(string key) => _helpService.GetTooltip(key);
⋮----
/// Gets a placeholder by key from the help service
⋮----
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
⋮----
/// Gets a tip by key from the help service
⋮----
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_WorkFlowViewModel.cs">
/// <summary>
/// ViewModel for Dunnage Label entry page - Orchestrates workflow step visibility
/// </summary>
public partial class ViewModel_Dunnage_WorkFlowViewModel : ViewModel_Shared_Base
⋮----
private readonly IService_DunnageWorkflow _workflowService;
private readonly IService_Window _windowService;
⋮----
_currentLine = new Model_DunnageLine();
⋮----
// Start the workflow - it will check for default mode and navigate accordingly
⋮----
/// Initialize the workflow - checks for default mode and navigates to appropriate step
⋮----
private async Task InitializeWorkflowAsync()
⋮----
await _workflowService.StartWorkflowAsync();
⋮----
_errorHandler.HandleException(
⋮----
private Model_DunnageLine _currentLine;
⋮----
private void OnWorkflowStepChanged(object? sender, EventArgs e)
⋮----
// Hide all steps
⋮----
// Show current step
⋮----
private async Task ResetCSVAsync()
⋮----
var xamlRoot = _windowService.GetXamlRoot();
⋮----
_logger.LogError("Cannot show dialog: XamlRoot is null");
await _errorHandler.HandleErrorAsync("Unable to display dialog", Enum_ErrorSeverity.Error);
⋮----
var result = await dialog.ShowAsync();
⋮----
// Try to save to DB first
var saveResult = await _workflowService.SaveToDatabaseOnlyAsync();
⋮----
var warnResult = await warnDialog.ShowAsync();
⋮----
var deleteResult = await _workflowService.ResetCSVFilesAsync();
⋮----
private void ReturnToModeSelection()
⋮----
_workflowService.ClearSession();
_workflowService.GoToStep(Enum_DunnageWorkflowStep.ModeSelection);
⋮----
private async Task AddLineAsync()
⋮----
// TODO: Implement when ready
</file>

<file path="Module_Dunnage/Views/View_Dunnage_QuickAddPartDialog.xaml.cs">
public sealed partial class View_Dunnage_QuickAddPartDialog : ContentDialog
⋮----
private void GenerateSpecFields()
⋮----
// Skip dimensions as they are handled by the static fields
if (string.Equals(spec.SpecKey, "Width", System.StringComparison.OrdinalIgnoreCase) ||
string.Equals(spec.SpecKey, "Height", System.StringComparison.OrdinalIgnoreCase) ||
string.Equals(spec.SpecKey, "Depth", System.StringComparison.OrdinalIgnoreCase))
⋮----
// Intentionally empty - fallback to null
⋮----
def = new SpecDefinition { DataType = "Text" }; // Fallback
⋮----
var stackPanel = new StackPanel { Spacing = 4 };
⋮----
if (!string.IsNullOrEmpty(def.Unit))
⋮----
var label = new TextBlock
⋮----
stackPanel.Children.Add(label);
⋮----
if (string.Equals(def.DataType, "Number", System.StringComparison.OrdinalIgnoreCase))
⋮----
var numberBox = new NumberBox
⋮----
else if (string.Equals(def.DataType, "Boolean", System.StringComparison.OrdinalIgnoreCase))
⋮----
var checkBox = new CheckBox
⋮----
else // Text
⋮----
var textBox = new TextBox
⋮----
PlaceholderText = $"Enter {spec.SpecKey.ToLower()}",
⋮----
stackPanel.Children.Add(inputControl);
DynamicSpecsPanel.Children.Add(stackPanel);
⋮----
private void OnDimensionChanged(NumberBox sender, NumberBoxValueChangedEventArgs args)
⋮----
private void UpdatePartId()
⋮----
// 1. Type name
parts.Add(TypeName);
⋮----
// 2. Text specs (if any)
⋮----
if (kvp.Value is TextBox tb && !string.IsNullOrWhiteSpace(tb.Text))
⋮----
textSpecs.Add(tb.Text.Trim());
⋮----
// 3. Number specs in parentheses with x separator
⋮----
if (!double.IsNaN(WidthNumberBox.Value) && WidthNumberBox.Value > 0)
⋮----
numbers.Add(WidthNumberBox.Value);
⋮----
if (!double.IsNaN(HeightNumberBox.Value) && HeightNumberBox.Value > 0)
⋮----
numbers.Add(HeightNumberBox.Value);
⋮----
if (!double.IsNaN(DepthNumberBox.Value) && DepthNumberBox.Value > 0)
⋮----
numbers.Add(DepthNumberBox.Value);
⋮----
// Add other number specs from dynamic inputs
⋮----
if (kvp.Value is NumberBox nb && !double.IsNaN(nb.Value) && nb.Value > 0)
⋮----
numbers.Add(nb.Value);
⋮----
// Format numbers: remove decimals if whole numbers
var formattedNumbers = numbers.Select(n =>
n == Math.Floor(n) ? ((int)n).ToString() : n.ToString("0.##")
⋮----
parts.Add($"({string.Join("x", formattedNumbers)})");
⋮----
// 4. Boolean specs (only if true, abbreviated if >2 words)
⋮----
var words = specName.Split(new[] { ' ', '_' }, System.StringSplitOptions.RemoveEmptyEntries);
⋮----
// Abbreviate: use first letter of each word
boolSpecs.Add(string.Join("", words.Select(w => char.ToUpper(w[0]))));
⋮----
// Use full name
boolSpecs.Add(specName);
⋮----
parts.Add(string.Join(", ", boolSpecs));
⋮----
// Add text specs if any
⋮----
// Insert text specs after type name
parts.Insert(1, string.Join(", ", textSpecs));
⋮----
PartIdTextBox.Text = string.Join(" - ", parts);
⋮----
private void OnPrimaryButtonClick(ContentDialog sender, ContentDialogButtonClickEventArgs args)
⋮----
// Set Part ID
PartId = PartIdTextBox.Text.Trim();
⋮----
// Build spec values dictionary
⋮----
// Add dynamic specs
⋮----
specValues[kvp.Key] = tb.Text.Trim();
⋮----
else if (kvp.Value is NumberBox nb && !double.IsNaN(nb.Value))
⋮----
// Add dimensions if provided
⋮----
// Add notes if provided
if (!string.IsNullOrWhiteSpace(NotesTextBox.Text))
⋮----
specValues["Notes"] = NotesTextBox.Text.Trim();
⋮----
// Serialize to JSON
⋮----
SpecValuesJson = JsonSerializer.Serialize(specValues);
</file>

<file path="Module_Dunnage/Views/View_Dunnage_TypeSelectionView.xaml">
<UserControl x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_dunnage_typeselectionView"
             x:Name="RootUserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:viewmodels="using:MTM_Receiving_Application.Module_Dunnage.ViewModels"
             xmlns:models="using:MTM_Receiving_Application.Module_Dunnage.Models"
             xmlns:materialIcons="using:Material.Icons.WinUI3"
             xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
             mc:Ignorable="d"
             Loaded="OnLoaded">

    <UserControl.Resources>
        <converters:Converter_IconCodeToGlyph x:Key="IconCodeToGlyphConverter" />
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0"
                    Spacing="8"
                    Margin="0,0,0,32">
            <TextBlock Text="Select Dunnage Type"
                       Style="{StaticResource TitleTextBlockStyle}" />
            <TextBlock Text="{x:Bind ViewModel.GetTip('Dunnage.TypeSelection'), Mode=OneWay}"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       Style="{StaticResource BodyTextBlockStyle}" />
        </StackPanel>

        <!-- 3x3 Type Grid -->
        <GridView Grid.Row="1"
                  ItemsSource="{x:Bind ViewModel.DisplayedTypes, Mode=OneWay}"
                  SelectedItem="{x:Bind ViewModel.SelectedType, Mode=TwoWay}"
                  SelectionMode="None"
                  IsItemClickEnabled="True"
                  ItemClick="TypeCard_ItemClick"
                  MaxWidth="960"
                  HorizontalAlignment="Center">
            <GridView.ItemsPanel>
                <ItemsPanelTemplate>
                    <ItemsWrapGrid Orientation="Horizontal"
                                   MaximumRowsOrColumns="3" />
                </ItemsPanelTemplate>
            </GridView.ItemsPanel>
            <GridView.ItemTemplate>
                <DataTemplate x:DataType="models:Model_DunnageType">
                    <Border Width="280"
                            Height="180"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20">
                        <Border.ContextFlyout>
                            <MenuFlyout>
                                <MenuFlyoutItem Text="Edit"
                                                Icon="Edit"
                                                Command="{Binding ElementName=RootUserControl, Path=ViewModel.EditTypeCommand}"
                                                CommandParameter="{x:Bind}" />
                                <MenuFlyoutItem Text="Delete"
                                                Icon="Delete"
                                                Command="{Binding ElementName=RootUserControl, Path=ViewModel.DeleteTypeCommand}"
                                                CommandParameter="{x:Bind}" />
                            </MenuFlyout>
                        </Border.ContextFlyout>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- Icon -->
                            <materialIcons:MaterialIcon Grid.Row="0"
                                                        Kind="{x:Bind IconKind, Mode=OneWay}"
                                                        Width="48"
                                                        Height="48"
                                                        Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                                                        HorizontalAlignment="Center"
                                                        Margin="0,0,0,12" />

                            <!-- Type Name -->
                            <TextBlock Grid.Row="1"
                                       Text="{x:Bind TypeName}"
                                       Style="{StaticResource SubtitleTextBlockStyle}"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       TextAlignment="Center"
                                       TextWrapping="Wrap" />
                        </Grid>
                    </Border>
                </DataTemplate>
            </GridView.ItemTemplate>
        </GridView>

        <!-- Pagination Controls -->
        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Spacing="16"
                    Margin="0,32,0,0">
            <!-- First Page -->
            <Button Command="{x:Bind ViewModel.FirstPageCommand}"
                    ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.FirstPage'), Mode=OneWay}">
                <FontIcon Glyph="&#xE892;"
                          FontSize="16" />
            </Button>

            <!-- Previous Page -->
            <Button Command="{x:Bind ViewModel.PreviousPageCommand}"
                    ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.PreviousPage'), Mode=OneWay}">
                <FontIcon Glyph="&#xE76B;"
                          FontSize="16" />
            </Button>

            <!-- Page Info -->
            <Border Background="{ThemeResource LayerFillColorDefaultBrush}"
                    Padding="16,8"
                    CornerRadius="4"
                    MinWidth="120">
                <TextBlock Text="{x:Bind ViewModel.PageInfo, Mode=OneWay}"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center" />
            </Border>

            <!-- Next Page -->
            <Button Command="{x:Bind ViewModel.NextPageCommand}"
                    ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.NextPage'), Mode=OneWay}">
                <FontIcon Glyph="&#xE76C;"
                          FontSize="16" />
            </Button>

            <!-- Last Page -->
            <Button Command="{x:Bind ViewModel.LastPageCommand}"
                    ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.LastPage'), Mode=OneWay}">
                <FontIcon Glyph="&#xE893;"
                          FontSize="16" />
            </Button>

            <!-- Quick Add Button -->
            <Button Command="{x:Bind ViewModel.QuickAddTypeCommand}"
                    Style="{StaticResource AccentButtonStyle}"
                    Margin="32,0,0,0">
                <StackPanel Orientation="Horizontal"
                            Spacing="8">
                    <FontIcon Glyph="&#xE710;"
                              FontSize="16" />
                    <TextBlock Text="Quick Add Type" />
                </StackPanel>
            </Button>
        </StackPanel>
    </Grid>
</UserControl>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_TypeSelectionView.xaml.cs">
/// <summary>
/// UserControl for Dunnage Type Selection view with 3x3 paginated grid
/// </summary>
public sealed partial class View_dunnage_typeselectionView : UserControl
⋮----
private readonly IService_Focus _focusService;
⋮----
_focusService.AttachFocusOnVisibility(this);
⋮----
private async void OnLoaded(object sender, RoutedEventArgs e)
⋮----
System.Diagnostics.Debug.WriteLine("dunnage_typeselectionView: OnLoaded called");
await ViewModel.InitializeAsync();
⋮----
private async void TypeCard_ItemClick(object sender, ItemClickEventArgs e)
⋮----
await ViewModel.SelectTypeCommand.ExecuteAsync(type);
</file>

<file path="Module_Receiving/Data/Dao_PackageTypePreference.cs">
public class Dao_PackageTypePreference
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
// ====================================================================
// User Preferences (New Feature)
⋮----
public async Task<Model_Dao_Result<Model_UserPreference>> GetByUserAsync(string username)
⋮----
reader => new Model_UserPreference
⋮----
Username = reader["username"].ToString() ?? string.Empty,
PreferredPackageType = reader["preferred_package_type"].ToString() ?? string.Empty,
Workstation = reader["workstation"].ToString() ?? string.Empty,
LastUpdated = Convert.ToDateTime(reader["last_modified"])
⋮----
public async Task<Model_Dao_Result> UpsertAsync(Model_UserPreference preference)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
return Model_Dao_Result_Factory.Failure(
⋮----
// Part Preferences (Existing Feature)
⋮----
public async Task<Model_Dao_Result<Model_PackageTypePreference?>> GetPreferenceAsync(string partID)
⋮----
// Using custom mapper as in original service
⋮----
reader => new Model_PackageTypePreference
⋮----
PreferenceID = Convert.ToInt32(reader["PreferenceID"]),
PartID = reader["PartID"].ToString() ?? string.Empty,
PackageTypeName = reader["PackageTypeName"].ToString() ?? string.Empty,
CustomTypeName = reader["CustomTypeName"] == DBNull.Value ? null : reader["CustomTypeName"].ToString(),
LastModified = Convert.ToDateTime(reader["LastModified"])
⋮----
return Model_Dao_Result_Factory.Success(result.Data);
⋮----
public async Task<Model_Dao_Result> SavePreferenceAsync(Model_PackageTypePreference preference)
⋮----
var result = await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
return Model_Dao_Result_Factory.Success();
⋮----
return Model_Dao_Result_Factory.Failure(result.ErrorMessage);
⋮----
public async Task<Model_Dao_Result<bool>> DeletePreferenceAsync(string partID)
⋮----
return Model_Dao_Result_Factory.Success(true);
</file>

<file path="Module_Receiving/Data/Dao_ReceivingLoad.cs">
public class Dao_ReceivingLoad
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
private string? CleanPONumber(string? poNumber)
⋮----
if (string.IsNullOrEmpty(poNumber))
⋮----
return poNumber.Replace("PO-", "", StringComparison.OrdinalIgnoreCase).Trim();
⋮----
public async Task<Model_Dao_Result<int>> SaveLoadsAsync(List<Model_ReceivingLoad> loads)
⋮----
await using var connection = new MySqlConnection(_connectionString);
await connection.OpenAsync();
⋮----
await using var transaction = await connection.BeginTransactionAsync();
⋮----
{ "LoadID", load.LoadID.ToString() },
⋮----
var result = await Helper_Database_StoredProcedure.ExecuteInTransactionAsync(
⋮----
throw new InvalidOperationException(result.ErrorMessage, result.Exception);
⋮----
await transaction.CommitAsync();
⋮----
await transaction.RollbackAsync();
⋮----
public async Task<Model_Dao_Result<int>> UpdateLoadsAsync(List<Model_ReceivingLoad> loads)
⋮----
public async Task<Model_Dao_Result<int>> DeleteLoadsAsync(List<Model_ReceivingLoad> loads)
⋮----
{ "p_LoadID", load.LoadID.ToString() }
⋮----
public async Task<Model_Dao_Result<List<Model_ReceivingLoad>>> GetHistoryAsync(string partID, DateTime startDate, DateTime endDate)
⋮----
var result = await Helper_Database_StoredProcedure.ExecuteDataTableAsync(
⋮----
loads.Add(MapRowToLoad(row));
⋮----
return Model_Dao_Result_Factory.Success(loads);
⋮----
public async Task<Model_Dao_Result<List<Model_ReceivingLoad>>> GetAllAsync(DateTime startDate, DateTime endDate)
⋮----
private Model_ReceivingLoad MapRowToLoad(DataRow row)
⋮----
return new Model_ReceivingLoad
⋮----
LoadID = Guid.Parse(row["LoadID"]?.ToString() ?? Guid.Empty.ToString()),
⋮----
PoNumber = row["PONumber"] == DBNull.Value ? null : row["PONumber"].ToString(),
⋮----
LoadNumber = Convert.ToInt32(row["LoadNumber"]),
WeightQuantity = Convert.ToDecimal(row["WeightQuantity"]),
⋮----
PackagesPerLoad = Convert.ToInt32(row["PackagesPerLoad"]),
⋮----
WeightPerPackage = Convert.ToDecimal(row["WeightPerPackage"]),
IsNonPOItem = Convert.ToBoolean(row["IsNonPOItem"]),
ReceivedDate = Convert.ToDateTime(row["ReceivedDate"])
</file>

<file path="Module_Receiving/Models/Model_ReceivingLine.cs">
/// <summary>
/// Represents a receiving label entry from Google Sheets "Receiving Data"
/// Maps to receiving_label_data database table
/// </summary>
public class Model_ReceivingLine
⋮----
/// Auto-increment primary key
⋮----
/// Number of pieces received (Column A in Google Sheets)
⋮----
/// Part identifier (Column B in Google Sheets)
⋮----
/// Purchase order number (Column C in Google Sheets)
⋮----
/// Receiving employee number (Column D in Google Sheets)
⋮----
/// Heat/lot number (Column E in Google Sheets)
⋮----
/// Transaction date (Column F in Google Sheets)
⋮----
/// Storage location (Column G in Google Sheets)
⋮----
/// Optional coil count (Column H in Google Sheets)
⋮----
/// Current label number (calculated)
⋮----
/// Total labels for this PO (calculated)
⋮----
/// Supplier name (looked up from part/PO)
⋮----
/// Part description (looked up from part ID)
⋮----
/// Record creation timestamp
⋮----
/// Formatted label text (e.g., "1 / 5")
</file>

<file path="Module_Receiving/ViewModels/ViewModel_Receiving_POEntry.cs">
public partial class ViewModel_Receiving_POEntry : ViewModel_Shared_Base, IResettableViewModel
⋮----
private readonly IService_InforVisual _inforVisualService;
private readonly IService_ReceivingWorkflow _workflowService;
private readonly IService_Help _helpService;
private readonly IService_ViewModelRegistry _viewModelRegistry;
⋮----
private string _packageType = "Skids";  // Default package type
⋮----
_viewModelRegistry.Register(this);
⋮----
// Update visibility when parts collection changes
⋮----
// Auto-fill PO number if using mock data
⋮----
public void ResetToDefaults()
⋮----
Parts.Clear();
⋮----
private void PoTextBoxLostFocus()
⋮----
// Auto-correction only on LostFocus (not TextChanged)
if (string.IsNullOrWhiteSpace(PoNumber))
⋮----
// Trim and uppercase first
string value = PoNumber.Trim().ToUpper();
⋮----
// Format the PO number
if (value.StartsWith("PO-", StringComparison.OrdinalIgnoreCase))
⋮----
// Extract number part and reformat
string numberPart = value.Substring(3);
if (numberPart.All(char.IsDigit) && numberPart.Length <= 6)
⋮----
PoNumber = $"PO-{numberPart.PadLeft(6, '0')}";
⋮----
else if (value.All(char.IsDigit) && value.Length <= 6)
⋮----
// Just numbers - add PO- prefix and pad
PoNumber = $"PO-{value.PadLeft(6, '0')}";
⋮----
// If invalid format, leave as-is and let validation message show
⋮----
private async Task LoadPOAsync()
⋮----
await _errorHandler.HandleErrorAsync("Please enter a PO number.", Enum_ErrorSeverity.Warning);
⋮----
var result = await _inforVisualService.GetPOWithPartsAsync(PoNumber);
⋮----
// Set PO status
⋮----
// Load parts and populate remaining quantity for each
⋮----
// Get remaining quantity for this part
var remainingQtyResult = await _inforVisualService.GetRemainingQuantityAsync(PoNumber, part.PartID);
⋮----
Parts.Add(part);
⋮----
_workflowService.RaiseStatusMessage($"Purchase Order {PoNumber} loaded with {Parts.Count} parts.");
⋮----
var errorMessage = !string.IsNullOrWhiteSpace(result.ErrorMessage)
⋮----
await _errorHandler.HandleErrorAsync(errorMessage, Enum_ErrorSeverity.Error);
⋮----
private void ToggleNonPO()
⋮----
private async Task LookupPartAsync()
⋮----
if (string.IsNullOrWhiteSpace(PartID))
⋮----
await _errorHandler.HandleErrorAsync("Please enter a Part ID.", Enum_ErrorSeverity.Warning);
⋮----
var result = await _inforVisualService.GetPartByIDAsync(PartID);
⋮----
// For Non-PO items, we might want to show it in the list or just set SelectedPart directly.
// Setting SelectedPart directly is enough for the workflow, but the UI might want to show it.
⋮----
Parts.Add(result.Data);
_workflowService.RaiseStatusMessage($"Part {PartID} found.");
⋮----
await _errorHandler.HandleErrorAsync(result.ErrorMessage ?? "Part not found.", Enum_ErrorSeverity.Error);
⋮----
partial void OnPoNumberChanged(string value)
⋮----
// Validate PO number format (validation only, no auto-correction)
// Auto-correction happens only on LostFocus
⋮----
if (string.IsNullOrWhiteSpace(value))
⋮----
string validatedPO = value.Trim();
⋮----
// Check if value starts with "po-" or "PO-" (case insensitive)
if (validatedPO.StartsWith("po-", StringComparison.OrdinalIgnoreCase))
⋮----
// Extract the number part after "PO-"
string numberPart = validatedPO.Substring(3);
⋮----
// Check if it's all digits and validate length
if (numberPart.All(char.IsDigit))
⋮----
validatedPO = $"PO-{numberPart.PadLeft(6, '0')}";
⋮----
else if (validatedPO.All(char.IsDigit))
⋮----
// Just numbers, no prefix
⋮----
validatedPO = $"PO-{validatedPO.PadLeft(6, '0')}";
⋮----
partial void OnPartIDChanged(string value)
⋮----
// Auto-detect package type based on Part ID prefix
⋮----
PackageType = "Skids"; // Default
⋮----
var upperPart = value.Trim().ToUpper();
⋮----
if (upperPart.StartsWith("MMC"))
⋮----
else if (upperPart.StartsWith("MMF"))
⋮----
partial void OnSelectedPartChanged(Model_InforVisualPart? value)
⋮----
// Auto-detect package type when a part is selected from PO
if (value != null && !string.IsNullOrWhiteSpace(value.PartID))
⋮----
var upperPart = value.PartID.Trim().ToUpper();
⋮----
/// <summary>
/// Shows contextual help for PO entry
/// </summary>
⋮----
private async Task ShowHelpAsync()
⋮----
await _helpService.ShowHelpAsync("Receiving.POEntry");
⋮----
public string GetTooltip(string key) => _helpService.GetTooltip(key);
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
public string GetTip(string key) => _helpService.GetTip(key);
⋮----
/// Initialize component - autofill PO if mock data enabled
⋮----
private async void InitializeAsync()
⋮----
await _logger.LogInfoAsync($"[MOCK DATA MODE] Auto-filling PO number: {defaultPO}");
⋮----
_workflowService.RaiseStatusMessage($"[MOCK DATA] Auto-filled PO: {defaultPO}");
⋮----
// Auto-load mock data
await Task.Delay(500); // Small delay for UI update
⋮----
await _logger.LogErrorAsync($"Error during initialization: {ex.Message}", ex);
</file>

<file path="Module_Reporting/Services/Service_Reporting.cs">
/// <summary>
/// Service implementation for End-of-Day reporting
/// Handles data retrieval, PO normalization, CSV export, and email formatting
/// </summary>
public class Service_Reporting : IService_Reporting
⋮----
private readonly Dao_Reporting _dao;
private readonly IService_LoggingUtility _logger;
⋮----
_dao = dao ?? throw new ArgumentNullException(nameof(dao));
_logger = logger ?? throw new ArgumentNullException(nameof(logger));
⋮----
public async Task<Model_Dao_Result<List<Model_ReportRow>>> GetReceivingHistoryAsync(
⋮----
_logger.LogInfo($"Retrieving Receiving history from {startDate:yyyy-MM-dd} to {endDate:yyyy-MM-dd}");
var result = await _dao.GetReceivingHistoryAsync(startDate, endDate);
⋮----
// Normalize PO numbers
⋮----
public async Task<Model_Dao_Result<List<Model_ReportRow>>> GetDunnageHistoryAsync(
⋮----
_logger.LogInfo($"Retrieving Dunnage history from {startDate:yyyy-MM-dd} to {endDate:yyyy-MM-dd}");
return await _dao.GetDunnageHistoryAsync(startDate, endDate);
⋮----
public async Task<Model_Dao_Result<List<Model_ReportRow>>> GetRoutingHistoryAsync(
⋮----
_logger.LogInfo($"Retrieving Routing history from {startDate:yyyy-MM-dd} to {endDate:yyyy-MM-dd}");
var result = await _dao.GetRoutingHistoryAsync(startDate, endDate);
⋮----
public async Task<Model_Dao_Result<List<Model_ReportRow>>> GetVolvoHistoryAsync(
⋮----
_logger.LogInfo($"Retrieving Volvo history from {startDate:yyyy-MM-dd} to {endDate:yyyy-MM-dd}");
return await _dao.GetVolvoHistoryAsync(startDate, endDate);
⋮----
public async Task<Model_Dao_Result<Dictionary<string, int>>> CheckAvailabilityAsync(
⋮----
_logger.LogInfo($"Checking module availability from {startDate:yyyy-MM-dd} to {endDate:yyyy-MM-dd}");
return await _dao.CheckAvailabilityAsync(startDate, endDate);
⋮----
/// Normalizes PO number to standard format
/// Matches EndOfDayEmail.js normalizePO() algorithm
⋮----
/// <param name="poNumber"></param>
public string NormalizePONumber(string? poNumber)
⋮----
// Handle null or empty
if (string.IsNullOrWhiteSpace(poNumber))
⋮----
poNumber = poNumber.Trim();
⋮----
// Pass through specific non-numeric values
if (poNumber.Equals("Customer Supplied", StringComparison.OrdinalIgnoreCase))
⋮----
// Extract numeric part and suffix
string numericPart = new string(poNumber.TakeWhile(char.IsDigit).ToArray());
string suffix = poNumber.Substring(numericPart.Length);
⋮----
// Validate length (must be at least 5 digits)
⋮----
// Pad to 6 digits if exactly 5
⋮----
// Format as PO-XXXXXX + optional suffix
⋮----
/// Exports data to CSV file matching MiniUPSLabel.csv structure
⋮----
/// <param name="data"></param>
/// <param name="moduleName"></param>
public async Task<Model_Dao_Result<string>> ExportToCSVAsync(
⋮----
_logger.LogInfo($"Exporting {data.Count} records to CSV for {moduleName} module");
⋮----
// Create CSV content based on module
var csv = new StringBuilder();
⋮----
switch (moduleName.ToLower())
⋮----
csv.AppendLine("PO Number,Part,Description,Qty,Weight,Heat/Lot,Date");
⋮----
csv.AppendLine($"\"{row.PONumber ?? ""}\",\"{row.PartNumber ?? ""}\",\"{row.PartDescription ?? ""}\",{row.Quantity ?? 0},{row.WeightLbs ?? 0},\"{row.HeatLotNumber ?? ""}\",{row.CreatedDate:yyyy-MM-dd}");
⋮----
csv.AppendLine("Type,Part,Specs,Qty,Date");
⋮----
csv.AppendLine($"\"{row.DunnageType ?? ""}\",\"{row.PartNumber ?? ""}\",\"{row.SpecsCombined ?? ""}\",{row.Quantity ?? 0},{row.CreatedDate:yyyy-MM-dd}");
⋮----
csv.AppendLine("Deliver To,Department,Package Description,PO Number,Work Order,Date");
⋮----
csv.AppendLine($"\"{row.DeliverTo ?? ""}\",\"{row.Department ?? ""}\",\"{row.PackageDescription ?? ""}\",\"{row.PONumber ?? ""}\",\"{row.WorkOrderNumber ?? ""}\",{row.CreatedDate:yyyy-MM-dd}");
⋮----
csv.AppendLine("Shipment Number,PO Number,Receiver Number,Status,Date,Part Count");
⋮----
csv.AppendLine($"{row.ShipmentNumber ?? 0},\"{row.PONumber ?? ""}\",\"{row.ReceiverNumber ?? ""}\",\"{row.Status ?? ""}\",{row.CreatedDate:yyyy-MM-dd},{row.PartCount ?? 0}");
⋮----
// Save to file
var timestamp = DateTime.Now.ToString("yyyyMMdd_HHmmss");
⋮----
var appDataPath = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
var mtmFolder = Path.Combine(appDataPath, "MTM_Receiving_Application", "Reports");
Directory.CreateDirectory(mtmFolder);
var filePath = Path.Combine(mtmFolder, fileName);
⋮----
await File.WriteAllTextAsync(filePath, csv.ToString());
_logger.LogInfo($"CSV exported successfully to {filePath}");
⋮----
return Model_Dao_Result_Factory.Success(filePath);
⋮----
_logger.LogError($"Error exporting CSV: {ex.Message}", ex);
⋮----
/// Formats data as HTML table with alternating row colors grouped by date
/// Matches Google Sheets colorHistory() function behavior
⋮----
/// <param name="applyDateGrouping"></param>
public async Task<Model_Dao_Result<string>> FormatForEmailAsync(
⋮----
_logger.LogInfo($"Formatting {data.Count} records for email");
⋮----
return Model_Dao_Result_Factory.Success("<p>No data to display</p>");
⋮----
var html = new StringBuilder();
html.AppendLine("<table style='border-collapse: collapse; width: 100%;'>");
⋮----
// Determine module type from first row
⋮----
// Add header based on module type
html.AppendLine("<thead>");
html.AppendLine("<tr style='background-color: #f0f0f0; font-weight: bold;'>");
⋮----
html.AppendLine("<th style='border: 1px solid #ddd; padding: 8px;'>PO Number</th>");
html.AppendLine("<th style='border: 1px solid #ddd; padding: 8px;'>Part</th>");
html.AppendLine("<th style='border: 1px solid #ddd; padding: 8px;'>Description</th>");
html.AppendLine("<th style='border: 1px solid #ddd; padding: 8px;'>Qty</th>");
html.AppendLine("<th style='border: 1px solid #ddd; padding: 8px;'>Weight</th>");
html.AppendLine("<th style='border: 1px solid #ddd; padding: 8px;'>Heat/Lot</th>");
html.AppendLine("<th style='border: 1px solid #ddd; padding: 8px;'>Date</th>");
⋮----
html.AppendLine("<th style='border: 1px solid #ddd; padding: 8px;'>Type</th>");
⋮----
html.AppendLine("<th style='border: 1px solid #ddd; padding: 8px;'>Specs</th>");
⋮----
html.AppendLine("<th style='border: 1px solid #ddd; padding: 8px;'>Deliver To</th>");
html.AppendLine("<th style='border: 1px solid #ddd; padding: 8px;'>Department</th>");
html.AppendLine("<th style='border: 1px solid #ddd; padding: 8px;'>Package Description</th>");
⋮----
html.AppendLine("<th style='border: 1px solid #ddd; padding: 8px;'>Data</th>");
⋮----
html.AppendLine("</tr>");
html.AppendLine("</thead>");
html.AppendLine("<tbody>");
⋮----
// Add rows with alternating colors (by date if grouping enabled)
⋮----
// Toggle color when date changes (if grouping enabled)
⋮----
html.AppendLine($"<tr style='background-color: {bgColor};'>");
⋮----
html.AppendLine($"<td style='border: 1px solid #ddd; padding: 8px;'>{row.PONumber ?? ""}</td>");
html.AppendLine($"<td style='border: 1px solid #ddd; padding: 8px;'>{row.PartNumber ?? ""}</td>");
html.AppendLine($"<td style='border: 1px solid #ddd; padding: 8px;'>{row.PartDescription ?? ""}</td>");
html.AppendLine($"<td style='border: 1px solid #ddd; padding: 8px;'>{row.Quantity ?? 0}</td>");
html.AppendLine($"<td style='border: 1px solid #ddd; padding: 8px;'>{row.WeightLbs ?? 0}</td>");
html.AppendLine($"<td style='border: 1px solid #ddd; padding: 8px;'>{row.HeatLotNumber ?? ""}</td>");
html.AppendLine($"<td style='border: 1px solid #ddd; padding: 8px;'>{row.CreatedDate:yyyy-MM-dd}</td>");
⋮----
html.AppendLine($"<td style='border: 1px solid #ddd; padding: 8px;'>{row.DunnageType ?? ""}</td>");
⋮----
html.AppendLine($"<td style='border: 1px solid #ddd; padding: 8px;'>{row.SpecsCombined ?? ""}</td>");
⋮----
html.AppendLine($"<td style='border: 1px solid #ddd; padding: 8px;'>{row.DeliverTo ?? ""}</td>");
html.AppendLine($"<td style='border: 1px solid #ddd; padding: 8px;'>{row.Department ?? ""}</td>");
html.AppendLine($"<td style='border: 1px solid #ddd; padding: 8px;'>{row.PackageDescription ?? ""}</td>");
⋮----
// Toggle for next row if not grouping by date
⋮----
html.AppendLine("</tbody>");
html.AppendLine("</table>");
⋮----
return Model_Dao_Result_Factory.Success(html.ToString());
⋮----
_logger.LogError($"Error formatting email: {ex.Message}", ex);
</file>

<file path="Module_Reporting/ViewModels/ViewModel_Reporting_Main.cs">
/// <summary>
/// Main ViewModel for Reporting module
/// Handles date range selection, module availability checking, and report generation
/// </summary>
public partial class ViewModel_Reporting_Main : ViewModel_Shared_Base
⋮----
private readonly IService_Reporting _reportingService;
⋮----
private DateTimeOffset _startDate = DateTimeOffset.Now.AddDays(-7);
⋮----
private DateTimeOffset _endDate = DateTimeOffset.Now;
⋮----
_reportingService = reportingService ?? throw new ArgumentNullException(nameof(reportingService));
⋮----
/// Checks data availability for each module in the selected date range
⋮----
private async Task CheckAvailabilityAsync()
⋮----
var result = await _reportingService.CheckAvailabilityAsync(
⋮----
// Update counts
ReceivingCount = result.Data.GetValueOrDefault("Receiving", 0);
DunnageCount = result.Data.GetValueOrDefault("Dunnage", 0);
RoutingCount = result.Data.GetValueOrDefault("Routing", 0);
VolvoCount = result.Data.GetValueOrDefault("Volvo", 0);
⋮----
// Enable/disable checkboxes based on availability
⋮----
_logger.LogError($"Error checking availability: {ex.Message}", ex);
⋮----
/// Generates report for Receiving module
⋮----
private async Task GenerateReceivingReportAsync()
⋮----
() => _reportingService.GetReceivingHistoryAsync(StartDate.DateTime, EndDate.DateTime));
⋮----
private bool CanGenerateReceiving() => IsReceivingChecked && IsReceivingEnabled && !IsBusy;
⋮----
/// Generates report for Dunnage module
⋮----
private async Task GenerateDunnageReportAsync()
⋮----
() => _reportingService.GetDunnageHistoryAsync(StartDate.DateTime, EndDate.DateTime));
⋮----
private bool CanGenerateDunnage() => IsDunnageChecked && IsDunnageEnabled && !IsBusy;
⋮----
/// Generates report for Routing module
⋮----
private async Task GenerateRoutingReportAsync()
⋮----
() => _reportingService.GetRoutingHistoryAsync(StartDate.DateTime, EndDate.DateTime));
⋮----
private bool CanGenerateRouting() => IsRoutingChecked && IsRoutingEnabled && !IsBusy;
⋮----
/// Generates report for Volvo module
⋮----
private async Task GenerateVolvoReportAsync()
⋮----
() => _reportingService.GetVolvoHistoryAsync(StartDate.DateTime, EndDate.DateTime));
⋮----
private bool CanGenerateVolvo() => IsVolvoChecked && IsVolvoEnabled && !IsBusy;
⋮----
/// Exports current report data to CSV
⋮----
private async Task ExportToCSVAsync()
⋮----
var result = await _reportingService.ExportToCSVAsync(
ReportData.ToList(),
⋮----
if (result.IsSuccess && !string.IsNullOrEmpty(result.Data))
⋮----
_logger.LogInfo($"CSV exported: {result.Data}");
⋮----
_logger.LogError($"Error exporting CSV: {ex.Message}", ex);
⋮----
private bool CanExport() => ReportData.Count > 0 && !string.IsNullOrEmpty(CurrentModuleName) && !IsBusy;
⋮----
/// Formats current report data for email and copies to clipboard
⋮----
private async Task CopyEmailFormatAsync()
⋮----
var result = await _reportingService.FormatForEmailAsync(
⋮----
// Copy to clipboard
⋮----
dataPackage.SetHtmlFormat(result.Data);
dataPackage.SetText(result.Data);
Windows.ApplicationModel.DataTransfer.Clipboard.SetContent(dataPackage);
⋮----
_logger.LogInfo("Email format copied to clipboard");
⋮----
_logger.LogError($"Error copying email format: {ex.Message}", ex);
⋮----
private bool CanCopyEmail() => ReportData.Count > 0 && !IsBusy;
⋮----
/// Helper method to generate report for a specific module
⋮----
/// <param name="moduleName"></param>
/// <param name="fetchDataFunc"></param>
private async Task GenerateReportForModuleAsync(
⋮----
ReportData.Clear();
⋮----
ReportData.Add(row);
⋮----
_logger.LogInfo($"Generated {moduleName} report: {ReportData.Count} records");
⋮----
// Update command availability
ExportToCSVCommand.NotifyCanExecuteChanged();
CopyEmailFormatCommand.NotifyCanExecuteChanged();
⋮----
_logger.LogError($"Error generating {moduleName} report: {ex.Message}", ex);
⋮----
/// Update command availability when checkbox states change
⋮----
partial void OnIsReceivingCheckedChanged(bool value)
⋮----
GenerateReceivingReportCommand.NotifyCanExecuteChanged();
⋮----
partial void OnIsDunnageCheckedChanged(bool value)
⋮----
GenerateDunnageReportCommand.NotifyCanExecuteChanged();
⋮----
partial void OnIsRoutingCheckedChanged(bool value)
⋮----
GenerateRoutingReportCommand.NotifyCanExecuteChanged();
⋮----
partial void OnIsVolvoCheckedChanged(bool value)
⋮----
GenerateVolvoReportCommand.NotifyCanExecuteChanged();
</file>

<file path="Module_Routing/Constants/Constant_Routing.cs">
/// <summary>
/// Constants for Routing Module
/// Fixes Issue #10: Magic string "OTHER" scattered across codebase
/// </summary>
public static class Constant_Routing
⋮----
/// Special PO number value indicating non-PO package
⋮----
/// Line number used for OTHER packages
</file>

<file path="Module_Routing/Constants/Constant_RoutingConfiguration.cs">
/// <summary>
/// Configuration key constants for Routing Module
/// Fixes Issue #22: Magic numbers in configuration keys
/// </summary>
public static class Constant_RoutingConfiguration
⋮----
// CSV Export Configuration
⋮----
// CSV Retry Configuration
⋮----
// Default Values
</file>

<file path="Module_Routing/Data/Dao_RoutingRecipient.cs">
/// <summary>
/// Data Access Object for routing_recipients table
/// </summary>
public class Dao_RoutingRecipient
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Retrieves all active recipients
⋮----
public async Task<Model_Dao_Result<List<Model_RoutingRecipient>>> GetAllActiveRecipientsAsync()
⋮----
/// Retrieves top recipients by usage (personalized or system-wide)
⋮----
/// <param name="employeeNumber"></param>
/// <param name="topCount"></param>
public async Task<Model_Dao_Result<List<Model_RoutingRecipient>>> GetTopRecipientsByUsageAsync(int employeeNumber, int topCount = 5)
⋮----
private Model_RoutingRecipient MapFromReader(IDataReader reader)
⋮----
return new Model_RoutingRecipient
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
Name = reader.GetString(reader.GetOrdinal("name")),
Location = reader.GetString(reader.GetOrdinal("location")),
Department = reader.IsDBNull(reader.GetOrdinal("department")) ? null : reader.GetString(reader.GetOrdinal("department")),
IsActive = reader.GetBoolean(reader.GetOrdinal("is_active")),
CreatedDate = reader.GetDateTime(reader.GetOrdinal("created_date")),
UpdatedDate = reader.GetDateTime(reader.GetOrdinal("updated_date"))
⋮----
private Model_RoutingRecipient MapFromReaderWithUsage(IDataReader reader)
⋮----
recipient.UsageCount = reader.GetInt32(reader.GetOrdinal("usage_count"));
</file>

<file path="Module_Routing/Interfaces/IDao_RoutingLabel.cs">
/// <summary>
/// Interface for routing label data access operations
/// Issue #25: Created for testability and dependency injection
/// </summary>
public interface IDao_RoutingLabel
⋮----
Task<Model_Dao_Result<int>> InsertLabelAsync(Model_RoutingLabel label);
Task<Model_Dao_Result> UpdateLabelAsync(Model_RoutingLabel label);
Task<Model_Dao_Result<Model_RoutingLabel>> GetLabelByIdAsync(int labelId);
Task<Model_Dao_Result<List<Model_RoutingLabel>>> GetAllLabelsAsync(int limit = 100, int offset = 0);
Task<Model_Dao_Result> DeleteLabelAsync(int labelId);
Task<Model_Dao_Result> MarkLabelExportedAsync(int labelId);
Task<Model_Dao_Result<Model_RoutingLabel>> CheckDuplicateLabelAsync(string poNumber, string lineNumber, int recipientId, int hoursWindow = 24);
Task<Model_Dao_Result<(bool Exists, int? ExistingLabelId)>> CheckDuplicateAsync(string poNumber, string lineNumber, int recipientId, DateTime createdWithinDate);
Task<Model_Dao_Result> MarkExportedAsync(List<int> labelIds);
</file>

<file path="Module_Routing/Interfaces/IDao_RoutingLabelHistory.cs">
/// <summary>
/// Interface for label history data access operations
/// Issue #25: Created for testability and dependency injection
/// </summary>
public interface IDao_RoutingLabelHistory
⋮----
Task<Model_Dao_Result> InsertHistoryAsync(Model_RoutingLabelHistory history);
Task<Model_Dao_Result> InsertHistoryBatchAsync(List<Model_RoutingLabelHistory> historyEntries);
Task<Model_Dao_Result<List<Model_RoutingLabelHistory>>> GetHistoryByLabelAsync(int labelId);
</file>

<file path="Module_Routing/Interfaces/IDao_RoutingRecipient.cs">
/// <summary>
/// Interface for routing recipient data access operations
/// Issue #25: Created for testability and dependency injection
/// </summary>
public interface IDao_RoutingRecipient
⋮----
Task<Model_Dao_Result<List<Model_RoutingRecipient>>> GetAllActiveRecipientsAsync();
Task<Model_Dao_Result<List<Model_RoutingRecipient>>> GetTopRecipientsByUsageAsync(int employeeNumber, int topCount = 5);
</file>

<file path="Module_Routing/Interfaces/IDao_RoutingUsageTracking.cs">
/// <summary>
/// Interface for usage tracking data access operations
/// Issue #25: Created for testability and dependency injection
/// </summary>
public interface IDao_RoutingUsageTracking
⋮----
Task<Model_Dao_Result> IncrementUsageAsync(int employeeNumber, int recipientId);
</file>

<file path="Module_Routing/Models/Model_RoutingLabelHistory.cs">
/// <summary>
/// Represents audit trail entry for label edits
/// Maps to routing_history database table
/// </summary>
public class Model_RoutingLabelHistory
⋮----
/// Auto-increment primary key
⋮----
/// Foreign key to routing_label_data table
⋮----
/// Name of field that was changed (e.g., "Recipient", "Quantity")
⋮----
/// Old value before edit (nullable)
⋮----
/// New value after edit (nullable)
⋮----
/// Employee number who made the edit
⋮----
/// Timestamp of edit
</file>

<file path="Module_Routing/Models/Model_RoutingOtherReason.cs">
/// <summary>
/// Represents a reason code for non-PO packages (po_number='OTHER')
/// Maps to routing_po_alternatives database table
/// </summary>
public class Model_RoutingOtherReason
⋮----
/// Auto-increment primary key
⋮----
/// Short reason code (e.g., "RETURNED", "SAMPLE")
⋮----
/// User-facing description (e.g., "Returned Item")
⋮----
/// Active status (0=inactive, 1=active)
⋮----
/// Sort order for dropdown display (lower = first)
</file>

<file path="Module_Routing/Models/Model_RoutingRecipient.cs">
/// <summary>
/// Represents a recipient (person or department) who can receive packages
/// Maps to routing_recipients database table
/// </summary>
public class Model_RoutingRecipient
⋮----
/// Auto-increment primary key
⋮----
/// Recipient name (unique, person or department)
⋮----
/// Physical location (e.g., "Building A - Floor 2")
⋮----
/// Department name (optional)
⋮----
/// Active status (0=inactive, 1=active)
⋮----
/// Record creation timestamp
⋮----
/// Last update timestamp
⋮----
/// Usage count for sorting (from JOIN with routing_recipient_tracker, not stored in table)
</file>

<file path="Module_Routing/Models/Model_RoutingUsageTracking.cs">
/// <summary>
/// Represents usage tracking for personalized Quick Add and smart sorting
/// Maps to routing_recipient_tracker database table
/// </summary>
public class Model_RoutingUsageTracking
⋮----
/// Auto-increment primary key
⋮----
/// Employee number being tracked
⋮----
/// Foreign key to routing_recipients table
⋮----
/// Number of times employee selected this recipient
⋮----
/// Timestamp of most recent usage
</file>

<file path="Module_Routing/Models/Model_RoutingUserPreference.cs">
/// <summary>
/// Represents user preferences for routing module (default mode, validation toggle)
/// Maps to settings_routing_personal database table
/// </summary>
public class Model_RoutingUserPreference
⋮----
/// Auto-increment primary key
⋮----
/// Employee number (unique)
⋮----
/// Default mode: "WIZARD", "MANUAL", or "EDIT"
⋮----
/// Infor Visual validation toggle (true=on, false=off)
⋮----
/// Last update timestamp
</file>

<file path="Module_Routing/Services/IRoutingInforVisualService.cs">
/// <summary>
/// Service interface for Infor Visual ERP integration: PO validation, line retrieval (READ ONLY)
/// </summary>
public interface IRoutingInforVisualService
⋮----
/// Validates PO number exists in Infor Visual MTMFG database
⋮----
/// <param name="poNumber">PO number to validate</param>
/// <returns>Result with validation status (IsSuccess=true if found, false if not found or error)</returns>
public Task<Model_Dao_Result<bool>> ValidatePoNumberAsync(string poNumber);
⋮----
/// Retrieves line items for a valid PO number from Infor Visual
⋮----
/// <param name="poNumber">PO number to retrieve lines for</param>
/// <returns>Result with list of PO line items (part number, description, quantity) or error</returns>
public Task<Model_Dao_Result<List<Model_InforVisualPOLine>>> GetPoLinesAsync(string poNumber);
⋮----
/// Retrieves a single line item for a PO from Infor Visual
⋮----
/// <param name="poNumber">PO number</param>
/// <param name="lineNumber">Line number</param>
/// <returns>Result with PO line data or error</returns>
public Task<Model_Dao_Result<Model_InforVisualPOLine>> GetPoLineAsync(string poNumber, string lineNumber);
⋮----
/// Checks if Infor Visual connection is available (health check)
⋮----
/// <returns>Result with connection status (IsSuccess=true if available)</returns>
public Task<Model_Dao_Result<bool>> CheckConnectionAsync();
</file>

<file path="Module_Routing/Services/IRoutingService.cs">
/// <summary>
/// Service interface for core routing label operations: creation, editing, CSV export, validation
/// </summary>
public interface IRoutingService
⋮----
/// Creates a new routing label, saves to database and exports to CSV
⋮----
/// <param name="label">Label data to create</param>
/// <returns>Result with created label ID or error message</returns>
public Task<Model_Dao_Result<int>> CreateLabelAsync(Model_RoutingLabel label);
⋮----
/// Updates an existing routing label (Edit Mode), logs changes to history
⋮----
/// <param name="label">Updated label data (must include ID)</param>
/// <param name="editedByEmployeeNumber">Employee number making the edit</param>
/// <returns>Result indicating success or failure</returns>
public Task<Model_Dao_Result> UpdateLabelAsync(Model_RoutingLabel label, int editedByEmployeeNumber);
⋮----
/// Retrieves a single label by ID
⋮----
/// <param name="labelId">Label ID to retrieve</param>
/// <returns>Result with label data or error message</returns>
public Task<Model_Dao_Result<Model_RoutingLabel>> GetLabelByIdAsync(int labelId);
⋮----
/// Retrieves all labels for Edit Mode grid (paginated, sorted by date DESC)
⋮----
/// <param name="limit">Number of records to return</param>
/// <param name="offset">Number of records to skip</param>
/// <returns>Result with list of labels or error message</returns>
public Task<Model_Dao_Result<List<Model_RoutingLabel>>> GetAllLabelsAsync(int limit = 100, int offset = 0);
⋮----
/// Checks if a duplicate label exists (same PO, Line, Recipient, Date)
⋮----
/// <param name="poNumber">PO number</param>
/// <param name="lineNumber">Line number</param>
/// <param name="recipientId">Recipient ID</param>
/// <param name="createdDate">Date to check</param>
/// <returns>Result with duplicate check data (exists flag + existing label ID if found)</returns>
public Task<Model_Dao_Result<(bool Exists, int? ExistingLabelId)>> CheckDuplicateLabelAsync(
⋮----
/// Exports a single label to CSV file (async with retry)
⋮----
/// <param name="label">Label to export</param>
/// <returns>Result indicating CSV export success or failure</returns>
public Task<Model_Dao_Result> ExportLabelToCsvAsync(Model_RoutingLabel label);
⋮----
/// Regenerates CSV entry for a label (Reprint functionality in Edit Mode)
⋮----
/// <param name="labelId">Label ID to regenerate CSV for</param>
/// <returns>Result indicating CSV regeneration success or failure</returns>
public Task<Model_Dao_Result> RegenerateLabelCsvAsync(int labelId);
⋮----
/// Resets (clears) the CSV file (with confirmation required)
⋮----
/// <returns>Result indicating CSV reset success or failure</returns>
public Task<Model_Dao_Result> ResetCsvFileAsync();
⋮----
/// Validates label data before creation (business rules)
⋮----
/// <param name="label">Label to validate</param>
/// <returns>Validation result (IsSuccess=true if valid, ErrorMessage if invalid)</returns>
public Model_Dao_Result ValidateLabel(Model_RoutingLabel label);
</file>

<file path="Module_Routing/Services/IRoutingUsageTrackingService.cs">
/// <summary>
/// Service interface for usage tracking: increment counts, smart sorting calculation
/// </summary>
public interface IRoutingUsageTrackingService
⋮----
/// Increments usage count for employee-recipient pair (called after label creation)
⋮----
/// <param name="employeeNumber">Employee who created the label</param>
/// <param name="recipientId">Recipient selected for the label</param>
/// <returns>Result indicating success or failure</returns>
public Task<Model_Dao_Result> IncrementUsageCountAsync(int employeeNumber, int recipientId);
⋮----
/// Retrieves usage count for a specific employee-recipient pair
⋮----
/// <param name="employeeNumber">Employee number</param>
/// <param name="recipientId">Recipient ID</param>
/// <returns>Result with usage count (0 if no usage record exists)</returns>
public Task<Model_Dao_Result<int>> GetUsageCountAsync(int employeeNumber, int recipientId);
⋮----
/// Retrieves total number of labels created by employee (for 20-label threshold check)
⋮----
/// <returns>Result with label count</returns>
public Task<Model_Dao_Result<int>> GetEmployeeLabelCountAsync(int employeeNumber);
</file>

<file path="Module_Routing/Services/IRoutingUserPreferenceService.cs">
/// <summary>
/// Service interface for user preferences: default mode, validation toggle
/// </summary>
public interface IRoutingUserPreferenceService
⋮----
/// Retrieves user preferences for employee (returns defaults if not set)
⋮----
/// <param name="employeeNumber">Employee number</param>
/// <returns>Result with user preference data (default_mode, enable_validation)</returns>
public Task<Model_Dao_Result<Model_RoutingUserPreference>> GetUserPreferenceAsync(int employeeNumber);
⋮----
/// Creates or updates user preferences
⋮----
/// <param name="preference">User preference data to save</param>
/// <returns>Result indicating success or failure</returns>
public Task<Model_Dao_Result> SaveUserPreferenceAsync(Model_RoutingUserPreference preference);
⋮----
/// Resets user preferences to defaults (Wizard mode, validation enabled)
⋮----
public Task<Model_Dao_Result> ResetToDefaultsAsync(int employeeNumber);
</file>

<file path="Module_Routing/Views/RoutingEditModeView.xaml.cs">
public sealed partial class RoutingEditModeView : Page
⋮----
private async void OnPageLoaded(object sender, RoutedEventArgs e)
⋮----
await ViewModel.InitializeAsync();
⋮----
private async void OnDataGridDoubleTapped(object sender, DoubleTappedRoutedEventArgs e)
⋮----
await EditSelectedLabelCommand.ExecuteAsync(null);
⋮----
private async Task EditSelectedLabelCommand_ExecuteAsync(object? parameter)
⋮----
// Create a copy for editing
var editedLabel = new Model_RoutingLabel
⋮----
// Create edit dialog
var dialog = new ContentDialog
⋮----
// Create dialog content
var grid = new Grid
⋮----
Padding = new Thickness(24)
⋮----
grid.RowDefinitions.Add(new RowDefinition { Height = GridLength.Auto });
⋮----
grid.ColumnDefinitions.Add(new ColumnDefinition { Width = GridLength.Auto });
grid.ColumnDefinitions.Add(new ColumnDefinition { Width = new GridLength(1, GridUnitType.Star) });
⋮----
// PO Number (read-only)
var poLabel = new TextBlock { Text = "PO Number:", VerticalAlignment = VerticalAlignment.Center };
var poValue = new TextBox { Text = editedLabel.PONumber ?? "N/A", IsReadOnly = true };
Grid.SetRow(poLabel, 0);
Grid.SetColumn(poLabel, 0);
Grid.SetRow(poValue, 0);
Grid.SetColumn(poValue, 1);
grid.Children.Add(poLabel);
grid.Children.Add(poValue);
⋮----
// Part Description (read-only)
var partLabel = new TextBlock { Text = "Part Description:", VerticalAlignment = VerticalAlignment.Center };
var partValue = new TextBox { Text = editedLabel.Description ?? "N/A", IsReadOnly = true };
Grid.SetRow(partLabel, 1);
Grid.SetColumn(partLabel, 0);
Grid.SetRow(partValue, 1);
Grid.SetColumn(partValue, 1);
grid.Children.Add(partLabel);
grid.Children.Add(partValue);
⋮----
// Recipient (editable ComboBox)
var recipientLabel = new TextBlock { Text = "Recipient:", VerticalAlignment = VerticalAlignment.Center };
var recipientCombo = new ComboBox
⋮----
Grid.SetRow(recipientLabel, 2);
Grid.SetColumn(recipientLabel, 0);
Grid.SetRow(recipientCombo, 2);
Grid.SetColumn(recipientCombo, 1);
grid.Children.Add(recipientLabel);
grid.Children.Add(recipientCombo);
⋮----
// Quantity (editable NumberBox)
var qtyLabel = new TextBlock { Text = "Quantity:", VerticalAlignment = VerticalAlignment.Center };
var qtyBox = new NumberBox
⋮----
Grid.SetRow(qtyLabel, 3);
Grid.SetColumn(qtyLabel, 0);
Grid.SetRow(qtyBox, 3);
Grid.SetColumn(qtyBox, 1);
grid.Children.Add(qtyLabel);
grid.Children.Add(qtyBox);
⋮----
// Created Date (read-only)
var dateLabel = new TextBlock { Text = "Created Date:", VerticalAlignment = VerticalAlignment.Center };
var dateValue = new TextBox { Text = editedLabel.CreatedDate.ToString("g"), IsReadOnly = true };
Grid.SetRow(dateLabel, 4);
Grid.SetColumn(dateLabel, 0);
Grid.SetRow(dateValue, 4);
Grid.SetColumn(dateValue, 1);
grid.Children.Add(dateLabel);
grid.Children.Add(dateValue);
⋮----
var result = await dialog.ShowAsync();
⋮----
// Update edited label with new values
⋮----
// Save changes
await ViewModel.SaveEditedLabelCommand.ExecuteAsync(editedLabel);
</file>

<file path="Module_Routing/Views/RoutingManualEntryView.xaml">
<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MTM_Receiving_Application.Module_Routing.Views.RoutingManualEntryView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    mc:Ignorable="d"
    Loaded="OnPageLoaded">

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="8">
            <TextBlock Text="Manual Entry Mode" Style="{StaticResource TitleTextBlockStyle}"/>
            <TextBlock Text="Enter multiple labels and save in batch" Style="{StaticResource BodyTextBlockStyle}"/>
        </StackPanel>

        <!-- DataGrid -->
        <controls:DataGrid 
            Grid.Row="1"
            ItemsSource="{x:Bind ViewModel.Labels, Mode=OneWay}"
            SelectedItem="{x:Bind ViewModel.SelectedLabel, Mode=TwoWay}"
            AutoGenerateColumns="False"
            CanUserReorderColumns="False"
            CanUserSortColumns="False"
            GridLinesVisibility="All"
            HeadersVisibility="All"
            SelectionMode="Single"
            AlternatingRowBackground="#F5F5F5"
            CellEditEnding="OnCellEditEnding">
            
            <controls:DataGrid.Columns>
                <!-- PO Number -->
                <controls:DataGridTextColumn 
                    Header="PO Number" 
                    Binding="{Binding PONumber, Mode=TwoWay}"
                    Width="150"/>

                <!-- Line -->
                <controls:DataGridTextColumn 
                    Header="Line" 
                    Binding="{Binding POLine, Mode=TwoWay}"
                    Width="80"/>

                <!-- Recipient - Using Template Column since WinUI DataGridComboBoxColumn has different API -->
                <controls:DataGridTemplateColumn 
                    Header="Recipient"
                    Width="200">
                    <controls:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock 
                                Text="{Binding RecipientName}" 
                                VerticalAlignment="Center"
                                Padding="8,0"/>
                        </DataTemplate>
                    </controls:DataGridTemplateColumn.CellTemplate>
                    <controls:DataGridTemplateColumn.CellEditingTemplate>
                        <DataTemplate>
                            <ComboBox 
                                SelectedValue="{Binding RecipientID, Mode=TwoWay}"
                                ItemsSource="{Binding DataContext.AllRecipients, RelativeSource={RelativeSource Mode=TemplatedParent}}"
                                DisplayMemberPath="Name"
                                SelectedValuePath="Id"
                                HorizontalAlignment="Stretch"/>
                        </DataTemplate>
                    </controls:DataGridTemplateColumn.CellEditingTemplate>
                </controls:DataGridTemplateColumn>

                <!-- Quantity -->
                <controls:DataGridTextColumn 
                    Header="Quantity" 
                    Binding="{Binding Quantity, Mode=TwoWay}"
                    Width="100"/>

                <!-- Part ID (Read-Only, auto-populated) -->
                <controls:DataGridTextColumn 
                    Header="Part ID" 
                    Binding="{Binding PartID, Mode=OneWay}"
                    IsReadOnly="True"
                    Width="*"/>
            </controls:DataGrid.Columns>
        </controls:DataGrid>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="12">
            <Button 
                Content="Add Row" 
                Command="{x:Bind ViewModel.AddNewRowCommand}"
                Style="{StaticResource AccentButtonStyle}"/>
            
            <Button 
                Content="Delete Row" 
                Command="{x:Bind ViewModel.DeleteSelectedRowCommand}"/>
            
            <Button 
                Content="Save All Labels" 
                Command="{x:Bind ViewModel.SaveAllLabelsCommand}"
                Style="{StaticResource AccentButtonStyle}"/>
        </StackPanel>

        <!-- Status Bar -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="12">
            <ProgressRing 
                IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                Width="20" 
                Height="20"/>
            
            <TextBlock 
                Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                VerticalAlignment="Center"/>
            
            <TextBlock 
                Text="{x:Bind ViewModel.LabelCount, Mode=OneWay}"
                VerticalAlignment="Center"
                Foreground="{ThemeResource SystemAccentColor}"/>
            
            <TextBlock 
                Text="labels ready to save"
                VerticalAlignment="Center"/>
        </StackPanel>
    </Grid>
</Page>
</file>

<file path="Module_Routing/Views/RoutingManualEntryView.xaml.cs">
public sealed partial class RoutingManualEntryView : Page
⋮----
private async void OnPageLoaded(object sender, RoutedEventArgs e)
⋮----
await ViewModel.InitializeAsync();
⋮----
private async void OnCellEditEnding(object sender, DataGridCellEditEndingEventArgs e)
⋮----
// If PO Number column was edited, validate PO
if (e.Column.Header.ToString() == "PO Number" && !e.Cancel)
⋮----
// Defer validation to avoid concurrent access issues
_ = DispatcherQueue.TryEnqueue(async () =>
⋮----
await ViewModel.ValidatePOAsync(label);
</file>

<file path="Module_Routing/Views/RoutingModeSelectionView.xaml.cs">
public sealed partial class RoutingModeSelectionView : Page
⋮----
private async void OnPageLoaded(object sender, RoutedEventArgs e)
⋮----
ViewModel.SetNavigationFrame(this.Frame);
⋮----
await ViewModel.InitializeAsync();
</file>

<file path="Module_Routing/Views/RoutingWizardStep2View.xaml.cs">
public sealed partial class RoutingWizardStep2View : Page
⋮----
private async void OnPageLoaded(object sender, RoutedEventArgs e)
⋮----
// Load recipients when page loads
await ViewModel.LoadRecipientsCommand.ExecuteAsync(null);
⋮----
private void ListView_KeyDown(object sender, KeyRoutedEventArgs e)
⋮----
ViewModel.ProceedToStep3Command.Execute(null);
</file>

<file path="Module_Settings/Interfaces/IService_SettingsWorkflow.cs">
/// <summary>
/// Service for managing Settings workflow navigation and state
/// </summary>
public interface IService_SettingsWorkflow
⋮----
/// Event raised when workflow step changes
⋮----
/// Navigate to a specific step in the settings workflow
⋮----
/// <param name="step"></param>
public void GoToStep(Enum_SettingsWorkflowStep step);
⋮----
/// Go back to the previous step
⋮----
public void GoBack();
⋮----
/// Reset workflow to initial state
⋮----
public void Reset();
</file>

<file path="Module_Settings/Models/Model_ConnectionTestResult.cs">
/// <summary>
/// Represents the result of a database connection test (development diagnostics)
/// </summary>
public partial class Model_ConnectionTestResult : ObservableObject
</file>

<file path="Module_Settings/Models/Model_DaoTestResult.cs">
/// <summary>
/// Represents a DAO validation result (development diagnostics)
/// </summary>
public partial class Model_DaoTestResult : ObservableObject
</file>

<file path="Module_Settings/Models/Model_SettingValue.cs">
/// <summary>
/// Helper model for working with typed setting values
/// Provides type-safe conversion from raw string values
/// </summary>
public class Model_SettingValue
⋮----
/// Returns the raw string value
⋮----
public string AsString() => RawValue ?? string.Empty;
⋮----
/// Parses the value as an integer (returns 0 if invalid)
⋮----
public int AsInt() => int.TryParse(RawValue, out var val) ? val : 0;
⋮----
/// Parses the value as a boolean (returns false if invalid)
⋮----
public bool AsBool() => bool.TryParse(RawValue, out var val) && val;
⋮----
/// Parses the value as a double (returns 0.0 if invalid)
⋮----
public double AsDouble() => double.TryParse(RawValue, out var val) ? val : 0.0;
⋮----
/// Deserializes the value as JSON (returns default(T) if invalid)
⋮----
public T? AsJson<T>()
⋮----
return string.IsNullOrWhiteSpace(RawValue)
⋮----
/// Returns the value as a strongly-typed object based on DataType
⋮----
public object? AsTyped()
</file>

<file path="Module_Settings/Models/Model_StoredProcedureTestResult.cs">
/// <summary>
/// Represents a stored procedure validation result (development diagnostics)
/// </summary>
public partial class Model_StoredProcedureTestResult : ObservableObject
</file>

<file path="Module_Settings/Models/Model_TableTestResult.cs">
/// <summary>
/// Represents a database table validation result (development diagnostics)
/// </summary>
public partial class Model_TableTestResult : ObservableObject
</file>

<file path="Module_Settings/Services/Service_UserPreferences.cs">
public class Service_UserPreferences : IService_UserPreferences
⋮----
private readonly Dao_User _userDao;
private readonly IService_LoggingUtility _logger;
private readonly IService_ErrorHandler _errorHandler;
⋮----
public async Task<Model_Dao_Result<Model_UserPreference>> GetLatestUserPreferenceAsync(string username)
⋮----
// BUSINESS RULE: Username normalization
⋮----
if (string.IsNullOrWhiteSpace(normalizedUsername))
⋮----
// DELEGATE TO DAO
var userResult = await _userDao.GetUserByWindowsUsernameAsync(normalizedUsername);
⋮----
_logger.LogError(
⋮----
// Brand-new users must always have usable defaults.
// Persisted fields may be null if migrations are not yet applied; provide safe fallbacks.
var preference = new Model_UserPreference
⋮----
DefaultReceivingMode = string.IsNullOrWhiteSpace(userResult.Data.DefaultReceivingMode)
⋮----
DefaultDunnageMode = string.IsNullOrWhiteSpace(userResult.Data.DefaultDunnageMode)
⋮----
return Model_Dao_Result_Factory.Success(preference);
⋮----
_logger.LogError($"Error getting user preference for {username}", ex, "UserPreferences");
⋮----
public async Task<Model_Dao_Result> UpdateDefaultModeAsync(string username, string defaultMode)
⋮----
return Model_Dao_Result_Factory.Success();
⋮----
_logger.LogWarning($"Default mode update skipped: user not found ({normalizedUsername})");
⋮----
var normalizedMode = string.IsNullOrWhiteSpace(defaultMode)
⋮----
: defaultMode.Trim().ToLowerInvariant();
⋮----
var result = await _userDao.UpdateDefaultModeAsync(userResult.Data.EmployeeNumber, normalizedMode);
⋮----
_logger.LogWarning($"Default mode update failed (non-blocking): {result.ErrorMessage}");
⋮----
_logger.LogError($"Error updating default mode for {username} (non-blocking)", ex, "UserPreferences");
⋮----
public async Task<Model_Dao_Result> UpdateDefaultReceivingModeAsync(string username, string defaultMode)
⋮----
_logger.LogWarning($"Receiving default update skipped: user not found ({normalizedUsername})");
⋮----
var result = await _userDao.UpdateDefaultReceivingModeAsync(userResult.Data.EmployeeNumber, normalizedMode);
⋮----
_logger.LogWarning($"Receiving default update failed (non-blocking): {result.ErrorMessage}");
⋮----
_logger.LogError($"Error updating receiving default for {username} (non-blocking)", ex, "UserPreferences");
⋮----
public async Task<Model_Dao_Result> UpdateDefaultDunnageModeAsync(string username, string defaultMode)
⋮----
_logger.LogWarning($"Dunnage default update skipped: user not found ({normalizedUsername})");
⋮----
var result = await _userDao.UpdateDefaultDunnageModeAsync(userResult.Data.EmployeeNumber, normalizedMode);
⋮----
_logger.LogWarning($"Dunnage default update failed (non-blocking): {result.ErrorMessage}");
⋮----
_logger.LogError($"Error updating dunnage default for {username} (non-blocking)", ex, "UserPreferences");
</file>

<file path="Module_Settings/Views/View_Settings_DatabaseTest.xaml.cs">
/// <summary>
/// Settings Database Test page - Development tool for validating database schema, stored procedures, and DAOs
/// </summary>
public sealed partial class View_Settings_DatabaseTest : Page
⋮----
System.Diagnostics.Debug.WriteLine("[DatabaseTestView] Constructor started");
⋮----
// CRITICAL: Set ViewModel BEFORE InitializeComponent() for x:Bind to work
⋮----
System.Diagnostics.Debug.WriteLine("[DatabaseTestView] Attempting to get ViewModel from DI");
⋮----
System.Diagnostics.Debug.WriteLine($"[DatabaseTestView] ViewModel obtained: {ViewModel != null}");
⋮----
throw new InvalidOperationException("Failed to obtain ViewModel from DI - returned null");
⋮----
System.Diagnostics.Debug.WriteLine($"[DatabaseTestView] Failed to create ViewModel: {ex.Message}");
System.Diagnostics.Debug.WriteLine($"[DatabaseTestView] Exception type: {ex.GetType().FullName}");
System.Diagnostics.Debug.WriteLine($"[DatabaseTestView] Stack trace: {ex.StackTrace}");
⋮----
// Cannot continue without ViewModel for x:Bind
⋮----
// Initialize component AFTER ViewModel is set (required for x:Bind)
System.Diagnostics.Debug.WriteLine("[DatabaseTestView] Calling InitializeComponent()");
⋮----
System.Diagnostics.Debug.WriteLine("[DatabaseTestView] InitializeComponent() completed");
⋮----
System.Diagnostics.Debug.WriteLine($"[DatabaseTestView] InitializeComponent() FAILED: {ex.Message}");
⋮----
throw; // Re-throw to show in navigation error dialog
⋮----
System.Diagnostics.Debug.WriteLine("[DatabaseTestView] Setting DataContext");
⋮----
// Attach focus service if available
⋮----
System.Diagnostics.Debug.WriteLine("[DatabaseTestView] Attempting to get Focus service");
⋮----
System.Diagnostics.Debug.WriteLine("[DatabaseTestView] Attaching focus service");
focusService.AttachFocusOnVisibility(this);
⋮----
System.Diagnostics.Debug.WriteLine("[DatabaseTestView] Focus service is null");
⋮----
System.Diagnostics.Debug.WriteLine($"[DatabaseTestView] Focus service failed (non-critical): {ex.Message}");
⋮----
// Run tests after view is loaded
System.Diagnostics.Debug.WriteLine("[DatabaseTestView] Attaching Loaded event handler");
⋮----
System.Diagnostics.Debug.WriteLine("[DatabaseTestView] Constructor completed");
⋮----
private async void OnLoaded(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
⋮----
System.Diagnostics.Debug.WriteLine("[DatabaseTestView] OnLoaded event fired");
⋮----
// Run tests after UI is fully initialized
⋮----
System.Diagnostics.Debug.WriteLine("[DatabaseTestView] Executing RunAllTestsCommand");
await ViewModel.RunAllTestsCommand.ExecuteAsync(null);
System.Diagnostics.Debug.WriteLine("[DatabaseTestView] RunAllTestsCommand completed");
⋮----
System.Diagnostics.Debug.WriteLine($"[DatabaseTestView] Cannot run tests - ViewModel: {ViewModel != null}, Command: {ViewModel?.RunAllTestsCommand != null}");
⋮----
System.Diagnostics.Debug.WriteLine($"[DatabaseTestView] Error running database tests: {ex.Message}");
⋮----
// Tab click handlers
private void OnSchemaTabClick(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
⋮----
private void OnStoredProceduresTabClick(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
⋮----
private void OnDaosTabClick(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
⋮----
private void OnLogsTabClick(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
⋮----
private void UpdateTabVisibility()
⋮----
System.Diagnostics.Debug.WriteLine($"[DatabaseTestView] Selected tab: {ViewModel.SelectedTab}");
</file>

<file path="Module_Volvo/Interfaces/IDao_VolvoPart.cs">
/// <summary>
/// Interface for Volvo part data access operations
/// Created for testability and dependency injection
/// </summary>
public interface IDao_VolvoPart
⋮----
Task<Model_Dao_Result<List<Model_VolvoPart>>> GetAllAsync(bool includeInactive = false);
Task<Model_Dao_Result<Model_VolvoPart>> GetByPartNumberAsync(string partNumber);
Task<Model_Dao_Result<int>> InsertAsync(Model_VolvoPart part);
Task<Model_Dao_Result> UpdateAsync(Model_VolvoPart part);
Task<Model_Dao_Result> DeactivateAsync(string partNumber);
</file>

<file path="Module_Volvo/Interfaces/IDao_VolvoShipment.cs">
/// <summary>
/// Interface for Volvo shipment data access operations
/// Created for testability and dependency injection
/// </summary>
public interface IDao_VolvoShipment
⋮----
Task<Model_Dao_Result<List<Model_VolvoShipment>>> GetAllAsync(bool includeArchived = false);
Task<Model_Dao_Result<Model_VolvoShipment>> GetByIdAsync(int shipmentId);
Task<Model_Dao_Result<Model_VolvoShipment>> GetPendingAsync();
Task<Model_Dao_Result<int>> InsertAsync(Model_VolvoShipment shipment);
Task<Model_Dao_Result> UpdateAsync(Model_VolvoShipment shipment);
Task<Model_Dao_Result> ArchiveAsync(int shipmentId);
</file>

<file path="Module_Volvo/Interfaces/IDao_VolvoShipmentLine.cs">
/// <summary>
/// Interface for Volvo shipment line data access operations
/// Created for testability and dependency injection
/// </summary>
public interface IDao_VolvoShipmentLine
⋮----
Task<Model_Dao_Result<List<Model_VolvoShipmentLine>>> GetByShipmentIdAsync(int shipmentId);
Task<Model_Dao_Result<int>> InsertAsync(Model_VolvoShipmentLine line);
Task<Model_Dao_Result> UpdateAsync(Model_VolvoShipmentLine line);
Task<Model_Dao_Result> DeleteAsync(int lineId);
</file>

<file path="Module_Volvo/Models/Model_EmailRecipient.cs">
/// <summary>
/// Represents an email recipient with name and email address
/// </summary>
public class Model_EmailRecipient
⋮----
/// Formats the recipient in Outlook format: "Name" &lt;email@domain.com&gt;
⋮----
public string ToOutlookFormat()
</file>

<file path="Module_Volvo/Models/Model_VolvoEmailData.cs">
/// <summary>
/// Structured email data for PO requisition
/// Separates email content into logical sections for display and formatting
/// </summary>
public class Model_VolvoEmailData
⋮----
/// Email subject line
⋮----
/// Greeting text
⋮----
/// Main message body
⋮----
/// List of discrepancy line items (empty if no discrepancies)
⋮----
/// Requested parts/quantities after component explosion
⋮----
/// Additional notes (optional)
⋮----
/// Email signature
⋮----
/// Represents a discrepancy line item for table display
⋮----
public class DiscrepancyLineItem
</file>

<file path="Module_Volvo/Models/Model_VolvoPartComponent.cs">
/// <summary>
/// Represents a component relationship for Volvo parts (component explosion)
/// Maps to volvo_part_components database table
/// Example: V-EMB-500 includes 1× V-EMB-2 and 1× V-EMB-92
/// </summary>
public class Model_VolvoPartComponent
⋮----
/// Auto-increment primary key
⋮----
/// The parent part number (e.g., V-EMB-500)
⋮----
/// The component part number included with the parent (e.g., V-EMB-2)
⋮----
/// Quantity of this component included per skid of the parent part
/// Usually 1, but can be higher (e.g., V-EMB-780 includes 3× V-EMB-26)
⋮----
/// Quantity per skid for the component part (from volvo_masterdata)
/// Used for calculating total piece count during component explosion
</file>

<file path="Module_Volvo/Models/Model_VolvoShipment.cs">
/// <summary>
/// Represents a Volvo dunnage shipment header
/// Maps to volvo_label_data database table
/// </summary>
public class Model_VolvoShipment
⋮----
/// Auto-increment primary key
⋮----
/// Date of shipment arrival
⋮----
/// Auto-generated sequential number for the day (resets daily)
/// Example: Shipment #1, Shipment #2 for the same date
⋮----
/// Purchase order number (filled after purchasing department provides it)
/// NULL until shipment is completed
⋮----
/// Receiver number from Infor Visual (filled after PO receiving)
⋮----
/// Employee number from authentication context
⋮----
/// Optional notes about the shipment
⋮----
/// Status: 'pending_po' (awaiting PO from purchasing) or 'completed' (PO/Receiver entered)
⋮----
/// Timestamp when shipment was created
⋮----
/// Timestamp when shipment was last modified
⋮----
/// Flag indicating if shipment has been archived to history
/// Set to true when status changes to 'completed'
</file>

<file path="Module_Volvo/Models/VolvoShipmentStatus.cs">
/// <summary>
/// Constants for Volvo shipment status values
/// Prevents magic strings throughout the codebase
/// </summary>
public static class VolvoShipmentStatus
⋮----
/// Shipment is pending PO creation (user has not yet completed with PO/Receiver numbers)
⋮----
/// Shipment has been completed with PO and Receiver numbers
⋮----
/// Shipment has been archived (soft delete)
</file>

<file path="Module_Volvo/Services/IService_VolvoAuthorization.cs">
/// <summary>
/// Authorization service for Volvo module operations
/// Implements role-based access control (RBAC) for Volvo features
/// </summary>
public interface IService_VolvoAuthorization
⋮----
/// Checks if current user can create/modify Volvo shipments
⋮----
Task<Model_Dao_Result> CanManageShipmentsAsync();
⋮----
/// Checks if current user can manage Volvo master data (parts, components)
⋮----
Task<Model_Dao_Result> CanManageMasterDataAsync();
⋮----
/// Checks if current user can complete/close Volvo shipments
⋮----
Task<Model_Dao_Result> CanCompleteShipmentsAsync();
⋮----
/// Checks if current user can generate labels for Volvo shipments
⋮----
Task<Model_Dao_Result> CanGenerateLabelsAsync();
</file>

<file path="Module_Volvo/Views/VolvoPartAddEditDialog.xaml">
<ContentDialog
    x:Class="MTM_Receiving_Application.Module_Volvo.Views.VolvoPartAddEditDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Add/Edit Volvo Part"
    PrimaryButtonText="Save"
    CloseButtonText="Cancel"
    DefaultButton="Primary"
    PrimaryButtonClick="OnSaveClicked"
    Width="500">

    <StackPanel Spacing="16" Padding="8">
        <!-- Part Number -->
        <TextBox x:Name="PartNumberTextBox"
                 Header="Part Number"
                 PlaceholderText="e.g., V-EMB-500"
                 MaxLength="50"/>

        <!-- Quantity Per Skid -->
        <NumberBox x:Name="QuantityPerSkidNumberBox"
                   Header="Quantity Per Skid"
                   PlaceholderText="e.g., 88"
                   Minimum="0"
                   Maximum="10000"
                   SpinButtonPlacementMode="Inline"
                   Value="0"/>

        <!-- Historical Integrity Warning (Edit Mode Only) -->
        <InfoBar x:Name="EditModeWarning"
                 Severity="Warning"
                 IsOpen="False"
                 IsClosable="False"
                 Message="Changes to quantity will NOT affect past shipments. Historical piece counts are preserved."/>

        <!-- Component Section (Simplified - Future Enhancement) -->
        <Expander Header="Components (Advanced)" IsExpanded="False">
            <StackPanel Spacing="8" Padding="8">
                <TextBlock Text="Component management will be available in a future update." 
                          Style="{StaticResource CaptionTextBlockStyle}"
                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                <TextBlock Text="For now, use CSV import to define components." 
                          Style="{StaticResource CaptionTextBlockStyle}"
                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            </StackPanel>
        </Expander>
    </StackPanel>
</ContentDialog>
</file>

<file path="MTM_Receiving_Application.Tests/Fixtures/DatabaseFixture.cs">
/// <summary>
/// Shared test fixture for database-related tests.
/// Keep this lightweight; prefer per-test isolation unless explicitly needed.
/// </summary>
public sealed class DatabaseFixture : IDisposable
⋮----
// Intentionally empty: initialize per-module DB helpers when needed.
⋮----
public void Dispose()
⋮----
// Intentionally empty: dispose connections/resources when added.
</file>

<file path="MTM_Receiving_Application.Tests/Fixtures/ServiceCollectionFixture.cs">
/// <summary>
/// Shared test fixture for DI container setup.
/// This can be expanded to register services/DAOs with test doubles.
/// </summary>
public sealed class ServiceCollectionFixture : IDisposable
⋮----
// Intentionally empty: register services in tests as needed.
⋮----
public void Dispose()
⋮----
// Intentionally empty: dispose provider/resources when added.
</file>

<file path="MTM_Receiving_Application.Tests/Helpers/TestHelper.cs">
public static class TestHelper
⋮----
public static string NewGuidString() => Guid.NewGuid().ToString("N");
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_BooleanToVisibility_Tests.cs">
/// <summary>
/// Unit tests for <see cref="Converter_BooleanToVisibility"/>.
/// Tests conversion of boolean values to WinUI Visibility with optional inverse parameter.
/// </summary>
⋮----
public class Converter_BooleanToVisibility_Tests
⋮----
private readonly Converter_BooleanToVisibility _sut;
⋮----
public void Convert_WithBooleanValue_ReturnsExpectedVisibility(bool input, string? parameter, Visibility expected)
⋮----
// Act
var result = _sut.Convert(input, typeof(Visibility), parameter, "en-US");
⋮----
// Assert
result.Should().Be(expected);
⋮----
public void Convert_WithNullValue_ReturnsCollapsed()
⋮----
var result = _sut.Convert(null, typeof(Visibility), null, "en-US");
⋮----
result.Should().Be(Visibility.Collapsed);
⋮----
public void Convert_WithNonBooleanValue_ReturnsCollapsed(object input)
⋮----
var result = _sut.Convert(input, typeof(Visibility), null, "en-US");
⋮----
public void Convert_WithUnknownParameter_IgnoresParameter()
⋮----
var result = _sut.Convert(true, typeof(Visibility), "SomeOtherParam", "en-US");
⋮----
result.Should().Be(Visibility.Visible);
⋮----
public void ConvertBack_ThrowsNotImplementedException()
⋮----
Action act = () => _sut.ConvertBack(Visibility.Visible, typeof(bool), null, "en-US");
⋮----
act.Should().Throw<NotImplementedException>();
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_BoolToString_Tests.cs">
/// <summary>
/// Unit tests for <see cref="Converter_BoolToString"/>.
/// Tests conversion of boolean values to custom string representations using pipe-delimited parameter.
/// Format: "TrueString|FalseString"
/// </summary>
⋮----
public class Converter_BoolToString_Tests
⋮----
private readonly Converter_BoolToString _sut;
⋮----
public void Convert_WithBooleanAndValidParameter_ReturnsCorrectString(bool input, string parameter, string expected)
⋮----
// Act
var result = _sut.Convert(input, typeof(string), parameter, "en-US");
⋮----
// Assert
result.Should().Be(expected);
⋮----
public void Convert_WithNullValue_ReturnsEmptyString()
⋮----
var result = _sut.Convert(null, typeof(string), "Yes|No", "en-US");
⋮----
result.Should().Be(string.Empty);
⋮----
public void Convert_WithNullParameter_ReturnsBooleanToString(bool input, object? parameter)
⋮----
result.Should().Be(input.ToString());
⋮----
public void Convert_WithInvalidParameter_ReturnsBooleanToString(bool input, string parameter)
⋮----
public void Convert_WithNonBooleanValue_ReturnsValueToString(object input, string parameter)
⋮----
public void Convert_WithMoreThanTwoParts_ReturnsOriginalBooleanString(bool input, string parameter)
⋮----
public void ConvertBack_ThrowsNotImplementedException()
⋮----
Action act = () => _sut.ConvertBack("Yes", typeof(bool), "Yes|No", "en-US");
⋮----
act.Should().Throw<NotImplementedException>();
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_DecimalToString_Tests.cs">
/// <summary>
/// Unit tests for <see cref="Converter_DecimalToString"/>.
/// Tests bidirectional conversion between decimal and string, with special handling for zero values.
/// </summary>
⋮----
public class Converter_DecimalToString_Tests
⋮----
private readonly Converter_DecimalToString _sut;
⋮----
public void Convert_WithDecimalValue_ReturnsExpectedString(decimal input, string expected)
⋮----
// Act
var result = _sut.Convert(input, typeof(string), null, "en-US");
⋮----
// Assert
result.Should().Be(expected);
⋮----
public void Convert_WithVeryPreciseDecimal_ReturnsPreciseString()
⋮----
// Arrange - G29 format preserves up to 29 significant digits
⋮----
// Assert - G29 will trim trailing zeros and use the most compact representation
result.Should().BeOfType<string>();
⋮----
resultString.Should().NotBeNullOrEmpty();
resultString.Should().StartWith("0.12345678901234");
⋮----
public void Convert_WithZero_ReturnsEmptyString()
⋮----
var result = _sut.Convert(0m, typeof(string), null, "en-US");
⋮----
result.Should().Be(string.Empty);
⋮----
public void Convert_WithNonDecimalValue_ReturnsEmptyString(object? input)
⋮----
public void ConvertBack_WithValidString_ReturnsDecimal(string input, decimal expected)
⋮----
var result = _sut.ConvertBack(input, typeof(decimal), null, "en-US");
⋮----
public void ConvertBack_WithEmptyOrWhitespaceString_ReturnsZero(string? input)
⋮----
result.Should().Be(0m);
⋮----
public void ConvertBack_WithInvalidString_ReturnsZero(string input)
⋮----
public void ConvertBack_WithNonStringValue_ReturnsZero()
⋮----
var result = _sut.ConvertBack(42, typeof(decimal), null, "en-US");
⋮----
public void Convert_RoundTrip_PreservesValue()
⋮----
// Arrange
⋮----
// Act - Convert to string
var stringResult = _sut.Convert(originalValue, typeof(string), null, "en-US");
⋮----
// Act - Convert back to decimal
var decimalResult = _sut.ConvertBack(stringResult, typeof(decimal), null, "en-US");
⋮----
decimalResult.Should().Be(originalValue);
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_DoubleToDecimal_Tests.cs">
/// <summary>
/// Unit tests for <see cref="Converter_DoubleToDecimal"/>.
/// Tests bidirectional conversion between decimal and double types.
/// </summary>
⋮----
public class Converter_DoubleToDecimal_Tests
⋮----
private readonly Converter_DoubleToDecimal _sut;
⋮----
public void Convert_WithDecimalValue_ReturnsDouble(decimal input, double expected)
⋮----
// Act
var result = _sut.Convert(input, typeof(double), null, "en-US");
⋮----
// Assert
result.Should().Be(expected);
⋮----
public void Convert_WithNonDecimalValue_ReturnsZeroDouble(object? input)
⋮----
result.Should().Be(0.0);
⋮----
public void ConvertBack_WithDoubleValue_ReturnsDecimal(double input, decimal expected)
⋮----
var result = _sut.ConvertBack(input, typeof(decimal), null, "en-US");
⋮----
public void ConvertBack_WithNonDoubleValue_ReturnsZeroDecimal(object? input)
⋮----
result.Should().Be(0m);
⋮----
public void Convert_RoundTrip_PreservesValue()
⋮----
// Arrange
⋮----
// Act - Convert to double
var doubleResult = _sut.Convert(originalValue, typeof(double), null, "en-US");
⋮----
// Act - Convert back to decimal
var decimalResult = _sut.ConvertBack(doubleResult, typeof(decimal), null, "en-US");
⋮----
decimalResult.Should().Be(originalValue);
⋮----
public void Convert_WithLargeDecimalValue_HandlesWithinDoubleRange()
⋮----
// Arrange - Use a large value that's within double range but shows precision
var input = 79228162514264m; // Well within both decimal and double range
⋮----
// Assert - Should not throw
result.Should().BeOfType<double>();
((double)result).Should().BeApproximately(79228162514264.0, 0.1);
⋮----
public void ConvertBack_WithLargeDoubleValue_HandlesWithinDecimalRange()
⋮----
// Arrange - Use a large value within decimal range
var input = 79228162514264.0; // Well within decimal range
⋮----
result.Should().BeOfType<decimal>();
((decimal)result).Should().BeApproximately(79228162514264m, 1m);
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_EmptyStringToVisibility_Tests.cs">
/// <summary>
/// Unit tests for <see cref="Converter_EmptyStringToVisibility"/>.
/// Tests conversion of string values to Visibility based on empty/whitespace checks with optional inverse.
/// </summary>
⋮----
public class Converter_EmptyStringToVisibility_Tests
⋮----
private readonly Converter_EmptyStringToVisibility _sut;
⋮----
public void Convert_WithStringValue_ReturnsExpectedVisibility(string? input, object? parameter, Visibility expected)
⋮----
// Act
var result = _sut.Convert(input, typeof(Visibility), parameter, "en-US");
⋮----
// Assert
result.Should().Be(expected);
⋮----
public void Convert_WithInverseParameter_ReturnsInvertedVisibility(string? input, string parameter, Visibility expected)
⋮----
public void Convert_WithNonStringValue_ReturnsCollapsed(object input)
⋮----
var result = _sut.Convert(input, typeof(Visibility), null, "en-US");
⋮----
result.Should().Be(Visibility.Collapsed);
⋮----
public void Convert_WithUnknownParameter_IgnoresParameter()
⋮----
var result = _sut.Convert("Hello", typeof(Visibility), "SomeOtherParam", "en-US");
⋮----
result.Should().Be(Visibility.Visible);
⋮----
public void ConvertBack_ThrowsNotImplementedException()
⋮----
Action act = () => _sut.ConvertBack(Visibility.Visible, typeof(string), null, "en-US");
⋮----
act.Should().Throw<NotImplementedException>();
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_EnumToVisibility_Tests.cs">
/// <summary>
/// Unit tests for <see cref="Converter_EnumToVisibility"/>.
/// Tests conversion of enum values to Visibility based on parameter match (case-insensitive).
/// </summary>
⋮----
public class Converter_EnumToVisibility_Tests
⋮----
private readonly Converter_EnumToVisibility _sut;
⋮----
// Test enum for converter testing
⋮----
public void Convert_WithEnumValue_ReturnsExpectedVisibility(TestEnum input, string parameter, Visibility expected)
⋮----
// Act
var result = _sut.Convert(input, typeof(Visibility), parameter, "en-US");
⋮----
// Assert
result.Should().Be(expected);
⋮----
public void Convert_WithNullValue_ReturnsCollapsed()
⋮----
var result = _sut.Convert(null, typeof(Visibility), "First", "en-US");
⋮----
result.Should().Be(Visibility.Collapsed);
⋮----
public void Convert_WithNullParameter_ReturnsCollapsed()
⋮----
var result = _sut.Convert(TestEnum.First, typeof(Visibility), null, "en-US");
⋮----
public void Convert_WithBothNull_ReturnsCollapsed()
⋮----
var result = _sut.Convert(null, typeof(Visibility), null, "en-US");
⋮----
public void Convert_WithStringValue_ComparesCorrectly(string input, string parameter, Visibility expected)
⋮----
public void Convert_WithNumericValue_ComparesAsString(int input, string parameter, Visibility expected)
⋮----
public void ConvertBack_ThrowsNotImplementedException()
⋮----
Action act = () => _sut.ConvertBack(Visibility.Visible, typeof(TestEnum), "First", "en-US");
⋮----
act.Should().Throw<NotImplementedException>();
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_IconCodeToGlyph_Tests.cs">
/// <summary>
/// Unit tests for <see cref="Converter_IconCodeToGlyph"/>.
/// Tests conversion of icon codes (HTML entity or hex format) to Unicode glyph characters.
/// Supports formats: "&#xE7B8;" (HTML entity) or "E7B8" (raw hex)
/// </summary>
⋮----
public class Converter_IconCodeToGlyph_Tests
⋮----
private readonly Converter_IconCodeToGlyph _sut;
⋮----
public void Convert_WithHtmlEntityFormat_ReturnsGlyphCharacter(string input, string expected)
⋮----
// Act
var result = _sut.Convert(input, typeof(string), null, "en-US");
⋮----
// Assert
result.Should().Be(expected);
⋮----
public void Convert_WithRawHexFormat_ReturnsGlyphCharacter(string input, string expected)
⋮----
public void Convert_WithNullOrWhitespace_ReturnsDefaultIcon(string? input)
⋮----
result.Should().Be("\uE7B8"); // Default box icon
⋮----
public void Convert_WithInvalidHexValue_ReturnsInputAsIs(string input)
⋮----
result.Should().Be(input);
⋮----
public void Convert_WithNonFourCharacterHex_ReturnsInputAsIs(string input)
⋮----
public void Convert_WithSingleCharacterString_ReturnsInputAsIs()
⋮----
// Arrange
⋮----
public void Convert_WithNonStringValue_ReturnsDefaultIcon(object input)
⋮----
result.Should().Be("\uE7B8");
⋮----
public void ConvertBack_ThrowsNotImplementedException()
⋮----
Action act = () => _sut.ConvertBack("\uE7B8", typeof(string), null, "en-US");
⋮----
act.Should().Throw<NotImplementedException>();
⋮----
public void Convert_WithLowercaseHex_HandlesCorrectly(string input)
⋮----
var lowercaseInput = input.ToLower();
⋮----
var result = _sut.Convert(lowercaseInput, typeof(string), null, "en-US");
⋮----
result.Should().NotBeNull();
result.Should().BeOfType<string>();
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_IntToVisibility_Tests.cs">
/// <summary>
/// Unit tests for <see cref="Converter_IntToVisibility"/>.
/// Tests conversion of integer values to Visibility with multiple parameter modes:
/// - No parameter: Visible if value > 0
/// - "Inverse": Visible if value == 0
/// - Numeric string (e.g., "1", "2"): Visible if value == parameter
/// - Direct int parameter: Visible if value == parameter
/// </summary>
⋮----
public class Converter_IntToVisibility_Tests
⋮----
private readonly Converter_IntToVisibility _sut;
⋮----
public void Convert_WithNoParameter_ShowsWhenValueGreaterThanZero(int input, Visibility expected)
⋮----
// Act
var result = _sut.Convert(input, typeof(Visibility), null, "en-US");
⋮----
// Assert
result.Should().Be(expected);
⋮----
public void Convert_WithInverseParameter_ShowsWhenValueIsZero(int input, Visibility expected)
⋮----
var result = _sut.Convert(input, typeof(Visibility), "Inverse", "en-US");
⋮----
public void Convert_WithInverseParameterCaseInsensitive_WorksCorrectly(int input, Visibility expected)
⋮----
var result = _sut.Convert(input, typeof(Visibility), "inverse", "en-US");
⋮----
public void Convert_WithNumericStringParameter_ShowsWhenValueMatchesParameter(int input, string parameter, Visibility expected)
⋮----
var result = _sut.Convert(input, typeof(Visibility), parameter, "en-US");
⋮----
public void Convert_WithDirectIntParameter_ShowsWhenValueMatchesParameter(int input, int parameter, Visibility expected)
⋮----
public void Convert_WithNullValue_ReturnsCollapsed()
⋮----
var result = _sut.Convert(null, typeof(Visibility), null, "en-US");
⋮----
result.Should().Be(Visibility.Collapsed);
⋮----
public void Convert_WithNonNumericStringParameter_FallsBackToGreaterThanZero(string parameter)
⋮----
var result = _sut.Convert(5, typeof(Visibility), parameter, "en-US");
⋮----
result.Should().Be(Visibility.Visible);
⋮----
public void Convert_WithNonIntegerValue_TreatsAsZero(object input)
⋮----
public void ConvertBack_ThrowsNotImplementedException()
⋮----
Action act = () => _sut.ConvertBack(Visibility.Visible, typeof(int), null, "en-US");
⋮----
act.Should().Throw<NotImplementedException>();
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_LoadNumberToOneBased_Tests.cs">
/// <summary>
/// Unit tests for <see cref="Converter_LoadNumberToOneBased"/>.
/// Tests bidirectional conversion between zero-based (internal) and one-based (display) load numbers.
/// </summary>
⋮----
public class Converter_LoadNumberToOneBased_Tests
⋮----
private readonly Converter_LoadNumberToOneBased _sut;
⋮----
public void Convert_WithIntegerValue_ReturnsOneBasedValue(int input, int expected)
⋮----
// Act
var result = _sut.Convert(input, typeof(int), null, "en-US");
⋮----
// Assert
result.Should().Be(expected);
⋮----
public void Convert_WithNonIntegerValue_ReturnsValueAsIs(object? input)
⋮----
result.Should().Be(input);
⋮----
public void ConvertBack_WithValidStringValue_ReturnsZeroBasedValue(string input, int expected)
⋮----
var result = _sut.ConvertBack(input, typeof(int), null, "en-US");
⋮----
public void ConvertBack_WithInvalidString_ReturnsValueAsIs(string input)
⋮----
public void ConvertBack_WithNonStringValue_ReturnsValueAsIs(object? input)
⋮----
public void Convert_RoundTrip_PreservesValue(int originalValue)
⋮----
// Act - Convert to one-based
var oneBasedResult = _sut.Convert(originalValue, typeof(int), null, "en-US");
⋮----
// Act - Convert back to zero-based
var zeroBasedResult = _sut.ConvertBack(oneBasedResult.ToString(), typeof(int), null, "en-US");
⋮----
zeroBasedResult.Should().Be(originalValue);
⋮----
public void Convert_WithNegativeValue_ReturnsNegativeOneBased()
⋮----
var result = _sut.Convert(-5, typeof(int), null, "en-US");
⋮----
result.Should().Be(-4);
⋮----
public void ConvertBack_WithZeroString_ReturnsNegativeOne()
⋮----
var result = _sut.ConvertBack("0", typeof(int), null, "en-US");
⋮----
result.Should().Be(-1);
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_StringFormat_Tests.cs">
/// <summary>
/// Unit tests for <see cref="Converter_StringFormat"/>.
/// Tests string formatting using parameter as format string (e.g., "Total: {0}").
/// </summary>
⋮----
public class Converter_StringFormat_Tests
⋮----
private readonly Converter_StringFormat _sut;
⋮----
public void Convert_WithValidFormatParameter_ReturnsFormattedString(object input, string format, string expected)
⋮----
// Act
var result = _sut.Convert(input, typeof(string), format, "en-US");
⋮----
// Assert
result.Should().Be(expected);
⋮----
public void Convert_WithNullParameter_ReturnsValueAsIs(object input)
⋮----
var result = _sut.Convert(input, typeof(string), null, "en-US");
⋮----
result.Should().Be(input);
⋮----
public void Convert_WithNonStringParameter_ReturnsValueAsIs(object input)
⋮----
var result = _sut.Convert(input, typeof(string), 123, "en-US");
⋮----
public void Convert_WithNullValue_FormatsNullAsString()
⋮----
var result = _sut.Convert(null, typeof(string), "Value: {0}", "en-US");
⋮----
result.Should().Be("Value: ");
⋮----
public void Convert_WithNumericFormatting_ReturnsFormattedNumber(object input, string format, string expected)
⋮----
public void Convert_WithEmptyFormatString_ReturnsEmptyString()
⋮----
var result = _sut.Convert("Hello", typeof(string), "", "en-US");
⋮----
result.Should().Be("");
⋮----
public void ConvertBack_ThrowsNotImplementedException()
⋮----
Action act = () => _sut.ConvertBack("Formatted String", typeof(object), "{0}", "en-US");
⋮----
act.Should().Throw<NotImplementedException>();
⋮----
public void Convert_WithComplexFormatString_HandlesCorrectly(object input, string format, string expected)
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Converters/NullableDoubleToDoubleConverter_Tests.cs">
/// <summary>
/// Unit tests for <see cref="NullableDoubleToDoubleConverter"/>.
/// Tests bidirectional conversion between nullable double (double?) and double for NumberBox bindings.
/// </summary>
⋮----
public class NullableDoubleToDoubleConverter_Tests
⋮----
private readonly NullableDoubleToDoubleConverter _sut;
⋮----
public void Convert_WithDoubleValue_ReturnsDoubleValue(double input, double expected)
⋮----
// Act
var result = _sut.Convert(input, typeof(double), null, "en-US");
⋮----
// Assert
result.Should().Be(expected);
⋮----
public void Convert_WithNonDoubleValue_ReturnsZero(object? input)
⋮----
result.Should().Be(0.0);
⋮----
public void ConvertBack_WithDoubleValue_ReturnsNullableDouble(double input)
⋮----
var result = _sut.ConvertBack(input, typeof(double?), null, "en-US");
⋮----
result.Should().Be((double?)input);
⋮----
public void ConvertBack_WithNonDoubleValue_ReturnsNull(object? input)
⋮----
result.Should().BeNull();
⋮----
public void Convert_RoundTrip_PreservesValue(double originalValue)
⋮----
// Act - Convert to double
var doubleResult = _sut.Convert(originalValue, typeof(double), null, "en-US");
⋮----
// Act - Convert back to nullable double
var nullableResult = _sut.ConvertBack(doubleResult, typeof(double?), null, "en-US");
⋮----
nullableResult.Should().Be(originalValue);
⋮----
public void Convert_WithNaN_ReturnsNaN()
⋮----
var result = _sut.Convert(double.NaN, typeof(double), null, "en-US");
⋮----
result.Should().Be(double.NaN);
⋮----
public void Convert_WithPositiveInfinity_ReturnsPositiveInfinity()
⋮----
var result = _sut.Convert(double.PositiveInfinity, typeof(double), null, "en-US");
⋮----
result.Should().Be(double.PositiveInfinity);
⋮----
public void Convert_WithNegativeInfinity_ReturnsNegativeInfinity()
⋮----
var result = _sut.Convert(double.NegativeInfinity, typeof(double), null, "en-US");
⋮----
result.Should().Be(double.NegativeInfinity);
⋮----
public void ConvertBack_WithNaN_ReturnsNullableNaN()
⋮----
var result = _sut.ConvertBack(double.NaN, typeof(double?), null, "en-US");
⋮----
result.Should().Be((double?)double.NaN);
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Defaults/InforVisualDefaults_Tests.cs">
public class InforVisualDefaults_Tests
⋮----
public void DefaultSiteId_ShouldNotBeNullOrWhiteSpace()
⋮----
InforVisualDefaults.DefaultSiteId.Should().NotBeNullOrWhiteSpace();
⋮----
public void DefaultUom_ShouldNotBeNullOrWhiteSpace()
⋮----
InforVisualDefaults.DefaultUom.Should().NotBeNullOrWhiteSpace();
⋮----
public void DefaultPartStatus_ShouldNotBeNullOrWhiteSpace()
⋮----
InforVisualDefaults.DefaultPartStatus.Should().NotBeNullOrWhiteSpace();
⋮----
public void Model_InforVisualConnection_DefaultsShouldMatch()
⋮----
var model = new Model_InforVisualConnection();
⋮----
model.Server.Should().Be(InforVisualDefaults.DefaultServer);
model.Database.Should().Be(InforVisualDefaults.DefaultDatabase);
model.SiteId.Should().Be(InforVisualDefaults.DefaultSiteId);
⋮----
public void Model_InforVisualPart_DefaultsShouldMatch()
⋮----
var model = new Model_InforVisualPart();
⋮----
model.PrimaryUom.Should().Be(InforVisualDefaults.DefaultUom);
model.DefaultSite.Should().Be(InforVisualDefaults.DefaultSiteId);
model.PartStatus.Should().Be(InforVisualDefaults.DefaultPartStatus);
⋮----
public void Model_InforVisualPO_DefaultsShouldMatch()
⋮----
var model = new Model_InforVisualPO();
⋮----
model.UnitOfMeasure.Should().Be(InforVisualDefaults.DefaultUom);
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Defaults/WorkstationDefaults_Tests.cs">
public class WorkstationDefaults_Tests
⋮----
public void SharedTerminalWorkstationType_ShouldNotBeNullOrWhiteSpace()
⋮----
WorkstationDefaults.SharedTerminalWorkstationType.Should().NotBeNullOrWhiteSpace();
⋮----
public void PersonalWorkstationWorkstationType_ShouldNotBeNullOrWhiteSpace()
⋮----
WorkstationDefaults.PersonalWorkstationWorkstationType.Should().NotBeNullOrWhiteSpace();
⋮----
public void SharedTerminalTimeoutMinutes_ShouldBePositive()
⋮----
WorkstationDefaults.SharedTerminalTimeoutMinutes.Should().BeGreaterThan(0);
⋮----
public void PersonalWorkstationTimeoutMinutes_ShouldBePositive()
⋮----
WorkstationDefaults.PersonalWorkstationTimeoutMinutes.Should().BeGreaterThan(0);
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Helpers/Database/Helper_Database_StoredProcedure_Tests.cs">
/// <summary>
/// Unit tests for Helper_Database_StoredProcedure logic
/// </summary>
⋮----
public class Helper_Database_StoredProcedure_Tests
⋮----
public void ValidateParameters_NullParameters_ReturnsTrue()
⋮----
// Act
var result = Helper_Database_StoredProcedure.ValidateParameters(null);
⋮----
// Assert
result.Should().BeTrue("null parameters list is considered valid (no parameters to validate)");
⋮----
public void ValidateParameters_ValidInputParameters_ReturnsTrue()
⋮----
// Arrange
⋮----
new MySqlParameter("@p1", "value"),
new MySqlParameter("@p2", 123)
⋮----
var result = Helper_Database_StoredProcedure.ValidateParameters(parameters);
⋮----
result.Should().BeTrue();
⋮----
public void ValidateParameters_NullInputParameterContent_ReturnsFalse()
⋮----
// Create a parameter with explicit null value (not DBNull)
var parameter = new MySqlParameter("@p1", MySqlDbType.VarChar);
⋮----
result.Should().BeFalse("input parameters should not be null (use DBNull.Value instead)");
⋮----
public void ValidateParameters_DBNullInputParameter_ReturnsTrue()
⋮----
new MySqlParameter("@p1", System.DBNull.Value)
⋮----
result.Should().BeTrue("DBNull.Value is a valid value for parameters");
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Helpers/Database/Helper_Database_Variables_Tests.cs">
/// <summary>
/// Unit tests for Helper_Database_Variables
/// </summary>
⋮----
public class Helper_Database_Variables_Tests
⋮----
public void GetConnectionString_Production_ReturnsProductionString()
⋮----
// Act
var connectionString = Helper_Database_Variables.GetConnectionString(true);
⋮----
// Assert
connectionString.Should().Contain("Database=mtm_receiving_application");
connectionString.Should().NotContain("_test");
⋮----
public void GetConnectionString_Test_ReturnsTestString()
⋮----
var connectionString = Helper_Database_Variables.GetConnectionString(false);
⋮----
connectionString.Should().Contain("Database=mtm_receiving_application_test");
⋮----
public void GetInforVisualConnectionString_ReturnsReadOnlyIntent()
⋮----
var connectionString = Helper_Database_Variables.GetInforVisualConnectionString();
⋮----
connectionString.Should().Contain("ApplicationIntent=ReadOnly");
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_AuthenticationResult_Tests.cs">
/// <summary>
/// Unit tests for Model_AuthenticationResult
/// </summary>
⋮----
public class Model_AuthenticationResult_Tests
⋮----
public void SuccessResult_SetsSuccessTrue()
⋮----
var user = new Model_User();
⋮----
var result = Model_AuthenticationResult.SuccessResult(user);
⋮----
result.Success.Should().BeTrue();
⋮----
public void SuccessResult_SetsUser()
⋮----
result.User.Should().BeSameAs(user);
⋮----
public void SuccessResult_SetsErrorMessageEmpty()
⋮----
result.ErrorMessage.Should().BeEmpty();
⋮----
public void SuccessResult_WithNullUser_Throws()
⋮----
var act = static () => Model_AuthenticationResult.SuccessResult(null!);
⋮----
act.Should().Throw<ArgumentNullException>();
⋮----
public void ErrorResult_SetsSuccessFalse()
⋮----
var result = Model_AuthenticationResult.ErrorResult("bad");
⋮----
result.Success.Should().BeFalse();
⋮----
public void ErrorResult_SetsUserNull()
⋮----
result.User.Should().BeNull();
⋮----
public void ErrorResult_SetsErrorMessage()
⋮----
result.ErrorMessage.Should().Be("bad");
⋮----
public void ErrorResult_WithNullMessage_Throws()
⋮----
var act = static () => Model_AuthenticationResult.ErrorResult(null!);
⋮----
act.Should().Throw<ArgumentException>();
⋮----
public void ErrorResult_WithWhitespaceMessage_Throws()
⋮----
var act = static () => Model_AuthenticationResult.ErrorResult("   ");
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_User_Tests.cs">
/// <summary>
/// Unit tests for Model_User
/// </summary>
⋮----
public class Model_User_Tests
⋮----
public void Constructor_Default_SetsCreatedAndModifiedToNow()
⋮----
// Arrange
⋮----
// Act
var user = new Model_User();
⋮----
// Assert
user.CreatedDate.Should().BeOnOrAfter(before);
user.CreatedDate.Should().BeOnOrBefore(after);
user.ModifiedDate.Should().BeOnOrAfter(before);
user.ModifiedDate.Should().BeOnOrBefore(after);
⋮----
public void HasErpAccess_ReturnsFalseWhenVisualUsernameMissing()
⋮----
var user = new Model_User { VisualUsername = null };
⋮----
user.HasErpAccess.Should().BeFalse();
⋮----
public void HasErpAccess_ReturnsFalseWhenVisualUsernameWhitespace()
⋮----
var user = new Model_User { VisualUsername = "   " };
⋮----
public void HasErpAccess_ReturnsTrueWhenVisualUsernameProvided()
⋮----
var user = new Model_User { VisualUsername = "user" };
⋮----
user.HasErpAccess.Should().BeTrue();
⋮----
public void DisplayName_FormatsEmployeeNumberAndName()
⋮----
var user = new Model_User
⋮----
user.DisplayName.Should().Be("Jane Doe (Emp #123)");
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_ValidationResult_Tests.cs">
/// <summary>
/// Unit tests for Model_ValidationResult
/// </summary>
⋮----
public class Model_ValidationResult_Tests
⋮----
public void Valid_SetsIsValidTrue()
⋮----
var result = Model_ValidationResult.Valid();
⋮----
result.IsValid.Should().BeTrue();
⋮----
public void Valid_SetsErrorMessageEmpty()
⋮----
result.ErrorMessage.Should().BeEmpty();
⋮----
public void Invalid_SetsIsValidFalse()
⋮----
var result = Model_ValidationResult.Invalid("bad");
⋮----
result.IsValid.Should().BeFalse();
⋮----
public void Invalid_SetsErrorMessage()
⋮----
result.ErrorMessage.Should().Be("bad");
⋮----
public void Invalid_WithNullMessage_NormalizesMessage()
⋮----
var result = Model_ValidationResult.Invalid(null);
⋮----
result.ErrorMessage.Should().Be("Validation failed.");
⋮----
public void Invalid_WithWhitespaceMessage_NormalizesMessage()
⋮----
var result = Model_ValidationResult.Invalid("   ");
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Services/Authentication/Service_Authentication_Tests.cs">
/// <summary>
/// Unit tests for Service_Authentication
/// </summary>
⋮----
public class Service_Authentication_Tests
⋮----
private readonly Service_Authentication _sut;
⋮----
// Dao_User constructor requires a string, but the mock object will override virtual methods
⋮----
_sut = new Service_Authentication(_mockDaoUser.Object, _mockErrorHandler.Object);
⋮----
public async Task AuthenticateByWindowsUsernameAsync_EmptyUsername_ReturnsError_Async()
⋮----
// Act
var result = await _sut.AuthenticateByWindowsUsernameAsync("");
⋮----
// Assert
result.Success.Should().BeFalse();
result.ErrorMessage.Should().Contain("required");
⋮----
public async Task AuthenticateByWindowsUsernameAsync_UserNotFound_ReturnsError_Async()
⋮----
// Arrange
_mockDaoUser.Setup(x => x.GetUserByWindowsUsernameAsync(It.IsAny<string>()))
.ReturnsAsync(Model_Dao_Result_Factory.Failure<Model_User>("User not found"));
⋮----
var result = await _sut.AuthenticateByWindowsUsernameAsync("domain\\user");
⋮----
result.ErrorMessage.Should().Contain("not found");
⋮----
public async Task AuthenticateByWindowsUsernameAsync_ValidUser_ReturnsSuccess_Async()
⋮----
var user = new Model_User { FullName = "Test User", WindowsUsername = "domain\\user" };
_mockDaoUser.Setup(x => x.GetUserByWindowsUsernameAsync("domain\\user"))
.ReturnsAsync(Model_Dao_Result_Factory.Success(user));
⋮----
_mockDaoUser.Setup(x => x.LogUserActivityAsync(It.IsAny<string>(), It.IsAny<string>(), It.IsAny<string>(), It.IsAny<string>()))
.ReturnsAsync(Model_Dao_Result_Factory.Success(true));
⋮----
result.Success.Should().BeTrue();
result.User.Should().BeEquivalentTo(user);
_mockDaoUser.Verify(x => x.LogUserActivityAsync("login_success", "domain\\user", It.IsAny<string>(), It.IsAny<string>()), Times.Once);
⋮----
[InlineData("user", "123")] // Too short
[InlineData("user", "12345")] // Too long
[InlineData("user", "abcd")] // Non-numeric
public async Task AuthenticateByPinAsync_InvalidInput_ReturnsError_Async(string username, string pin)
⋮----
var result = await _sut.AuthenticateByPinAsync(username, pin);
⋮----
public async Task AuthenticateByPinAsync_ValidCredentials_ReturnsSuccess_Async()
⋮----
_mockDaoUser.Setup(x => x.ValidateUserPinAsync("user", "1234"))
⋮----
var result = await _sut.AuthenticateByPinAsync("user", "1234");
⋮----
result.User.Should().Be(user);
⋮----
public async Task CreateNewUserAsync_InvalidData_ReturnsError_Async()
⋮----
var user = new Model_User { WindowsUsername = "" }; // Missing fields
⋮----
var result = await _sut.CreateNewUserAsync(user, "admin");
⋮----
public async Task CreateNewUserAsync_ValidData_ReturnsSuccess_Async()
⋮----
var user = new Model_User
⋮----
_mockDaoUser.Setup(x => x.CreateNewUserAsync(user, "admin"))
.ReturnsAsync(Model_Dao_Result_Factory.Success<int>(101));
⋮----
result.EmployeeNumber.Should().Be(101);
⋮----
public async Task ValidatePinAsync_ValidatesCorrectly_Async(string pin, bool expectedValid)
⋮----
var result = await _sut.ValidatePinAsync(pin);
⋮----
result.IsValid.Should().Be(expectedValid);
⋮----
public async Task DetectWorkstationTypeAsync_SharedTerminal_ReturnsType_Async()
⋮----
_mockDaoUser.Setup(x => x.GetSharedTerminalNamesAsync())
.ReturnsAsync(Model_Dao_Result_Factory.Success(new List<string> { "SHARED-PC" }));
⋮----
var result = await _sut.DetectWorkstationTypeAsync(computerName);
⋮----
result.WorkstationType.Should().Be("shared_terminal");
result.ComputerName.Should().Be(computerName);
⋮----
public async Task DetectWorkstationTypeAsync_PersonalWorkstation_ReturnsType_Async()
⋮----
result.WorkstationType.Should().Be("personal_workstation");
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Services/Authentication/Service_UserSessionManager_Tests.cs">
/// <summary>
/// Unit tests for Service_UserSessionManager
/// </summary>
⋮----
public class Service_UserSessionManager_Tests
⋮----
private readonly Service_UserSessionManager _sut;
⋮----
_mockDispatcher.Setup(x => x.CreateTimer()).Returns(_mockTimer.Object);
⋮----
_sut = new Service_UserSessionManager(_mockDaoUser.Object, _mockDispatcher.Object);
⋮----
public void CreateSession_NullUser_ThrowsArgumentNullException()
⋮----
// Act
Action act = () => _sut.CreateSession(null!, new Model_WorkstationConfig("PC"), "Windows");
⋮----
// Assert
act.Should().Throw<ArgumentNullException>().WithParameterName("user");
⋮----
public void CreateSession_ValidData_SetsCurrentSession()
⋮----
// Arrange
var user = new Model_User { WindowsUsername = "test" };
var config = new Model_WorkstationConfig("PC") { WorkstationType = "personal_workstation" };
⋮----
var session = _sut.CreateSession(user, config, "Windows");
⋮----
session.Should().NotBeNull();
session.User.Should().Be(user);
session.WorkstationName.Should().Be("PC");
session.TimeoutDuration.Should().Be(TimeSpan.FromMinutes(30));
_sut.CurrentSession.Should().Be(session);
⋮----
public void StartTimeoutMonitoring_NoSession_ThrowsInvalidOperationException()
⋮----
Action act = () => _sut.StartTimeoutMonitoring();
⋮----
act.Should().Throw<InvalidOperationException>();
⋮----
public void StartTimeoutMonitoring_WithSession_StartsTimer()
⋮----
_sut.CreateSession(new Model_User(), new Model_WorkstationConfig("PC"), "Windows");
⋮----
_sut.StartTimeoutMonitoring();
⋮----
_mockDispatcher.Verify(x => x.CreateTimer(), Times.Once);
_mockTimer.Verify(x => x.Start(), Times.Once);
_mockTimer.VerifySet(x => x.Interval = It.IsAny<TimeSpan>());
_mockTimer.VerifySet(x => x.IsRepeating = true);
⋮----
public void StopTimeoutMonitoring_StopsTimer()
⋮----
_sut.StopTimeoutMonitoring();
⋮----
_mockTimer.Verify(x => x.Stop(), Times.Once);
⋮----
public async Task EndSessionAsync_LogsAndClearsSession_Async()
⋮----
_sut.CreateSession(user, new Model_WorkstationConfig("PC"), "Windows");
⋮----
_mockDaoUser.Setup(x => x.LogUserActivityAsync(It.IsAny<string>(), It.IsAny<string>(), It.IsAny<string>(), It.IsAny<string>()))
.ReturnsAsync(Model_Dao_Result_Factory.Success(true));
⋮----
await _sut.EndSessionAsync("Logout");
⋮----
_sut.CurrentSession.Should().BeNull();
_mockTimer.Verify(x => x.Stop(), Times.Once); // Should stop monitoring
_mockDaoUser.Verify(x => x.LogUserActivityAsync("Logout", "test", "PC", It.IsNotNull<string>()), Times.Once);
⋮----
public void UpdateLastActivity_UpdatesTimestamp()
⋮----
// Wait a tiny bit (not reliable in unit tests really, but checks update)
// Instead we can check that it's very close or just called.
// Since we can't inject time provider, we assume DateTime.Now changes or is called.
⋮----
_sut.UpdateLastActivity();
⋮----
_sut.CurrentSession.LastActivityTimestamp.Should().BeOnOrAfter(initialTime);
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Services/Database/Service_ErrorHandler_Tests.cs">
/// <summary>
/// Unit tests for Service_ErrorHandler
/// </summary>
⋮----
public class Service_ErrorHandler_Tests
⋮----
private readonly Service_ErrorHandler _sut;
⋮----
_sut = new Service_ErrorHandler(_mockLogger.Object, _mockWindowService.Object);
⋮----
public async Task LogErrorAsync_InfoSeverity_CallsLogInfo_Async()
⋮----
// Act
await _sut.LogErrorAsync("Test Info", Enum_ErrorSeverity.Info);
⋮----
// Assert
_mockLogger.Verify(x => x.LogInfo("Test Info", It.IsAny<string?>()), Times.Once);
⋮----
public async Task LogErrorAsync_ErrorSeverity_CallsLogError_Async()
⋮----
// Arrange
var ex = new Exception("Test Ex");
⋮----
await _sut.LogErrorAsync("Test Error", Enum_ErrorSeverity.Error, ex);
⋮----
_mockLogger.Verify(x => x.LogError("Test Error", ex, It.IsAny<string?>()), Times.Once);
⋮----
public async Task HandleErrorAsync_ShowDialogFalse_OnlyLogs_Async()
⋮----
await _sut.HandleErrorAsync("Test", Enum_ErrorSeverity.Warning, null, false);
⋮----
_mockLogger.Verify(x => x.LogWarning("Test", It.IsAny<string?>()), Times.Once);
_mockWindowService.Verify(x => x.GetXamlRoot(), Times.Never);
⋮----
public async Task HandleErrorAsync_ShowDialogTrue_LogsAndChecksWindow_Async()
⋮----
_mockWindowService.Setup(x => x.GetXamlRoot()).Returns((XamlRoot?)null); // Returrns null to avoid UI thread crash
⋮----
await _sut.HandleErrorAsync("Test", Enum_ErrorSeverity.Error, null, true);
⋮----
_mockLogger.Verify(x => x.LogError("Test", null, It.IsAny<string?>()), Times.Once);
_mockWindowService.Verify(x => x.GetXamlRoot(), Times.Once);
// Since xamlRoot is null, we expect a warning log about it
_mockLogger.Verify(x => x.LogWarning("Cannot show dialog - XamlRoot is null", It.IsAny<string?>()), Times.Once);
⋮----
public async Task HandleDaoErrorAsync_SuccessResult_DoesNothing_Async()
⋮----
var result = Model_Dao_Result_Factory.Success();
⋮----
await _sut.HandleDaoErrorAsync(result, "TestOp");
⋮----
_mockLogger.Verify(x => x.LogInfo(It.IsAny<string>(), It.IsAny<string?>()), Times.Never);
_mockLogger.Verify(x => x.LogError(It.IsAny<string>(), It.IsAny<Exception?>(), It.IsAny<string?>()), Times.Never);
⋮----
public async Task HandleDaoErrorAsync_FailureResult_LogsError_Async()
⋮----
var result = Model_Dao_Result_Factory.Failure("DB Fail", new Exception("SQL Error"));
_mockWindowService.Setup(x => x.GetXamlRoot()).Returns((XamlRoot?)null);
⋮----
await _sut.HandleDaoErrorAsync(result, "TestOp", true);
⋮----
_mockLogger.Verify(x => x.LogError(It.Is<string>(s => s.Contains("DB Fail") && s.Contains("TestOp")), It.IsAny<Exception>(), It.IsAny<string?>()), Times.Once);
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Services/Help/Service_Help_Tests.cs">
/// <summary>
/// Unit tests for Service_Help content retrieval
/// </summary>
⋮----
public class Service_Help_Tests
⋮----
private readonly Service_Help _sut;
⋮----
_sut = new Service_Help(_mockWindow.Object, _mockLogger.Object, _mockDispatcher.Object);
⋮----
public void GetHelpContent_ExistingKey_ReturnsContent()
⋮----
// Act
var content = _sut.GetHelpContent("Dunnage.ModeSelection");
⋮----
// Assert
content.Should().NotBeNull();
content?.Title.Should().Be("Select Entry Mode");
content?.Key.Should().Be("Dunnage.ModeSelection");
⋮----
public void GetHelpContent_NonExistentKey_ReturnsNull()
⋮----
var content = _sut.GetHelpContent("NonExistentKey");
⋮----
content.Should().BeNull();
⋮----
public void GetHelpByCategory_ReturnsFilteredList()
⋮----
var list = _sut.GetHelpByCategory("Dunnage Workflow");
⋮----
list.Should().NotBeEmpty();
list.All(x => x.Category == "Dunnage Workflow").Should().BeTrue();
⋮----
public void SearchHelp_ReturnsMatchingItems()
⋮----
var results = _sut.SearchHelp("dunnage");
⋮----
results.Should().NotBeEmpty();
// Should contain items with "dunnage" in title or content
results.Should().Contain(x => x.Title.ToLower().Contains("dunnage") || x.Content.ToLower().Contains("dunnage"));
⋮----
public void SearchHelp_EmptyTerm_ReturnsEmptyList()
⋮----
var results = _sut.SearchHelp("");
⋮----
results.Should().BeEmpty();
⋮----
public void TipRetreival_ReturnsContent()
⋮----
var tip = _sut.GetTip("Dunnage.QuantityEntry");
⋮----
tip.Should().NotBeNullOrEmpty();
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Services/UI/Service_ViewModelRegistry_Tests.cs">
/// <summary>
/// Unit tests for Service_ViewModelRegistry
/// </summary>
⋮----
public class Service_ViewModelRegistry_Tests
⋮----
private class TestViewModel : IResettableViewModel
⋮----
public void ResetToDefaults() => ResetCalled = true;
⋮----
private class AnotherViewModel { }
⋮----
public void Register_and_GetViewModels_WorksCorrectly()
⋮----
// Arrange
var sut = new Service_ViewModelRegistry();
var vm1 = new TestViewModel();
var vm2 = new AnotherViewModel();
⋮----
// Act
sut.Register(vm1);
sut.Register(vm2);
⋮----
var retrieved = sut.GetViewModels<TestViewModel>().ToList();
⋮----
// Assert
retrieved.Should().HaveCount(1);
retrieved.First().Should().Be(vm1);
⋮----
public void ClearAllInputs_CallsResetOnResettableVMs()
⋮----
var vm2 = new AnotherViewModel(); // Not resettable
⋮----
sut.ClearAllInputs();
⋮----
vm1.ResetCalled.Should().BeTrue();
⋮----
public void Cleanup_RemovesDeadReferences()
⋮----
var vm = new TestViewModel();
sut.Register(vm);
⋮----
// Force GC to collect the temporary VM
GC.Collect();
GC.WaitForPendingFinalizers();
⋮----
// GetViewModels calls Cleanup internally
var list = sut.GetViewModels<TestViewModel>().ToList();
⋮----
list.Should().BeEmpty();
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_Application_Variables_Tests.cs">
/// <summary>
/// Unit tests for Model_Application_Variables.
/// Tests default configurations.
/// </summary>
⋮----
public class Model_Application_Variables_Tests
⋮----
public void Constructor_Defaults_SetsSensibleValues()
⋮----
// Act
var config = new Model_Application_Variables();
⋮----
// Assert
config.ApplicationName.Should().NotBeEmpty();
config.Version.Should().MatchRegex(@"\d+\.\d+\.\d+");
config.ConnectionString.Should().BeEmpty();
config.EnvironmentType.Should().Be("Development");
⋮----
public void LogDirectory_Default_IsInAppData()
⋮----
var appData = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
⋮----
config.LogDirectory.Should().StartWith(appData);
config.LogDirectory.Should().Contain("MTM_Receiving_Application");
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_CSVDeleteResult_Tests.cs">
/// <summary>
/// Unit tests for Model_CSVDeleteResult.
/// Tests simple property behavior.
/// </summary>
⋮----
public class Model_CSVDeleteResult_Tests
⋮----
public void Properties_SetAndGet_WorksCorrectly()
⋮----
// Arrange
var result = new Model_CSVDeleteResult();
⋮----
// Act
⋮----
// Assert
result.LocalDeleted.Should().BeTrue();
result.NetworkDeleted.Should().BeFalse();
result.LocalError.Should().BeNull();
result.NetworkError.Should().Be("Access Denied");
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_CSVExistenceResult_Tests.cs">
/// <summary>
/// Unit tests for Model_CSVExistenceResult.
/// Tests simple property holders.
/// </summary>
⋮----
public class Model_CSVExistenceResult_Tests
⋮----
public void Properties_SetAndGet_Works()
⋮----
// Arrange
var result = new Model_CSVExistenceResult();
⋮----
// Act
⋮----
// Assert
result.LocalExists.Should().BeTrue();
result.NetworkExists.Should().BeTrue();
result.NetworkAccessible.Should().BeTrue();
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_CSVWriteResult_Tests.cs">
/// <summary>
/// Unit tests for Model_CSVWriteResult.
/// Tests success calculation logic.
/// </summary>
⋮----
public class Model_CSVWriteResult_Tests
⋮----
public void Constructor_Defaults_AreCorrect()
⋮----
// Act
var result = new Model_CSVWriteResult();
⋮----
// Assert
result.LocalSuccess.Should().BeFalse();
result.NetworkSuccess.Should().BeFalse();
result.ErrorMessage.Should().BeEmpty();
⋮----
public void IsFullSuccess_ReturnsTrueOnlyIfBothSucceed()
⋮----
// Arrange
var result = new Model_CSVWriteResult
⋮----
result.IsFullSuccess.Should().BeTrue();
result.IsPartialSuccess.Should().BeFalse();
result.IsFailure.Should().BeFalse();
⋮----
public void IsPartialSuccess_ReturnsTrueOnlyIfLocalSucceedsButNetworkFails()
⋮----
result.IsFullSuccess.Should().BeFalse();
result.IsPartialSuccess.Should().BeTrue();
⋮----
public void IsFailure_ReturnsTrueIfLocalFails()
⋮----
NetworkSuccess = true // Weird case, but if local fails it's considered failure per logic
⋮----
result.IsFailure.Should().BeTrue();
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_InforVisualPart_Tests.cs">
/// <summary>
/// Unit tests for Model_InforVisualPart.
/// Tests display text logic.
/// </summary>
⋮----
public class Model_InforVisualPart_Tests
⋮----
public void DisplayText_FormatsCorrectly()
⋮----
// Arrange
var part = new Model_InforVisualPart
⋮----
// Act
⋮----
// Assert
text.Should().Be("PART-01 - A Widget (Line 001)");
⋮----
public void Constructor_Defaults_AreCorrect()
⋮----
var part = new Model_InforVisualPart();
⋮----
part.UnitOfMeasure.Should().Be("EA");
part.QtyOrdered.Should().Be(0);
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_InforVisualPO_Tests.cs">
/// <summary>
/// Unit tests for Model_InforVisualPO.
/// Tests calculated properties and default lists.
/// </summary>
⋮----
public class Model_InforVisualPO_Tests
⋮----
public void Constructor_Defaults_AreCorrect()
⋮----
// Act
var po = new Model_InforVisualPO();
⋮----
// Assert
po.Parts.Should().NotBeNull().And.BeEmpty();
po.HasParts.Should().BeFalse();
po.PONumber.Should().BeEmpty();
⋮----
public void HasParts_ReturnsTrueOnlyWhenPartsExist()
⋮----
// Arrange
⋮----
po.Parts.Add(new Model_InforVisualPart());
⋮----
po.HasParts.Should().BeTrue();
⋮----
[InlineData("Z", "Status: Z")] // Unknown code fallback
public void StatusDescription_MapsCodesCorrectly(string code, string expected)
⋮----
var po = new Model_InforVisualPO { Status = code };
⋮----
desc.Should().Be(expected);
⋮----
public void IsClosed_ReturnsTrueForClosedOrCancelled(string status, bool expected)
⋮----
var po = new Model_InforVisualPO { Status = status };
⋮----
isClosed.Should().Be(expected);
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_PackageTypePreference_Tests.cs">
/// <summary>
/// Unit tests for Model_PackageTypePreference.
/// Tests simple property behavior and default DateTime.
/// </summary>
⋮----
public class Model_PackageTypePreference_Tests
⋮----
public void Constructor_Defaults_AreCorrect()
⋮----
// Act
var model = new Model_PackageTypePreference();
⋮----
// Assert
model.PartID.Should().BeEmpty();
model.PackageTypeName.Should().BeEmpty();
model.LastModified.Should().BeCloseTo(DateTime.UtcNow, TimeSpan.FromSeconds(10));
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingLine_Tests.cs">
/// <summary>
/// Unit tests for Model_ReceivingLine.
/// Tests property defaults and formatting.
/// </summary>
⋮----
public class Model_ReceivingLine_Tests
⋮----
public void Constructor_Defaults_AreCorrect()
⋮----
// Act
var line = new Model_ReceivingLine();
⋮----
// Assert
line.Date.Should().BeCloseTo(DateTime.Now, TimeSpan.FromSeconds(1));
line.LabelNumber.Should().Be(1);
line.TotalLabels.Should().Be(1);
line.VendorName.Should().Be("Unknown");
line.PartID.Should().BeEmpty();
⋮----
public void LabelText_ReturnsFormattedString()
⋮----
// Arrange
var line = new Model_ReceivingLine
⋮----
text.Should().Be("2 / 5");
⋮----
public void LabelText_UpdatesWhenPropertiesChange()
⋮----
line.LabelText.Should().Be("3 / 10");
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingLoad_Tests.cs">
/// <summary>
/// Unit tests for Model_ReceivingLoad.
/// Tests property logic, change handlers, and calculations.
/// </summary>
⋮----
public class Model_ReceivingLoad_Tests
⋮----
private Model_ReceivingLoad _sut;
⋮----
_sut = new Model_ReceivingLoad();
⋮----
// ====================================================================
// Constructor & Defaults
⋮----
public void Constructor_Initialization_SetsDefaults()
⋮----
// Act
var model = new Model_ReceivingLoad();
⋮----
// Assert
model.LoadID.Should().NotBeEmpty();
model.PartID.Should().BeEmpty();
model.HeatLotNumber.Should().BeEmpty();
model.ReceivedDate.Should().BeCloseTo(DateTime.Now, TimeSpan.FromSeconds(1));
model.PackageType.Should().Be(Enum_PackageType.Skid);
model.PackageTypeName.Should().Be("Skid");
model.PackagesPerLoad.Should().Be(0);
⋮----
// Property Logic: PartID
⋮----
public void PartID_WhenChanged_SetsPackagesPerLoadToOneIfZero()
⋮----
// Arrange
⋮----
_sut.PackagesPerLoad.Should().Be(1);
⋮----
public void PartID_WhenChangedToMMC_SetsPackageTypeToCoil()
⋮----
_sut.PackageType.Should().Be(Enum_PackageType.Coil);
⋮----
public void PartID_WhenChangedToMMF_SetsPackageTypeToSheet()
⋮----
_sut.PackageType.Should().Be(Enum_PackageType.Sheet);
⋮----
public void PartID_WhenSetToEmptyOrNull_DoesNotChangePackageType(string partId)
⋮----
_sut.PackageType.Should().Be(Enum_PackageType.Skid);
_sut.PackagesPerLoad.Should().Be(0);
⋮----
// Property Logic: PackageType / PackageTypeName
⋮----
public void PackageType_WhenChanged_UpdatesPackageTypeName()
⋮----
_sut.PackageTypeName.Should().Be("Box");
⋮----
public void PackageTypeName_WhenChangedToValidEnum_UpdatesPackageType()
⋮----
_sut.PackageType.Should().Be(Enum_PackageType.Box);
⋮----
public void PackageTypeName_WhenChangedToInvalidEnum_DoesNotUpdatePackageType()
⋮----
// Calculation: WeightPerPackage
⋮----
[InlineData(100.0, 3, 33.0)] // Rounds to nearest whole number as per logic: Math.Round(..., 0)
⋮----
public void CalculateWeightPerPackage_UpdatesUsingWeightAndPackages(decimal weight, int packages, decimal expected)
⋮----
_sut.WeightPerPackage.Should().Be(expected);
⋮----
public void CalculateWeightPerPackage_WhenPackagesIsZero_SetResultToZero()
⋮----
// Act & Assert
// Triggers OnPackagesPerLoadChanged
_sut.WeightPerPackage.Should().Be(0);
⋮----
// Calculated Properties
⋮----
public void WeightPerPackageDisplay_FormattedCorrectly()
⋮----
display.Should().Be("50 lbs per Box");
⋮----
public void PONumberDisplay_WhenNullOrEmpty_ReturnsNA()
⋮----
display.Should().Be("N/A");
⋮----
public void PONumberDisplay_WhenValid_ReturnsPONumber()
⋮----
display.Should().Be("12345");
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingSession_Tests.cs">
/// <summary>
/// Unit tests for Model_ReceivingSession.
/// Tests aggregation logic and transient properties.
/// </summary>
⋮----
public class Model_ReceivingSession_Tests
⋮----
public void Constructor_Defaults_AreCorrect()
⋮----
// Act
var session = new Model_ReceivingSession();
⋮----
// Assert
session.SessionID.Should().NotBeEmpty();
session.CreatedDate.Should().BeCloseTo(DateTime.Now, TimeSpan.FromSeconds(1));
session.Loads.Should().NotBeNull().And.BeEmpty();
session.TotalLoadsCount.Should().Be(0);
session.TotalWeightQuantity.Should().Be(0);
session.HasLoads.Should().BeFalse();
⋮----
public void TotalWeightQuantity_CalculatesSumCorrectly()
⋮----
// Arrange
⋮----
session.Loads.Add(new Model_ReceivingLoad { WeightQuantity = 100 });
session.Loads.Add(new Model_ReceivingLoad { WeightQuantity = 250 });
⋮----
total.Should().Be(350);
⋮----
public void UniqueParts_ReturnsDistinctList()
⋮----
session.Loads.Add(new Model_ReceivingLoad { PartID = "PART-A" });
⋮----
session.Loads.Add(new Model_ReceivingLoad { PartID = "PART-B" });
⋮----
parts.Should().HaveCount(2);
parts.Should().Contain("PART-A");
parts.Should().Contain("PART-B");
⋮----
public void HasLoads_ReturnsTrueWhenLoadsExist()
⋮----
session.Loads.Add(new Model_ReceivingLoad());
⋮----
hasLoads.Should().BeTrue();
⋮----
public void TransientProperties_HandleNullLoadsForSafety()
⋮----
var session = new Model_ReceivingSession
⋮----
Loads = null! // Simulating deserialization issue or explicit null set
⋮----
session.UniqueParts.Should().NotBeNull().And.BeEmpty();
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingValidationResult_Tests.cs">
/// <summary>
/// Unit tests for Model_ReceivingValidationResult.
/// Tests factory methods and default states.
/// </summary>
⋮----
public class Model_ReceivingValidationResult_Tests
⋮----
public void Constructor_Defaults_AreSafe()
⋮----
// Act
var result = new Model_ReceivingValidationResult();
⋮----
// Assert
result.IsValid.Should().BeFalse();
result.Severity.Should().Be(Enum_ValidationSeverity.Error);
result.Message.Should().BeEmpty();
result.Errors.Should().NotBeNull().And.BeEmpty();
⋮----
public void Success_Factory_ReturnsValidObject()
⋮----
var result = Model_ReceivingValidationResult.Success();
⋮----
result.IsValid.Should().BeTrue();
⋮----
result.Errors.Should().BeEmpty();
⋮----
public void Error_Factory_ReturnsErrorObject()
⋮----
var result = Model_ReceivingValidationResult.Error(msg);
⋮----
result.Message.Should().Be(msg);
result.Errors.Should().Contain(msg);
⋮----
public void Warning_Factory_ReturnsWarningObject()
⋮----
var result = Model_ReceivingValidationResult.Warning(msg);
⋮----
result.IsValid.Should().BeTrue("Warnings should not block validity");
result.Severity.Should().Be(Enum_ValidationSeverity.Warning);
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_ReceivingWorkflowStepResult_Tests.cs">
/// <summary>
/// Unit tests for Model_ReceivingWorkflowStepResult.
/// Tests factory methods and properties.
/// </summary>
⋮----
public class Model_ReceivingWorkflowStepResult_Tests
⋮----
public void Constructor_Defaults_AreCorrect()
⋮----
// Act
var result = new Model_ReceivingWorkflowStepResult();
⋮----
// Assert
result.Success.Should().BeFalse();
result.Message.Should().BeEmpty();
result.ValidationErrors.Should().NotBeNull().And.BeEmpty();
⋮----
public void SuccessResult_Factory_CreatesSuccessObject()
⋮----
var result = Model_ReceivingWorkflowStepResult.SuccessResult(step, message);
⋮----
result.Success.Should().BeTrue();
result.NewStep.Should().Be(step);
result.Message.Should().Be(message);
⋮----
public void ErrorResult_Factory_CreatesErrorObject()
⋮----
var result = Model_ReceivingWorkflowStepResult.ErrorResult(errors);
⋮----
result.ValidationErrors.Should().BeEquivalentTo(errors);
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_SaveResult_Tests.cs">
/// <summary>
/// Unit tests for Model_SaveResult.
/// Tests success calculation logic and property behavior.
/// </summary>
⋮----
public class Model_SaveResult_Tests
⋮----
public void Constructor_Defaults_AreCorrect()
⋮----
// Act
var result = new Model_SaveResult();
⋮----
// Assert
result.Success.Should().BeFalse();
result.LoadsSaved.Should().Be(0);
result.LocalCSVSuccess.Should().BeFalse();
result.NetworkCSVSuccess.Should().BeFalse();
result.DatabaseSuccess.Should().BeFalse();
result.Errors.Should().BeEmpty();
result.Warnings.Should().BeEmpty();
⋮----
public void IsFullSuccess_WhenAllTrue_ReturnsTrue()
⋮----
// Arrange
var result = new Model_SaveResult
⋮----
result.IsFullSuccess.Should().BeTrue();
result.IsPartialSuccess.Should().BeFalse();
⋮----
public void IsFullSuccess_WhenAnyFalse_ReturnsFalse(bool local, bool network, bool db)
⋮----
result.IsFullSuccess.Should().BeFalse();
⋮----
[InlineData(true, false, false)] // Only Local
[InlineData(false, false, true)] // Only DB
[InlineData(true, false, true)] // Local + DB
public void IsPartialSuccess_WhenMixedSuccessMatchesCriteria_ReturnsTrue(bool local, bool network, bool db)
⋮----
result.IsPartialSuccess.Should().BeTrue();
⋮----
public void IsPartialSuccess_WhenFullSuccess_ReturnsFalse()
⋮----
public void IsPartialSuccess_WhenNoSuccess_ReturnsFalse()
⋮----
public void LegacyProperties_MapToNewProperties()
⋮----
result.LoadsSaved.Should().Be(10);
result.Success.Should().BeTrue();
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_UserPreference_Tests.cs">
/// <summary>
/// Unit tests for Model_UserPreference.
/// Tests ObservableObject properties.
/// </summary>
⋮----
public class Model_UserPreference_Tests
⋮----
public void Constructor_Defaults_AreCorrect()
⋮----
// Act
var prefs = new Model_UserPreference();
⋮----
// Assert
prefs.Username.Should().BeEmpty();
prefs.PreferredPackageType.Should().Be("Package");
prefs.Workstation.Should().BeEmpty();
⋮----
public void Properties_NotifyChanges()
⋮----
// Arrange
⋮----
propertyChanged.Should().BeTrue();
prefs.Username.Should().Be("NewUser");
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Models/Model_WorkflowStepResult_Tests.cs">
/// <summary>
/// Unit tests for Model_WorkflowStepResult.
/// Tests property defaults and setting values.
/// </summary>
⋮----
public class Model_WorkflowStepResult_Tests
⋮----
public void Constructor_Defaults_AreCorrect()
⋮----
// Act
var model = new Model_WorkflowStepResult();
⋮----
// Assert
model.IsSuccess.Should().BeFalse();
model.ErrorMessage.Should().BeEmpty();
model.TargetStep.Should().BeNull();
⋮----
public void Properties_SetAndGet_WorksCorrectly()
⋮----
// Arrange
⋮----
model.IsSuccess.Should().BeTrue();
model.ErrorMessage.Should().Be("Operation successful");
model.TargetStep.Should().Be(step);
</file>

<file path="Module_Core/Contracts/Services/IService_Authentication.cs">
/// <summary>
/// Service contract for user authentication operations.
/// Handles Windows username and PIN-based authentication flows.
/// </summary>
public interface IService_Authentication
⋮----
/// Authenticates a user by Windows username (automatic login for personal workstations).
⋮----
/// <param name="windowsUsername">Windows username from Environment.UserName</param>
/// <param name="progress">Optional progress reporter for splash screen updates</param>
/// <returns>Authentication result with user data or error message</returns>
public Task<Model_AuthenticationResult> AuthenticateByWindowsUsernameAsync(
⋮----
/// Authenticates a user by username and PIN (shared terminal login).
⋮----
/// <param name="username">Username (Windows username or full name)</param>
/// <param name="pin">4-digit numeric PIN</param>
⋮----
public Task<Model_AuthenticationResult> AuthenticateByPinAsync(
⋮----
/// Creates a new user account with validation.
⋮----
/// <param name="user">User model with account data</param>
/// <param name="createdBy">Windows username of account creator</param>
/// <param name="progress">Optional progress reporter for UI feedback</param>
/// <returns>Result with new employee number or error message</returns>
public Task<Model_CreateUserResult> CreateNewUserAsync(
⋮----
/// Validates PIN format.
⋮----
/// <param name="pin">4-digit PIN to validate</param>
/// <param name="excludeEmployeeNumber">Unused (kept for backward compatibility)</param>
/// <returns>Validation result with error message if invalid</returns>
public Task<Model_ValidationResult> ValidatePinAsync(string pin, int? excludeEmployeeNumber = null);
⋮----
/// Detects workstation type (personal workstation or shared terminal).
/// Queries auth_workstation_config table to determine authentication flow.
⋮----
/// <param name="computerName">Computer name (defaults to Environment.MachineName)</param>
/// <returns>Workstation configuration with type and timeout settings</returns>
public Task<Model_WorkstationConfig> DetectWorkstationTypeAsync(string? computerName = null);
⋮----
/// Retrieves list of active departments for dropdown population.
⋮----
/// <returns>List of department names</returns>
public Task<List<string>> GetActiveDepartmentsAsync();
⋮----
/// Logs a user activity event for audit trail.
⋮----
/// <param name="eventType">Event type (login_success, login_failed, session_timeout, user_created)</param>
/// <param name="username">Username involved in event</param>
/// <param name="workstationName">Computer name where event occurred</param>
/// <param name="details">Additional event details</param>
public Task LogUserActivityAsync(string eventType, string username, string workstationName, string details);
</file>

<file path="Module_Core/Contracts/Services/IService_VolvoMasterData.cs">
/// <summary>
/// Service interface for managing Volvo parts master data
/// </summary>
public interface IService_VolvoMasterData
⋮----
/// Gets all parts from the master catalog
⋮----
/// <param name="includeInactive">Include deactivated parts</param>
/// <returns>List of parts</returns>
public Task<Model_Dao_Result<List<Model_VolvoPart>>> GetAllPartsAsync(bool includeInactive = false);
⋮----
/// Gets a specific part by part number
⋮----
/// <param name="partNumber">Part number to retrieve</param>
/// <returns>Part details or null if not found</returns>
public Task<Model_Dao_Result<Model_VolvoPart?>> GetPartByNumberAsync(string partNumber);
⋮----
/// Adds a new part to the master catalog
⋮----
/// <param name="part">Part to add</param>
/// <param name="components">Optional component relationships</param>
/// <returns>Success result</returns>
public Task<Model_Dao_Result> AddPartAsync(Model_VolvoPart part, List<Model_VolvoPartComponent>? components = null);
⋮----
/// Updates an existing part in the master catalog
⋮----
/// <param name="part">Part with updated values</param>
/// <param name="components">Updated component relationships (replaces existing)</param>
⋮----
public Task<Model_Dao_Result> UpdatePartAsync(Model_VolvoPart part, List<Model_VolvoPartComponent>? components = null);
⋮----
/// Deactivates a part (soft delete - preserves historical integrity)
⋮----
/// <param name="partNumber">Part number to deactivate</param>
⋮----
public Task<Model_Dao_Result> DeactivatePartAsync(string partNumber);
⋮----
/// Imports parts from CSV file
⋮----
/// <param name="csvFilePath">Path to CSV file</param>
/// <returns>Import summary with new/updated/unchanged counts</returns>
⋮----
/// Gets all components for a specific part
⋮----
/// <param name="partNumber">Part number</param>
/// <returns>List of components</returns>
public Task<Model_Dao_Result<List<Model_VolvoPartComponent>>> GetComponentsAsync(string partNumber);
⋮----
public Task<Model_Dao_Result<(int New, int Updated, int Unchanged)>> ImportCsvAsync(string csvFilePath);
⋮----
/// Exports all parts to CSV file
⋮----
/// <param name="csvFilePath">Path where CSV should be saved</param>
⋮----
/// <returns>Success result with file path</returns>
public Task<Model_Dao_Result<string>> ExportCsvAsync(string csvFilePath, bool includeInactive = false);
</file>

<file path="Module_Core/Converters/Converter_EnumToVisibility.cs">
/// <summary>
/// Converts enum value to Visibility based on parameter match
/// </summary>
public class Converter_EnumToVisibility : IValueConverter
⋮----
public object Convert(object? value, Type targetType, object? parameter, string language)
⋮----
var enumValue = value.ToString();
var targetValue = parameter.ToString();
⋮----
return string.Equals(enumValue, targetValue, StringComparison.OrdinalIgnoreCase)
⋮----
public object ConvertBack(object? value, Type targetType, object? parameter, string language)
⋮----
throw new NotImplementedException();
</file>

<file path="Module_Core/Converters/Converter_IntToVisibility.cs">
/// <summary>
/// Converts an integer value to Visibility
/// - If ConverterParameter is an integer string (e.g., "1", "2"), compares value == parameter
/// - If ConverterParameter is "Inverse", shows when value == 0
/// - If no parameter, shows when value > 0
/// </summary>
public class Converter_IntToVisibility : IValueConverter
⋮----
public object Convert(object? value, Type targetType, object? parameter, string language)
⋮----
// Handle different parameter types
⋮----
// Check for "Inverse" parameter (legacy behavior: show when count is 0)
if (paramStr.Equals("Inverse", StringComparison.OrdinalIgnoreCase))
⋮----
// Check for numeric parameter (e.g., "1", "2", "3" for step matching)
else if (int.TryParse(paramStr, out int paramInt))
⋮----
// Fallback for unknown string parameters
⋮----
// Direct integer parameter comparison
⋮----
// No parameter: show if value > 0 (legacy behavior)
⋮----
public object ConvertBack(object? value, Type targetType, object? parameter, string language)
⋮----
throw new NotImplementedException();
</file>

<file path="Module_Core/Converters/NullableDoubleToDoubleConverter.cs">
/// <summary>
/// Converts between double? and double for NumberBox bindings
/// </summary>
public class NullableDoubleToDoubleConverter : IValueConverter
⋮----
public object Convert(object? value, Type targetType, object? parameter, string language)
⋮----
public object? ConvertBack(object? value, Type targetType, object? parameter, string language)
</file>

<file path="Module_Core/Helpers/Database/Helper_Database_StoredProcedure.cs">
/// <summary>
/// Helper class for executing stored procedures with retry logic,
/// performance monitoring, and standardized error handling
/// </summary>
public static class Helper_Database_StoredProcedure
⋮----
/// Executes a stored procedure using MySqlParameter array (compatible with legacy/receiving DAOs)
⋮----
/// <param name="procedureName"></param>
/// <param name="parameters"></param>
/// <param name="connectionString"></param>
public static async Task<Model_Dao_Result> ExecuteAsync(
⋮----
var result = new Model_Dao_Result();
var stopwatch = Stopwatch.StartNew();
⋮----
await using var connection = new MySqlConnection(connectionString);
await connection.OpenAsync();
⋮----
await using var command = new MySqlCommand(procedureName, connection)
⋮----
command.Parameters.AddRange(parameters);
⋮----
var affectedRows = await command.ExecuteNonQueryAsync();
⋮----
// Handle output parameters if any
⋮----
// You might want to capture output values here if needed
// For now, we just ensure the command executes
⋮----
stopwatch.Stop();
⋮----
await Task.Delay(RetryDelaysMs[attempt - 1]);
⋮----
return Model_Dao_Result_Factory.Failure($"Stored procedure '{procedureName}' failed: {ex.Message}", ex);
⋮----
return Model_Dao_Result_Factory.Failure($"Stored procedure '{procedureName}' failed after {MaxRetries} attempts");
⋮----
/// Validates that all required parameters are present and not null
⋮----
public static bool ValidateParameters(MySqlParameter[]? parameters)
⋮----
// Allow DBNull.Value but not null
⋮----
/// Executes a stored procedure that returns no data (INSERT, UPDATE, DELETE)
⋮----
public static async Task<Model_Dao_Result> ExecuteNonQueryAsync(
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] ExecuteNonQueryAsync: {procedureName} (Attempt {attempt}/{MaxRetries})");
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] Executing: {procedureName}");
⋮----
System.Diagnostics.Debug.WriteLine($"[DB]   {param.ParameterName} = {valueDisplay} ({param.Value?.GetType().Name ?? "DBNull"})");
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] Success: {affectedRows} rows affected in {stopwatch.ElapsedMilliseconds}ms");
⋮----
/// Executes a stored procedure that returns a single record mapped to T
⋮----
/// <typeparam name="T"></typeparam>
⋮----
/// <param name="mapper"></param>
⋮----
public static async Task<Model_Dao_Result<T>> ExecuteSingleAsync<T>(
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] ExecuteSingleAsync: {procedureName} (Attempt {attempt}/{MaxRetries})");
⋮----
await using var reader = await command.ExecuteReaderAsync();
⋮----
if (await reader.ReadAsync())
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] Success: 1 record found in {stopwatch.ElapsedMilliseconds}ms");
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] No record found");
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] ERROR in ExecuteSingleAsync: {procedureName}");
System.Diagnostics.Debug.WriteLine($"[DB] Error Type: {ex.GetType().Name}");
System.Diagnostics.Debug.WriteLine($"[DB] Error Message: {ex.Message}");
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] MySQL Error {sqlEx.Number}: {errorDesc}");
System.Diagnostics.Debug.WriteLine($"[DB] SQL State: {sqlEx.SqlState}");
⋮----
/// Executes a stored procedure that returns a list of records mapped to T
⋮----
public static async Task<Model_Dao_Result<List<T>>> ExecuteListAsync<T>(
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] ExecuteListAsync: {procedureName} (Attempt {attempt}/{MaxRetries})");
⋮----
while (await reader.ReadAsync())
⋮----
list.Add(mapper(reader));
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] Success: {list.Count} records retrieved in {stopwatch.ElapsedMilliseconds}ms");
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] ERROR in ExecuteListAsync: {procedureName}");
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] MySQL Error Code: {sqlEx.Number}");
⋮----
/// Executes a stored procedure that returns a DataTable (SELECT)
⋮----
public static async Task<Model_Dao_Result<DataTable>> ExecuteDataTableAsync(
⋮----
var dataTable = new DataTable();
dataTable.Load(reader);
⋮----
/// Executes a stored procedure within an existing transaction
⋮----
/// <param name="connection"></param>
/// <param name="transaction"></param>
⋮----
public static async Task<Model_Dao_Result> ExecuteInTransactionAsync(
⋮----
await using var command = new MySqlCommand(procedureName, connection, transaction)
⋮----
// Log the actual command being executed
System.Diagnostics.Debug.WriteLine($"[DB] Executing SP: {procedureName}");
⋮----
System.Diagnostics.Debug.WriteLine($"[DB]   Parameter: {param.ParameterName} = {valueDisplay} (Type: {param.MySqlDbType})");
⋮----
// Detailed SQL error logging
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] MySQL ERROR {sqlEx.Number}: {errorDesc}");
System.Diagnostics.Debug.WriteLine($"[DB] Error Message: {sqlEx.Message}");
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] Procedure: {procedureName}");
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] ERROR: {ex.GetType().Name}: {ex.Message}");
⋮----
private static void AddParameters(MySqlCommand command, Dictionary<string, object>? parameters)
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] Adding {parameters.Count} parameters:");
⋮----
// Automatically add 'p_' prefix if missing, as per convention
string paramName = param.Key.StartsWith("p_") ? "@" + param.Key : "@p_" + param.Key;
// Or just use the key if the caller is expected to provide the correct name
// The constitution says: "Parameter names in C# match stored procedure parameters (WITHOUT p_ prefix - added automatically)"
// So we should add p_ prefix.
⋮----
// However, existing code might be using @p_ already.
// Let's be safe: if it starts with @, use it. If not, check if it starts with p_.
⋮----
string cleanName = param.Key.TrimStart('@');
string finalName = cleanName.StartsWith("p_") ? "@" + cleanName : "@p_" + cleanName;
⋮----
param.Value.ToString();
⋮----
System.Diagnostics.Debug.WriteLine($"[DB]   {param.Key} → {finalName} = {valueDisplay} ({param.Value?.GetType().Name ?? "null"})");
⋮----
command.Parameters.AddWithValue(finalName, param.Value ?? DBNull.Value);
⋮----
System.Diagnostics.Debug.WriteLine($"[DB] No parameters provided");
⋮----
/// Gets a human-readable description for common MySQL error codes
/// Reference: MySQL 5.7 Error Message Reference
⋮----
/// <param name="errorCode"></param>
private static string GetMySqlErrorDescription(int errorCode)
⋮----
// Server Error Message Reference (Chapter 2)
⋮----
// Connection/Client specific errors often encountered
⋮----
/// Determines if a MySQL exception is transient (temporary) and should be retried
⋮----
/// <param name="ex"></param>
private static bool IsTransientError(MySqlException ex)
⋮----
// Transient error codes that can be retried:
// 1040 = Too many connections
// 1053 = Server shutdown in progress
// 1080 = Forcing close of thread (server side)
// 1152 = Aborted connection
// 1153 = Packet bigger than max_allowed_packet (sometimes transient if config changes dynamically or network glitch)
// 1154 = Read error from connection pipe
// 1155 = Error from fcntl()
// 1156 = Packets out of order
// 1157 = Couldn't uncompress packet
// 1158 = Error reading communication packets
// 1159 = Timeout reading communication packets
// 1160 = Error writing communication packets
// 1161 = Timeout writing communication packets
// 1184 = Aborted connection (new)
// 1203 = User max connections exceeded
// 1205 = Lock wait timeout exceeded
// 1213 = Deadlock found
// 1226 = Resource limit exceeded
// 2002 = Can't connect to local MySQL server through socket
// 2003 = Can't connect to MySQL server
// 2006 = MySQL server has gone away
// 2013 = Lost connection to MySQL server during query
// 2055 = Lost connection to MySQL server at 'reading initial communication packet'
</file>

<file path="Module_Core/Models/Systems/Model_User.cs">
/// <summary>
/// Represents a user/employee entity in the authentication system.
/// Maps to the 'users' database table.
/// </summary>
public class Model_User
⋮----
// ====================================================================
// Database Fields
⋮----
/// Unique employee identifier (Primary Key, Auto-increment)
⋮----
/// Windows login username (DOMAIN\username format)
/// Unique constraint in database
⋮----
/// Employee full name for display
⋮----
/// 4-digit numeric PIN for shared terminal login (plain text storage)
/// Not unique across users (shared PINs allowed)
⋮----
/// Department assignment (required)
⋮----
/// Shift assignment: "1st Shift", "2nd Shift", or "3rd Shift"
⋮----
/// Account active status
⋮----
/// Optional Visual/Infor ERP username (plain text storage)
⋮----
/// Optional Visual/Infor ERP password (plain text storage, masked in UI)
⋮----
/// Default receiving workflow mode: "guided", "manual", or null (show selection)
⋮----
/// Default dunnage workflow mode: "guided", "manual", "edit", or null (show selection)
⋮----
/// Account creation timestamp
⋮----
/// Windows username of account creator
⋮----
/// Last modification timestamp
⋮----
// Computed Properties
⋮----
/// Display name formatted as "Full Name (Emp #NNNN)"
/// Used in UI header display
⋮----
/// Indicates if user has configured ERP access credentials
⋮----
public bool HasErpAccess => !string.IsNullOrWhiteSpace(VisualUsername);
⋮----
// Constructor
⋮----
/// Default constructor
</file>

<file path="Module_Core/Services/Startup/Service_OnStartup_AppLifecycle.cs">
public class Service_OnStartup_AppLifecycle : IService_OnStartup_AppLifecycle
⋮----
private readonly IServiceProvider _serviceProvider;
private readonly IService_Authentication _authService;
private readonly IService_UserSessionManager _sessionManager;
private readonly IService_ErrorHandler _errorHandler;
private readonly IService_CSVWriter _csvWriter;
⋮----
public async Task StartAsync()
⋮----
// 1. Show splash screen immediately (0-15%)
⋮----
_splashScreen.Activate();
⋮----
await Task.Delay(100);
⋮----
// 2. Create Main Window (hidden initially)
⋮----
// Give UI thread time to initialize
⋮----
// 3. Initialize Services (20%)
⋮----
await Task.Delay(300);
⋮----
// 3. Check if Windows user exists (30%)
⋮----
var userCheckResult = await _authService.AuthenticateByWindowsUsernameAsync(windowsUser);
⋮----
// If user doesn't exist, create account first (before workstation detection)
⋮----
// Show New User Setup Dialog as child of splash screen
⋮----
newUserViewModel.CreatedBy = windowsUser; // Self-creation (physical presence is authorization)
⋮----
var newUserDialog = new View_Shared_NewUserSetupDialog(newUserViewModel);
⋮----
// Set splash screen as parent
⋮----
// Show dialog and wait for result
var dialogResult = await newUserDialog.ShowAsync();
⋮----
// Check result
⋮----
// Account created successfully - re-authenticate to get full user data
⋮----
userCheckResult = await _authService.AuthenticateByWindowsUsernameAsync(windowsUser);
⋮----
// Resilience: if the DB lookup doesn't immediately return the user (e.g. mismatch or timing),
// continue startup with the known data instead of shutting down.
authenticatedUser = new Model_User
⋮----
await _errorHandler.HandleErrorAsync(
⋮----
// User cancelled account creation - close app properly
⋮----
// Close splash screen
⋮----
_splashScreen.Close();
⋮----
// Close main window if it exists
⋮----
// Exit application properly
Application.Current.Exit();
⋮----
// User exists - use existing user account
⋮----
// Ensure first-run never proceeds with missing defaults.
// Database schema may be mid-migration; apply safe app-level defaults.
⋮----
// 4. Detect Workstation (50%)
⋮----
var workstationConfig = await _authService.DetectWorkstationTypeAsync();
⋮----
// Debug logging
System.Diagnostics.Debug.WriteLine($"Workstation: {workstationConfig.ComputerName}");
System.Diagnostics.Debug.WriteLine($"Type: {workstationConfig.WorkstationType}");
System.Diagnostics.Debug.WriteLine($"Is Shared: {workstationConfig.IsSharedTerminal}");
System.Diagnostics.Debug.WriteLine($"Is Personal: {workstationConfig.IsPersonalWorkstation}");
⋮----
// 5. Determine authentication method based on workstation type (55-80%)
⋮----
// Personal workstation - use Windows auto-login
⋮----
// Shared terminal - require PIN authentication
// Clear any pre-authenticated user (from Windows auth) to ensure PIN is required
⋮----
// Show PIN login dialog as child of splash screen
⋮----
var loginDialog = new View_Shared_SharedTerminalLoginDialog(loginViewModel);
⋮----
var dialogResult = await loginDialog.ShowAsync();
⋮----
// Authentication successful - override with PIN-authenticated user
⋮----
// Maximum attempts exceeded - log and close app
⋮----
// Close application
Microsoft.Windows.AppLifecycle.AppInstance.GetCurrent().UnregisterKey();
System.Environment.Exit(0);
⋮----
// User cancelled login - close app
⋮----
// Fallback for unexpected dialog closure (e.g. Esc key if not handled)
⋮----
// 6. Create Session (90%)
⋮----
_sessionManager.CreateSession(authenticatedUser, workstationConfig, authMethod);
_sessionManager.StartTimeoutMonitoring();
⋮----
// Update MainWindow user display
⋮----
mainWin.DispatcherQueue.TryEnqueue(() => mainWin.UpdateUserDisplay());
⋮----
// No authenticated user - should not reach here unless cancelled
⋮----
// 7. Finalize (100%) - Show main window, hide splash
⋮----
await Task.Delay(500);
⋮----
// Show main window and hide splash screen
⋮----
// CSV reset dialog removed - only appears when user explicitly clicks Reset CSV button
⋮----
await _errorHandler.HandleErrorAsync("Startup failed", Models.Enums.Enum_ErrorSeverity.Critical, ex);
⋮----
System.Environment.Exit(1);
⋮----
private void UpdateSplash(double percentage, string message)
⋮----
_splashScreen?.ViewModel.UpdateProgress(percentage, message);
⋮----
private void SetSplashIndeterminate(string message)
⋮----
_splashScreen?.ViewModel.SetIndeterminate(message);
⋮----
private static void ApplySafeUserDefaults(Model_User? user)
⋮----
if (string.IsNullOrWhiteSpace(user.DefaultReceivingMode))
⋮----
if (string.IsNullOrWhiteSpace(user.DefaultDunnageMode))
</file>

<file path="Module_Dunnage/Data/Dao_DunnageCustomField.cs">
public class Dao_DunnageCustomField
⋮----
public virtual async Task<Model_Dao_Result<int>> InsertAsync(int typeId, Model_CustomFieldDefinition field, string user)
⋮----
var pNewId = new MySqlParameter("@p_new_id", MySqlDbType.Int32)
⋮----
new MySqlParameter("@p_type_id", typeId),
new MySqlParameter("@p_field_name", field.FieldName),
new MySqlParameter("@p_field_type", field.FieldType),
new MySqlParameter("@p_display_order", field.DisplayOrder),
new MySqlParameter("@p_is_required", field.IsRequired),
new MySqlParameter("@p_user", user),
⋮----
var result = await Helper_Database_StoredProcedure.ExecuteAsync(
⋮----
return Model_Dao_Result_Factory.Success<int>(Convert.ToInt32(pNewId.Value));
⋮----
public virtual async Task<Model_Dao_Result<List<Model_CustomFieldDefinition>>> GetByTypeAsync(int typeId)
⋮----
public virtual async Task<Model_Dao_Result> DeleteAsync(int fieldId)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
private Model_CustomFieldDefinition MapFromReader(IDataReader reader)
⋮----
return new Model_CustomFieldDefinition
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
FieldName = reader.GetString(reader.GetOrdinal("field_name")),
FieldType = reader.GetString(reader.GetOrdinal("field_type")),
DisplayOrder = reader.GetInt32(reader.GetOrdinal("display_order")),
IsRequired = reader.GetBoolean(reader.GetOrdinal("is_required"))
</file>

<file path="Module_Dunnage/Data/Dao_DunnageLoad.cs">
public class Dao_DunnageLoad
⋮----
public virtual async Task<Model_Dao_Result<List<Model_DunnageLoad>>> GetAllAsync()
⋮----
public virtual async Task<Model_Dao_Result<List<Model_DunnageLoad>>> GetByDateRangeAsync(DateTime startDate, DateTime endDate)
⋮----
public virtual async Task<Model_Dao_Result<Model_DunnageLoad>> GetByIdAsync(Guid loadUuid)
⋮----
{ "load_uuid", loadUuid.ToString() }
⋮----
public virtual async Task<Model_Dao_Result> InsertAsync(Guid loadUuid, string partId, decimal quantity, string user)
⋮----
{ "load_uuid", loadUuid.ToString() },
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
public virtual async Task<Model_Dao_Result> InsertBatchAsync(List<Model_DunnageLoad> loads, string user)
⋮----
// Validate that all part IDs exist before attempting insert
var uniquePartIds = loads.Select(l => l.PartId).Distinct().ToList();
var daoPart = new Dao_DunnagePart(_connectionString);
⋮----
var partResult = await daoPart.GetByIdAsync(partId);
⋮----
invalidParts.Add(partId);
⋮----
return new Model_Dao_Result
⋮----
ErrorMessage = $"Cannot save loads: The following Part ID(s) have not been registered in the system: {string.Join(", ", invalidParts)}. " +
⋮----
// Serialize loads to JSON for batch insert
// We need to map the model properties to the JSON structure expected by the SP
⋮----
loadData.Add(new
⋮----
load_uuid = load.LoadUuid.ToString(),
⋮----
string json = JsonSerializer.Serialize(loadData);
⋮----
var result = await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
// Enhance foreign key constraint error messages
⋮----
if (result.ErrorMessage.Contains("FK_dunnage_history_part_id") ||
result.ErrorMessage.Contains("foreign key constraint"))
⋮----
public virtual async Task<Model_Dao_Result> UpdateAsync(Guid loadUuid, decimal quantity, string user)
⋮----
public virtual async Task<Model_Dao_Result> DeleteAsync(Guid loadUuid)
⋮----
private Model_DunnageLoad MapFromReader(IDataReader reader)
⋮----
return new Model_DunnageLoad
⋮----
LoadUuid = (Guid)reader[reader.GetOrdinal("load_uuid")],
PartId = reader.GetString(reader.GetOrdinal("part_id")),
Quantity = reader.GetDecimal(reader.GetOrdinal("quantity")),
ReceivedDate = reader.GetDateTime(reader.GetOrdinal("received_date")),
CreatedBy = reader.GetString(reader.GetOrdinal("created_by")),
CreatedDate = reader.GetDateTime(reader.GetOrdinal("created_date")),
ModifiedBy = reader.IsDBNull(reader.GetOrdinal("modified_by")) ? null : reader.GetString(reader.GetOrdinal("modified_by")),
ModifiedDate = reader.IsDBNull(reader.GetOrdinal("modified_date")) ? null : reader.GetDateTime(reader.GetOrdinal("modified_date"))
</file>

<file path="Module_Dunnage/Data/Dao_DunnageType.cs">
public class Dao_DunnageType
⋮----
public virtual async Task<Model_Dao_Result<List<Model_DunnageType>>> GetAllAsync()
⋮----
Console.WriteLine($"[Dao_DunnageType] GetAllAsync called");
Console.WriteLine($"[Dao_DunnageType] Connection string: {_connectionString}");
⋮----
Console.WriteLine($"[Dao_DunnageType] Result - IsSuccess: {result.IsSuccess}, Data Count: {result.Data?.Count ?? 0}, Error: {result.ErrorMessage}");
⋮----
public virtual async Task<Model_Dao_Result<Model_DunnageType>> GetByIdAsync(int id)
⋮----
public virtual async Task<Model_Dao_Result<int>> InsertAsync(string typeName, string icon, string user)
⋮----
var pNewId = new MySqlParameter("@p_new_id", MySqlDbType.Int32)
⋮----
new MySqlParameter("@p_type_name", typeName),
new MySqlParameter("@p_icon", icon),
new MySqlParameter("@p_user", user),
⋮----
var result = await Helper_Database_StoredProcedure.ExecuteAsync(
⋮----
return Model_Dao_Result_Factory.Success<int>(Convert.ToInt32(pNewId.Value));
⋮----
public virtual async Task<Model_Dao_Result> UpdateAsync(int id, string typeName, string icon, string user)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
public virtual async Task<Model_Dao_Result> DeleteAsync(int id)
⋮----
public virtual async Task<Model_Dao_Result<int>> CountPartsAsync(int typeId)
⋮----
reader => reader.GetInt32(reader.GetOrdinal("part_count")),
⋮----
public virtual async Task<Model_Dao_Result<int>> CountTransactionsAsync(int typeId)
⋮----
reader => reader.GetInt32(reader.GetOrdinal("transaction_count")),
⋮----
/// <summary>
/// Check if a dunnage type name already exists (for duplicate detection during create/update)
/// </summary>
/// <param name="typeName">Type name to check</param>
/// <param name="excludeId">ID to exclude from check (null for new types, type ID for updates)</param>
/// <returns>True if duplicate exists, false otherwise</returns>
public virtual async Task<Model_Dao_Result<bool>> CheckDuplicateNameAsync(string typeName, int? excludeId = null)
⋮----
var pExists = new MySqlParameter("@p_exists", MySqlDbType.Bit)
⋮----
new MySqlParameter("@p_exclude_id", excludeId.HasValue ? (object)excludeId.Value : DBNull.Value),
⋮----
return Model_Dao_Result_Factory.Success<bool>(Convert.ToBoolean(pExists.Value));
⋮----
private Model_DunnageType MapFromReader(IDataReader reader)
⋮----
return new Model_DunnageType
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
TypeName = reader.GetString(reader.GetOrdinal("type_name")),
Icon = reader.IsDBNull(reader.GetOrdinal("icon")) ? "Help" : reader.GetString(reader.GetOrdinal("icon")),
CreatedBy = reader.GetString(reader.GetOrdinal("created_by")),
CreatedDate = reader.GetDateTime(reader.GetOrdinal("created_date")),
ModifiedBy = reader.IsDBNull(reader.GetOrdinal("modified_by")) ? null : reader.GetString(reader.GetOrdinal("modified_by")),
ModifiedDate = reader.IsDBNull(reader.GetOrdinal("modified_date")) ? null : reader.GetDateTime(reader.GetOrdinal("modified_date"))
</file>

<file path="Module_Dunnage/Data/Dao_InventoriedDunnage.cs">
public class Dao_InventoriedDunnage
⋮----
public virtual async Task<Model_Dao_Result<List<Model_InventoriedDunnage>>> GetAllAsync()
⋮----
public virtual async Task<Model_Dao_Result<bool>> CheckAsync(string partId)
⋮----
reader => reader.GetBoolean(reader.GetOrdinal("requires_inventory")),
⋮----
public virtual async Task<Model_Dao_Result<Model_InventoriedDunnage>> GetByPartAsync(string partId)
⋮----
public virtual async Task<Model_Dao_Result<int>> InsertAsync(string partId, string inventoryMethod, string notes, string user)
⋮----
var pNewId = new MySqlParameter("@p_new_id", MySqlDbType.Int32)
⋮----
new MySqlParameter("@p_part_id", partId),
new MySqlParameter("@p_inventory_method", inventoryMethod),
new MySqlParameter("@p_notes", notes),
new MySqlParameter("@p_user", user),
⋮----
var result = await Helper_Database_StoredProcedure.ExecuteAsync(
⋮----
return Model_Dao_Result_Factory.Success<int>(Convert.ToInt32(pNewId.Value));
⋮----
public virtual async Task<Model_Dao_Result> UpdateAsync(int id, string inventoryMethod, string notes, string user)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
public virtual async Task<Model_Dao_Result> DeleteAsync(int id)
⋮----
private Model_InventoriedDunnage MapFromReader(IDataReader reader)
⋮----
return new Model_InventoriedDunnage
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
PartId = reader.GetString(reader.GetOrdinal("part_id")),
InventoryMethod = reader.IsDBNull(reader.GetOrdinal("inventory_method")) ? null : reader.GetString(reader.GetOrdinal("inventory_method")),
Notes = reader.IsDBNull(reader.GetOrdinal("notes")) ? null : reader.GetString(reader.GetOrdinal("notes")),
CreatedBy = reader.GetString(reader.GetOrdinal("created_by")),
CreatedDate = reader.GetDateTime(reader.GetOrdinal("created_date")),
ModifiedBy = reader.IsDBNull(reader.GetOrdinal("modified_by")) ? null : reader.GetString(reader.GetOrdinal("modified_by")),
ModifiedDate = reader.IsDBNull(reader.GetOrdinal("modified_date")) ? null : reader.GetDateTime(reader.GetOrdinal("modified_date"))
</file>

<file path="Module_Dunnage/ViewModels/ViewModel_Dunnage_ReviewViewModel.cs">
/// <summary>
/// ViewModel for Dunnage Review & Save
/// </summary>
public partial class ViewModel_Dunnage_Review : ViewModel_Shared_Base
⋮----
private readonly IService_DunnageWorkflow _workflowService;
private readonly IService_MySQL_Dunnage _dunnageService; private readonly IService_Help _helpService; private readonly IService_DunnageCSVWriter _csvWriter;
private readonly IService_Window _windowService;
⋮----
// Subscribe to workflow step changes to re-initialize when this step is reached
⋮----
private void OnWorkflowStepChanged(object? sender, EventArgs e)
⋮----
/// Load session loads for review
⋮----
public void LoadSessionLoads()
⋮----
SessionLoads.Clear();
⋮----
SessionLoads.Add(load);
⋮----
// Set up first entry for single view
⋮----
_logger.LogInfo($"Loaded {LoadCount} loads for review", "Review");
⋮----
_logger.LogError($"Error loading session loads: {ex.Message}", ex, "Review");
⋮----
private void UpdateNavigationButtons()
⋮----
private void SwitchToSingleView()
⋮----
_logger.LogInfo("Switched to Single View", "Review");
⋮----
private void SwitchToTableView()
⋮----
_logger.LogInfo("Switched to Table View", "Review");
⋮----
private void PreviousEntry()
⋮----
private void NextEntry()
⋮----
private async Task AddAnotherAsync()
⋮----
_logger.LogInfo("User requested to add another load", "Review");
⋮----
// Show confirmation dialog to prevent accidental data loss
⋮----
_logger.LogInfo("User cancelled add another load", "Review");
⋮----
// Save current session to CSV before clearing
⋮----
var saveResult = await _workflowService.SaveToCSVOnlyAsync();
⋮----
await _errorHandler.HandleErrorAsync(
⋮----
// Clear transient workflow data to prepare for new entry
⋮----
// Navigate back to Type Selection without clearing session loads
_workflowService.GoToStep(Enum_DunnageWorkflowStep.TypeSelection);
⋮----
_logger.LogInfo("Navigated to Type Selection for new load, workflow data cleared", "Review");
⋮----
_logger.LogError($"Error in AddAnotherAsync: {ex.Message}", ex);
⋮----
/// Shows confirmation dialog before clearing data for new entry
⋮----
private async Task<bool> ConfirmAddAnotherAsync()
⋮----
var xamlRoot = _windowService.GetXamlRoot();
⋮----
_logger.LogWarning("XamlRoot is null, proceeding without confirmation", "Review");
⋮----
var dialog = new ContentDialog
⋮----
var result = await dialog.ShowAsync();
⋮----
_logger.LogError($"Error showing confirmation dialog: {ex.Message}", ex, "Review");
return true; // Proceed if dialog fails
⋮----
/// Clears transient workflow data from intermediate steps (not the session loads)
/// This prevents data duplication when adding another load
⋮----
private void ClearTransientWorkflowData()
⋮----
// Clear the current session properties that hold form data
// but preserve the Loads collection (already reviewed loads)
⋮----
// Clear selection properties to start fresh
⋮----
// Preserve Loads collection - these are already reviewed
⋮----
// Clear UI inputs in connected ViewModels
⋮----
_logger.LogInfo("Transient workflow data and UI inputs cleared for new entry", "Review");
⋮----
_logger.LogError($"Error clearing transient workflow data: {ex.Message}", ex, "Review");
⋮----
/// Clears UI input properties in ViewModels to prepare for new entry
/// while preserving reviewed loads
⋮----
private void ClearUIInputsForNewEntry()
⋮----
// Clear TypeSelection ViewModel
⋮----
// Clear PartSelection ViewModel
⋮----
// Clear DetailsEntry ViewModel
⋮----
// Clear QuantityEntry ViewModel
⋮----
_logger.LogInfo("UI inputs cleared for new entry (loads preserved)", "Review");
⋮----
_logger.LogError($"Error clearing UI inputs: {ex.Message}", ex, "Review");
⋮----
private async Task SaveAllAsync()
⋮----
await _logger.LogInfoAsync($"Starting SaveAllAsync: {LoadCount} loads to save");
⋮----
// Save loads to database
var saveResult = await _dunnageService.SaveLoadsAsync(SessionLoads.ToList());
⋮----
await _logger.LogErrorAsync($"Failed to save {LoadCount} loads: {saveResult.ErrorMessage}");
await _errorHandler.HandleDaoErrorAsync(saveResult, "SaveAllAsync", true);
⋮----
await _logger.LogInfoAsync($"Successfully saved {LoadCount} loads to database");
⋮----
// Export to CSV
var csvResult = await _csvWriter.WriteToCSVAsync(SessionLoads.ToList());
⋮----
await _logger.LogWarningAsync($"CSV export failed for {LoadCount} loads: {csvResult.ErrorMessage}");
⋮----
// Continue anyway - database save was successful
⋮----
await _logger.LogInfoAsync($"Successfully exported {LoadCount} loads to CSV");
⋮----
// Show success message
⋮----
await _logger.LogInfoAsync($"Completed SaveAllAsync: {LoadCount} loads processed successfully");
⋮----
// Auto-navigation removed to allow user to see success message and choose next action
⋮----
await _logger.LogErrorAsync($"Exception in SaveAllAsync: {ex.Message}");
⋮----
private void StartNewEntry()
⋮----
// Clear session and return to Mode Selection
_workflowService.ClearSession();
_workflowService.GoToStep(Enum_DunnageWorkflowStep.ModeSelection);
⋮----
/// Shows contextual help for review
⋮----
private async Task ShowHelpAsync()
⋮----
await _helpService.ShowHelpAsync("Dunnage.Review");
⋮----
private void Cancel()
⋮----
_logger.LogInfo("Cancelling review, clearing session", "Review");
⋮----
/// Gets a tooltip by key from the help service
⋮----
/// <param name="key"></param>
public string GetTooltip(string key) => _helpService.GetTooltip(key);
⋮----
/// Gets a placeholder by key from the help service
⋮----
public string GetPlaceholder(string key) => _helpService.GetPlaceholder(key);
⋮----
/// Gets a tip by key from the help service
⋮----
public string GetTip(string key) => _helpService.GetTip(key);
</file>

<file path="Module_Dunnage/Views/View_Dunnage_WorkflowView.xaml">
<Page x:Class="MTM_Receiving_Application.Module_Dunnage.Views.View_Dunnage_WorkflowView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:viewmodels="using:MTM_Receiving_Application.Module_Dunnage.ViewModels"
      xmlns:views="using:MTM_Receiving_Application.Module_Dunnage.Views"
      xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
      mc:Ignorable="d">

    <Page.Resources>
        <converters:Converter_BooleanToVisibility x:Key="BooleanToVisibilityConverter" />
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Content Area -->
        <Grid Grid.Row="1"
              Margin="16,12,16,16">
            <!-- Mode Selection View -->
            <views:View_Dunnage_ModeSelectionView Visibility="{x:Bind ViewModel.IsModeSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />

            <!-- Wizard Steps -->
            <views:View_dunnage_typeselectionView Visibility="{x:Bind ViewModel.IsTypeSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />

            <views:View_Dunnage_PartSelectionView Visibility="{x:Bind ViewModel.IsPartSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />

            <views:View_Dunnage_QuantityEntryView Visibility="{x:Bind ViewModel.IsQuantityEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />

            <views:View_Dunnage_DetailsEntryView Visibility="{x:Bind ViewModel.IsDetailsEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />

            <views:View_Dunnage_ReviewView Visibility="{x:Bind ViewModel.IsReviewVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />

            <!-- Bulk Operation Views -->
            <views:View_Dunnage_ManualEntryView Visibility="{x:Bind ViewModel.IsManualEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />

            <views:View_Dunnage_EditModeView Visibility="{x:Bind ViewModel.IsEditModeVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
        </Grid>

        <!-- Navigation Buttons -->
        <Grid Grid.Row="2"
              Margin="24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Left-aligned buttons -->
            <StackPanel Grid.Column="0"
                        Orientation="Horizontal"
                        HorizontalAlignment="Left"
                        Spacing="12">
                <!-- Mode Selection Button (visible in wizard steps) -->
                <Button Content="Mode Selection"
                        Command="{x:Bind ViewModel.ReturnToModeSelectionCommand}"
                        ToolTipService.ToolTip="Return to mode selection (clears current work)"
                        Visibility="{x:Bind ViewModel.IsTypeSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
                <Button Content="Mode Selection"
                        Command="{x:Bind ViewModel.ReturnToModeSelectionCommand}"
                        ToolTipService.ToolTip="Return to mode selection (clears current work)"
                        Visibility="{x:Bind ViewModel.IsPartSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
                <Button Content="Mode Selection"
                        Command="{x:Bind ViewModel.ReturnToModeSelectionCommand}"
                        ToolTipService.ToolTip="Return to mode selection (clears current work)"
                        Visibility="{x:Bind ViewModel.IsQuantityEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
                <Button Content="Mode Selection"
                        Command="{x:Bind ViewModel.ReturnToModeSelectionCommand}"
                        ToolTipService.ToolTip="Return to mode selection (clears current work)"
                        Visibility="{x:Bind ViewModel.IsDetailsEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />

                <Button Content="Mode Selection"
                        Command="{x:Bind ViewModel.ReturnToModeSelectionCommand}"
                        ToolTipService.ToolTip="Return to mode selection (clears current work)"
                        Visibility="{x:Bind ViewModel.IsManualEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
                <Button Content="Mode Selection"
                        Command="{x:Bind ViewModel.ReturnToModeSelectionCommand}"
                        ToolTipService.ToolTip="Return to mode selection (clears current work)"
                        Visibility="{x:Bind ViewModel.IsEditModeVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
            </StackPanel>

            <!-- Center help button -->
            <Button Grid.Column="1"
                    HorizontalAlignment="Center"
                    Style="{StaticResource AccentButtonStyle}"
                    Padding="12,8"
                    Click="HelpButton_Click"
                    ToolTipService.ToolTip="Click for help about the current step">
                <StackPanel Orientation="Horizontal"
                            Spacing="8">
                    <FontIcon Glyph="&#xE946;"
                              FontSize="16" />
                    <TextBlock Text="Help" />
                </StackPanel>
            </Button>

            <!-- Right-aligned navigation buttons (wizard flow) -->
            <StackPanel Grid.Column="2"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        Spacing="12">
                <!-- Back Button (not visible on first wizard step) -->
                <Button Content="Back"
                        Visibility="{x:Bind ViewModel.IsPartSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                        Click="OnBackClick"
                        ToolTipService.ToolTip="Go back to previous step (Ctrl+Left)">
                    <Button.KeyboardAccelerators>
                        <KeyboardAccelerator Key="Left"
                                             Modifiers="Control" />
                    </Button.KeyboardAccelerators>
                </Button>
                <Button Content="Back"
                        Visibility="{x:Bind ViewModel.IsQuantityEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                        Click="OnBackClick"
                        ToolTipService.ToolTip="Go back to previous step (Ctrl+Left)">
                    <Button.KeyboardAccelerators>
                        <KeyboardAccelerator Key="Left"
                                             Modifiers="Control" />
                    </Button.KeyboardAccelerators>
                </Button>
                <Button Content="Back"
                        Visibility="{x:Bind ViewModel.IsDetailsEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                        Click="OnBackClick"
                        ToolTipService.ToolTip="Go back to previous step (Ctrl+Left)">
                    <Button.KeyboardAccelerators>
                        <KeyboardAccelerator Key="Left"
                                             Modifiers="Control" />
                    </Button.KeyboardAccelerators>
                </Button>

                <!-- Next Button (wizard flow) -->
                <Button Content="Next"
                        Style="{StaticResource AccentButtonStyle}"
                        Visibility="{x:Bind ViewModel.IsTypeSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                        Click="OnNextClick"
                        ToolTipService.ToolTip="Proceed to next step (Ctrl+Right)">
                    <Button.KeyboardAccelerators>
                        <KeyboardAccelerator Key="Right"
                                             Modifiers="Control" />
                    </Button.KeyboardAccelerators>
                </Button>
                <Button Content="Next"
                        Style="{StaticResource AccentButtonStyle}"
                        Visibility="{x:Bind ViewModel.IsPartSelectionVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                        Click="OnNextClick"
                        ToolTipService.ToolTip="Proceed to next step (Ctrl+Right)">
                    <Button.KeyboardAccelerators>
                        <KeyboardAccelerator Key="Right"
                                             Modifiers="Control" />
                    </Button.KeyboardAccelerators>
                </Button>
                <Button Content="Next"
                        Style="{StaticResource AccentButtonStyle}"
                        Visibility="{x:Bind ViewModel.IsQuantityEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                        Click="OnNextClick"
                        ToolTipService.ToolTip="Proceed to next step (Ctrl+Right)">
                    <Button.KeyboardAccelerators>
                        <KeyboardAccelerator Key="Right"
                                             Modifiers="Control" />
                    </Button.KeyboardAccelerators>
                </Button>
                <Button Content="Save &amp; Review"
                        Style="{StaticResource AccentButtonStyle}"
                        Visibility="{x:Bind ViewModel.IsDetailsEntryVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                        Click="OnSaveAndReviewClick"
                        ToolTipService.ToolTip="Save entry and proceed to review (Ctrl+Right)">
                    <Button.KeyboardAccelerators>
                        <KeyboardAccelerator Key="Right"
                                             Modifiers="Control" />
                    </Button.KeyboardAccelerators>
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
</Page>
</file>

<file path="Module_Dunnage/Views/View_Dunnage_WorkflowView.xaml.cs">
public sealed partial class View_Dunnage_WorkflowView : Page
⋮----
private readonly IService_Focus _focusService;
⋮----
// Subscribe to workflow step changes
⋮----
_focusService.AttachFocusOnVisibility(this);
⋮----
private void OnWorkflowStepChanged(object? sender, EventArgs e)
⋮----
// No need to update flyout content anymore - help dialog shows current step
⋮----
private async void HelpButton_Click(object sender, RoutedEventArgs e)
⋮----
// Show help dialog for current step
⋮----
private async System.Threading.Tasks.Task ShowHelpForCurrentStepAsync()
⋮----
await _helpService.ShowContextualHelpAsync(_workflowService.CurrentStep);
⋮----
private async void OnNextClick(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
⋮----
var result = await workflowService.AdvanceToNextStepAsync();
⋮----
// Show error message
var dialog = new ContentDialog
⋮----
var dialogResult = await dialog.ShowAsync();
⋮----
private async void OnSaveAndReviewClick(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
⋮----
// Show confirmation dialog
var confirmDialog = new ContentDialog
⋮----
var confirmResult = await confirmDialog.ShowAsync();
⋮----
// User confirmed, proceed to next step
⋮----
var errorDialog = new ContentDialog
⋮----
await errorDialog.ShowAsync();
⋮----
private void OnBackClick(object sender, Microsoft.UI.Xaml.RoutedEventArgs e)
⋮----
// Navigate back based on current step
⋮----
workflowService.GoToStep(Enum_DunnageWorkflowStep.TypeSelection);
⋮----
workflowService.GoToStep(Enum_DunnageWorkflowStep.PartSelection);
⋮----
workflowService.GoToStep(Enum_DunnageWorkflowStep.QuantityEntry);
⋮----
workflowService.GoToStep(Enum_DunnageWorkflowStep.DetailsEntry);
</file>

<file path="Module_Receiving/Data/Dao_ReceivingLine.cs">
/// <summary>
/// Data Access Object for receiving_label_data table
/// Provides CRUD operations using stored procedures
/// </summary>
public class Dao_ReceivingLine
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Inserts a new receiving line record into the database
⋮----
/// <param name="line">ReceivingLine model to insert</param>
/// <returns>Model_Dao_Result with success status and affected rows</returns>
public async Task<Model_Dao_Result> InsertReceivingLineAsync(Model_ReceivingLine line)
⋮----
// Prepare stored procedure parameters
⋮----
new MySqlParameter("@p_Quantity", line.Quantity),
new MySqlParameter("@p_PartID", line.PartID ?? string.Empty),
new MySqlParameter("@p_PONumber", line.PONumber),
new MySqlParameter("@p_EmployeeNumber", line.EmployeeNumber),
new MySqlParameter("@p_Heat", line.Heat ?? string.Empty),
new MySqlParameter("@p_Date", line.Date),
new MySqlParameter("@p_InitialLocation", line.InitialLocation ?? string.Empty),
new MySqlParameter("@p_CoilsOnSkid", (object?)line.CoilsOnSkid ?? DBNull.Value),
new MySqlParameter("@p_VendorName", line.VendorName ?? "Unknown"),
new MySqlParameter("@p_PartDescription", line.PartDescription ?? string.Empty),
new MySqlParameter("@p_Status", MySqlDbType.Int32) { Direction = System.Data.ParameterDirection.Output },
new MySqlParameter("@p_ErrorMsg", MySqlDbType.VarChar, 500) { Direction = System.Data.ParameterDirection.Output }
⋮----
// Validate parameters
if (!Helper_Database_StoredProcedure.ValidateParameters(parameters))
⋮----
return new Model_Dao_Result
⋮----
// Execute stored procedure
var result = await Helper_Database_StoredProcedure.ExecuteAsync(
</file>

<file path="Module_Routing/Converters/IntToFontWeightConverter.cs">
public class IntToFontWeightConverter : IValueConverter
⋮----
public object Convert(object? value, Type targetType, object? parameter, string language)
⋮----
if (value is int currentStep && parameter is string stepStr && int.TryParse(stepStr, out int step))
⋮----
public object ConvertBack(object? value, Type targetType, object? parameter, string language)
⋮----
throw new NotImplementedException();
</file>

<file path="Module_Routing/Converters/IntToProgressBrushConverter.cs">
public class IntToProgressBrushConverter : IValueConverter
⋮----
public object Convert(object? value, Type targetType, object? parameter, string language)
⋮----
if (value is int currentStep && parameter is string stepStr && int.TryParse(stepStr, out int step))
⋮----
public object ConvertBack(object? value, Type targetType, object? parameter, string language)
⋮----
throw new NotImplementedException();
</file>

<file path="Module_Routing/Converters/NullToBooleanConverter.cs">
public class NullToBooleanConverter : IValueConverter
⋮----
public object Convert(object? value, Type targetType, object? parameter, string language)
⋮----
public object ConvertBack(object? value, Type targetType, object? parameter, string language)
⋮----
throw new NotImplementedException();
</file>

<file path="Module_Routing/Data/Dao_RoutingOtherReason.cs">
/// <summary>
/// Data Access Object for routing_po_alternatives table
/// </summary>
public class Dao_RoutingOtherReason
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Retrieves all active other reasons
⋮----
public async Task<Model_Dao_Result<List<Model_RoutingOtherReason>>> GetAllActiveReasonsAsync()
⋮----
private Model_RoutingOtherReason MapFromReader(IDataReader reader)
⋮----
return new Model_RoutingOtherReason
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
ReasonCode = reader.GetString(reader.GetOrdinal("reason_code")),
Description = reader.GetString(reader.GetOrdinal("description")),
IsActive = reader.GetBoolean(reader.GetOrdinal("is_active")),
DisplayOrder = reader.GetInt32(reader.GetOrdinal("display_order"))
</file>

<file path="Module_Routing/Data/Dao_RoutingUsageTracking.cs">
/// <summary>
/// Data Access Object for routing_recipient_tracker table
/// </summary>
public class Dao_RoutingUsageTracking
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Increments usage count for employee-recipient pair
⋮----
/// <param name="employeeNumber"></param>
/// <param name="recipientId"></param>
public async Task<Model_Dao_Result> IncrementUsageAsync(int employeeNumber, int recipientId)
⋮----
new MySqlParameter("@p_employee_number", employeeNumber),
new MySqlParameter("@p_recipient_id", recipientId),
new MySqlParameter("@p_status", MySqlDbType.Int32) { Direction = System.Data.ParameterDirection.Output },
new MySqlParameter("@p_error_msg", MySqlDbType.VarChar, 500) { Direction = System.Data.ParameterDirection.Output }
⋮----
return await Helper_Database_StoredProcedure.ExecuteAsync(
⋮----
return Model_Dao_Result_Factory.Failure($"Error incrementing usage: {ex.Message}", ex);
</file>

<file path="Module_Routing/Data/Dao_RoutingUserPreference.cs">
/// <summary>
/// Data Access Object for settings_routing_personal table
/// </summary>
public class Dao_RoutingUserPreference
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Retrieves user preferences by employee number
⋮----
/// <param name="employeeNumber"></param>
public async Task<Model_Dao_Result<Model_RoutingUserPreference>> GetUserPreferenceAsync(int employeeNumber)
⋮----
/// Saves or updates user preferences
⋮----
/// <param name="preference"></param>
public async Task<Model_Dao_Result> SaveUserPreferenceAsync(Model_RoutingUserPreference preference)
⋮----
new MySqlParameter("@p_employee_number", preference.EmployeeNumber),
new MySqlParameter("@p_default_mode", preference.DefaultMode),
new MySqlParameter("@p_enable_validation", preference.EnableValidation),
new MySqlParameter("@p_status", MySqlDbType.Int32) { Direction = System.Data.ParameterDirection.Output },
new MySqlParameter("@p_error_msg", MySqlDbType.VarChar, 500) { Direction = System.Data.ParameterDirection.Output }
⋮----
return await Helper_Database_StoredProcedure.ExecuteAsync(
⋮----
return Model_Dao_Result_Factory.Failure($"Error saving user preference: {ex.Message}", ex);
⋮----
private Model_RoutingUserPreference MapFromReader(IDataReader reader)
⋮----
return new Model_RoutingUserPreference
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
EmployeeNumber = reader.GetInt32(reader.GetOrdinal("employee_number")),
DefaultMode = reader.GetString(reader.GetOrdinal("default_mode")),
EnableValidation = reader.GetBoolean(reader.GetOrdinal("enable_validation")),
UpdatedDate = reader.GetDateTime(reader.GetOrdinal("updated_date"))
</file>

<file path="Module_Routing/Enums/Enum_Routing_WorkflowStep.cs">
/// <summary>
/// Workflow steps for the routing label workflow
/// </summary>
⋮----
/// Mode selection screen to choose between Wizard, Manual, or History
⋮----
/// Label entry screen with data grid for creating routing labels (Manual Mode)
⋮----
/// Wizard mode for step-by-step label creation
⋮----
/// Review screen to verify label data before printing
⋮----
/// Print/export screen for generating CSV and printing labels
⋮----
/// History view showing archived labels grouped by date
</file>

<file path="Module_Routing/Models/Model_InforVisualPOLine.cs">
/// <summary>
/// Represents PO and line information from Infor Visual ERP
/// Used for PO validation and description retrieval
/// This is NOT a database table - it's returned from Infor Visual queries
/// </summary>
public class Model_InforVisualPOLine
⋮----
/// Purchase order number
⋮----
/// Line item number
⋮----
/// Part/material ID from Visual
⋮----
/// Part description from Visual
⋮----
/// Ordered quantity
⋮----
/// Received quantity (to date)
⋮----
/// Remaining quantity (ordered - received)
⋮----
/// Formatted quantity for display (trims trailing zeros)
/// Uses G29 format to strip trailing zeros while preserving up to 29 significant digits
/// Example: 4.0000 -> 4, 4.6140 -> 4.614
⋮----
public string QuantityOrderedDisplay => QuantityOrdered.ToString("G29");
⋮----
/// Vendor name
⋮----
/// Full specification text from PURC_LINE_BINARY
⋮----
/// Truncated specification text for grid display (first 50 chars)
⋮----
? Specifications.Substring(0, 50) + "..."
⋮----
/// Expected delivery date (nullable)
⋮----
/// Work Order ID (if linked)
⋮----
/// Customer Order ID (if linked)
⋮----
/// Formatted reference info for UI (WO or CO)
⋮----
if (!string.IsNullOrEmpty(WorkOrder)) return $"WO: {WorkOrder}";
if (!string.IsNullOrEmpty(CustomerOrder)) return $"CO: {CustomerOrder}";
</file>

<file path="Module_Routing/Models/Model_RoutingLabel.cs">
/// <summary>
/// Represents an internal routing label for packages/materials
/// Maps to routing_label_data database table
/// </summary>
public class Model_RoutingLabel
⋮----
/// Auto-increment primary key
⋮----
/// Purchase order number or "OTHER" for non-PO packages
⋮----
/// Line item number or "0" for OTHER packages
⋮----
/// Part/material description (from Infor Visual or manual entry)
⋮----
/// Foreign key to routing_recipients table
⋮----
/// Recipient name (from JOIN, not stored in table)
⋮----
/// Recipient location (from JOIN, not stored in table)
⋮----
/// Quantity of items on label
⋮----
/// Employee number who created the label
⋮----
/// Label creation timestamp
⋮----
/// Foreign key to routing_po_alternatives table (nullable, required if PONumber='OTHER')
⋮----
/// Other reason description (from JOIN, not stored in table)
⋮----
/// Soft delete flag (0=deleted, 1=active)
⋮----
/// Work Order ID (if linked) - Not stored in DB currently, used for CSV
⋮----
/// Customer Order ID (if linked) - Not stored in DB currently, used for CSV
⋮----
/// Whether label has been exported to CSV file
⋮----
/// Timestamp of CSV export (nullable)
</file>

<file path="Module_Routing/Services/IRoutingRecipientService.cs">
/// <summary>
/// Service interface for recipient management: retrieval, sorting, filtering
/// </summary>
public interface IRoutingRecipientService
⋮----
/// Retrieves all active recipients sorted by usage count (personalized for employee)
⋮----
/// <param name="employeeNumber">Employee number for personalized sorting</param>
/// <returns>Result with list of active recipients sorted by usage count DESC</returns>
public Task<Model_Dao_Result<List<Model_RoutingRecipient>>> GetActiveRecipientsSortedByUsageAsync(int employeeNumber);
⋮----
/// Retrieves all recipients (including inactive) for admin purposes
⋮----
/// <returns>Result with list of all recipients</returns>
public Task<Model_Dao_Result<List<Model_RoutingRecipient>>> GetAllRecipientsAsync();
⋮----
/// Retrieves a single recipient by ID
⋮----
/// <param name="recipientId">Recipient ID to retrieve</param>
/// <returns>Result with recipient data or error</returns>
public Task<Model_Dao_Result<Model_RoutingRecipient>> GetRecipientByIdAsync(int recipientId);
⋮----
/// Filters recipients by search text (name, location, department)
⋮----
/// <param name="recipients">Full list of recipients to filter</param>
/// <param name="searchText">Search text (case-insensitive)</param>
/// <returns>Filtered list of recipients</returns>
public List<Model_RoutingRecipient> FilterRecipients(List<Model_RoutingRecipient> recipients, string searchText);
⋮----
/// Calculates top 5 Quick Add recipients for employee
⋮----
/// <param name="employeeNumber">Employee number</param>
/// <returns>Result with top 5 recipients (personalized if employee has 20+ labels, otherwise system-wide)</returns>
public Task<Model_Dao_Result<List<Model_RoutingRecipient>>> GetQuickAddRecipientsAsync(int employeeNumber);
⋮----
/// Validates that a recipient ID exists and is active (Issue #9: FK validation)
⋮----
/// <param name="recipientId">Recipient ID to validate</param>
/// <returns>Result with true if recipient exists and is active, false otherwise</returns>
public Task<Model_Dao_Result<bool>> ValidateRecipientExistsAsync(int recipientId);
</file>

<file path="Module_Routing/Services/RoutingRecipientService.cs">
/// <summary>
/// Service for recipient management with smart sorting and Quick Add logic
/// </summary>
public class RoutingRecipientService : IRoutingRecipientService
⋮----
private readonly Dao_RoutingRecipient _daoRecipient;
private readonly IService_LoggingUtility _logger;
⋮----
_daoRecipient = daoRecipient ?? throw new ArgumentNullException(nameof(daoRecipient));
_logger = logger ?? throw new ArgumentNullException(nameof(logger));
⋮----
public async Task<Model_Dao_Result<List<Model_RoutingRecipient>>> GetActiveRecipientsSortedByUsageAsync(int employeeNumber)
⋮----
await _logger.LogInfoAsync($"Getting active recipients sorted by usage for employee {employeeNumber}");
return await _daoRecipient.GetAllActiveRecipientsAsync();
⋮----
await _logger.LogErrorAsync($"Error getting active recipients: {ex.Message}", ex);
⋮----
/// Retrieves all active recipients
⋮----
/// <returns>Result with list of all active recipients</returns>
public async Task<Model_Dao_Result<List<Model_RoutingRecipient>>> GetAllRecipientsAsync()
⋮----
await _logger.LogInfoAsync("Getting all recipients (including inactive)");
return await _daoRecipient.GetAllActiveRecipientsAsync(); // Note: DAO only returns active - would need new method for all
⋮----
// Issue #11: Standardized error handling pattern
await _logger.LogErrorAsync($"Error getting all recipients: {ex.Message}", ex);
⋮----
public async Task<Model_Dao_Result<Model_RoutingRecipient>> GetRecipientByIdAsync(int recipientId)
⋮----
await _logger.LogInfoAsync($"Getting recipient by ID: {recipientId}");
⋮----
var result = await _daoRecipient.GetAllActiveRecipientsAsync();
⋮----
return Model_Dao_Result_Factory.Success(recipient);
⋮----
await _logger.LogErrorAsync($"Error getting recipient {recipientId}: {ex.Message}", ex);
⋮----
public List<Model_RoutingRecipient> FilterRecipients(List<Model_RoutingRecipient> recipients, string searchText)
⋮----
if (string.IsNullOrWhiteSpace(searchText))
⋮----
var search = searchText.ToLowerInvariant();
⋮----
return recipients.Where(r =>
r.Name.ToLowerInvariant().Contains(search) ||
(r.Location?.ToLowerInvariant().Contains(search) ?? false) ||
(r.Department?.ToLowerInvariant().Contains(search) ?? false)
).ToList();
⋮----
public async Task<Model_Dao_Result<List<Model_RoutingRecipient>>> GetQuickAddRecipientsAsync(int employeeNumber)
⋮----
await _logger.LogInfoAsync($"Getting Quick Add recipients for employee {employeeNumber}");
⋮----
// Dao_RoutingRecipient.GetTopByUsageAsync implements the 20-label threshold logic
return await _daoRecipient.GetTopRecipientsByUsageAsync(employeeNumber, 5);
⋮----
await _logger.LogErrorAsync($"Error getting Quick Add recipients: {ex.Message}", ex);
⋮----
public async Task<Model_Dao_Result<bool>> ValidateRecipientExistsAsync(int recipientId)
⋮----
return Model_Dao_Result_Factory.Success(recipientResult.IsSuccess);
⋮----
await _logger.LogErrorAsync($"Error validating recipient {recipientId}: {ex.Message}", ex);
</file>

<file path="Module_Routing/Services/RoutingUserPreferenceService.cs">
/// <summary>
/// Service for user preferences (default mode, validation toggle)
/// </summary>
public class RoutingUserPreferenceService : IRoutingUserPreferenceService
⋮----
private readonly Dao_RoutingUserPreference _daoUserPreference;
private readonly IService_LoggingUtility _logger;
⋮----
_daoUserPreference = daoUserPreference ?? throw new ArgumentNullException(nameof(daoUserPreference));
_logger = logger ?? throw new ArgumentNullException(nameof(logger));
⋮----
/// Retrieves user preferences for the specified employee
⋮----
/// <param name="employeeNumber">Employee number</param>
/// <returns>Result with user preference or null if not found</returns>
public async Task<Model_Dao_Result<Model_RoutingUserPreference>> GetUserPreferenceAsync(int employeeNumber)
⋮----
await _logger.LogInfoAsync($"Getting user preference for employee {employeeNumber}");
⋮----
var result = await _daoUserPreference.GetUserPreferenceAsync(employeeNumber);
⋮----
// Return defaults if no preference exists
var defaultPreference = new Model_RoutingUserPreference
⋮----
return Model_Dao_Result_Factory.Success(defaultPreference);
⋮----
// Issue #11: Standardized error handling pattern
await _logger.LogErrorAsync($"Error getting user preference for employee {employeeNumber}: {ex.Message}", ex);
⋮----
/// Saves or updates user preferences
⋮----
/// <param name="preference">User preference to save</param>
/// <returns>Result indicating success or failure</returns>
public async Task<Model_Dao_Result> SaveUserPreferenceAsync(Model_RoutingUserPreference preference)
⋮----
await _logger.LogInfoAsync($"Saving user preference for employee {preference.EmployeeNumber}");
⋮----
// Validate mode
⋮----
return Model_Dao_Result_Factory.Failure($"Invalid mode: {preference.DefaultMode}");
⋮----
return await _daoUserPreference.SaveUserPreferenceAsync(preference);
⋮----
await _logger.LogErrorAsync($"Error saving user preference: {ex.Message}", ex);
return Model_Dao_Result_Factory.Failure($"Error saving preferences: {ex.Message}", ex);
⋮----
/// Resets user preferences to default values
⋮----
public async Task<Model_Dao_Result> ResetToDefaultsAsync(int employeeNumber)
⋮----
await _logger.LogInfoAsync($"Resetting preferences to defaults for employee {employeeNumber}");
⋮----
return await _daoUserPreference.SaveUserPreferenceAsync(defaultPreference);
⋮----
await _logger.LogErrorAsync($"Error resetting preferences: {ex.Message}", ex);
return Model_Dao_Result_Factory.Failure($"Error resetting preferences: {ex.Message}", ex);
</file>

<file path="Module_Routing/ViewModels/RoutingEditModeViewModel.cs">
/// <summary>
/// ViewModel for Edit Mode - searchable history with edit dialog and reprint
/// </summary>
public partial class RoutingEditModeViewModel : ViewModel_Shared_Base
⋮----
private readonly IRoutingService _routingService;
private readonly IRoutingRecipientService _recipientService;
private readonly IService_UserSessionManager _sessionManager;
⋮----
/// Initialize by loading labels and recipients
⋮----
public async Task InitializeAsync()
⋮----
// Load all labels (limit 1000 for performance)
var labelsResult = await _routingService.GetAllLabelsAsync(limit: 1000, offset: 0);
⋮----
Labels.Clear();
⋮----
Labels.Add(label);
⋮----
// Load all recipients for edit dialog dropdown
var recipientsResult = await _recipientService.GetActiveRecipientsSortedByUsageAsync(0);
⋮----
AllRecipients.Clear();
⋮----
AllRecipients.Add(recipient);
⋮----
// Initialize filtered collection
⋮----
_errorHandler.HandleException(ex, Module_Core.Models.Enums.Enum_ErrorSeverity.Medium,
⋮----
/// Apply search filter to labels collection
⋮----
/// <param name="value"></param>
partial void OnSearchTextChanged(string value)
⋮----
private void ApplySearchFilter()
⋮----
FilteredLabels.Clear();
⋮----
// Issue #19: Optimized collection filtering - using ToList() to materialize before loop
var filtered = string.IsNullOrWhiteSpace(searchLower)
? Labels.ToList()
: Labels.Where(l =>
(l.PONumber?.ToLower().Contains(searchLower) ?? false) ||
(l.RecipientName?.ToLower().Contains(searchLower) ?? false) ||
(l.Description?.ToLower().Contains(searchLower) ?? false)
).ToList();
⋮----
FilteredLabels.Add(label);
⋮----
/// Edit selected label - to be called from dialog
⋮----
/// <param name="editedLabel"></param>
⋮----
private async Task SaveEditedLabelAsync(Model_RoutingLabel editedLabel)
⋮----
// Compare and log changes
⋮----
// Issue #13: Update label - Get current employee number from session
// Issue #7: Implemented using IService_UserSessionManager
⋮----
var updateResult = await _routingService.UpdateLabelAsync(editedLabel, currentEmployeeNumber);
⋮----
// Update in collection
var index = Labels.IndexOf(SelectedLabel);
⋮----
await _errorHandler.ShowUserErrorAsync(updateResult.ErrorMessage, "Update Failed", nameof(SaveEditedLabelAsync));
⋮----
/// Compare old and new label - history logging handled by RoutingService.UpdateLabelAsync
⋮----
/// <param name="oldLabel"></param>
/// <param name="newLabel"></param>
private async Task CompareAndLogChangesAsync(Model_RoutingLabel oldLabel, Model_RoutingLabel newLabel)
⋮----
// History logging is now handled automatically by RoutingService.UpdateLabelAsync
// This method is kept for potential future custom validation before save
⋮----
/// Reprint selected label (CSV export only, no DB update)
⋮----
private async Task ReprintLabelAsync()
⋮----
// Export single label to CSV
var exportResult = await _routingService.ExportLabelToCsvAsync(SelectedLabel);
⋮----
await _errorHandler.ShowUserErrorAsync(exportResult.ErrorMessage, "Reprint Failed", nameof(ReprintLabelAsync));
⋮----
_errorHandler.HandleException(ex, Module_Core.Models.Enums.Enum_ErrorSeverity.Low,
</file>

<file path="Module_Routing/ViewModels/RoutingManualEntryViewModel.cs">
/// <summary>
/// ViewModel for Manual Entry mode - batch label creation via DataGrid
/// </summary>
public partial class RoutingManualEntryViewModel : ViewModel_Shared_Base
⋮----
private readonly IRoutingService _routingService;
private readonly IRoutingInforVisualService _inforVisualService;
private readonly IRoutingRecipientService _recipientService;
private readonly IRoutingUsageTrackingService _usageTrackingService;
⋮----
/// Initialize - load recipients
⋮----
public async Task InitializeAsync()
⋮----
var recipientsResult = await _recipientService.GetAllRecipientsAsync();
⋮----
await _errorHandler.ShowUserErrorAsync(recipientsResult.ErrorMessage, "Load Failed", nameof(InitializeAsync));
⋮----
// Add initial blank row
⋮----
_errorHandler.HandleException(ex, Module_Core.Models.Enums.Enum_ErrorSeverity.Medium,
⋮----
/// Add new blank row to collection
⋮----
private void AddNewRow()
⋮----
var newLabel = new Model_RoutingLabel
⋮----
Labels.Add(newLabel);
⋮----
/// Delete selected row
⋮----
private void DeleteSelectedRow()
⋮----
Labels.Remove(SelectedLabel);
⋮----
private bool CanDeleteRow() => SelectedLabel != null && !IsBusy;
⋮----
/// Validate PO and populate Part info
/// Called from View's CellEditEnding event
⋮----
/// <param name="label"></param>
public async Task ValidatePOAsync(Model_RoutingLabel label)
⋮----
if (string.IsNullOrWhiteSpace(label.PONumber))
⋮----
var poResult = await _inforVisualService.ValidatePoNumberAsync(label.PONumber);
⋮----
var linesResult = await _inforVisualService.GetPoLinesAsync(label.PONumber);
⋮----
// If only one line, auto-populate
⋮----
var line = linesResult.Data.First();
⋮----
label.LineNumber = line.LineNumber.ToString();
⋮----
// Issue #13: Multi-line PO selection feature
// If PO has multiple lines, show dialog/grid for user to select specific line
// Requires: ViewModel_LineSelectionDialog with DataGrid of Model_InforVisualPOLine
// Priority: MEDIUM - Manual entry is alternate workflow, single-line POs are common
// Current behavior: Auto-selects if 1 line, leaves blank if multiple (user enters manually)
⋮----
// PO not found - user can treat as OTHER
⋮----
await _logger.LogErrorAsync($"Error validating PO: {ex.Message}", ex, nameof(ValidatePOAsync));
⋮----
/// Save all labels in batch
⋮----
private async Task SaveAllLabelsAsync()
⋮----
// Validate all rows
⋮----
await _errorHandler.ShowUserErrorAsync(string.Join("\n", validationErrors), "Validation Failed", nameof(SaveAllLabelsAsync));
⋮----
foreach (var label in Labels.ToList())
⋮----
// Create label
var createResult = await _routingService.CreateLabelAsync(label);
⋮----
// Increment usage tracking
⋮----
await _usageTrackingService.IncrementUsageCountAsync(
⋮----
await _logger.LogErrorAsync($"Failed to create label: {createResult.ErrorMessage}");
⋮----
// Issue #13: Batch CSV export after label creation
// ExportLabelsToCSVAsync method would combine multiple labels into single CSV file
// Each label is already exported individually via CreateLabelAsync background task
// Priority: LOW - Individual CSV export is functional, batch is optimization
// var exportResult = await _routingService.ExportLabelsToCSVAsync(Labels.ToList());
// if (!exportResult.IsSuccess)
// {
//     await _logger.LogWarningAsync($"CSV export failed: {exportResult.ErrorMessage}");
// }
⋮----
// Clear collection
Labels.Clear();
⋮----
// Add new blank row for next batch
⋮----
_errorHandler.HandleException(ex, Module_Core.Models.Enums.Enum_ErrorSeverity.Error,
⋮----
private bool CanSaveAll() => !IsBusy && Labels.Count > 0;
⋮----
private System.Collections.Generic.List<string> ValidateAllRows()
⋮----
if (string.IsNullOrWhiteSpace(label.PONumber) && !label.OtherReasonId.HasValue)
⋮----
errors.Add($"Row {rowNum}: PO Number or OTHER reason required");
⋮----
errors.Add($"Row {rowNum}: Recipient required");
⋮----
errors.Add($"Row {rowNum}: Quantity must be greater than 0");
⋮----
partial void OnSelectedLabelChanged(Model_RoutingLabel? value)
⋮----
DeleteSelectedRowCommand.NotifyCanExecuteChanged();
⋮----
partial void OnLabelsChanged(ObservableCollection<Model_RoutingLabel> value)
⋮----
SaveAllLabelsCommand.NotifyCanExecuteChanged();
</file>

<file path="Module_Routing/Views/RoutingModeSelectionView.xaml">
<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MTM_Receiving_Application.Module_Routing.Views.RoutingModeSelectionView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:viewmodels="using:MTM_Receiving_Application.Module_Routing.ViewModels"
    Loaded="OnPageLoaded">

    <Grid>
        <StackPanel Spacing="32" HorizontalAlignment="Center" VerticalAlignment="Center">
            <StackPanel Orientation="Horizontal" Spacing="24">
                
                <!-- Wizard Mode Column -->
                <StackPanel Spacing="12">
                    <Button Command="{x:Bind ViewModel.SelectWizardModeCommand}"
                            Width="280" Height="180"
                            Padding="20"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            AutomationProperties.Name="Wizard Mode">
                        <StackPanel Spacing="12">
                            <FontIcon Glyph="&#xE82D;" FontSize="48" Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                            <TextBlock Text="Wizard Mode" Style="{StaticResource SubtitleTextBlockStyle}" HorizontalAlignment="Center"/>
                            <TextBlock Text="Step-by-step guided workflow with Quick Add buttons."
                                       Style="{StaticResource BodyTextBlockStyle}"
                                       TextWrapping="Wrap"
                                       TextAlignment="Center"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Button>

                    <CheckBox 
                        Content="Set as default mode"
                        IsChecked="{x:Bind ViewModel.IsWizardDefault, Mode=TwoWay}"
                        Command="{x:Bind ViewModel.SetWizardAsDefaultCommand}"
                        CommandParameter="{Binding IsChecked, RelativeSource={RelativeSource Self}}"
                        HorizontalAlignment="Center"/>
                </StackPanel>

                <!-- Manual Entry Column -->
                <StackPanel Spacing="12">
                    <Button Command="{x:Bind ViewModel.SelectManualEntryModeCommand}"
                            Width="280" Height="180"
                            Padding="20"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            AutomationProperties.Name="Manual Entry Mode">
                        <StackPanel Spacing="12">
                            <FontIcon Glyph="&#xE745;" FontSize="48" Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                            <TextBlock Text="Manual Entry" Style="{StaticResource SubtitleTextBlockStyle}" HorizontalAlignment="Center"/>
                            <TextBlock Text="Batch entry using editable grid. Ideal for creating multiple labels quickly."
                                       Style="{StaticResource BodyTextBlockStyle}"
                                       TextWrapping="Wrap"
                                       TextAlignment="Center"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Button>
                    
                    <CheckBox Content="Set as default mode"
                              IsChecked="{x:Bind ViewModel.IsManualDefault, Mode=TwoWay}"
                              Command="{x:Bind ViewModel.SetManualAsDefaultCommand}"
                              CommandParameter="{Binding IsChecked, RelativeSource={RelativeSource Self}}"
                              HorizontalAlignment="Center"/>
                </StackPanel>

                <!-- Edit Mode Column -->
                <StackPanel Spacing="12">
                    <Button Command="{x:Bind ViewModel.SelectEditModeCommand}"
                            Width="280" Height="180"
                            Padding="20"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            AutomationProperties.Name="Edit Mode">
                        <StackPanel Spacing="12">
                            <FontIcon Glyph="&#xE70F;" FontSize="48" Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                            <TextBlock Text="Edit Mode" Style="{StaticResource SubtitleTextBlockStyle}" HorizontalAlignment="Center"/>
                            <TextBlock Text="Search and edit existing labels. Supports reprinting and audit trail."
                                       Style="{StaticResource BodyTextBlockStyle}"
                                       TextWrapping="Wrap"
                                       TextAlignment="Center"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Button>

                    <CheckBox Content="Set as default mode"
                              IsChecked="{x:Bind ViewModel.IsEditDefault, Mode=TwoWay}"
                              Command="{x:Bind ViewModel.SetEditAsDefaultCommand}"
                              CommandParameter="{Binding IsChecked, RelativeSource={RelativeSource Self}}"
                              HorizontalAlignment="Center"/>
                </StackPanel>
            </StackPanel>
        </StackPanel>
    </Grid>
</Page>
</file>

<file path="Module_Routing/Views/RoutingWizardContainerView.xaml">
<Page
    x:Class="MTM_Receiving_Application.Module_Routing.Views.RoutingWizardContainerView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:MTM_Receiving_Application.Module_Routing.ViewModels"
    xmlns:views="using:MTM_Receiving_Application.Module_Routing.Views"
    xmlns:converters="using:MTM_Receiving_Application.Module_Routing.Converters"
    xmlns:coreConverters="using:MTM_Receiving_Application.Module_Core.Converters">

    <Page.Resources>
        <converters:IntToFontWeightConverter x:Key="IntToFontWeightConverter"/>
        <converters:IntToProgressBrushConverter x:Key="IntToProgressBrushConverter"/>
        <coreConverters:Converter_IntToVisibility x:Key="IntToVisibilityConverter"/>
    </Page.Resources>

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header with Cancel Button -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0"
                       Text="Routing Label - Wizard Mode" 
                       Style="{StaticResource TitleTextBlockStyle}"/>

            <Button Grid.Column="1"
                    Content="Cancel"
                    Command="{x:Bind ViewModel.CancelCommand}"/>
        </Grid>

        <!-- Progress Indicator -->
        <StackPanel Grid.Row="1" Spacing="8">
            <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}" 
                       Style="{StaticResource SubtitleTextBlockStyle}"/>
            
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Step 1 Indicator -->
                <StackPanel Grid.Column="0" Spacing="4">
                    <Border Height="4" 
                            Background="{ThemeResource AccentFillColorDefaultBrush}"
                            CornerRadius="2"/>
                    <TextBlock Text="1. PO Selection" 
                               HorizontalAlignment="Center"
                               FontWeight="{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntToFontWeightConverter}, ConverterParameter=1}"/>
                </StackPanel>

                <!-- Step 2 Indicator -->
                <StackPanel Grid.Column="1" Spacing="4" Margin="8,0">
                    <Border Height="4" 
                            Background="{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntToProgressBrushConverter}, ConverterParameter=2}"
                            CornerRadius="2"/>
                    <TextBlock Text="2. Recipient" 
                               HorizontalAlignment="Center"
                               FontWeight="{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntToFontWeightConverter}, ConverterParameter=2}"/>
                </StackPanel>

                <!-- Step 3 Indicator -->
                <StackPanel Grid.Column="2" Spacing="4">
                    <Border Height="4" 
                            Background="{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntToProgressBrushConverter}, ConverterParameter=3}"
                            CornerRadius="2"/>
                    <TextBlock Text="3. Review" 
                               HorizontalAlignment="Center"
                               FontWeight="{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntToFontWeightConverter}, ConverterParameter=3}"/>
                </StackPanel>
            </Grid>
        </StackPanel>

        <!-- Step Content (UserControl hosting) -->
        <Grid Grid.Row="2">
            <!-- Step 1: PO Selection -->
            <views:RoutingWizardStep1View 
                Visibility="{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=1}"/>

            <!-- Step 2: Recipient Selection -->
            <views:RoutingWizardStep2View 
                Visibility="{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=2}"/>

            <!-- Step 3: Review -->
            <views:RoutingWizardStep3View 
                Visibility="{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=3}"/>
        </Grid>
    </Grid>
</Page>
</file>

<file path="Module_Routing/Views/RoutingWizardStep2View.xaml">
<Page
    x:Class="MTM_Receiving_Application.Module_Routing.Views.RoutingWizardStep2View"
    x:Name="RootPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:MTM_Receiving_Application.Module_Routing.ViewModels"
    xmlns:models="using:MTM_Receiving_Application.Module_Routing.Models"
    xmlns:coreConverters="using:MTM_Receiving_Application.Module_Core.Converters"
    Loaded="OnPageLoaded">

    <Page.Resources>
        <coreConverters:Converter_BooleanToVisibility x:Key="BooleanToVisibilityConverter"/>
        <coreConverters:Converter_IntToVisibility x:Key="IntToVisibilityConverter"/>
    </Page.Resources>

    <Grid Padding="20" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" 
                   Text="Step 2: Recipient Selection" 
                   Style="{StaticResource TitleTextBlockStyle}"/>

        <!-- Search Box -->
        <StackPanel Grid.Row="1" Spacing="8">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <FontIcon Glyph="&#xE721;" 
                         FontSize="16"
                         Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                <TextBlock Text="Search Recipients" 
                          Style="{ThemeResource BodyStrongTextBlockStyle}"/>
            </StackPanel>
            <TextBox PlaceholderText="Search by name, location, or department"
                     Text="{x:Bind ViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
        </StackPanel>

        <!-- Recipients List -->
        <Border Grid.Row="2" 
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="8">
            <ListView ItemsSource="{x:Bind ViewModel.FilteredRecipients, Mode=OneWay}"
                      SelectedItem="{x:Bind ViewModel.SelectedRecipient, Mode=TwoWay}"
                      SelectionMode="Single"
                      KeyDown="ListView_KeyDown">
                <ListView.HeaderTemplate>
                    <DataTemplate>
                        <Grid Padding="8" ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Name" FontWeight="SemiBold"/>
                            <TextBlock Grid.Column="1" Text="Location" FontWeight="SemiBold"/>
                            <TextBlock Grid.Column="2" Text="Department" FontWeight="SemiBold"/>
                        </Grid>
                    </DataTemplate>
                </ListView.HeaderTemplate>
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:Model_RoutingRecipient">
                        <Grid Padding="8" ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="{x:Bind Name}"/>
                            <TextBlock Grid.Column="1" Text="{x:Bind Location}"/>
                            <TextBlock Grid.Column="2" Text="{x:Bind Department}"/>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Border>

        <!-- Status Bar -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="12">
            <ProgressRing IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                          Width="20" Height="20"/>
            <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                       VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right">
            <Button Content="Back"
                    Command="{x:Bind ViewModel.NavigateBackToStep1Command}"
                    Visibility="{x:Bind ViewModel.IsEditingFromReview, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}"/>
            <Button Content="{x:Bind ViewModel.NavigationButtonText, Mode=OneWay}"
                    Command="{x:Bind ViewModel.ProceedToStep3Command}"
                    Style="{StaticResource AccentButtonStyle}"/>
        </StackPanel>
    </Grid>
</Page>
</file>

<file path="Module_Settings/Data/Dao_PackageTypeMappings.cs">
/// <summary>
/// Data Access Object for package type mappings (part prefix → package type)
/// Instance-based pattern with connection string injection
/// </summary>
public class Dao_PackageTypeMappings
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Retrieves all active package type mappings
⋮----
public async Task<Model_Dao_Result<List<Model_PackageTypeMapping>>> GetAllAsync()
⋮----
return await Helper_Database_StoredProcedure.ExecuteListAsync(
⋮----
/// Gets package type for a part prefix (with default fallback)
⋮----
/// <param name="partPrefix"></param>
public async Task<Model_Dao_Result<string>> GetByPrefixAsync(string partPrefix)
⋮----
return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
⋮----
reader => reader.IsDBNull(reader.GetOrdinal("package_type"))
⋮----
: reader.GetString(reader.GetOrdinal("package_type")),
⋮----
/// Inserts a new package type mapping
⋮----
/// <param name="mapping"></param>
/// <param name="createdBy"></param>
public async Task<Model_Dao_Result<int>> InsertAsync(Model_PackageTypeMapping mapping, int createdBy)
⋮----
var result = await Helper_Database_StoredProcedure.ExecuteSingleAsync(
⋮----
reader => reader.GetInt32(reader.GetOrdinal("id")),
⋮----
/// Updates an existing package type mapping
⋮----
public async Task<Model_Dao_Result> UpdateAsync(Model_PackageTypeMapping mapping)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
/// Deletes a package type mapping (soft delete)
⋮----
/// <param name="id"></param>
public async Task<Model_Dao_Result> DeleteAsync(int id)
⋮----
/// Maps database reader to Model_PackageTypeMapping
⋮----
/// <param name="reader"></param>
private static Model_PackageTypeMapping MapFromReader(IDataReader reader)
⋮----
return new Model_PackageTypeMapping
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
PartPrefix = reader.GetString(reader.GetOrdinal("part_prefix")),
PackageType = reader.GetString(reader.GetOrdinal("package_type")),
IsDefault = reader.GetBoolean(reader.GetOrdinal("is_default")),
DisplayOrder = reader.GetInt32(reader.GetOrdinal("display_order")),
IsActive = reader.GetBoolean(reader.GetOrdinal("is_active")),
CreatedAt = reader.GetDateTime(reader.GetOrdinal("created_at")),
UpdatedAt = reader.GetDateTime(reader.GetOrdinal("updated_at")),
CreatedBy = reader.IsDBNull(reader.GetOrdinal("created_by")) ? null : reader.GetInt32(reader.GetOrdinal("created_by"))
</file>

<file path="Module_Settings/Data/Dao_ScheduledReport.cs">
/// <summary>
/// Data Access Object for scheduled reports CRUD operations
/// Instance-based pattern with connection string injection
/// </summary>
public class Dao_ScheduledReport
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Retrieves all active scheduled reports
⋮----
public async Task<Model_Dao_Result<List<Model_ScheduledReport>>> GetAllAsync()
⋮----
return await Helper_Database_StoredProcedure.ExecuteListAsync(
⋮----
/// Retrieves a scheduled report by ID
⋮----
/// <param name="id"></param>
public async Task<Model_Dao_Result<Model_ScheduledReport>> GetByIdAsync(int id)
⋮----
return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
⋮----
/// Retrieves scheduled reports that are due for execution
⋮----
public async Task<Model_Dao_Result<List<Model_ScheduledReport>>> GetDueAsync()
⋮----
/// Retrieves active scheduled reports that have a next run date (spec compatibility)
⋮----
public async Task<Model_Dao_Result<List<Model_ScheduledReport>>> GetActiveAsync()
⋮----
/// Inserts a new scheduled report
⋮----
/// <param name="report"></param>
/// <param name="createdBy"></param>
public async Task<Model_Dao_Result<int>> InsertAsync(Model_ScheduledReport report, int createdBy)
⋮----
reader => reader.GetInt32(reader.GetOrdinal("id")),
⋮----
/// Updates an existing scheduled report
⋮----
public async Task<Model_Dao_Result> UpdateAsync(Model_ScheduledReport report)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
/// Updates the last run date and calculates next run date
⋮----
/// <param name="lastRunDate"></param>
/// <param name="nextRunDate"></param>
public async Task<Model_Dao_Result> UpdateLastRunAsync(int id, DateTime lastRunDate, DateTime nextRunDate)
⋮----
/// Deletes a scheduled report (soft delete)
⋮----
public async Task<Model_Dao_Result> DeleteAsync(int id)
⋮----
/// Toggles a scheduled report's active status
⋮----
/// <param name="isActive"></param>
public async Task<Model_Dao_Result> ToggleActiveAsync(int id, bool isActive)
⋮----
/// Maps database reader to Model_ScheduledReport
⋮----
/// <param name="reader"></param>
private static Model_ScheduledReport MapFromReader(IDataReader reader)
⋮----
return new Model_ScheduledReport
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
ReportType = reader.GetString(reader.GetOrdinal("report_type")),
Schedule = reader.GetString(reader.GetOrdinal("schedule")),
EmailRecipients = reader.IsDBNull(reader.GetOrdinal("email_recipients")) ? null : reader.GetString(reader.GetOrdinal("email_recipients")),
IsActive = reader.GetBoolean(reader.GetOrdinal("is_active")),
NextRunDate = reader.IsDBNull(reader.GetOrdinal("next_run_date")) ? null : reader.GetDateTime(reader.GetOrdinal("next_run_date")),
LastRunDate = reader.IsDBNull(reader.GetOrdinal("last_run_date")) ? null : reader.GetDateTime(reader.GetOrdinal("last_run_date")),
CreatedAt = reader.GetDateTime(reader.GetOrdinal("created_at")),
UpdatedAt = reader.GetDateTime(reader.GetOrdinal("updated_at")),
CreatedBy = reader.IsDBNull(reader.GetOrdinal("created_by")) ? null : reader.GetInt32(reader.GetOrdinal("created_by"))
</file>

<file path="Module_Settings/Data/Dao_SystemSettings.cs">
/// <summary>
/// Data Access Object for system settings operations
/// Instance-based pattern with connection string injection
/// </summary>
public class Dao_SystemSettings
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Retrieves all system settings ordered by category and UI order
⋮----
public async Task<Model_Dao_Result<List<Model_SystemSetting>>> GetAllAsync()
⋮----
return await Helper_Database_StoredProcedure.ExecuteListAsync(
⋮----
/// Retrieves system settings for a specific category
⋮----
/// <param name="category"></param>
public async Task<Model_Dao_Result<List<Model_SystemSetting>>> GetByCategoryAsync(string category)
⋮----
/// Retrieves a single system setting by category and key
⋮----
/// <param name="settingKey"></param>
public async Task<Model_Dao_Result<Model_SystemSetting>> GetByKeyAsync(string category, string settingKey)
⋮----
return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
⋮----
/// Updates a system setting value with audit logging
⋮----
/// <param name="settingId"></param>
/// <param name="newValue"></param>
/// <param name="changedBy"></param>
/// <param name="ipAddress"></param>
/// <param name="workstationName"></param>
public async Task<Model_Dao_Result> UpdateValueAsync(
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
/// Resets a system setting to its default value
⋮----
public async Task<Model_Dao_Result> ResetToDefaultAsync(
⋮----
/// Locks or unlocks a system setting to prevent modification
⋮----
/// <param name="isLocked"></param>
⋮----
public async Task<Model_Dao_Result> SetLockedAsync(
⋮----
/// Maps a database reader row to a Model_SystemSetting object
⋮----
/// <param name="reader"></param>
private static Model_SystemSetting MapFromReader(IDataReader reader)
⋮----
return new Model_SystemSetting
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
Category = reader.GetString(reader.GetOrdinal("category")),
SubCategory = reader.IsDBNull(reader.GetOrdinal("sub_category")) ? null : reader.GetString(reader.GetOrdinal("sub_category")),
SettingKey = reader.GetString(reader.GetOrdinal("setting_key")),
SettingName = reader.GetString(reader.GetOrdinal("setting_name")),
Description = reader.IsDBNull(reader.GetOrdinal("description")) ? null : reader.GetString(reader.GetOrdinal("description")),
SettingValue = reader.IsDBNull(reader.GetOrdinal("setting_value")) ? null : reader.GetString(reader.GetOrdinal("setting_value")),
DefaultValue = reader.IsDBNull(reader.GetOrdinal("default_value")) ? null : reader.GetString(reader.GetOrdinal("default_value")),
DataType = reader.GetString(reader.GetOrdinal("data_type")),
Scope = reader.GetString(reader.GetOrdinal("scope")),
PermissionLevel = reader.GetString(reader.GetOrdinal("permission_level")),
IsLocked = reader.GetBoolean(reader.GetOrdinal("is_locked")),
IsSensitive = reader.GetBoolean(reader.GetOrdinal("is_sensitive")),
ValidationRules = reader.IsDBNull(reader.GetOrdinal("validation_rules")) ? null : reader.GetString(reader.GetOrdinal("validation_rules")),
UiControlType = reader.GetString(reader.GetOrdinal("ui_control_type")),
UiOrder = reader.GetInt32(reader.GetOrdinal("ui_order")),
CreatedAt = reader.GetDateTime(reader.GetOrdinal("created_at")),
UpdatedAt = reader.GetDateTime(reader.GetOrdinal("updated_at")),
UpdatedBy = reader.IsDBNull(reader.GetOrdinal("updated_by")) ? null : reader.GetInt32(reader.GetOrdinal("updated_by"))
</file>

<file path="Module_Settings/Data/Dao_UserSettings.cs">
/// <summary>
/// Data Access Object for user settings operations (user preference overrides)
/// Instance-based pattern with connection string injection
/// </summary>
public class Dao_UserSettings
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Retrieves a user setting with fallback to system default
⋮----
/// <param name="userId"></param>
/// <param name="category"></param>
/// <param name="settingKey"></param>
public async Task<Model_Dao_Result<Model_SettingValue>> GetAsync(int userId, string category, string settingKey)
⋮----
var result = await Helper_Database_StoredProcedure.ExecuteSingleAsync(
⋮----
/// Retrieves all user settings for a specific user
⋮----
public async Task<Model_Dao_Result<List<Model_UserSetting>>> GetAllForUserAsync(int userId)
⋮----
return await Helper_Database_StoredProcedure.ExecuteListAsync(
⋮----
/// Sets a user setting override (creates or updates)
⋮----
/// <param name="settingId"></param>
/// <param name="value"></param>
public async Task<Model_Dao_Result> SetAsync(int userId, int settingId, string value)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
/// Resets a user setting to system default (removes override)
⋮----
public async Task<Model_Dao_Result> ResetAsync(int userId, int settingId)
⋮----
/// Resets all user settings for a user to system defaults
⋮----
/// <param name="changedBy"></param>
public async Task<Model_Dao_Result<int>> ResetAllAsync(int userId, int changedBy)
⋮----
// Execute and return count of reset settings
⋮----
reader => reader.GetInt32(reader.GetOrdinal("reset_count")),
⋮----
/// Maps database reader to Model_SettingValue for effective value retrieval
⋮----
/// <param name="reader"></param>
private static Model_SettingValue MapToSettingValue(IDataReader reader)
⋮----
return new Model_SettingValue
⋮----
RawValue = reader.IsDBNull(reader.GetOrdinal("effective_value"))
⋮----
: reader.GetString(reader.GetOrdinal("effective_value")),
DataType = reader.GetString(reader.GetOrdinal("data_type"))
⋮----
/// Maps database reader to Model_UserSetting
⋮----
private static Model_UserSetting MapFromReader(IDataReader reader)
⋮----
return new Model_UserSetting
⋮----
Id = reader.GetInt32(reader.GetOrdinal("setting_id")),
UserId = -1, // Will be set from context
SettingId = reader.GetInt32(reader.GetOrdinal("setting_id")),
SettingValue = reader.IsDBNull(reader.GetOrdinal("user_override"))
⋮----
: reader.GetString(reader.GetOrdinal("user_override")),
SystemSetting = new Model_SystemSetting
⋮----
Category = reader.GetString(reader.GetOrdinal("category")),
SettingKey = reader.GetString(reader.GetOrdinal("setting_key")),
SettingName = reader.GetString(reader.GetOrdinal("setting_name")),
SettingValue = reader.IsDBNull(reader.GetOrdinal("system_default"))
⋮----
: reader.GetString(reader.GetOrdinal("system_default")),
DataType = reader.GetString(reader.GetOrdinal("data_type")),
UiControlType = reader.GetString(reader.GetOrdinal("ui_control_type"))
</file>

<file path="Module_Settings/Models/Model_PackageType.cs">
/// <summary>
/// Represents a package type definition for receiving operations
/// Database Table: dunnage_types
/// </summary>
public partial class Model_PackageType : ObservableObject
⋮----
private DateTime _createdAt;
⋮----
private DateTime _updatedAt;
</file>

<file path="Module_Settings/Models/Model_PackageTypeMapping.cs">
/// <summary>
/// Represents a mapping from part prefix to package type
/// Database Table: receiving_package_type_mapping
/// </summary>
public partial class Model_PackageTypeMapping : ObservableObject
⋮----
private DateTime _createdAt;
⋮----
private DateTime _updatedAt;
</file>

<file path="Module_Settings/Models/Model_RoutingRule.cs">
/// <summary>
/// Represents an auto-routing rule with pattern matching
/// Database Table: routing_home_locations
/// </summary>
public partial class Model_RoutingRule : ObservableObject
⋮----
private DateTime _createdAt;
⋮----
private DateTime _updatedAt;
</file>

<file path="Module_Settings/Models/Model_ScheduledReport.cs">
/// <summary>
/// Represents a scheduled report configuration
/// Database Table: reporting_scheduled_reports
/// </summary>
public partial class Model_ScheduledReport : ObservableObject
⋮----
private DateTime _createdAt;
⋮----
private DateTime _updatedAt;
</file>

<file path="Module_Settings/Models/Model_SettingsAuditLog.cs">
/// <summary>
/// Represents an audit log entry for settings changes
/// Database Table: settings_activity
/// </summary>
public partial class Model_SettingsAuditLog : ObservableObject
⋮----
private DateTime _changedAt;
⋮----
// Navigation properties
</file>

<file path="Module_Settings/Models/Model_SystemSetting.cs">
/// <summary>
/// Represents a system-wide configuration setting
/// Database Table: settings_universal
/// </summary>
public partial class Model_SystemSetting : ObservableObject
⋮----
private string? _validationRules; // JSON
⋮----
private DateTime _createdAt;
⋮----
private DateTime _updatedAt;
</file>

<file path="Module_Settings/Models/Model_UserSetting.cs">
/// <summary>
/// Represents a user-specific override for a system setting
/// Database Table: settings_personal
/// </summary>
public partial class Model_UserSetting : ObservableObject
⋮----
private DateTime _createdAt;
⋮----
private DateTime _updatedAt;
⋮----
// Navigation property
</file>

<file path="Module_Settings/Views/View_Settings_DatabaseTest.xaml">
<?xml version="1.0" encoding="utf-8"?>
<Page x:Class="MTM_Receiving_Application.Module_Settings.Views.View_Settings_DatabaseTest"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:icons="using:Material.Icons.WinUI3"
      xmlns:viewmodels="using:MTM_Receiving_Application.Module_Settings.ViewModels"
      xmlns:models="using:MTM_Receiving_Application.Module_Settings.Models"
      mc:Ignorable="d"
      Background="{ThemeResource LayerFillColorDefaultBrush}">

    <Grid Background="{ThemeResource LayerFillColorDefaultBrush}">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Spacing="20"
                        Margin="40,20,40,40">

                <!-- Header -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0"
                                Spacing="4">
                        <TextBlock Text="Settings Database Test"
                                   Style="{StaticResource TitleTextBlockStyle}" />
                        <TextBlock Text="Development Tool - Schema &amp; Stored Procedure Validation"
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    </StackPanel>

                    <Button Grid.Column="1"
                            Content="Refresh All Tests"
                            Command="{Binding RunAllTestsCommand}"
                            Style="{StaticResource AccentButtonStyle}"
                            Height="36"
                            Padding="20,0"
                            VerticalAlignment="Center">
                        <Button.KeyboardAccelerators>
                            <KeyboardAccelerator Key="F5" />
                        </Button.KeyboardAccelerators>
                    </Button>
                </Grid>

                <!-- Connection Status Card -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Database Connection"
                                   Style="{StaticResource SubtitleTextBlockStyle}" />

                        <!-- Success Status (use visible when connected) -->
                        <StackPanel Orientation="Horizontal"
                                    Spacing="12">
                            <Border Width="20"
                                    Height="20"
                                    CornerRadius="10"
                                    Background="#107c10">
                                <icons:MaterialIcon Kind="Check"
                                                    Width="14"
                                                    Height="14"
                                                    Foreground="White" />
                            </Border>
                            <TextBlock Text="{x:Bind ViewModel.ConnectionStatus, Mode=OneWay}"
                                       Foreground="#107c10"
                                       FontWeight="SemiBold" />
                        </StackPanel>

                        <TextBlock Text="Connection details"
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    </StackPanel>
                </Border>

                <!-- Summary Cards Row -->
                <Grid ColumnSpacing="20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Tables Card -->
                    <Border Grid.Column="0"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20"
                            MinHeight="120">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Tables"
                                       Style="{StaticResource BodyTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <StackPanel Orientation="Horizontal"
                                        Spacing="4">
                                <TextBlock Text="{x:Bind ViewModel.TablesValidated, Mode=OneWay}"
                                           FontSize="36"
                                           FontWeight="SemiBold"
                                           Foreground="#107c10" />
                                <TextBlock Text="/"
                                           FontSize="28"
                                           FontWeight="SemiBold"
                                           Foreground="#107c10"
                                           VerticalAlignment="Center" />
                                <TextBlock Text="{x:Bind ViewModel.TotalTables, Mode=OneWay}"
                                           FontSize="28"
                                           FontWeight="SemiBold"
                                           Foreground="#107c10"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                            <TextBlock Text="All tables validated"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <TextBlock Text="✓ Indexes OK"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="#107c10" />
                        </StackPanel>
                    </Border>

                    <!-- Stored Procedures Card -->
                    <Border Grid.Column="1"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20"
                            MinHeight="120">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Stored Procedures"
                                       Style="{StaticResource BodyTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <StackPanel Orientation="Horizontal"
                                        Spacing="4">
                                <TextBlock Text="{x:Bind ViewModel.StoredProceduresTested, Mode=OneWay}"
                                           FontSize="36"
                                           FontWeight="SemiBold"
                                           Foreground="#107c10" />
                                <TextBlock Text="/"
                                           FontSize="28"
                                           FontWeight="SemiBold"
                                           Foreground="#107c10"
                                           VerticalAlignment="Center" />
                                <TextBlock Text="{x:Bind ViewModel.TotalStoredProcedures, Mode=OneWay}"
                                           FontSize="28"
                                           FontWeight="SemiBold"
                                           Foreground="#107c10"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                            <TextBlock Text="All procedures tested"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <TextBlock Text="✓ No errors"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="#107c10" />
                        </StackPanel>
                    </Border>

                    <!-- Data Seeding Card -->
                    <Border Grid.Column="2"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20"
                            MinHeight="120">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Data Seeding"
                                       Style="{StaticResource BodyTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <TextBlock Text="{x:Bind ViewModel.SettingsSeeded, Mode=OneWay}"
                                       FontSize="36"
                                       FontWeight="SemiBold"
                                       Foreground="#107c10" />
                            <TextBlock Text="Settings inserted"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <TextBlock Text="✓ All categories"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="#107c10" />
                        </StackPanel>
                    </Border>

                    <!-- DAOs Card -->
                    <Border Grid.Column="3"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20"
                            MinHeight="120">
                        <StackPanel Spacing="8">
                            <TextBlock Text="DAO Tests"
                                       Style="{StaticResource BodyTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <StackPanel Orientation="Horizontal"
                                        Spacing="4">
                                <TextBlock Text="{x:Bind ViewModel.DaosTested, Mode=OneWay}"
                                           FontSize="36"
                                           FontWeight="SemiBold"
                                           Foreground="#107c10" />
                                <TextBlock Text="/"
                                           FontSize="28"
                                           FontWeight="SemiBold"
                                           Foreground="#107c10"
                                           VerticalAlignment="Center" />
                                <TextBlock Text="{x:Bind ViewModel.TotalDaos, Mode=OneWay}"
                                           FontSize="28"
                                           FontWeight="SemiBold"
                                           Foreground="#107c10"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                            <TextBlock Text="All DAOs operational"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <TextBlock Text="✓ CRUD verified"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="#107c10" />
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- Test Results Tabs -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!-- Tab Header -->
                        <Border Grid.Row="0"
                                BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                BorderThickness="0,0,0,1">
                            <StackPanel Orientation="Horizontal"
                                        Spacing="0"
                                        Height="48">
                                <Button Content="Schema Tests"
                                        x:Name="SchemaTabButton"
                                        MinWidth="150"
                                        Height="48"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        CornerRadius="0"
                                        Click="OnSchemaTabClick" />
                                <Button Content="SP Tests"
                                        x:Name="SpTabButton"
                                        MinWidth="150"
                                        Height="48"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        CornerRadius="0"
                                        Click="OnStoredProceduresTabClick" />
                                <Button Content="DAO Tests"
                                        x:Name="DaoTabButton"
                                        MinWidth="150"
                                        Height="48"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        CornerRadius="0"
                                        Click="OnDaosTabClick" />
                                <Button Content="Logs"
                                        x:Name="LogsTabButton"
                                        MinWidth="150"
                                        Height="48"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        CornerRadius="0"
                                        Click="OnLogsTabClick" />
                            </StackPanel>
                        </Border>

                        <!-- Tab Content -->
                        <ScrollViewer Grid.Row="1"
                                      MaxHeight="400"
                                      Padding="20">
                            <Grid>
                                <!-- Schema Tab -->
                                <StackPanel x:Name="SchemaTabContent"
                                            Spacing="16">
                                    <TextBlock Text="Table Validation Results"
                                               Style="{StaticResource SubtitleTextBlockStyle}" />

                                    <!-- Table Result Items -->
                                    <ItemsControl ItemsSource="{x:Bind ViewModel.TableResults, Mode=OneWay}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate x:DataType="models:Model_TableTestResult">
                                                <Border Background="{ThemeResource SubtleFillColorTransparentBrush}"
                                                        BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                                        BorderThickness="0,0,0,1"
                                                        Padding="12,8"
                                                        Margin="0,0,0,12">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>

                                                        <StackPanel Grid.Column="0"
                                                                    Orientation="Horizontal"
                                                                    Spacing="12"
                                                                    VerticalAlignment="Center">
                                                            <Border Width="20"
                                                                    Height="20"
                                                                    CornerRadius="10"
                                                                    Background="#107c10">
                                                                <icons:MaterialIcon Kind="Check"
                                                                                    Width="14"
                                                                                    Height="14"
                                                                                    Foreground="White" />
                                                            </Border>
                                                            <StackPanel Spacing="2">
                                                                <TextBlock Text="{x:Bind TableName}"
                                                                           FontWeight="SemiBold" />
                                                                <TextBlock Text="{x:Bind Details}"
                                                                           Style="{StaticResource CaptionTextBlockStyle}"
                                                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                                            </StackPanel>
                                                        </StackPanel>

                                                        <Border Grid.Column="2"
                                                                BorderBrush="#107c10"
                                                                BorderThickness="1"
                                                                CornerRadius="4"
                                                                Padding="12,4">
                                                            <TextBlock Text="{x:Bind StatusText}"
                                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                                       Foreground="#107c10" />
                                                        </Border>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <!-- Legacy hardcoded items removed -->
                                    <StackPanel Spacing="12"
                                                Visibility="Collapsed">

                                        <!-- Table 1: settings_universal -->
                                        <Border Background="{ThemeResource SubtleFillColorTransparentBrush}"
                                                BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                                BorderThickness="0,0,0,1"
                                                Padding="12,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0"
                                                            Orientation="Horizontal"
                                                            Spacing="12"
                                                            VerticalAlignment="Center">
                                                    <Border Width="20"
                                                            Height="20"
                                                            CornerRadius="10"
                                                            Background="#107c10">
                                                        <icons:MaterialIcon Kind="Check"
                                                                            Width="14"
                                                                            Height="14"
                                                                            Foreground="White" />
                                                    </Border>
                                                    <StackPanel Spacing="2">
                                                        <TextBlock Text="settings_universal"
                                                                   FontWeight="SemiBold" />
                                                        <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                                            <Run Text="79 rows | 18 columns | 3 indexes" />
                                                        </TextBlock>
                                                    </StackPanel>
                                                </StackPanel>

                                                <Border Grid.Column="2"
                                                        BorderBrush="#107c10"
                                                        BorderThickness="1"
                                                        CornerRadius="4"
                                                        Padding="12,4">
                                                    <TextBlock Text="Validated"
                                                               Style="{StaticResource CaptionTextBlockStyle}"
                                                               Foreground="#107c10" />
                                                </Border>
                                            </Grid>
                                        </Border>

                                        <!-- Table 2: settings_personal -->
                                        <Border Background="{ThemeResource SubtleFillColorTransparentBrush}"
                                                BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                                BorderThickness="0,0,0,1"
                                                Padding="12,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0"
                                                            Orientation="Horizontal"
                                                            Spacing="12"
                                                            VerticalAlignment="Center">
                                                    <Border Width="20"
                                                            Height="20"
                                                            CornerRadius="10"
                                                            Background="#107c10">
                                                        <icons:MaterialIcon Kind="Check"
                                                                            Width="14"
                                                                            Height="14"
                                                                            Foreground="White" />
                                                    </Border>
                                                    <StackPanel Spacing="2">
                                                        <TextBlock Text="settings_personal"
                                                                   FontWeight="SemiBold" />
                                                        <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                                            <Run Text="0 rows | 5 columns | 1 unique constraint" />
                                                        </TextBlock>
                                                    </StackPanel>
                                                </StackPanel>

                                                <Border Grid.Column="2"
                                                        BorderBrush="#107c10"
                                                        BorderThickness="1"
                                                        CornerRadius="4"
                                                        Padding="12,4">
                                                    <TextBlock Text="Validated"
                                                               Style="{StaticResource CaptionTextBlockStyle}"
                                                               Foreground="#107c10" />
                                                </Border>
                                            </Grid>
                                        </Border>

                                        <!-- Table 3: dunnage_types -->
                                        <Border Background="{ThemeResource SubtleFillColorTransparentBrush}"
                                                BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                                BorderThickness="0,0,0,1"
                                                Padding="12,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0"
                                                            Orientation="Horizontal"
                                                            Spacing="12"
                                                            VerticalAlignment="Center">
                                                    <Border Width="20"
                                                            Height="20"
                                                            CornerRadius="10"
                                                            Background="#107c10">
                                                        <icons:MaterialIcon Kind="Check"
                                                                            Width="14"
                                                                            Height="14"
                                                                            Foreground="White" />
                                                    </Border>
                                                    <StackPanel Spacing="2">
                                                        <TextBlock Text="dunnage_types"
                                                                   FontWeight="SemiBold" />
                                                        <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                                            <Run Text="5 rows | 5 columns | 2 unique constraints" />
                                                        </TextBlock>
                                                    </StackPanel>
                                                </StackPanel>

                                                <Border Grid.Column="2"
                                                        BorderBrush="#107c10"
                                                        BorderThickness="1"
                                                        CornerRadius="4"
                                                        Padding="12,4">
                                                    <TextBlock Text="Validated"
                                                               Style="{StaticResource CaptionTextBlockStyle}"
                                                               Foreground="#107c10" />
                                                </Border>
                                            </Grid>
                                        </Border>

                                        <!-- Table 4: routing_home_locations -->
                                        <Border Background="{ThemeResource SubtleFillColorTransparentBrush}"
                                                BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                                BorderThickness="0,0,0,1"
                                                Padding="12,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0"
                                                            Orientation="Horizontal"
                                                            Spacing="12"
                                                            VerticalAlignment="Center">
                                                    <Border Width="20"
                                                            Height="20"
                                                            CornerRadius="10"
                                                            Background="#107c10">
                                                        <icons:MaterialIcon Kind="Check"
                                                                            Width="14"
                                                                            Height="14"
                                                                            Foreground="White" />
                                                    </Border>
                                                    <StackPanel Spacing="2">
                                                        <TextBlock Text="routing_home_locations"
                                                                   FontWeight="SemiBold" />
                                                        <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                                            <Run Text="3 rows | 7 columns | 1 index on priority" />
                                                        </TextBlock>
                                                    </StackPanel>
                                                </StackPanel>

                                                <Border Grid.Column="2"
                                                        BorderBrush="#107c10"
                                                        BorderThickness="1"
                                                        CornerRadius="4"
                                                        Padding="12,4">
                                                    <TextBlock Text="Validated"
                                                               Style="{StaticResource CaptionTextBlockStyle}"
                                                               Foreground="#107c10" />
                                                </Border>
                                            </Grid>
                                        </Border>

                                        <!-- Table 5: reporting_scheduled_reports -->
                                        <Border Background="{ThemeResource SubtleFillColorTransparentBrush}"
                                                BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                                BorderThickness="0,0,0,1"
                                                Padding="12,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0"
                                                            Orientation="Horizontal"
                                                            Spacing="12"
                                                            VerticalAlignment="Center">
                                                    <Border Width="20"
                                                            Height="20"
                                                            CornerRadius="10"
                                                            Background="#107c10">
                                                        <icons:MaterialIcon Kind="Check"
                                                                            Width="14"
                                                                            Height="14"
                                                                            Foreground="White" />
                                                    </Border>
                                                    <StackPanel Spacing="2">
                                                        <TextBlock Text="reporting_scheduled_reports"
                                                                   FontWeight="SemiBold" />
                                                        <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                                            <Run Text="2 rows | 8 columns | 2 indexes" />
                                                        </TextBlock>
                                                    </StackPanel>
                                                </StackPanel>

                                                <Border Grid.Column="2"
                                                        BorderBrush="#107c10"
                                                        BorderThickness="1"
                                                        CornerRadius="4"
                                                        Padding="12,4">
                                                    <TextBlock Text="Validated"
                                                               Style="{StaticResource CaptionTextBlockStyle}"
                                                               Foreground="#107c10" />
                                                </Border>
                                            </Grid>
                                        </Border>

                                    </StackPanel>
                                    <!-- End of collapsed hardcoded items -->

                                    <!-- Show All Tables Button -->
                                    <Button Content="Show All Tables (7)"
                                            HorizontalAlignment="Left"
                                            Margin="0,8,0,0"
                                            Background="Transparent"
                                            BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                            BorderThickness="1" />
                                </StackPanel>

                                <!-- Stored Procedures Tab -->
                                <StackPanel x:Name="StoredProceduresTabContent"
                                            Spacing="16"
                                            Visibility="Collapsed">
                                    <TextBlock Text="Stored Procedure Results"
                                               Style="{StaticResource SubtitleTextBlockStyle}" />

                                    <ItemsControl ItemsSource="{x:Bind ViewModel.StoredProcedureResults, Mode=OneWay}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate x:DataType="models:Model_StoredProcedureTestResult">
                                                <Border Background="{ThemeResource SubtleFillColorTransparentBrush}"
                                                        BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                                        BorderThickness="0,0,0,1"
                                                        Padding="12,8"
                                                        Margin="0,0,0,12">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>

                                                        <StackPanel Spacing="2">
                                                            <TextBlock Text="{x:Bind ProcedureName}"
                                                                       FontWeight="SemiBold" />
                                                            <TextBlock Text="{x:Bind TestDetails}"
                                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                                        </StackPanel>

                                                        <TextBlock Grid.Column="1"
                                                                   Text="{x:Bind ExecutionTimeMs}"
                                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                                   VerticalAlignment="Center" />
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>

                                <!-- DAOs Tab -->
                                <StackPanel x:Name="DaosTabContent"
                                            Spacing="16"
                                            Visibility="Collapsed">
                                    <TextBlock Text="DAO Results"
                                               Style="{StaticResource SubtitleTextBlockStyle}" />

                                    <ItemsControl ItemsSource="{x:Bind ViewModel.DaoResults, Mode=OneWay}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate x:DataType="models:Model_DaoTestResult">
                                                <Border Background="{ThemeResource SubtleFillColorTransparentBrush}"
                                                        BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                                        BorderThickness="0,0,0,1"
                                                        Padding="12,8"
                                                        Margin="0,0,0,12">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>

                                                        <StackPanel Spacing="2">
                                                            <TextBlock Text="{x:Bind DaoName}"
                                                                       FontWeight="SemiBold" />
                                                            <TextBlock Text="{x:Bind StatusText}"
                                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                                        </StackPanel>

                                                        <TextBlock Grid.Column="1"
                                                                   Text="{x:Bind OperationsTested}"
                                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                                   VerticalAlignment="Center" />
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>

                                <!-- Logs Tab -->
                                <StackPanel x:Name="LogsTabContent"
                                            Spacing="16"
                                            Visibility="Collapsed">
                                    <StackPanel Orientation="Horizontal"
                                                Spacing="12">
                                        <TextBlock Text="Logs"
                                                   Style="{StaticResource SubtitleTextBlockStyle}" />
                                        <Button Content="Load Audit Log"
                                                Command="{x:Bind ViewModel.LoadAuditLogCommand}" />
                                    </StackPanel>

                                    <TextBlock Text="Runtime Log Messages"
                                               Style="{StaticResource BodyTextBlockStyle}" />
                                    <ItemsControl ItemsSource="{x:Bind ViewModel.LogMessages, Mode=OneWay}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate x:DataType="x:String">
                                                <TextBlock Text="{x:Bind}"
                                                           Style="{StaticResource CaptionTextBlockStyle}"
                                                           TextWrapping="WrapWholeWords" />
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <TextBlock Text="Settings Audit Log (Sample)"
                                               Style="{StaticResource BodyTextBlockStyle}"
                                               Margin="0,12,0,0" />
                                    <ItemsControl ItemsSource="{x:Bind ViewModel.AuditLogEntries, Mode=OneWay}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate x:DataType="models:Model_SettingsAuditLog">
                                                <Border Background="{ThemeResource SubtleFillColorTransparentBrush}"
                                                        BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                                        BorderThickness="0,0,0,1"
                                                        Padding="12,8"
                                                        Margin="0,0,0,12">
                                                    <StackPanel Spacing="2">
                                                        <TextBlock Text="{x:Bind SettingName}"
                                                                   FontWeight="SemiBold" />
                                                        <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                                            <Run Text="{x:Bind ChangeType}" />
                                                            <Run Text="  " />
                                                            <Run Text="{x:Bind ChangedAt}" />
                                                        </TextBlock>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Grid>
                        </ScrollViewer>
                    </Grid>
                </Border>

                <!-- Footer -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0"
                                    Spacing="4">
                            <TextBlock Text="Last run: Not yet executed"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <StackPanel Orientation="Horizontal"
                                        Spacing="4">
                                <TextBlock Text="Total test duration:"
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                <TextBlock Text="{x:Bind ViewModel.TotalTestDurationMs, Mode=OneWay}"
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                <TextBlock Text="ms"
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Grid.Column="1"
                                    Orientation="Horizontal"
                                    Spacing="12">
                            <Button Content="Export Results"
                                    Command="{x:Bind ViewModel.ExportResultsCommand}"
                                    Height="32"
                                    Padding="16,0"
                                    Background="Transparent"
                                    BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1" />
                            <Button Content="Close"
                                    Height="32"
                                    Padding="16,0"
                                    Background="Transparent"
                                    BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1" />
                        </StackPanel>
                    </Grid>
                </Border>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
</file>

<file path="Module_Volvo/Models/Model_VolvoPart.cs">
/// <summary>
/// Represents a Volvo dunnage part in the master catalog
/// Maps to volvo_masterdata database table
/// </summary>
public class Model_VolvoPart
⋮----
/// Part number (primary key)
/// Example: V-EMB-1, V-EMB-500, V-EMB-750
⋮----
/// Number of pieces per skid for this part
/// Example: V-EMB-2 = 20 pieces/skid, V-EMB-500 = 88 pieces/skid
⋮----
/// Flag indicating if part is active
/// If false, part is hidden from dropdown lists but still referenced in historical data
⋮----
/// Timestamp when part was created in the system
⋮----
/// Timestamp when part was last modified
</file>

<file path="Module_Volvo/Models/Model_VolvoSetting.cs">
/// <summary>
/// Represents a configurable setting for the Volvo module
/// Database Table: settings_module_volvo
/// </summary>
public partial class Model_VolvoSetting : ObservableObject
⋮----
private DateTime _modifiedDate = DateTime.Now;
</file>

<file path="Module_Volvo/Services/Service_VolvoAuthorization.cs">
/// <summary>
/// Authorization service for Volvo module operations
/// Currently implements basic authorization - can be extended with role-based checks
/// </summary>
public class Service_VolvoAuthorization : IService_VolvoAuthorization
⋮----
private readonly IService_LoggingUtility _logger;
// Issue #6: TODO - Inject IService_UserSessionManager when available
// Required for proper authentication and role-based authorization
⋮----
_logger = logger ?? throw new ArgumentNullException(nameof(logger));
⋮----
/// Checks if current user can create/modify Volvo shipments
⋮----
public async Task<Model_Dao_Result> CanManageShipmentsAsync()
⋮----
// Issue #6: TODO - Implement actual role check when user session management is available
// For now, returning true to allow development/testing
// For now, log the authorization check
await _logger.LogInfoAsync("Authorization check: CanManageShipments");
⋮----
// Placeholder: Allow all operations until role-based auth is implemented
return new Model_Dao_Result
⋮----
await _logger.LogErrorAsync($"Error checking shipment management authorization: {ex.Message}", ex);
⋮----
/// Checks if current user can manage Volvo master data (parts, components)
⋮----
public async Task<Model_Dao_Result> CanManageMasterDataAsync()
⋮----
await _logger.LogInfoAsync("Authorization check: CanManageMasterData");
⋮----
// TODO: Implement role check - typically restricted to supervisors/admins
⋮----
await _logger.LogErrorAsync($"Error checking master data authorization: {ex.Message}", ex);
⋮----
/// Checks if current user can complete/close Volvo shipments
⋮----
public async Task<Model_Dao_Result> CanCompleteShipmentsAsync()
⋮----
await _logger.LogInfoAsync("Authorization check: CanCompleteShipments");
⋮----
// TODO: Implement role check - may require supervisor approval
⋮----
await _logger.LogErrorAsync($"Error checking shipment completion authorization: {ex.Message}", ex);
⋮----
/// Checks if current user can generate labels for Volvo shipments
⋮----
public async Task<Model_Dao_Result> CanGenerateLabelsAsync()
⋮----
await _logger.LogInfoAsync("Authorization check: CanGenerateLabels");
⋮----
// TODO: Implement role check
⋮----
await _logger.LogErrorAsync($"Error checking label generation authorization: {ex.Message}", ex);
</file>

<file path="Module_Volvo/ViewModels/ViewModel_Volvo_Settings.cs">
/// <summary>
/// ViewModel for Volvo master data settings (parts catalog management)
/// </summary>
public partial class ViewModel_Volvo_Settings : ViewModel_Shared_Base
⋮----
private readonly IService_VolvoMasterData _masterDataService;
⋮----
_masterDataService = masterDataService ?? throw new ArgumentNullException(nameof(masterDataService));
⋮----
private async Task RefreshAsync()
⋮----
var result = await _masterDataService.GetAllPartsAsync(ShowInactive);
⋮----
Parts.Clear();
foreach (var part in result.Data.OrderBy(p => p.PartNumber))
⋮----
Parts.Add(part);
⋮----
ActivePartsCount = Parts.Count(p => p.IsActive);
⋮----
await _errorHandler.ShowUserErrorAsync(
⋮----
_errorHandler.HandleException(
⋮----
private async Task AddPartAsync()
⋮----
dialog.InitializeForAdd();
⋮----
dialog.XamlRoot = windowService.GetXamlRoot();
⋮----
var result = await dialog.ShowAsync();
⋮----
// No components for now (simplified version)
var saveResult = await _masterDataService.AddPartAsync(dialog.Part, new System.Collections.Generic.List<Model_VolvoPartComponent>());
⋮----
private async Task EditPartAsync()
⋮----
dialog.InitializeForEdit(SelectedPart);
⋮----
var saveResult = await _masterDataService.UpdatePartAsync(dialog.Part, new System.Collections.Generic.List<Model_VolvoPartComponent>());
⋮----
private bool CanEditPart() => SelectedPart != null && !IsBusy;
⋮----
private async Task DeactivatePartAsync()
⋮----
// Confirmation dialog
var dialog = new ContentDialog
⋮----
// Get XamlRoot from service
⋮----
var deactivateResult = await _masterDataService.DeactivatePartAsync(SelectedPart.PartNumber);
⋮----
private bool CanDeactivatePart() => SelectedPart?.IsActive == true && !IsBusy;
⋮----
private async Task ViewComponentsAsync()
⋮----
var result = await _masterDataService.GetComponentsAsync(SelectedPart.PartNumber);
⋮----
? string.Join("\n", result.Data.Select(c => $"• {c.ComponentPartNumber} (Qty: {c.Quantity})"))
⋮----
await dialog.ShowAsync();
⋮----
private bool CanViewComponents() => SelectedPart != null && !IsBusy;
⋮----
private async Task ImportCsvAsync()
⋮----
// File picker
var picker = new FileOpenPicker();
picker.FileTypeFilter.Add(".csv");
⋮----
// Get window handle
var hwnd = WinRT.Interop.WindowNative.GetWindowHandle(App.MainWindow);
WinRT.Interop.InitializeWithWindow.Initialize(picker, hwnd);
⋮----
var file = await picker.PickSingleFileAsync();
⋮----
var csvContent = await FileIO.ReadTextAsync(file);
var result = await _masterDataService.ImportCsvAsync(csvContent);
⋮----
// Show summary dialog
⋮----
private async Task ExportCsvAsync()
⋮----
var picker = new FileSavePicker();
picker.FileTypeChoices.Add("CSV File", new[] { ".csv" });
⋮----
var file = await picker.PickSaveFileAsync();
⋮----
var result = await _masterDataService.ExportCsvAsync(file.Path, ShowInactive);
⋮----
await FileIO.WriteTextAsync(file, result.Data);
⋮----
partial void OnShowInactiveChanged(bool value)
⋮----
// Refresh when toggle changes
⋮----
partial void OnSelectedPartChanged(Model_VolvoPart? value)
⋮----
// Notify commands that depend on selection
EditPartCommand.NotifyCanExecuteChanged();
DeactivatePartCommand.NotifyCanExecuteChanged();
ViewComponentsCommand.NotifyCanExecuteChanged();
</file>

<file path="Module_Volvo/Views/View_Volvo_History.xaml">
<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MTM_Receiving_Application.Module_Volvo.Views.View_Volvo_History"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    mc:Ignorable="d"
    Loaded="OnPageLoaded">

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="12">
            <Button 
                Command="{x:Bind ViewModel.GoBackCommand}"
                VerticalAlignment="Center"
                ToolTipService.ToolTip="Back to Shipment Entry">
                <SymbolIcon Symbol="Back"/>
            </Button>
            <TextBlock 
                Text="Volvo Shipment History"
                Style="{StaticResource TitleTextBlockStyle}"
                VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Filters -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="16">
            <CalendarDatePicker
                Header="Start Date"
                Date="{x:Bind ViewModel.StartDate, Mode=TwoWay}"
                Width="200"/>
            
            <CalendarDatePicker
                Header="End Date"
                Date="{x:Bind ViewModel.EndDate, Mode=TwoWay}"
                Width="200"/>
            
            <ComboBox
                Header="Status"
                ItemsSource="{x:Bind ViewModel.StatusOptions}"
                SelectedItem="{x:Bind ViewModel.StatusFilter, Mode=TwoWay}"
                Width="150"/>
            
            <Button
                Content="Filter"
                Command="{x:Bind ViewModel.FilterCommand}"
                Style="{StaticResource AccentButtonStyle}"
                VerticalAlignment="Bottom"/>
            
            <Button
                Content="Export CSV"
                Command="{x:Bind ViewModel.ExportCommand}"
                VerticalAlignment="Bottom"/>
        </StackPanel>

        <!-- DataGrid -->
        <controls:DataGrid
            Grid.Row="2"
            ItemsSource="{x:Bind ViewModel.History, Mode=OneWay}"
            SelectedItem="{x:Bind ViewModel.SelectedShipment, Mode=TwoWay}"
            AutoGenerateColumns="False"
            IsReadOnly="True"
            CanUserReorderColumns="False"
            GridLinesVisibility="Horizontal">
            
            <controls:DataGrid.Columns>
                <controls:DataGridTextColumn 
                    Header="Shipment #" 
                    Binding="{Binding ShipmentNumber}"
                    Width="100"/>
                
                <controls:DataGridTextColumn 
                    Header="Date" 
                    Binding="{Binding ShipmentDate}"
                    Width="120"/>
                
                <controls:DataGridTextColumn 
                    Header="PO Number" 
                    Binding="{Binding PONumber}"
                    Width="120"/>
                
                <controls:DataGridTextColumn 
                    Header="Receiver" 
                    Binding="{Binding ReceiverNumber}"
                    Width="120"/>
                
                <controls:DataGridTextColumn 
                    Header="Status" 
                    Binding="{Binding Status}"
                    Width="120"/>
                
                <controls:DataGridTextColumn 
                    Header="Notes" 
                    Binding="{Binding Notes}"
                    Width="*"/>
            </controls:DataGrid.Columns>
        </controls:DataGrid>

        <!-- Status Bar -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="12">
            <ProgressRing 
                IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                Width="20" Height="20"/>
            <TextBlock 
                Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                VerticalAlignment="Center"/>
            <Button
                Content="View Details"
                Command="{x:Bind ViewModel.ViewDetailCommand}"
                Margin="12,0,0,0"/>
            <Button
                Content="Edit"
                Command="{x:Bind ViewModel.EditCommand}"/>
        </StackPanel>
    </Grid>
</Page>
</file>

<file path="Module_Volvo/Views/View_Volvo_Settings.xaml">
<Page
    x:Class="MTM_Receiving_Application.Module_Volvo.Views.View_Volvo_Settings"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:MTM_Receiving_Application.Module_Volvo.Models"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    mc:Ignorable="d"
    Loaded="OnPageLoaded">

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock 
            Grid.Row="0"
            Text="Volvo Dunnage Parts Master Data"
            Style="{StaticResource TitleTextBlockStyle}"/>

        <!-- Toolbar -->
        <CommandBar Grid.Row="1" DefaultLabelPosition="Right">
            <AppBarButton 
                Icon="Add" 
                Label="Add Part" 
                Command="{x:Bind ViewModel.AddPartCommand, Mode=OneWay}"/>
            <AppBarButton 
                Icon="Edit" 
                Label="Edit Part" 
                Command="{x:Bind ViewModel.EditPartCommand, Mode=OneWay}"/>
            <AppBarButton 
                Icon="Delete" 
                Label="Deactivate" 
                Command="{x:Bind ViewModel.DeactivatePartCommand, Mode=OneWay}"/>
            <AppBarSeparator/>
            <AppBarButton 
                Icon="PreviewLink" 
                Label="View Components" 
                Command="{x:Bind ViewModel.ViewComponentsCommand, Mode=OneWay}"/>
            <AppBarSeparator/>
            <AppBarButton 
                Icon="Import" 
                Label="Import CSV" 
                Command="{x:Bind ViewModel.ImportCsvCommand, Mode=OneWay}"/>
            <AppBarButton 
                Icon="Save" 
                Label="Export CSV" 
                Command="{x:Bind ViewModel.ExportCsvCommand, Mode=OneWay}"/>
            <AppBarSeparator/>
            <AppBarButton 
                Icon="Refresh" 
                Label="Refresh" 
                Command="{x:Bind ViewModel.RefreshCommand, Mode=OneWay}"/>
            <AppBarSeparator/>
            <AppBarToggleButton 
                Icon="View" 
                Label="Show Inactive"
                IsChecked="{x:Bind ViewModel.ShowInactive, Mode=TwoWay}"/>
        </CommandBar>

        <!-- Data Grid -->
        <Grid Grid.Row="2">
            <controls:DataGrid
                ItemsSource="{x:Bind ViewModel.Parts, Mode=OneWay}"
                SelectedItem="{x:Bind ViewModel.SelectedPart, Mode=TwoWay}"
                AutoGenerateColumns="False"
                IsReadOnly="True"
                GridLinesVisibility="All"
                HeadersVisibility="Column"
                AlternatingRowBackground="{ThemeResource SystemListLowColor}"
                SelectionMode="Single">
                <controls:DataGrid.Columns>
                    <controls:DataGridTextColumn Header="Part Number" Binding="{Binding PartNumber}" Width="*"/>
                    <controls:DataGridTextColumn Header="Qty/Skid" Binding="{Binding QuantityPerSkid}" Width="100"/>
                    <controls:DataGridTemplateColumn Header="Active" Width="80">
                        <controls:DataGridTemplateColumn.CellTemplate>
                            <DataTemplate x:DataType="models:Model_VolvoPart">
                                <TextBlock 
                                    Text="{x:Bind IsActive}" 
                                    Foreground="{x:Bind IsActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Green|Gray'}"/>
                            </DataTemplate>
                        </controls:DataGridTemplateColumn.CellTemplate>
                    </controls:DataGridTemplateColumn>
                </controls:DataGrid.Columns>
            </controls:DataGrid>
        </Grid>

        <!-- Status Bar -->
        <Grid Grid.Row="3" ColumnSpacing="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <ProgressRing 
                Grid.Column="0"
                IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                Width="20" 
                Height="20"
                Visibility="{x:Bind ViewModel.IsBusy, Mode=OneWay}"/>

            <TextBlock 
                Grid.Column="1"
                Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                VerticalAlignment="Center"/>
        </Grid>
    </Grid>
</Page>
</file>

<file path="Module_Volvo/Views/View_Volvo_ShipmentEntry.xaml.cs">
/// <summary>
/// Page for Volvo shipment entry
/// </summary>
public sealed partial class View_Volvo_ShipmentEntry : Page
⋮----
private async void OnLoaded(object sender, RoutedEventArgs e)
⋮----
await ViewModel.InitializeAsync();
⋮----
private void OnPartSearchTextChanged(AutoSuggestBox sender, AutoSuggestBoxTextChangedEventArgs args)
⋮----
ViewModel.UpdatePartSuggestions(sender.Text);
⋮----
private void OnPartSuggestionChosen(AutoSuggestBox sender, AutoSuggestBoxSuggestionChosenEventArgs args)
⋮----
ViewModel.OnPartSuggestionChosen(selectedPart);
</file>

<file path="Module_Volvo/Views/VolvoPartAddEditDialog.xaml.cs">
/// <summary>
/// Dialog for adding or editing a Volvo part
/// </summary>
public sealed partial class VolvoPartAddEditDialog : ContentDialog
⋮----
/// Initialize dialog in Add mode
⋮----
public void InitializeForAdd()
⋮----
// Clear fields
⋮----
/// Initialize dialog in Edit mode with existing part data
⋮----
/// <param name="part"></param>
public void InitializeForEdit(Model_VolvoPart part)
⋮----
PartNumberTextBox.IsReadOnly = true; // Part number cannot be changed
⋮----
// Pre-fill fields
⋮----
private void OnSaveClicked(ContentDialog sender, ContentDialogButtonClickEventArgs args)
⋮----
// Validate inputs
if (string.IsNullOrWhiteSpace(PartNumberTextBox.Text))
⋮----
// In a real implementation, show error message
⋮----
// Create part object
Part = new Model_VolvoPart
⋮----
PartNumber = PartNumberTextBox.Text.Trim().ToUpperInvariant(),
</file>

<file path="Module_Volvo/Views/VolvoShipmentEditDialog.xaml.cs">
public sealed partial class VolvoShipmentEditDialog : ContentDialog
⋮----
// Wire up button events
⋮----
// Set DataGrid ItemsSource
⋮----
public void LoadShipment(Model_VolvoShipment shipment, ObservableCollection<Model_VolvoShipmentLine> lines, ObservableCollection<Model_VolvoPart> availableParts)
⋮----
// Populate header fields
⋮----
ShipmentNumberBox.Text = shipment.ShipmentNumber.ToString();
⋮----
// Load lines
Lines.Clear();
⋮----
Lines.Add(line);
⋮----
public Model_VolvoShipment GetUpdatedShipment()
⋮----
Shipment.PONumber = string.IsNullOrWhiteSpace(PONumberBox.Text) ? null : PONumberBox.Text;
Shipment.ReceiverNumber = string.IsNullOrWhiteSpace(ReceiverNumberBox.Text) ? null : ReceiverNumberBox.Text;
Shipment.Notes = string.IsNullOrWhiteSpace(NotesBox.Text) ? null : NotesBox.Text;
⋮----
public ObservableCollection<Model_VolvoShipmentLine> GetUpdatedLines()
⋮----
private void AddNewLine()
⋮----
Lines.Add(new Model_VolvoShipmentLine
⋮----
private void RemoveSelectedLine()
⋮----
Lines.Remove(selectedLine);
</file>

<file path="MTM_Receiving_Application.Tests/GlobalUsings.cs">

</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Converters/Converter_DecimalToInt_Tests.cs">
/// <summary>
/// Unit tests for <see cref="Converter_DecimalToInt"/>.
/// Tests conversion of decimal/double/float values to formatted integer strings (N0 format).
/// ConvertBack parses strings back to decimal.
/// </summary>
⋮----
public class Converter_DecimalToInt_Tests
⋮----
private readonly Converter_DecimalToInt _sut;
⋮----
public void Convert_WithDecimalValue_ReturnsFormattedIntegerString(decimal input, string expected)
⋮----
// Act
object result = _sut.Convert(input, typeof(string), default(object)!, "en-US");
⋮----
// Assert
_ = result.Should().Be(expected);
⋮----
public void Convert_WithDoubleValue_ReturnsFormattedIntegerString(double input, string expected)
⋮----
public void Convert_WithFloatValue_ReturnsFormattedIntegerString(float input, string expected)
⋮----
public void Convert_WithNullValue_ReturnsEmptyString()
⋮----
object result = _sut.Convert(null!, typeof(string), default(object)!, "en-US");
⋮----
_ = result.Should().Be(string.Empty);
⋮----
public void Convert_WithNonNumericValue_ReturnsValueToString(object input)
⋮----
_ = result.Should().Be(input.ToString());
⋮----
public void ConvertBack_WithValidString_ReturnsDecimal(string input, decimal expected)
⋮----
object result = _sut.ConvertBack(input, typeof(decimal), default(object)!, "en-US");
⋮----
public void ConvertBack_WithInvalidString_ReturnsZero(string? input)
⋮----
object result = _sut.ConvertBack(input!, typeof(decimal), default(object)!, "en-US");
⋮----
_ = result.Should().Be(0m);
⋮----
public void ConvertBack_WithNonStringValue_ReturnsZero()
⋮----
object result = _sut.ConvertBack(42, typeof(decimal), default(object)!, "en-US");
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Models/Core/Model_Dao_Result_Factory_Tests.cs">
/// <summary>
/// Unit tests for Model_Dao_Result_Factory
/// </summary>
⋮----
public class Model_Dao_Result_Factory_Tests
⋮----
public void Failure_CreatesFailedResult()
⋮----
// Act
var result = Model_Dao_Result_Factory.Failure("Error!");
⋮----
// Assert
result.Success.Should().BeFalse();
result.ErrorMessage.Should().Be("Error!");
result.Severity.Should().Be(Enum_ErrorSeverity.Error);
⋮----
public void Failure_WithNullMessage_UsesDefaultMessage()
⋮----
var result = Model_Dao_Result_Factory.Failure(null);
⋮----
result.ErrorMessage.Should().Be("Operation failed.");
⋮----
public void Failure_WithWhitespaceMessage_UsesDefaultMessage()
⋮----
var result = Model_Dao_Result_Factory.Failure("   ");
⋮----
public void Failure_WithException_CapturesException()
⋮----
// Arrange
var ex = new InvalidOperationException("Test ex");
⋮----
var result = Model_Dao_Result_Factory.Failure("Error!", ex);
⋮----
result.Exception.Should().Be(ex);
⋮----
public void Success_CreatesSuccessResult()
⋮----
var result = Model_Dao_Result_Factory.Success(5);
⋮----
result.Success.Should().BeTrue();
result.AffectedRows.Should().Be(5);
result.ErrorMessage.Should().BeEmpty();
⋮----
public void Success_WithNegativeAffectedRows_ClampsToZero()
⋮----
var result = Model_Dao_Result_Factory.Success(-1);
⋮----
result.AffectedRows.Should().Be(0);
⋮----
public void FailureGeneric_CreatesFailedResult()
⋮----
result.ErrorMessage.Should().Be("Generic Error!");
result.Data.Should().BeNull();
⋮----
public void FailureGeneric_WithNullMessage_UsesDefaultMessage()
⋮----
public void SuccessGeneric_CreatesSuccessResultWithData()
⋮----
var result = Model_Dao_Result_Factory.Success("Test Data", 1);
⋮----
result.Data.Should().Be("Test Data");
result.AffectedRows.Should().Be(1);
⋮----
public void SuccessGeneric_WithNegativeAffectedRows_ClampsToZero()
⋮----
var result = Model_Dao_Result_Factory.Success("Test Data", -1);
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_UserSession_Tests.cs">
/// <summary>
/// Unit tests for Model_UserSession
/// </summary>
⋮----
public class Model_UserSession_Tests
⋮----
public void DefaultConstructor_SetsTimestamps()
⋮----
// Arrange
⋮----
// Act
var session = new Model_UserSession();
⋮----
// Assert
session.LoginTimestamp.Should().BeOnOrAfter(before);
session.LoginTimestamp.Should().BeOnOrBefore(after);
session.LastActivityTimestamp.Should().BeOnOrAfter(before);
session.LastActivityTimestamp.Should().BeOnOrBefore(after);
⋮----
public void UpdateLastActivity_UpdatesTimestamp()
⋮----
session.LastActivityTimestamp = DateTime.Now.AddMinutes(-1);
⋮----
session.UpdateLastActivity();
⋮----
session.LastActivityTimestamp.Should().BeAfter(DateTime.Now.AddSeconds(-5));
⋮----
public void TimeSinceLastActivity_ReturnsCorrectDifference()
⋮----
session.LastActivityTimestamp = DateTime.Now.AddMinutes(-5);
⋮----
elapsed.Should().BeCloseTo(TimeSpan.FromMinutes(5), TimeSpan.FromSeconds(2));
⋮----
public void IsTimedOut_ReturnsTrueWhenExpired()
⋮----
var session = new Model_UserSession
⋮----
TimeoutDuration = TimeSpan.FromMinutes(10),
LastActivityTimestamp = DateTime.Now.AddMinutes(-11)
⋮----
isTimedOut.Should().BeTrue();
⋮----
public void IsTimedOut_ReturnsFalseWhenActive()
⋮----
LastActivityTimestamp = DateTime.Now.AddMinutes(-5)
⋮----
isTimedOut.Should().BeFalse();
⋮----
public void HasErpAccess_ReturnsFalseIfUserIsNull()
⋮----
var session = new Model_UserSession { User = null };
⋮----
hasAccess.Should().BeFalse();
⋮----
public void HasErpAccess_ReturnsFalseIfUserHasNoVisualUsername()
⋮----
User = new Model_User { VisualUsername = null }
⋮----
public void HasErpAccess_ReturnsTrueIfUserHasVisualUsername()
⋮----
User = new Model_User { VisualUsername = "user" }
⋮----
hasAccess.Should().BeTrue();
⋮----
public void Constructor_WithUser_SetsUser()
⋮----
var user = new Model_User();
⋮----
var session = new Model_UserSession(user);
⋮----
session.User.Should().BeSameAs(user);
⋮----
public void Constructor_WithNullUser_Throws()
⋮----
var act = static () => new Model_UserSession(null!);
⋮----
act.Should().Throw<ArgumentNullException>();
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Models/Systems/Model_WorkstationConfig_Tests.cs">
/// <summary>
/// Unit tests for Model_WorkstationConfig logic
/// </summary>
⋮----
public class Model_WorkstationConfig_Tests
⋮----
public void Constructor_Default_UsesMachineName()
⋮----
var config = new Model_WorkstationConfig();
⋮----
config.ComputerName.Should().Be(Environment.MachineName);
⋮----
public void Constructor_WithParameter_SetsComputerName()
⋮----
var config = new Model_WorkstationConfig("TEST-PC");
⋮----
config.ComputerName.Should().Be("TEST-PC");
⋮----
public void IsSharedTerminal_ReturnsTrueForSharedType()
⋮----
var config = new Model_WorkstationConfig { WorkstationType = WorkstationDefaults.SharedTerminalWorkstationType };
⋮----
config.IsSharedTerminal.Should().BeTrue();
⋮----
public void IsSharedTerminal_ReturnsFalseForSharedType()
⋮----
config.IsPersonalWorkstation.Should().BeFalse();
⋮----
public void IsPersonalWorkstation_ReturnsTrueForPersonalType()
⋮----
var config = new Model_WorkstationConfig { WorkstationType = WorkstationDefaults.PersonalWorkstationWorkstationType };
⋮----
config.IsPersonalWorkstation.Should().BeTrue();
⋮----
public void IsPersonalWorkstation_ReturnsFalseForPersonalType()
⋮----
config.IsSharedTerminal.Should().BeFalse();
⋮----
public void TimeoutDuration_SharedTerminal_ReturnsSharedTimeoutMinutes()
⋮----
config.TimeoutDuration.Should().Be(TimeSpan.FromMinutes(WorkstationDefaults.SharedTerminalTimeoutMinutes));
⋮----
public void TimeoutDuration_PersonalWorkstation_ReturnsPersonalTimeoutMinutes()
⋮----
config.TimeoutDuration.Should().Be(TimeSpan.FromMinutes(WorkstationDefaults.PersonalWorkstationTimeoutMinutes));
⋮----
public void TimeoutDuration_UnknownType_ReturnsPersonalTimeoutMinutesDefault()
⋮----
var config = new Model_WorkstationConfig { WorkstationType = "unknown" };
</file>

<file path="Module_Core/Helpers/Database/Helper_Database_Variables.cs">
/// <summary>
/// Manages database connection strings for different environments
/// </summary>
public static class Helper_Database_Variables
⋮----
/// Production MySQL connection string
/// Server: localhost, Port: 3306, Database: mtm_receiving_application
⋮----
/// Test MySQL connection string (same as production for now)
⋮----
/// Gets the connection string based on current environment
⋮----
/// <param name="useProduction">True for production, false for test</param>
/// <returns>MySQL connection string</returns>
public static string GetConnectionString(bool useProduction = true)
⋮----
/// Gets the Infor Visual connection string (READ ONLY)
⋮----
public static string GetInforVisualConnectionString()
</file>

<file path="Module_Core/Models/Systems/Model_WorkstationConfig.cs">
/// <summary>
/// Represents workstation detection and configuration logic.
/// Maps to 'auth_workstation_config' database table.
/// </summary>
public class Model_WorkstationConfig
⋮----
// ====================================================================
// Workstation Information
⋮----
/// Windows computer name (from Environment.MachineName)
⋮----
/// Workstation type: "personal_workstation" or "shared_terminal"
⋮----
/// Optional description of workstation location/purpose
⋮----
// Computed Properties
⋮----
/// True if workstation is configured as shared terminal (PIN login required)
⋮----
/// True if workstation is personal workstation (automatic Windows login)
⋮----
/// Session timeout duration based on workstation type
/// 15 minutes for shared terminals, 30 minutes for personal workstations
⋮----
? TimeSpan.FromMinutes(WorkstationDefaults.SharedTerminalTimeoutMinutes)
: TimeSpan.FromMinutes(WorkstationDefaults.PersonalWorkstationTimeoutMinutes);
⋮----
// Constructor
⋮----
/// Default constructor
⋮----
/// Constructor with computer name detection
⋮----
/// <param name="computerName">Computer name (defaults to Environment.MachineName)</param>
</file>

<file path="Module_Core/Services/Authentication/Service_Authentication.cs">
/// <summary>
/// Service implementation for user authentication operations.
/// Orchestrates authentication flows and coordinates with data access layer.
/// </summary>
public class Service_Authentication : IService_Authentication
⋮----
private readonly Dao_User _daoUser;
private readonly IService_ErrorHandler _errorHandler;
private static readonly Regex _regex = new Regex(@"^\d{4}$");
⋮----
/// Constructor with dependency injection.
⋮----
/// <param name="daoUser">User data access object</param>
/// <param name="errorHandler">Error handler for logging</param>
⋮----
_daoUser = daoUser ?? throw new ArgumentNullException(nameof(daoUser));
_errorHandler = errorHandler ?? throw new ArgumentNullException(nameof(errorHandler));
⋮----
// ====================================================================
// Authentication Methods
⋮----
/// <inheritdoc/>
public async Task<Model_AuthenticationResult> AuthenticateByWindowsUsernameAsync(
⋮----
// Validate input
if (string.IsNullOrWhiteSpace(windowsUsername))
⋮----
return Model_AuthenticationResult.ErrorResult("Windows username is required");
⋮----
// Query database for user
var result = await _daoUser.GetUserByWindowsUsernameAsync(windowsUsername);
⋮----
return Model_AuthenticationResult.ErrorResult(result.ErrorMessage);
⋮----
return Model_AuthenticationResult.ErrorResult("User data is invalid");
⋮----
// Log successful authentication
⋮----
return Model_AuthenticationResult.SuccessResult(result.Data);
⋮----
await _errorHandler.HandleErrorAsync("Authentication by Windows username failed", Enum_ErrorSeverity.Error, ex, false);
⋮----
return Model_AuthenticationResult.ErrorResult($"Authentication error: {ex.Message}");
⋮----
public async Task<Model_AuthenticationResult> AuthenticateByPinAsync(
⋮----
if (string.IsNullOrWhiteSpace(username))
⋮----
return Model_AuthenticationResult.ErrorResult("Username is required");
⋮----
if (string.IsNullOrWhiteSpace(pin))
⋮----
return Model_AuthenticationResult.ErrorResult("PIN is required");
⋮----
// Validate PIN format only (not uniqueness - that's for creation, not authentication)
if (pin.Length != 4 || !pin.All(char.IsDigit))
⋮----
return Model_AuthenticationResult.ErrorResult("PIN must be exactly 4 numeric digits");
⋮----
// Query database for user with PIN
var result = await _daoUser.ValidateUserPinAsync(username, pin);
⋮----
// Log failed attempt
⋮----
return Model_AuthenticationResult.ErrorResult("Invalid username or PIN");
⋮----
await _errorHandler.HandleErrorAsync("Authentication by PIN failed", Enum_ErrorSeverity.Error, ex, false);
⋮----
// User Management
⋮----
public async Task<Model_CreateUserResult> CreateNewUserAsync(
⋮----
// Validate required fields
if (string.IsNullOrWhiteSpace(user.WindowsUsername))
⋮----
return Model_CreateUserResult.ErrorResult("Windows username is required");
⋮----
if (string.IsNullOrWhiteSpace(user.FullName))
⋮----
return Model_CreateUserResult.ErrorResult("Full name is required");
⋮----
if (string.IsNullOrWhiteSpace(user.Department))
⋮----
return Model_CreateUserResult.ErrorResult("Department is required");
⋮----
if (string.IsNullOrWhiteSpace(user.Shift))
⋮----
return Model_CreateUserResult.ErrorResult("Shift is required");
⋮----
// Validate PIN
⋮----
return Model_CreateUserResult.ErrorResult(pinValidation.ErrorMessage);
⋮----
// Create user in database
var result = await _daoUser.CreateNewUserAsync(user, createdBy);
⋮----
return Model_CreateUserResult.ErrorResult(result.ErrorMessage);
⋮----
// Log user creation
⋮----
return Model_CreateUserResult.SuccessResult(result.Data);
⋮----
await _errorHandler.HandleErrorAsync("Create new user failed", Enum_ErrorSeverity.Error, ex, false);
⋮----
return Model_CreateUserResult.ErrorResult($"User creation error: {ex.Message}");
⋮----
// Validation Methods
⋮----
public async Task<Model_ValidationResult> ValidatePinAsync(string pin, int? excludeEmployeeNumber = null)
⋮----
// Check format (4 digits)
⋮----
return Model_ValidationResult.Invalid("PIN is required");
⋮----
return Model_ValidationResult.Invalid("PIN must be exactly 4 digits");
⋮----
if (!_regex.IsMatch(pin))
⋮----
return Model_ValidationResult.Invalid("PIN must contain only numeric digits");
⋮----
return Model_ValidationResult.Valid();
⋮----
await _errorHandler.HandleErrorAsync("PIN validation failed", Enum_ErrorSeverity.Error, ex, false);
⋮----
return Model_ValidationResult.Invalid($"Validation error: {ex.Message}");
⋮----
// Configuration Methods
⋮----
public async Task<Model_WorkstationConfig> DetectWorkstationTypeAsync(string? computerName = null)
⋮----
computerName = computerName.Trim();
⋮----
// Get list of shared terminal names from database
var sharedTerminalsResult = await _daoUser.GetSharedTerminalNamesAsync();
⋮----
var config = new Model_WorkstationConfig(computerName);
⋮----
// Check if current computer is in shared terminals list
var isShared = sharedTerminalsResult.Data.Any(name =>
string.Equals(name?.Trim(), computerName, StringComparison.OrdinalIgnoreCase));
⋮----
// Default to personal workstation if query fails
⋮----
// Best-effort persistence: ensure this machine exists in auth_workstation_config.
// If the SP isn't deployed yet, ignore and proceed.
⋮----
await _daoUser.UpsertWorkstationConfigAsync(
⋮----
// Swallow: persistence must not block startup.
⋮----
await _errorHandler.HandleErrorAsync("Workstation type detection failed", Enum_ErrorSeverity.Warning, ex, false);
⋮----
// Return safe default
return new Model_WorkstationConfig(computerName ?? Environment.MachineName)
⋮----
public async Task<List<string>> GetActiveDepartmentsAsync()
⋮----
var result = await _daoUser.GetActiveDepartmentsAsync();
⋮----
// Return empty list if query fails
⋮----
await _errorHandler.HandleErrorAsync("Get active departments failed", Enum_ErrorSeverity.Warning, ex, false);
⋮----
// Activity Logging
⋮----
public async Task LogUserActivityAsync(string eventType, string username, string workstationName, string details)
⋮----
await _daoUser.LogUserActivityAsync(eventType, username, workstationName, details);
⋮----
// Log errors but don't block application flow
⋮----
await _errorHandler.HandleErrorAsync("Activity logging failed", Enum_ErrorSeverity.Info, ex, false);
⋮----
System.Diagnostics.Debug.WriteLine($"Failed to log activity: {ex.Message}");
</file>

<file path="Module_Reporting/Data/Dao_Reporting.cs">
/// <summary>
/// Data Access Object for Reporting module
/// Queries database views for end-of-day reporting
/// Uses raw SQL for read-only reporting queries from views
/// </summary>
public class Dao_Reporting
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Retrieves receiving history from view_receiving_history view
⋮----
/// <param name="startDate"></param>
/// <param name="endDate"></param>
public async Task<Model_Dao_Result<List<Model_ReportRow>>> GetReceivingHistoryAsync(
⋮----
await using var connection = new MySqlConnection(_connectionString);
await connection.OpenAsync();
⋮----
await using var command = new MySqlCommand(query, connection);
command.Parameters.AddWithValue("@StartDate", startDate.Date);
command.Parameters.AddWithValue("@EndDate", endDate.Date);
⋮----
await using var reader = await command.ExecuteReaderAsync();
⋮----
while (await reader.ReadAsync())
⋮----
rows.Add(new Model_ReportRow
⋮----
Id = reader.GetGuid("id").ToString(),
PONumber = reader.IsDBNull(reader.GetOrdinal("po_number")) ? null : reader.GetString("po_number"),
PartNumber = reader.IsDBNull(reader.GetOrdinal("part_number")) ? null : reader.GetString("part_number"),
PartDescription = reader.IsDBNull(reader.GetOrdinal("part_description")) ? null : reader.GetString("part_description"),
Quantity = reader.IsDBNull(reader.GetOrdinal("quantity")) ? null : reader.GetDecimal("quantity"),
WeightLbs = reader.IsDBNull(reader.GetOrdinal("weight_lbs")) ? null : reader.GetDecimal("weight_lbs"),
HeatLotNumber = reader.IsDBNull(reader.GetOrdinal("heat_lot_number")) ? null : reader.GetString("heat_lot_number"),
CreatedDate = reader.GetDateTime("created_date"),
EmployeeNumber = reader.IsDBNull(reader.GetOrdinal("employee_number")) ? null : reader.GetString("employee_number"),
SourceModule = reader.GetString("source_module")
⋮----
return Model_Dao_Result_Factory.Success(rows);
⋮----
/// Retrieves dunnage history from view_dunnage_history view
⋮----
public async Task<Model_Dao_Result<List<Model_ReportRow>>> GetDunnageHistoryAsync(
⋮----
DunnageType = reader.IsDBNull(reader.GetOrdinal("dunnage_type")) ? null : reader.GetString("dunnage_type"),
⋮----
SpecsCombined = reader.IsDBNull(reader.GetOrdinal("specs_combined")) ? null : reader.GetString("specs_combined"),
⋮----
/// Retrieves routing history from view_routing_history view
⋮----
public async Task<Model_Dao_Result<List<Model_ReportRow>>> GetRoutingHistoryAsync(
⋮----
Id = reader.GetInt32("id").ToString(),
⋮----
LineNumber = reader.IsDBNull(reader.GetOrdinal("line_number")) ? null : reader.GetString("line_number"),
PackageDescription = reader.IsDBNull(reader.GetOrdinal("package_description")) ? null : reader.GetString("package_description"),
DeliverTo = reader.IsDBNull(reader.GetOrdinal("deliver_to")) ? null : reader.GetString("deliver_to"),
Department = reader.IsDBNull(reader.GetOrdinal("department")) ? null : reader.GetString("department"),
Location = reader.IsDBNull(reader.GetOrdinal("location")) ? null : reader.GetString("location"),
⋮----
EmployeeNumber = reader.IsDBNull(reader.GetOrdinal("employee_number")) ? null : reader.GetInt32("employee_number").ToString(),
⋮----
OtherReason = reader.IsDBNull(reader.GetOrdinal("other_reason")) ? null : reader.GetString("other_reason"),
⋮----
/// Retrieves Volvo history from view_volvo_history view
⋮----
public async Task<Model_Dao_Result<List<Model_ReportRow>>> GetVolvoHistoryAsync(
⋮----
ShipmentNumber = reader.IsDBNull(reader.GetOrdinal("shipment_number")) ? null : reader.GetInt32("shipment_number"),
⋮----
ReceiverNumber = reader.IsDBNull(reader.GetOrdinal("receiver_number")) ? null : reader.GetString("receiver_number"),
Status = reader.IsDBNull(reader.GetOrdinal("status")) ? null : reader.GetString("status"),
⋮----
PartCount = reader.IsDBNull(reader.GetOrdinal("part_count")) ? null : reader.GetInt32("part_count"),
⋮----
/// Checks data availability for each module in date range
/// Returns dictionary of module name → record count
⋮----
public async Task<Model_Dao_Result<Dictionary<string, int>>> CheckAvailabilityAsync(
⋮----
// Check Receiving
⋮----
// Check Dunnage
⋮----
// Check Routing
⋮----
// Check Volvo (placeholder)
⋮----
return Model_Dao_Result_Factory.Success(availability);
⋮----
/// Helper method to get count from a view
⋮----
/// <param name="connection"></param>
/// <param name="viewName"></param>
⋮----
private async Task<int> GetCountAsync(
⋮----
var result = await command.ExecuteScalarAsync();
return Convert.ToInt32(result);
</file>

<file path="Module_Routing/Services/RoutingUsageTrackingService.cs">
/// <summary>
/// Service for usage tracking to enable personalized Quick Add
/// </summary>
public class RoutingUsageTrackingService : IRoutingUsageTrackingService
⋮----
private readonly Dao_RoutingUsageTracking _daoUsageTracking;
private readonly IService_LoggingUtility _logger;
⋮----
_daoUsageTracking = daoUsageTracking ?? throw new ArgumentNullException(nameof(daoUsageTracking));
_logger = logger ?? throw new ArgumentNullException(nameof(logger));
⋮----
/// Increments the usage count for a recipient-employee pair
⋮----
/// <param name="employeeNumber">Employee number creating the label</param>
/// <param name="recipientId">ID of the recipient</param>
/// <returns>Result indicating success or failure</returns>
public async Task<Model_Dao_Result> IncrementUsageCountAsync(int employeeNumber, int recipientId)
⋮----
await _logger.LogInfoAsync($"Incrementing usage count for employee {employeeNumber}, recipient {recipientId}");
return await _daoUsageTracking.IncrementUsageAsync(employeeNumber, recipientId);
⋮----
await _logger.LogErrorAsync($"Error incrementing usage count: {ex.Message}", ex);
return new Model_Dao_Result { Success = false, ErrorMessage = $"Error updating usage tracking: {ex.Message}", Exception = ex };
⋮----
/// Gets the usage count for a specific employee-recipient pair
⋮----
/// <param name="employeeNumber">Employee number</param>
/// <param name="recipientId">Recipient ID</param>
/// <returns>Result with usage count</returns>
public async Task<Model_Dao_Result<int>> GetUsageCountAsync(int employeeNumber, int recipientId)
⋮----
await _logger.LogInfoAsync($"Getting usage count for employee {employeeNumber}, recipient {recipientId}");
⋮----
// Issue #13: GetUsageCountAsync requires new DAO method
// Would need: sp_routing_recipient_tracker_get_count(p_employee_number, p_recipient_id)
// Returns: COUNT(*) or SUM(usage_count) from routing_recipient_tracker table
// Priority: LOW - Feature not critical for production
// For now, returning success with 0 as fallback
⋮----
await _logger.LogErrorAsync($"Error getting usage count: {ex.Message}", ex);
⋮----
public async Task<Model_Dao_Result<int>> GetEmployeeLabelCountAsync(int employeeNumber)
⋮----
await _logger.LogInfoAsync($"Getting label count for employee {employeeNumber}");
⋮----
// Issue #13: GetEmployeeLabelCountAsync requires aggregation query
// Would need: sp_routing_recipient_tracker_get_employee_total(p_employee_number)
// Returns: Total label count for employee across all recipients
// Issue #28: When implementing, add zero-check guard to prevent division by zero
// Example: if (totalCount == 0) return 0; before calculating percentages
// Priority: LOW - Analytics feature, not blocking for core functionality
⋮----
await _logger.LogErrorAsync($"Error getting employee label count: {ex.Message}", ex);
</file>

<file path="Module_Routing/ViewModels/RoutingModeSelectionViewModel.cs">
/// <summary>
/// ViewModel for Mode Selection - launching Wizard, Manual Entry, or Edit Mode
/// </summary>
public partial class RoutingModeSelectionViewModel : ViewModel_Shared_Base
⋮----
private readonly IRoutingUserPreferenceService _userPreferenceService;
private readonly IService_Navigation _navigationService;
private readonly IService_UserSessionManager _sessionManager;
⋮----
// Separate default flags for each mode
⋮----
/// Sets the navigation frame
⋮----
/// <param name="frame"></param>
public void SetNavigationFrame(Frame frame)
⋮----
/// Initialize - load user preferences
⋮----
public async Task InitializeAsync()
⋮----
// Issue #7: Get current user from session
⋮----
var prefsResult = await _userPreferenceService.GetUserPreferenceAsync(employeeNumber);
⋮----
// Set checkbox state based on preference
⋮----
// If default mode is set and not Wizard (which might be the landing page), auto-nav
// Revisit this logic if Wizard SHOULD technically be skipped to Step 1 directly.
// For now keeping existing logic but fixing navigation.
⋮----
_errorHandler.HandleException(ex, Module_Core.Models.Enums.Enum_ErrorSeverity.Low,
⋮----
private async Task SelectWizardModeAsync() => await NavigateToModeAsync(Enum_RoutingMode.WIZARD);
⋮----
private async Task SelectManualEntryModeAsync() => await NavigateToModeAsync(Enum_RoutingMode.MANUAL);
⋮----
private async Task SelectEditModeAsync() => await NavigateToModeAsync(Enum_RoutingMode.EDIT);
⋮----
private async Task SetWizardAsDefaultAsync(bool isChecked)
⋮----
private async Task SetManualAsDefaultAsync(bool isChecked)
⋮----
private async Task SetEditAsDefaultAsync(bool isChecked)
⋮----
private async Task SavePreferenceAsync(Enum_RoutingMode mode)
⋮----
var preference = new Model_RoutingUserPreference
⋮----
DefaultMode = mode.ToString(),
⋮----
var result = await _userPreferenceService.SaveUserPreferenceAsync(preference);
⋮----
await _logger.LogInfoAsync($"Default mode set to {mode} for employee {employeeNumber}");
⋮----
private async Task NavigateToModeAsync(Enum_RoutingMode mode)
⋮----
// Fallback attempt to find frame if not explicitly set?
// For now just log usage error
_errorHandler.HandleException(new InvalidOperationException("Navigation Frame not set"),
⋮----
_ => throw new ArgumentException($"Unknown mode: {mode}")
⋮----
_navigationService.NavigateTo(_frame, viewName);
await _logger.LogInfoAsync($"Navigated to {viewName}");
⋮----
_errorHandler.HandleException(ex, Module_Core.Models.Enums.Enum_ErrorSeverity.Medium,
</file>

<file path="Module_Routing/ViewModels/RoutingWizardStep2ViewModel.cs">
/// <summary>
/// ViewModel for Wizard Step 2: Recipient Selection with Quick Add
/// </summary>
public partial class RoutingWizardStep2ViewModel : ObservableObject
⋮----
private readonly IRoutingRecipientService _recipientService;
private readonly IService_ErrorHandler _errorHandler;
private readonly IService_LoggingUtility _logger;
private readonly IService_UserSessionManager _sessionManager;
private readonly RoutingWizardContainerViewModel _containerViewModel;
⋮----
// Full list for filtering
⋮----
// Subscribe to container property changes to update button text
⋮----
/// Quick Add buttons (top 5 most-used recipients)
⋮----
/// Filtered recipient list for DataGrid
⋮----
/// Selected recipient from DataGrid
⋮----
/// Search text for real-time filtering
⋮----
/// Busy indicator
⋮----
/// Status message
⋮----
/// Is user editing from review (Step 3)
⋮----
/// Button text for navigation (changes when editing from review)
⋮----
/// Load recipients and populate Quick Add buttons
⋮----
public async Task LoadRecipientsAsync()
⋮----
// Load Quick Add recipients (top 5 for current employee)
var quickAddResult = await _recipientService.GetQuickAddRecipientsAsync(
⋮----
QuickAddRecipients.Clear();
⋮----
QuickAddRecipients.Add(recipient);
⋮----
// Load all active recipients for searchable list
var allRecipientsResult = await _recipientService.GetActiveRecipientsSortedByUsageAsync(0);
⋮----
_allRecipients.Clear();
⋮----
_allRecipients.Add(recipient);
⋮----
// Initially show all
⋮----
await _errorHandler.ShowUserErrorAsync(
⋮----
_errorHandler.HandleException(
⋮----
/// Quick Add button clicked - auto-select recipient and navigate to Step 3
⋮----
/// <param name="recipient"></param>
⋮----
private void QuickAddRecipient(Model_RoutingRecipient recipient)
⋮----
// Immediately proceed to Step 3
⋮----
/// Apply real-time search filter to recipient list
⋮----
private void ApplyFilter()
⋮----
FilteredRecipients.Clear();
⋮----
if (string.IsNullOrWhiteSpace(SearchText))
⋮----
// Show all when no search text
⋮----
FilteredRecipients.Add(recipient);
⋮----
// Filter by name, location, or department (case-insensitive)
// Issue #19: Optimized collection filtering - materialize before iteration
var searchLower = SearchText.ToLower();
var filtered = _allRecipients.Where(r =>
r.Name.ToLower().Contains(searchLower) ||
(r.Location?.ToLower().Contains(searchLower) ?? false) ||
(r.Department?.ToLower().Contains(searchLower) ?? false)).ToList();
⋮----
/// Trigger filter when search text changes
⋮----
partial void OnSearchTextChanged(string value)
⋮----
/// Proceed to Step 3 (Review)
⋮----
private void ProceedToStep3()
⋮----
_logger.LogInfo($"ProceedToStep3 called with recipient: {SelectedRecipient?.Name ?? "null"}");
⋮----
_logger.LogWarning("ProceedToStep3: No recipient selected");
⋮----
// Update container with selected recipient
⋮----
_logger.LogInfo($"Updated container with recipient: {SelectedRecipient.Name}");
⋮----
// Navigate to Step 3 (always goes to Step 3 whether editing or not)
_containerViewModel.NavigateToStep3Command.Execute(null);
_logger.LogInfo("Navigation to Step 3 triggered");
⋮----
_logger.LogError($"Error in ProceedToStep3: {ex.Message}", ex);
⋮----
/// Can proceed if recipient is selected
⋮----
private bool CanProceedToStep3()
⋮----
_logger.LogInfo($"CanProceedToStep3: {canProceed} (SelectedRecipient: {SelectedRecipient?.Name ?? "null"})");
⋮----
/// Go back to Step 1
⋮----
private void NavigateBackToStep1()
⋮----
_containerViewModel.NavigateToStep1Command.Execute(null);
⋮----
/// Get current employee number from session
/// Issue #7: Implemented using IService_UserSessionManager
⋮----
private int GetCurrentEmployeeNumber()
⋮----
/// Notify command can execute changed when selection changes
⋮----
partial void OnSelectedRecipientChanged(Model_RoutingRecipient? value)
⋮----
_logger.LogInfo($"Selected recipient changed to: {value?.Name ?? "null"}");
ProceedToStep3Command.NotifyCanExecuteChanged();
</file>

<file path="Module_Routing/ViewModels/RoutingWizardStep3ViewModel.cs">
/// <summary>
/// ViewModel for Wizard Step 3: Review and Confirm
/// </summary>
public partial class RoutingWizardStep3ViewModel : ObservableObject
⋮----
private readonly IRoutingService _routingService;
private readonly IService_ErrorHandler _errorHandler;
private readonly IService_LoggingUtility _logger;
private readonly RoutingWizardContainerViewModel _containerViewModel;
⋮----
// Register with container so it can trigger LoadReviewData
_containerViewModel.RegisterStep3ViewModel(this);
_logger.LogInfo("Step3ViewModel initialized and registered");
⋮----
/// Summary of label data for review
⋮----
/// Busy indicator
⋮----
/// Status message
⋮----
/// Load review data from container ViewModel
⋮----
public void LoadReviewData()
⋮----
_logger.LogInfo("LoadReviewData called");
_logger.LogInfo($"Container state - SelectedPOLine: {_containerViewModel.SelectedPOLine?.PartID ?? "null"}, SelectedRecipient: {_containerViewModel.SelectedRecipient?.Name ?? "null"}, FinalQuantity: {_containerViewModel.FinalQuantity}");
⋮----
// Load from container state
⋮----
// PO workflow
⋮----
PoLine = int.TryParse(_containerViewModel.SelectedPOLine.LineNumber, out var lineNum) ? lineNum : 0;
⋮----
_logger.LogInfo($"Loaded PO data - PO: {PoNumber}, Line: {PoLine}, Part: {PartID}");
⋮----
// OTHER workflow
⋮----
_logger.LogInfo($"Loaded OTHER data - Reason: {OtherReason}");
⋮----
_logger.LogWarning("LoadReviewData: No PO line or OTHER reason in container!");
⋮----
// Load recipient
⋮----
_logger.LogInfo($"Loaded recipient - Name: {RecipientName}, Location: {RecipientLocation}");
⋮----
_logger.LogWarning("LoadReviewData: No recipient in container!");
⋮----
// Load quantity
⋮----
_logger.LogInfo($"Final quantity: {Quantity}");
⋮----
/// Edit PO/Line selection (go back to Step 1)
⋮----
private void EditPOSelection()
⋮----
_logger.LogInfo("EditPOSelection - Navigating to Step 1 in edit mode");
_containerViewModel.NavigateToStep1ForEditCommand.Execute(null);
⋮----
/// Edit recipient selection (go back to Step 2)
⋮----
private void EditRecipientSelection()
⋮----
_logger.LogInfo("EditRecipientSelection - Navigating to Step 2 in edit mode");
_containerViewModel.NavigateToStep2ForEditCommand.Execute(null);
⋮----
/// Navigate back to Step 2 (standard back navigation)
⋮----
private void NavigateBack()
⋮----
_logger.LogInfo("NavigateBack - Navigating back to Step 2");
_containerViewModel.NavigateBackToStep2Command.Execute(null);
⋮----
/// Create the routing label with duplicate check
⋮----
private async Task CreateLabelAsync()
⋮----
// Check for duplicate labels (24-hour window)
var duplicateCheckResult = await _routingService.CheckDuplicateLabelAsync(
⋮----
PoLine.ToString(),
⋮----
// Duplicate found - show confirmation
⋮----
// Proceed with label creation via container ViewModel
⋮----
await _containerViewModel.CreateLabelCommand.ExecuteAsync(null);
⋮----
_errorHandler.HandleException(
⋮----
/// Show duplicate confirmation dialog
⋮----
private async Task<bool> ShowDuplicateConfirmationAsync()
⋮----
var dialog = new ContentDialog
⋮----
// Set XamlRoot for dialog
⋮----
var result = await dialog.ShowAsync();
</file>

<file path="Module_Routing/Views/RoutingEditModeView.xaml">
<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MTM_Receiving_Application.Module_Routing.Views.RoutingEditModeView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:viewmodels="using:MTM_Receiving_Application.Module_Routing.ViewModels"
    xmlns:models="using:MTM_Receiving_Application.Module_Routing.Models"
    xmlns:converters="using:MTM_Receiving_Application.Module_Routing.Converters"
    Loaded="OnPageLoaded">

    <Page.Resources>
        <converters:NullToBooleanConverter x:Key="NullToBooleanConverter"/>
    </Page.Resources>

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock 
            Grid.Row="0"
            Text="Edit Mode - Label History"
            Style="{StaticResource TitleTextBlockStyle}"/>

        <!-- Search Bar -->
        <Grid Grid.Row="1" ColumnSpacing="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBox
                Grid.Column="0"
                PlaceholderText="Search by PO, Recipient, or Part ID..."
                Text="{x:Bind ViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

            <Button
                Grid.Column="1"
                Content="Edit Selected"
                Command="{x:Bind EditSelectedLabelCommand}"
                IsEnabled="{x:Bind ViewModel.SelectedLabel, Mode=OneWay, Converter={StaticResource NullToBooleanConverter}}"/>

            <Button
                Grid.Column="2"
                Content="Reprint"
                Command="{x:Bind ViewModel.ReprintLabelCommand}"
                IsEnabled="{x:Bind ViewModel.SelectedLabel, Mode=OneWay, Converter={StaticResource NullToBooleanConverter}}"/>
        </Grid>

        <!-- Labels DataGrid -->
        <controls:DataGrid
            Grid.Row="2"
            ItemsSource="{x:Bind ViewModel.FilteredLabels, Mode=OneWay}"
            SelectedItem="{x:Bind ViewModel.SelectedLabel, Mode=TwoWay}"
            AutoGenerateColumns="False"
            IsReadOnly="True"
            AlternatingRowBackground="{ThemeResource LayerFillColorDefaultBrush}"
            SelectionMode="Single"
            DoubleTapped="OnDataGridDoubleTapped">
            
            <controls:DataGrid.Columns>
                <controls:DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="60"/>
                <controls:DataGridTextColumn Header="PO #" Binding="{Binding PONumber}" Width="100"/>
                <controls:DataGridTextColumn Header="Line" Binding="{Binding POLine}" Width="60"/>
                <controls:DataGridTextColumn Header="Part ID" Binding="{Binding PartID}" Width="120"/>
                <controls:DataGridTextColumn Header="Recipient" Binding="{Binding RecipientName}" Width="150"/>
                <controls:DataGridTextColumn Header="Quantity" Binding="{Binding Quantity}" Width="80"/>
                <controls:DataGridTextColumn Header="Date" Binding="{Binding CreatedDate}" Width="120"/>
                <controls:DataGridTextColumn Header="Creator" Binding="{Binding EmployeeNumber}" Width="80"/>
            </controls:DataGrid.Columns>
        </controls:DataGrid>

        <!-- Status Bar -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="12">
            <ProgressRing 
                IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                Width="20" Height="20"/>
            <TextBlock 
                Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                VerticalAlignment="Center"/>
        </StackPanel>
    </Grid>
</Page>
</file>

<file path="Module_Settings/Data/Dao_PackageType.cs">
/// <summary>
/// Data Access Object for package types CRUD operations
/// Instance-based pattern with connection string injection
/// </summary>
public class Dao_PackageType
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Retrieves all active package types
⋮----
public async Task<Model_Dao_Result<List<Model_PackageType>>> GetAllAsync()
⋮----
return await Helper_Database_StoredProcedure.ExecuteListAsync(
⋮----
/// Retrieves a package type by ID
⋮----
/// <param name="id"></param>
public async Task<Model_Dao_Result<Model_PackageType>> GetByIdAsync(int id)
⋮----
return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
⋮----
/// Inserts a new package type with validation
⋮----
/// <param name="packageType"></param>
/// <param name="createdBy"></param>
public async Task<Model_Dao_Result<int>> InsertAsync(Model_PackageType packageType, int createdBy)
⋮----
reader => reader.GetInt32(reader.GetOrdinal("id")),
⋮----
/// Updates an existing package type
⋮----
public async Task<Model_Dao_Result> UpdateAsync(Model_PackageType packageType)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
/// Deletes a package type (validates not in use)
⋮----
public async Task<Model_Dao_Result> DeleteAsync(int id)
⋮----
/// Gets usage count for a package type
⋮----
public async Task<Model_Dao_Result<int>> GetUsageCountAsync(int id)
⋮----
reader => reader.GetInt32(reader.GetOrdinal("usage_count")),
⋮----
/// Maps database reader to Model_PackageType
⋮----
/// <param name="reader"></param>
private static Model_PackageType MapFromReader(IDataReader reader)
⋮----
return new Model_PackageType
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
Name = reader.GetString(reader.GetOrdinal("name")),
Code = reader.GetString(reader.GetOrdinal("code")),
IsActive = reader.GetBoolean(reader.GetOrdinal("is_active")),
CreatedAt = reader.GetDateTime(reader.GetOrdinal("created_at")),
UpdatedAt = reader.GetDateTime(reader.GetOrdinal("updated_at")),
CreatedBy = reader.IsDBNull(reader.GetOrdinal("created_by")) ? null : reader.GetInt32(reader.GetOrdinal("created_by"))
</file>

<file path="Module_Settings/Data/Dao_RoutingRule.cs">
/// <summary>
/// Data Access Object for routing rules CRUD operations
/// Instance-based pattern with connection string injection
/// </summary>
public class Dao_RoutingRule
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Retrieves all active routing rules ordered by priority
⋮----
public async Task<Model_Dao_Result<List<Model_RoutingRule>>> GetAllAsync()
⋮----
return await Helper_Database_StoredProcedure.ExecuteListAsync(
⋮----
/// Retrieves a routing rule by ID
⋮----
/// <param name="id"></param>
public async Task<Model_Dao_Result<Model_RoutingRule>> GetByIdAsync(int id)
⋮----
return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
⋮----
/// Inserts a new routing rule with pattern matching
⋮----
/// <param name="rule"></param>
/// <param name="createdBy"></param>
public async Task<Model_Dao_Result<int>> InsertAsync(Model_RoutingRule rule, int createdBy)
⋮----
reader => reader.GetInt32(reader.GetOrdinal("id")),
⋮----
/// Updates an existing routing rule
⋮----
public async Task<Model_Dao_Result> UpdateAsync(Model_RoutingRule rule)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
/// Deletes a routing rule (soft delete)
⋮----
public async Task<Model_Dao_Result> DeleteAsync(int id)
⋮----
/// Finds the first matching routing rule for a value
⋮----
/// <param name="matchType"></param>
/// <param name="value"></param>
public async Task<Model_Dao_Result<Model_RoutingRule>> FindMatchAsync(string matchType, string value)
⋮----
/// Finds the first matching routing rule for a part number (spec compatibility)
⋮----
/// <param name="partNumber"></param>
public async Task<Model_Dao_Result<Model_RoutingRule>> GetByPartNumberAsync(string partNumber)
⋮----
/// Maps database reader to Model_RoutingRule
⋮----
/// <param name="reader"></param>
private static Model_RoutingRule MapFromReader(IDataReader reader)
⋮----
return new Model_RoutingRule
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
MatchType = reader.GetString(reader.GetOrdinal("match_type")),
Pattern = reader.GetString(reader.GetOrdinal("pattern")),
DestinationLocation = reader.GetString(reader.GetOrdinal("destination_location")),
Priority = reader.GetInt32(reader.GetOrdinal("priority")),
IsActive = reader.GetBoolean(reader.GetOrdinal("is_active")),
CreatedAt = reader.GetDateTime(reader.GetOrdinal("created_at")),
UpdatedAt = reader.GetDateTime(reader.GetOrdinal("updated_at")),
CreatedBy = reader.IsDBNull(reader.GetOrdinal("created_by")) ? null : reader.GetInt32(reader.GetOrdinal("created_by"))
</file>

<file path="Module_Settings/Data/Dao_SettingsAuditLog.cs">
/// <summary>
/// Data Access Object for settings audit log operations
/// Instance-based pattern with connection string injection
/// </summary>
public class Dao_SettingsAuditLog
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Retrieves audit log entries for a setting (most recent first)
⋮----
/// <param name="settingId"></param>
/// <param name="limit"></param>
public async Task<Model_Dao_Result<List<Model_SettingsAuditLog>>> GetAsync(int settingId, int limit)
⋮----
return await Helper_Database_StoredProcedure.ExecuteListAsync(
⋮----
/// Retrieves audit log entries for a specific setting (spec compatibility)
⋮----
public async Task<Model_Dao_Result<List<Model_SettingsAuditLog>>> GetBySettingAsync(int settingId, int limit)
⋮----
/// Retrieves audit log entries by user (spec compatibility)
⋮----
/// <param name="changedBy"></param>
⋮----
public async Task<Model_Dao_Result<List<Model_SettingsAuditLog>>> GetByUserAsync(int changedBy, int limit)
⋮----
private static Model_SettingsAuditLog MapFromReader(IDataReader reader)
⋮----
return new Model_SettingsAuditLog
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
SettingId = reader.GetInt32(reader.GetOrdinal("setting_id")),
Category = reader.GetString(reader.GetOrdinal("category")),
SettingKey = reader.GetString(reader.GetOrdinal("setting_key")),
SettingName = reader.GetString(reader.GetOrdinal("setting_name")),
UserSettingId = reader.IsDBNull(reader.GetOrdinal("user_setting_id"))
⋮----
: reader.GetInt32(reader.GetOrdinal("user_setting_id")),
OldValue = reader.IsDBNull(reader.GetOrdinal("old_value"))
⋮----
: reader.GetString(reader.GetOrdinal("old_value")),
NewValue = reader.IsDBNull(reader.GetOrdinal("new_value"))
⋮----
: reader.GetString(reader.GetOrdinal("new_value")),
ChangeType = reader.GetString(reader.GetOrdinal("change_type")),
ChangedBy = reader.GetInt32(reader.GetOrdinal("changed_by")),
ChangedAt = reader.GetDateTime(reader.GetOrdinal("changed_at")),
IpAddress = reader.IsDBNull(reader.GetOrdinal("ip_address"))
⋮----
: reader.GetString(reader.GetOrdinal("ip_address")),
WorkstationName = reader.IsDBNull(reader.GetOrdinal("workstation_name"))
⋮----
: reader.GetString(reader.GetOrdinal("workstation_name"))
</file>

<file path="Module_Volvo/Data/Dao_VolvoPartComponent.cs">
/// <summary>
/// Data Access Object for volvo_part_components table
/// Provides CRUD operations using stored procedures
/// </summary>
public class Dao_VolvoPartComponent
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Gets all components for a parent part (for component explosion)
⋮----
/// <param name="parentPartNumber"></param>
public async Task<Model_Dao_Result<List<Model_VolvoPartComponent>>> GetByParentPartAsync(string parentPartNumber)
⋮----
return await Helper_Database_StoredProcedure.ExecuteListAsync(
⋮----
/// Inserts a new component relationship
⋮----
/// <param name="component"></param>
public async Task<Model_Dao_Result> InsertAsync(Model_VolvoPartComponent component)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
/// Deletes all components for a parent part (used before updating component list)
⋮----
public async Task<Model_Dao_Result> DeleteByParentPartAsync(string parentPartNumber)
⋮----
/// Gets components for multiple parent parts (batch query to avoid N+1)
⋮----
/// <param name="parentPartNumbers"></param>
public async Task<Model_Dao_Result<Dictionary<string, List<Model_VolvoPartComponent>>>> GetComponentsByParentPartsAsync(
⋮----
// Batch query optimization - can be improved with stored proc
⋮----
private static Model_VolvoPartComponent MapFromReader(IDataReader reader)
⋮----
return new Model_VolvoPartComponent
⋮----
ComponentPartNumber = reader.GetString(reader.GetOrdinal("component_part_number")),
Quantity = reader.GetInt32(reader.GetOrdinal("quantity")),
ComponentQuantityPerSkid = reader.GetInt32(reader.GetOrdinal("component_quantity_per_skid"))
</file>

<file path="Module_Volvo/Services/Service_VolvoMasterData.cs">
/// <summary>
/// Service for managing Volvo parts master data including CRUD operations and CSV import/export
/// </summary>
public class Service_VolvoMasterData : IService_VolvoMasterData
⋮----
private readonly Dao_VolvoPart _daoPart;
private readonly Dao_VolvoPartComponent _daoComponent;
private readonly IService_LoggingUtility _logger;
private readonly IService_ErrorHandler _errorHandler;
⋮----
_daoPart = daoPart ?? throw new ArgumentNullException(nameof(daoPart));
_daoComponent = daoComponent ?? throw new ArgumentNullException(nameof(daoComponent));
_logger = logger ?? throw new ArgumentNullException(nameof(logger));
_errorHandler = errorHandler ?? throw new ArgumentNullException(nameof(errorHandler));
⋮----
public async Task<Model_Dao_Result<List<Model_VolvoPart>>> GetAllPartsAsync(bool includeInactive)
⋮----
await _logger.LogInfoAsync($"Getting all Volvo parts (includeInactive={includeInactive})");
var result = await _daoPart.GetAllAsync(includeInactive);
⋮----
await _logger.LogErrorAsync($"Failed to get parts: {result.ErrorMessage}");
⋮----
await _logger.LogErrorAsync($"Error getting all parts: {ex.Message}", ex);
await _errorHandler.HandleErrorAsync(
⋮----
public async Task<Model_Dao_Result<Model_VolvoPart?>> GetPartByNumberAsync(string partNumber)
⋮----
await _logger.LogInfoAsync($"Getting part by number: {partNumber}");
var result = await _daoPart.GetByIdAsync(partNumber);
⋮----
await _logger.LogErrorAsync($"Failed to get part {partNumber}: {result.ErrorMessage}");
⋮----
await _logger.LogErrorAsync($"Error getting part {partNumber}: {ex.Message}", ex);
⋮----
public async Task<Model_Dao_Result> AddPartAsync(Model_VolvoPart part, List<Model_VolvoPartComponent>? components = null)
⋮----
await _logger.LogInfoAsync($"Adding new part: {part.PartNumber}");
⋮----
// Validate input
if (string.IsNullOrWhiteSpace(part.PartNumber))
⋮----
return Model_Dao_Result_Factory.Failure("Part number is required");
⋮----
return Model_Dao_Result_Factory.Failure("Quantity per skid must be non-negative");
⋮----
// Insert new part
var insertResult = await _daoPart.InsertAsync(part);
⋮----
await _logger.LogErrorAsync($"Failed to insert part {part.PartNumber}: {insertResult.ErrorMessage}");
return Model_Dao_Result_Factory.Failure(insertResult.ErrorMessage);
⋮----
// Insert components if provided
⋮----
var componentResult = await _daoComponent.InsertAsync(component);
⋮----
await _logger.LogErrorAsync($"Failed to insert component {component.ComponentPartNumber}: {componentResult.ErrorMessage}");
return Model_Dao_Result_Factory.Failure($"Failed to save component {component.ComponentPartNumber}");
⋮----
await _logger.LogInfoAsync($"Successfully added part {part.PartNumber} with {components?.Count ?? 0} components");
return Model_Dao_Result_Factory.Success("Part added successfully");
⋮----
await _logger.LogErrorAsync($"Error adding part {part.PartNumber}: {ex.Message}", ex);
⋮----
return Model_Dao_Result_Factory.Failure($"Error adding part: {ex.Message}");
⋮----
public async Task<Model_Dao_Result> UpdatePartAsync(Model_VolvoPart part, List<Model_VolvoPartComponent>? components = null)
⋮----
await _logger.LogInfoAsync($"Updating part: {part.PartNumber}");
⋮----
// Update existing part
var updateResult = await _daoPart.UpdateAsync(part);
⋮----
await _logger.LogErrorAsync($"Failed to update part {part.PartNumber}: {updateResult.ErrorMessage}");
return Model_Dao_Result_Factory.Failure(updateResult.ErrorMessage);
⋮----
// Update components (delete existing and re-insert)
⋮----
// Delete existing components
var deleteResult = await _daoComponent.DeleteByParentPartAsync(part.PartNumber);
⋮----
await _logger.LogErrorAsync($"Failed to delete components for {part.PartNumber}: {deleteResult.ErrorMessage}");
return Model_Dao_Result_Factory.Failure($"Failed to update components: {deleteResult.ErrorMessage}");
⋮----
// Insert new components
⋮----
var insertResult = await _daoComponent.InsertAsync(component);
⋮----
await _logger.LogErrorAsync($"Failed to insert component {component.ComponentPartNumber}: {insertResult.ErrorMessage}");
⋮----
// No components - delete any existing ones
await _daoComponent.DeleteByParentPartAsync(part.PartNumber);
⋮----
await _logger.LogInfoAsync($"Successfully updated part {part.PartNumber} with {components?.Count ?? 0} components");
return Model_Dao_Result_Factory.Success("Part updated successfully");
⋮----
await _logger.LogErrorAsync($"Error updating part {part.PartNumber}: {ex.Message}", ex);
⋮----
return Model_Dao_Result_Factory.Failure($"Error updating part: {ex.Message}");
⋮----
public async Task<Model_Dao_Result> DeactivatePartAsync(string partNumber)
⋮----
await _logger.LogInfoAsync($"Deactivating part: {partNumber}");
⋮----
var result = await _daoPart.DeactivateAsync(partNumber);
⋮----
await _logger.LogErrorAsync($"Failed to deactivate part {partNumber}: {result.ErrorMessage}");
⋮----
await _logger.LogInfoAsync($"Successfully deactivated part {partNumber}");
⋮----
await _logger.LogErrorAsync($"Error deactivating part {partNumber}: {ex.Message}", ex);
return Model_Dao_Result_Factory.Failure($"Error deactivating part: {ex.Message}");
⋮----
public async Task<Model_Dao_Result<List<Model_VolvoPartComponent>>> GetComponentsAsync(string partNumber)
⋮----
await _logger.LogInfoAsync($"Getting components for part: {partNumber}");
var result = await _daoComponent.GetByParentPartAsync(partNumber);
⋮----
await _logger.LogErrorAsync($"Failed to get components for {partNumber}: {result.ErrorMessage}");
⋮----
await _logger.LogErrorAsync($"Error getting components for {partNumber}: {ex.Message}", ex);
⋮----
public async Task<Model_Dao_Result<(int New, int Updated, int Unchanged)>> ImportCsvAsync(string csvFilePath)
⋮----
await _logger.LogInfoAsync("Starting CSV import");
⋮----
if (string.IsNullOrWhiteSpace(csvFilePath))
⋮----
var lines = csvFilePath.Split('\n').Select(l => l.Trim()).Where(l => !string.IsNullOrEmpty(l)).ToList();
⋮----
// Validate header
⋮----
if (!header.Contains("PartNumber") || !header.Contains("QuantityPerSkid"))
⋮----
errors.Add($"Line {i + 1}: Invalid format - expected at least 3 fields");
⋮----
var partNumber = fields[0].Trim();
var quantityStr = fields[1].Trim();
var componentsStr = fields.Length > 2 ? fields[2].Trim() : "";
⋮----
if (!int.TryParse(quantityStr, out int quantity))
⋮----
errors.Add($"Line {i + 1}: Invalid quantity '{quantityStr}'");
⋮----
var part = new Model_VolvoPart
⋮----
// Parse components (format: "PART1:QTY1;PART2:QTY2")
⋮----
if (!string.IsNullOrWhiteSpace(componentsStr))
⋮----
var componentPairs = componentsStr.Split(';');
⋮----
var parts = pair.Split(':');
⋮----
if (int.TryParse(parts[1], out int compQty))
⋮----
components.Add(new Model_VolvoPartComponent
⋮----
ComponentPartNumber = parts[0].Trim(),
⋮----
// Check if exists
var existing = await _daoPart.GetByIdAsync(partNumber);
⋮----
Model_Dao_Result saveResult;
⋮----
errors.Add($"Line {i + 1}: {saveResult.ErrorMessage}");
⋮----
errors.Add($"Line {i + 1}: {ex.Message}");
⋮----
await _logger.LogInfoAsync(summary);
⋮----
summary += "\nErrors:\n" + string.Join("\n", errors);
⋮----
return Model_Dao_Result_Factory.Success((newCount, updatedCount, errorCount));
⋮----
await _logger.LogErrorAsync($"Error importing CSV: {ex.Message}", ex);
⋮----
public async Task<Model_Dao_Result<string>> ExportCsvAsync(string csvFilePath, bool includeInactive = false)
⋮----
await _logger.LogInfoAsync($"Exporting parts to CSV (includeInactive={includeInactive})");
⋮----
var csv = new StringBuilder();
csv.AppendLine("PartNumber,QuantityPerSkid,Components");
⋮----
componentsStr = string.Join(";", componentsResult.Data.Select(c => $"{c.ComponentPartNumber}:{c.Quantity}"));
⋮----
csv.AppendLine($"{EscapeCsvField(part.PartNumber ?? string.Empty)},{part.QuantityPerSkid},{EscapeCsvField(componentsStr)}");
⋮----
await _logger.LogInfoAsync($"Export complete: {partsResult.Data?.Count ?? 0} parts");
return Model_Dao_Result_Factory.Success(csv.ToString());
⋮----
await _logger.LogErrorAsync($"Error exporting CSV: {ex.Message}", ex);
⋮----
private string[] ParseCsvLine(string line)
⋮----
var currentField = new StringBuilder();
⋮----
fields.Add(currentField.ToString());
currentField.Clear();
⋮----
currentField.Append(c);
⋮----
return fields.ToArray();
⋮----
private string EscapeCsvField(string field)
⋮----
if (field.Contains(",") || field.Contains("\"") || field.Contains("\n"))
⋮----
return "\"" + field.Replace("\"", "\"\"") + "\"";
</file>

<file path="Module_Volvo/ViewModels/ViewModel_Volvo_History.cs">
/// <summary>
/// ViewModel for viewing and managing Volvo shipment history
/// </summary>
public partial class ViewModel_Volvo_History : ViewModel_Shared_Base
⋮----
private readonly IService_Volvo _volvoService;
⋮----
private DateTimeOffset? _startDate = DateTimeOffset.Now.AddDays(-30);
⋮----
_volvoService = volvoService ?? throw new ArgumentNullException(nameof(volvoService));
⋮----
private void GoBack()
⋮----
var contentFrame = mainWindow.GetContentFrame();
⋮----
contentFrame.GoBack();
⋮----
/// Loads shipment history based on current filters
⋮----
private async Task FilterAsync()
⋮----
var result = await _volvoService.GetHistoryAsync(
StartDate?.DateTime ?? DateTime.Now.AddDays(-30),
⋮----
History.Clear();
⋮----
History.Add(shipment);
⋮----
await _errorHandler.ShowUserErrorAsync(
⋮----
_errorHandler.HandleException(
⋮----
/// Views details for the selected shipment
⋮----
private async Task ViewDetailAsync()
⋮----
await _logger.LogInfoAsync($"Loading details for shipment ID: {SelectedShipment.Id}");
⋮----
// Get shipment lines
var result = await _volvoService.GetShipmentLinesAsync(SelectedShipment.Id);
⋮----
// Build detail message
⋮----
details.AppendLine($"Shipment #{SelectedShipment.ShipmentNumber}");
details.AppendLine($"Date: {SelectedShipment.ShipmentDate:d}");
details.AppendLine($"PO Number: {SelectedShipment.PONumber ?? "N/A"}");
details.AppendLine($"Receiver: {SelectedShipment.ReceiverNumber ?? "N/A"}");
details.AppendLine($"Status: {SelectedShipment.Status}");
details.AppendLine();
details.AppendLine($"Parts ({result.Data.Count}):");
⋮----
details.AppendLine($"  • {line.PartNumber}: {line.ReceivedSkidCount} skids ({line.CalculatedPieceCount} pieces)");
⋮----
details.AppendLine($"    ⚠ Discrepancy: Expected {line.ExpectedSkidCount} skids");
⋮----
if (!string.IsNullOrWhiteSpace(SelectedShipment.Notes))
⋮----
details.AppendLine($"Notes: {SelectedShipment.Notes}");
⋮----
// Show dialog
var dialog = new ContentDialog
⋮----
Content = new ScrollViewer
⋮----
Content = new TextBlock
⋮----
Text = details.ToString(),
⋮----
await dialog.ShowAsync();
⋮----
await _logger.LogInfoAsync($"Successfully loaded {result.Data.Count} lines");
⋮----
private bool CanViewDetail() => SelectedShipment != null && !IsBusy;
⋮----
/// Opens edit dialog for the selected shipment
⋮----
private async Task EditAsync()
⋮----
var linesResult = await _volvoService.GetShipmentLinesAsync(SelectedShipment.Id);
⋮----
// Get available parts for dropdown
// Note: This would normally come from a master data service
// For now, we'll create a placeholder collection
⋮----
// Create and show edit dialog
⋮----
// Convert List to ObservableCollection for binding
⋮----
dialog.LoadShipment(SelectedShipment, linesCollection, availableParts);
⋮----
var result = await dialog.ShowAsync();
⋮----
// Get updated data from dialog
var updatedShipment = dialog.GetUpdatedShipment();
var updatedLines = dialog.GetUpdatedLines();
⋮----
// Call service to update shipment
var updateResult = await _volvoService.UpdateShipmentAsync(
⋮----
// Refresh history
⋮----
private bool CanEdit() => SelectedShipment != null && !IsBusy;
⋮----
/// Exports history to CSV file
⋮----
private async Task ExportAsync()
⋮----
var result = await _volvoService.ExportHistoryToCsvAsync(
⋮----
if (result.IsSuccess && !string.IsNullOrEmpty(result.Data))
⋮----
// Save file picker would go here
⋮----
partial void OnSelectedShipmentChanged(Model_VolvoShipment? value)
⋮----
ViewDetailCommand.NotifyCanExecuteChanged();
EditCommand.NotifyCanExecuteChanged();
</file>

<file path="MTM_Receiving_Application.Tests/Module_Core/Data/Authentication/Dao_User_Tests.cs">
/// <summary>
/// Unit tests for Dao_User data access object.
/// Tests authentication, CRUD operations, validation, and configuration methods.
/// </summary>
public class Dao_User_Tests
⋮----
Helper_Database_Variables.GetConnectionString(useProduction: false);
⋮----
// ====================================================================
// Constructor Tests
⋮----
public void Constructor_ValidConnectionString_CreatesInstance()
⋮----
// Act
var dao = new Dao_User(TestConnectionString);
⋮----
// Assert
dao.Should().NotBeNull();
⋮----
public void Constructor_NullConnectionString_ThrowsArgumentNullException()
⋮----
Action act = () => new Dao_User(null!);
⋮----
act.Should().Throw<ArgumentNullException>().WithMessage("*connectionString*");
⋮----
public void Constructor_EmptyConnectionString_DoesNotThrow()
⋮----
Action act = () => new Dao_User(string.Empty);
⋮----
// Assert - Constructor doesn't validate empty strings, only null
act.Should().NotThrow();
⋮----
// GetUserByWindowsUsernameAsync Tests
⋮----
public async Task GetUserByWindowsUsernameAsync_ValidUsername_CallsStoredProcedure_Async()
⋮----
// Arrange
⋮----
// Act & Assert
// Note: This will fail without a real database connection
// In a real test environment, you would use a test database or mock the Helper class
var result = await dao.GetUserByWindowsUsernameAsync(username);
⋮----
// Basic assertion - detailed testing requires database/mocking infrastructure
result.Should().NotBeNull();
⋮----
public async Task GetUserByWindowsUsernameAsync_VariousUsernames_AcceptsInput_Async(
⋮----
// ValidateUserPinAsync Tests
⋮----
public async Task ValidateUserPinAsync_ValidCredentials_CallsStoredProcedure_Async()
⋮----
var result = await dao.ValidateUserPinAsync(username, pin);
⋮----
public async Task ValidateUserPinAsync_VariousInputs_AcceptsAllCombinations_Async(
⋮----
// CreateNewUserAsync Tests
⋮----
public async Task CreateNewUserAsync_ValidUser_ReturnsEmployeeNumber_Async()
⋮----
var result = await dao.CreateNewUserAsync(user, createdBy);
⋮----
// Success depends on database availability and stored procedure existence
⋮----
public async Task CreateNewUserAsync_NullVisualCredentials_HandlesGracefully_Async()
⋮----
public async Task CreateNewUserAsync_WithVisualCredentials_PassesParameters_Async()
⋮----
// IsWindowsUsernameUniqueAsync Tests
⋮----
public async Task IsWindowsUsernameUniqueAsync_WithoutExclusion_ChecksAllUsers_Async()
⋮----
var result = await dao.IsWindowsUsernameUniqueAsync(username);
⋮----
public async Task IsWindowsUsernameUniqueAsync_WithExclusion_ExcludesSpecificEmployee_Async()
⋮----
var result = await dao.IsWindowsUsernameUniqueAsync(username, excludeEmployeeNumber);
⋮----
public async Task IsWindowsUsernameUniqueAsync_VariousScenarios_HandlesAllCases_Async(
⋮----
var result = await dao.IsWindowsUsernameUniqueAsync(username, excludeId);
⋮----
// LogUserActivityAsync Tests
⋮----
public async Task LogUserActivityAsync_ValidData_LogsActivity_Async()
⋮----
var result = await dao.LogUserActivityAsync(eventType, username, workstation, details);
⋮----
public async Task LogUserActivityAsync_DifferentEventTypes_LogsCorrectly_Async(
⋮----
public async Task LogUserActivityAsync_NullParameters_HandlesGracefully_Async()
⋮----
var result = await dao.LogUserActivityAsync("event", null!, null!, null!);
⋮----
// GetSharedTerminalNamesAsync Tests
⋮----
public async Task GetSharedTerminalNamesAsync_NoParameters_ReturnsTerminalList_Async()
⋮----
var result = await dao.GetSharedTerminalNamesAsync();
⋮----
// UpsertWorkstationConfigAsync Tests
⋮----
public async Task UpsertWorkstationConfigAsync_ValidData_InsertsOrUpdates_Async()
⋮----
var result = await dao.UpsertWorkstationConfigAsync(
⋮----
public async Task UpsertWorkstationConfigAsync_NullDescription_HandlesGracefully_Async()
⋮----
var result = await dao.UpsertWorkstationConfigAsync("WS-01", "dedicated", true, null);
⋮----
public async Task UpsertWorkstationConfigAsync_VariousConfigurations_HandlesAll_Async(
⋮----
var result = await dao.UpsertWorkstationConfigAsync(name, type, active, description);
⋮----
// GetActiveDepartmentsAsync Tests
⋮----
public async Task GetActiveDepartmentsAsync_NoParameters_ReturnsDepartmentList_Async()
⋮----
var result = await dao.GetActiveDepartmentsAsync();
⋮----
// UpdateDefaultModeAsync Tests
⋮----
public async Task UpdateDefaultModeAsync_ValidData_UpdatesMode_Async()
⋮----
var result = await dao.UpdateDefaultModeAsync(userId, defaultMode);
⋮----
public async Task UpdateDefaultModeAsync_NullMode_HandlesGracefully_Async()
⋮----
var result = await dao.UpdateDefaultModeAsync(userId, null);
⋮----
public async Task UpdateDefaultModeAsync_VariousInputs_HandlesAll_Async(int userId, string? mode)
⋮----
var result = await dao.UpdateDefaultModeAsync(userId, mode);
⋮----
// UpdateDefaultReceivingModeAsync Tests
⋮----
public async Task UpdateDefaultReceivingModeAsync_ValidData_UpdatesMode_Async()
⋮----
var result = await dao.UpdateDefaultReceivingModeAsync(userId, defaultMode);
⋮----
public async Task UpdateDefaultReceivingModeAsync_DifferentModes_HandlesAll_Async(
⋮----
var result = await dao.UpdateDefaultReceivingModeAsync(userId, mode);
⋮----
// UpdateDefaultDunnageModeAsync Tests
⋮----
public async Task UpdateDefaultDunnageModeAsync_ValidData_UpdatesMode_Async()
⋮----
var result = await dao.UpdateDefaultDunnageModeAsync(userId, defaultMode);
⋮----
public async Task UpdateDefaultDunnageModeAsync_VariousModes_HandlesAll_Async(
⋮----
var result = await dao.UpdateDefaultDunnageModeAsync(userId, mode);
⋮----
// Edge Cases and Error Handling Tests
⋮----
public async Task GetUserByWindowsUsernameAsync_EmptyString_DoesNotThrow_Async()
⋮----
Func<Task> act = async () => await dao.GetUserByWindowsUsernameAsync(string.Empty);
⋮----
await act.Should().NotThrowAsync();
⋮----
public async Task ValidateUserPinAsync_SpecialCharactersInUsername_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.ValidateUserPinAsync(username, pin);
⋮----
public async Task CreateNewUserAsync_AllFieldsPopulated_PassesAllParameters_Async()
⋮----
var user = new Model_User
⋮----
Func<Task> act = async () => await dao.CreateNewUserAsync(user, createdBy);
⋮----
public async Task IsWindowsUsernameUniqueAsync_VeryLongUsername_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.IsWindowsUsernameUniqueAsync(longUsername);
⋮----
public async Task LogUserActivityAsync_LongDetails_HandlesGracefully_Async()
⋮----
await dao.LogUserActivityAsync("test_event", "user", "workstation", longDetails);
⋮----
public async Task UpsertWorkstationConfigAsync_VeryLongDescription_HandlesGracefully_Async()
⋮----
await dao.UpsertWorkstationConfigAsync("WS-01", "shared", true, longDescription);
⋮----
// Boundary Value Tests
⋮----
public async Task UpdateDefaultModeAsync_BoundaryUserIds_HandlesAll_Async(int userId)
⋮----
Func<Task> act = async () => await dao.UpdateDefaultModeAsync(userId, "mode");
⋮----
public async Task IsWindowsUsernameUniqueAsync_BoundaryExclusionValues_HandlesAll_Async(
⋮----
Func<Task> act = async () => await dao.IsWindowsUsernameUniqueAsync("user", excludeId);
⋮----
// Helper Methods
⋮----
/// Creates a valid test user model with all required fields populated.
⋮----
private static Model_User CreateValidTestUser()
⋮----
return new Model_User
</file>

<file path="MTM_Receiving_Application.Tests/Module_Dunnage/Data/Dao_DunnageLoad_Tests.cs">
/// <summary>
/// Unit tests for Dao_DunnageLoad data access object.
/// Tests CRUD operations, batch processing, and date range queries for dunnage loads.
/// Uses the mtm_receiving_application_test database.
/// </summary>
public class Dao_DunnageLoad_Tests
⋮----
private static string TestConnectionString => Helper_Database_Variables.GetConnectionString(useProduction: false);
⋮----
// ====================================================================
// Constructor Tests
⋮----
public void Constructor_ValidConnectionString_CreatesInstance()
⋮----
// Act
var dao = new Dao_DunnageLoad(TestConnectionString);
⋮----
// Assert
dao.Should().NotBeNull();
⋮----
public void Constructor_NullConnectionString_DoesNotThrow()
⋮----
Action act = () => new Dao_DunnageLoad(null!);
⋮----
act.Should().NotThrow();
⋮----
// GetAllAsync Tests
⋮----
public async Task GetAllAsync_NoParameters_CallsStoredProcedure_Async()
⋮----
// Arrange
⋮----
var result = await dao.GetAllAsync();
⋮----
result.Should().NotBeNull();
⋮----
// GetByDateRangeAsync Tests
⋮----
public async Task GetByDateRangeAsync_ValidDateRange_CallsStoredProcedure_Async()
⋮----
var startDate = DateTime.Now.AddDays(-30);
⋮----
var result = await dao.GetByDateRangeAsync(startDate, endDate);
⋮----
public async Task GetByDateRangeAsync_StartDateAfterEndDate_HandlesGracefully_Async()
⋮----
var endDate = DateTime.Now.AddDays(-30);
⋮----
public async Task GetByDateRangeAsync_SameDates_HandlesGracefully_Async()
⋮----
var result = await dao.GetByDateRangeAsync(date, date);
⋮----
public async Task GetByDateRangeAsync_VeryOldDates_HandlesGracefully_Async()
⋮----
var startDate = new DateTime(1900, 1, 1);
var endDate = new DateTime(1900, 12, 31);
⋮----
Func<Task> act = async () => await dao.GetByDateRangeAsync(startDate, endDate);
⋮----
await act.Should().NotThrowAsync();
⋮----
public async Task GetByDateRangeAsync_FutureDates_HandlesGracefully_Async()
⋮----
var startDate = DateTime.Now.AddYears(1);
var endDate = DateTime.Now.AddYears(2);
⋮----
public async Task GetByDateRangeAsync_VeryLargeRange_HandlesGracefully_Async()
⋮----
// GetByIdAsync Tests
⋮----
public async Task GetByIdAsync_ValidGuid_CallsStoredProcedure_Async()
⋮----
var loadUuid = Guid.NewGuid();
⋮----
var result = await dao.GetByIdAsync(loadUuid);
⋮----
public async Task GetByIdAsync_EmptyGuid_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.GetByIdAsync(loadUuid);
⋮----
public async Task GetByIdAsync_DifferentGuids_HandlesAll_Async()
⋮----
// Act & Assert
⋮----
var guid = Guid.NewGuid();
Func<Task> act = async () => await dao.GetByIdAsync(guid);
⋮----
// InsertAsync Tests
⋮----
public async Task InsertAsync_ValidParameters_CallsStoredProcedure_Async()
⋮----
var result = await dao.InsertAsync(loadUuid, partId, quantity, user);
⋮----
public async Task InsertAsync_DifferentParts_HandlesAll_Async(string partId, decimal quantity)
⋮----
public async Task InsertAsync_DifferentQuantities_HandlesAll_Async(decimal quantity)
⋮----
public async Task InsertAsync_DifferentUsers_HandlesAll_Async(string user)
⋮----
// InsertBatchAsync Tests
⋮----
public async Task InsertBatchAsync_ValidSingleLoad_CallsStoredProcedure_Async()
⋮----
var result = await dao.InsertBatchAsync(loads, user);
⋮----
public async Task InsertBatchAsync_MultipleLoads_CallsStoredProcedure_Async()
⋮----
public async Task InsertBatchAsync_VariousBatchSizes_HandlesAll_Async(int batchSize)
⋮----
loads.Add(CreateValidDunnageLoad());
⋮----
// UpdateAsync Tests
⋮----
public async Task UpdateAsync_ValidParameters_CallsStoredProcedure_Async()
⋮----
var result = await dao.UpdateAsync(loadUuid, quantity, user);
⋮----
public async Task UpdateAsync_DifferentQuantities_HandlesAll_Async(decimal quantity)
⋮----
public async Task UpdateAsync_EmptyGuid_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.UpdateAsync(loadUuid, quantity, user);
⋮----
// DeleteAsync Tests
⋮----
public async Task DeleteAsync_ValidGuid_CallsStoredProcedure_Async()
⋮----
var result = await dao.DeleteAsync(loadUuid);
⋮----
public async Task DeleteAsync_EmptyGuid_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.DeleteAsync(loadUuid);
⋮----
public async Task DeleteAsync_MultipleDeletes_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.DeleteAsync(guid);
⋮----
// Edge Cases and Boundary Value Tests
⋮----
public async Task InsertAsync_VeryLongPartId_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.InsertAsync(loadUuid, partId, quantity, user);
⋮----
public async Task InsertAsync_VeryLongUsername_HandlesGracefully_Async()
⋮----
public async Task InsertAsync_SpecialCharactersInPartId_HandlesGracefully_Async()
⋮----
public async Task InsertAsync_NegativeQuantity_HandlesGracefully_Async()
⋮----
public async Task InsertBatchAsync_EmptyList_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.InsertBatchAsync(loads, user);
⋮----
public async Task InsertBatchAsync_DuplicatePartIds_HandlesGracefully_Async()
⋮----
public async Task UpdateAsync_VeryLargeQuantity_HandlesGracefully_Async()
⋮----
public async Task UpdateAsync_VerySmallQuantity_HandlesGracefully_Async()
⋮----
// Helper Methods
⋮----
/// Creates a valid test dunnage load with all required fields populated.
⋮----
private static Model_DunnageLoad CreateValidDunnageLoad()
⋮----
return new Model_DunnageLoad
⋮----
LoadUuid = Guid.NewGuid(),
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Data/Dao_ReceivingLine_Tests.cs">
/// <summary>
/// Unit tests for Dao_ReceivingLine data access object.
/// Tests constructor validation and parameter handling without requiring database connection.
/// NOTE: These are UNIT tests, not integration tests. Database operations are tested separately.
/// </summary>
public class Dao_ReceivingLine_Tests
⋮----
private static string TestConnectionString => Helper_Database_Variables.GetConnectionString(useProduction: false);
⋮----
// ====================================================================
// Constructor Tests
⋮----
public void Constructor_ValidConnectionString_CreatesInstance()
⋮----
// Act
var dao = new Dao_ReceivingLine(TestConnectionString);
⋮----
// Assert
dao.Should().NotBeNull();
⋮----
public void Constructor_NullConnectionString_ThrowsArgumentNullException()
⋮----
Action act = () => new Dao_ReceivingLine(null!);
⋮----
act.Should().Throw<ArgumentNullException>()
.WithParameterName("connectionString");
⋮----
public void Constructor_EmptyConnectionString_DoesNotThrow()
⋮----
// NOTE: Constructor accepts empty string, but database operations will fail gracefully
⋮----
Action act = () => new Dao_ReceivingLine(string.Empty);
⋮----
act.Should().NotThrow();
⋮----
// InsertReceivingLineAsync Tests - Database Connection Failures
⋮----
public async Task InsertReceivingLineAsync_InvalidConnectionString_ReturnsFailureResult_Async()
⋮----
// Arrange - Use invalid connection string to simulate connection failure
var dao = new Dao_ReceivingLine("Server=invalid;Database=nonexistent;");
⋮----
var result = await dao.InsertReceivingLineAsync(line);
⋮----
// Assert - DAO MUST return failure result, NOT throw exception (Constitutional requirement)
result.Should().NotBeNull();
result.Success.Should().BeFalse("DAO must return failure result instead of throwing exception");
result.ErrorMessage.Should().NotBeNullOrEmpty();
result.Severity.Should().Be(Enum_ErrorSeverity.Error);
⋮----
// InsertReceivingLineAsync Tests - Parameter Handling
⋮----
public async Task InsertReceivingLineAsync_NullPartID_ReturnsResult_Async()
⋮----
// Arrange - Invalid connection ensures we're testing parameter construction, not DB
var dao = new Dao_ReceivingLine("Server=invalid;");
⋮----
// Assert - DAO handles null PartID by converting to empty string per implementation
⋮----
// Will fail due to connection, but that's expected - we're testing it doesn't throw
⋮----
public async Task InsertReceivingLineAsync_NullHeat_ReturnsResult_Async()
⋮----
// Arrange
⋮----
// Assert - DAO handles null Heat by converting to empty string per implementation
⋮----
public async Task InsertReceivingLineAsync_NullInitialLocation_ReturnsResult_Async()
⋮----
public async Task InsertReceivingLineAsync_NullCoilsOnSkid_ReturnsResult_Async()
⋮----
// Assert - DAO handles null CoilsOnSkid by converting to DBNull.Value per implementation
⋮----
public async Task InsertReceivingLineAsync_NullVendorName_ReturnsResult_Async()
⋮----
// Assert - DAO handles null VendorName by using "Unknown" per implementation
⋮----
public async Task InsertReceivingLineAsync_NullPartDescription_ReturnsResult_Async()
⋮----
// InsertReceivingLineAsync Tests - Value Range Handling
⋮----
public async Task InsertReceivingLineAsync_DifferentQuantities_HandlesAllValues_Async(int quantity)
⋮----
// Assert - DAO accepts all quantity values (validation is Service layer responsibility)
⋮----
public async Task InsertReceivingLineAsync_DifferentPONumbers_HandlesAllValues_Async(int poNumber)
⋮----
public async Task InsertReceivingLineAsync_AllFieldsPopulated_DoesNotThrow_Async()
⋮----
var line = new Model_ReceivingLine
⋮----
Func<Task> act = async () => await dao.InsertReceivingLineAsync(line);
⋮----
// Assert - DAO must not throw exceptions (Constitutional requirement)
await act.Should().NotThrowAsync();
⋮----
public async Task InsertReceivingLineAsync_MinimalFields_DoesNotThrow_Async()
⋮----
// Assert - DAO must not throw exceptions
⋮----
// Edge Cases and Boundary Value Tests
⋮----
public async Task InsertReceivingLineAsync_VeryLongPartID_DoesNotThrow_Async()
⋮----
// Assert - DAO passes value to DB, which will enforce length constraints
⋮----
public async Task InsertReceivingLineAsync_VeryLongHeat_DoesNotThrow_Async()
⋮----
public async Task InsertReceivingLineAsync_VeryLongPartDescription_DoesNotThrow_Async()
⋮----
public async Task InsertReceivingLineAsync_FutureDate_DoesNotThrow_Async()
⋮----
line.Date = DateTime.Now.AddYears(1);
⋮----
// Assert - Date validation is business logic, DAO just passes it through
⋮----
public async Task InsertReceivingLineAsync_PastDate_DoesNotThrow_Async()
⋮----
line.Date = DateTime.Now.AddYears(-10);
⋮----
public async Task InsertReceivingLineAsync_BoundaryCoilsOnSkid_DoesNotThrow_Async(int? coilsOnSkid)
⋮----
public async Task InsertReceivingLineAsync_BoundaryEmployeeNumbers_DoesNotThrow_Async(int employeeNumber)
⋮----
public async Task InsertReceivingLineAsync_SpecialCharactersInFields_DoesNotThrow_Async()
⋮----
// Assert - DAO should pass special characters safely (parameterized queries prevent SQL injection)
⋮----
// Constitutional Compliance Tests
⋮----
public async Task InsertReceivingLineAsync_DatabaseException_ReturnsFailureNotThrow_Async()
⋮----
// Arrange - Empty connection string will cause connection failure
var dao = new Dao_ReceivingLine(string.Empty);
⋮----
// Assert - CRITICAL: DAO MUST NOT throw exceptions per Constitutional Rule II
await act.Should().NotThrowAsync("DAO must return failure result instead of throwing exception");
⋮----
result.Success.Should().BeFalse();
⋮----
// Helper Methods
⋮----
/// Creates a valid test receiving line with all required fields populated.
⋮----
private static Model_ReceivingLine CreateValidReceivingLine()
⋮----
return new Model_ReceivingLine
</file>

<file path="MTM_Receiving_Application.Tests/Module_Receiving/Data/Dao_ReceivingLoad_Tests.cs">
/// <summary>
/// Unit tests for Dao_ReceivingLoad data access object.
/// Tests CRUD operations, transactions, and batch processing for receiving loads.
/// </summary>
public class Dao_ReceivingLoad_Tests
⋮----
private static string TestConnectionString => Helper_Database_Variables.GetConnectionString(useProduction: false);
⋮----
// ====================================================================
// Constructor Tests
⋮----
public void Constructor_ValidConnectionString_CreatesInstance()
⋮----
// Act
var dao = new Dao_ReceivingLoad(TestConnectionString);
⋮----
// Assert
dao.Should().NotBeNull();
⋮----
public void Constructor_NullConnectionString_ThrowsArgumentNullException()
⋮----
Action act = () => new Dao_ReceivingLoad(null!);
⋮----
act.Should().Throw<ArgumentNullException>()
.WithMessage("*connectionString*");
⋮----
// SaveLoadsAsync Tests
⋮----
public async Task SaveLoadsAsync_NullList_ReturnsFailure_Async()
⋮----
// Arrange
⋮----
var result = await dao.SaveLoadsAsync(null!);
⋮----
result.Should().NotBeNull();
result.Success.Should().BeFalse();
result.ErrorMessage.Should().Contain("null or empty");
⋮----
public async Task SaveLoadsAsync_EmptyList_ReturnsFailure_Async()
⋮----
var result = await dao.SaveLoadsAsync(loads);
⋮----
public async Task SaveLoadsAsync_ValidSingleLoad_CallsStoredProcedure_Async()
⋮----
public async Task SaveLoadsAsync_MultipleValidLoads_CallsStoredProcedure_Async()
⋮----
public async Task SaveLoadsAsync_NullPONumber_HandlesGracefully_Async()
⋮----
public async Task SaveLoadsAsync_CleansPONumberPrefix_HandlesAll_Async(string poNumber)
⋮----
public async Task SaveLoadsAsync_NonPOItem_HandlesGracefully_Async()
⋮----
// UpdateLoadsAsync Tests
⋮----
public async Task UpdateLoadsAsync_NullList_ReturnsFailure_Async()
⋮----
var result = await dao.UpdateLoadsAsync(null!);
⋮----
public async Task UpdateLoadsAsync_EmptyList_ReturnsFailure_Async()
⋮----
var result = await dao.UpdateLoadsAsync(loads);
⋮----
public async Task UpdateLoadsAsync_ValidSingleLoad_CallsStoredProcedure_Async()
⋮----
public async Task UpdateLoadsAsync_MultipleLoads_CallsStoredProcedure_Async()
⋮----
// DeleteLoadsAsync Tests
⋮----
public async Task DeleteLoadsAsync_NullList_ReturnsSuccess_Async()
⋮----
var result = await dao.DeleteLoadsAsync(null!);
⋮----
result.Success.Should().BeTrue();
result.Data.Should().Be(0);
⋮----
public async Task DeleteLoadsAsync_EmptyList_ReturnsSuccess_Async()
⋮----
var result = await dao.DeleteLoadsAsync(loads);
⋮----
public async Task DeleteLoadsAsync_ValidSingleLoad_CallsStoredProcedure_Async()
⋮----
public async Task DeleteLoadsAsync_MultipleLoads_CallsStoredProcedure_Async()
⋮----
// GetHistoryAsync Tests
⋮----
public async Task GetHistoryAsync_ValidParameters_CallsStoredProcedure_Async()
⋮----
var startDate = DateTime.Now.AddDays(-30);
⋮----
var result = await dao.GetHistoryAsync(partID, startDate, endDate);
⋮----
public async Task GetHistoryAsync_DifferentPartIDs_HandlesAll_Async(string partID)
⋮----
public async Task GetHistoryAsync_StartDateAfterEndDate_HandlesGracefully_Async()
⋮----
var endDate = DateTime.Now.AddDays(-30);
⋮----
public async Task GetHistoryAsync_SameDateRange_HandlesGracefully_Async()
⋮----
var result = await dao.GetHistoryAsync(partID, date, date);
⋮----
// GetAllAsync Tests
⋮----
public async Task GetAllAsync_ValidDateRange_CallsStoredProcedure_Async()
⋮----
var result = await dao.GetAllAsync(startDate, endDate);
⋮----
public async Task GetAllAsync_WideRange_HandlesGracefully_Async()
⋮----
var startDate = DateTime.Now.AddYears(-10);
var endDate = DateTime.Now.AddYears(1);
⋮----
// Edge Cases and Boundary Value Tests
⋮----
public async Task SaveLoadsAsync_DifferentWeights_HandlesAll_Async(decimal weight)
⋮----
public async Task SaveLoadsAsync_DifferentPackageCounts_HandlesAll_Async(int packageCount)
⋮----
public async Task SaveLoadsAsync_VeryLongPartID_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.SaveLoadsAsync(loads);
⋮----
await act.Should().NotThrowAsync();
⋮----
public async Task SaveLoadsAsync_VeryLongHeatNumber_HandlesGracefully_Async()
⋮----
public async Task SaveLoadsAsync_SpecialCharactersInFields_HandlesGracefully_Async()
⋮----
public async Task SaveLoadsAsync_VariousBatchSizes_HandlesAll_Async(int batchSize)
⋮----
loads.Add(CreateValidLoad());
⋮----
public async Task GetHistoryAsync_VeryOldDates_HandlesGracefully_Async()
⋮----
var startDate = new DateTime(1900, 1, 1);
var endDate = new DateTime(1900, 12, 31);
⋮----
Func<Task> act = async () => await dao.GetHistoryAsync("PART-001", startDate, endDate);
⋮----
public async Task GetAllAsync_FutureDates_HandlesGracefully_Async()
⋮----
var startDate = DateTime.Now.AddYears(1);
var endDate = DateTime.Now.AddYears(2);
⋮----
Func<Task> act = async () => await dao.GetAllAsync(startDate, endDate);
⋮----
// Helper Methods
⋮----
/// Creates a valid test receiving load with all required fields populated.
⋮----
private static Model_ReceivingLoad CreateValidLoad()
⋮----
return new Model_ReceivingLoad
⋮----
LoadID = Guid.NewGuid(),
</file>

<file path="MTM_Receiving_Application.Tests/Module_Routing/Data/Dao_RoutingLabel_Tests.cs">
/// <summary>
/// Unit tests for Dao_RoutingLabel data access object.
/// Tests CRUD operations, duplicate detection, and export tracking for routing labels.
/// </summary>
public class Dao_RoutingLabel_Tests
⋮----
private static string TestConnectionString => Helper_Database_Variables.GetConnectionString(useProduction: false);
⋮----
// ====================================================================
// Constructor Tests
⋮----
public void Constructor_ValidConnectionString_CreatesInstance()
⋮----
// Act
var dao = new Dao_RoutingLabel(TestConnectionString);
⋮----
// Assert
dao.Should().NotBeNull();
⋮----
public void Constructor_NullConnectionString_ThrowsArgumentNullException()
⋮----
Action act = () => new Dao_RoutingLabel(null!);
⋮----
act.Should().Throw<ArgumentNullException>()
.WithMessage("*connectionString*");
⋮----
// InsertLabelAsync Tests
⋮----
public async Task InsertLabelAsync_ValidLabel_CallsStoredProcedure_Async()
⋮----
// Arrange
⋮----
var result = await dao.InsertLabelAsync(label);
⋮----
result.Should().NotBeNull();
⋮----
public async Task InsertLabelAsync_NullOtherReasonId_HandlesGracefully_Async()
⋮----
public async Task InsertLabelAsync_WithOtherReasonId_HandlesGracefully_Async()
⋮----
public async Task InsertLabelAsync_DifferentQuantities_HandlesAll_Async(int quantity)
⋮----
public async Task InsertLabelAsync_DifferentPONumbers_HandlesAll_Async(string poNumber, string lineNumber)
⋮----
public async Task InsertLabelAsync_DifferentCreatedBy_HandlesAll_Async(int createdBy)
⋮----
// UpdateLabelAsync Tests
⋮----
public async Task UpdateLabelAsync_ValidLabel_CallsStoredProcedure_Async()
⋮----
var result = await dao.UpdateLabelAsync(label);
⋮----
public async Task UpdateLabelAsync_UpdatedQuantity_CallsStoredProcedure_Async()
⋮----
public async Task UpdateLabelAsync_NullOtherReasonId_HandlesGracefully_Async()
⋮----
public async Task UpdateLabelAsync_DifferentIds_HandlesAll_Async(int id)
⋮----
// GetLabelByIdAsync Tests
⋮----
public async Task GetLabelByIdAsync_ValidId_CallsStoredProcedure_Async()
⋮----
var result = await dao.GetLabelByIdAsync(labelId);
⋮----
public async Task GetLabelByIdAsync_DifferentIds_HandlesAll_Async(int labelId)
⋮----
public async Task GetLabelByIdAsync_NegativeId_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.GetLabelByIdAsync(labelId);
⋮----
await act.Should().NotThrowAsync();
⋮----
// GetAllLabelsAsync Tests
⋮----
public async Task GetAllLabelsAsync_DefaultParameters_CallsStoredProcedure_Async()
⋮----
var result = await dao.GetAllLabelsAsync();
⋮----
public async Task GetAllLabelsAsync_DifferentPagination_HandlesAll_Async(int limit, int offset)
⋮----
var result = await dao.GetAllLabelsAsync(limit, offset);
⋮----
public async Task GetAllLabelsAsync_ZeroLimit_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.GetAllLabelsAsync(0, 0);
⋮----
public async Task GetAllLabelsAsync_NegativeOffset_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.GetAllLabelsAsync(100, -10);
⋮----
// DeleteLabelAsync Tests
⋮----
public async Task DeleteLabelAsync_ValidId_CallsStoredProcedure_Async()
⋮----
var result = await dao.DeleteLabelAsync(labelId);
⋮----
public async Task DeleteLabelAsync_DifferentIds_HandlesAll_Async(int labelId)
⋮----
// MarkLabelExportedAsync Tests
⋮----
public async Task MarkLabelExportedAsync_ValidId_CallsStoredProcedure_Async()
⋮----
var result = await dao.MarkLabelExportedAsync(labelId);
⋮----
public async Task MarkLabelExportedAsync_DifferentIds_HandlesAll_Async(int labelId)
⋮----
// CheckDuplicateLabelAsync Tests
⋮----
public async Task CheckDuplicateLabelAsync_ValidParameters_CallsStoredProcedure_Async()
⋮----
var result = await dao.CheckDuplicateLabelAsync(poNumber, lineNumber, recipientId, hoursWindow);
⋮----
public async Task CheckDuplicateLabelAsync_DifferentTimeWindows_HandlesAll_Async(int hoursWindow)
⋮----
public async Task CheckDuplicateLabelAsync_ZeroHoursWindow_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.CheckDuplicateLabelAsync(poNumber, lineNumber, recipientId, 0);
⋮----
public async Task CheckDuplicateLabelAsync_DifferentPONumbers_HandlesAll_Async(string poNumber, string lineNumber)
⋮----
var result = await dao.CheckDuplicateLabelAsync(poNumber, lineNumber, recipientId, 24);
⋮----
// CheckDuplicateAsync Helper Tests
⋮----
public async Task CheckDuplicateAsync_ValidParameters_CallsCheckDuplicate_Async()
⋮----
var createdWithinDate = DateTime.Now.AddHours(-12);
⋮----
var result = await dao.CheckDuplicateAsync(poNumber, lineNumber, recipientId, createdWithinDate);
⋮----
public async Task CheckDuplicateAsync_DefaultDateTime_UsesDefault24Hours_Async()
⋮----
var result = await dao.CheckDuplicateAsync(poNumber, lineNumber, recipientId, default);
⋮----
public async Task CheckDuplicateAsync_FutureDate_HandlesGracefully_Async()
⋮----
var futureDate = DateTime.Now.AddDays(1);
⋮----
Func<Task> act = async () => await dao.CheckDuplicateAsync(poNumber, lineNumber, recipientId, futureDate);
⋮----
public async Task CheckDuplicateAsync_OldDate_CapsAtOneWeek_Async()
⋮----
var oldDate = DateTime.Now.AddDays(-30);
⋮----
Func<Task> act = async () => await dao.CheckDuplicateAsync(poNumber, lineNumber, recipientId, oldDate);
⋮----
// MarkExportedAsync Helper Tests
⋮----
public async Task MarkExportedAsync_EmptyList_HandlesGracefully_Async()
⋮----
var result = await dao.MarkExportedAsync(labelIds);
⋮----
public async Task MarkExportedAsync_SingleId_CallsMarkExported_Async()
⋮----
public async Task MarkExportedAsync_MultipleIds_CallsMarkExportedForEach_Async()
⋮----
// Edge Cases and Boundary Value Tests
⋮----
public async Task InsertLabelAsync_VeryLongDescription_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.InsertLabelAsync(label);
⋮----
public async Task InsertLabelAsync_SpecialCharactersInFields_HandlesGracefully_Async()
⋮----
public async Task InsertLabelAsync_ZeroQuantity_HandlesGracefully_Async()
⋮----
public async Task InsertLabelAsync_NegativeQuantity_HandlesGracefully_Async()
⋮----
public async Task InsertLabelAsync_BoundaryRecipientIds_HandlesAll_Async(int recipientId)
⋮----
public async Task GetAllLabelsAsync_VeryLargeLimit_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.GetAllLabelsAsync(int.MaxValue, 0);
⋮----
public async Task CheckDuplicateLabelAsync_VeryLargeTimeWindow_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.CheckDuplicateLabelAsync("PO-123", "001", 10, 99999);
⋮----
public async Task CheckDuplicateLabelAsync_NegativeTimeWindow_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.CheckDuplicateLabelAsync("PO-123", "001", 10, -24);
⋮----
// Helper Methods
⋮----
/// Creates a valid test routing label with all required fields populated.
⋮----
private static Model_RoutingLabel CreateValidRoutingLabel()
⋮----
return new Model_RoutingLabel
</file>

<file path="MTM_Receiving_Application.Tests/Module_Settings/Data/Dao_PackageType_Tests.cs">
/// <summary>
/// Unit tests for Dao_PackageType data access object.
/// Tests CRUD operations for package type management.
/// </summary>
public class Dao_PackageType_Tests
⋮----
private static string TestConnectionString => Helper_Database_Variables.GetConnectionString(useProduction: false);
⋮----
// ====================================================================
// Constructor Tests
⋮----
public void Constructor_ValidConnectionString_CreatesInstance()
⋮----
// Act
var dao = new Dao_PackageType(TestConnectionString);
⋮----
// Assert
dao.Should().NotBeNull();
⋮----
public void Constructor_NullConnectionString_ThrowsArgumentNullException()
⋮----
Action act = () => new Dao_PackageType(null!);
⋮----
act.Should().Throw<ArgumentNullException>()
.WithMessage("*connectionString*");
⋮----
// GetAllAsync Tests
⋮----
public async Task GetAllAsync_NoParameters_CallsStoredProcedure_Async()
⋮----
// Arrange
⋮----
var result = await dao.GetAllAsync();
⋮----
result.Should().NotBeNull();
⋮----
// GetByIdAsync Tests
⋮----
public async Task GetByIdAsync_ValidId_CallsStoredProcedure_Async()
⋮----
var result = await dao.GetByIdAsync(id);
⋮----
public async Task GetByIdAsync_DifferentIds_HandlesAll_Async(int id)
⋮----
public async Task GetByIdAsync_NegativeId_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.GetByIdAsync(id);
⋮----
await act.Should().NotThrowAsync();
⋮----
// InsertAsync Tests
⋮----
public async Task InsertAsync_ValidPackageType_CallsStoredProcedure_Async()
⋮----
var result = await dao.InsertAsync(packageType, createdBy);
⋮----
public async Task InsertAsync_MinimalData_CallsStoredProcedure_Async()
⋮----
var packageType = new Model_PackageType
⋮----
public async Task InsertAsync_DifferentTypes_HandlesAll_Async(string name, string code)
⋮----
public async Task InsertAsync_DifferentCreatedBy_HandlesAll_Async(int createdBy)
⋮----
// UpdateAsync Tests
⋮----
public async Task UpdateAsync_ValidPackageType_CallsStoredProcedure_Async()
⋮----
var result = await dao.UpdateAsync(packageType);
⋮----
public async Task UpdateAsync_AllFieldsChanged_CallsStoredProcedure_Async()
⋮----
public async Task UpdateAsync_DifferentIds_HandlesAll_Async(int id)
⋮----
// DeleteAsync Tests
⋮----
public async Task DeleteAsync_ValidId_CallsStoredProcedure_Async()
⋮----
var result = await dao.DeleteAsync(id);
⋮----
public async Task DeleteAsync_DifferentIds_HandlesAll_Async(int id)
⋮----
public async Task DeleteAsync_NegativeId_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.DeleteAsync(id);
⋮----
// GetUsageCountAsync Tests
⋮----
public async Task GetUsageCountAsync_ValidId_CallsStoredProcedure_Async()
⋮----
var result = await dao.GetUsageCountAsync(id);
⋮----
public async Task GetUsageCountAsync_DifferentIds_HandlesAll_Async(int id)
⋮----
// Edge Cases and Boundary Value Tests
⋮----
public async Task InsertAsync_VeryLongName_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.InsertAsync(packageType, createdBy);
⋮----
public async Task InsertAsync_VeryLongCode_HandlesGracefully_Async()
⋮----
public async Task InsertAsync_SpecialCharactersInName_HandlesGracefully_Async()
⋮----
public async Task InsertAsync_EmptyStrings_HandlesGracefully_Async()
⋮----
public async Task UpdateAsync_VeryLongName_HandlesGracefully_Async()
⋮----
Func<Task> act = async () => await dao.UpdateAsync(packageType);
⋮----
public async Task UpdateAsync_SpecialCharactersInCode_HandlesGracefully_Async()
⋮----
public async Task GetUsageCountAsync_BoundaryValues_HandlesAll_Async(int id)
⋮----
Func<Task> act = async () => await dao.GetUsageCountAsync(id);
⋮----
public async Task InsertAsync_NegativeCreatedBy_HandlesGracefully_Async()
⋮----
public async Task UpdateAsync_WithIdZero_HandlesGracefully_Async()
⋮----
// Helper Methods
⋮----
/// Creates a valid test package type with required fields populated.
⋮----
private static Model_PackageType CreateValidPackageType()
⋮----
return new Model_PackageType
</file>

<file path="MTM_Receiving_Application.Tests/UnitTest1.cs">
public class UnitTest1
⋮----
public void Test_BasicMath_ShouldPass()
⋮----
// Arrange
⋮----
// Act
⋮----
// Assert
result.Should().Be(expected);
⋮----
public void Test_StringOperation_ShouldPass()
⋮----
var result = testString.ToUpper();
⋮----
result.Should().Be("HELLO, WORLD!");
</file>

<file path="Module_Routing/Data/Dao_RoutingLabel.cs">
/// <summary>
/// Data Access Object for routing_label_data table
/// Provides CRUD operations using stored procedures
/// </summary>
public class Dao_RoutingLabel
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Inserts a new routing label record
⋮----
/// <param name="label"></param>
public async Task<Model_Dao_Result<int>> InsertLabelAsync(Model_RoutingLabel label)
⋮----
// Issue #32: Enhanced logging
Console.WriteLine($"[DAO] Inserting label: PO={label.PONumber}, Recipient={label.RecipientId}");
⋮----
new MySqlParameter("@p_po_number", label.PONumber),
new MySqlParameter("@p_line_number", label.LineNumber),
new MySqlParameter("@p_description", label.Description),
new MySqlParameter("@p_recipient_id", label.RecipientId),
new MySqlParameter("@p_quantity", label.Quantity),
new MySqlParameter("@p_created_by", label.CreatedBy),
new MySqlParameter("@p_other_reason_id", (object?)label.OtherReasonId ?? DBNull.Value),
new MySqlParameter("@p_new_label_id", MySqlDbType.Int32) { Direction = ParameterDirection.Output },
new MySqlParameter("@p_error_message", MySqlDbType.VarChar, 500) { Direction = ParameterDirection.Output }
⋮----
var result = await Helper_Database_StoredProcedure.ExecuteAsync(
⋮----
var newIdParam = Array.Find(parameters, p => p.ParameterName == "@p_new_label_id");
int newId = newIdParam?.Value != DBNull.Value ? Convert.ToInt32(newIdParam?.Value) : 0;
⋮----
// Issue #12: Extract output parameters for better error reporting
var errorMsgParam = Array.Find(parameters, p => p.ParameterName == "@p_error_message");
⋮----
if (!string.IsNullOrEmpty(spErrorMsg))
⋮----
/// Updates an existing routing label
⋮----
public async Task<Model_Dao_Result> UpdateLabelAsync(Model_RoutingLabel label)
⋮----
{            // Issue #32: Enhanced logging
Console.WriteLine($"[DAO] Updating label {label.Id}");
⋮----
new MySqlParameter("@p_label_id", label.Id),
⋮----
new MySqlParameter("@p_status", MySqlDbType.Int32) { Direction = ParameterDirection.Output },
new MySqlParameter("@p_error_msg", MySqlDbType.VarChar, 500) { Direction = ParameterDirection.Output }
⋮----
return await Helper_Database_StoredProcedure.ExecuteAsync(
⋮----
return Model_Dao_Result_Factory.Failure($"Error updating routing label: {ex.Message}", ex);
⋮----
/// Retrieves a single label by ID
⋮----
/// <param name="labelId"></param>
public async Task<Model_Dao_Result<Model_RoutingLabel>> GetLabelByIdAsync(int labelId)
⋮----
/// Retrieves all labels with pagination
⋮----
/// <param name="limit"></param>
/// <param name="offset"></param>
public async Task<Model_Dao_Result<List<Model_RoutingLabel>>> GetAllLabelsAsync(int limit = 100, int offset = 0)
⋮----
/// Soft deletes a label
⋮----
public async Task<Model_Dao_Result> DeleteLabelAsync(int labelId)
⋮----
new MySqlParameter("@p_label_id", labelId),
⋮----
return Model_Dao_Result_Factory.Failure($"Error deleting routing label: {ex.Message}", ex);
⋮----
/// Marks label as CSV exported
⋮----
public async Task<Model_Dao_Result> MarkLabelExportedAsync(int labelId)
⋮----
return Model_Dao_Result_Factory.Failure($"Error marking label as exported: {ex.Message}", ex);
⋮----
/// Checks for duplicate labels within time window
⋮----
/// <param name="poNumber"></param>
/// <param name="lineNumber"></param>
/// <param name="recipientId"></param>
/// <param name="hoursWindow"></param>
public async Task<Model_Dao_Result<Model_RoutingLabel>> CheckDuplicateLabelAsync(
⋮----
/// Maps IDataReader to Model_RoutingLabel
⋮----
/// <param name="reader"></param>
private Model_RoutingLabel MapFromReader(IDataReader reader)
⋮----
// Issue #17: Standardized null handling - use IsDBNull consistently
return new Model_RoutingLabel
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
PONumber = reader.IsDBNull(reader.GetOrdinal("po_number")) ? string.Empty : reader.GetString(reader.GetOrdinal("po_number")),
LineNumber = reader.IsDBNull(reader.GetOrdinal("line_number")) ? string.Empty : reader.GetString(reader.GetOrdinal("line_number")),
Description = reader.IsDBNull(reader.GetOrdinal("description")) ? string.Empty : reader.GetString(reader.GetOrdinal("description")),
RecipientId = reader.GetInt32(reader.GetOrdinal("recipient_id")),
RecipientName = reader.IsDBNull(reader.GetOrdinal("recipient_name")) ? string.Empty : reader.GetString(reader.GetOrdinal("recipient_name")),
RecipientLocation = reader.IsDBNull(reader.GetOrdinal("recipient_location")) ? string.Empty : reader.GetString(reader.GetOrdinal("recipient_location")),
Quantity = reader.GetInt32(reader.GetOrdinal("quantity")),
CreatedBy = reader.GetInt32(reader.GetOrdinal("created_by")),
CreatedDate = reader.GetDateTime(reader.GetOrdinal("created_date")),
OtherReasonId = reader.IsDBNull(reader.GetOrdinal("other_reason_id")) ? null : reader.GetInt32(reader.GetOrdinal("other_reason_id")),
OtherReasonDescription = reader.IsDBNull(reader.GetOrdinal("other_reason_description")) ? null : reader.GetString(reader.GetOrdinal("other_reason_description")),
IsActive = true,  // Always true from query (WHERE is_active = 1)
CsvExported = reader.GetBoolean(reader.GetOrdinal("csv_exported")),
CsvExportDate = reader.IsDBNull(reader.GetOrdinal("csv_export_date")) ? null : reader.GetDateTime(reader.GetOrdinal("csv_export_date"))
⋮----
public async Task<Model_Dao_Result<(bool Exists, int? ExistingLabelId)>> CheckDuplicateAsync(string poNumber, string lineNumber, int recipientId, DateTime createdWithinDate)
⋮----
// Issue #8: Use DateTime parameter to calculate hours window
⋮----
? 24  // Default to 24 hours if no date provided
⋮----
// Ensure positive hours value
⋮----
hours = 168; // Cap at 1 week
⋮----
return Model_Dao_Result_Factory.Success((Exists: true, ExistingLabelId: (int?)result.Data.Id));
⋮----
return Model_Dao_Result_Factory.Success((Exists: false, ExistingLabelId: (int?)null));
⋮----
public async Task<Model_Dao_Result> MarkExportedAsync(List<int> labelIds)
⋮----
return Model_Dao_Result_Factory.Success();
</file>

<file path="Module_Routing/Data/Dao_RoutingLabelHistory.cs">
/// <summary>
/// Data Access Object for routing_history table
/// </summary>
public class Dao_RoutingLabelHistory
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Inserts a history entry for label edit
⋮----
/// <param name="history"></param>
public async Task<Model_Dao_Result> InsertHistoryAsync(Model_RoutingLabelHistory history)
⋮----
new MySqlParameter("@p_label_id", history.LabelId),
new MySqlParameter("@p_field_changed", history.FieldChanged),
new MySqlParameter("@p_old_value", (object?)history.OldValue ?? DBNull.Value),
new MySqlParameter("@p_new_value", (object?)history.NewValue ?? DBNull.Value),
new MySqlParameter("@p_edited_by", history.EditedBy),
new MySqlParameter("@p_status", MySqlDbType.Int32) { Direction = System.Data.ParameterDirection.Output },
new MySqlParameter("@p_error_msg", MySqlDbType.VarChar, 500) { Direction = System.Data.ParameterDirection.Output }
⋮----
return await Helper_Database_StoredProcedure.ExecuteAsync(
⋮----
return Model_Dao_Result_Factory.Failure($"Error inserting history: {ex.Message}", ex);
⋮----
/// Issue #18: Batch inserts multiple history entries to avoid N+1 query problem
⋮----
/// <param name="historyEntries">List of history entries to insert</param>
/// <returns>Result indicating success or failure</returns>
public async Task<Model_Dao_Result> InsertHistoryBatchAsync(List<Model_RoutingLabelHistory> historyEntries)
⋮----
return Model_Dao_Result_Factory.Success("No history entries to insert", 0);
⋮----
return Model_Dao_Result_Factory.Failure($"Batch insert failed at entry {successCount + 1}: {result.ErrorMessage}");
⋮----
return Model_Dao_Result_Factory.Success($"Inserted {successCount} history entries", successCount);
⋮----
return Model_Dao_Result_Factory.Failure($"Error in batch insert: {ex.Message}", ex);
</file>

<file path="Module_Routing/Services/RoutingInforVisualService.cs">
/// <summary>
/// Service for Infor Visual ERP integration (READ ONLY)
/// Provides PO validation and line retrieval with graceful degradation
/// </summary>
public class RoutingInforVisualService : IRoutingInforVisualService
⋮----
private readonly Dao_InforVisualPO _daoInforVisualPO;
private readonly IService_LoggingUtility _logger;
⋮----
_daoInforVisualPO = daoInforVisualPO ?? throw new ArgumentNullException(nameof(daoInforVisualPO));
_logger = logger ?? throw new ArgumentNullException(nameof(logger));
⋮----
/// Validates that a PO number exists in Infor Visual ERP
⋮----
/// <param name="poNumber">PO number to validate</param>
/// <returns>Result with true if PO exists, false otherwise</returns>
public async Task<Model_Dao_Result<bool>> ValidatePoNumberAsync(string poNumber)
⋮----
await _logger.LogInfoAsync($"Validating PO number: {poNumber}");
⋮----
await _logger.LogInfoAsync($"[MOCK DATA MODE] Validating PO {poNumber}");
return Model_Dao_Result_Factory.Success(true);
⋮----
// Check connection first (graceful degradation)
var connectionResult = await _daoInforVisualPO.CheckConnectionAsync();
⋮----
await _logger.LogWarningAsync($"Infor Visual unavailable: {connectionResult.ErrorMessage}");
// Graceful degradation: return success but log the issue
⋮----
return await _daoInforVisualPO.ValidatePOAsync(poNumber);
⋮----
await _logger.LogErrorAsync($"Error validating PO {poNumber}: {ex.Message}", ex);
⋮----
/// Retrieves all line items for a purchase order from Infor Visual
⋮----
/// <param name="poNumber">PO number</param>
/// <returns>Result with list of PO lines</returns>
public async Task<Model_Dao_Result<List<Model_InforVisualPOLine>>> GetPoLinesAsync(string poNumber)
⋮----
await _logger.LogInfoAsync($"Getting PO lines for: {poNumber}");
⋮----
await _logger.LogInfoAsync($"[MOCK DATA MODE] Returning mock lines for PO {poNumber}");
⋮----
new Model_InforVisualPOLine
⋮----
return Model_Dao_Result_Factory.Success(mockLines);
⋮----
return await _daoInforVisualPO.GetLinesAsync(poNumber);
⋮----
// Issue #11: Standardized error handling pattern
await _logger.LogErrorAsync($"Error getting PO lines for {poNumber}: {ex.Message}", ex);
⋮----
/// Retrieves a specific line item from a purchase order
⋮----
/// <param name="lineNumber">Line number</param>
/// <returns>Result with PO line data</returns>
public async Task<Model_Dao_Result<Model_InforVisualPOLine>> GetPoLineAsync(string poNumber, string lineNumber)
⋮----
await _logger.LogInfoAsync($"Getting PO line {poNumber}-{lineNumber}");
⋮----
await _logger.LogInfoAsync($"[MOCK DATA MODE] Returning mock data for line {lineNumber}");
var mockLine = new Model_InforVisualPOLine
⋮----
PartID = $"MOCK-PART-{lineNumber.PadLeft(3, '0')}",
⋮----
return Model_Dao_Result_Factory.Success(mockLine);
⋮----
if (!int.TryParse(lineNumber, out int lineNum))
⋮----
return await _daoInforVisualPO.GetLineAsync(poNumber, lineNum);
⋮----
await _logger.LogErrorAsync($"Error getting PO line {poNumber}-{lineNumber}: {ex.Message}", ex);
⋮----
/// Tests connection to Infor Visual database
⋮----
/// <returns>Result with true if connection successful</returns>
public async Task<Model_Dao_Result<bool>> CheckConnectionAsync()
⋮----
return await _daoInforVisualPO.CheckConnectionAsync();
⋮----
await _logger.LogErrorAsync($"Error checking Infor Visual connection: {ex.Message}", ex);
return Model_Dao_Result_Factory.Success(false);
</file>

<file path="Module_Routing/Views/RoutingWizardStep3View.xaml">
<Page
    x:Class="MTM_Receiving_Application.Module_Routing.Views.RoutingWizardStep3View"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:MTM_Receiving_Application.Module_Routing.ViewModels"
    xmlns:coreConverters="using:MTM_Receiving_Application.Module_Core.Converters"
    Loaded="OnPageLoaded">

    <Page.Resources>
        <coreConverters:Converter_BooleanToVisibility x:Key="BooleanToVisibilityConverter"/>
    </Page.Resources>

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" 
                   Text="Step 3: Review and Confirm" 
                   Style="{StaticResource TitleTextBlockStyle}"/>

        <!-- Review Cards -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <Grid ColumnSpacing="24" RowSpacing="24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Source Card (PO & Part) -->
                <Border Grid.Column="0" Grid.Row="0"
                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20">
                    <StackPanel Spacing="16">
                        <Grid>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE8B9;" FontSize="16" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                <TextBlock Text="Source" Style="{ThemeResource SubtitleTextBlockStyle}"/>
                            </StackPanel>
                            <Button HorizontalAlignment="Right"
                                    Command="{x:Bind ViewModel.EditPOSelectionCommand}"
                                    Style="{StaticResource SubtleButtonStyle}" 
                                    ToolTipService.ToolTip="Edit Source">
                                <FontIcon Glyph="&#xE70F;" FontSize="14"/>
                            </Button>
                        </Grid>
                        
                        <MenuFlyoutSeparator/>

                        <!-- PO Info -->
                        <Grid ColumnSpacing="12" RowSpacing="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Text="PO:" FontWeight="SemiBold" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock Grid.Column="1" Text="{x:Bind ViewModel.PoNumber, Mode=OneWay}" FontWeight="SemiBold"/>

                            <TextBlock Grid.Row="1" Text="Line:" FontWeight="SemiBold" Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       Visibility="{x:Bind ViewModel.IsOtherWorkflow, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{x:Bind ViewModel.PoLine, Mode=OneWay}"
                                       Visibility="{x:Bind ViewModel.IsOtherWorkflow, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}"/>
                                       
                            <TextBlock Grid.Row="1" Text="Reason:" FontWeight="SemiBold" Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       Visibility="{x:Bind ViewModel.IsOtherWorkflow, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{x:Bind ViewModel.OtherReason, Mode=OneWay}"
                                       Visibility="{x:Bind ViewModel.IsOtherWorkflow, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        </Grid>
                        
                        <!-- Part Info -->
                        <Grid Background="{ThemeResource LayerFillColorDefaultBrush}" CornerRadius="4" Padding="12">
                             <StackPanel Spacing="4">
                                <TextBlock Text="{x:Bind ViewModel.PartID, Mode=OneWay}" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                                <TextBlock Text="{x:Bind ViewModel.PartDescription, Mode=OneWay}" TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <StackPanel Orientation="Horizontal" Spacing="4" Margin="0,8,0,0">
                                    <TextBlock Text="Qty:" FontWeight="SemiBold"/>
                                    <TextBlock Text="{x:Bind ViewModel.Quantity, Mode=OneWay}"/>
                                </StackPanel>
                             </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Destination Card (Recipient) -->
                <Border Grid.Column="1" Grid.Row="0"
                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20">
                     <StackPanel Spacing="16">
                        <Grid>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE77B;" FontSize="16" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                <TextBlock Text="Destination" Style="{ThemeResource SubtitleTextBlockStyle}"/>
                            </StackPanel>
                            <Button HorizontalAlignment="Right"
                                    Command="{x:Bind ViewModel.EditRecipientSelectionCommand}"
                                    Style="{StaticResource SubtleButtonStyle}"
                                    ToolTipService.ToolTip="Edit Destination">
                                <FontIcon Glyph="&#xE70F;" FontSize="14"/>
                            </Button>
                        </Grid>

                        <MenuFlyoutSeparator/>

                        <StackPanel Spacing="12">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Recipient" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12"/>
                                <TextBlock Text="{x:Bind ViewModel.RecipientName, Mode=OneWay}" Style="{ThemeResource BodyStrongTextBlockStyle}" FontSize="16"/>
                            </StackPanel>
                            
                            <StackPanel Spacing="4">
                                <TextBlock Text="Location / Department" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12"/>
                                <TextBlock Text="{x:Bind ViewModel.RecipientLocation, Mode=OneWay}"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Placeholder for Label Preview -->
                        <Border Height="60" Background="{ThemeResource LayerFillColorDefaultBrush}" CornerRadius="4" VerticalAlignment="Bottom" Margin="0,16,0,0">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="8">
                                <FontIcon Glyph="&#xE743;" FontSize="16" Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                <TextBlock Text="Ready to Print" Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>
            </Grid>
        </ScrollViewer>

        <!-- Status Bar -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="12">
            <ProgressRing IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                          Width="20" Height="20"/>
            <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                       VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right">
            <Button Content="Back"
                    Command="{x:Bind ViewModel.NavigateBackCommand}"/>
            <Button Content="Create Label"
                    Command="{x:Bind ViewModel.CreateLabelCommand}"
                    Style="{StaticResource AccentButtonStyle}"/>
        </StackPanel>
    </Grid>
</Page>
</file>

<file path="Module_Volvo/Data/Dao_VolvoPart.cs">
/// <summary>
/// Data Access Object for volvo_masterdata table
/// Provides CRUD operations using stored procedures
/// </summary>
public class Dao_VolvoPart
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Gets all Volvo parts (optionally including inactive)
⋮----
/// <param name="includeInactive"></param>
public async Task<Model_Dao_Result<List<Model_VolvoPart>>> GetAllAsync(bool includeInactive = false)
⋮----
return await Helper_Database_StoredProcedure.ExecuteListAsync(
⋮----
/// Gets a part by part number
⋮----
/// <param name="partNumber"></param>
public async Task<Model_Dao_Result<Model_VolvoPart>> GetByIdAsync(string partNumber)
⋮----
return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
⋮----
/// Inserts a new Volvo part
⋮----
/// <param name="part"></param>
public async Task<Model_Dao_Result> InsertAsync(Model_VolvoPart part)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
/// Updates an existing Volvo part
⋮----
public async Task<Model_Dao_Result> UpdateAsync(Model_VolvoPart part)
⋮----
/// Deactivates a Volvo part (soft delete)
/// Checks for active shipment references before deactivation
⋮----
public async Task<Model_Dao_Result> DeactivateAsync(string partNumber)
⋮----
// Check for active references
⋮----
{ "active_reference_count", 0 } // OUT parameter
⋮----
var checkResult = await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
// Note: Output parameters not yet supported by helper - skip check for now
// TODO: Implement when stored proc helper supports OUT parameters
// For now, cascade protection is logged but not enforced
⋮----
// Safe to deactivate
⋮----
/// Gets multiple parts by part numbers (batch query to avoid N+1)
⋮----
/// <param name="partNumbers"></param>
public async Task<Model_Dao_Result<Dictionary<string, Model_VolvoPart>>> GetPartsByNumbersAsync(List<string> partNumbers)
⋮----
// For now, use multiple queries (better than N+1, can be optimized with stored proc)
⋮----
private static Model_VolvoPart MapFromReader(IDataReader reader)
⋮----
return new Model_VolvoPart
⋮----
PartNumber = reader.GetString(reader.GetOrdinal("part_number")),
QuantityPerSkid = reader.GetInt32(reader.GetOrdinal("quantity_per_skid")),
IsActive = reader.GetBoolean(reader.GetOrdinal("is_active")),
CreatedDate = reader.GetDateTime(reader.GetOrdinal("created_date")),
ModifiedDate = reader.GetDateTime(reader.GetOrdinal("modified_date"))
</file>

<file path="Module_Volvo/Data/Dao_VolvoSettings.cs">
/// <summary>
/// Data Access Object for Volvo settings operations
/// </summary>
public class Dao_VolvoSettings
⋮----
/// Gets a specific setting by key
⋮----
/// <param name="settingKey"></param>
public async Task<Model_Dao_Result<Model_VolvoSetting>> GetSettingAsync(string settingKey)
⋮----
return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
⋮----
/// Gets all settings, optionally filtered by category
⋮----
/// <param name="category"></param>
public async Task<Model_Dao_Result<List<Model_VolvoSetting>>> GetAllSettingsAsync(string? category = null)
⋮----
return await Helper_Database_StoredProcedure.ExecuteListAsync(
⋮----
/// Inserts or updates a setting value
⋮----
/// <param name="settingValue"></param>
/// <param name="modifiedBy"></param>
public async Task<Model_Dao_Result> UpsertSettingAsync(string settingKey, string settingValue, string modifiedBy)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
/// Resets a setting to its default value
⋮----
public async Task<Model_Dao_Result> ResetSettingAsync(string settingKey, string modifiedBy)
⋮----
/// Maps DataReader to Model_VolvoSetting
⋮----
/// <param name="reader"></param>
private static Model_VolvoSetting MapFromReader(IDataReader reader)
⋮----
return new Model_VolvoSetting
⋮----
SettingKey = reader.GetString(reader.GetOrdinal("setting_key")),
SettingValue = reader.GetString(reader.GetOrdinal("setting_value")),
SettingType = reader.GetString(reader.GetOrdinal("setting_type")),
Category = reader.GetString(reader.GetOrdinal("category")),
Description = reader.IsDBNull(reader.GetOrdinal("description"))
⋮----
: reader.GetString(reader.GetOrdinal("description")),
DefaultValue = reader.GetString(reader.GetOrdinal("default_value")),
MinValue = reader.IsDBNull(reader.GetOrdinal("min_value"))
⋮----
: reader.GetInt32(reader.GetOrdinal("min_value")),
MaxValue = reader.IsDBNull(reader.GetOrdinal("max_value"))
⋮----
: reader.GetInt32(reader.GetOrdinal("max_value")),
ModifiedDate = reader.GetDateTime(reader.GetOrdinal("modified_date")),
ModifiedBy = reader.IsDBNull(reader.GetOrdinal("modified_by"))
⋮----
: reader.GetString(reader.GetOrdinal("modified_by"))
</file>

<file path="Module_Volvo/Data/Dao_VolvoShipmentLine.cs">
/// <summary>
/// Data Access Object for volvo_line_data table
/// Provides CRUD operations using stored procedures
/// </summary>
public class Dao_VolvoShipmentLine
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Inserts a new shipment line
⋮----
/// <param name="line"></param>
public async Task<Model_Dao_Result> InsertAsync(Model_VolvoShipmentLine line)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
/// Gets all lines for a shipment
⋮----
/// <param name="shipmentId"></param>
public async Task<Model_Dao_Result<List<Model_VolvoShipmentLine>>> GetByShipmentIdAsync(int shipmentId)
⋮----
return await Helper_Database_StoredProcedure.ExecuteListAsync(
⋮----
/// Updates a shipment line
⋮----
public async Task<Model_Dao_Result> UpdateAsync(Model_VolvoShipmentLine line)
⋮----
/// Deletes a shipment line
⋮----
/// <param name="lineId"></param>
public async Task<Model_Dao_Result> DeleteAsync(int lineId)
⋮----
private static Model_VolvoShipmentLine MapFromReader(IDataReader reader)
⋮----
return new Model_VolvoShipmentLine
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
ShipmentId = reader.GetInt32(reader.GetOrdinal("shipment_id")),
PartNumber = reader.GetString(reader.GetOrdinal("part_number")),
QuantityPerSkid = reader.GetInt32(reader.GetOrdinal("quantity_per_skid")),
ReceivedSkidCount = reader.GetInt32(reader.GetOrdinal("received_skid_count")),
CalculatedPieceCount = reader.GetInt32(reader.GetOrdinal("calculated_piece_count")),
HasDiscrepancy = reader.GetBoolean(reader.GetOrdinal("has_discrepancy")),
ExpectedSkidCount = reader.IsDBNull(reader.GetOrdinal("expected_skid_count"))
⋮----
: reader.GetInt32(reader.GetOrdinal("expected_skid_count")),
DiscrepancyNote = reader.IsDBNull(reader.GetOrdinal("discrepancy_note"))
⋮----
: reader.GetString(reader.GetOrdinal("discrepancy_note"))
</file>

<file path="Module_Volvo/Views/VolvoShipmentEditDialog.xaml">
<?xml version="1.0" encoding="utf-8"?>
<ContentDialog
    x:Class="MTM_Receiving_Application.Module_Volvo.Views.VolvoShipmentEditDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:MTM_Receiving_Application.Module_Volvo.Models"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    Title="Edit Shipment"
    PrimaryButtonText="Save Changes"
    CloseButtonText="Cancel"
    DefaultButton="Primary">
    
    <ContentDialog.Resources>
        <x:Double x:Key="ContentDialogMaxWidth">1200</x:Double>
        <x:Double x:Key="ContentDialogMinWidth">1200</x:Double>
        <converters:NullableDoubleToDoubleConverter x:Key="NullableDoubleToDoubleConverter"/>
    </ContentDialog.Resources>

    <ScrollViewer MaxHeight="600">
        <StackPanel Spacing="16" Padding="24">
            
            <!-- Shipment Header -->
            <StackPanel Spacing="8">
                <TextBlock Text="Shipment Details" Style="{StaticResource SubtitleTextBlockStyle}"/>
                
                <Grid ColumnSpacing="12" RowSpacing="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Shipment Date -->
                    <CalendarDatePicker
                        Grid.Row="0" Grid.Column="0"
                        Header="Shipment Date"
                        x:Name="ShipmentDatePicker"
                        HorizontalAlignment="Stretch" />
                    
                    <!-- Shipment Number (Read-only) -->
                    <TextBox
                        Grid.Row="0" Grid.Column="1"
                        Header="Shipment Number"
                        x:Name="ShipmentNumberBox"
                        IsReadOnly="True"
                        HorizontalAlignment="Stretch" />
                    
                    <!-- PO Number -->
                    <TextBox
                        Grid.Row="1" Grid.Column="0"
                        Header="PO Number"
                        PlaceholderText="Optional"
                        x:Name="PONumberBox"
                        HorizontalAlignment="Stretch" />
                    
                    <!-- Receiver Number -->
                    <TextBox
                        Grid.Row="1" Grid.Column="1"
                        Header="Receiver Number"
                        PlaceholderText="Optional"
                        x:Name="ReceiverNumberBox"
                        HorizontalAlignment="Stretch" />
                    
                    <!-- Notes -->
                    <TextBox
                        Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                        Header="Notes"
                        PlaceholderText="Optional notes"
                        x:Name="NotesBox"
                        TextWrapping="Wrap"
                        AcceptsReturn="True"
                        Height="80"
                        HorizontalAlignment="Stretch" />
                </Grid>
            </StackPanel>
            
            <!-- Parts DataGrid -->
            <StackPanel Spacing="8">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Parts" Style="{StaticResource SubtitleTextBlockStyle}"/>
                    <Button x:Name="AddPartButton" Content="Add Part" Style="{StaticResource AccentButtonStyle}" Height="32"/>
                    <Button x:Name="RemovePartButton" Content="Remove Part" Height="32"/>
                </StackPanel>
                
                <controls:DataGrid
                    x:Name="PartsDataGrid"
                    Height="300"
                    AutoGenerateColumns="False"
                    CanUserReorderColumns="False"
                    CanUserSortColumns="False"
                    SelectionMode="Single"
                    GridLinesVisibility="All"
                    HorizontalScrollBarVisibility="Auto">
                    
                    <controls:DataGrid.Columns>
                        <!-- Part Number -->
                        <controls:DataGridTextColumn
                            Header="Part Number"
                            Binding="{Binding PartNumber}"
                            Width="150"/>
                        
                        <!-- Received Skids -->
                        <controls:DataGridTemplateColumn Header="Received Skids" Width="120">
                            <controls:DataGridTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="models:Model_VolvoShipmentLine">
                                    <NumberBox
                                        Value="{x:Bind ReceivedSkidCount, Mode=TwoWay}"
                                        Minimum="0"
                                        SpinButtonPlacementMode="Compact"
                                        HorizontalAlignment="Stretch" />
                                </DataTemplate>
                            </controls:DataGridTemplateColumn.CellTemplate>
                        </controls:DataGridTemplateColumn>
                        
                        <!-- Calculated Pieces (Read-only) -->
                        <controls:DataGridTextColumn
                            Header="Calculated Pieces"
                            Binding="{Binding CalculatedPieceCount}"
                            IsReadOnly="True"
                            Width="120"/>
                        
                        <!-- Has Discrepancy -->
                        <controls:DataGridCheckBoxColumn
                            Header="Discrepancy?"
                            Binding="{Binding HasDiscrepancy, Mode=TwoWay}"
                            Width="100"/>
                        
                        <!-- Expected Skids -->
                        <controls:DataGridTemplateColumn Header="Expected Skids" Width="120">
                            <controls:DataGridTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="models:Model_VolvoShipmentLine">
                                    <NumberBox
                                        Value="{Binding ExpectedSkidCount, Mode=TwoWay, Converter={StaticResource NullableDoubleToDoubleConverter}}"
                                        Minimum="0"
                                        SpinButtonPlacementMode="Compact"
                                        HorizontalAlignment="Stretch"
                                        IsEnabled="{x:Bind HasDiscrepancy, Mode=OneWay}" />
                                </DataTemplate>
                            </controls:DataGridTemplateColumn.CellTemplate>
                        </controls:DataGridTemplateColumn>
                        
                        <!-- Expected Pieces Column -->
                        <controls:DataGridTextColumn Header="Expected Pieces"
                                                      Width="120"
                                                      Binding="{Binding ExpectedPieceCount, Mode=OneWay}"
                                                      IsReadOnly="True"/>
                        
                        <!-- Difference Column -->
                        <controls:DataGridTextColumn Header="Difference"
                                                      Width="100"
                                                      Binding="{Binding PieceDifference, Mode=OneWay}"
                                                      IsReadOnly="True"/>
                        
                        <!-- Discrepancy Note -->
                        <controls:DataGridTemplateColumn Header="Discrepancy Note" Width="*" MinWidth="200">
                            <controls:DataGridTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="models:Model_VolvoShipmentLine">
                                    <TextBox
                                        Text="{x:Bind DiscrepancyNote, Mode=TwoWay}"
                                        IsEnabled="{x:Bind HasDiscrepancy, Mode=OneWay}"
                                        PlaceholderText="Enter note"
                                        HorizontalAlignment="Stretch" />
                                </DataTemplate>
                            </controls:DataGridTemplateColumn.CellTemplate>
                        </controls:DataGridTemplateColumn>
                    </controls:DataGrid.Columns>
                </controls:DataGrid>
            </StackPanel>
            
        </StackPanel>
    </ScrollViewer>
</ContentDialog>
</file>

<file path="Module_Core/Contracts/Services/IService_Volvo.cs">
/// <summary>
/// Service interface for Volvo dunnage requisition business logic
/// Handles component explosion, CSV generation, email formatting, and shipment management
/// </summary>
public interface IService_Volvo
⋮----
/// Calculates component explosion and aggregates piece counts for all parts in shipment
/// Example: If V-EMB-500 (3 skids) includes components V-EMB-2 and V-EMB-92,
/// result includes V-EMB-500: 264 pcs + V-EMB-2: 3 pcs + V-EMB-92: 3 pcs
⋮----
/// <param name="lines">List of shipment lines with part numbers and skid counts</param>
/// <returns>Dictionary of part numbers to total piece counts (includes parent parts + components)</returns>
public Task<Model_Dao_Result<Dictionary<string, int>>> CalculateComponentExplosionAsync(
⋮----
/// Generates CSV file for LabelView 2022 label printing
/// Format: Material,Quantity,Employee,Date,Time,Receiver,Notes
/// Saved to: %APPDATA%\MTM_Receiving_Application\Volvo\Labels\Shipment_[ID]_[Date].csv
⋮----
/// <param name="shipmentId">Shipment ID to generate labels for</param>
/// <returns>File path where CSV was written</returns>
public Task<Model_Dao_Result<string>> GenerateLabelCsvAsync(int shipmentId);
⋮----
/// Formats email text for PO requisition (with discrepancy notice if applicable)
/// Includes: Greeting, discrepancy table (if any), requested lines, signature
⋮----
/// <param name="shipment">Shipment header</param>
/// <param name="lines">Shipment lines with discrepancy data</param>
/// <param name="requestedLines">Aggregated component explosion results</param>
/// <returns>Formatted email text ready to copy to Outlook</returns>
public Task<string> FormatEmailTextAsync(
⋮----
/// Formats email data for PO requisition (structured for preview and HTML export)
⋮----
/// <returns>Structured email data</returns>
public Task<Model_VolvoEmailData> FormatEmailDataAsync(
⋮----
/// Converts structured email data to HTML format with tables for Outlook paste
⋮----
/// <param name="emailData">Structured email data</param>
/// <returns>HTML formatted email</returns>
public string FormatEmailAsHtml(Model_VolvoEmailData emailData);
⋮----
/// Validates shipment data before save
/// Centralized validation logic to ensure data integrity
⋮----
/// <param name=\"shipment\">Shipment header to validate</param>
/// <param name=\"lines\">Shipment lines to validate</param>
/// <param name="shipment"></param>
/// <param name="lines"></param>
/// <returns>Validation result with error message if failed</returns>
public Task<Model_Dao_Result> ValidateShipmentAsync(
⋮----
/// Saves shipment and lines with status='pending_po'
/// Validates: Only one pending shipment allowed at a time
⋮----
/// <param name="shipment">Shipment header data</param>
/// <param name="lines">Shipment line items</param>
/// <param name="overwriteExisting">If true, deletes any existing pending shipment before saving</param>
/// <returns>Tuple of (ShipmentId, ShipmentNumber) for the saved shipment</returns>
public Task<Model_Dao_Result<(int ShipmentId, int ShipmentNumber)>> SaveShipmentAsync(
⋮----
/// Gets pending shipment if one exists (status='pending_po')
⋮----
/// <returns>Pending shipment or null if none exists</returns>
public Task<Model_Dao_Result<Model_VolvoShipment?>> GetPendingShipmentAsync();
⋮----
/// Gets pending shipment with all line items
⋮----
/// <returns>Tuple of (shipment, lines) or null if no pending shipment</returns>
public Task<Model_Dao_Result<(Model_VolvoShipment? Shipment, List<Model_VolvoShipmentLine> Lines)>> GetPendingShipmentWithLinesAsync();
⋮----
/// Completes shipment with PO and Receiver numbers
/// Sets status='completed' and is_archived=1
⋮----
/// <param name="shipmentId">Shipment ID to complete</param>
/// <param name="poNumber">Purchase order number from purchasing department</param>
/// <param name="receiverNumber">Receiver number from Infor Visual</param>
/// <returns>Success/failure result</returns>
public Task<Model_Dao_Result> CompleteShipmentAsync(int shipmentId, string poNumber, string receiverNumber);
⋮----
/// Gets all active Volvo parts for dropdown population
⋮----
/// <returns>List of active parts (is_active=1)</returns>
public Task<Model_Dao_Result<List<Model_VolvoPart>>> GetActivePartsAsync();
⋮----
/// Gets shipment history with filtering
⋮----
/// <param name="startDate">Start date for filter</param>
/// <param name="endDate">End date for filter</param>
/// <param name="status">Status filter ('pending_po', 'completed', or 'all')</param>
/// <returns>List of shipments matching filters</returns>
public Task<Model_Dao_Result<List<Model_VolvoShipment>>> GetHistoryAsync(
⋮----
/// Gets all shipment lines for a specific shipment
⋮----
/// <param name="shipmentId">Shipment ID</param>
/// <returns>List of shipment lines</returns>
public Task<Model_Dao_Result<List<Model_VolvoShipmentLine>>> GetShipmentLinesAsync(int shipmentId);
⋮----
/// Updates an existing shipment and its lines
/// Regenerates CSV if applicable
⋮----
/// <param name="shipment">Updated shipment data</param>
/// <param name="lines">Updated shipment lines</param>
⋮----
public Task<Model_Dao_Result> UpdateShipmentAsync(
⋮----
/// Exports shipment history to CSV format
⋮----
/// <param name="status">Status filter</param>
/// <returns>CSV content as string</returns>
public Task<Model_Dao_Result<string>> ExportHistoryToCsvAsync(
</file>

<file path="Module_Routing/Data/Dao_InforVisualPO.cs">
/// <summary>
/// Data Access Object for Infor Visual PO data (READ ONLY)
/// Provides read-only access to purchase order data from SQL Server
/// </summary>
public class Dao_InforVisualPO
⋮----
/// Constructor with connection string injection
⋮----
/// <param name="connectionString">SQL Server connection string (should include ApplicationIntent=ReadOnly for safety)</param>
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Validates that a PO exists and is active in Infor Visual
⋮----
/// <param name="poNumber">Purchase order number</param>
/// <returns>Model_Dao_Result with true if PO exists and is open, false otherwise</returns>
public async Task<Model_Dao_Result<bool>> ValidatePOAsync(string poNumber)
⋮----
Console.WriteLine($"[DAO] Validating PO: {poNumber}");
await using (var connection = new SqlConnection(_connectionString))
⋮----
await connection.OpenAsync();
⋮----
await using (var command = new SqlCommand(query, connection))
⋮----
command.Parameters.AddWithValue("@PoNumber", poNumber);
⋮----
var count = (int)(await command.ExecuteScalarAsync() ?? 0);
⋮----
return Model_Dao_Result_Factory.Success(count > 0);
⋮----
/// Gets all line items for a specific purchase order
⋮----
/// <returns>Model_Dao_Result with list of PO lines</returns>
public async Task<Model_Dao_Result<List<Model_InforVisualPOLine>>> GetLinesAsync(string poNumber)
⋮----
// Issue #32: Enhanced logging
Console.WriteLine($"[DAO] Fetching lines for PO: {poNumber}");
⋮----
// Issue #21: Reduced nesting by extracting query execution
await using var connection = new SqlConnection(_connectionString);
⋮----
await using var command = new SqlCommand(query, connection);
⋮----
await using var reader = await command.ExecuteReaderAsync();
⋮----
while (await reader.ReadAsync())
⋮----
lines.Add(MapFromReader(reader));
⋮----
return Model_Dao_Result_Factory.Success(lines);
⋮----
/// Gets a specific line item from a purchase order
⋮----
/// <param name="lineNumber">Line number</param>
/// <returns>Model_Dao_Result with PO line data</returns>
public async Task<Model_Dao_Result<Model_InforVisualPOLine>> GetLineAsync(string poNumber, int lineNumber)
⋮----
command.Parameters.AddWithValue("@LineNumber", lineNumber);
⋮----
await using (var reader = await command.ExecuteReaderAsync())
⋮----
if (await reader.ReadAsync())
⋮----
return Model_Dao_Result_Factory.Success(line);
⋮----
/// Checks if Infor Visual connection is available
⋮----
/// <returns>Model_Dao_Result with true if connection successful, false otherwise</returns>
public async Task<Model_Dao_Result<bool>> CheckConnectionAsync()
⋮----
return Model_Dao_Result_Factory.Success(true);
⋮----
return Model_Dao_Result_Factory.Success(false);
⋮----
/// Maps SqlDataReader row to Model_InforVisualPOLine
⋮----
/// <param name="reader"></param>
private Model_InforVisualPOLine MapFromReader(IDataReader reader)
⋮----
return new Model_InforVisualPOLine
⋮----
PONumber = reader["PO_ID"].ToString() ?? string.Empty,
// Use indexer + ToString() to safely handle smallint (Int16) vs int (Int32) mismatch
// reader.GetInt32() throws on smallint columns
LineNumber = reader["PO_LINE"].ToString() ?? string.Empty,
PartID = reader["PART_ID"].ToString() ?? string.Empty,
Description = reader.IsDBNull(reader.GetOrdinal("PART_NAME"))
⋮----
: reader.GetString(reader.GetOrdinal("PART_NAME")),
Specifications = reader.IsDBNull(reader.GetOrdinal("SPECS"))
⋮----
: reader.GetString(reader.GetOrdinal("SPECS")),
// Handle potentially nullable decimals safely
QuantityOrdered = reader.IsDBNull(reader.GetOrdinal("QTY_ORDERED"))
⋮----
: reader.GetDecimal(reader.GetOrdinal("QTY_ORDERED")),
QuantityReceived = reader.IsDBNull(reader.GetOrdinal("QTY_RECEIVED"))
⋮----
: reader.GetDecimal(reader.GetOrdinal("QTY_RECEIVED")),
WorkOrder = HasColumn(reader, "WORK_ORDER_ID") && !reader.IsDBNull(reader.GetOrdinal("WORK_ORDER_ID"))
? reader.GetString(reader.GetOrdinal("WORK_ORDER_ID"))
⋮----
CustomerOrder = HasColumn(reader, "CUST_ORDER_ID") && !reader.IsDBNull(reader.GetOrdinal("CUST_ORDER_ID"))
? reader.GetString(reader.GetOrdinal("CUST_ORDER_ID"))
⋮----
/// Helper to check if column exists in reader
⋮----
/// <param name="reader">The data reader</param>
/// <param name="columnName">Name of the column to check</param>
private bool HasColumn(IDataReader reader, string columnName)
⋮----
if (reader.GetName(i).Equals(columnName, StringComparison.InvariantCultureIgnoreCase))
</file>

<file path="Module_Routing/Services/RoutingService.cs">
/// <summary>
/// Core service for routing label operations: creation, editing, CSV export, validation
/// </summary>
public class RoutingService : IRoutingService
⋮----
private readonly Dao_RoutingLabel _daoLabel;
private readonly Dao_RoutingLabelHistory _daoHistory;
private readonly IRoutingInforVisualService _inforVisualService;
private readonly IRoutingUsageTrackingService _usageTrackingService;
private readonly IRoutingRecipientService _recipientService;
private readonly IService_LoggingUtility _logger;
private readonly IConfiguration _configuration;
⋮----
// Static semaphore for CSV file write synchronization (fixes Issue #3: race condition)
private static readonly SemaphoreSlim _csvFileLock = new SemaphoreSlim(1, 1);
⋮----
_daoLabel = daoLabel ?? throw new ArgumentNullException(nameof(daoLabel));
_daoHistory = daoHistory ?? throw new ArgumentNullException(nameof(daoHistory));
_inforVisualService = inforVisualService ?? throw new ArgumentNullException(nameof(inforVisualService));
_usageTrackingService = usageTrackingService ?? throw new ArgumentNullException(nameof(usageTrackingService));
_recipientService = recipientService ?? throw new ArgumentNullException(nameof(recipientService));
_logger = logger ?? throw new ArgumentNullException(nameof(logger));
_configuration = configuration ?? throw new ArgumentNullException(nameof(configuration));
⋮----
/// Creates a new routing label with validation, CSV export, and usage tracking
/// Issue #20: Refactored for clarity - extracted validation and background tasks
⋮----
/// <param name="label">Label to create</param>
/// <returns>Result with new label ID</returns>
public async Task<Model_Dao_Result<int>> CreateLabelAsync(Model_RoutingLabel label)
⋮----
await _logger.LogInfoAsync($"Creating routing label for PO {label.PONumber}, Recipient {label.RecipientId}");
⋮----
// Step 1: Validate label and check for duplicates
⋮----
// Step 2: Insert label into database
var insertResult = await _daoLabel.InsertLabelAsync(label);
⋮----
// Step 3: Execute non-critical background tasks (CSV export, usage tracking)
⋮----
await _logger.LogErrorAsync($"Error creating label: {ex.Message}", ex);
⋮----
/// Issue #20: Validates label and checks for duplicates (extracted from CreateLabelAsync)
⋮----
/// <param name="label"></param>
private async Task<Model_Dao_Result> ValidateAndCheckDuplicatesAsync(Model_RoutingLabel label)
⋮----
// Basic validation
⋮----
// Issue #9: Validate recipient exists
var recipientValidation = await _recipientService.ValidateRecipientExistsAsync(label.RecipientId);
⋮----
return Model_Dao_Result_Factory.Failure($"Invalid recipient ID: {label.RecipientId}");
⋮----
// Check for duplicates
⋮----
return Model_Dao_Result_Factory.Failure(
⋮----
return Model_Dao_Result_Factory.Success();
⋮----
/// Issue #20: Executes CSV export and usage tracking in background (extracted from CreateLabelAsync)
⋮----
/// <param name="labelId"></param>
private void ExecuteBackgroundTasks(Model_RoutingLabel label, int labelId)
⋮----
// Issue #2: CSV export and usage tracking are non-critical operations
_ = Task.Run(async () =>
⋮----
await _logger.LogWarningAsync($"CSV export failed for label {labelId}: {csvResult.ErrorMessage}");
⋮----
var usageResult = await _usageTrackingService.IncrementUsageCountAsync(
⋮----
await _logger.LogWarningAsync($"Usage tracking failed for label {labelId}: {usageResult.ErrorMessage}");
⋮----
await _logger.LogErrorAsync($"Background task error for label {labelId}: {ex.Message}", ex);
⋮----
/// Updates an existing label and logs changes to history
⋮----
/// <param name="label">Updated label data</param>
/// <param name="editedByEmployeeNumber">Employee number making the edit</param>
/// <returns>Result indicating success or failure</returns>
public async Task<Model_Dao_Result> UpdateLabelAsync(Model_RoutingLabel label, int editedByEmployeeNumber)
⋮----
await _logger.LogInfoAsync($"Updating label {label.Id} by employee {editedByEmployeeNumber}");
⋮----
// Get original label for history tracking
var originalResult = await _daoLabel.GetLabelByIdAsync(label.Id);
⋮----
return Model_Dao_Result_Factory.Failure($"Original label not found: {originalResult.ErrorMessage}");
⋮----
// Validate updated label
⋮----
// Update label
var updateResult = await _daoLabel.UpdateLabelAsync(label);
⋮----
// Log changes to history
⋮----
// Issue #18: Use batch insert to avoid N+1 query problem
⋮----
historyEntries.Add(new Model_RoutingLabelHistory
⋮----
var historyResult = await _daoHistory.InsertHistoryBatchAsync(historyEntries);
⋮----
await _logger.LogWarningAsync($"Failed to log history: {historyResult.ErrorMessage}");
⋮----
return Model_Dao_Result_Factory.Success("Label updated successfully", 1);
⋮----
await _logger.LogErrorAsync($"Error updating label: {ex.Message}", ex);
return Model_Dao_Result_Factory.Failure($"Error updating label: {ex.Message}", ex);
⋮----
/// Retrieves a specific label by ID
⋮----
/// <param name="labelId">Label ID to retrieve</param>
/// <returns>Result with label data or error</returns>
public async Task<Model_Dao_Result<Model_RoutingLabel>> GetLabelByIdAsync(int labelId)
⋮----
return await _daoLabel.GetLabelByIdAsync(labelId);
⋮----
await _logger.LogErrorAsync($"Error getting label {labelId}: {ex.Message}", ex);
⋮----
/// Retrieves all labels with optional pagination
⋮----
/// <param name="limit">Maximum number of records to return</param>
/// <param name="offset">Number of records to skip</param>
/// <returns>Result with list of labels</returns>
public async Task<Model_Dao_Result<List<Model_RoutingLabel>>> GetAllLabelsAsync(int limit = 100, int offset = 0)
⋮----
// Issue #13: Pagination support requires DAO updates
// Would need: sp_routing_label_search_paginated(p_search, p_limit, p_offset)
// Returns: Subset of results + total count for UI paging controls
// Priority: MEDIUM - Useful for large datasets (1000+ labels)
// Current implementation returns all matching labels (acceptable for <500 records)
// Current: DAO method accepts params but doesn't implement pagination
// Impact: Performance issue when loading large label sets
return await _daoLabel.GetAllLabelsAsync(limit, offset);
⋮----
// Issue #11: Standardized error handling pattern
await _logger.LogErrorAsync($"Error retrieving labels: {ex.Message}", ex);
⋮----
public async Task<Model_Dao_Result<(bool Exists, int? ExistingLabelId)>> CheckDuplicateLabelAsync(
⋮----
var result = await _daoLabel.CheckDuplicateAsync(poNumber, lineNumber, recipientId, createdDate);
⋮----
await _logger.LogErrorAsync($"Error checking duplicate: {ex.Message}", ex);
⋮----
/// Exports a label to CSV file with retry logic and fallback paths
⋮----
/// <param name="label">Label to export</param>
⋮----
public async Task<Model_Dao_Result> ExportLabelToCsvAsync(Model_RoutingLabel label)
⋮----
// Get CSV export paths from configuration
⋮----
// Format CSV line
⋮----
// Validate and sanitize paths (Issue #5)
var validatedNetworkPath = string.IsNullOrEmpty(networkPath) ? string.Empty : ValidateCsvPath(networkPath);
var validatedLocalPath = string.IsNullOrEmpty(localPath) ? string.Empty : ValidateCsvPath(localPath);
⋮----
// Try network path first with retry
⋮----
// Try local path as fallback
⋮----
await _logger.LogWarningAsync($"Network CSV export failed, using local path: {validatedLocalPath}");
⋮----
// Mark as exported in database
await _daoLabel.MarkExportedAsync(new List<int> { label.Id });
⋮----
return Model_Dao_Result_Factory.Success(
⋮----
return Model_Dao_Result_Factory.Failure("CSV export failed (both network and local paths)");
⋮----
await _logger.LogErrorAsync($"Error exporting to CSV: {ex.Message}", ex);
return Model_Dao_Result_Factory.Failure($"CSV export error: {ex.Message}", ex);
⋮----
/// Regenerates CSV export for a specific label (e.g., after export failure)
⋮----
/// <param name="labelId">Label ID to regenerate</param>
⋮----
public async Task<Model_Dao_Result> RegenerateLabelCsvAsync(int labelId)
⋮----
return Model_Dao_Result_Factory.Failure($"Label not found: {labelResult.ErrorMessage}");
⋮----
await _logger.LogErrorAsync($"Error regenerating CSV: {ex.Message}", ex);
return Model_Dao_Result_Factory.Failure($"Error regenerating CSV: {ex.Message}", ex);
⋮----
/// Resets CSV exported flag for all labels (administrative operation)
⋮----
public async Task<Model_Dao_Result> ResetCsvFileAsync()
⋮----
if (File.Exists(networkPath))
⋮----
File.Delete(networkPath);
⋮----
if (File.Exists(localPath))
⋮----
File.Delete(localPath);
⋮----
await _logger.LogInfoAsync($"CSV files reset (network: {networkDeleted}, local: {localDeleted})");
⋮----
return Model_Dao_Result_Factory.Success("CSV files reset successfully", 1);
⋮----
await _logger.LogErrorAsync($"Error resetting CSV: {ex.Message}", ex);
return Model_Dao_Result_Factory.Failure($"Error resetting CSV: {ex.Message}", ex);
⋮----
/// Validates label data before database operations
⋮----
/// <param name="label">Label to validate</param>
/// <returns>Result indicating if validation passed</returns>
public Model_Dao_Result ValidateLabel(Model_RoutingLabel label)
⋮----
return Model_Dao_Result_Factory.Failure("Label cannot be null");
⋮----
if (string.IsNullOrWhiteSpace(label.PONumber))
⋮----
return Model_Dao_Result_Factory.Failure("PO Number is required");
⋮----
// Issue #6: String length validation
⋮----
return Model_Dao_Result_Factory.Failure("PO Number cannot exceed 50 characters");
⋮----
if (string.IsNullOrWhiteSpace(label.LineNumber))
⋮----
return Model_Dao_Result_Factory.Failure("Line Number is required");
⋮----
return Model_Dao_Result_Factory.Failure("Line Number cannot exceed 20 characters");
⋮----
return Model_Dao_Result_Factory.Failure("Description cannot exceed 255 characters");
⋮----
return Model_Dao_Result_Factory.Failure("Quantity must be greater than zero");
⋮----
return Model_Dao_Result_Factory.Failure("Recipient must be selected");
⋮----
return Model_Dao_Result_Factory.Failure("Employee Number is required");
⋮----
// Validate that either PO is valid OR an OTHER reason is provided
if (label.PONumber.Equals("OTHER", StringComparison.OrdinalIgnoreCase))
⋮----
return Model_Dao_Result_Factory.Failure("OTHER reason must be selected when PO is OTHER");
⋮----
return Model_Dao_Result_Factory.Success("Validation passed", 1);
⋮----
// Private helper methods
⋮----
/// Validates CSV file path to prevent directory traversal attacks
⋮----
/// <param name="path">Path to validate</param>
/// <returns>Validated full path</returns>
/// <exception cref="ArgumentException">If path is invalid</exception>
/// <exception cref="SecurityException">If path contains traversal attempts</exception>
private string ValidateCsvPath(string path)
⋮----
// Issue #5: Path traversal validation
if (string.IsNullOrWhiteSpace(path))
⋮----
throw new ArgumentException("CSV path cannot be empty", nameof(path));
⋮----
var fullPath = Path.GetFullPath(path);
⋮----
// Ensure path doesn't contain traversal attempts
if (path.Contains("..") || path.Contains("~"))
⋮----
/// Formats label data as CSV line
⋮----
/// <param name="label">Label to format</param>
/// <returns>CSV-formatted string</returns>
private string FormatCsvLine(Model_RoutingLabel label)
⋮----
// CSV format: PO,Line,Part,Quantity,Recipient,Location,Date,WorkOrder,CustomerOrder
⋮----
private async Task<bool> TryWriteCsvAsync(string filePath, string csvLine, int retryCount, int retryDelayMs)
⋮----
// Acquire lock to prevent concurrent CSV writes (fixes Issue #3)
await _csvFileLock.WaitAsync();
⋮----
// Ensure directory exists
var directory = Path.GetDirectoryName(filePath);
if (!string.IsNullOrEmpty(directory) && !Directory.Exists(directory))
⋮----
Directory.CreateDirectory(directory);
⋮----
// Append to CSV file
await File.AppendAllTextAsync(filePath, csvLine + Environment.NewLine);
⋮----
_csvFileLock.Release();
⋮----
await _logger.LogWarningAsync($"CSV write attempt {attempt}/{retryCount} failed: {ex.Message}");
⋮----
await Task.Delay(retryDelayMs);
⋮----
await _logger.LogErrorAsync($"Unexpected CSV write error: {ex.Message}", ex);
⋮----
/// Compares two labels and returns list of changed fields
⋮----
/// <param name="original">Original label</param>
/// <param name="updated">Updated label</param>
/// <returns>List of tuples containing field name, old value, and new value</returns>
private List<(string FieldName, string OldValue, string NewValue)> GetLabelChanges(
⋮----
changes.Add(("PONumber", original.PONumber, updated.PONumber));
⋮----
changes.Add(("LineNumber", original.LineNumber, updated.LineNumber));
⋮----
changes.Add(("Description", original.Description ?? "", updated.Description ?? ""));
⋮----
changes.Add(("Quantity", original.Quantity.ToString(), updated.Quantity.ToString()));
⋮----
changes.Add(("RecipientId", original.RecipientId.ToString(), updated.RecipientId.ToString()));
⋮----
changes.Add(("OtherReasonId",
</file>

<file path="Module_Routing/ViewModels/RoutingWizardContainerViewModel.cs">
/// <summary>
/// Container ViewModel managing wizard state and navigation between steps
/// </summary>
public partial class RoutingWizardContainerViewModel : ObservableObject
⋮----
private readonly IRoutingService _routingService;
private readonly IRoutingInforVisualService _inforVisualService;
private readonly IRoutingUsageTrackingService _usageTrackingService;
private readonly IService_ErrorHandler _errorHandler;
private readonly IService_LoggingUtility _logger;
private readonly IService_UserSessionManager _sessionManager;
⋮----
// Lazy-loaded Step3 ViewModel for triggering data refresh
⋮----
/// Current wizard step (1, 2, or 3)
⋮----
/// Busy indicator for async operations
⋮----
/// Status message for user feedback
⋮----
/// Selected PO line from Step 1 (null if OTHER workflow)
⋮----
/// Selected OTHER reason from Step 1 (null if PO workflow)
⋮----
/// Manual quantity for OTHER workflow
⋮----
/// Selected recipient from Step 2
⋮----
/// Final label quantity (from PO line or manual entry)
⋮----
/// Indicates if we're in edit mode from Step 3 review
⋮----
/// Navigate to Step 2 (Recipient Selection)
⋮----
private void NavigateToStep2()
⋮----
_logger.LogInfo($"NavigateToStep2 called - CurrentStep: {CurrentStep}, SelectedPOLine: {SelectedPOLine?.PartID ?? "null"}, SelectedOtherReason: {SelectedOtherReason?.Description ?? "null"}");
⋮----
// Validation: Must have either PO line or OTHER reason
⋮----
_logger.LogWarning("NavigateToStep2: No PO line or OTHER reason selected");
⋮----
// Set quantity from PO line if applicable
⋮----
_logger.LogInfo($"Set FinalQuantity from PO line: {FinalQuantity}");
⋮----
_logger.LogInfo($"Set FinalQuantity from OTHER: {FinalQuantity}");
⋮----
_logger.LogInfo($"Changing CurrentStep from {CurrentStep} to 2");
⋮----
_logger.LogInfo($"CurrentStep is now: {CurrentStep}");
⋮----
/// Navigate to Step 3 (Review)
⋮----
private void NavigateToStep3()
⋮----
_logger.LogInfo($"NavigateToStep3 called - SelectedRecipient: {SelectedRecipient?.Name ?? "null"}");
⋮----
// Validation: Must have recipient
⋮----
_logger.LogWarning("NavigateToStep3: No recipient selected");
⋮----
_logger.LogInfo($"Navigating to Step 3 - Recipient: {SelectedRecipient.Name}, CurrentStep changing from {CurrentStep} to 3");
⋮----
// Trigger Step3 to reload data
⋮----
_logger.LogInfo("Calling Step3ViewModel.LoadReviewData()");
_step3ViewModel.LoadReviewData();
⋮----
_logger.LogWarning("Step3ViewModel not yet initialized");
⋮----
/// Register Step 3 ViewModel for data refresh coordination
⋮----
/// <param name="step3ViewModel"></param>
public void RegisterStep3ViewModel(RoutingWizardStep3ViewModel step3ViewModel)
⋮----
_logger.LogInfo("Step3ViewModel registered with Container");
⋮----
/// Navigate back to Step 1
⋮----
private void NavigateToStep1()
⋮----
/// Navigate to Step 1 for editing (from Step 3)
⋮----
private void NavigateToStep1ForEdit()
⋮----
_logger.LogInfo("NavigateToStep1ForEdit called - Setting edit mode");
⋮----
/// Navigate back to Step 2
⋮----
private void NavigateBackToStep2()
⋮----
/// Navigate to Step 2 for editing (from Step 3)
⋮----
private void NavigateToStep2ForEdit()
⋮----
_logger.LogInfo("NavigateToStep2ForEdit called - Setting edit mode");
⋮----
/// Create the routing label (final step)
⋮----
private async Task CreateLabelAsync()
⋮----
// Build label model
var label = new Model_RoutingLabel
⋮----
LineNumber = SelectedPOLine?.LineNumber.ToString() ?? "0",
⋮----
// Create label via service
var result = await _routingService.CreateLabelAsync(label);
⋮----
// Increment usage tracking for personalization
await _usageTrackingService.IncrementUsageCountAsync(
⋮----
// Log success
await _logger.LogInfoAsync(
⋮----
// Issue #13: Navigate back to Mode Selection after successful creation
// Requires: INavigationService.NavigateTo(typeof(RoutingModeSelectionViewModel))
// Or: Raise NavigationRequested event handled by parent window
// Priority: LOW - User can manually navigate, auto-return is convenience feature
// Navigation flow not yet implemented
⋮----
await _errorHandler.ShowUserErrorAsync(
⋮----
_errorHandler.HandleException(
⋮----
/// Cancel wizard with confirmation
⋮----
private async Task CancelAsync()
⋮----
// Show confirmation dialog
⋮----
// Set XamlRoot for dialog
⋮----
var result = await dialog.ShowAsync();
⋮----
// User confirmed cancel
⋮----
// Navigate back to Mode Selection after cancel
// Requires: INavigationService integration or parent window event handling
// Priority: LOW - Manual navigation available
⋮----
/// Reset wizard to initial state
⋮----
private void ResetWizard()
⋮----
/// Get current employee number from session
/// Issue #7: Implemented using IService_UserSessionManager
⋮----
private int GetCurrentEmployeeNumber()
</file>

<file path="Module_Routing/Views/RoutingWizardStep1View.xaml">
<Page
    x:Class="MTM_Receiving_Application.Module_Routing.Views.RoutingWizardStep1View"
    x:Name="RootPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:MTM_Receiving_Application.Module_Routing.ViewModels"
    xmlns:models="using:MTM_Receiving_Application.Module_Routing.Models"
    xmlns:coreConverters="using:MTM_Receiving_Application.Module_Core.Converters">

    <Page.Resources>
        <coreConverters:Converter_BooleanToVisibility x:Key="BooleanToVisibilityConverter"/>
        <coreConverters:Converter_IntToVisibility x:Key="IntToVisibilityConverter"/>
    </Page.Resources>

    <Grid Padding="12" RowSpacing="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" 
                   Text="Step 1: PO and Line Selection" 
                   Style="{StaticResource TitleTextBlockStyle}"
                   Margin="0,0,0,4"/>

        <!-- PO Input Section (visible when NOT in OTHER mode) -->
        <Border Grid.Row="1" 
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="12"
                Visibility="{x:Bind ViewModel.IsOtherMode, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}">
            <Grid ColumnSpacing="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Label -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <FontIcon Glyph="&#xE8A5;" 
                                FontSize="16"
                                Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                    <TextBlock Text="PO Number:" 
                                Style="{ThemeResource BodyStrongTextBlockStyle}"
                                VerticalAlignment="Center"/>
                </StackPanel>
                
                <!-- Input -->
                <TextBox Grid.Column="1"
                            Text="{x:Bind ViewModel.PoNumber, Mode=TwoWay}"
                            PlaceholderText="Enter PO number"
                            VerticalAlignment="Center"/>

                <!-- Actions -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                    <Button Command="{x:Bind ViewModel.ValidatePOCommand}"
                            Style="{StaticResource AccentButtonStyle}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE896;" FontSize="16"/>
                            <TextBlock Text="Validate"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Content="Other (Non-PO)"
                            Command="{x:Bind ViewModel.SwitchToOtherModeCommand}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- OTHER Mode Section (visible when in OTHER mode) -->
        <Border Grid.Row="1" 
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="20"
                Visibility="{x:Bind ViewModel.IsOtherMode, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel Spacing="16">
                <TextBlock Text="OTHER Package (Non-PO)" 
                           Style="{StaticResource SubtitleTextBlockStyle}"/>

                <StackPanel Spacing="8">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8B4;" 
                                 FontSize="16"
                                 Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                        <TextBlock Text="Reason" 
                                  Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                    </StackPanel>
                    
                    <ComboBox PlaceholderText="Select reason"
                              ItemsSource="{x:Bind ViewModel.OtherReasons, Mode=OneWay}"
                              SelectedItem="{x:Bind ViewModel.SelectedOtherReason, Mode=TwoWay}"
                              DisplayMemberPath="Description"
                              HorizontalAlignment="Stretch"
                              MaxWidth="400"/>
                </StackPanel>

                <StackPanel Spacing="8">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE9F9;" 
                                 FontSize="16"
                                 Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                        <TextBlock Text="Quantity" 
                                  Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                    </StackPanel>
                    
                    <NumberBox Minimum="1"
                               SpinButtonPlacementMode="Inline"
                               Value="{x:Bind ViewModel.OtherQuantity, Mode=TwoWay}"
                               MaxWidth="200"
                               HorizontalAlignment="Left"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- PO Lines DataGrid + Specs (visible when NOT in OTHER mode) -->
        <Grid Grid.Row="2" ColumnSpacing="16"
              Visibility="{x:Bind ViewModel.IsOtherMode, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Lines List -->
            <Border Grid.Column="0" 
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16">
                <Grid>
                    <TextBlock Text="Select a line from the PO"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Visibility="{x:Bind ViewModel.PoLines.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=Inverse}"/>

                    <ListView ItemsSource="{x:Bind ViewModel.PoLines, Mode=OneWay}"
                              SelectedItem="{x:Bind ViewModel.SelectedPOLine, Mode=TwoWay}"
                              SelectionMode="Single"
                              Visibility="{x:Bind ViewModel.PoLines.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}}">
                        <ListView.HeaderTemplate>
                            <DataTemplate>
                                <Grid Padding="8" ColumnSpacing="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="50"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="{Binding ViewModel.ReferenceColumnWidth, ElementName=RootPage}"/>
                                        <ColumnDefinition Width="{Binding ViewModel.SpecsColumnWidth, ElementName=RootPage}"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Line" FontWeight="SemiBold" Margin="0,0,12,0"/>
                                    <TextBlock Grid.Column="1" Text="Part ID" FontWeight="SemiBold" Margin="0,0,12,0"/>
                                    <TextBlock Grid.Column="2" Text="Description" FontWeight="SemiBold" Margin="0,0,12,0"/>
                                    <TextBlock Grid.Column="3" Text="Ref (CO/WO)" FontWeight="SemiBold" Margin="0,0,12,0"/>
                                    <TextBlock Grid.Column="4" Text="Specs (Preview)" FontWeight="SemiBold" Margin="0,0,12,0"/>
                                    <TextBlock Grid.Column="5" Text="Qty" FontWeight="SemiBold" HorizontalAlignment="Right"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.HeaderTemplate>
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="models:Model_InforVisualPOLine">
                                <Grid Padding="8" ColumnSpacing="0">
                                    <Grid.ColumnDefinitions>
                                         <ColumnDefinition Width="50"/>
                                         <ColumnDefinition Width="120"/>
                                         <ColumnDefinition Width="150"/>
                                         <ColumnDefinition Width="{Binding ViewModel.ReferenceColumnWidth, ElementName=RootPage}"/>
                                         <ColumnDefinition Width="{Binding ViewModel.SpecsColumnWidth, ElementName=RootPage}"/>
                                         <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="{x:Bind LineNumber}" Margin="0,0,12,0"/>
                                    <TextBlock Grid.Column="1" Text="{x:Bind PartID}" Margin="0,0,12,0"/>
                                    <TextBlock Grid.Column="2" Text="{x:Bind Description}" TextTrimming="CharacterEllipsis" Margin="0,0,12,0"/>
                                    <TextBlock Grid.Column="3" Text="{x:Bind ReferenceInfo}" TextTrimming="CharacterEllipsis" Margin="0,0,12,0"/>
                                    <TextBlock Grid.Column="4" Text="{x:Bind SpecificationsPreview}" TextTrimming="CharacterEllipsis" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,12,0"/>
                                    <TextBlock Grid.Column="5" Text="{x:Bind QuantityOrderedDisplay}" HorizontalAlignment="Right"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </Border>

            <!-- Specs Detail Panel -->
            <Border Grid.Column="1" 
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16"
                    Visibility="{x:Bind ViewModel.IsLineSelected, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid RowSpacing="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Title -->
                    <TextBlock Grid.Row="0" 
                               Text="{x:Bind ViewModel.SelectedPOLineTitle, Mode=OneWay}" 
                               Style="{ThemeResource SubtitleTextBlockStyle}"
                               HorizontalAlignment="Center"
                               TextAlignment="Center"/>

                    <!-- Fields -->
                    <StackPanel Grid.Row="1" Spacing="8">
                        <!-- Part ID -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Part ID:" FontWeight="SemiBold" Margin="0,0,8,0"/>
                            <TextBlock Grid.Column="1" Text="{x:Bind ViewModel.SelectedPOLine.PartID, Mode=OneWay}" TextWrapping="Wrap"/>
                        </Grid>

                        <!-- Description -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Desc:" FontWeight="SemiBold" Margin="0,0,8,0"/>
                            <TextBlock Grid.Column="1" Text="{x:Bind ViewModel.SelectedPOLine.Description, Mode=OneWay}" TextWrapping="Wrap"/>
                        </Grid>

                        <!-- Quantity -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Qty:" FontWeight="SemiBold" Margin="0,0,8,0"/>
                            <TextBlock Grid.Column="1" Text="{x:Bind ViewModel.SelectedPOLine.QuantityOrderedDisplay, Mode=OneWay}"/>
                        </Grid>

                        <!-- WO/CO (Hide if empty) -->
                        <Grid Visibility="{x:Bind ViewModel.HasReferenceInfo, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                             <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Ref:" FontWeight="SemiBold" Margin="0,0,8,0"/>
                            <TextBlock Grid.Column="1" Text="{x:Bind ViewModel.SelectedPOLine.ReferenceInfo, Mode=OneWay}" TextWrapping="Wrap"/>
                        </Grid>
                    </StackPanel>

                    <!-- Specs -->
                    <Border Grid.Row="2" Background="{ThemeResource LayerFillColorDefaultBrush}" CornerRadius="4" Padding="8">
                         <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <TextBlock Text="{x:Bind ViewModel.SelectedPOLine.Specifications, Mode=OneWay}" 
                                       TextWrapping="Wrap" 
                                       Style="{ThemeResource BodyTextBlockStyle}"/>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="12">
            <ProgressRing IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                          Width="20" Height="20"/>
            <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                       VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right">
            <Button Content="{x:Bind ViewModel.NavigationButtonText, Mode=OneWay}"
                    Command="{x:Bind ViewModel.ProceedToStep2Command}"
                    Style="{StaticResource AccentButtonStyle}"/>
        </StackPanel>
    </Grid>
</Page>
</file>

<file path="Module_Settings/ViewModels/ViewModel_Settings_DatabaseTest.cs">
/// <summary>
/// ViewModel for Settings Database Test - Development tool for validating database implementation
/// </summary>
public partial class ViewModel_Settings_DatabaseTest : ViewModel_Shared_Base
⋮----
private readonly Dao_SystemSettings _daoSystemSettings;
private readonly Dao_UserSettings _daoUserSettings;
private readonly Dao_PackageType _daoPackageType;
private readonly Dao_PackageTypeMappings _daoPackageTypeMappings;
private readonly Dao_RoutingRule _daoRoutingRule;
private readonly Dao_ScheduledReport _daoScheduledReport;
private readonly Dao_SettingsAuditLog _daoSettingsAuditLog;
⋮----
// Connection Status
⋮----
// Test Summary
⋮----
// Test Results
⋮----
// Test Execution
⋮----
private DateTime _lastRunTime = DateTime.Now;
⋮----
// Don't run tests in constructor - let view trigger it
// This prevents null reference issues during initialization
⋮----
private async Task RunAllTestsAsync()
⋮----
var stopwatch = Stopwatch.StartNew();
⋮----
LogMessages.Clear();
⋮----
await _logger.LogInfoAsync("Database test suite started", "ViewModel_Settings_DatabaseTest");
⋮----
// Test connection
⋮----
// Test tables
⋮----
// Test stored procedures
⋮----
// Test DAOs
⋮----
stopwatch.Stop();
⋮----
await _logger.LogInfoAsync($"Database tests completed successfully in {TotalTestDurationMs}ms", "ViewModel_Settings_DatabaseTest");
⋮----
await _logger.LogErrorAsync($"Database test execution failed: {ex.Message}", ex, "ViewModel_Settings_DatabaseTest");
_errorHandler.HandleException(
⋮----
private async Task ExportResultsAsync()
⋮----
var exportRoot = Path.Combine(
Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData),
⋮----
Directory.CreateDirectory(exportRoot);
⋮----
var timestamp = DateTime.Now.ToString("yyyyMMdd_HHmmss");
⋮----
var jsonPath = Path.Combine(exportRoot, $"SettingsDbTest_{timestamp}.json");
var logPath = Path.Combine(exportRoot, $"SettingsDbTest_{timestamp}.log.txt");
var tablesCsvPath = Path.Combine(exportRoot, $"SettingsDbTest_{timestamp}_tables.csv");
var procsCsvPath = Path.Combine(exportRoot, $"SettingsDbTest_{timestamp}_stored_procedures.csv");
var daosCsvPath = Path.Combine(exportRoot, $"SettingsDbTest_{timestamp}_daos.csv");
⋮----
var needsQuotes = s.Contains(',') || s.Contains('"') || s.Contains('\n') || s.Contains('\r');
⋮----
return "\"" + s.Replace("\"", "\"\"") + "\"";
⋮----
.Select(t => new { t.TableName, t.IsValid, t.StatusText, t.Details })
.ToList(),
⋮----
.Select(p => new { p.ProcedureName, p.IsValid, p.ExecutionTimeMs, p.TestDetails })
⋮----
.Select(d => new { d.DaoName, d.IsValid, d.StatusText, d.OperationsTested })
⋮----
.Select(a => new
⋮----
Logs = (LogMessages ?? new ObservableCollection<string>()).ToList()
⋮----
var json = JsonSerializer.Serialize(report, new JsonSerializerOptions
⋮----
await File.WriteAllTextAsync(jsonPath, json, Encoding.UTF8);
await File.WriteAllTextAsync(logPath, string.Join(Environment.NewLine, report.Logs), Encoding.UTF8);
⋮----
var tablesCsv = new StringBuilder();
tablesCsv.AppendLine("TableName,IsValid,StatusText,Details");
⋮----
tablesCsv.AppendLine($"{EscapeCsv(t.TableName)},{t.IsValid},{EscapeCsv(t.StatusText)},{EscapeCsv(t.Details)}");
⋮----
await File.WriteAllTextAsync(tablesCsvPath, tablesCsv.ToString(), Encoding.UTF8);
⋮----
var procsCsv = new StringBuilder();
procsCsv.AppendLine("ProcedureName,IsValid,ExecutionTimeMs,TestDetails");
⋮----
procsCsv.AppendLine($"{EscapeCsv(p.ProcedureName)},{p.IsValid},{p.ExecutionTimeMs},{EscapeCsv(p.TestDetails)}");
⋮----
await File.WriteAllTextAsync(procsCsvPath, procsCsv.ToString(), Encoding.UTF8);
⋮----
var daosCsv = new StringBuilder();
daosCsv.AppendLine("DaoName,IsValid,StatusText,OperationsTested");
⋮----
daosCsv.AppendLine($"{EscapeCsv(d.DaoName)},{d.IsValid},{EscapeCsv(d.StatusText)},{EscapeCsv(d.OperationsTested)}");
⋮----
await File.WriteAllTextAsync(daosCsvPath, daosCsv.ToString(), Encoding.UTF8);
⋮----
await _logger.LogInfoAsync($"Settings DB Test export completed: {jsonPath}", "ViewModel_Settings_DatabaseTest");
⋮----
_errorHandler.HandleException(ex, Enum_ErrorSeverity.Low, nameof(ExportResultsAsync), nameof(ViewModel_Settings_DatabaseTest));
⋮----
private async Task LoadAuditLogAsync()
⋮----
AuditLogEntries.Clear();
⋮----
var settingsResult = await _daoSystemSettings.GetAllAsync();
⋮----
var auditResult = await _daoSettingsAuditLog.GetAsync(settingId, 50);
⋮----
AuditLogEntries.Add(entry);
⋮----
_errorHandler.HandleException(ex, Enum_ErrorSeverity.Low, nameof(LoadAuditLogAsync), nameof(ViewModel_Settings_DatabaseTest));
⋮----
private async Task TestConnectionAsync()
⋮----
await _logger.LogInfoAsync("Testing database connection", "ViewModel_Settings_DatabaseTest");
⋮----
await using var connection = new MySqlConnection(Helper_Database_Variables.GetConnectionString());
await connection.OpenAsync();
⋮----
await _logger.LogInfoAsync($"Database connection successful in {ConnectionTimeMs}ms - MySQL {ServerVersion}", "ViewModel_Settings_DatabaseTest");
⋮----
await _logger.LogErrorAsync($"Database connection failed: {ex.Message}", ex, "ViewModel_Settings_DatabaseTest");
⋮----
private async Task TestTablesAsync()
⋮----
TableResults.Clear();
⋮----
// Query to check if table exists and get basic info
⋮----
await using var command = new MySqlCommand(query, connection);
var exists = Convert.ToInt32(await command.ExecuteScalarAsync()) > 0;
⋮----
TableResults.Add(new Model_TableTestResult
⋮----
private async Task TestStoredProceduresAsync()
⋮----
StoredProcedureResults.Clear();
⋮----
var sw = Stopwatch.StartNew();
⋮----
sw.Stop();
⋮----
StoredProcedureResults.Add(new Model_StoredProcedureTestResult
⋮----
private async Task TestDaosAsync()
⋮----
DaoResults.Clear();
⋮----
// Test SystemSettings DAO
⋮----
var result = await _daoSystemSettings.GetAllAsync();
⋮----
// Test UserSettings DAO
⋮----
// Validate stored procedures + mapping by doing a lightweight read.
// User ID 1 is used as a safe default for dev testing.
var result = await _daoUserSettings.GetAllForUserAsync(1);
⋮----
// Test PackageType DAO
⋮----
var result = await _daoPackageType.GetAllAsync();
⋮----
// Test RoutingRule DAO
⋮----
var result = await _daoRoutingRule.GetAllAsync();
⋮----
// Test ScheduledReport DAO
⋮----
var result = await _daoScheduledReport.GetAllAsync();
⋮----
// Test PackageTypeMappings DAO
⋮----
var result = await _daoPackageTypeMappings.GetAllAsync();
⋮----
// Test SettingsAuditLog DAO
⋮----
var auditResult = await _daoSettingsAuditLog.GetAsync(settingsResult.Data[0].Id, 10);
⋮----
private async Task<bool> TestDaoAsync(string daoName, Func<Task<bool>> testFunc)
⋮----
DaoResults.Add(new Model_DaoTestResult
⋮----
private void AddLog(string message)
⋮----
var timestamp = DateTime.Now.ToString("HH:mm:ss.fff");
LogMessages.Add($"[{timestamp}] {message}");
</file>

<file path="Module_Volvo/Data/Dao_VolvoShipment.cs">
/// <summary>
/// Data Access Object for volvo_label_data table
/// Provides CRUD operations using stored procedures
/// </summary>
public class Dao_VolvoShipment
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
/// Inserts a new Volvo shipment and returns the generated ID and shipment number
⋮----
/// <param name="shipment">Volvo shipment model to insert</param>
/// <returns>Model_Dao_Result with shipment ID and number in Data property</returns>
public async Task<Model_Dao_Result<(int ShipmentId, int ShipmentNumber)>> InsertAsync(Model_VolvoShipment shipment)
⋮----
await using var connection = new MySqlConnection(_connectionString);
await connection.OpenAsync();
⋮----
await using var command = new MySqlCommand("sp_volvo_shipment_insert", connection)
⋮----
// Input parameters
command.Parameters.AddWithValue("@p_shipment_date", shipment.ShipmentDate);
command.Parameters.AddWithValue("@p_employee_number", shipment.EmployeeNumber);
command.Parameters.AddWithValue("@p_notes", shipment.Notes ?? (object)DBNull.Value);
⋮----
// Output parameters
var newIdParam = new MySqlParameter("@p_new_id", MySqlDbType.Int32)
⋮----
var shipmentNumberParam = new MySqlParameter("@p_shipment_number", MySqlDbType.Int32)
⋮----
command.Parameters.Add(newIdParam);
command.Parameters.Add(shipmentNumberParam);
⋮----
await command.ExecuteNonQueryAsync();
⋮----
var shipmentId = Convert.ToInt32(newIdParam.Value);
var shipmentNumber = Convert.ToInt32(shipmentNumberParam.Value);
⋮----
/// Updates a Volvo shipment
⋮----
/// <param name="shipment">Volvo shipment model to update</param>
/// <returns>Model_Dao_Result indicating success/failure</returns>
public async Task<Model_Dao_Result> UpdateAsync(Model_VolvoShipment shipment)
⋮----
var result = await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
return new Model_Dao_Result
⋮----
/// Completes a shipment with PO and Receiver numbers
⋮----
/// <param name="shipmentId">Shipment ID</param>
/// <param name="poNumber">Purchase order number</param>
/// <param name="receiverNumber">Receiver number</param>
⋮----
public async Task<Model_Dao_Result> CompleteAsync(int shipmentId, string poNumber, string receiverNumber)
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
/// Deletes a shipment and all its lines (CASCADE DELETE)
⋮----
/// <param name="shipmentId">Shipment ID to delete</param>
⋮----
public async Task<Model_Dao_Result> DeleteAsync(int shipmentId)
⋮----
/// Gets the pending shipment if one exists
⋮----
/// <returns>Model_Dao_Result with pending shipment or null if none exists</returns>
public async Task<Model_Dao_Result<Model_VolvoShipment>> GetPendingAsync()
⋮----
return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
⋮----
/// Gets a shipment by ID
⋮----
/// <returns>Model_Dao_Result with shipment or null if not found</returns>
public async Task<Model_Dao_Result<Model_VolvoShipment?>> GetByIdAsync(int shipmentId)
⋮----
await using var command = new MySqlCommand
⋮----
command.Parameters.AddWithValue("@p_id", shipmentId);
⋮----
await using var reader = await command.ExecuteReaderAsync();
⋮----
if (await reader.ReadAsync())
⋮----
/// Gets shipment history with filtering
⋮----
/// <param name="startDate">Start date for filter</param>
/// <param name="endDate">End date for filter</param>
/// <param name="status">Status filter ('pending_po', 'completed', or 'all')</param>
/// <returns>Model_Dao_Result with list of shipments</returns>
public async Task<Model_Dao_Result<List<Model_VolvoShipment>>> GetHistoryAsync(
⋮----
return await Helper_Database_StoredProcedure.ExecuteListAsync(
⋮----
/// Maps DataReader to Model_VolvoShipment
⋮----
/// <param name="reader"></param>
private static Model_VolvoShipment MapFromReader(IDataReader reader)
⋮----
return new Model_VolvoShipment
⋮----
Id = reader.GetInt32(reader.GetOrdinal("id")),
ShipmentDate = reader.GetDateTime(reader.GetOrdinal("shipment_date")),
ShipmentNumber = reader.GetInt32(reader.GetOrdinal("shipment_number")),
PONumber = reader.IsDBNull(reader.GetOrdinal("po_number"))
⋮----
: reader.GetString(reader.GetOrdinal("po_number")),
ReceiverNumber = reader.IsDBNull(reader.GetOrdinal("receiver_number"))
⋮----
: reader.GetString(reader.GetOrdinal("receiver_number")),
EmployeeNumber = reader.GetString(reader.GetOrdinal("employee_number")),
Notes = reader.IsDBNull(reader.GetOrdinal("notes"))
⋮----
: reader.GetString(reader.GetOrdinal("notes")),
Status = reader.GetString(reader.GetOrdinal("status")),
CreatedDate = reader.GetDateTime(reader.GetOrdinal("created_date")),
ModifiedDate = reader.GetDateTime(reader.GetOrdinal("modified_date")),
IsArchived = reader.GetBoolean(reader.GetOrdinal("is_archived"))
</file>

<file path="Module_Volvo/Models/Model_VolvoShipmentLine.cs">
/// <summary>
/// Represents an individual part line item within a Volvo shipment
/// Maps to volvo_line_data database table
/// </summary>
public partial class Model_VolvoShipmentLine : ObservableObject
⋮----
/// Auto-increment primary key
⋮----
/// Foreign key to parent shipment
⋮----
/// Volvo part number (from volvo_masterdata)
/// Example: V-EMB-500, V-EMB-750
⋮----
/// Quantity per skid for this part (cached for recalculation)
⋮----
/// Number of skids actually received (user-entered count)
⋮----
/// Calculated piece count from component explosion
/// IMPORTANT: Stored at creation time (historical integrity - doesn't change if master data updates)
⋮----
/// Flag indicating if there is a discrepancy between expected and received quantities
/// If true, ExpectedSkidCount and DiscrepancyNote are populated
⋮----
/// Expected skid count from Volvo packlist (NULL if no discrepancy)
/// Used to calculate difference: ReceivedSkidCount - ExpectedSkidCount
⋮----
/// User's note about the discrepancy (NULL if no discrepancy)
⋮----
/// Expected piece count (calculated from ExpectedSkidCount × QuantityPerSkid)
/// Returns null if no expected count is set
⋮----
/// Calculated difference between received and expected pieces
/// Positive = more received than expected, Negative = fewer received
⋮----
/// Recalculate pieces when received skid count changes
⋮----
partial void OnReceivedSkidCountChanged(int value)
⋮----
/// Update calculated values when quantity per skid changes
⋮----
partial void OnQuantityPerSkidChanged(int value)
⋮----
/// Update calculated difference when expected skid count changes
⋮----
partial void OnExpectedSkidCountChanged(double? value)
⋮----
/// Clear discrepancy fields when HasDiscrepancy is unchecked
⋮----
partial void OnHasDiscrepancyChanged(bool value)
</file>

<file path="MainWindow.xaml">
<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="MTM_Receiving_Application.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MTM_Receiving_Application"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d"
    x:Name="MainWindowRoot"
    Title="MTM_Receiving_Application">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid>
        <!-- Custom Title Bar Area (when ExtendsContentIntoTitleBar = true) -->
        <Grid x:Name="AppTitleBar" 
              Height="48" 
              VerticalAlignment="Top" 
              Canvas.ZIndex="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- App Icon and Title -->
            <StackPanel Orientation="Horizontal" Spacing="12" Margin="16,0,0,0">
                <Image Source="/Assets/app-icon.ico" 
                       Width="16" 
                       Height="16" 
                       VerticalAlignment="Center"/>
                <TextBlock Text="MTM Receiving Application" 
                           VerticalAlignment="Center"
                           Style="{StaticResource CaptionTextBlockStyle}"/>
            </StackPanel>
        </Grid>

        <NavigationView x:Name="NavView"
                        PaneDisplayMode="Left"
                        IsSettingsVisible="True"
                        SelectionChanged="NavView_SelectionChanged">
            <NavigationView.PaneHeader>
                <TextBlock Text="MTM Receiving" 
                           Style="{StaticResource TitleTextBlockStyle}"
                           Margin="12,0,0,0"/>
            </NavigationView.PaneHeader>
            
            <NavigationView.Header>
                <StackPanel>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock x:Name="PageTitleTextBlock"
                                   Text="Dashboard" 
                                   Style="{StaticResource TitleTextBlockStyle}"
                                   VerticalAlignment="Center"
                                   Margin="16,0"/>
                                   
                        <StackPanel Grid.Column="1" 
                                    Orientation="Horizontal" 
                                    Spacing="12" 
                                    Margin="0,0,24,0"
                                    VerticalAlignment="Center">
                            <PersonPicture x:Name="UserPicture"
                                           Height="32"
                                           Width="32"/>
                            <TextBlock x:Name="UserDisplayTextBlock"
                                       Text="Not Logged In"
                                       VerticalAlignment="Center"
                                       Style="{StaticResource BodyStrongTextBlockStyle}"/>
                        </StackPanel>
                    </Grid>
                    <InfoBar IsOpen="{x:Bind ViewModel.NotificationService.IsStatusOpen, Mode=TwoWay}"
                             Severity="{x:Bind ViewModel.WinUIStatusSeverity, Mode=OneWay}"
                             Message="{x:Bind ViewModel.NotificationService.StatusMessage, Mode=OneWay}"
                             IsClosable="True"
                             HorizontalAlignment="Center"
                             VerticalAlignment="Center"
                             Margin="0,20,0,20"/>
                </StackPanel>
            </NavigationView.Header>

            <NavigationView.MenuItems>
                <NavigationViewItem Content="Receiving Labels" Tag="ReceivingWorkflowView" Margin="0,0,0,4">
                    <NavigationViewItem.Icon>
                        <FontIcon Glyph="&#xE74C;" />
                    </NavigationViewItem.Icon>
                </NavigationViewItem>
                <NavigationViewItem Content="Dunnage Labels" Tag="DunnageLabelPage" Margin="0,0,0,4">
                    <NavigationViewItem.Icon>
                        <FontIcon Glyph="&#xE7B8;" />
                    </NavigationViewItem.Icon>
                </NavigationViewItem>
                <NavigationViewItem Content="UPS / FedEx Labels" Tag="RoutingLabelPage" Margin="0,0,0,4">
                    <NavigationViewItem.Icon>
                        <FontIcon Glyph="&#xE724;" />
                    </NavigationViewItem.Icon>
                </NavigationViewItem>
                <NavigationViewItem Content="Volvo Dunnage Requisition" Tag="VolvoShipmentEntry" Margin="0,0,0,4">
                    <NavigationViewItem.Icon>
                        <FontIcon Glyph="&#xE7C1;" />
                    </NavigationViewItem.Icon>
                </NavigationViewItem>
                <NavigationViewItem Content="End of Day Reports" Tag="ReportingMainPage" Margin="0,0,0,4">
                    <NavigationViewItem.Icon>
                        <FontIcon Glyph="&#xE9F9;" />
                    </NavigationViewItem.Icon>
                </NavigationViewItem>

                <!-- Development Tools (visible in debug builds only) -->
                <NavigationViewItem x:Name="DatabaseTestMenuItem" 
                                    Content="Settings DB Test" 
                                    Tag="DatabaseTestView" 
                                    Margin="0,0,0,4"
                                    Visibility="Collapsed">
                    <NavigationViewItem.Icon>
                        <FontIcon Glyph="&#xE8AB;" />
                    </NavigationViewItem.Icon>
                </NavigationViewItem>

            </NavigationView.MenuItems>

            <Frame x:Name="ContentFrame" />
        </NavigationView>
    </Grid>
</Window>
</file>

<file path="Module_Routing/ViewModels/RoutingWizardStep1ViewModel.cs">
/// <summary>
/// ViewModel for Wizard Step 1: PO and Line Selection (or OTHER workflow)
/// </summary>
public partial class RoutingWizardStep1ViewModel : ObservableObject
⋮----
private readonly IRoutingInforVisualService _inforVisualService;
private readonly IRoutingService _routingService;
private readonly IService_ErrorHandler _errorHandler;
private readonly IService_LoggingUtility _logger;
⋮----
// Issue #24: TODO - Replace with WeakReferenceMessenger for loose coupling
// Current implementation uses direct parent reference for communication
// Migration requires: Message classes, messenger registration, 3 step ViewModels update
private readonly RoutingWizardContainerViewModel _containerViewModel;
⋮----
// Subscribe to container property changes to update button text
⋮----
// Auto-fill PO number if using mock data
⋮----
/// PO Number entered by user
⋮----
/// List of PO lines retrieved from Infor Visual
⋮----
/// Selected PO line from DataGrid
⋮----
/// Helper property for binding visibility of details panel
⋮----
/// Title for the details panel
⋮----
/// Helper to show/hide reference info field
⋮----
public bool HasReferenceInfo => SelectedPOLine != null && !string.IsNullOrEmpty(SelectedPOLine.ReferenceInfo);
⋮----
/// Indicates whether we're in OTHER mode (no PO validation)
⋮----
/// Available OTHER reasons (RETURNED, SAMPLE, etc.)
⋮----
/// Selected OTHER reason from dropdown
⋮----
/// Manual quantity for OTHER workflow
⋮----
/// Busy indicator
⋮----
/// Status message
⋮----
/// Is user editing from review (Step 3)
⋮----
/// Button text for navigation (changes when editing from review)
⋮----
/// Controls visibility of the Reference column (hidden if empty for all rows)
⋮----
/// Controls visibility of the Specs column (hidden if empty for all rows)
⋮----
/// Validate PO number and fetch lines
⋮----
private async Task ValidatePOAsync()
⋮----
if (string.IsNullOrWhiteSpace(PoNumber))
⋮----
// Validate PO exists in Infor Visual
var validationResult = await _inforVisualService.ValidatePoNumberAsync(PoNumber);
⋮----
// Issue #30: Better progress feedback
⋮----
// PO is valid - fetch lines
var linesResult = await _inforVisualService.GetPoLinesAsync(PoNumber);
⋮----
PoLines.Clear();
⋮----
PoLines.Add(line);
if (!string.IsNullOrEmpty(line.ReferenceInfo)) hasRefs = true;
if (!string.IsNullOrEmpty(line.SpecificationsPreview)) hasSpecs = true;
⋮----
// Issue #27: Check for empty lines result
⋮----
await _errorHandler.ShowUserErrorAsync(
⋮----
// PO not found or Infor Visual offline
⋮----
_errorHandler.HandleException(
⋮----
/// Switch to OTHER mode (manual entry without PO)
⋮----
private async Task SwitchToOtherModeAsync()
⋮----
// Issue #13: GetOtherReasonsAsync not implemented in IRoutingService
// Feature requires database table: routing_po_alternatives (id, reason_code, description, is_active)
// Stored procedure: sp_routing_po_alternatives_get_active
// Priority: LOW - Wizard mode (PO-based) is primary workflow
// var reasonsResult = await _routingService.GetOtherReasonsAsync();
// if (reasonsResult.IsSuccess && reasonsResult.Data != null)
// {
//     OtherReasons.Clear();
//     foreach (var reason in reasonsResult.Data)
//     {
//         OtherReasons.Add(reason);
//     }
//     IsOtherMode = true;
//     PoLines.Clear();
//     StatusMessage = "Select a reason for non-PO package";
// }
// else
⋮----
//     await _errorHandler.ShowUserErrorAsync(
//         "Failed to load OTHER reasons",
//         "Data Load Error",
//         nameof(SwitchToOtherModeAsync));
⋮----
/// Proceed to Step 2 (Recipient Selection)
⋮----
private void ProceedToStep2()
⋮----
_logger.LogInfo($"ProceedToStep2 called - IsOtherMode: {IsOtherMode}, SelectedPOLine: {SelectedPOLine?.PartID ?? "null"}, SelectedOtherReason: {SelectedOtherReason?.Description ?? "null"}");
⋮----
// Update container with selected data
⋮----
_logger.LogInfo($"Updated container with OTHER reason: {SelectedOtherReason.Description}, Quantity: {OtherQuantity}");
⋮----
_logger.LogInfo($"Updated container with PO Line: {SelectedPOLine.PartID}, PO: {SelectedPOLine.PONumber}");
⋮----
_logger.LogWarning("ProceedToStep2: Neither PO line nor OTHER reason selected");
⋮----
// Navigate based on edit mode
⋮----
_logger.LogInfo("Returning to Step 3 (Review) after edit");
_containerViewModel.NavigateToStep3Command.Execute(null);
⋮----
_logger.LogInfo("Executing NavigateToStep2Command");
_containerViewModel.NavigateToStep2Command.Execute(null);
_logger.LogInfo("NavigateToStep2Command executed");
⋮----
_logger.LogError($"Error in ProceedToStep2: {ex.Message}", ex);
⋮----
/// Can proceed to Step 2 if either PO line or OTHER reason is selected
⋮----
private bool CanProceedToStep2()
⋮----
_logger.LogInfo($"CanProceedToStep2: {canProceed} - IsOtherMode: {IsOtherMode}, SelectedPOLine: {SelectedPOLine?.PartID ?? "null"}, SelectedOtherReason: {SelectedOtherReason?.Description ?? "null"}");
⋮----
/// Show "PO not found" confirmation dialog
⋮----
private async Task ShowPONotFoundDialogAsync()
⋮----
// Issue #29: Null guard for XamlRoot
⋮----
var dialog = new ContentDialog
⋮----
var result = await dialog.ShowAsync();
⋮----
// User chose to treat as OTHER
⋮----
// User chose to retry
⋮----
/// Notify command can execute changed when selection changes
⋮----
partial void OnSelectedPOLineChanged(Model_InforVisualPOLine? value)
⋮----
_logger.LogInfo($"SelectedPOLine changed to: {value?.PartID ?? "null"} (PO: {value?.PONumber ?? "null"})");
ProceedToStep2Command.NotifyCanExecuteChanged();
⋮----
partial void OnSelectedOtherReasonChanged(Model_RoutingOtherReason? value)
⋮----
_logger.LogInfo($"SelectedOtherReason changed to: {value?.Description ?? "null"}");
⋮----
/// Initialize component - autofill PO if mock data enabled
⋮----
private async void InitializeAsync()
⋮----
await _logger.LogInfoAsync($"[MOCK DATA MODE] Auto-filling PO number: {defaultPO}");
⋮----
// Auto-validate and load mock data
await Task.Delay(500); // Small delay for UI update
⋮----
await _logger.LogErrorAsync($"Error during initialization: {ex.Message}", ex);
</file>

<file path="Module_Volvo/Services/Service_Volvo.cs">
/// <summary>
/// Service for Volvo dunnage requisition business logic
/// Handles component explosion, CSV generation, email formatting, and shipment management
/// </summary>
public class Service_Volvo : IService_Volvo
⋮----
private readonly Dao_VolvoShipment _shipmentDao;
private readonly Dao_VolvoShipmentLine _lineDao;
private readonly Dao_VolvoPart _partDao;
private readonly Dao_VolvoPartComponent _componentDao;
private readonly IService_LoggingUtility _logger;
private readonly IService_VolvoAuthorization _authService;
⋮----
_shipmentDao = shipmentDao ?? throw new ArgumentNullException(nameof(shipmentDao));
_lineDao = lineDao ?? throw new ArgumentNullException(nameof(lineDao));
_partDao = partDao ?? throw new ArgumentNullException(nameof(partDao));
_componentDao = componentDao ?? throw new ArgumentNullException(nameof(componentDao));
_logger = logger ?? throw new ArgumentNullException(nameof(logger));
_authService = authService ?? throw new ArgumentNullException(nameof(authService));
⋮----
/// Calculates component explosion and aggregates piece counts for all parts in shipment
/// Algorithm:
/// 1. For each line, get parent part quantity per skid
/// 2. Calculate parent pieces: skidCount × qtyPerSkid
/// 3. Get components for parent part
/// 4. For each component, calculate pieces: skidCount × componentQty × componentQtyPerSkid
/// 5. Aggregate duplicates across all lines
⋮----
/// <param name="lines"></param>
public async Task<Model_Dao_Result<Dictionary<string, int>>> CalculateComponentExplosionAsync(
⋮----
await _logger.LogInfoAsync("Calculating component explosion for shipment lines");
⋮----
// Get parent part details
var partResult = await _partDao.GetByIdAsync(line.PartNumber);
⋮----
// Validate quantity per skid
⋮----
// Add parent part pieces
⋮----
if (aggregatedPieces.ContainsKey(line.PartNumber))
⋮----
// Get and add component pieces
var componentsResult = await _componentDao.GetByParentPartAsync(line.PartNumber);
⋮----
// Validate component quantities
⋮----
await _logger.LogWarningAsync(
⋮----
// Component pieces = skidCount × componentQty × componentQtyPerSkid
⋮----
if (aggregatedPieces.ContainsKey(component.ComponentPartNumber))
⋮----
await _logger.LogInfoAsync($"Component explosion complete: {aggregatedPieces.Count} unique parts");
⋮----
await _logger.LogErrorAsync($"Error calculating component explosion: {ex.Message}", ex);
⋮----
/// Generates CSV file for LabelView 2022 label printing
/// Format: Material,Quantity,Employee,Date,Time,Receiver,Notes
⋮----
/// <param name="shipmentId"></param>
public async Task<Model_Dao_Result<string>> GenerateLabelCsvAsync(int shipmentId)
⋮----
// Authorization check
var authResult = await _authService.CanGenerateLabelsAsync();
⋮----
// Validate shipmentId (prevent file path injection)
⋮----
await _logger.LogInfoAsync($"Generating label CSV for shipment {shipmentId}");
⋮----
// Get shipment details
var shipmentResult = await _shipmentDao.GetByIdAsync(shipmentId);
⋮----
// Get shipment lines
var linesResult = await _lineDao.GetByShipmentIdAsync(shipmentId);
⋮----
// Calculate component explosion
⋮----
// Sanity check: prevent extremely large CSV files
⋮----
// Create CSV directory
string appDataPath = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
string csvDirectory = Path.Combine(appDataPath, "MTM_Receiving_Application", "Volvo", "Labels");
Directory.CreateDirectory(csvDirectory);
⋮----
// Use fixed filename Volvo_Labels.csv (overwrites previous)
⋮----
string filePath = Path.Combine(csvDirectory, fileName);
⋮----
// Build CSV content
var csvContent = new StringBuilder();
csvContent.AppendLine("Material,Quantity,Employee,Date,Time,Receiver,Notes");
⋮----
string dateFormatted = shipment.ShipmentDate.ToString("MM/dd/yyyy");
string timeFormatted = DateTime.Now.ToString("HH:mm:ss");
⋮----
foreach (var kvp in aggregatedPieces.OrderBy(x => x.Key))
⋮----
// Format: Material,Quantity,Employee,Date,Time,Receiver,Notes
// Receiver field is empty for Volvo parts (per spec - hide PO field for V-EMB- parts)
csvContent.AppendLine($"{kvp.Key},{kvp.Value},{shipment.EmployeeNumber},{dateFormatted},{timeFormatted},,");
⋮----
// Write CSV file
await File.WriteAllTextAsync(filePath, csvContent.ToString());
⋮----
await _logger.LogInfoAsync($"Label CSV generated: {filePath}");
⋮----
await _logger.LogErrorAsync($"Error generating label CSV: {ex.Message}", ex);
⋮----
/// Formats email text for PO requisition (with discrepancy notice if applicable)
⋮----
/// <param name="shipment"></param>
⋮----
/// <param name="requestedLines"></param>
public async Task<string> FormatEmailTextAsync(
⋮----
// Null guard for requestedLines
⋮----
var emailText = new StringBuilder();
⋮----
// Subject line (for user reference)
emailText.AppendLine($"Subject: PO Requisition - Volvo Dunnage - {shipment.ShipmentDate:MM/dd/yyyy} Shipment #{shipment.ShipmentNumber}");
emailText.AppendLine();
⋮----
// Greeting
emailText.AppendLine("Good morning,");
⋮----
emailText.AppendLine($"Please create a PO for the following Volvo dunnage received on {shipment.ShipmentDate:MM/dd/yyyy}:");
⋮----
// Discrepancy section (if any)
var discrepancies = lines.Where(l => l.HasDiscrepancy).ToList();
⋮----
emailText.AppendLine("**DISCREPANCIES NOTED**");
⋮----
emailText.AppendLine("Part Number\tPacklist Qty (pcs)\tReceived Qty (pcs)\tDifference (pcs)\tNote");
emailText.AppendLine(new string('-', 80));
⋮----
string diffStr = difference > 0 ? $"+{difference}" : difference.ToString();
emailText.AppendLine($"{line.PartNumber}\t{expectedPieces}\t{receivedPieces}\t{diffStr}\t{line.DiscrepancyNote ?? ""}");
⋮----
// Requested lines section
emailText.AppendLine("Requested Lines:");
⋮----
emailText.AppendLine("Part Number\tQuantity (pcs)");
emailText.AppendLine(new string('-', 40));
⋮----
foreach (var kvp in requestedLines.OrderBy(x => x.Key))
⋮----
emailText.AppendLine($"{kvp.Key}\t{kvp.Value}");
⋮----
// Notes section (if any)
if (!string.IsNullOrWhiteSpace(shipment.Notes))
⋮----
emailText.AppendLine("Additional Notes:");
emailText.AppendLine(shipment.Notes);
⋮----
await _logger.LogInfoAsync("Email text formatted");
⋮----
return emailText.ToString();
⋮----
/// Formats email data for PO requisition (structured for display and HTML conversion)
⋮----
public async Task<Model_VolvoEmailData> FormatEmailDataAsync(
⋮----
var emailData = new Model_VolvoEmailData
⋮----
AdditionalNotes = string.IsNullOrWhiteSpace(shipment.Notes) ? null : shipment.Notes,
⋮----
// Build discrepancy list
⋮----
emailData.Discrepancies.Add(new Model_VolvoEmailData.DiscrepancyLineItem
⋮----
await _logger.LogInfoAsync("Email data formatted");
⋮----
/// Converts structured email data to HTML format with tables for Outlook paste
⋮----
/// <param name="emailData"></param>
public string FormatEmailAsHtml(Model_VolvoEmailData emailData)
⋮----
var html = new StringBuilder();
⋮----
html.AppendLine("<html>");
html.AppendLine("<body style='font-family: Calibri, Arial, sans-serif; font-size: 11pt;'>");
⋮----
html.AppendLine($"<p>{emailData.Greeting}</p>");
html.AppendLine($"<p>{emailData.Message}</p>");
⋮----
// Discrepancy table
⋮----
html.AppendLine("<p><strong>**DISCREPANCIES NOTED**</strong></p>");
html.AppendLine("<table border='1' cellpadding='5' cellspacing='0' style='border-collapse: collapse; font-size: 10pt;'>");
html.AppendLine("<thead>");
html.AppendLine("<tr style='background-color: #D9D9D9; font-weight: bold;'>");
html.AppendLine("<th>Part Number</th>");
html.AppendLine("<th>Packlist Qty</th>");
html.AppendLine("<th>Received Qty</th>");
html.AppendLine("<th>Difference</th>");
html.AppendLine("<th>Note</th>");
html.AppendLine("</tr>");
html.AppendLine("</thead>");
html.AppendLine("<tbody>");
⋮----
string diffStr = disc.Difference > 0 ? $"+{disc.Difference}" : disc.Difference.ToString();
html.AppendLine("<tr>");
html.AppendLine($"<td>{disc.PartNumber}</td>");
html.AppendLine($"<td>{disc.PacklistQty}</td>");
html.AppendLine($"<td>{disc.ReceivedQty}</td>");
html.AppendLine($"<td>{diffStr}</td>");
html.AppendLine($"<td>{disc.Note}</td>");
⋮----
html.AppendLine("</tbody>");
html.AppendLine("</table>");
html.AppendLine("<br/>");
⋮----
// Requested Lines table
html.AppendLine("<p><strong>Requested Lines:</strong></p>");
⋮----
html.AppendLine("<th>Quantity (pcs)</th>");
⋮----
foreach (var kvp in emailData.RequestedLines.OrderBy(x => x.Key))
⋮----
html.AppendLine($"<td>{kvp.Key}</td>");
html.AppendLine($"<td>{kvp.Value}</td>");
⋮----
// Notes
if (!string.IsNullOrWhiteSpace(emailData.AdditionalNotes))
⋮----
html.AppendLine("<p><strong>Additional Notes:</strong></p>");
html.AppendLine($"<p>{emailData.AdditionalNotes}</p>");
⋮----
// Signature
html.AppendLine($"<p>{emailData.Signature.Replace("\\n", "<br/>")}</p>");
⋮----
html.AppendLine("</body>");
html.AppendLine("</html>");
⋮----
return html.ToString();
⋮----
/// Validates shipment data before save
/// Centralized validation logic for data integrity
⋮----
public async Task<Model_Dao_Result> ValidateShipmentAsync(
⋮----
// Validate: At least one line required
⋮----
return Model_Dao_Result_Factory.Failure("At least one part line is required");
⋮----
// Validate: All lines have valid data
⋮----
if (string.IsNullOrWhiteSpace(line.PartNumber))
⋮----
return Model_Dao_Result_Factory.Failure("All parts must have a part number");
⋮----
return Model_Dao_Result_Factory.Failure(
⋮----
// Validate: Shipment date not in future
if (shipment.ShipmentDate > DateTime.Now.AddDays(1))
⋮----
return Model_Dao_Result_Factory.Failure("Shipment date cannot be in the future");
⋮----
await _logger.LogInfoAsync("Shipment validation passed");
return Model_Dao_Result_Factory.Success();
⋮----
/// Saves shipment and lines with status='pending_po'
/// Validates: Only one pending shipment allowed at a time
⋮----
/// <param name="overwriteExisting">If true, deletes any existing pending shipment before saving</param>
public async Task<Model_Dao_Result<(int ShipmentId, int ShipmentNumber)>> SaveShipmentAsync(
⋮----
var authResult = await _authService.CanManageShipmentsAsync();
⋮----
await _logger.LogInfoAsync("Saving Volvo shipment as pending PO");
⋮----
// Check for existing pending shipment
var existingPendingResult = await _shipmentDao.GetPendingAsync();
⋮----
// Delete the existing pending shipment
await _logger.LogInfoAsync($"Deleting existing pending shipment #{existingPendingResult.Data.ShipmentNumber}");
var deleteResult = await _shipmentDao.DeleteAsync(existingPendingResult.Data.Id);
⋮----
// Return the existing shipment info so the UI can prompt for overwrite
⋮----
// Calculate and store piece counts for each line
⋮----
// Calculate parent part pieces only (components handled separately)
⋮----
// Insert shipment
var insertResult = await _shipmentDao.InsertAsync(shipment);
⋮----
await _logger.LogInfoAsync($"Starting line insertion transaction for shipment {shipmentId}, {lines.Count} lines to insert");
⋮----
// Insert lines within transaction for data integrity
await using var connection = new MySqlConnection(Helper_Database_Variables.GetConnectionString());
await connection.OpenAsync();
await using var transaction = await connection.BeginTransactionAsync();
⋮----
await _logger.LogInfoAsync($"Inserting line {lineIndex}/{lines.Count}: " +
⋮----
$"Note={(!string.IsNullOrEmpty(line.DiscrepancyNote) ? "PROVIDED" : "NULL")}");
⋮----
await _logger.LogInfoAsync($"Parameters: {string.Join(", ", parameters.Select(p => $"{p.Key}={p.Value}"))}");
⋮----
var lineResult = await Helper_Database_StoredProcedure.ExecuteInTransactionAsync(
⋮----
await transaction.RollbackAsync();
await _logger.LogErrorAsync($"Failed to insert line {lineIndex} for part {line.PartNumber}");
await _logger.LogErrorAsync($"Error: {lineResult.ErrorMessage}");
⋮----
await _logger.LogErrorAsync($"Exception Type: {lineResult.Exception.GetType().Name}");
await _logger.LogErrorAsync($"Exception Message: {lineResult.Exception.Message}");
⋮----
await _logger.LogErrorAsync($"Inner Exception: {lineResult.Exception.InnerException.Message}");
⋮----
await _logger.LogInfoAsync($"Line {lineIndex} inserted successfully");
⋮----
await transaction.CommitAsync();
await _logger.LogInfoAsync($"Transaction committed: Shipment {shipmentId} saved with {lines.Count} lines");
⋮----
await _logger.LogErrorAsync($"Transaction failed, rolled back: {ex.Message}", ex);
⋮----
await _logger.LogErrorAsync($"Error saving shipment: {ex.Message}", ex);
⋮----
/// Gets pending shipment if one exists
⋮----
public async Task<Model_Dao_Result<Model_VolvoShipment?>> GetPendingShipmentAsync()
⋮----
var result = await _shipmentDao.GetPendingAsync();
⋮----
/// Gets pending shipment with all line items
⋮----
public async Task<Model_Dao_Result<(Model_VolvoShipment? Shipment, List<Model_VolvoShipmentLine> Lines)>> GetPendingShipmentWithLinesAsync()
⋮----
var shipmentResult = await _shipmentDao.GetPendingAsync();
⋮----
var linesResult = await _lineDao.GetByShipmentIdAsync(shipmentResult.Data.Id);
⋮----
await _logger.LogErrorAsync($"Error getting pending shipment with lines: {ex.Message}", ex);
⋮----
/// Completes shipment with PO and Receiver numbers
⋮----
/// <param name="poNumber"></param>
/// <param name="receiverNumber"></param>
public async Task<Model_Dao_Result> CompleteShipmentAsync(int shipmentId, string poNumber, string receiverNumber)
⋮----
var authResult = await _authService.CanCompleteShipmentsAsync();
⋮----
return new Model_Dao_Result
⋮----
await _logger.LogInfoAsync($"Completing shipment {shipmentId} with PO={poNumber}, Receiver={receiverNumber}");
⋮----
// Validate inputs
if (string.IsNullOrWhiteSpace(poNumber))
⋮----
if (string.IsNullOrWhiteSpace(receiverNumber))
⋮----
var result = await _shipmentDao.CompleteAsync(shipmentId, poNumber, receiverNumber);
⋮----
await _logger.LogInfoAsync($"Shipment {shipmentId} completed successfully");
⋮----
await _logger.LogErrorAsync($"Error completing shipment: {ex.Message}", ex);
⋮----
/// Gets all active Volvo parts for dropdown population
⋮----
public async Task<Model_Dao_Result<List<Model_VolvoPart>>> GetActivePartsAsync()
⋮----
return await _partDao.GetAllAsync(includeInactive: false);
⋮----
/// Gets shipment history with filtering
⋮----
/// <param name="startDate"></param>
/// <param name="endDate"></param>
/// <param name="status"></param>
public async Task<Model_Dao_Result<List<Model_VolvoShipment>>> GetHistoryAsync(
⋮----
return await _shipmentDao.GetHistoryAsync(startDate, endDate, status);
⋮----
/// Gets all shipment lines for a specific shipment
⋮----
public async Task<Model_Dao_Result<List<Model_VolvoShipmentLine>>> GetShipmentLinesAsync(int shipmentId)
⋮----
return await _lineDao.GetByShipmentIdAsync(shipmentId);
⋮----
/// Updates an existing shipment and its lines
/// Regenerates CSV if applicable
⋮----
public async Task<Model_Dao_Result> UpdateShipmentAsync(
⋮----
// Update shipment header
var shipmentResult = await _shipmentDao.UpdateAsync(shipment);
⋮----
// Delete existing lines
var existingLines = await _lineDao.GetByShipmentIdAsync(shipment.Id);
⋮----
await _lineDao.DeleteAsync(line.Id);
⋮----
// Insert updated lines
⋮----
var lineResult = await _lineDao.InsertAsync(line);
⋮----
await _logger.LogErrorAsync(
⋮----
// Regenerate CSV if completed
if (shipment.Status == "completed" && !string.IsNullOrEmpty(shipment.PONumber))
⋮----
return Model_Dao_Result_Factory.Success("Shipment updated successfully");
⋮----
return Model_Dao_Result_Factory.Failure($"Error updating shipment: {ex.Message}");
⋮----
/// Exports shipment history to CSV format
⋮----
public async Task<Model_Dao_Result<string>> ExportHistoryToCsvAsync(
⋮----
var csv = new StringBuilder();
csv.AppendLine("ShipmentNumber,Date,PONumber,ReceiverNumber,Status,EmployeeNumber,Notes");
⋮----
csv.AppendLine($"{shipment.ShipmentNumber}," +
⋮----
return Model_Dao_Result_Factory.Success(csv.ToString());
⋮----
/// Escapes CSV values (wraps in quotes if contains comma, quote, or newline)
⋮----
/// <param name="value"></param>
private string EscapeCsv(string? value)
⋮----
if (string.IsNullOrEmpty(value))
⋮----
if (value.Contains(',') || value.Contains('"') || value.Contains('\n'))
⋮----
return $"\"{value.Replace("\"", "\"\"")}\"";
</file>

<file path="Module_Volvo/Views/View_Volvo_ShipmentEntry.xaml">
<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MTM_Receiving_Application.Module_Volvo.Views.View_Volvo_ShipmentEntry"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mi="using:Material.Icons.WinUI3"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:views="using:MTM_Receiving_Application.Module_Volvo.Views"
    xmlns:models="using:MTM_Receiving_Application.Module_Volvo.Models"
    xmlns:converters="using:MTM_Receiving_Application.Module_Core.Converters"
    mc:Ignorable="d"
    Loaded="OnLoaded">

    <Page.Resources>
        <converters:Converter_BooleanToVisibility x:Key="BooleanToVisibilityConverter"/>
        <converters:NullableDoubleToDoubleConverter x:Key="NullableDoubleToDoubleConverter"/>
    </Page.Resources>

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Success Message -->
        <InfoBar Grid.Row="0"
                 IsOpen="{x:Bind ViewModel.IsSuccessMessageVisible, Mode=OneWay}"
                 Severity="Success"
                 Message="{x:Bind ViewModel.SuccessMessage, Mode=OneWay}"
                 IsClosable="True"/>

        <!-- Header Section -->
        <StackPanel Grid.Row="1" Spacing="16">
            <!-- Shipment Info Row -->
            <Grid ColumnSpacing="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="2*"/>
                </Grid.ColumnDefinitions>

                <CalendarDatePicker Grid.Column="0"
                                    Header="Shipment Date"
                                    Date="{x:Bind ViewModel.ShipmentDate, Mode=TwoWay}"
                                    HorizontalAlignment="Stretch"/>

                <NumberBox Grid.Column="1"
                           Header="Shipment Number"
                           Value="{x:Bind ViewModel.ShipmentNumber, Mode=TwoWay}"
                           Minimum="1"
                           SpinButtonPlacementMode="Inline"
                           HorizontalAlignment="Stretch"/>

                <TextBox Grid.Column="2"
                         Header="Notes (optional)"
                         Text="{x:Bind ViewModel.Notes, Mode=TwoWay}"
                         PlaceholderText="Enter any additional notes"/>
            </Grid>

            <!-- Part Entry Row -->
            <Grid ColumnSpacing="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <AutoSuggestBox Grid.Column="0"
                                Header="Part Number"
                                ItemsSource="{x:Bind ViewModel.SuggestedParts, Mode=OneWay}"
                                Text="{x:Bind ViewModel.PartSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                DisplayMemberPath="PartNumber"
                                TextMemberPath="PartNumber"
                                PlaceholderText="Type to search for a part number"
                                TextChanged="OnPartSearchTextChanged"
                                SuggestionChosen="OnPartSuggestionChosen"
                                HorizontalAlignment="Stretch"/>

                <NumberBox Grid.Column="1"
                           Header="Received Skids"
                           Value="{x:Bind ViewModel.ReceivedSkidsToAdd, Mode=TwoWay}"
                           Minimum="1"
                           Maximum="99"
                           SpinButtonPlacementMode="Inline"
                           HorizontalAlignment="Stretch"/>

                <Button Grid.Column="2"
                        Content="Add Part"
                        Command="{x:Bind ViewModel.AddPartCommand}"
                        VerticalAlignment="Bottom"
                        Style="{StaticResource AccentButtonStyle}"
                        Margin="0,0,0,4"/>
            </Grid>
        </StackPanel>

        <!-- Parts Entry DataGrid -->
        <Grid Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0" 
                       Text="Parts Received" 
                       Style="{StaticResource SubtitleTextBlockStyle}"
                       Margin="0,0,0,8"/>

            <controls:DataGrid Grid.Row="1"
                               ItemsSource="{x:Bind ViewModel.Parts, Mode=OneWay}"
                               SelectedItem="{x:Bind ViewModel.SelectedPart, Mode=TwoWay}"
                               AutoGenerateColumns="False"
                               CanUserSortColumns="False"
                               CanUserReorderColumns="False"
                               GridLinesVisibility="All">
                <controls:DataGrid.Columns>
                    <controls:DataGridTextColumn Header="Part Number"
                                                  Width="200"
                                                  Binding="{Binding PartNumber, Mode=OneWay}"
                                                  IsReadOnly="True"/>

                    <controls:DataGridTemplateColumn Header="Received Skids"
                                                      Width="150">
                        <controls:DataGridTemplateColumn.CellTemplate>
                            <DataTemplate x:DataType="models:Model_VolvoShipmentLine">
                                <NumberBox Value="{x:Bind ReceivedSkidCount, Mode=TwoWay}"
                                           Minimum="1"
                                           Maximum="99"
                                           SpinButtonPlacementMode="Inline"
                                           HorizontalAlignment="Stretch"/>
                            </DataTemplate>
                        </controls:DataGridTemplateColumn.CellTemplate>
                    </controls:DataGridTemplateColumn>

                    <controls:DataGridTextColumn Header="Calculated Pieces"
                                                  Width="150"
                                                  Binding="{Binding CalculatedPieceCount, Mode=OneWay}"
                                                  IsReadOnly="True"/>

                    <controls:DataGridCheckBoxColumn Header="Discrepancy"
                                                      Width="120"
                                                      Binding="{Binding HasDiscrepancy, Mode=TwoWay}"/>

                    <controls:DataGridTemplateColumn Header="Expected Skids"
                                                      Width="150">
                        <controls:DataGridTemplateColumn.CellTemplate>
                            <DataTemplate x:DataType="models:Model_VolvoShipmentLine">
                                <NumberBox Value="{Binding ExpectedSkidCount, Mode=TwoWay, Converter={StaticResource NullableDoubleToDoubleConverter}}"
                                           Minimum="0"
                                           SpinButtonPlacementMode="Inline"
                                           HorizontalAlignment="Stretch"
                                           IsEnabled="{x:Bind HasDiscrepancy, Mode=OneWay}"/>
                            </DataTemplate>
                        </controls:DataGridTemplateColumn.CellTemplate>
                    </controls:DataGridTemplateColumn>

                    <controls:DataGridTextColumn Header="Expected Pieces"
                                                  Width="130"
                                                  Binding="{Binding ExpectedPieceCount, Mode=OneWay}"
                                                  IsReadOnly="True"/>

                    <controls:DataGridTextColumn Header="Difference"
                                                  Width="100"
                                                  Binding="{Binding PieceDifference, Mode=OneWay}"
                                                  IsReadOnly="True"/>

                    <controls:DataGridTemplateColumn Header="Discrepancy Note"
                                                      Width="*">
                        <controls:DataGridTemplateColumn.CellTemplate>
                            <DataTemplate x:DataType="models:Model_VolvoShipmentLine">
                                <TextBox Text="{x:Bind DiscrepancyNote, Mode=TwoWay}"
                                         IsEnabled="{x:Bind HasDiscrepancy, Mode=OneWay}"
                                         PlaceholderText="Explain discrepancy"/>
                            </DataTemplate>
                        </controls:DataGridTemplateColumn.CellTemplate>
                    </controls:DataGridTemplateColumn>
                </controls:DataGrid.Columns>
            </controls:DataGrid>
        </Grid>

        <!-- Action Buttons -->
        <CommandBar Grid.Row="3" DefaultLabelPosition="Right">
            <AppBarButton Icon="Delete" Label="Remove Part" Command="{x:Bind ViewModel.RemovePartCommand}"/>
            <AppBarSeparator/>
            <AppBarButton Label="Generate Labels" Command="{x:Bind ViewModel.GenerateLabelsCommand}">
                <AppBarButton.Icon>
                    <FontIcon Glyph="&#xE8B7;"/>
                </AppBarButton.Icon>
            </AppBarButton>
            <AppBarButton Icon="Mail" Label="Preview Email" Command="{x:Bind ViewModel.PreviewEmailCommand}"/>
            <AppBarSeparator/>
            <AppBarButton Icon="Save" Label="Save as Pending" Command="{x:Bind ViewModel.SaveAsPendingCommand}"/>
            <AppBarButton Icon="Accept" 
                          Label="Complete Shipment" 
                          Command="{x:Bind ViewModel.CompleteShipmentCommand}"
                          Visibility="{x:Bind ViewModel.HasPendingShipment, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            <AppBarSeparator/>
            <AppBarButton Icon="Calendar" Label="View History" Command="{x:Bind ViewModel.ViewHistoryCommand}"/>
        </CommandBar>

        <!-- Status Bar -->
        <Grid Grid.Row="3" Margin="0,8,0,0" Visibility="Collapsed">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <ProgressRing IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}" 
                              Width="20" 
                              Height="20"
                              Visibility="{x:Bind ViewModel.IsBusy, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}" 
                           VerticalAlignment="Center"/>
            </StackPanel>
        </Grid>
    </Grid>
</Page>
</file>

<file path="Module_Core/Data/Authentication/Dao_User.cs">
/// <summary>
/// Data Access Object for user authentication operations.
/// Handles all database interactions for the auth_users table.
/// </summary>
public class Dao_User
⋮----
/// Constructor with connection string injection
⋮----
/// <param name="connectionString">MySQL connection string</param>
⋮----
_connectionString = connectionString ?? throw new ArgumentNullException(nameof(connectionString));
⋮----
// ====================================================================
// Authentication Methods
⋮----
/// Retrieves user by Windows username for automatic authentication.
⋮----
/// <param name="windowsUsername">Windows username from Environment.UserName</param>
/// <returns>Result containing user data or error</returns>
public virtual async Task<Model_Dao_Result<Model_User>> GetUserByWindowsUsernameAsync(string windowsUsername)
⋮----
return await Helper_Database_StoredProcedure.ExecuteSingleAsync(
⋮----
/// Validates username and PIN combination for shared terminal login.
⋮----
/// <param name="username">Username (Windows username or full name)</param>
/// <param name="pin">4-digit numeric PIN</param>
⋮----
public virtual async Task<Model_Dao_Result<Model_User>> ValidateUserPinAsync(string username, string pin)
⋮----
// CRUD Operations
⋮----
/// Creates a new user account with validation.
⋮----
/// <param name="user">User model with account data</param>
/// <param name="createdBy">Windows username of account creator</param>
/// <returns>Result containing new employee number or error</returns>
public virtual async Task<Model_Dao_Result<int>> CreateNewUserAsync(Model_User user, string createdBy)
⋮----
await using var connection = new MySqlConnection(_connectionString);
await connection.OpenAsync();
⋮----
await using var command = new MySqlCommand("sp_Auth_User_Create", connection)
⋮----
// Input parameters
command.Parameters.AddWithValue("@p_employee_number", user.EmployeeNumber);
command.Parameters.AddWithValue("@p_windows_username", user.WindowsUsername);
command.Parameters.AddWithValue("@p_full_name", user.FullName);
command.Parameters.AddWithValue("@p_pin", user.Pin);
command.Parameters.AddWithValue("@p_department", user.Department);
command.Parameters.AddWithValue("@p_shift", user.Shift);
command.Parameters.AddWithValue("@p_created_by", createdBy);
command.Parameters.AddWithValue("@p_visual_username", user.VisualUsername ?? (object)DBNull.Value);
command.Parameters.AddWithValue("@p_visual_password", user.VisualPassword ?? (object)DBNull.Value);
⋮----
// Output parameters
var errorMessageParam = new MySqlParameter("@p_error_message", MySqlDbType.VarChar, 500)
⋮----
command.Parameters.Add(errorMessageParam);
⋮----
await command.ExecuteNonQueryAsync();
⋮----
// Check for errors
⋮----
if (!string.IsNullOrEmpty(errorMessage))
⋮----
// Return the employee number that was provided
// Defaults are seeded server-side by sp_Auth_User_Create -> sp_Auth_User_SeedDefaultModes.
// Extra safety: best-effort call in case the DB procedure set isn't deployed yet.
⋮----
await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
// Swallow: defaults are non-critical and must not block first run.
⋮----
// Validation Methods
⋮----
/// Checks if a Windows username is unique across all users.
⋮----
/// <param name="username">Windows username to check</param>
/// <param name="excludeEmployeeNumber">Optional employee number to exclude from check</param>
/// <returns>Result indicating if username is unique</returns>
public virtual async Task<Model_Dao_Result<bool>> IsWindowsUsernameUniqueAsync(string username, int? excludeEmployeeNumber = null)
⋮----
await using var command = new MySqlCommand(query, connection);
command.Parameters.AddWithValue("@username", username);
⋮----
command.Parameters.AddWithValue("@excludeId", excludeEmployeeNumber.Value);
⋮----
var count = Convert.ToInt32(await command.ExecuteScalarAsync());
⋮----
// Activity Logging
⋮----
/// Logs a user activity event for audit trail.
⋮----
/// <param name="eventType">Event type (login_success, login_failed, session_timeout, user_created)</param>
/// <param name="username">Username involved in event</param>
/// <param name="workstationName">Computer name where event occurred</param>
/// <param name="details">Additional event details</param>
/// <returns>Result indicating success or failure</returns>
public virtual async Task<Model_Dao_Result<bool>> LogUserActivityAsync(
⋮----
var result = await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
// Configuration Methods
⋮----
/// Retrieves list of shared terminal workstation names.
⋮----
/// <returns>Result containing list of workstation names</returns>
public virtual async Task<Model_Dao_Result<List<string>>> GetSharedTerminalNamesAsync()
⋮----
return await Helper_Database_StoredProcedure.ExecuteListAsync(
⋮----
reader => reader.GetString(reader.GetOrdinal("workstation_name"))
⋮----
/// Inserts or updates the current workstation configuration record.
/// Best-effort: caller may ignore failures if the SP is not deployed yet.
⋮----
/// <param name="workstationName"></param>
/// <param name="workstationType"></param>
/// <param name="isActive"></param>
/// <param name="description"></param>
public virtual async Task<Model_Dao_Result> UpsertWorkstationConfigAsync(
⋮----
return await Helper_Database_StoredProcedure.ExecuteNonQueryAsync(
⋮----
/// Retrieves list of active departments for dropdown population.
⋮----
/// <returns>Result containing list of department names</returns>
public virtual async Task<Model_Dao_Result<List<string>>> GetActiveDepartmentsAsync()
⋮----
reader => reader.GetString(reader.GetOrdinal("department_name"))
⋮----
// Helper Methods
⋮----
/// Maps a IDataReader row to a Model_User object.
⋮----
/// <param name="reader"></param>
private Model_User MapReaderToUser(IDataReader reader)
⋮----
return new Model_User
⋮----
EmployeeNumber = reader.GetInt32(reader.GetOrdinal("employee_number")),
WindowsUsername = reader.GetString(reader.GetOrdinal("windows_username")),
FullName = reader.GetString(reader.GetOrdinal("full_name")),
Pin = reader.GetString(reader.GetOrdinal("pin")),
Department = reader.GetString(reader.GetOrdinal("department")),
Shift = reader.GetString(reader.GetOrdinal("shift")),
IsActive = reader.GetBoolean(reader.GetOrdinal("is_active")),
VisualUsername = reader.IsDBNull(reader.GetOrdinal("visual_username"))
⋮----
: reader.GetString(reader.GetOrdinal("visual_username")),
VisualPassword = reader.IsDBNull(reader.GetOrdinal("visual_password"))
⋮----
: reader.GetString(reader.GetOrdinal("visual_password")),
⋮----
CreatedDate = reader.GetDateTime(reader.GetOrdinal("created_date")),
CreatedBy = reader.IsDBNull(reader.GetOrdinal("created_by"))
⋮----
: reader.GetString(reader.GetOrdinal("created_by")),
ModifiedDate = reader.GetDateTime(reader.GetOrdinal("modified_date"))
⋮----
/// Updates user's default receiving mode preference
⋮----
/// <param name="userId"></param>
/// <param name="defaultMode"></param>
public virtual async Task<Model_Dao_Result> UpdateDefaultModeAsync(int userId, string? defaultMode)
⋮----
/// Updates the user's default receiving workflow mode preference (guided, manual, edit)
⋮----
public virtual async Task<Model_Dao_Result> UpdateDefaultReceivingModeAsync(int userId, string? defaultMode)
⋮----
/// Updates the user's default dunnage workflow mode preference
⋮----
public virtual async Task<Model_Dao_Result> UpdateDefaultDunnageModeAsync(int userId, string? defaultMode)
⋮----
/// Safely attempts to read default_receiving_mode column, returns null if column doesn't exist
⋮----
private static string? TryGetDefaultReceivingMode(IDataReader reader)
⋮----
var ordinal = reader.GetOrdinal("default_receiving_mode");
return reader.IsDBNull(ordinal) ? null : reader.GetString(ordinal);
⋮----
// Column doesn't exist yet (migration not run) - return null
⋮----
/// Safely attempts to read default_dunnage_mode column, returns null if column doesn't exist
⋮----
private static string? TryGetDefaultDunnageMode(IDataReader reader)
⋮----
var ordinal = reader.GetOrdinal("default_dunnage_mode");
</file>

<file path="Module_Volvo/ViewModels/ViewModel_Volvo_ShipmentEntry.cs">
/// <summary>
/// ViewModel for Volvo shipment entry
/// </summary>
public partial class ViewModel_Volvo_ShipmentEntry : ViewModel_Shared_Base
⋮----
private readonly IService_Volvo _volvoService;
private readonly IService_Window _windowService;
private readonly IService_UserSessionManager _sessionManager;
⋮----
public async Task InitializeAsync()
⋮----
// Load available parts
var partsResult = await _volvoService.GetActivePartsAsync();
⋮----
AvailableParts.Clear();
⋮----
AvailableParts.Add(part);
⋮----
await _errorHandler.HandleErrorAsync(
⋮----
// Check for pending shipment
var pendingResult = await _volvoService.GetPendingShipmentAsync();
⋮----
// Load pending shipment details if exists
⋮----
await _logger.LogErrorAsync($"Error initializing Volvo shipment entry: {ex.Message}", ex);
⋮----
private async Task LoadPendingShipmentAsync()
⋮----
ShipmentDate = new DateTimeOffset(shipment.ShipmentDate);
⋮----
// Load lines
var linesResult = await _volvoService.GetShipmentLinesAsync(shipment.Id);
⋮----
Parts.Clear();
⋮----
Parts.Add(line);
⋮----
/// Updates the part suggestions list based on user's search text
/// Filters parts by case-insensitive substring match on part number
/// Optimized to reduce collection change notifications
⋮----
/// <param name="queryText">Search text from AutoSuggestBox</param>
public void UpdatePartSuggestions(string queryText)
⋮----
if (string.IsNullOrWhiteSpace(queryText))
⋮----
SuggestedParts.Clear();
⋮----
.Where(p => p.PartNumber.Contains(queryText, StringComparison.OrdinalIgnoreCase))
.Take(20)
.ToList();
⋮----
// Optimize: Use bulk replace to reduce collection change events
// Clear and add all at once instead of individual adds
⋮----
SuggestedParts.Add(part);
⋮----
// Check if text matches a part exactly
var exactMatch = _allParts.FirstOrDefault(p =>
p.PartNumber.Equals(queryText, StringComparison.OrdinalIgnoreCase));
⋮----
/// Handles when user selects a part from the AutoSuggestBox dropdown
/// Sets the search text and selected part for adding to shipment
⋮----
/// <param name="chosenPart">The part selected from suggestions</param>
public void OnPartSuggestionChosen(Model_VolvoPart? chosenPart)
⋮----
partial void OnPartSearchTextChanged(string value)
⋮----
private async void AddPart()
⋮----
// Input validation (1-99 range)
⋮----
// Check for duplicate part number
if (Parts.Any(p => p.PartNumber.Equals(SelectedPartToAdd.PartNumber, StringComparison.OrdinalIgnoreCase)))
⋮----
// Calculate pieces based on quantity per skid
⋮----
var newLine = new Model_VolvoShipmentLine
⋮----
Parts.Add(newLine);
⋮----
// Log user action
await _logger.LogInfoAsync($"User added part {SelectedPartToAdd.PartNumber}, {ReceivedSkidsToAdd} skids ({calculatedPieces} pcs)");
⋮----
// Reset input fields
⋮----
private bool CanAddPart()
⋮----
private async void RemovePart()
⋮----
await _logger.LogInfoAsync($"User removed part {SelectedPart.PartNumber} from shipment");
Parts.Remove(SelectedPart);
⋮----
private async Task GenerateLabelsAsync()
⋮----
// First, save the shipment if not already saved
⋮----
// Get the pending shipment ID
⋮----
// Generate CSV
var csvResult = await _volvoService.GenerateLabelCsvAsync(pendingResult.Data.Id);
⋮----
await _logger.LogErrorAsync($"Error generating labels: {ex.Message}", ex);
⋮----
private async Task PreviewEmailAsync()
⋮----
// First, ensure the shipment is saved
⋮----
// Get the saved pending shipment
var pendingResult = await _volvoService.GetPendingShipmentWithLinesAsync();
⋮----
// Calculate component explosion to get actual part quantities
var explosionResult = await _volvoService.CalculateComponentExplosionAsync(lines);
⋮----
await _logger.LogInfoAsync($"Component explosion successful: {requestedLines.Count} parts");
⋮----
// Fallback to empty if explosion fails
⋮----
await _logger.LogWarningAsync($"Component explosion failed for email preview: {explosionResult.ErrorMessage}");
⋮----
await _logger.LogInfoAsync($"Email preview - RequestedLines count: {requestedLines.Count}");
⋮----
// Format email data with actual part quantities
var emailData = await _volvoService.FormatEmailDataAsync(shipment, lines, requestedLines);
⋮----
await _logger.LogInfoAsync($"Email data formatted - RequestedLines count: {emailData.RequestedLines.Count}");
⋮----
// Show email preview dialog
⋮----
await _logger.LogErrorAsync($"Error previewing email: {ex.Message}", ex);
⋮----
private async Task ShowEmailPreviewDialogAsync(Model_VolvoEmailData emailData)
⋮----
var xamlRoot = _windowService.GetXamlRoot();
⋮----
// Load email recipients from settings
var settingsDao = new Data.Dao_VolvoSettings(Module_Core.Helpers.Database.Helper_Database_Variables.GetConnectionString());
var toResult = await settingsDao.GetSettingAsync("email_to_recipients");
var ccResult = await settingsDao.GetSettingAsync("email_cc_recipients");
⋮----
var dialog = new ContentDialog
⋮----
// Build structured preview UI
var mainStack = new StackPanel { Spacing = 12, Margin = new Microsoft.UI.Xaml.Thickness(0) };
⋮----
// TO Recipients
var toPanel = new Grid { ColumnSpacing = 8 };
toPanel.ColumnDefinitions.Add(new Microsoft.UI.Xaml.Controls.ColumnDefinition { Width = new Microsoft.UI.Xaml.GridLength(1, Microsoft.UI.Xaml.GridUnitType.Star) });
toPanel.ColumnDefinitions.Add(new Microsoft.UI.Xaml.Controls.ColumnDefinition { Width = Microsoft.UI.Xaml.GridLength.Auto });
var toBox = new TextBox
⋮----
toBox.SetValue(Grid.ColumnProperty, 0);
var toCopyButton = new Button
⋮----
toCopyButton.SetValue(Grid.ColumnProperty, 1);
Microsoft.UI.Xaml.Controls.ToolTipService.SetToolTip(toCopyButton, "Copy To Recipients");
⋮----
var dataPackage = new DataPackage();
dataPackage.SetText(toBox.Text);
Clipboard.SetContent(dataPackage);
⋮----
toPanel.Children.Add(toBox);
toPanel.Children.Add(toCopyButton);
mainStack.Children.Add(toPanel);
⋮----
// CC Recipients
var ccPanel = new Grid { ColumnSpacing = 8 };
ccPanel.ColumnDefinitions.Add(new Microsoft.UI.Xaml.Controls.ColumnDefinition { Width = new Microsoft.UI.Xaml.GridLength(1, Microsoft.UI.Xaml.GridUnitType.Star) });
ccPanel.ColumnDefinitions.Add(new Microsoft.UI.Xaml.Controls.ColumnDefinition { Width = Microsoft.UI.Xaml.GridLength.Auto });
var ccBox = new TextBox
⋮----
ccBox.SetValue(Grid.ColumnProperty, 0);
var ccCopyButton = new Button
⋮----
ccCopyButton.SetValue(Grid.ColumnProperty, 1);
Microsoft.UI.Xaml.Controls.ToolTipService.SetToolTip(ccCopyButton, "Copy CC Recipients");
⋮----
dataPackage.SetText(ccBox.Text);
⋮----
ccPanel.Children.Add(ccBox);
ccPanel.Children.Add(ccCopyButton);
mainStack.Children.Add(ccPanel);
⋮----
// Subject
var subjectPanel = new Grid { ColumnSpacing = 8 };
subjectPanel.ColumnDefinitions.Add(new Microsoft.UI.Xaml.Controls.ColumnDefinition { Width = new Microsoft.UI.Xaml.GridLength(1, Microsoft.UI.Xaml.GridUnitType.Star) });
subjectPanel.ColumnDefinitions.Add(new Microsoft.UI.Xaml.Controls.ColumnDefinition { Width = Microsoft.UI.Xaml.GridLength.Auto });
var subjectBox = new TextBox
⋮----
subjectBox.SetValue(Grid.ColumnProperty, 0);
var subjectCopyButton = new Button
⋮----
subjectCopyButton.SetValue(Grid.ColumnProperty, 1);
Microsoft.UI.Xaml.Controls.ToolTipService.SetToolTip(subjectCopyButton, "Copy Subject");
⋮----
dataPackage.SetText(subjectBox.Text);
⋮----
subjectPanel.Children.Add(subjectBox);
subjectPanel.Children.Add(subjectCopyButton);
mainStack.Children.Add(subjectPanel);
⋮----
// Discrepancies (if any)
⋮----
var discHeader = new TextBlock
⋮----
mainStack.Children.Add(discHeader);
⋮----
var discBox = new TextBox
⋮----
var discText = new StringBuilder();
discText.AppendLine("Part Number\tPacklist Qty (pcs)\tReceived Qty (pcs)\tDifference (pcs)\tNote");
discText.AppendLine(new string('-', 80));
⋮----
string diffStr = disc.Difference > 0 ? $"+{disc.Difference}" : disc.Difference.ToString();
discText.AppendLine($"{disc.PartNumber}\t{disc.PacklistQty}\t{disc.ReceivedQty}\t{diffStr}\t{disc.Note}");
⋮----
discBox.Text = discText.ToString();
mainStack.Children.Add(discBox);
⋮----
// Requested Lines
var reqHeader = new TextBlock
⋮----
mainStack.Children.Add(reqHeader);
⋮----
var reqBox = new TextBox
⋮----
var reqText = new StringBuilder();
reqText.AppendLine("Part Number\tQuantity (pcs)");
reqText.AppendLine(new string('-', 40));
foreach (var kvp in emailData.RequestedLines.OrderBy(x => x.Key))
⋮----
reqText.AppendLine($"{kvp.Key}\t{kvp.Value}");
⋮----
reqBox.Text = reqText.ToString();
mainStack.Children.Add(reqBox);
⋮----
// Additional Notes
if (!string.IsNullOrWhiteSpace(emailData.AdditionalNotes))
⋮----
var notesBox = new TextBox
⋮----
mainStack.Children.Add(notesBox);
⋮----
var scrollViewer = new ScrollViewer
⋮----
var result = await dialog.ShowAsync();
⋮----
// Copy HTML to clipboard for Outlook paste as table
var htmlContent = _volvoService.FormatEmailAsHtml(emailData);
⋮----
dataPackage.SetHtmlFormat(htmlContent);
// Also include plain text fallback
⋮----
dataPackage.SetText(plainText);
⋮----
private string BuildPlainTextEmail(Model_VolvoEmailData emailData)
⋮----
var text = new StringBuilder();
text.AppendLine($"Subject: {emailData.Subject}");
text.AppendLine();
text.AppendLine(emailData.Greeting);
⋮----
text.AppendLine(emailData.Message);
⋮----
text.AppendLine("**DISCREPANCIES NOTED**");
⋮----
text.AppendLine("Part Number\tPacklist Qty\tReceived Qty\tDifference\tNote");
text.AppendLine(new string('-', 80));
⋮----
text.AppendLine($"{disc.PartNumber}\t{disc.PacklistQty}\t{disc.ReceivedQty}\t{diffStr}\t{disc.Note}");
⋮----
text.AppendLine("Requested Lines:");
⋮----
text.AppendLine("Part Number\tQuantity (pcs)");
text.AppendLine(new string('-', 40));
⋮----
text.AppendLine($"{kvp.Key}\t{kvp.Value}");
⋮----
text.AppendLine("Additional Notes:");
text.AppendLine(emailData.AdditionalNotes);
⋮----
text.AppendLine(emailData.Signature);
return text.ToString();
⋮----
private void ViewHistory()
⋮----
_logger.LogInfo("Navigating to Volvo Shipment History");
⋮----
var contentFrame = mainWindow.GetContentFrame();
⋮----
private async Task SaveAsPendingAsync()
⋮----
await _logger.LogErrorAsync($"Error saving shipment: {ex.Message}", ex);
⋮----
private async Task<Model_Dao_Result<(int ShipmentId, int ShipmentNumber)>> SaveShipmentInternalAsync()
⋮----
// Validate
⋮----
// Build shipment object
var shipment = new Model_VolvoShipment
⋮----
EmployeeNumber = _sessionManager.CurrentSession?.User?.EmployeeNumber.ToString() ?? "0"
⋮----
// Save
var saveResult = await _volvoService.SaveShipmentAsync(shipment, Parts.ToList());
⋮----
// Check if there's an existing pending shipment
if (!saveResult.IsSuccess && saveResult.ErrorMessage.StartsWith("PENDING_EXISTS"))
⋮----
var parts = saveResult.ErrorMessage.Split('|');
⋮----
// Show confirmation dialog
⋮----
// User confirmed - delete existing and save new
await _logger.LogInfoAsync($"User confirmed overwrite of pending shipment #{existingShipmentNumber}");
return await _volvoService.SaveShipmentAsync(shipment, Parts.ToList(), overwriteExisting: true);
⋮----
// User canceled
await _logger.LogInfoAsync("User canceled shipment overwrite");
⋮----
private async Task CompleteShipmentAsync()
⋮----
// This will be used when completing a pending shipment with PO/Receiver numbers
⋮----
// Show completion dialog
⋮----
await _logger.LogErrorAsync($"Error completing shipment: {ex.Message}", ex);
⋮----
private async Task ShowCompletionDialogAsync(Model_VolvoShipment shipment)
⋮----
var stackPanel = new StackPanel { Spacing = 12 };
⋮----
var poTextBox = new TextBox
⋮----
var receiverTextBox = new TextBox
⋮----
stackPanel.Children.Add(poTextBox);
stackPanel.Children.Add(receiverTextBox);
⋮----
if (string.IsNullOrWhiteSpace(poTextBox.Text) || string.IsNullOrWhiteSpace(receiverTextBox.Text))
⋮----
var completeResult = await _volvoService.CompleteShipmentAsync(
⋮----
poTextBox.Text.Trim(),
receiverTextBox.Text.Trim());
⋮----
// Clear the form
⋮----
private void StartNewEntry()
⋮----
private bool ValidateShipment()
⋮----
_errorHandler.HandleErrorAsync(
⋮----
true).ConfigureAwait(false);
⋮----
if (string.IsNullOrWhiteSpace(part.PartNumber))
⋮----
/// Formats JSON array of recipients into Outlook format
⋮----
/// <param name="jsonValue"></param>
/// <param name="fallbackValue"></param>
private string FormatRecipientsFromJson(string? jsonValue, string fallbackValue)
⋮----
if (string.IsNullOrWhiteSpace(jsonValue))
⋮----
return string.Join("; ", recipients.Select(r => r.ToOutlookFormat()));
⋮----
_logger.LogErrorAsync($"Error parsing email recipients JSON: {ex.Message}", ex).ConfigureAwait(false);
⋮----
private void ValidateSaveEligibility()
⋮----
CanSave = Parts.Count > 0 && Parts.All(p => !string.IsNullOrWhiteSpace(p.PartNumber) && p.ReceivedSkidCount > 0);
⋮----
partial void OnPartsChanged(ObservableCollection<Model_VolvoShipmentLine> value)
⋮----
partial void OnSelectedPartToAddChanged(Model_VolvoPart? value)
⋮----
AddPartCommand.NotifyCanExecuteChanged();
⋮----
partial void OnReceivedSkidsToAddChanged(int value)
⋮----
/// Clears all shipment form fields and resets to default state
/// Extracted to avoid code duplication
⋮----
private void ClearShipmentForm()
</file>

<file path="MainWindow.xaml.cs">
namespace MTM_Receiving_Application
⋮----
/// <summary>
/// An empty window that can be used on its own or navigated to within a Frame.
/// </summary>
public sealed partial class MainWindow : Window
⋮----
private readonly IService_UserSessionManager _sessionManager;
private readonly IService_LoggingUtility _logger;
⋮----
/// Gets the main content frame for navigation
⋮----
public Frame GetContentFrame() => ContentFrame;
⋮----
// Set initial window size (1450x900 to accommodate wide data grids and toolbars)
AppWindow.Resize(new Windows.Graphics.SizeInt32(1450, 900));
⋮----
// Center window on screen
⋮----
// Configure title bar to blend with UI (drag region will be set on first activation)
⋮----
// Set user display from current session
⋮----
// Wire up activity tracking
⋮----
rootElement.PointerMoved += (s, e) => _sessionManager.UpdateLastActivity();
rootElement.KeyDown += (s, e) => _sessionManager.UpdateLastActivity();
⋮----
// Subscribe to navigation events once
⋮----
// Show development tools in debug builds
⋮----
private void MainWindow_Closed(object sender, WindowEventArgs args)
⋮----
// Ensure the application process terminates when the main window is closed
Application.Current.Exit();
⋮----
private void MainWindow_Activated(object sender, WindowActivatedEventArgs args)
⋮----
_sessionManager.UpdateLastActivity();
⋮----
// Set title bar drag region on first activation (XamlRoot will be available)
⋮----
// Navigate to Receiving workflow on first activation
⋮----
// Title will be set by ContentFrame_Navigated
ContentFrame.Navigate(typeof(Module_Receiving.Views.View_Receiving_Workflow));
⋮----
private void NavView_SelectionChanged(NavigationView sender, NavigationViewSelectionChangedEventArgs args)
⋮----
// TODO: Restore when Settings Views are implemented
// ContentFrame.Navigate(typeof(Module_Settings.Views.View_Settings_Workflow));
⋮----
ContentFrame.Navigate(typeof(Module_Dunnage.Views.View_Dunnage_WorkflowView));
⋮----
ContentFrame.Navigate(typeof(Module_Routing.Views.RoutingModeSelectionView));
⋮----
ContentFrame.Navigate(typeof(Module_Volvo.Views.View_Volvo_ShipmentEntry));
⋮----
ContentFrame.Navigate(typeof(Module_Volvo.Views.View_Volvo_History));
⋮----
ContentFrame.Navigate(typeof(Module_Reporting.Views.View_Reporting_Main));
⋮----
_logger.LogInfo("Navigating to Settings Database Test view", "MainWindow");
⋮----
// Defensive checks
⋮----
_logger.LogError("ContentFrame is null - cannot navigate", null, "MainWindow");
throw new InvalidOperationException("ContentFrame is null");
⋮----
_logger.LogInfo($"ContentFrame state: IsLoaded={ContentFrame.IsLoaded}, BackStackDepth={ContentFrame.BackStackDepth}", "MainWindow");
⋮----
_logger.LogInfo($"View type: {viewType.FullName}", "MainWindow");
⋮----
// Try navigation with detailed logging
_logger.LogInfo("Calling ContentFrame.Navigate()", "MainWindow");
var navigated = ContentFrame.Navigate(viewType);
_logger.LogInfo($"Navigation result: {navigated}", "MainWindow");
⋮----
_logger.LogError("Navigation returned false", null, "MainWindow");
⋮----
_logger.LogInfo("Successfully navigated to Settings Database Test view", "MainWindow");
⋮----
_logger.LogError($"Failed to navigate to Settings Database Test view: {ex.Message}", ex, "MainWindow");
⋮----
// Build detailed error message
⋮----
errorDetails.AppendLine("Failed to load Settings Database Test view:");
errorDetails.AppendLine();
errorDetails.AppendLine($"Error Type: {ex.GetType().FullName}");
errorDetails.AppendLine($"Message: {ex.Message}");
⋮----
errorDetails.AppendLine("Stack Trace:");
errorDetails.AppendLine(ex.StackTrace ?? "No stack trace available");
⋮----
// Add inner exception details if present
⋮----
errorDetails.AppendLine("Inner Exception:");
errorDetails.AppendLine($"Type: {ex.InnerException.GetType().FullName}");
errorDetails.AppendLine($"Message: {ex.InnerException.Message}");
errorDetails.AppendLine($"Stack: {ex.InnerException.StackTrace ?? "No stack trace"}");
⋮----
// Show detailed error to user in scrollable view
var scrollViewer = new ScrollViewer
⋮----
Content = new TextBlock
⋮----
Text = errorDetails.ToString(),
⋮----
var errorDialog = new ContentDialog
⋮----
_ = errorDialog.ShowAsync();
⋮----
private void ContentFrame_Navigated(object sender, Microsoft.UI.Xaml.Navigation.NavigationEventArgs e)
⋮----
// If navigated to ReceivingWorkflowView, subscribe to ViewModel changes to update header
⋮----
// Update header with current step title (ensure UI thread)
DispatcherQueue.TryEnqueue(() =>
⋮----
// Subscribe to property changes to keep header updated
⋮----
// Ensure UI update happens on UI thread
⋮----
// If navigated to DunnageWorkflowView, subscribe to ViewModel changes to update header
⋮----
// If navigated to RoutingModeSelectionView, set simple title
⋮----
/*
            // If navigated to SettingsWorkflowView, subscribe to ViewModel changes to update header
            else if (ContentFrame.Content is Module_Settings.Views.View_Settings_Workflow settingsView)
            {
                var viewModel = settingsView.ViewModel;
                if (viewModel != null)
                {
                    // Update header with current step title (ensure UI thread)
                    DispatcherQueue.TryEnqueue(() =>
                    {
                        PageTitleTextBlock.Text = viewModel.CurrentStepTitle;
                    });

                    // Subscribe to property changes to keep header updated
                    viewModel.PropertyChanged += (s, args) =>
                    {
                        if (args.PropertyName == nameof(viewModel.CurrentStepTitle))
                        {
                            // Ensure UI update happens on UI thread
                            DispatcherQueue.TryEnqueue(() =>
                            {
                                PageTitleTextBlock.Text = viewModel.CurrentStepTitle;
                            });
                        }
                    };
                }
            }
            */
⋮----
/// Update user display from current session
/// Call this after session is created during startup
⋮----
public void UpdateUserDisplay()
⋮----
/// Center the window on the primary display
⋮----
private void CenterWindow()
⋮----
AppWindow.Move(new Windows.Graphics.PointInt32(centerX, centerY));
⋮----
/// Configure title bar to blend with the application UI
⋮----
private void ConfigureTitleBar()
⋮----
// Make title bar transparent to blend with Mica backdrop
⋮----
// Set the title bar drag region to the AppTitleBar element
⋮----
// Set button colors to match theme
var transparentColor = Windows.UI.Color.FromArgb(0, 0, 0, 0);
⋮----
// Button colors (will use theme colors)
⋮----
// Foreground colors for buttons
var foregroundColor = Windows.UI.Color.FromArgb(255, 255, 255, 255);
⋮----
// Drag region will be set after window loads (in MainWindow_Loaded)
⋮----
// Ignore title bar customization errors
⋮----
/// Set the drag region for the custom title bar
/// MUST be called after window is fully loaded (XamlRoot will be available)
⋮----
private void SetTitleBarDragRegion()
⋮----
// Get the title bar height
⋮----
// The entire AppTitleBar is draggable
⋮----
AppWindow.TitleBar.SetDragRectangles(new[] { dragRect });
⋮----
// Ignore drag region setup errors
</file>

<file path="App.xaml.cs">
/// <summary>
/// Provides application-specific behavior with dependency injection support
/// </summary>
public partial class App : Application
⋮----
private readonly IHost _host;
⋮----
/// Gets the main window for the application
⋮----
/// Initializes the singleton application object and sets up dependency injection
⋮----
// Configure Serilog for structured logging
Log.Logger = new LoggerConfiguration()
.MinimumLevel.Information()
.Enrich.WithMachineName()
.Enrich.WithThreadId()
.Enrich.WithProperty("Application", "MTM_Receiving_Application")
.Enrich.WithProperty("Environment", "Production")
.WriteTo.File(
⋮----
.CreateLogger();
⋮----
_host = Host.CreateDefaultBuilder()
.ConfigureServices((context, services) =>
⋮----
// ===== CQRS INFRASTRUCTURE (MediatR + Global Pipeline Behaviors) =====
services.AddMediatR(cfg =>
⋮----
// Register all handlers from this assembly
cfg.RegisterServicesFromAssembly(Assembly.GetExecutingAssembly());
⋮----
// Register GLOBAL pipeline behaviors (applied to ALL handlers in ALL modules)
cfg.AddBehavior(typeof(IPipelineBehavior<,>), typeof(LoggingBehavior<,>));
cfg.AddBehavior(typeof(IPipelineBehavior<,>), typeof(ValidationBehavior<,>));
cfg.AddBehavior(typeof(IPipelineBehavior<,>), typeof(AuditBehavior<,>));
⋮----
// ===== FLUENTVALIDATION CONFIGURATION (Auto-discovery) =====
services.AddValidatorsFromAssembly(Assembly.GetExecutingAssembly());
⋮----
// ===== CORE SERVICES (Generic Infrastructure) =====
⋮----
// Authentication Services
var mySqlConnectionString = Helper_Database_Variables.GetConnectionString();
var inforVisualConnectionString = Helper_Database_Variables.GetInforVisualConnectionString();
⋮----
services.AddSingleton(sp => new Dao_User(mySqlConnectionString));
⋮----
// Register NEW MySQL DAOs (Singleton - stateless data access)
services.AddSingleton(sp => new Dao_ReceivingLoad(mySqlConnectionString));
services.AddSingleton(sp => new Dao_ReceivingLine(mySqlConnectionString));
services.AddSingleton(sp => new Dao_PackageTypePreference(mySqlConnectionString));
⋮----
// Register Dunnage DAOs (Singleton)
services.AddSingleton(sp => new Dao_DunnageLoad(mySqlConnectionString));
services.AddSingleton(sp => new Dao_DunnageType(mySqlConnectionString));
services.AddSingleton(sp => new Dao_DunnagePart(mySqlConnectionString));
services.AddSingleton(sp => new Dao_DunnageSpec(mySqlConnectionString));
services.AddSingleton(sp => new Dao_InventoriedDunnage(mySqlConnectionString));
services.AddSingleton(sp => new Dao_DunnageCustomField(mySqlConnectionString));
services.AddSingleton(sp => new Dao_DunnageUserPreference(mySqlConnectionString));
⋮----
// Register NEW Routing Module DAOs (Phase 2 implementation)
services.AddSingleton(sp => new Dao_RoutingLabel(mySqlConnectionString));
services.AddSingleton(sp => new Dao_RoutingRecipient(mySqlConnectionString));
services.AddSingleton(sp => new Dao_RoutingOtherReason(mySqlConnectionString));
services.AddSingleton(sp => new Dao_RoutingUsageTracking(mySqlConnectionString));
services.AddSingleton(sp => new Dao_RoutingUserPreference(mySqlConnectionString));
services.AddSingleton(sp => new Dao_RoutingLabelHistory(mySqlConnectionString));
services.AddSingleton(sp => new MTM_Receiving_Application.Module_Routing.Data.Dao_InforVisualPO(inforVisualConnectionString));
⋮----
// Register Volvo DAOs (Singleton)
services.AddSingleton(sp => new Dao_VolvoShipment(mySqlConnectionString));
services.AddSingleton(sp => new Dao_VolvoShipmentLine(mySqlConnectionString));
services.AddSingleton(sp => new Dao_VolvoPart(mySqlConnectionString));
services.AddSingleton(sp => new Dao_VolvoPartComponent(mySqlConnectionString));
⋮----
// Register Settings DAOs (Singleton)
services.AddSingleton(sp => new Module_Settings.Data.Dao_SystemSettings(mySqlConnectionString));
services.AddSingleton(sp => new Module_Settings.Data.Dao_UserSettings(mySqlConnectionString));
services.AddSingleton(sp => new Module_Settings.Data.Dao_PackageType(mySqlConnectionString));
services.AddSingleton(sp => new Module_Settings.Data.Dao_PackageTypeMappings(mySqlConnectionString));
services.AddSingleton(sp => new Module_Settings.Data.Dao_RoutingRule(mySqlConnectionString));
services.AddSingleton(sp => new Module_Settings.Data.Dao_ScheduledReport(mySqlConnectionString));
services.AddSingleton(sp => new Module_Settings.Data.Dao_SettingsAuditLog(mySqlConnectionString));
⋮----
// Register NEW Routing Module Services (Phase 2 implementation)
⋮----
return new RoutingService(daoLabel, daoHistory, inforVisualService, usageTrackingService, recipientService, logger, configuration);
⋮----
return new RoutingInforVisualService(daoInforVisual, logger, useMockData);
⋮----
return new RoutingRecipientService(daoRecipient, logger);
⋮----
return new RoutingUsageTrackingService(daoUsageTracking, logger);
⋮----
return new RoutingUserPreferenceService(daoUserPreference, logger);
⋮----
// Register NEW Infor Visual DAOs (READ-ONLY)
services.AddSingleton(sp =>
⋮----
return new Dao_InforVisualPart(inforVisualConnectionString, logger);
⋮----
var dispatcherQueue = Microsoft.UI.Dispatching.DispatcherQueue.GetForCurrentThread();
return new Service_Dispatcher(dispatcherQueue);
⋮----
return new Service_Authentication(daoUser, errorHandler);
⋮----
return new Service_UserSessionManager(daoUser, dispatcherService);
⋮----
// Startup Service
⋮----
// NEW: Infor Visual Connection Service with mock data support
⋮----
return new Dao_InforVisualConnection(
Helper_Database_Variables.GetInforVisualConnectionString(), logger);
⋮----
return new Service_InforVisualConnect(dao, useMockData, logger);
⋮----
// Receiving Workflow Services (003-database-foundation)
services.AddSingleton<IService_MySQL_Receiving>(sp => { var logger = sp.GetRequiredService<IService_LoggingUtility>(); return new Service_MySQL_Receiving(Helper_Database_Variables.GetConnectionString(), logger); });
⋮----
services.AddSingleton<IService_MySQL_PackagePreferences>(sp => new Service_MySQL_PackagePreferences(Helper_Database_Variables.GetConnectionString()));
services.AddSingleton<IService_SessionManager>(sp => { var logger = sp.GetRequiredService<IService_LoggingUtility>(); return new Service_SessionManager(logger); });
services.AddSingleton<IService_CSVWriter>(sp => { var sessionManager = sp.GetRequiredService<IService_UserSessionManager>(); var logger = sp.GetRequiredService<IService_LoggingUtility>(); return new Service_CSVWriter(sessionManager, logger); });
⋮----
// Dunnage Services (006-dunnage-services)
⋮----
// Volvo Services (002-volvo-module)
⋮----
return new Service_VolvoAuthorization(logger);
⋮----
return new Service_Volvo(shipmentDao, lineDao, partDao, componentDao, logger, authService);
⋮----
return new Service_VolvoMasterData(partDao, componentDao, logger, errorHandler);
⋮----
// Reporting Services (003-reporting-module)
services.AddSingleton(sp => new Dao_Reporting(mySqlConnectionString));
⋮----
return new Service_Reporting(dao, logger);
⋮----
// Settings Services
⋮----
// ViewModels
⋮----
// Receiving Workflow ViewModels
⋮----
// Dunnage Workflow ViewModels
⋮----
// Volvo Workflow ViewModels
⋮----
// Routing Workflow ViewModels
⋮----
// Routing Manual Entry ViewModel (Phase 4 implementation)
⋮----
// Routing Edit Mode ViewModel (Phase 5 implementation)
⋮----
// Routing Mode Selection ViewModel (Phase 6 implementation)
⋮----
// Reporting ViewModels (003-reporting-module)
⋮----
// Views
//services.AddTransient<Main_ReceivingLabelPage>();
//services.AddTransient<Main_DunnageLabelPage>();
//services.AddTransient<Main_CarrierDeliveryLabelPage>();
⋮----
// NEW Routing Wizard Views (Phase 3 implementation)
⋮----
// Routing Manual Entry View (Phase 4 implementation)
⋮----
// Routing Edit Mode View (Phase 5 implementation)
⋮----
// Routing Mode Selection View (Phase 6 implementation)
⋮----
// Settings Views - TODO: Re-add when implemented
/*
                services.AddTransient<View_Settings_Workflow>();
                services.AddTransient<View_Settings_ModeSelection>();
                services.AddTransient<View_Settings_DunnageMode>();
                services.AddTransient<View_Settings_Placeholder>();
                */
⋮----
// Reporting Views (003-reporting-module)
⋮----
// Dunnage Admin Views
⋮----
// Dunnage Dialogs
⋮----
// Volvo Views
⋮----
// Windows
⋮----
.Build();
⋮----
/// Invoked when the application is launched
⋮----
/// <param name="args"></param>
protected override async void OnLaunched(LaunchActivatedEventArgs args)
⋮----
await startupService.StartAsync();
⋮----
// Subscribe to session events
⋮----
private void OnSessionTimedOut(object? sender, Model_SessionTimedOutEventArgs e)
⋮----
// Close application on timeout
// In a real app, we might show a dialog or navigate to login
⋮----
private async void OnMainWindowClosed(object sender, WindowEventArgs args)
⋮----
await sessionManager.EndSessionAsync("manual_close");
⋮----
/// Gets a service from the dependency injection container
⋮----
/// <typeparam name="T">The service type</typeparam>
/// <returns>The requested service</returns>
/// <exception cref="InvalidOperationException">Thrown if the service is not found</exception>
public static T GetService<T>() where T : class
⋮----
?? throw new InvalidOperationException($"Service {typeof(T)} not found");
</file>

</files>
