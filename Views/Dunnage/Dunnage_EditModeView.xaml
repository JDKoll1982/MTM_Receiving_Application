<UserControl
    x:Class="MTM_Receiving_Application.Views.Dunnage.Dunnage_EditModeView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:viewmodels="using:MTM_Receiving_Application.ViewModels.Dunnage"
    xmlns:enums="using:MTM_Receiving_Application.Models.Enums"
    xmlns:converters="using:MTM_Receiving_Application.Converters"
    mc:Ignorable="d"
    x:Name="Root">

    <UserControl.Resources>
        <converters:Converter_DecimalToString x:Key="DecimalToStringConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Toolbar - T154: 3 data source buttons -->
        <Grid Grid.Row="0" Margin="0,0,0,12">
            <!-- Main Toolbar Area -->
            <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                <!-- Load Data Section - T154 -->
                <TextBlock Text="Load Data From:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,4,0"/>
                
                <Button Command="{x:Bind ViewModel.LoadFromCurrentMemoryCommand}" ToolTipService.ToolTip="Load unsaved loads from current session">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE81D;"/>
                        <TextBlock Text="Current Memory"/>
                    </StackPanel>
                </Button>

                <Button Command="{x:Bind ViewModel.LoadFromCurrentLabelsCommand}" ToolTipService.ToolTip="Load from most recent CSV export">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8E5;"/>
                        <TextBlock Text="Current Labels"/>
                    </StackPanel>
                </Button>
                
                <Button Command="{x:Bind ViewModel.LoadFromHistoryCommand}" ToolTipService.ToolTip="Load historical loads from database">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74C;"/>
                        <TextBlock Text="History"/>
                    </StackPanel>
                </Button>

                <!-- Separator -->
                <Rectangle Width="1" Height="24" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" Margin="8,0"/>

                <!-- Edit Actions Section -->
                <Button Command="{x:Bind ViewModel.SelectAllCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8B3;"/>
                        <TextBlock Text="Select All"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.RemoveSelectedRowsCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74D;"/>
                        <TextBlock Text="Remove Selected"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Date Filter Toolbar - T164: Dynamic button text -->
        <Grid Grid.Row="1" Margin="0,0,0,12">
            <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                <TextBlock Text="Filter Date:" VerticalAlignment="Center" FontWeight="SemiBold"/>
                
                <CalendarDatePicker Date="{x:Bind ViewModel.FromDate, Mode=TwoWay}" 
                                   PlaceholderText="Start Date" 
                                   Width="140"/>
                <TextBlock Text="to" VerticalAlignment="Center"/>
                <CalendarDatePicker Date="{x:Bind ViewModel.ToDate, Mode=TwoWay}" 
                                   PlaceholderText="End Date" 
                                   Width="140"/>
                
                <Rectangle Width="1" Height="24" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" Margin="8,0"/>
                
                <!-- T158, T159, T160, T161, T162, T163, T164: Date filter buttons with dynamic text -->
                <Button Content="{x:Bind ViewModel.LastWeekButtonText, Mode=OneTime}" 
                        Command="{x:Bind ViewModel.SetFilterLastWeekCommand}"
                        ToolTipService.ToolTip="Show loads from last 7 days"/>
                <Button Content="{x:Bind ViewModel.TodayButtonText, Mode=OneTime}" 
                        Command="{x:Bind ViewModel.SetFilterTodayCommand}"
                        ToolTipService.ToolTip="Show loads from today only"/>
                <Button Content="{x:Bind ViewModel.ThisWeekButtonText, Mode=OneTime}" 
                        Command="{x:Bind ViewModel.SetFilterThisWeekCommand}"
                        ToolTipService.ToolTip="Show loads from this week (Mon-Sun)"/>
                <Button Content="{x:Bind ViewModel.ThisMonthButtonText, Mode=OneTime}" 
                        Command="{x:Bind ViewModel.SetFilterThisMonthCommand}"
                        ToolTipService.ToolTip="Show loads from this month"/>
                <Button Content="{x:Bind ViewModel.ThisQuarterButtonText, Mode=OneTime}" 
                        Command="{x:Bind ViewModel.SetFilterThisQuarterCommand}"
                        ToolTipService.ToolTip="Show loads from this quarter"/>
                <Button Content="Show All" 
                        Command="{x:Bind ViewModel.SetFilterShowAllCommand}"
                        ToolTipService.ToolTip="Show all loads from last year"/>
            </StackPanel>
        </Grid>

        <!-- Data Grid -->
        <controls:DataGrid Grid.Row="2"
                          x:Name="EditModeDataGrid"
                          ItemsSource="{x:Bind ViewModel.FilteredLoads, Mode=OneWay}"
                          AutoGenerateColumns="False"
                          IsReadOnly="False"
                          CanUserSortColumns="True"
                          GridLinesVisibility="All"
                          HeadersVisibility="Column"
                          SelectionMode="Single"
                          KeyDown="EditModeDataGrid_KeyDown"
                          CurrentCellChanged="EditModeDataGrid_CurrentCellChanged"
                          Tapped="EditModeDataGrid_Tapped">
            <controls:DataGrid.Columns>
                <controls:DataGridTemplateColumn Header="" Width="50" CanUserResize="False">
                    <controls:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}" 
                                      HorizontalAlignment="Center" 
                                      VerticalAlignment="Center"
                                      MinWidth="0"
                                      Margin="0"/>
                        </DataTemplate>
                    </controls:DataGridTemplateColumn.CellTemplate>
                </controls:DataGridTemplateColumn>
                <controls:DataGridTextColumn Header="Load #" Binding="{Binding LoadNumber}" IsReadOnly="True" Width="Auto"/>
                <controls:DataGridTextColumn Header="Type" Binding="{Binding TypeName}" Width="*"/>
                <controls:DataGridTextColumn Header="Part ID" Binding="{Binding PartId}" Width="*"/>
                <controls:DataGridTextColumn Header="Quantity" Binding="{Binding Quantity}" Width="Auto"/>
                <controls:DataGridTextColumn Header="PO Number" Binding="{Binding PoNumber}" Width="Auto"/>
                <controls:DataGridTextColumn Header="Location" Binding="{Binding Location}" Width="Auto"/>
                <controls:DataGridTextColumn Header="Created Date" Binding="{Binding CreatedDate}" IsReadOnly="True" Width="Auto"/>
                <controls:DataGridTextColumn Header="Created By" Binding="{Binding CreatedBy}" IsReadOnly="True" Width="Auto"/>
            </controls:DataGrid.Columns>
        </controls:DataGrid>

        <!-- Footer: Pagination and Save -->
        <Grid Grid.Row="3" Margin="0,12,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Pagination Controls -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                <Button Command="{x:Bind ViewModel.FirstPageCommand}" ToolTipService.ToolTip="First Page">
                    <FontIcon Glyph="&#xE892;"/>
                </Button>
                <Button Command="{x:Bind ViewModel.PreviousPageCommand}" ToolTipService.ToolTip="Previous Page">
                    <FontIcon Glyph="&#xE76B;"/>
                </Button>
                
                <Rectangle Width="1" Height="24" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" Margin="8,0"/>
                
                <TextBlock Text="Page" VerticalAlignment="Center"/>
                <TextBlock Text="{x:Bind ViewModel.CurrentPage, Mode=OneWay}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                <TextBlock Text="of" VerticalAlignment="Center"/>
                <TextBlock Text="{x:Bind ViewModel.TotalPages, Mode=OneWay}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                
                <Rectangle Width="1" Height="24" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" Margin="8,0"/>
                
                <Button Command="{x:Bind ViewModel.NextPageCommand}" ToolTipService.ToolTip="Next Page">
                    <FontIcon Glyph="&#xE76C;"/>
                </Button>
                <Button Command="{x:Bind ViewModel.LastPageCommand}" ToolTipService.ToolTip="Last Page">
                    <FontIcon Glyph="&#xE893;"/>
                </Button>
            </StackPanel>

            <!-- Save Button -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12">
                <Button Content="Save Changes" Command="{x:Bind ViewModel.SaveAllCommand}" Style="{StaticResource AccentButtonStyle}"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
