<UserControl
    x:Class="MTM_Receiving_Application.Views.Dunnage.Dunnage_ManualEntryView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:viewmodels="using:MTM_Receiving_Application.ViewModels.Dunnage"
    xmlns:enums="using:MTM_Receiving_Application.Models.Enums"
    xmlns:converters="using:MTM_Receiving_Application.Converters"
    mc:Ignorable="d"
    x:Name="Root">

    <UserControl.Resources>
        <converters:Converter_DecimalToString x:Key="DecimalToStringConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Grid Grid.Row="0" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                <Button Command="{x:Bind ViewModel.AddRowCommand}" Style="{StaticResource AccentButtonStyle}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE710;"/>
                        <TextBlock Text="Add Row"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.AddMultipleRowsCommand}" ToolTipService.ToolTip="Add multiple rows at once (up to 100)">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE710;"/>
                        <TextBlock Text="Add Multiple"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.RemoveRowCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74D;"/>
                        <TextBlock Text="Remove Row"/>
                    </StackPanel>
                </Button>
                
                <Rectangle Width="1" Height="24" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" Margin="8,0"/>
                
                <Button Command="{x:Bind ViewModel.AutoFillCommand}" ToolTipService.ToolTip="Auto-fill from last entry for this Part ID">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74E;"/>
                        <TextBlock Text="Auto-Fill"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.FillBlankSpacesCommand}" ToolTipService.ToolTip="Copy PO, Location, and specs from last row to empty fields">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8B7;"/>
                        <TextBlock Text="Fill Blank Spaces"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.SortForPrintingCommand}" ToolTipService.ToolTip="Sort by Part ID → PO → Type">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8CB;"/>
                        <TextBlock Text="Sort"/>
                    </StackPanel>
                </Button>
                
                <Rectangle Width="1" Height="24" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" Margin="8,0"/>
                
                <Button Command="{x:Bind ViewModel.SaveToHistoryCommand}" ToolTipService.ToolTip="Save as 'In Progress' for later editing">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74C;"/>
                        <TextBlock Text="Save to History"/>
                    </StackPanel>
                </Button>
            </StackPanel>
            
            <Button Grid.Column="1" 
                    Content="Mode Selection" 
                    Command="{x:Bind ViewModel.ReturnToModeSelectionCommand}"
                    ToolTipService.ToolTip="Return to mode selection (clears current work)"
                    Background="Transparent" 
                    BorderBrush="{ThemeResource SystemAccentColor}"/>
        </Grid>

        <!-- Data Grid -->
        <controls:DataGrid Grid.Row="1"
                          x:Name="ManualEntryDataGrid"
                          ItemsSource="{x:Bind ViewModel.Loads, Mode=OneWay}"
                          SelectedItem="{x:Bind ViewModel.SelectedLoad, Mode=TwoWay}"
                          AutoGenerateColumns="False"
                          IsReadOnly="False"
                          CanUserSortColumns="True"
                          GridLinesVisibility="All"
                          HeadersVisibility="Column"
                          SelectionMode="Single"
                          KeyDown="ManualEntryDataGrid_KeyDown"
                          CurrentCellChanged="ManualEntryDataGrid_CurrentCellChanged"
                          Tapped="ManualEntryDataGrid_Tapped">
            <controls:DataGrid.Columns>
                <controls:DataGridTextColumn Header="Load #" Binding="{Binding LoadNumber}" IsReadOnly="True" Width="Auto"/>
                <controls:DataGridTextColumn Header="Type" Binding="{Binding TypeName}" Width="*"/>
                <controls:DataGridTextColumn Header="Part ID" Binding="{Binding PartId}" Width="*"/>
                <controls:DataGridTextColumn Header="Quantity" Binding="{Binding Quantity}" Width="Auto"/>
                <controls:DataGridTextColumn Header="PO Number" Binding="{Binding PoNumber}" Width="Auto"/>
                <controls:DataGridTextColumn Header="Location" Binding="{Binding Location}" Width="Auto"/>
            </controls:DataGrid.Columns>
        </controls:DataGrid>

        <!-- Navigation -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0" Spacing="12">
            <Button Content="Save &amp; Finish" Command="{x:Bind ViewModel.SaveAllCommand}" Style="{StaticResource AccentButtonStyle}"/>
        </StackPanel>
    </Grid>
</UserControl>
