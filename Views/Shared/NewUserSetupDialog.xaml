<?xml version="1.0" encoding="utf-8"?>
<ContentDialog
    x:Class="MTM_Receiving_Application.Views.Shared.NewUserSetupDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Create Your Account"
    PrimaryButtonText="Create Account"
    SecondaryButtonText="Cancel"
    DefaultButton="Primary"
    PrimaryButtonStyle="{StaticResource AccentButtonStyle}"
    Width="480">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header with Icon and Welcome -->
        <StackPanel Grid.Row="0" Spacing="8" Padding="20,16,20,12" Background="{ThemeResource LayerFillColorDefaultBrush}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <FontIcon Grid.Column="0" 
                          FontFamily="{StaticResource SymbolThemeFontFamily}" 
                          Glyph="&#xE77B;" 
                          FontSize="32"
                          Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                          VerticalAlignment="Center"
                          Margin="0,0,16,0"/>
                
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="Welcome to MTM Receiving" 
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               FontWeight="SemiBold"/>
                    <TextBlock Text="Let's set up your account to get started" 
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Style="{StaticResource CaptionTextBlockStyle}"/>
                </StackPanel>
            </Grid>
        </StackPanel>

        <!-- Main Content - Using Grid for compact two-column layout with ScrollViewer -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto" 
                      HorizontalScrollBarVisibility="Disabled"
                      MaxHeight="480">
            <Grid Padding="20,12" RowSpacing="12" ColumnSpacing="12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

            <!-- Row 0: Full Name (spans both columns) -->
            <StackPanel Grid.Row="0" Grid.ColumnSpan="2" Spacing="6">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE77B;" 
                              FontSize="16"
                              Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    <TextBlock Text="Full Name *" 
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                </StackPanel>
                <TextBox x:Name="FullNameTextBox"
                         PlaceholderText="Enter your full name"
                         MaxLength="100"
                         TabIndex="0"/>
            </StackPanel>

            <!-- Row 1: Employee Number & Windows Username -->
            <StackPanel Grid.Row="1" Grid.Column="0" Spacing="6">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE8D4;" 
                              FontSize="16"
                              Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    <TextBlock Text="Employee Number *" 
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                </StackPanel>
                <TextBox x:Name="EmployeeNumberTextBox"
                         PlaceholderText="e.g., 6229"
                         MaxLength="10"
                         TabIndex="1"
                         InputScope="Number"/>
            </StackPanel>

            <StackPanel Grid.Row="1" Grid.Column="1" Spacing="6">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE910;" 
                              FontSize="16"
                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    <TextBlock Text="Windows Username" 
                               Style="{StaticResource BodyStrongTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <TextBox x:Name="WindowsUsernameTextBox"
                         IsReadOnly="True"
                         Background="{ThemeResource ControlAltFillColorSecondaryBrush}"
                         TabIndex="-1"/>
            </StackPanel>

            <!-- Row 2: Department & Shift -->
            <StackPanel Grid.Row="2" Grid.Column="0" Spacing="6">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE716;" 
                              FontSize="16"
                              Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    <TextBlock Text="Department *" 
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                </StackPanel>
                <ComboBox x:Name="DepartmentComboBox"
                          PlaceholderText="Select department"
                          HorizontalAlignment="Stretch"
                          TabIndex="2"
                          SelectionChanged="DepartmentComboBox_SelectionChanged"/>
            </StackPanel>

            <StackPanel Grid.Row="2" Grid.Column="1" Spacing="6">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE823;" 
                              FontSize="16"
                              Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    <TextBlock Text="Shift *" 
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                </StackPanel>
                <ComboBox x:Name="ShiftComboBox"
                          PlaceholderText="Select shift"
                          HorizontalAlignment="Stretch"
                          TabIndex="4">
                    <ComboBoxItem Content="1st Shift"/>
                    <ComboBoxItem Content="2nd Shift"/>
                    <ComboBoxItem Content="3rd Shift"/>
                </ComboBox>
            </StackPanel>

            <!-- Row 3: Custom Department (Visible when "Other" selected, spans both columns) -->
            <StackPanel x:Name="CustomDepartmentPanel" 
                        Grid.Row="3" 
                        Grid.ColumnSpan="2" 
                        Spacing="6" 
                        Visibility="Collapsed">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE70F;" 
                              FontSize="16"
                              Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    <TextBlock Text="Custom Department Name *" 
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                </StackPanel>
                <TextBox x:Name="CustomDepartmentTextBox"
                         PlaceholderText="Enter department name"
                         MaxLength="50"
                         TabIndex="3"/>
            </StackPanel>

            <!-- Row 4: PIN Fields -->
            <StackPanel Grid.Row="4" Grid.Column="0" Spacing="6">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE72E;" 
                              FontSize="16"
                              Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    <TextBlock Text="4-Digit PIN *" 
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                </StackPanel>
                <PasswordBox x:Name="PinPasswordBox"
                             PlaceholderText="Create PIN"
                             MaxLength="4"
                             TabIndex="5"
                             PasswordRevealMode="Peek"/>
                <TextBlock Text="For shared terminal login" 
                           Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                           Style="{StaticResource CaptionTextBlockStyle}"/>
            </StackPanel>

            <StackPanel Grid.Row="4" Grid.Column="1" Spacing="6">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                              Glyph="&#xE8C9;" 
                              FontSize="16"
                              Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                    <TextBlock Text="Confirm PIN *" 
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                </StackPanel>
                <PasswordBox x:Name="ConfirmPinPasswordBox"
                             PlaceholderText="Re-enter PIN"
                             MaxLength="4"
                             TabIndex="6"
                             PasswordRevealMode="Peek"/>
            </StackPanel>

            <!-- Row 5: ERP Credentials Section (Optional) -->
            <Expander x:Name="ErpExpander"
                      Grid.Row="5" 
                      Grid.ColumnSpan="2"
                      Header="ERP System Access (Optional)"
                      IsExpanded="False"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Stretch"
                      VerticalContentAlignment="Stretch">
                <Expander.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                      Glyph="&#xE89F;" 
                                      FontSize="16"/>
                            <TextBlock Text="{Binding}" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                        </StackPanel>
                    </DataTemplate>
                </Expander.HeaderTemplate>
                
                <StackPanel Spacing="12" Padding="12,8,0,0">
                    <CheckBox x:Name="ConfigureErpCheckBox"
                              Content="Configure Visual/Infor ERP credentials"
                              Checked="ConfigureErpCheckBox_Checked"
                              Unchecked="ConfigureErpCheckBox_Unchecked"
                              TabIndex="7"/>

                    <StackPanel x:Name="ErpCredentialsPanel" Spacing="12" Visibility="Collapsed">
                        <InfoBar Severity="Warning" 
                                 IsOpen="True" 
                                 IsClosable="False"
                                 Message="Credentials are stored in plain text for ERP integration."/>
                        
                        <StackPanel Spacing="6">
                            <TextBlock Text="Visual/Infor Username" 
                                       Style="{StaticResource BodyStrongTextBlockStyle}"/>
                            <TextBox x:Name="VisualUsernameTextBox"
                                     PlaceholderText="ERP username"
                                     MaxLength="50"
                                     TabIndex="8"/>
                        </StackPanel>

                        <StackPanel Spacing="6">
                            <TextBlock Text="Visual/Infor Password" 
                                       Style="{StaticResource BodyStrongTextBlockStyle}"/>
                            <PasswordBox x:Name="VisualPasswordBox"
                                         PlaceholderText="ERP password"
                                         MaxLength="100"
                                         TabIndex="9"
                                         PasswordRevealMode="Peek"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </Expander>
            </Grid>
        </ScrollViewer>

        <!-- Footer: Status Bar & Progress -->
        <StackPanel Grid.Row="2" Spacing="6" Padding="20,8,20,16">
            <ProgressBar x:Name="LoadingProgressBar" 
                         IsIndeterminate="True" 
                         Visibility="Collapsed"
                         Height="4"/>
            
            <InfoBar x:Name="StatusInfoBar"
                     IsOpen="False"
                     IsClosable="True"/>
        </StackPanel>
    </Grid>
</ContentDialog>
