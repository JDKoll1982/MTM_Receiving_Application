<UserControl
    x:Class="MTM_Receiving_Application.Views.Receiving.HeatLotView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:MTM_Receiving_Application.Converters"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:StringFormatConverter x:Key="StringFormatConverter"/>
        <converters:IntToVisibilityConverter x:Key="IntToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="1*"/>
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0" Spacing="16" Margin="0,0,24,0">
            <!-- Return to Mode Selection Button -->
            <Button Content="â† Return to Mode Selection" 
                    Command="{x:Bind ViewModel.ReturnToModeSelectionCommand}"
                    Style="{StaticResource SubtleButtonStyle}"
                    Margin="0,0,0,8"/>
            
            <TextBlock Text="Enter Heat/Lot Numbers" Style="{StaticResource SubtitleTextBlockStyle}"/>
            
            <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="500">
                <ItemsControl ItemsSource="{x:Bind ViewModel.Loads, Mode=OneWay}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="0,0,0,12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" Padding="12" CornerRadius="4" BorderThickness="1" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" VerticalAlignment="Center" Width="100">
                                    <TextBlock Text="{Binding LoadNumber, Converter={StaticResource StringFormatConverter}, ConverterParameter='Load #{0}'}" 
                                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                                
                                <TextBox Grid.Column="1"
                                         Header="Heat/Lot #"
                                         Text="{Binding HeatLotNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="Enter heat number"/>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </StackPanel>

        <!-- Quick Select Sidebar -->
        <StackPanel Grid.Column="1" Spacing="12" Background="{ThemeResource LayerFillColorDefaultBrush}" Padding="16" CornerRadius="8">
            <TextBlock Text="Quick Select" Style="{StaticResource BodyStrongTextBlockStyle}"/>
            <TextBlock Text="Check to apply to empty loads" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            
            <ItemsControl ItemsSource="{x:Bind ViewModel.UniqueHeatNumbers, Mode=OneWay}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <CheckBox Content="{Binding DisplayText}" 
                                  IsChecked="{Binding IsChecked, Mode=TwoWay}"
                                  Margin="0,4,0,4"/>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            
            <TextBlock Text="No heat numbers entered yet." 
                       Visibility="{x:Bind ViewModel.UniqueHeatNumbers.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=Inverse}"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       FontStyle="Italic"/>
        </StackPanel>
    </Grid>
</UserControl>
