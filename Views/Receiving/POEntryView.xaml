<UserControl
    x:Class="MTM_Receiving_Application.Views.Receiving.POEntryView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:MTM_Receiving_Application.Converters"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <StackPanel Spacing="16" MaxWidth="600" HorizontalAlignment="Left">
        
        <!-- Return to Mode Selection Button -->
        <Button Content="â† Return to Mode Selection" 
                Command="{x:Bind ViewModel.ReturnToModeSelectionCommand}"
                Style="{StaticResource SubtleButtonStyle}"
                Margin="0,0,0,8"/>
        
        <!-- PO Entry Mode -->
        <StackPanel Visibility="{x:Bind ViewModel.StepData.IsNonPOItem, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}" Spacing="16">
            <TextBlock Text="Enter Purchase Order Number" Style="{StaticResource SubtitleTextBlockStyle}"/>
            <StackPanel Orientation="Horizontal" Spacing="12">
                <TextBox Header="PO Number" 
                         Text="{x:Bind ViewModel.StepData.PONumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                         Width="200"
                         PlaceholderText="e.g. 123456"/>
                <Button Content="Load PO" 
                        Command="{x:Bind ViewModel.LoadPOCommand}" 
                        VerticalAlignment="Bottom" Style="{StaticResource AccentButtonStyle}"/>
                <Button Content="Switch to Non-PO" 
                        Command="{x:Bind ViewModel.ToggleNonPOCommand}" 
                        VerticalAlignment="Bottom"/>
            </StackPanel>
        </StackPanel>

        <!-- Non-PO Entry Mode -->
        <StackPanel Visibility="{x:Bind ViewModel.StepData.IsNonPOItem, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" Spacing="16">
            <TextBlock Text="Enter Non-PO Item Details" Style="{StaticResource SubtitleTextBlockStyle}"/>
            <StackPanel Orientation="Horizontal" Spacing="12">
                <TextBox Header="Part ID" 
                         Text="{x:Bind ViewModel.StepData.PartID, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                         Width="200"
                         PlaceholderText="e.g. PART-123"/>
                <Button Content="Look Up Part" 
                        Command="{x:Bind ViewModel.LookupPartCommand}" 
                        VerticalAlignment="Bottom" Style="{StaticResource AccentButtonStyle}"/>
                <Button Content="Switch to PO Entry" 
                        Command="{x:Bind ViewModel.ToggleNonPOCommand}" 
                        VerticalAlignment="Bottom"/>
            </StackPanel>
        </StackPanel>

        <ProgressBar IsIndeterminate="True" Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>

        <controls:DataGrid ItemsSource="{x:Bind ViewModel.Parts, Mode=OneWay}"
                          SelectedItem="{x:Bind ViewModel.StepData.SelectedPart, Mode=TwoWay}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          Height="300">
            <controls:DataGrid.Columns>
                <controls:DataGridTextColumn Header="Part ID" Binding="{Binding PartID}"/>
                <controls:DataGridTextColumn Header="Description" Binding="{Binding Description}"/>
                <controls:DataGridTextColumn Header="Qty Ordered" Binding="{Binding QtyOrdered}"/>
                <controls:DataGridTextColumn Header="Line #" Binding="{Binding POLineNumber}"/>
            </controls:DataGrid.Columns>
        </controls:DataGrid>
    </StackPanel>
</UserControl>
