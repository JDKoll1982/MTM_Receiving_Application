<UserControl
    x:Class="MTM_Receiving_Application.Views.Receiving.ManualEntryView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:viewmodels="using:MTM_Receiving_Application.ViewModels.Receiving"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Grid Grid.Row="0" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                <Button Command="{x:Bind ViewModel.AddRowCommand}" Style="{StaticResource AccentButtonStyle}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE710;"/>
                        <TextBlock Text="Add Row"/>
                    </StackPanel>
                </Button>
                <Button Command="{x:Bind ViewModel.RemoveRowCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74D;"/>
                        <TextBlock Text="Remove Row"/>
                    </StackPanel>
                </Button>
            </StackPanel>
            
            <Button x:Name="HelpButton"
                    Grid.Column="1"
                    Canvas.ZIndex="1000"
                    Style="{StaticResource AccentButtonStyle}"
                    Padding="12,8"
                    Margin="0,0,12,0"
                    ToolTipService.ToolTip="Click for help about manual entry">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE946;" FontSize="16"/>
                    <TextBlock Text="Help"/>
                </StackPanel>
                <Button.Flyout>
                    <Flyout>
                        <ScrollViewer MaxWidth="450" MaxHeight="650">
                            <StackPanel Spacing="20" Padding="4">
                                <StackPanel Spacing="8">
                                    <TextBlock Text="Manual Entry Mode" Style="{StaticResource SubtitleTextBlockStyle}" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                    <Border Height="2" Background="{ThemeResource AccentFillColorDefaultBrush}" CornerRadius="1" HorizontalAlignment="Left" Width="60"/>
                                    <TextBlock TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}">Bulk data entry grid for experienced users. Enter multiple loads quickly.</TextBlock>
                                </StackPanel>
                                
                                <Border Background="{ThemeResource LayerFillColorDefaultBrush}" Padding="16" CornerRadius="8" BorderThickness="1" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
                                    <StackPanel Spacing="8">
                                        <TextBlock Text="Grid Columns" FontWeight="SemiBold" FontSize="14"/>
                                        <StackPanel Spacing="4">
                                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">• PO Number: Purchase order (6 digits)</TextBlock>
                                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">• Part ID: Material part number</TextBlock>
                                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">• Weight/Qty: Pounds or piece count</TextBlock>
                                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">• Heat/Lot: Traceability number</TextBlock>
                                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">• Package Type: Coils, Sheets, Skids, etc.</TextBlock>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                                
                                <Border Background="{ThemeResource LayerFillColorDefaultBrush}" Padding="16" CornerRadius="8" BorderThickness="1" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
                                    <StackPanel Spacing="8">
                                        <TextBlock Text="Quick Actions" FontWeight="SemiBold" FontSize="14"/>
                                        <StackPanel Spacing="4">
                                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">• Add Row: Insert new blank row</TextBlock>
                                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">• Remove Row: Delete selected row</TextBlock>
                                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">• Click cells to edit directly</TextBlock>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                                
                                <Border Background="{ThemeResource SystemFillColorCautionBackgroundBrush}" Padding="16" CornerRadius="8" BorderThickness="1" BorderBrush="{ThemeResource SystemFillColorCautionBrush}">
                                    <StackPanel Spacing="8">
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <FontIcon Glyph="&#xE7BA;" FontSize="14" Foreground="{ThemeResource SystemFillColorCautionBrush}"/>
                                            <TextBlock Text="Important" FontWeight="SemiBold" FontSize="14" Foreground="{ThemeResource SystemFillColorCautionBrush}"/>
                                        </StackPanel>
                                        <TextBlock TextWrapping="Wrap" FontSize="12">Data is validated when you click Save. Errors will be highlighted. Best for users familiar with receiving workflow.</TextBlock>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </ScrollViewer>
                    </Flyout>
                </Button.Flyout>
            </Button>
            
            <Button Grid.Column="2" 
                    Content="Mode Selection" 
                    Command="{x:Bind ViewModel.ReturnToModeSelectionCommand}"
                    ToolTipService.ToolTip="Return to mode selection (clears current work)"
                    Background="Transparent" 
                    BorderBrush="{ThemeResource SystemAccentColor}"/>
        </Grid>

        <!-- Data Grid -->
        <controls:DataGrid Grid.Row="1"
                          ItemsSource="{Binding Loads}"
                          SelectedItem="{Binding SelectedLoad, Mode=TwoWay}"
                          AutoGenerateColumns="False"
                          IsReadOnly="False"
                          CanUserSortColumns="True"
                          GridLinesVisibility="All"
                          HeadersVisibility="Column"
                          SelectionMode="Single">
            <controls:DataGrid.Columns>
                <controls:DataGridTextColumn Header="PO Number" Binding="{Binding PoNumber}"/>
                <controls:DataGridTextColumn Header="Line #" Binding="{Binding PoLineNumber}"/>
                <controls:DataGridTextColumn Header="Part ID" Binding="{Binding PartID}"/>
                <controls:DataGridTextColumn Header="Part Type" Binding="{Binding PartType}"/>
                <controls:DataGridTextColumn Header="Load #" Binding="{Binding LoadNumber}"/>
                <controls:DataGridTextColumn Header="Weight/Qty" Binding="{Binding WeightQuantity}"/>
                <controls:DataGridTextColumn Header="Heat/Lot" Binding="{Binding HeatLotNumber}"/>
                <controls:DataGridTextColumn Header="Pkgs/Load" Binding="{Binding PackagesPerLoad}"/>
                <controls:DataGridTextColumn Header="Pkg Type" Binding="{Binding PackageTypeName}"/>
                <controls:DataGridTextColumn Header="Wt/Pkg" Binding="{Binding WeightPerPackage}"/>
                <controls:DataGridCheckBoxColumn Header="Non-PO" Binding="{Binding IsNonPOItem}"/>
            </controls:DataGrid.Columns>
        </controls:DataGrid>

        <!-- Navigation -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0" Spacing="12">
            <Button Content="Save &amp; Finish" Command="{x:Bind ViewModel.SaveCommand}" Style="{StaticResource AccentButtonStyle}"/>
        </StackPanel>
    </Grid>
</UserControl>
