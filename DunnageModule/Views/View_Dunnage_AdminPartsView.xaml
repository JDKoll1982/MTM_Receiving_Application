<Page
    x:Class="MTM_Receiving_Application.DunnageModule.Views.View_Dunnage_AdminPartsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    Loaded="OnPageLoaded">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock 
                Text="Manage Dunnage Parts" 
                Style="{StaticResource TitleTextBlockStyle}"/>
            <TextBlock 
                Text="Add, edit, and search dunnage parts with spec values" 
                Style="{StaticResource BodyTextBlockStyle}"
                Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                Margin="0,8,0,0"/>
        </StackPanel>

        <!-- Toolbar -->
        <CommandBar Grid.Row="1" DefaultLabelPosition="Right" Margin="0,0,0,16">
            <AppBarButton 
                Icon="Add" 
                Label="Add New Part"
                ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.CreatePart'), Mode=OneWay}"/>
            <AppBarSeparator/>
            <AppBarButton 
                Icon="Edit" 
                Label="Edit Part"
                IsEnabled="{x:Bind ViewModel.CanEdit, Mode=OneWay}"
                ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.EditPart'), Mode=OneWay}"/>
            <AppBarButton 
                Icon="Delete" 
                Label="Delete Part"
                Command="{x:Bind ViewModel.ShowDeleteConfirmationCommand}"
                IsEnabled="{x:Bind ViewModel.CanDelete, Mode=OneWay}"
                ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.DeletePart'), Mode=OneWay}"/>
            <AppBarSeparator/>
            <AppBarButton 
                Icon="Back" 
                Label="Back to Admin Hub"
                Command="{x:Bind ViewModel.ReturnToAdminHubCommand}"
                ToolTipService.ToolTip="{x:Bind ViewModel.GetTooltip('Button.ReturnToAdmin'), Mode=OneWay}"/>
        </CommandBar>

        <!-- Search and Filter Bar -->
        <Grid Grid.Row="2" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Search Box -->
            <TextBox 
                Grid.Column="0"
                Text="{x:Bind ViewModel.SearchText, Mode=TwoWay}"
                PlaceholderText="Search by Part ID..."
                Margin="0,0,12,0">
                <TextBox.KeyboardAccelerators>
                    <KeyboardAccelerator Key="Enter" Invoked="OnSearchKeyboardAccelerator"/>
                </TextBox.KeyboardAccelerators>
            </TextBox>

            <!-- Type Filter -->
            <ComboBox 
                Grid.Column="1"
                ItemsSource="{x:Bind ViewModel.AvailableTypes, Mode=OneWay}"
                SelectedItem="{x:Bind ViewModel.SelectedFilterType, Mode=TwoWay}"
                PlaceholderText="Filter by Type"
                DisplayMemberPath="DunnageType"
                MinWidth="200"
                Margin="0,0,12,0"/>

            <!-- Filter Buttons -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                <Button 
                    Content="Search"
                    Command="{x:Bind ViewModel.SearchPartsCommand}"
                    Style="{StaticResource AccentButtonStyle}"/>
                <Button 
                    Content="Filter by Type"
                    Command="{x:Bind ViewModel.FilterByTypeCommand}"/>
                <Button 
                    Content="Clear"
                    Command="{x:Bind ViewModel.ClearFiltersCommand}"/>
            </StackPanel>
        </Grid>

        <!-- DataGrid -->
        <Border 
            Grid.Row="3" 
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="1"
            CornerRadius="8"
            Padding="1">
            <Grid>
                <controls:DataGrid
                    ItemsSource="{x:Bind ViewModel.Parts, Mode=OneWay}"
                    SelectedItem="{x:Bind ViewModel.SelectedPart, Mode=TwoWay}"
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    GridLinesVisibility="Horizontal"
                    HeadersVisibility="Column"
                    SelectionMode="Single"
                    CanUserReorderColumns="False"
                    CanUserSortColumns="True"
                    VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Auto"
                    AlternatingRowBackground="{ThemeResource SubtleFillColorSecondaryBrush}">

                    <controls:DataGrid.Columns>
                        <!-- Part ID Column -->
                        <controls:DataGridTextColumn 
                            Header="Part ID" 
                            Binding="{Binding PartId}"
                            Width="2*"
                            CanUserResize="True"/>

                        <!-- Type Column -->
                        <controls:DataGridTextColumn 
                            Header="Type" 
                            Binding="{Binding DunnageTypeName}"
                            Width="*"
                            CanUserResize="True"/>

                        <!-- Spec Values Column (Note: Dynamic spec columns would require code-behind) -->
                        <controls:DataGridTextColumn 
                            Header="Specifications" 
                            Binding="{Binding DunnageSpecValuesJson}"
                            Width="2*"
                            CanUserResize="True"/>

                        <!-- Date Added Column -->
                        <controls:DataGridTextColumn 
                            Header="Date Added" 
                            Binding="{Binding CreatedDate, Converter={StaticResource DateTimeToStringConverter}}"
                            Width="*"
                            CanUserResize="True"/>

                        <!-- Added By Column -->
                        <controls:DataGridTextColumn 
                            Header="Added By" 
                            Binding="{Binding CreatedBy}"
                            Width="*"
                            CanUserResize="True"/>
                    </controls:DataGrid.Columns>
                </controls:DataGrid>

                <!-- Empty State -->
                <StackPanel 
                    VerticalAlignment="Center" 
                    HorizontalAlignment="Center"
                    Spacing="16"
                    Visibility="{x:Bind ViewModel.Parts.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=Inverse}">
                    <FontIcon 
                        Glyph="&#xE8F1;" 
                        FontSize="72"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                    <TextBlock 
                        Text="No parts found" 
                        Style="{StaticResource SubtitleTextBlockStyle}"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                    <TextBlock 
                        Text="Try adjusting your filters or add a new part"
                        Style="{StaticResource CaptionTextBlockStyle}"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Pagination Controls -->
        <Grid Grid.Row="4" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Record Count -->
            <TextBlock Grid.Column="0" VerticalAlignment="Center">
                <Run Text="Showing"/>
                <Run Text="{x:Bind ViewModel.Parts.Count, Mode=OneWay}" FontWeight="SemiBold"/>
                <Run Text="of"/>
                <Run Text="{x:Bind ViewModel.TotalRecords, Mode=OneWay}" FontWeight="SemiBold"/>
                <Run Text="parts"/>
            </TextBlock>

            <!-- Pagination Buttons -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                <Button 
                    Content="First"
                    Command="{x:Bind ViewModel.FirstPageCommand}"
                    IsEnabled="{x:Bind ViewModel.CanNavigatePrevious, Mode=OneWay}"
                    MinWidth="80"/>
                <Button 
                    Content="Previous"
                    Command="{x:Bind ViewModel.PreviousPageCommand}"
                    IsEnabled="{x:Bind ViewModel.CanNavigatePrevious, Mode=OneWay}"
                    MinWidth="80"/>
                <TextBlock 
                    VerticalAlignment="Center"
                    Margin="12,0,12,0">
                    <Run Text="Page"/>
                    <Run Text="{x:Bind ViewModel.CurrentPage, Mode=OneWay}" FontWeight="SemiBold"/>
                    <Run Text="of"/>
                    <Run Text="{x:Bind ViewModel.TotalPages, Mode=OneWay}" FontWeight="SemiBold"/>
                </TextBlock>
                <Button 
                    Content="Next"
                    Command="{x:Bind ViewModel.NextPageCommand}"
                    IsEnabled="{x:Bind ViewModel.CanNavigateNext, Mode=OneWay}"
                    MinWidth="80"/>
                <Button 
                    Content="Last"
                    Command="{x:Bind ViewModel.LastPageCommand}"
                    IsEnabled="{x:Bind ViewModel.CanNavigateNext, Mode=OneWay}"
                    MinWidth="80"/>
            </StackPanel>
        </Grid>

        <!-- Status Bar -->
        <StackPanel Grid.Row="5" Orientation="Horizontal" Spacing="8" Margin="0,16,0,0">
            <ProgressRing 
                IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                Width="20" 
                Height="20"/>
            <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"/>
        </StackPanel>
    </Grid>
</Page>
