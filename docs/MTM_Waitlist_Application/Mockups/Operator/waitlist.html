<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operator - My Waitlist | MTM Waitlist</title>
    <link rel="stylesheet" href="../Shared/winui3-theme.css">
    <link rel="stylesheet" href="../Shared/styles.css">
</head>
<body>
    <!-- WinUI3 Equivalent: NavigationView + Frame -->
    <div class="app-shell">
        <!-- Navigation Pane -->
        <!-- WinUI3 Equivalent: NavigationView.PaneContent -->
        <nav class="nav-pane">
            <div class="nav-pane-header">
                <h1>MTM Waitlist</h1>
                <div class="subtitle">Press Operator</div>
                <div class="subtitle" style="margin-top: 4px;">
                    <strong>John Operator</strong> â€¢ Expo Drive
                </div>
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="waitlist.html" class="nav-item-link selected">
                        <span class="nav-item-icon fluent-icon icon-home"></span>
                        <span class="nav-item-text">My Waitlist</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="active-jobs.html" class="nav-item-link">
                        <span class="nav-item-icon fluent-icon">&#xE9D5;</span> <!-- Work icon -->
                        <span class="nav-item-text">Active Jobs</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="recent.html" class="nav-item-link">
                        <span class="nav-item-icon fluent-icon icon-calendar"></span>
                        <span class="nav-item-text">Recent Requests</span>
                    </a>
                </li>
            </ul>

            <div class="nav-separator"></div>

            <ul class="nav-menu nav-footer">
                <li class="nav-item">
                    <a href="#" class="nav-item-link" onclick="showSettings(event)">
                        <span class="nav-item-icon fluent-icon icon-settings"></span>
                        <span class="nav-item-text">Settings</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-item-link" onclick="showHelp(event)">
                        <span class="nav-item-icon fluent-icon icon-help"></span>
                        <span class="nav-item-text">Help</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="../Login/login.html" class="nav-item-link">
                        <span class="nav-item-icon fluent-icon icon-logout"></span>
                        <span class="nav-item-text">Logout</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <div class="content-area">
            <!-- Command Bar -->
            <!-- WinUI3 Equivalent: CommandBar -->
            <div class="command-bar">
                <div class="command-bar-left">
                    <h2 class="page-title">My Waitlist Requests</h2>
                </div>
                <div class="command-bar-right">
                    <div class="search-box">
                        <input type="text" placeholder="Search requests..." id="searchInput" />
                    </div>
                    <button class="btn btn-accent" onclick="openNewRequestWizard()">
                        <span class="fluent-icon icon-add"></span>
                        New Request
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Info Bar - Press Selection Reminder -->
                <div class="info-bar info-bar-info mb-lg">
                    <span class="info-bar-icon fluent-icon icon-info"></span>
                    <div class="info-bar-content">
                        <div class="info-bar-title">Current Press: Press 1</div>
                        <div class="info-bar-message">All requests will be associated with Press 1. <a href="#" style="color: var(--accent-default);">Change press</a></div>
                    </div>
                </div>

                <!-- Waitlist Table -->
                <!-- WinUI3 Equivalent: ListView with GridView ItemTemplate -->
                <table class="winui-table">
                    <thead>
                        <tr>
                            <th style="width: 60px;">POS</th>
                            <th>REQUEST TYPE</th>
                            <th>DETAILS</th>
                            <th style="width: 120px;">WAIT TIME</th>
                            <th style="width: 120px;">STATUS</th>
                            <th style="width: 200px;">ACTIONS</th>
                        </tr>
                    </thead>
                    <tbody id="waitlistTableBody">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>

                <div id="emptyState" class="hidden" style="text-align: center; padding: 60px 20px;">
                    <div style="font-size: 48px; color: var(--text-tertiary); margin-bottom: 16px;">
                        <span class="fluent-icon">&#xE73A;</span> <!-- CheckList icon -->
                    </div>
                    <h3 style="color: var(--text-secondary); margin-bottom: 8px;">No active requests</h3>
                    <p style="color: var(--text-tertiary);">Your waitlist is empty. Click "New Request" to add one.</p>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-indicators">
                <div class="status-item">
                    <span class="fluent-icon icon-checkmark" style="color: var(--success-color);"></span>
                    <span id="completedCount">3 completed today</span>
                </div>
                <div class="status-item">
                    <span class="fluent-icon">&#xE774;</span> <!-- Clock icon -->
                    <span id="activeCount">2 active requests</span>
                </div>
            </div>
            <div>
                <span id="currentTime"></span>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <!-- Only shown when waitlist has items -->
    <button class="fab" id="fabAddItem" aria-label="New Request" onclick="openNewRequestWizard()">
        <span class="fluent-icon icon-add"></span>
    </button>

    <!-- New Request Wizard Modal -->
    <!-- WinUI3 Equivalent: ContentDialog -->
    <div class="dialog-overlay hidden" id="newRequestDialog">
        <div class="dialog" style="max-width: 700px;">
            <div class="dialog-header">
                <h3 class="dialog-title">New Request Wizard</h3>
            </div>
            <div class="dialog-content">
                <!-- Progress Indicator -->
                <div class="wizard-progress">
                    <div class="wizard-progress-step active" id="progress-step1">
                        <div class="wizard-progress-bullet">1</div>
                        <span>Category</span>
                    </div>
                    <div class="wizard-progress-separator" id="separator1"></div>
                    <div class="wizard-progress-step" id="progress-step2">
                        <div class="wizard-progress-bullet">2</div>
                        <span>Request Type</span>
                    </div>
                    <div class="wizard-progress-separator" id="separator2"></div>
                    <div class="wizard-progress-step" id="progress-step3">
                        <div class="wizard-progress-bullet">3</div>
                        <span>Details</span>
                    </div>
                    <div class="wizard-progress-separator" id="separator3"></div>
                    <div class="wizard-progress-step" id="progress-step4">
                        <div class="wizard-progress-bullet">4</div>
                        <span>Review</span>
                    </div>
                </div>

                <!-- Step 1: Category Selection -->
                <div class="wizard-step" id="step1-category">
                    <h4 style="margin-bottom: 16px;">Who will fulfill this request?</h4>
                    <div class="category-cards">
                        <button type="button" class="category-card" onclick="selectCategory('Material Handler')">
                            <span class="fluent-icon" style="font-size: 48px; color: var(--task-receiving);">&#xE7C8;</span>
                            <h4>Material Handler</h4>
                            <p>Coils, parts, dies, dunnage, scrap</p>
                        </button>
                        <button type="button" class="category-card" onclick="selectCategory('Setup Technician')">
                            <span class="fluent-icon" style="font-size: 48px; color: #F7630C;">&#xE73E;</span>
                            <h4>Setup Technician</h4>
                            <p>Die protection, die issues</p>
                        </button>
                        <button type="button" class="category-card" onclick="selectCategory('Quality Control')">
                            <span class="fluent-icon" style="font-size: 48px; color: #107C10;">&#xE9D9;</span>
                            <h4>Quality Control</h4>
                            <p>Inspections, quality questions</p>
                        </button>
                        <button type="button" class="category-card" onclick="selectCategory('Production Lead')">
                            <span class="fluent-icon" style="font-size: 48px; color: #0078D4;">&#xE716;</span>
                            <h4>Production Lead</h4>
                            <p>Questions, safety concerns</p>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Request Type Selection -->
                <div class="wizard-step hidden" id="step2-type">
                    <h4 style="margin-bottom: 16px;">Select request type</h4>
                    <div class="request-type-list" id="requestTypeList">
                        <!-- Dynamically populated based on category -->
                    </div>
                </div>

                <!-- Step 3: Details Form -->
                <div class="wizard-step hidden" id="step3-details">
                    <h4 style="margin-bottom: 16px;">Request details</h4>
                    <form id="newRequestForm">
                        <!-- Part Number (conditional) -->
                        <div class="form-group hidden" id="field-partNumber">
                            <label class="form-label">Part Number <span class="required">*</span></label>
                            <input type="text" class="form-input" id="input-partNumber" list="partNumbers" placeholder="e.g., MMC0001000" />
                            <datalist id="partNumbers">
                                <!-- Coils -->
                                <option value="MMC0001000">Coil</option>
                                <option value="MMC0000651">Coil</option>
                                <option value="MMC0000352">Coil</option>
                                <option value="MMC0000789">Coil</option>
                                <!-- Flatstock -->
                                <option value="MMF0005500">Flatstock</option>
                                <option value="MMF0001234">Flatstock</option>
                                <option value="MMF0009876">Flatstock</option>
                                <!-- Component Parts -->
                                <option value="23-23415-006">Component</option>
                                <option value="45-67890-123">Component</option>
                                <option value="67-89012-345">Component</option>
                            </datalist>
                        </div>

                        <!-- Work Order (conditional) -->
                        <div class="form-group hidden" id="field-workOrder">
                            <label class="form-label">Work Order <span class="required">*</span></label>
                            <input type="text" class="form-input" id="input-workOrder" placeholder="e.g., WO-12345" />
                        </div>

                        <!-- Die Number (conditional) -->
                        <div class="form-group hidden" id="field-dieNumber">
                            <label class="form-label">Die Number <span class="required">*</span></label>
                            <select class="form-select" id="input-dieNumber">
                                <option value="">Select die...</option>
                                <option value="FGT-001" data-location="Not Located">FGT-001 (Not Located)</option>
                                <option value="FGT-1934" data-location="R-A0-01">FGT-1934 (Location: R-A0-01)</option>
                                <option value="FGT-2045" data-location="R-B2-03">FGT-2045 (Location: R-B2-03)</option>
                                <option value="FGT-3056" data-location="R-C1-02">FGT-3056 (Location: R-C1-02)</option>
                            </select>
                            <div id="dieLocationDisplay" style="margin-top: 8px; font-size: 12px; color: var(--text-secondary);"></div>
                        </div>

                        <!-- Scrap Type (conditional) -->
                        <div class="form-group hidden" id="field-scrapType">
                            <label class="form-label">Scrap Type <span class="required">*</span></label>
                            <select class="form-select" id="input-scrapType">
                                <option value="">Select scrap type...</option>
                                <option value="5052 Aluminum">5052 Aluminum</option>
                                <option value="3003 Aluminum">3003 Aluminum</option>
                                <option value="Steel">Steel</option>
                                <option value="Galvanized Steel">Galvanized Steel</option>
                                <option value="Stainless Steel">Stainless Steel</option>
                                <option value="Copper">Copper</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <!-- Quantity (conditional - shown for most MH requests) -->
                        <div class="form-group hidden" id="field-quantity">
                            <label class="form-label">Quantity <span class="required">*</span></label>
                            <input type="number" class="form-input" id="input-quantity" min="1" value="1" />
                        </div>

                        <!-- Freeform Details (always shown) -->
                        <div class="form-group">
                            <label class="form-label">Additional Details <span id="detailsRequired" class="required hidden">*</span></label>
                            <textarea class="form-textarea" id="input-details" placeholder="Add any special instructions or additional information..."></textarea>
                        </div>
                    </form>
                </div>

                <!-- Step 4: Review -->
                <div class="wizard-step hidden" id="step4-review">
                    <div class="review-summary">
                        <h4>Review Your Request</h4>
                        <dl class="review-list">
                            <dt>Category:</dt>
                            <dd id="review-category">-</dd>
                            
                            <dt>Request Type:</dt>
                            <dd id="review-type">-</dd>
                            
                            <dt id="review-partNumber-label" class="hidden">Part Number:</dt>
                            <dd id="review-partNumber" class="hidden">-</dd>
                            
                            <dt id="review-workOrder-label" class="hidden">Work Order:</dt>
                            <dd id="review-workOrder" class="hidden">-</dd>
                            
                            <dt id="review-dieNumber-label" class="hidden">Die Number:</dt>
                            <dd id="review-dieNumber" class="hidden">-</dd>
                            
                            <dt id="review-scrapType-label" class="hidden">Scrap Type:</dt>
                            <dd id="review-scrapType" class="hidden">-</dd>
                            
                            <dt id="review-quantity-label" class="hidden">Quantity:</dt>
                            <dd id="review-quantity" class="hidden">-</dd>
                            
                            <dt id="review-details-label" class="hidden">Details:</dt>
                            <dd id="review-details" class="hidden">-</dd>
                            
                            <dt>Press:</dt>
                            <dd id="review-press">Press 6</dd>
                            
                            <dt>Estimated Time:</dt>
                            <dd id="review-timeStandard">-</dd>
                        </dl>
                        
                        <div class="info-bar info-bar-info" style="margin-top: 20px;" id="ncmWarning">
                            <span class="info-bar-icon fluent-icon">&#xE7BA;</span>
                            <div class="info-bar-content">
                                <div class="info-bar-title">NCM Request - Separate Tracking</div>
                                <div class="info-bar-message">Non-conforming material requests require separate quality tracking and approval.</div>
                            </div>
                        </div>
                        
                        <div class="info-bar info-bar-error" style="margin-top: 20px;" id="safetyWarning">
                            <span class="info-bar-icon fluent-icon">&#xE7BA;</span>
                            <div class="info-bar-content">
                                <div class="info-bar-title">ðŸš¨ Safety Report - Immediate Alert</div>
                                <div class="info-bar-message">This will immediately alert the Production Lead and Plant Manager.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dialog-footer">
                <div class="wizard-navigation">
                    <button type="button" class="btn" id="btnBack" onclick="wizardBack()" style="display:none;">
                        <span class="fluent-icon">&#xE72B;</span>
                        Back
                    </button>
                    <div style="flex: 1;"></div>
                    <button type="button" class="btn" onclick="closeNewRequestDialog()">Cancel</button>
                    <button type="button" class="btn btn-accent" id="btnNext" onclick="wizardNext()" disabled>
                        Next
                        <span class="fluent-icon">&#xE72A;</span>
                    </button>
                    <button type="button" class="btn btn-accent hidden" id="btnSubmit" onclick="submitNewRequest()">
                        <span class="fluent-icon icon-checkmark"></span>
                        Create Request
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="../Shared/mock-data.js"></script>
    <script>
        // Wizard State
        let wizardState = {
            currentStep: 1,
            category: null,
            requestTypeId: null,
            requestTypeDetails: null,
            formData: {}
        };

        // Populate waitlist table
        function populateWaitlist() {
            const tbody = document.getElementById('waitlistTableBody');
            const emptyState = document.getElementById('emptyState');
            
            // Use the Unified Waitlist (materialHandlerWaitlist) as the Source of Truth
            // Filter strictly for tasks created by "John Operator" (Current Mock User)
            let waitlist = MockData.materialHandlerWaitlist.filter(item => 
                item.requester === MockData.currentUser.name
            );

            // Sort by priority/urgency or creation time (simulated by ID desc here for "newest")
            // Or MockData doesn't have creation time always populated in unified list in a consistent way for sort without parsing.
            // Using ID implies order.
            
            if (waitlist.length === 0) {
                tbody.innerHTML = '';
                emptyState.classList.remove('hidden');
                MockUtils.updateFABVisibility(0);
                return;
            }

            emptyState.classList.add('hidden');
            tbody.innerHTML = waitlist.map((item, index) => {
                const waitStatus = MockUtils.getWaitTimeStatus(item.waitTime, item.timeStandard);
                const waitClass = `wait-${waitStatus}`;
                // Get pretty name if possible, or fallback
                const requestTypeObj = MockUtils.getRequestTypeById(item.requestType);
                const typeName = requestTypeObj ? requestTypeObj.name : (item.taskType || item.requestType);
                
                return `
                    <tr data-id="${item.id}">
                        <td><strong>${index + 1}</strong></td>
                        <td>
                            <div>
                                <strong>${typeName}</strong>
                                <div style="font-size: var(--font-size-caption); color: var(--text-secondary);">
                                    ${item.category} â€¢ ${item.details || ''}
                                </div>
                            </div>
                        </td>
                        <td>
                            <small style="color: var(--text-secondary);">
                                ${item.partNumber ? `Part: ${item.partNumber}` : ''}
                                ${item.workOrder ? ` â€¢ WO: ${item.workOrder}` : ''}
                            </small>
                        </td>
                        <td>
                            <span class="priority-badge ${waitClass}">
                                ${MockUtils.formatWaitTime(item.waitTime)}
                            </span>
                        </td>
                        <td>
                            <span class="status-badge priority-${item.status ? item.status.toLowerCase() : 'pending'}">
                                ${item.status || 'Pending'}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon" aria-label="Edit" title="Edit Request">
                                    <span class="fluent-icon icon-edit"></span>
                                </button>
                                <button class="btn-icon btn-cancel" aria-label="Cancel" title="Cancel Request" onclick="cancelRequest(${item.id})">
                                    <span class="fluent-icon icon-cancel"></span>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');

            MockUtils.updateFABVisibility(waitlist.length);
            
            // Update active count in status bar
             document.getElementById('activeCount').textContent = `${waitlist.length} active requests`;
        }

        // Wizard Functions
        function openNewRequestWizard() {
            wizardState = {
                currentStep: 1,
                category: null,
                requestTypeId: null,
                requestTypeDetails: null,
                formData: {}
            };
            
            document.getElementById('newRequestDialog').classList.remove('hidden');
            showWizardStep(1);
        }

        function closeNewRequestDialog() {
            document.getElementById('newRequestDialog').classList.add('hidden');
            document.getElementById('newRequestForm').reset();
        }

        function showWizardStep(stepNumber) {
            wizardState.currentStep = stepNumber;
            
            // Hide all steps
            document.querySelectorAll('.wizard-step').forEach(step => step.classList.add('hidden'));
            
            // Show current step
            document.getElementById(`step${stepNumber}-${getStepName(stepNumber)}`).classList.remove('hidden');
            
            // Update progress indicator
            for (let i = 1; i <= 4; i++) {
                const progressStep = document.getElementById(`progress-step${i}`);
                const separator = document.getElementById(`separator${i}`);
                
                if (i < stepNumber) {
                    progressStep.classList.add('completed');
                    progressStep.classList.remove('active');
                    if (separator) separator.classList.add('completed');
                } else if (i === stepNumber) {
                    progressStep.classList.add('active');
                    progressStep.classList.remove('completed');
                } else {
                    progressStep.classList.remove('active', 'completed');
                    if (separator) separator.classList.remove('completed');
                }
            }
            
            // Update navigation buttons
            document.getElementById('btnBack').style.display = stepNumber > 1 ? 'inline-flex' : 'none';
            document.getElementById('btnNext').classList.toggle('hidden', stepNumber === 4);
            document.getElementById('btnSubmit').classList.toggle('hidden', stepNumber !== 4);
            
            // Disable Next button on steps 1 and 2 until selection made
            if (stepNumber === 1) {
                document.getElementById('btnNext').disabled = !wizardState.category;
            } else if (stepNumber === 2) {
                document.getElementById('btnNext').disabled = !wizardState.requestTypeId;
            } else {
                document.getElementById('btnNext').disabled = false;
            }
        }

        function getStepName(stepNumber) {
            const names = ['category', 'type', 'details', 'review'];
            return names[stepNumber - 1];
        }

        function selectCategory(category) {
            wizardState.category = category;
            
            // Highlight selected category
            document.querySelectorAll('.category-card').forEach(card => {
                if (card.textContent.includes(category)) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
            
            // Populate request types for this category
            const types = MockUtils.getRequestTypesByCategory(category);
            const listContainer = document.getElementById('requestTypeList');
            
            listContainer.innerHTML = types.map(type => `
                <div class="request-type-item" onclick="selectRequestType('${type.id}')">
                    <input type="radio" name="requestType" value="${type.id}" id="radio-${type.id}" />
                    <div class="request-type-content">
                        <span class="fluent-icon">${type.icon}</span>
                        <div>
                            <strong>${type.name}</strong>
                            <p>${type.description} (${type.timeStandard} min standard)</p>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Enable Next button
            document.getElementById('btnNext').disabled = false;
        }

        function selectRequestType(typeId) {
            wizardState.requestTypeId = typeId;
            wizardState.requestTypeDetails = MockUtils.getRequestTypeById(typeId);
            
            // Check the radio button
            document.getElementById(`radio-${typeId}`).checked = true;
            
            // Highlight selected item
            document.querySelectorAll('.request-type-item').forEach(item => {
                if (item.querySelector(`#radio-${typeId}`)) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
            
            // Enable Next button
            document.getElementById('btnNext').disabled = false;
        }

        function wizardNext() {
            if (wizardState.currentStep === 3) {
                // Validate form before proceeding to review
                if (!validateDetailsForm()) {
                    return;
                }
                
                // Populate review step
                populateReview();
            }
            
            showWizardStep(wizardState.currentStep + 1);
            
            // Configure conditional fields when entering step 3
            if (wizardState.currentStep === 3) {
                configureDetailsForm();
            }
        }

        function wizardBack() {
            showWizardStep(wizardState.currentStep - 1);
        }

        function configureDetailsForm() {
            const details = wizardState.requestTypeDetails;
            
            // Reset all fields
            document.querySelectorAll('#step3-details .form-group').forEach(group => {
                if (group.id && group.id.startsWith('field-')) {
                    group.classList.add('hidden');
                    const input = group.querySelector('input, select, textarea');
                    if (input) input.required = false;
                }
            });
            
            // Show/configure required fields
            toggleField('partNumber', details.requiresPartNumber);
            toggleField('workOrder', details.requiresWorkOrder);
            toggleField('dieNumber', details.requiresDieNumber);
            toggleField('scrapType', details.requiresScrapType);
            toggleField('quantity', details.requiresPartNumber || details.requiresDieNumber); // Most MH requests
            
            // Freeform text required for "Other" types and Production Lead
            const detailsRequired = details.requiresFreeText || details.category === 'Production Lead';
            document.getElementById('detailsRequired').classList.toggle('hidden', !detailsRequired);
            document.getElementById('input-details').required = detailsRequired;
        }

        function toggleField(fieldId, shouldShow) {
            const field = document.getElementById(`field-${fieldId}`);
            if (field) {
                field.classList.toggle('hidden', !shouldShow);
                const input = field.querySelector('input, select, textarea');
                if (input) {
                    input.required = shouldShow;
                }
            }
        }

        function validateDetailsForm() {
            const form = document.getElementById('newRequestForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return false;
            }
            
            // Store form data
            wizardState.formData = {
                partNumber: document.getElementById('input-partNumber').value,
                workOrder: document.getElementById('input-workOrder').value,
                dieNumber: document.getElementById('input-dieNumber').value,
                scrapType: document.getElementById('input-scrapType').value,
                quantity: document.getElementById('input-quantity').value,
                details: document.getElementById('input-details').value
            };
            
            return true;
        }

        function populateReview() {
            const details = wizardState.requestTypeDetails;
            const formData = wizardState.formData;
            
            document.getElementById('review-category').textContent = wizardState.category;
            document.getElementById('review-type').textContent = details.name;
            document.getElementById('review-timeStandard').textContent = `${details.timeStandard} minutes`;
            
            // Show/hide conditional review fields
            showReviewField('partNumber', formData.partNumber);
            showReviewField('workOrder', formData.workOrder);
            showReviewField('dieNumber', formData.dieNumber);
            showReviewField('scrapType', formData.scrapType);
            showReviewField('quantity', formData.quantity);
            showReviewField('details', formData.details);
            
            // Show special warnings
            document.getElementById('ncmWarning').style.display = details.isNCM ? 'flex' : 'none';
            document.getElementById('safetyWarning').style.display = details.alertPlantManager ? 'flex' : 'none';
        }

        function showReviewField(fieldName, value) {
            const label = document.getElementById(`review-${fieldName}-label`);
            const dd = document.getElementById(`review-${fieldName}`);
            
            if (value) {
                label.classList.remove('hidden');
                dd.classList.remove('hidden');
                dd.textContent = value;
            } else {
                label.classList.add('hidden');
                dd.classList.add('hidden');
            }
        }

        function submitNewRequest() {
            console.log('Submitting request:', {
                category: wizardState.category,
                requestTypeId: wizardState.requestTypeId,
                formData: wizardState.formData,
                press: 'Press 6'
            });
            
            alert('Request submitted successfully!');
            closeNewRequestDialog();
        }

        // Die number change handler - show location
        document.addEventListener('DOMContentLoaded', () => {
            const dieSelect = document.getElementById('input-dieNumber');
            if (dieSelect) {
                dieSelect.addEventListener('change', (e) => {
                    const selectedOption = e.target.selectedOptions[0];
                    const location = selectedOption ? selectedOption.dataset.location : '';
                    const display = document.getElementById('dieLocationDisplay');
                    if (display) {
                        display.innerHTML = location ? `<span class="fluent-icon">&#xE707;</span> Location: ${location}` : '';
                    }
                });
            }
        });

        // Cancel request
        function cancelRequest(id) {
            if (confirm('Are you sure you want to cancel this request?')) {
                console.log('Canceling request:', id);
                alert('Request canceled');
            }
        }

        // Update clock
        function updateClock() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString();
        }

        // Initialize
        window.addEventListener('load', () => {
            populateWaitlist();
            updateClock();
            setInterval(updateClock, 1000);

            // Update status counts
            document.getElementById('completedCount').textContent = '3 completed today';
            document.getElementById('activeCount').textContent = `${MockData.operatorWaitlist.length} active requests`;
        });
    </script>
</body>
</html>
