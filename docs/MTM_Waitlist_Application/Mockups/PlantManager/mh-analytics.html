<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Manager - MH Analytics | MTM Waitlist</title>
    <link rel="stylesheet" href="../Shared/winui3-theme.css">
    <link rel="stylesheet" href="../Shared/styles.css">
</head>
<body>
    <div class="app-shell">
        <nav class="nav-pane">
            <div class="nav-pane-header">
                <h1>MTM Waitlist</h1>
                <div class="subtitle">Plant Manager</div>
                <div class="subtitle" style="margin-top: 4px;">
                    <strong>Nick W.</strong> • Expo Drive
                </div>
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="dashboard.html" class="nav-item-link">
                        <span class="nav-item-icon fluent-icon icon-home"></span>
                        <span class="nav-item-text">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="mh-analytics.html" class="nav-item-link selected">
                        <span class="nav-item-icon fluent-icon">&#xE7C8;</span>
                        <span class="nav-item-text">MH Analytics</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="press-analytics.html" class="nav-item-link">
                        <span class="nav-item-icon fluent-icon">&#xE7EE;</span>
                        <span class="nav-item-text">Press Analytics</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="reports.html" class="nav-item-link">
                        <span class="nav-item-icon fluent-icon">&#xE8A5;</span>
                        <span class="nav-item-text">Reports</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="user-management.html" class="nav-item-link">
                        <span class="nav-item-icon fluent-icon icon-people"></span>
                        <span class="nav-item-text">User Management</span>
                    </a>
                </li>
            </ul>

            <div class="nav-separator"></div>

            <ul class="nav-menu nav-footer">
                <li class="nav-item">
                    <a href="../Login/login.html" class="nav-item-link">
                        <span class="nav-item-icon fluent-icon icon-logout"></span>
                        <span class="nav-item-text">Logout</span>
                    </a>
                </li>
            </ul>
        </nav>

        <div class="content-area">
            <div class="command-bar">
                <div class="command-bar-left">
                    <h2 class="page-title">Material Handling Analytics</h2>
                </div>
                <div class="command-bar-right">
                    <select class="form-select" id="siteFilter" style="width: 150px; margin-right: 12px;" onchange="refreshDashboard()">
                        <option value="Expo">Expo Drive</option>
                        <option value="VITS">VITS Drive</option>
                        <option value="Both">Both Sites</option>
                    </select>
                    <input type="date" class="form-input" id="startDate" style="width: 140px; margin-right: 8px;" />
                    <span style="margin: 0 8px;">to</span>
                    <input type="date" class="form-input" id="endDate" style="width: 140px; margin-right: 12px;" />
                    <button class="btn btn-accent" onclick="refreshDashboard()">
                        <span class="fluent-icon">&#xE72C;</span>
                        Refresh
                    </button>
                </div>
            </div>

            <div class="main-content">
                <!-- KPI Cards -->
                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; margin-bottom: 24px;">
                    <div class="card">
                        <div class="card-content">
                            <div style="font-size: 34px; font-weight: 600; color: var(--accent-default);" id="kpiTotalTasks">-</div>
                            <div style="font-size: 12px; color: var(--text-secondary); text-transform: uppercase; margin-top: 4px;">Total Tasks</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-content">
                            <div style="font-size: 34px; font-weight: 600; color: var(--success-color);" id="kpiCompleted">-</div>
                            <div style="font-size: 12px; color: var(--text-secondary); text-transform: uppercase; margin-top: 4px;">Completed</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-content">
                            <div style="font-size: 34px; font-weight: 600; color: var(--text-secondary);" id="kpiAvgWait">-</div>
                            <div style="font-size: 12px; color: var(--text-secondary); text-transform: uppercase; margin-top: 4px;">Avg Wait (min)</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-content">
                            <div style="font-size: 34px; font-weight: 600; color: var(--warning-color);" id="kpiOverStandard">-</div>
                            <div style="font-size: 12px; color: var(--text-secondary); text-transform: uppercase; margin-top: 4px;">Over Standard</div>
                        </div>
                    </div>
                    <div class="card" style="border-left: 4px solid var(--error-color);">
                        <div class="card-content">
                            <div style="font-size: 34px; font-weight: 600; color: var(--error-color);" id="kpiNcm">-</div>
                            <div style="font-size: 12px; color: var(--text-secondary); text-transform: uppercase; margin-top: 4px;">NCM Tasks</div>
                            <div style="font-size: 11px; color: var(--text-tertiary); margin-top: 2px;">Separate tracking</div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row 1 -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                    <div class="chart-container">
                        <h3>Task Volume by Type</h3>
                        <svg viewBox="0 0 400 250" class="chart-svg">
                            <line x1="50" y1="200" x2="380" y2="200" stroke="var(--divider-stroke)" stroke-width="2"/>
                            <line x1="50" y1="30" x2="50" y2="200" stroke="var(--divider-stroke)" stroke-width="2"/>

                            <rect x="70" y="80" width="60" height="120" fill="var(--task-receiving)" opacity="0.85"/>
                            <text x="100" y="215" text-anchor="middle" font-size="12">Receiving</text>
                            <text x="100" y="70" text-anchor="middle" font-size="14" font-weight="600">12</text>

                            <rect x="150" y="120" width="60" height="80" fill="var(--task-dunnage)" opacity="0.85"/>
                            <text x="180" y="215" text-anchor="middle" font-size="12">Dunnage</text>
                            <text x="180" y="110" text-anchor="middle" font-size="14" font-weight="600">8</text>

                            <rect x="230" y="60" width="60" height="140" fill="var(--task-routing)" opacity="0.85"/>
                            <text x="260" y="215" text-anchor="middle" font-size="12">Routing</text>
                            <text x="260" y="50" text-anchor="middle" font-size="14" font-weight="600">15</text>

                            <rect x="310" y="80" width="60" height="120" fill="var(--task-press)" opacity="0.85"/>
                            <text x="340" y="215" text-anchor="middle" font-size="12">Press</text>
                            <text x="340" y="70" text-anchor="middle" font-size="14" font-weight="600">12</text>

                            <text x="40" y="35" text-anchor="end" font-size="10">20</text>
                            <text x="40" y="100" text-anchor="end" font-size="10">15</text>
                            <text x="40" y="165" text-anchor="end" font-size="10">5</text>
                            <text x="40" y="205" text-anchor="end" font-size="10">0</text>
                        </svg>
                    </div>

                    <div class="chart-container">
                        <h3>Handler Performance (Tasks Completed)</h3>
                        <svg viewBox="0 0 400 250" class="chart-svg">
                            <line x1="50" y1="200" x2="380" y2="200" stroke="var(--divider-stroke)" stroke-width="2"/>
                            <line x1="50" y1="30" x2="50" y2="200" stroke="var(--divider-stroke)" stroke-width="2"/>

                            <rect x="70" y="60" width="60" height="140" fill="var(--accent-default)" opacity="0.85"/>
                            <text x="100" y="215" text-anchor="middle" font-size="11">Tom H.</text>
                            <text x="100" y="50" text-anchor="middle" font-size="14" font-weight="600">14</text>

                            <rect x="150" y="80" width="60" height="120" fill="var(--accent-default)" opacity="0.85"/>
                            <text x="180" y="215" text-anchor="middle" font-size="11">Sarah M.</text>
                            <text x="180" y="70" text-anchor="middle" font-size="14" font-weight="600">12</text>

                            <rect x="230" y="110" width="60" height="90" fill="var(--accent-default)" opacity="0.85"/>
                            <text x="260" y="215" text-anchor="middle" font-size="11">Mike M.</text>
                            <text x="260" y="100" text-anchor="middle" font-size="14" font-weight="600">9</text>

                            <rect x="310" y="90" width="60" height="110" fill="var(--accent-default)" opacity="0.85"/>
                            <text x="340" y="215" text-anchor="middle" font-size="11">Lisa M.</text>
                            <text x="340" y="80" text-anchor="middle" font-size="14" font-weight="600">11</text>

                            <text x="40" y="35" text-anchor="end" font-size="10">15</text>
                            <text x="40" y="135" text-anchor="end" font-size="10">10</text>
                            <text x="40" y="205" text-anchor="end" font-size="10">0</text>
                        </svg>
                    </div>
                </div>

                <!-- Charts Row 2 -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                    <div class="chart-container">
                        <h3>Average Wait Time Trend (Last 7 Days)</h3>
                        <svg viewBox="0 0 400 250" class="chart-svg">
                            <line x1="50" y1="200" x2="380" y2="200" stroke="var(--divider-stroke)" stroke-width="2"/>
                            <line x1="50" y1="30" x2="50" y2="200" stroke="var(--divider-stroke)" stroke-width="2"/>

                            <polyline 
                                points="70,120 110,100 150,130 190,110 230,95 270,105 310,85 350,90"
                                fill="none"
                                stroke="var(--accent-default)"
                                stroke-width="3"
                                stroke-linecap="round"
                                stroke-linejoin="round" />

                            <circle cx="70" cy="120" r="5" fill="var(--accent-default)" />
                            <circle cx="110" cy="100" r="5" fill="var(--accent-default)" />
                            <circle cx="150" cy="130" r="5" fill="var(--accent-default)" />
                            <circle cx="190" cy="110" r="5" fill="var(--accent-default)" />
                            <circle cx="230" cy="95" r="5" fill="var(--accent-default)" />
                            <circle cx="270" cy="105" r="5" fill="var(--accent-default)" />
                            <circle cx="310" cy="85" r="5" fill="var(--accent-default)" />
                            <circle cx="350" cy="90" r="5" fill="var(--accent-default)" />

                            <text x="70" y="220" text-anchor="middle" font-size="10">Mon</text>
                            <text x="150" y="220" text-anchor="middle" font-size="10">Tue</text>
                            <text x="230" y="220" text-anchor="middle" font-size="10">Wed</text>
                            <text x="310" y="220" text-anchor="middle" font-size="10">Thu</text>

                            <text x="40" y="35" text-anchor="end" font-size="10">25</text>
                            <text x="40" y="120" text-anchor="end" font-size="10">15</text>
                            <text x="40" y="205" text-anchor="end" font-size="10">5</text>
                        </svg>
                    </div>

                    <div class="chart-container">
                        <h3>Task Distribution by Zone</h3>
                        <svg viewBox="0 0 400 250" class="chart-svg">
                            <g transform="translate(200, 125)">
                                <path d="M 0,-80 A 80,80 0 0,1 69.3,46.2 L 0,0 Z" fill="var(--task-receiving)" opacity="0.85" />
                                <text x="30" y="-40" text-anchor="middle" font-size="12" fill="#FFFFFF" font-weight="600">30%</text>

                                <path d="M 69.3,46.2 A 80,80 0 0,1 0,80 L 0,0 Z" fill="var(--task-dunnage)" opacity="0.85" />
                                <text x="40" y="35" text-anchor="middle" font-size="12" fill="#FFFFFF" font-weight="600">25%</text>

                                <path d="M 0,80 A 80,80 0 0,1 -69.3,46.2 L 0,0 Z" fill="var(--task-routing)" opacity="0.85" />
                                <text x="-35" y="35" text-anchor="middle" font-size="12" fill="#FFFFFF" font-weight="600">28%</text>

                                <path d="M -69.3,46.2 A 80,80 0 0,1 0,-80 L 0,0 Z" fill="var(--task-press)" opacity="0.85" />
                                <text x="-30" y="-30" text-anchor="middle" font-size="12" fill="#FFFFFF" font-weight="600">17%</text>
                            </g>

                            <g transform="translate(50, 230)">
                                <rect x="0" y="0" width="12" height="12" fill="var(--task-receiving)" opacity="0.85" />
                                <text x="18" y="10" font-size="11">Zone A</text>

                                <rect x="70" y="0" width="12" height="12" fill="var(--task-dunnage)" opacity="0.85" />
                                <text x="88" y="10" font-size="11">Zone B</text>

                                <rect x="140" y="0" width="12" height="12" fill="var(--task-routing)" opacity="0.85" />
                                <text x="158" y="10" font-size="11">Zone C</text>

                                <rect x="210" y="0" width="12" height="12" fill="var(--task-press)" opacity="0.85" />
                                <text x="228" y="10" font-size="11">Zone D</text>
                            </g>
                        </svg>
                    </div>
                </div>

                <!-- Cross-Site Comparison -->
                <div class="chart-container">
                    <h3>Cross-Site Comparison (Expo vs VITS)</h3>
                    <svg viewBox="0 0 700 260" class="chart-svg">
                        <line x1="60" y1="210" x2="660" y2="210" stroke="var(--divider-stroke)" stroke-width="2"/>
                        <line x1="60" y1="30" x2="60" y2="210" stroke="var(--divider-stroke)" stroke-width="2"/>

                        <!-- Expo -->
                        <rect x="120" y="90" width="80" height="120" fill="var(--accent-default)" opacity="0.75" />
                        <text x="160" y="230" text-anchor="middle" font-size="12">Expo</text>
                        <text x="160" y="80" text-anchor="middle" font-size="14" font-weight="600">18.5</text>
                        <text x="160" y="55" text-anchor="middle" font-size="11" fill="var(--text-secondary)">Avg Wait (min)</text>

                        <!-- VITS -->
                        <rect x="280" y="110" width="80" height="100" fill="var(--accent-default)" opacity="0.45" />
                        <text x="320" y="230" text-anchor="middle" font-size="12">VITS</text>
                        <text x="320" y="100" text-anchor="middle" font-size="14" font-weight="600">15.2</text>

                        <!-- Expo tasks -->
                        <rect x="440" y="60" width="80" height="150" fill="var(--success-color)" opacity="0.75" />
                        <text x="480" y="230" text-anchor="middle" font-size="12">Expo</text>
                        <text x="480" y="50" text-anchor="middle" font-size="14" font-weight="600">47</text>
                        <text x="480" y="55" text-anchor="middle" font-size="11" fill="var(--text-secondary)">Total Tasks</text>

                        <!-- VITS tasks -->
                        <rect x="600" y="85" width="80" height="125" fill="var(--success-color)" opacity="0.45" />
                        <text x="640" y="230" text-anchor="middle" font-size="12">VITS</text>
                        <text x="640" y="75" text-anchor="middle" font-size="14" font-weight="600">39</text>

                        <g transform="translate(120, 18)">
                            <rect x="0" y="0" width="12" height="12" fill="var(--accent-default)" opacity="0.75" />
                            <text x="18" y="11" font-size="11">Avg Wait</text>
                            <rect x="120" y="0" width="12" height="12" fill="var(--success-color)" opacity="0.75" />
                            <text x="138" y="11" font-size="11">Total Tasks</text>
                        </g>
                    </svg>
                    <p style="margin-top: 8px; color: var(--text-tertiary); font-size: 12px;">Site filter applies to KPI totals and table below. Comparison is shown for reference.</p>
                </div>

                <!-- Performance Table -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Handler Performance Details</h3>
                    </div>
                    <table class="winui-table">
                        <thead>
                            <tr>
                                <th>HANDLER</th>
                                <th style="width: 120px;">ZONE</th>
                                <th style="width: 140px;">TASKS COMPLETED</th>
                                <th style="width: 140px;">AVG TIME (MIN)</th>
                                <th style="width: 120px;">STATUS</th>
                            </tr>
                        </thead>
                        <tbody id="performanceTableBody">
                            <!-- Populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-indicators">
                <div class="status-item">
                    <span class="fluent-icon">&#xE7C8;</span>
                    <span>MH Analytics</span>
                </div>
                <div class="status-item">
                    <span style="color: var(--error-color);">●</span>
                    <span>NCM separate</span>
                </div>
            </div>
            <div>
                <span id="currentTime"></span>
            </div>
        </div>
    </div>

    <script src="../Shared/mock-data.js"></script>
    <script>
        function populateKpis() {
            const waitlist = Array.isArray(MockData?.materialHandlerWaitlist) ? MockData.materialHandlerWaitlist : [];
            const total = waitlist.filter(i => i.category === 'Material Handler').length;
            const ncm = waitlist.filter(i => i.isNCM).length;

            const todayMetrics = MockData?.analytics?.todayMetrics;
            const completed = todayMetrics?.tasksCompleted ?? 35;
            const avgWait = todayMetrics?.avgWaitTime ?? 18.5;
            const overStandard = todayMetrics?.tasksOverStandard ?? 8;

            document.getElementById('kpiTotalTasks').textContent = total;
            document.getElementById('kpiNcm').textContent = ncm;
            document.getElementById('kpiCompleted').textContent = completed;
            document.getElementById('kpiAvgWait').textContent = avgWait;
            document.getElementById('kpiOverStandard').textContent = overStandard;
        }

        function populatePerformanceTable() {
            const tbody = document.getElementById('performanceTableBody');
            const handlers = Array.isArray(MockData?.analytics?.handlerPerformance) ? MockData.analytics.handlerPerformance : [];

            if (handlers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; color: var(--text-secondary);">No performance data available.</td></tr>';
                return;
            }

            tbody.innerHTML = handlers.map(handler => {
                const avgTime = handler.avgTime ?? 0;
                const badge = avgTime <= 15 ? 'wait-normal' : avgTime <= 20 ? 'wait-warning' : 'wait-critical';

                return `
                    <tr>
                        <td><strong>${handler.name}</strong></td>
                        <td><span class="priority-badge priority-low">${handler.zone}</span></td>
                        <td><strong>${handler.tasksCompleted}</strong></td>
                        <td><span class="priority-badge ${badge}">${avgTime} min</span></td>
                        <td><span class="status-badge priority-low">Active</span></td>
                    </tr>
                `;
            }).join('');
        }

        function refreshDashboard() {
            populateKpis();
            populatePerformanceTable();
        }

        function updateClock() {
            document.getElementById('currentTime').textContent = new Date().toLocaleTimeString();
        }

        window.addEventListener('load', () => {
            updateClock();
            setInterval(updateClock, 1000);

            const today = new Date();
            const weekAgo = new Date(today);
            weekAgo.setDate(weekAgo.getDate() - 7);

            document.getElementById('startDate').value = weekAgo.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];

            refreshDashboard();
        });
    </script>
</body>
</html>
