<Page
    x:Class="MTM_Receiving_Application.Module_Routing.Views.RoutingWizardStep1View"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:MTM_Receiving_Application.Module_Routing.ViewModels"
    xmlns:models="using:MTM_Receiving_Application.Module_Routing.Models"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" 
                   Text="Step 1: PO and Line Selection" 
                   Style="{StaticResource TitleTextBlockStyle}"/>

        <!-- PO Input Section (visible when NOT in OTHER mode) -->
        <StackPanel Grid.Row="1" Spacing="12" 
                    Visibility="{x:Bind ViewModel.IsOtherMode, Mode=OneWay, Converter={StaticResource BoolToInverseVisibilityConverter}}">
            <Grid ColumnSpacing="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0"
                         Header="PO Number"
                         PlaceholderText="Enter PO number"
                         Text="{x:Bind ViewModel.PONumber, Mode=TwoWay}"/>

                <Button Grid.Column="1"
                        Content="Validate PO"
                        Command="{x:Bind ViewModel.ValidatePOCommand}"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Bottom"
                        Style="{StaticResource AccentButtonStyle}"/>

                <Button Grid.Column="2"
                        Content="Switch to OTHER"
                        Command="{x:Bind ViewModel.SwitchToOtherModeCommand}"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Bottom"/>
            </Grid>
        </StackPanel>

        <!-- OTHER Mode Section (visible when in OTHER mode) -->
        <StackPanel Grid.Row="1" Spacing="12"
                    Visibility="{x:Bind ViewModel.IsOtherMode, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
            <TextBlock Text="OTHER Package (Non-PO)" 
                       Style="{StaticResource SubtitleTextBlockStyle}"/>

            <Grid ColumnSpacing="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <ComboBox Grid.Column="0"
                          Header="Reason"
                          PlaceholderText="Select reason"
                          ItemsSource="{x:Bind ViewModel.OtherReasons, Mode=OneWay}"
                          SelectedItem="{x:Bind ViewModel.SelectedOtherReason, Mode=TwoWay}"
                          DisplayMemberPath="Description"
                          HorizontalAlignment="Stretch"/>

                <NumberBox Grid.Column="1"
                           Header="Quantity"
                           Minimum="1"
                           SpinButtonPlacementMode="Inline"
                           Value="{x:Bind ViewModel.OtherQuantity, Mode=TwoWay}"/>
            </Grid>
        </StackPanel>

        <!-- PO Lines DataGrid (visible when NOT in OTHER mode) -->
        <Border Grid.Row="2" 
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Visibility="{x:Bind ViewModel.IsOtherMode, Mode=OneWay, Converter={StaticResource BoolToInverseVisibilityConverter}}">
            <Grid>
                <TextBlock Text="Select a line from the PO"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           Visibility="{x:Bind ViewModel.POLines.Count, Mode=OneWay, Converter={StaticResource IntToInverseVisibilityConverter}}"/>

                <ListView ItemsSource="{x:Bind ViewModel.POLines, Mode=OneWay}"
                          SelectedItem="{x:Bind ViewModel.SelectedPOLine, Mode=TwoWay}"
                          SelectionMode="Single"
                          Visibility="{x:Bind ViewModel.POLines.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}}">
                    <ListView.HeaderTemplate>
                        <DataTemplate>
                            <Grid Padding="8" ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60"/>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="100"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Line" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="1" Text="Part ID" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="2" Text="Description" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="3" Text="Quantity" FontWeight="SemiBold" HorizontalAlignment="Right"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.HeaderTemplate>
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="models:Model_InforVisualPOLine">
                            <Grid Padding="8" ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60"/>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="100"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="{x:Bind LineNumber}"/>
                                <TextBlock Grid.Column="1" Text="{x:Bind PartID}"/>
                                <TextBlock Grid.Column="2" Text="{x:Bind PartDescription}"/>
                                <TextBlock Grid.Column="3" Text="{x:Bind QuantityOrdered}" HorizontalAlignment="Right"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="12">
            <ProgressRing IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                          Width="20" Height="20"/>
            <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                       VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right">
            <Button Content="Next: Select Recipient"
                    Command="{x:Bind ViewModel.ProceedToStep2Command}"
                    Style="{StaticResource AccentButtonStyle}"/>
        </StackPanel>
    </Grid>
</Page>
