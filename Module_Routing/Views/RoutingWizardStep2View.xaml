<Page
    x:Class="MTM_Receiving_Application.Module_Routing.Views.RoutingWizardStep2View"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:MTM_Receiving_Application.Module_Routing.ViewModels"
    xmlns:models="using:MTM_Receiving_Application.Module_Routing.Models"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    Loaded="OnPageLoaded">

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" 
                   Text="Step 2: Recipient Selection" 
                   Style="{StaticResource TitleTextBlockStyle}"/>

        <!-- Quick Add Buttons -->
        <StackPanel Grid.Row="1" Spacing="12">
            <TextBlock Text="Quick Add (Most Used)" 
                       Style="{StaticResource SubtitleTextBlockStyle}"/>

            <Grid ColumnSpacing="8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Quick Add Button 1 -->
                <Button Grid.Column="0"
                        Content="{x:Bind ViewModel.QuickAddRecipients[0].Name, Mode=OneWay}"
                        Command="{x:Bind ViewModel.QuickAddRecipientCommand}"
                        CommandParameter="{x:Bind ViewModel.QuickAddRecipients[0], Mode=OneWay}"
                        HorizontalAlignment="Stretch"
                        Style="{StaticResource AccentButtonStyle}"
                        Visibility="{x:Bind ViewModel.QuickAddRecipients.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=0}"/>

                <!-- Quick Add Button 2 -->
                <Button Grid.Column="1"
                        Content="{x:Bind ViewModel.QuickAddRecipients[1].Name, Mode=OneWay}"
                        Command="{x:Bind ViewModel.QuickAddRecipientCommand}"
                        CommandParameter="{x:Bind ViewModel.QuickAddRecipients[1], Mode=OneWay}"
                        HorizontalAlignment="Stretch"
                        Style="{StaticResource AccentButtonStyle}"
                        Visibility="{x:Bind ViewModel.QuickAddRecipients.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=1}"/>

                <!-- Quick Add Button 3 -->
                <Button Grid.Column="2"
                        Content="{x:Bind ViewModel.QuickAddRecipients[2].Name, Mode=OneWay}"
                        Command="{x:Bind ViewModel.QuickAddRecipientCommand}"
                        CommandParameter="{x:Bind ViewModel.QuickAddRecipients[2], Mode=OneWay}"
                        HorizontalAlignment="Stretch"
                        Style="{StaticResource AccentButtonStyle}"
                        Visibility="{x:Bind ViewModel.QuickAddRecipients.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=2}"/>

                <!-- Quick Add Button 4 -->
                <Button Grid.Column="3"
                        Content="{x:Bind ViewModel.QuickAddRecipients[3].Name, Mode=OneWay}"
                        Command="{x:Bind ViewModel.QuickAddRecipientCommand}"
                        CommandParameter="{x:Bind ViewModel.QuickAddRecipients[3], Mode=OneWay}"
                        HorizontalAlignment="Stretch"
                        Style="{StaticResource AccentButtonStyle}"
                        Visibility="{x:Bind ViewModel.QuickAddRecipients.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=3}"/>

                <!-- Quick Add Button 5 -->
                <Button Grid.Column="4"
                        Content="{x:Bind ViewModel.QuickAddRecipients[4].Name, Mode=OneWay}"
                        Command="{x:Bind ViewModel.QuickAddRecipientCommand}"
                        CommandParameter="{x:Bind ViewModel.QuickAddRecipients[4], Mode=OneWay}"
                        HorizontalAlignment="Stretch"
                        Style="{StaticResource AccentButtonStyle}"
                        Visibility="{x:Bind ViewModel.QuickAddRecipients.Count, Mode=OneWay, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=4}"/>
            </Grid>
        </StackPanel>

        <!-- Search Box -->
        <TextBox Grid.Row="2"
                 Header="Search Recipients"
                 PlaceholderText="Search by name, location, or department"
                 Text="{x:Bind ViewModel.SearchText, Mode=TwoWay}"/>

        <!-- Recipients List -->
        <Border Grid.Row="3" 
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="4">
            <ListView ItemsSource="{x:Bind ViewModel.FilteredRecipients, Mode=OneWay}"
                      SelectedItem="{x:Bind ViewModel.SelectedRecipient, Mode=TwoWay}"
                      SelectionMode="Single">
                <ListView.HeaderTemplate>
                    <DataTemplate>
                        <Grid Padding="8" ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Name" FontWeight="SemiBold"/>
                            <TextBlock Grid.Column="1" Text="Location" FontWeight="SemiBold"/>
                            <TextBlock Grid.Column="2" Text="Department" FontWeight="SemiBold"/>
                        </Grid>
                    </DataTemplate>
                </ListView.HeaderTemplate>
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:Model_RoutingRecipient">
                        <Grid Padding="8" ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="{x:Bind Name}"/>
                            <TextBlock Grid.Column="1" Text="{x:Bind Location}"/>
                            <TextBlock Grid.Column="2" Text="{x:Bind Department}"/>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Border>

        <!-- Status Bar -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" Spacing="12">
            <ProgressRing IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                          Width="20" Height="20"/>
            <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                       VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="5" Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right">
            <Button Content="Back"
                    Command="{x:Bind ViewModel.NavigateBackToStep1Command}"/>
            <Button Content="Next: Review"
                    Command="{x:Bind ViewModel.ProceedToStep3Command}"
                    Style="{StaticResource AccentButtonStyle}"/>
        </StackPanel>
    </Grid>
</Page>
