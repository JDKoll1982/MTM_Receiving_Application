<UserControl
    x:Class="MTM_Receiving_Application.Module_Routing.Views.View_Routing_History"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:MTM_Receiving_Application.Module_Routing.ViewModels"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    mc:Ignorable="d">

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" Text="Routing Label History" Style="{StaticResource TitleTextBlockStyle}"/>

        <!-- Date Range Filter -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="16">
            <CalendarDatePicker Header="Start Date" Date="{x:Bind ViewModel.StartDate, Mode=TwoWay}"/>
            <CalendarDatePicker Header="End Date" Date="{x:Bind ViewModel.EndDate, Mode=TwoWay}"/>
            <Button Content="Load History" Command="{x:Bind ViewModel.LoadHistoryCommand}" VerticalAlignment="Bottom"/>
            <Button Content="Refresh" Command="{x:Bind ViewModel.RefreshHistoryCommand}" VerticalAlignment="Bottom"/>
        </StackPanel>

        <!-- History by Date (Grouped) -->
        <ScrollViewer Grid.Row="2">
            <ItemsRepeater ItemsSource="{x:Bind ViewModel.DateGroups, Mode=OneWay}">
                <ItemsRepeater.ItemTemplate>
                    <DataTemplate x:DataType="viewmodels:DateGroupViewModel">
                        <Expander Header="{x:Bind DateHeader, Mode=OneWay}" 
                                  IsExpanded="{x:Bind IsExpanded, Mode=TwoWay}"
                                  HorizontalAlignment="Stretch"
                                  Margin="0,8">
                            <controls:DataGrid ItemsSource="{x:Bind Labels, Mode=OneWay}"
                                      AutoGenerateColumns="False"
                                      IsReadOnly="True"
                                      AlternatingRowBackground="{ThemeResource CardBackgroundFillColorSecondaryBrush}">
                                <controls:DataGrid.Columns>
                                    <controls:DataGridTextColumn Header="Label #" Binding="{Binding LabelNumber}" Width="80"/>
                                    <controls:DataGridTextColumn Header="Deliver To" Binding="{Binding DeliverTo}" Width="200"/>
                                    <controls:DataGridTextColumn Header="Department" Binding="{Binding Department}" Width="200"/>
                                    <controls:DataGridTextColumn Header="Description" Binding="{Binding PackageDescription}" Width="250"/>
                                    <controls:DataGridTextColumn Header="PO Number" Binding="{Binding PoNumber}" Width="120"/>
                                    <controls:DataGridTextColumn Header="Work Order" Binding="{Binding WorkOrder}" Width="120"/>
                                </controls:DataGrid.Columns>
                            </controls:DataGrid>
                        </Expander>
                    </DataTemplate>
                </ItemsRepeater.ItemTemplate>
            </ItemsRepeater>
        </ScrollViewer>

        <!-- Status Bar -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="8">
            <ProgressRing IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}" Width="20" Height="20"/>
            <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay, FallbackValue='Ready'}"/>
            <TextBlock Text="|" Margin="8,0"/>
            <TextBlock Text="{x:Bind ViewModel.TotalLabelCount, Mode=OneWay, FallbackValue='0'}" FontWeight="SemiBold"/>
            <TextBlock Text="labels in date range"/>
        </StackPanel>
    </Grid>
</UserControl>
