@startuml

title Volvo Dunnage Requisition Module - History Management Workflow

start

:User clicks "View History" from Volvo Main Menu;

note right
  **View_Volvo_History.xaml**
end note

:**History View**
Screen loads with filter controls;

note right
  **Filter Controls:**
  - Start Date: CalendarDatePicker (default: 30 days ago)
  - End Date: CalendarDatePicker (default: today)
  - Status Filter: All | Pending PO | Completed
  - Search: Part Number TextBox
  - [Filter] [Export] [Refresh]
end note

:User optionally adjusts filters;
:User clicks "Filter" button;

:DataGrid displays shipment history;

note right
  **DataGrid Columns:**
  - Date
  - Shipment # (e.g., "04/01/2025 Shipment #1")
  - Part Count
  - PO Number (if completed, blank if pending)
  - Receiver (if completed, blank if pending)
  - Status (Pending PO | Completed)
  - Actions (View | Edit)
  
  **Example Rows:**
  04/01/2025 Shipment #1 | 12 parts | PO-062450 | 134393 | Completed | [View][Edit]
  03/26/2025 Shipment #1 | 10 parts | (blank)   | (blank)| Pending PO| [View][Edit]
  
  **Visual Styling:**
  - Pending PO rows: Yellow background
  - Completed rows: Default/green tint
  - Alternating row colors within status groups
end note

if (User action?) then (View Details)
  :User clicks "View" button on row;
  :Detail flyout opens on right side;
  
  note right
    **Detail Flyout:**
    
    Date: 04/01/2025 Shipment #1
    Employee: 6229
    Status: Completed
    PO: PO-062450
    Receiver: 134393
    
    **Parts Entered:**
    V-EMB-21: 10 skids
    V-EMB-750: 7 skids
    V-EMB-780: 4 skids
    
    **Discrepancies:**
    V-EMB-21: Expected 12, Received 10 (-2)
    Note: "2 skids damaged"
    
    **Requested Lines (sent to purchasing):**
    V-EMB-750: 560 pcs
    V-EMB-21: 500 pcs
    V-EMB-780: 200 pcs
    V-EMB-1: 31 pcs
    ...
    
    [Close]
  end note
  
  :User reviews details;
  :User clicks "Close";
  stop
  
elseif (Edit Record) then
  :User clicks "Edit" button on row;
  :Open edit dialog;
  
  note right
    **Edit Dialog:**
    
    Similar to Receiving module edit:
    - Can modify part counts
    - Can add/remove parts
    - Can update discrepancies
    - Can update PO/Receiver (if completed)
    
    **Warning on save:**
    "This will regenerate labels CSV.\n    Original CSV will be cleared."
  end note
  
  if (User saves changes?) then (yes)
    :Update database records;
    :Recalculate component explosion;
    :Update calculated pieces;
    :Regenerate CSV file if needed;
    :DataGrid refreshes;
    :Success message displays;
    stop
  else (no)
    :Cancel edit;
    stop
  endif
  
elseif (Export to CSV) then
  :User clicks "Export" button;
  :SaveFileDialog appears;
  :User selects location;
  :System generates CSV export;
  
  note right
    **Export CSV Columns:**
    Date, Shipment#, PartNumber, Quantity, 
    PONumber, Receiver, Status
    
    Example:
    04/01/2025,1,V-EMB-750,560,PO-062450,134393,Completed
    04/01/2025,1,V-EMB-21,500,PO-062450,134393,Completed
  end note
  
  :Success message displays;
  stop
  
else (Return to Main)
  :User clicks "Back" button;
  :Navigate to Volvo Main Menu;
  stop
endif

@enduml
