<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dunnage Wizard</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/winui-theme.css">
</head>

<body>
    <div class="wizard-container">
        <!-- InfoBar for status messages -->
        <div id="statusInfoBar" class="infobar infobar-info hidden margin-bottom-lg">
            <span class="infobar-icon">‚ÑπÔ∏è</span>
            <span id="statusMessage">Workflow cleared. Please select a mode.</span>
        </div>

        <!-- Mode Selection Step -->
        <div id="modeSelection" class="wizard-step">
            <div class="center-content">
                <div class="mode-selection-grid" style="gap: 32px;">
                    <!-- Guided Wizard Mode -->
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div class="mode-card" onclick="selectMode('wizard')">
                            <div class="mode-card-icon">üßô</div>
                            <div class="mode-card-title">Guided Wizard</div>
                            <div class="mode-card-description">
                                Step-by-step process for standard receiving workflow.
                            </div>
                        </div>
                        <div class="checkbox" style="justify-content: center;">
                            <input type="checkbox" id="guidedDefault" onchange="setDefaultMode('guided', this.checked)">
                            <label>Set as default mode</label>
                        </div>
                    </div>

                    <!-- Manual Entry Mode -->
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div class="mode-card" onclick="selectMode('manual')">
                            <div class="mode-card-icon">üìù</div>
                            <div class="mode-card-title">Manual Entry</div>
                            <div class="mode-card-description">
                                Customizable grid for bulk data entry and editing.
                            </div>
                        </div>
                        <div class="checkbox" style="justify-content: center;">
                            <input type="checkbox" id="manualDefault" onchange="setDefaultMode('manual', this.checked)">
                            <label>Set as default mode</label>
                        </div>
                    </div>

                    <!-- Edit Mode -->
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div class="mode-card" onclick="selectMode('edit')">
                            <div class="mode-card-icon">‚úèÔ∏è</div>
                            <div class="mode-card-title">Edit Mode</div>
                            <div class="mode-card-description">
                                Edit existing loads without adding new ones.
                            </div>
                        </div>
                        <div class="checkbox" style="justify-content: center;">
                            <input type="checkbox" id="editDefault" onchange="setDefaultMode('edit', this.checked)">
                            <label>Set as default mode</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Type Selection Step -->
        <div id="typeSelection" class="wizard-step hidden">
            <h2 class="subtitle-text margin-bottom-lg">Select Dunnage Type</h2>

            <div class="type-selection-grid" id="typeGrid">
                <!-- Dynamically populated with JavaScript -->
            </div>

            <div class="pagination-controls">
                <button class="button" id="prevPageBtn" onclick="previousPage()" disabled>
                    ‚óÄ Previous
                </button>
                <span class="pagination-info" id="pageInfo">Page 1 of 2</span>
                <button class="button" id="nextPageBtn" onclick="nextPage()">
                    Next ‚ñ∂
                </button>
            </div>

            <div class="text-center margin-top-lg">
                <button class="quick-add-button" onclick="showQuickAddDialog('type')">
                    ‚ûï Add New Type
                </button>
            </div>

            <div class="wizard-navigation">
                <button class="button" onclick="goBack()">‚Üê Back</button>
                <div class="wizard-step-indicator">
                    <div class="step-dot completed"></div>
                    <div class="step-dot active"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                </div>
                <div style="width: 80px;"></div> <!-- Spacer -->
            </div>
        </div>

        <!-- Part Selection Step -->
        <div id="partSelection" class="wizard-step hidden">
            <h2 class="subtitle-text margin-bottom-lg">Select Part</h2>

            <div class="form-container">
                <!-- InfoBar for Inventory Notification -->
                <div id="inventoryInfoBar" class="infobar infobar-info hidden">
                    <span class="infobar-icon">‚ö†Ô∏è</span>
                    <span>This part requires inventory in Visual. Method: <strong id="inventoryMethod">Adjust
                            In</strong></span>
                </div>

                <div class="form-group">
                    <label class="form-label">Part ID</label>
                    <div class="combobox">
                        <select id="partSelect" onchange="handlePartSelection()">
                            <option value="">Select a part...</option>
                            <!-- Dynamically populated based on selected type -->
                        </select>
                    </div>
                </div>

                <!-- Part Details Panel -->
                <div id="partDetailsPanel" class="part-details-panel hidden">
                    <h3 class="body-strong margin-bottom-md">Part Details</h3>
                    <div class="part-detail-row">
                        <span class="part-detail-label">Type:</span>
                        <span class="part-detail-value" id="partType">-</span>
                    </div>
                    <div class="part-detail-row">
                        <span class="part-detail-label">Width:</span>
                        <span class="part-detail-value" id="partWidth">-</span>
                    </div>
                    <div class="part-detail-row">
                        <span class="part-detail-label">Height:</span>
                        <span class="part-detail-value" id="partHeight">-</span>
                    </div>
                    <div class="part-detail-row">
                        <span class="part-detail-label">Depth:</span>
                        <span class="part-detail-value" id="partDepth">-</span>
                    </div>
                    <div class="part-detail-row">
                        <span class="part-detail-label">Inventoried:</span>
                        <span class="part-detail-value" id="partInventoried">-</span>
                    </div>
                </div>

                <div class="text-center margin-top-lg">
                    <button class="quick-add-button" onclick="showQuickAddDialog('part')">
                        ‚ûï Add New Part
                    </button>
                </div>
            </div>

            <div class="wizard-navigation">
                <button class="button" onclick="goBack()">‚Üê Back</button>
                <div class="wizard-step-indicator">
                    <div class="step-dot completed"></div>
                    <div class="step-dot completed"></div>
                    <div class="step-dot active"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                </div>
                <button class="button button-accent" onclick="goNext()" id="partNextBtn" disabled>Next ‚Üí</button>
            </div>
        </div>

        <!-- Quantity Entry Step -->
        <div id="quantityEntry" class="wizard-step hidden">
            <h2 class="subtitle-text margin-bottom-lg">Enter Quantity</h2>

            <div class="form-container">
                <div class="card margin-bottom-lg">
                    <div class="body-text margin-bottom-sm">
                        <strong>Type:</strong> <span id="qtyType">-</span>
                    </div>
                    <div class="body-text">
                        <strong>Part:</strong> <span id="qtyPart">-</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Quantity</label>
                    <input type="number" class="numberbox" id="quantityInput" min="1" value="1"
                        oninput="validateQuantity()">
                    <div id="quantityError" class="text-error caption-text margin-top-sm hidden">
                        Quantity must be greater than 0
                    </div>
                </div>
            </div>

            <div class="wizard-navigation">
                <button class="button" onclick="goBack()">‚Üê Back</button>
                <div class="wizard-step-indicator">
                    <div class="step-dot completed"></div>
                    <div class="step-dot completed"></div>
                    <div class="step-dot completed"></div>
                    <div class="step-dot active"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                </div>
                <button class="button button-accent" onclick="goNext()" id="quantityNextBtn">Next ‚Üí</button>
            </div>
        </div>

        <!-- Details Entry Step -->
        <div id="detailsEntry" class="wizard-step hidden">
            <h2 class="subtitle-text margin-bottom-lg">Enter Details</h2>

            <div class="form-container">
                <!-- InfoBar for Inventory Notification (dynamic) -->
                <div id="detailsInfoBar" class="infobar infobar-info hidden">
                    <span class="infobar-icon">‚ö†Ô∏è</span>
                    <span>This part requires inventory in Visual. Method: <strong id="detailsInventoryMethod">Adjust
                            In</strong></span>
                </div>

                <div class="form-group">
                    <label class="form-label">PO Number (Optional)</label>
                    <input type="text" class="textbox" id="poNumberInput" placeholder="Enter PO number..."
                        oninput="handlePOChange()">
                </div>

                <div class="form-group">
                    <label class="form-label">Location (Optional)</label>
                    <input type="text" class="textbox" id="locationInput" placeholder="Enter location...">
                </div>

                <!-- Dynamic Spec Inputs -->
                <div class="spec-inputs-container">
                    <h3 class="spec-inputs-title">Specifications</h3>
                    <div class="spec-input-group" id="specInputsContainer">
                        <!-- Dynamically generated based on type specs -->
                    </div>
                </div>
            </div>

            <div class="wizard-navigation">
                <button class="button" onclick="goBack()">‚Üê Back</button>
                <div class="wizard-step-indicator">
                    <div class="step-dot completed"></div>
                    <div class="step-dot completed"></div>
                    <div class="step-dot completed"></div>
                    <div class="step-dot completed"></div>
                    <div class="step-dot active"></div>
                    <div class="step-dot"></div>
                </div>
                <button class="button button-accent" onclick="goNext()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Review & Save Step -->
        <div id="reviewSave" class="wizard-step hidden">
            <h2 class="subtitle-text margin-bottom-lg">Review & Save</h2>

            <div class="review-container">
                <div class="review-actions">
                    <button class="button" onclick="addAnother()">‚ûï Add Another</button>
                    <div>
                        <button class="button" onclick="cancelSession()">Cancel</button>
                        <button class="button button-accent" onclick="saveAll()">üíæ Save All</button>
                    </div>
                </div>

                <table class="datagrid">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Type</th>
                            <th>Part ID</th>
                            <th>Quantity</th>
                            <th>PO Number</th>
                            <th>Location</th>
                            <th>Method</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="reviewTableBody">
                        <!-- Dynamically populated with session loads -->
                    </tbody>
                </table>

                <div class="infobar infobar-info margin-top-lg">
                    <span class="infobar-icon">‚ÑπÔ∏è</span>
                    <span><strong id="loadCount">0</strong> load(s) ready to save</span>
                </div>
            </div>

            <div class="wizard-navigation">
                <button class="button" onclick="goBack()">‚Üê Back</button>
                <div class="wizard-step-indicator">
                    <div class="step-dot completed"></div>
                    <div class="step-dot completed"></div>
                    <div class="step-dot completed"></div>
                    <div class="step-dot completed"></div>
                    <div class="step-dot completed"></div>
                    <div class="step-dot active"></div>
                </div>
                <div style="width: 80px;"></div> <!-- Spacer -->
            </div>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="wizard-step hidden">
            <div class="center-content">
                <div style="font-size: 64px; color: var(--success); margin-bottom: var(--spacing-lg);">‚úÖ</div>
                <h2 class="title-text margin-bottom-md">Success!</h2>
                <p class="body-text text-secondary margin-bottom-xl">
                    <span id="savedCount">0</span> loads saved successfully and exported to CSV.
                </p>
                <button class="button button-accent button-large" onclick="resetWizard()">
                    Start New Session
                </button>
            </div>
        </div>
    </div>

    <script src="../js/wizard-data.js"></script>
    <script src="../js/wizard.js"></script>
</body>

</html>