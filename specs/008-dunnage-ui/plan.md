# Implementation Plan: Dunnage Wizard Workflow UI

**Branch**: `008-dunnage-ui` | **Date**: December 27, 2025 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/008-dunnage-ui/spec.md`

**Note**: This plan was generated by the `/speckit.plan` command following Speckit methodology.

## Summary

Create a complete wizard workflow UI for guided dunnage receiving in the MTM Receiving Application. Implements strict MVVM pattern with compile-time bindings (`x:Bind`). Each workflow step (Mode Selection → Type Selection → Part Selection → Quantity Entry → Details Entry → Review & Save) is a separate UserControl with dedicated ViewModel, coordinated by a main orchestrator (DunnageWorkflowViewModel). Includes three modes: Guided Wizard, Manual Entry (bulk grid), and Edit Mode (historical data). Features dynamic spec input generation based on type schemas, inventory notification for Visual-tracked parts, pagination for type selection, and default mode preferences for efficiency.

## Technical Context

**Language/Version**: C# 12, .NET 8.0
**Primary Dependencies**: WinUI 3 (Windows App SDK 1.8+), CommunityToolkit.Mvvm 8.2+, CommunityToolkit.WinUI.UI.Controls 7.1+
**Storage**: MySQL 8.0+ (mtm_receiving_application) for wizard data; SQL Server (Infor Visual MTMFG) READ-ONLY for part/PO validation
**Testing**: xUnit with Moq for ViewModels/Services; manual UI testing for Views
**Target Platform**: Windows 10 1809+ / Windows 11 (x64)
**Project Type**: Desktop WinUI 3 application (existing multi-project solution)
**Performance Goals**: <500ms for database operations, <2 seconds for type/part list loading, 60fps UI responsiveness
**Constraints**: MySQL 5.7.24 compatibility (NO JSON functions, CTEs, window functions); Infor Visual READ-ONLY (ApplicationIntent=ReadOnly); strict MVVM separation (no ViewModel→DAO)
**Scale/Scope**: 15 new XAML files (6 wizard steps × 2 files + 3 mode views), 15 ViewModels, ~3,000 LOC, integration with existing IService_DunnageWorkflow, IService_MySQL_Dunnage, IService_DunnageCSVWriter services

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

Verify alignment with [MTM Receiving Application Constitution](../../.specify/memory/constitution.md) v1.2.1.

### Core Principles Alignment

- [x] **I. MVVM Architecture**: Plan separates ViewModels (15 total), Views (XAML only), Models, and Services with strict layer separation
- [x] **II. Database Layer**: All services use Model_Dao_Result pattern from existing DAOs, MySQL stored procedures only, async operations
- [x] **III. Dependency Injection**: All new ViewModels registered as Transient in App.xaml.cs, inject existing services (IService_DunnageWorkflow, IService_MySQL_Dunnage, IService_DunnageCSVWriter, IService_UserPreferences, IService_ErrorHandler, ILoggingService)
- [x] **IV. Error Handling & Logging**: All ViewModels use IService_ErrorHandler for user-facing errors, ILoggingService for audit trail
- [x] **V. Security & Authentication**: Uses existing session management, no new authentication requirements
- [x] **VI. WinUI 3 Modern Practices**: All views use x:Bind (compile-time binding), ObservableCollection, CommunityToolkit.Mvvm ([ObservableProperty], [RelayCommand], partial classes), async/await
- [x] **VII. Specification-Driven**: This plan follows Speckit workflow with spec.md → plan.md → research.md → data-model.md → contracts → tasks.md

### Technology Constraints

- [x] **Platform**: Windows 10/11, .NET 8.0, WinUI 3 (Windows App SDK 1.8+) - matches existing platform
- [x] **Database**: MySQL for wizard session data (uses existing `mtm_receiving_application` database), SQL Server for Infor Visual part/PO lookup (READ ONLY)
- [x] **MySQL 5.7.24 Compatible**: NO new database schema changes required - uses existing tables from 007-architecture-compliance
- [x] **Required Packages**: CommunityToolkit.Mvvm 8.2+, MySql.Data 9.0+, Microsoft.Data.SqlClient 5.2+ - already installed

### Critical Constraints

- [x] **Infor Visual READ ONLY**: Feature queries Infor Visual for part/PO data via existing Dao_InforVisualPart, Dao_InforVisualPO:
  - [x] Connection uses ApplicationIntent=ReadOnly (enforced in existing DAO constructors)
  - [x] Only SELECT queries via stored procedures (existing pattern)
  - [x] No INSERT, UPDATE, DELETE, or DDL operations (READ-ONLY enforced)
  - [x] Graceful handling of connection failures (existing DAOs implement fallback logic)
- [x] **Forbidden Practices**: 
  - [x] No direct SQL (uses existing DAOs via Services)
  - [x] No DAO exceptions (all return Model_Dao_Result)
  - [x] No logic in code-behind (ViewModels only have `InitializeComponent()`)
  - [x] No service locator (constructor injection via DI)
  - [x] No ViewModel→DAO violations (all access flows through Services)

### Justification for Violations

**No violations of constitutional principles.** This feature strictly adheres to all established patterns from the Receiving workflow UI (matching reference implementation).

## Project Structure

### Documentation (this feature)

```text
specs/008-dunnage-ui/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output - technical decisions on pagination, dynamic controls, etc.
├── data-model.md        # Phase 1 output - No new database schema (uses existing from 007)
├── quickstart.md        # Phase 1 output - Developer setup and build instructions
├── contracts/           # Phase 1 output - ViewModel command/property contracts for consistency
└── mockups/             # HTML/CSS/JS visual design reference (existing)
    ├── index.html
    ├── pages/
    ├── css/
    └── js/
```

### Source Code (repository root)

```text
MTM_Receiving_Application/
├── Views/
│   ├── Main/                              # Main navigation pages (EXISTING FOLDER)
│   │   └── Main_DunnageLabelPage.xaml     # ✅ ALREADY EXISTS - Main orchestrator page
│   │       Main_DunnageLabelPage.xaml.cs  # ✅ ALREADY EXISTS - Code-behind
│   └── Dunnage/                           # Dunnage workflow step views (EMPTY FOLDER)
│       ├── Dunnage_ModeSelectionView.xaml          # NEW - Mode selection cards
│       ├── Dunnage_ModeSelectionView.xaml.cs       # NEW
│       ├── Dunnage_TypeSelectionView.xaml          # NEW - Type grid with pagination
│       ├── Dunnage_TypeSelectionView.xaml.cs       # NEW
│       ├── Dunnage_PartSelectionView.xaml          # NEW - Part dropdown + inventory notification
│       ├── Dunnage_PartSelectionView.xaml.cs       # NEW
│       ├── Dunnage_QuantityEntryView.xaml          # NEW - Quantity NumberBox
│       ├── Dunnage_QuantityEntryView.xaml.cs       # NEW
│       ├── Dunnage_DetailsEntryView.xaml           # NEW - PO, Location, dynamic spec inputs
│       ├── Dunnage_DetailsEntryView.xaml.cs        # NEW
│       ├── Dunnage_ReviewView.xaml                 # NEW - DataGrid + Save/Add Another
│       ├── Dunnage_ReviewView.xaml.cs              # NEW
│       ├── Dunnage_ManualEntryView.xaml            # NEW - Grid-based bulk entry mode
│       ├── Dunnage_ManualEntryView.xaml.cs         # NEW
│       ├── Dunnage_EditModeView.xaml               # NEW - Historical data editing mode
│       └── Dunnage_EditModeView.xaml.cs            # NEW
├── ViewModels/
│   ├── Main/                              # Main page ViewModels (EXISTING FOLDER)
│   │   └── Main_DunnageLabelViewModel.cs  # ✅ ALREADY EXISTS - Orchestrator ViewModel
│   └── Dunnage/                           # Dunnage step ViewModels (EMPTY FOLDER)
│       ├── Dunnage_ModeSelectionViewModel.cs       # NEW
│       ├── Dunnage_TypeSelectionViewModel.cs       # NEW
│       ├── Dunnage_PartSelectionViewModel.cs       # NEW
│       ├── Dunnage_QuantityEntryViewModel.cs       # NEW
│       ├── Dunnage_DetailsEntryViewModel.cs        # NEW
│       ├── Dunnage_ReviewViewModel.cs              # NEW
│       ├── Dunnage_ManualEntryViewModel.cs         # NEW
│       └── Dunnage_EditModeViewModel.cs            # NEW
├── Services/                              # ✅ ALL ALREADY EXIST (NO NEW FILES)
│   ├── Database/
│   │   └── Service_MySQL_Dunnage.cs       # ✅ ALREADY EXISTS (database operations)
│   └── Receiving/
│       ├── Service_DunnageWorkflow.cs     # ✅ ALREADY EXISTS (session management)
│       └── Service_DunnageCSVWriter.cs    # ✅ ALREADY EXISTS (CSV export)
├── Data/                                  # ✅ ALL ALREADY EXIST (NO NEW FILES)
│   └── Dunnage/
│       ├── Dao_DunnageType.cs             # ✅ ALREADY EXISTS
│       ├── Dao_DunnagePart.cs             # ✅ ALREADY EXISTS
│       └── Dao_DunnageLoad.cs             # ✅ ALREADY EXISTS
├── Models/                                # ✅ ALL ALREADY EXIST (NO NEW FILES)
│   └── Dunnage/
│       ├── Model_DunnageType.cs           # ✅ ALREADY EXISTS
│       ├── Model_DunnagePart.cs           # ✅ ALREADY EXISTS
│       └── Model_DunnageLoad.cs           # ✅ ALREADY EXISTS
└── App.xaml.cs                            # MODIFY - DI registration for new ViewModels

MTM_Receiving_Application.Tests/
└── Unit/
    └── ViewModels/
        └── Dunnage/                       # NEW FOLDER - Unit tests for new ViewModels
            ├── Dunnage_ModeSelectionViewModel_Tests.cs        # NEW
            ├── Dunnage_TypeSelectionViewModel_Tests.cs        # NEW
            ├── Dunnage_PartSelectionViewModel_Tests.cs        # NEW
            ├── Dunnage_QuantityEntryViewModel_Tests.cs        # NEW
            ├── Dunnage_DetailsEntryViewModel_Tests.cs         # NEW
            ├── Dunnage_ReviewViewModel_Tests.cs               # NEW
            ├── Dunnage_ManualEntryViewModel_Tests.cs          # NEW
            └── Dunnage_EditModeViewModel_Tests.cs             # NEW
```

**Structure Decision**: This is an extension of an existing desktop WinUI 3 application following established naming conventions:
- **Main pages** in `Views/Main/` with prefix `Main_` (e.g., `Main_DunnageLabelPage.xaml`) - orchestrator already exists
- **Step views** in `Views/Dunnage/` with prefix `Dunnage_` (e.g., `Dunnage_ModeSelectionView.xaml`) - folder exists but is empty
- **Main ViewModels** in `ViewModels/Main/` with prefix `Main_` - orchestrator already exists  
- **Step ViewModels** in `ViewModels/Dunnage/` with prefix `Dunnage_` - folder exists but is empty
- Matches existing pattern from Receiving workflow: `Receiving_ModeSelectionView.xaml` in `Views/Receiving/`

Services, DAOs, and Models already exist from feature `007-architecture-compliance` and will be reused without modification.

**File Count**: 
- **New files**: 30 (15 XAML views + 15 C# ViewModels in Views/Dunnage and ViewModels/Dunnage folders)
- **Existing files (no changes)**: 2 (Main_DunnageLabelPage.xaml, Main_DunnageLabelViewModel.cs)
- **Modified files**: 1 (App.xaml.cs for DI registration of 8 new ViewModels)
- **Existing files reused**: 9 (3 Services + 3 DAOs + 3 Models)
- **Test files**: 8 new unit test classes in MTM_Receiving_Application.Tests/Unit/ViewModels/Dunnage/

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| [e.g., 4th project] | [current need] | [why 3 projects insufficient] |
| [e.g., Repository pattern] | [specific problem] | [why direct DB access insufficient] |
