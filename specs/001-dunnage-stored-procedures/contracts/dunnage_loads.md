# Stored Procedure Contracts: Dunnage Loads

**Table**: `dunnage_loads`  
**Purpose**: Transaction records of received dunnage  
**Procedures**: 7 total

---

## sp_dunnage_loads_get_all

**Purpose**: Retrieve all load transaction records with part/type info

**Parameters**: None

**Returns**: Result set with all dunnage_loads joined with part and type info

**Result Columns**:
- `load_uuid` (CHAR(36)) - PK
- `part_id` (VARCHAR) - FK to parts
- `part_name` (VARCHAR) - From parts.part_id
- `type_name` (VARCHAR) - From types.type_name
- `quantity` (DECIMAL)
- `received_date` (DATETIME)
- `created_by` (VARCHAR)
- `created_date` (DATETIME)
- `modified_by` (VARCHAR)
- `modified_date` (DATETIME)

---

## sp_dunnage_loads_get_by_date_range

**Purpose**: Filter loads by received date range (reporting)

**Parameters**:
- `p_start_date` (DATETIME, IN): Start of range (inclusive)
- `p_end_date` (DATETIME, IN): End of range (inclusive)

**Returns**: Result set with loads in date range

**Result Columns**: Same as sp_dunnage_loads_get_all

**Note**: Useful for daily/weekly/monthly receiving reports.

---

## sp_dunnage_loads_get_by_id

**Purpose**: Retrieve specific load by UUID

**Parameters**:
- `p_load_uuid` (CHAR(36), IN): Load UUID to retrieve

**Returns**: Single load record or empty set

**Result Columns**: Same as sp_dunnage_loads_get_all

---

## sp_dunnage_loads_insert

**Purpose**: Record a single dunnage receiving transaction

**Parameters**:
- `p_load_uuid` (CHAR(36), IN): UUID generated by application (GUID)
- `p_part_id` (VARCHAR(50), IN): Part being received
- `p_quantity` (DECIMAL(10,2), IN): Quantity received (> 0)
- `p_user` (VARCHAR(50), IN): Employee number

**Returns**: None (use p_load_uuid to retrieve created record)

**Error Conditions**:
- Part ID does not exist (FK violation)
- Quantity <= 0 (validation check)
- Duplicate UUID (should never happen with proper GUID generation)

**Example Usage**:
```sql
CALL sp_dunnage_loads_insert(
    '550e8400-e29b-41d4-a716-446655440000',
    'PALLET-48X40-WOOD',
    25.00,
    'EMP001'
);
```

---

## sp_dunnage_loads_insert_batch

**Purpose**: Record multiple loads in single transaction (performance)

**Parameters**:
- `p_load_data` (JSON, IN): JSON array of load objects
- `p_user` (VARCHAR(50), IN): Employee number

**JSON Structure**:
```json
[
  {
    "load_uuid": "uuid-string",
    "part_id": "PART-001",
    "quantity": 10.00
  },
  {
    "load_uuid": "uuid-string-2",
    "part_id": "PART-002",
    "quantity": 25.50
  }
]
```

**Returns**: Count of loads inserted

**Error Conditions**:
- Any load fails validation â†’ entire batch rolls back (all-or-nothing)
- Invalid JSON format
- Missing required fields in JSON objects

**Implementation**: Uses cursor to iterate JSON array, inserts in transaction.

---

## sp_dunnage_loads_update

**Purpose**: Correct a load record (quantity errors)

**Parameters**:
- `p_load_uuid` (CHAR(36), IN): Load UUID to update
- `p_quantity` (DECIMAL(10,2), IN): Corrected quantity
- `p_user` (VARCHAR(50), IN): Employee number making correction

**Returns**: Affected rows count

**Error Conditions**:
- Load UUID not found
- Quantity <= 0

**Note**: Only quantity is updatable. Cannot change part_id or received_date.

---

## sp_dunnage_loads_delete

**Purpose**: Permanently remove a load record (hard delete)

**Parameters**:
- `p_load_uuid` (CHAR(36), IN): Load UUID to delete

**Returns**: Affected rows count

**Note**: No foreign key restrictions on loads - can be deleted freely. Use with caution as this is permanent (no soft delete).

---

## DAO Mapping

```csharp
// Static class: Dao_DunnageLoad
public static async Task<Model_Dao_Result<List<Model_DunnageLoad>>> GetAllAsync()
public static async Task<Model_Dao_Result<List<Model_DunnageLoad>>> GetByDateRangeAsync(DateTime startDate, DateTime endDate)
public static async Task<Model_Dao_Result<Model_DunnageLoad>> GetByIdAsync(string loadUuid)
public static async Task<Model_Dao_Result> InsertAsync(string loadUuid, string partId, decimal quantity, string user)
public static async Task<Model_Dao_Result<int>> InsertBatchAsync(string loadDataJson, string user)
public static async Task<Model_Dao_Result> UpdateAsync(string loadUuid, decimal quantity, string user)
public static async Task<Model_Dao_Result> DeleteAsync(string loadUuid)
```
