<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTM Waitlist - Login</title>
    <link rel="stylesheet" href="../Shared/winui3-theme.css">
    <link rel="stylesheet" href="../Shared/styles.css">
    <style>
        /* Login-specific styles */
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #0078D4 0%, #004578 100%);
        }

        .login-container {
            background-color: var(--card-background);
            border-radius: var(--corner-radius-large);
            box-shadow: var(--shadow-dialog);
            padding: var(--spacing-xxl);
            width: 100%;
            max-width: 450px;
            text-align: center;
        }

        .logo-container {
            margin-bottom: var(--spacing-xxl);
        }

        .logo-text {
            font-size: var(--font-size-display);
            font-weight: var(--font-weight-semibold);
            color: var(--accent-default);
            margin-bottom: var(--spacing-xs);
        }

        .logo-subtitle {
            font-size: var(--font-size-body);
            color: var(--text-secondary);
        }

        .login-form {
            text-align: left;
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .badge-icon {
            font-size: 48px;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-md);
        }

        .remember-me {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
        }

        .remember-me input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .btn-login {
            width: 100%;
            padding: var(--spacing-md);
            font-size: var(--font-size-subtitle);
            margin-top: var(--spacing-lg);
        }

        .login-footer {
            margin-top: var(--spacing-xxl);
            padding-top: var(--spacing-lg);
            border-top: 1px solid var(--divider-stroke);
            font-size: var(--font-size-caption);
            color: var(--text-tertiary);
        }

        .role-selection {
            margin-top: var(--spacing-lg);
            padding: var(--spacing-md);
            background-color: var(--background-tertiary);
            border-radius: var(--corner-radius-small);
        }

        .role-selection h4 {
            font-size: var(--font-size-body);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--spacing-sm);
        }
    </style>
</head>
<body>
    <!-- WinUI3 Equivalent: ContentDialog -->
    <div class="login-container">
        <!-- Logo/Branding -->
        <div class="logo-container">
            <div class="logo-text">MTM Waitlist</div>
            <div class="logo-subtitle">Manufacturing Task Management</div>
            <div class="badge-icon fluent-icon icon-people"></div>
        </div>

        <!-- Login Form -->
        <form class="login-form" id="loginForm" onsubmit="handleLogin(event)">
            <!-- Badge ID Input -->
            <div class="form-group">
                <label class="form-label" for="badgeId">Badge ID</label>
                <input 
                    type="text" 
                    id="badgeId" 
                    class="form-input" 
                    placeholder="Scan badge or enter ID"
                    required
                    autofocus
                    value="MTM001"
                />
                <small style="color: var(--text-tertiary); display: block; margin-top: var(--spacing-xs);">
                    Scan your badge with barcode scanner or type manually
                </small>
            </div>

            <!-- PIN Input -->
            <div class="form-group">
                <label class="form-label" for="pin">PIN</label>
                <input 
                    type="password" 
                    id="pin" 
                    class="form-input" 
                    placeholder="Enter 4-digit PIN"
                    required
                    maxlength="4"
                    pattern="[0-9]{4}"
                    value="1234"
                />
            </div>

            <!-- Remember Me Checkbox -->
            <div class="remember-me">
                <input type="checkbox" id="rememberMe" />
                <label for="rememberMe" style="cursor: pointer; user-select: none;">
                    Remember me on this device
                </label>
            </div>

            <!-- Role Selection (Auto-detected, but can override) -->
            <div class="role-selection">
                <h4>Select Role (Optional)</h4>
                <select class="form-select" id="roleSelect">
                    <option value="auto">Auto-Detect from Badge</option>
                    <option value="Operator">Press Operator</option>
                    <option value="MaterialHandler">Material Handler</option>
                    <option value="MaterialHandlerLead">Material Handler Lead</option>
                    <option value="SetupTechnician">Setup Technician</option>
                    <option value="OperatorLead">Operator Lead</option>
                    <option value="Quality">Quality Control</option>
                    <option value="PlantManager">Plant Manager</option>
                </select>
                <small style="color: var(--text-tertiary); display: block; margin-top: var(--spacing-xs);">
                    Role is automatically determined by badge. Override only if needed.
                </small>
            </div>

            <!-- Login Button -->
            <!-- WinUI3 Equivalent: Button (AccentButtonStyle) -->
            <button type="submit" class="btn btn-accent btn-login">
                <span class="fluent-icon icon-checkmark"></span>
                Sign In
            </button>
        </form>

        <!-- Footer -->
        <div class="login-footer">
            MTM, LLC © 2026 | Version 1.0.0<br>
            For support, contact IT: <a href="mailto:support@mtm.com" style="color: var(--accent-default);">support@mtm.com</a>
        </div>
    </div>

    <!-- InfoBar for error messages -->
    <div id="errorBar" class="info-bar info-bar-error hidden" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); max-width: 500px; z-index: 3000;">
        <span class="info-bar-icon fluent-icon icon-alert"></span>
        <div class="info-bar-content">
            <div class="info-bar-title">Login Failed</div>
            <div class="info-bar-message" id="errorMessage"></div>
        </div>
    </div>

    <script src="../Shared/mock-data.js"></script>
    <script>
        function handleLogin(event) {
            event.preventDefault();
            
            const badgeId = document.getElementById('badgeId').value;
            const pin = document.getElementById('pin').value;
            const role = document.getElementById('roleSelect').value;
            const rememberMe = document.getElementById('rememberMe').checked;

            // Mock authentication
            if (pin.length !== 4) {
                showError("PIN must be exactly 4 digits");
                return;
            }

            // Simulate successful login
            // In real app, this would call authentication service
            console.log("Login attempt:", { badgeId, pin: "****", role, rememberMe });

            // Store session info
            sessionStorage.setItem('currentUser', JSON.stringify({
                badgeId,
                role: role === 'auto' ? determineRoleFromBadge(badgeId) : role,
                loginTime: new Date().toISOString()
            }));

            // Redirect based on role
            const userRole = role === 'auto' ? determineRoleFromBadge(badgeId) : role;
            redirectToModule(userRole);
        }

        function determineRoleFromBadge(badgeId) {
            // Mock role determination
            // In real app, this would query user_accounts table
            if (badgeId.includes('LEAD')) return 'OperatorLead';
            if (badgeId.includes('MH')) return 'MaterialHandler';
            if (badgeId.includes('QC')) return 'Quality';
            if (badgeId.includes('MGR')) return 'PlantManager';
            return 'Operator'; // Default
        }

        function redirectToModule(role) {
            const routes = {
                'Operator': '../Operator/waitlist.html',
                'MaterialHandler': '../MaterialHandler/waitlist.html',
                'MaterialHandlerLead': '../MaterialHandlerLead/waitlist.html',
                'OperatorLead': '../OperatorLead/waitlist.html',
                'Quality': '../Operator/waitlist.html', // Quality uses same base UI
                'PlantManager': '../PlantManager/dashboard.html'
            };

            const destination = routes[role] || routes['Operator'];
            
            // Simulate navigation delay
            setTimeout(() => {
                window.location.href = destination;
            }, 500);
        }

        function showError(message) {
            const errorBar = document.getElementById('errorBar');
            const errorMessage = document.getElementById('errorMessage');
            
            errorMessage.textContent = message;
            errorBar.classList.remove('hidden');

            // Auto-hide after 5 seconds
            setTimeout(() => {
                errorBar.classList.add('hidden');
            }, 5000);
        }

        // Auto-focus badge input on load
        window.addEventListener('load', () => {
            document.getElementById('badgeId').focus();
        });

        // Simulate barcode scanner (keyboard wedge)
        let barcodeBuffer = '';
        let barcodeTimeout;

        document.addEventListener('keydown', (event) => {
            // Barcode scanners typically send data fast and end with Enter
            if (event.key === 'Enter' && barcodeBuffer.length > 0) {
                document.getElementById('badgeId').value = barcodeBuffer;
                document.getElementById('pin').focus();
                barcodeBuffer = '';
            } else if (event.key.length === 1) {
                barcodeBuffer += event.key;
                
                // Clear buffer after 100ms (barcode scanners are faster)
                clearTimeout(barcodeTimeout);
                barcodeTimeout = setTimeout(() => {
                    barcodeBuffer = '';
                }, 100);
            }
        });
    </script>
</body>
</html>
