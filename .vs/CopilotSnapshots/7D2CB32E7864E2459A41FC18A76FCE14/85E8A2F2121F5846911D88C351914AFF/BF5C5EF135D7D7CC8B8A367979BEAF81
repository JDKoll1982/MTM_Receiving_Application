using MTM_Receiving_Application.Module_Core.Converters;

namespace MTM_Receiving_Application.Tests.Module_Core.Converters;

/// <summary>
/// Unit tests for <see cref="Converter_DoubleToDecimal"/>.
/// Tests bidirectional conversion between decimal and double types.
/// </summary>
[Trait("Category", "Unit")]
[Trait("Type", "Converter")]
public class Converter_DoubleToDecimal_Tests
{
    private readonly Converter_DoubleToDecimal _sut;

    public Converter_DoubleToDecimal_Tests()
    {
        _sut = new();
    }

    [Theory]
    [InlineData(0.0, 0.0)]
    [InlineData(42.5, 42.5)]
    [InlineData(100.0, 100.0)]
    [InlineData(1234.56789, 1234.56789)]
    [InlineData(-50.25, -50.25)]
    public void Convert_WithDecimalValue_ReturnsDouble(decimal input, double expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(double), null, "en-US");

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(null)]
    [InlineData("text")]
    [InlineData(42)]
    public void Convert_WithNonDecimalValue_ReturnsZeroDouble(object? input)
    {
        // Act
        var result = _sut.Convert(input, typeof(double), null, "en-US");

        // Assert
        result.Should().Be(0.0);
    }

    [Theory]
    [InlineData(0.0, 0.0)]
    [InlineData(42.5, 42.5)]
    [InlineData(100.0, 100.0)]
    [InlineData(1234.56789, 1234.56789)]
    [InlineData(-50.25, -50.25)]
    public void ConvertBack_WithDoubleValue_ReturnsDecimal(double input, decimal expected)
    {
        // Act
        var result = _sut.ConvertBack(input, typeof(decimal), null, "en-US");

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(null)]
    [InlineData("text")]
    [InlineData(42)]
    public void ConvertBack_WithNonDoubleValue_ReturnsZeroDecimal(object? input)
    {
        // Act
        var result = _sut.ConvertBack(input, typeof(decimal), null, "en-US");

        // Assert
        result.Should().Be(0m);
    }

    [Fact]
    public void Convert_RoundTrip_PreservesValue()
    {
        // Arrange
        var originalValue = 1234.56789m;

        // Act - Convert to double
        var doubleResult = _sut.Convert(originalValue, typeof(double), null, "en-US");

        // Act - Convert back to decimal
        var decimalResult = _sut.ConvertBack(doubleResult, typeof(decimal), null, "en-US");

        // Assert
        decimalResult.Should().Be(originalValue);
    }

    [Theory]
    [InlineData(double.MaxValue)]
    [InlineData(double.MinValue)]
    public void Convert_WithExtremeDoubleValues_HandlesGracefully(double input)
    {
        // Arrange
        var decimalInput = (decimal)input;

        // Act
        var result = _sut.Convert(decimalInput, typeof(double), null, "en-US");

        // Assert - Should not throw
        result.Should().BeOfType<double>();
    }
}
