using FluentAssertions;
using MTM_Receiving_Application.Module_Core.Converters;
using Xunit;

namespace MTM_Receiving_Application.Tests.Module_Core.Converters;

/// <summary>
/// Unit tests for <see cref="Converter_IconCodeToGlyph"/>.
/// Tests conversion of icon codes (HTML entity or hex format) to Unicode glyph characters.
/// Supports formats: "&#xE7B8;" (HTML entity) or "E7B8" (raw hex)
/// </summary>
[Trait("Category", "Unit")]
[Trait("Type", "Converter")]
public class Converter_IconCodeToGlyph_Tests
{
    private readonly Converter_IconCodeToGlyph _sut;

    public Converter_IconCodeToGlyph_Tests()
    {
        _sut = new();
    }

    [Theory]
    [InlineData("&#xE7B8;", "\uE7B8")]
    [InlineData("&#xE8A7;", "\uE8A7")]
    [InlineData("&#xE700;", "\uE700")]
    [InlineData("&#xE74D;", "\uE74D")]
    public void Convert_WithHtmlEntityFormat_ReturnsGlyphCharacter(string input, string expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), null, "en-US");

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData("E7B8", "\uE7B8")]
    [InlineData("E8A7", "\uE8A7")]
    [InlineData("E700", "\uE700")]
    [InlineData("E74D", "\uE74D")]
    public void Convert_WithRawHexFormat_ReturnsGlyphCharacter(string input, string expected)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), null, "en-US");

        // Assert
        result.Should().Be(expected);
    }

    [Theory]
    [InlineData(null)]
    [InlineData("")]
    [InlineData("   ")]
    public void Convert_WithNullOrWhitespace_ReturnsDefaultIcon(string? input)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), null, "en-US");

        // Assert
        result.Should().Be("\uE7B8"); // Default box icon
    }

    [Theory]
    [InlineData("InvalidFormat")]
    [InlineData("&#xZZZZ;")]
    [InlineData("ZZZZ")]
    [InlineData("12345")]
    [InlineData("ABC")]
    public void Convert_WithInvalidHexValue_ReturnsInputAsIs(string input)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), null, "en-US");

        // Assert
        result.Should().Be(input);
    }

    [Theory]
    [InlineData("A")]
    [InlineData("AB")]
    [InlineData("ABC")]
    [InlineData("ABCDE")]
    public void Convert_WithNonFourCharacterHex_ReturnsInputAsIs(string input)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), null, "en-US");

        // Assert
        result.Should().Be(input);
    }

    [Fact]
    public void Convert_WithSingleCharacterString_ReturnsInputAsIs()
    {
        // Arrange
        var input = "X";

        // Act
        var result = _sut.Convert(input, typeof(string), null, "en-US");

        // Assert
        result.Should().Be(input);
    }

    [Theory]
    [InlineData(42)]
    [InlineData(true)]
    public void Convert_WithNonStringValue_ReturnsDefaultIcon(object input)
    {
        // Act
        var result = _sut.Convert(input, typeof(string), null, "en-US");

        // Assert
        result.Should().Be("\uE7B8");
    }

    [Fact]
    public void ConvertBack_ThrowsNotImplementedException()
    {
        // Act
        Action act = () => _sut.ConvertBack("\uE7B8", typeof(string), null, "en-US");

        // Assert
        act.Should().Throw<NotImplementedException>();
    }

    [Theory]
    [InlineData("&#xE7B8;")]
    [InlineData("E7B8")]
    public void Convert_WithLowercaseHex_HandlesCorrectly(string input)
    {
        // Arrange
        var lowercaseInput = input.ToLower();

        // Act
        var result = _sut.Convert(lowercaseInput, typeof(string), null, "en-US");

        // Assert
        result.Should().NotBeNullOrEmpty();
    }
}
